--
-- PostgreSQL database dump
--

-- Dumped from database version 15.3
-- Dumped by pg_dump version 15.3

-- Started on 2023-09-29 12:21:37

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'SQL_ASCII';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

ALTER TABLE IF EXISTS ONLY tweeks.unit DROP CONSTRAINT IF EXISTS unit_unit_user_id_fkey;
ALTER TABLE IF EXISTS ONLY tweeks.unit DROP CONSTRAINT IF EXISTS unit_unit_espaco_auth_fkey;
ALTER TABLE IF EXISTS ONLY tweeks.venda DROP CONSTRAINT IF EXISTS fk_venda_to_venda_docorigin;
ALTER TABLE IF EXISTS ONLY tweeks.venda DROP CONSTRAINT IF EXISTS fk_venda_to_espaco;
ALTER TABLE IF EXISTS ONLY tweeks.venda DROP CONSTRAINT IF EXISTS fk_venda_to_conta;
ALTER TABLE IF EXISTS ONLY tweeks.venda DROP CONSTRAINT IF EXISTS fk_venda_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.venda DROP CONSTRAINT IF EXISTS fk_venda_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.venda DROP CONSTRAINT IF EXISTS fk_venda_to_artigo;
ALTER TABLE IF EXISTS ONLY tweeks.transferencia DROP CONSTRAINT IF EXISTS fk_transferencia_to_estaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.transferencia DROP CONSTRAINT IF EXISTS fk_transferencia_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.transferencia DROP CONSTRAINT IF EXISTS fk_transferencia_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.transacao DROP CONSTRAINT IF EXISTS fk_transacao_to_toperacao;
ALTER TABLE IF EXISTS ONLY tweeks.transacao DROP CONSTRAINT IF EXISTS fk_transacao_to_tmovimento;
ALTER TABLE IF EXISTS ONLY tweeks.transacao DROP CONSTRAINT IF EXISTS fk_transacao_to_posto;
ALTER TABLE IF EXISTS ONLY tweeks.transacao DROP CONSTRAINT IF EXISTS fk_transacao_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.transacao DROP CONSTRAINT IF EXISTS fk_transacao_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.transacao DROP CONSTRAINT IF EXISTS fk_transacao_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.trabalha DROP CONSTRAINT IF EXISTS fk_trabalha_to_perfil;
ALTER TABLE IF EXISTS ONLY tweeks.trabalha DROP CONSTRAINT IF EXISTS fk_trabalha_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.trabalha DROP CONSTRAINT IF EXISTS fk_trabalha_to_colaborador_proprietario;
ALTER TABLE IF EXISTS ONLY tweeks.trabalha DROP CONSTRAINT IF EXISTS fk_trabalha_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.trabalha DROP CONSTRAINT IF EXISTS fk_trabalha_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.tipoimposto DROP CONSTRAINT IF EXISTS fk_tipoimposto_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.tipoimposto DROP CONSTRAINT IF EXISTS fk_tipoimposto_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.taxa DROP CONSTRAINT IF EXISTS fk_taxa_to_tipoimposto;
ALTER TABLE IF EXISTS ONLY tweeks.taxa DROP CONSTRAINT IF EXISTS fk_taxa_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.taxa DROP CONSTRAINT IF EXISTS fk_taxa_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.taxa DROP CONSTRAINT IF EXISTS fk_taxa_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.serie DROP CONSTRAINT IF EXISTS fk_serie_to_tserie;
ALTER TABLE IF EXISTS ONLY tweeks.serie DROP CONSTRAINT IF EXISTS fk_serie_to_espaco;
ALTER TABLE IF EXISTS ONLY tweeks.serie DROP CONSTRAINT IF EXISTS fk_serie_to_autorizacao;
ALTER TABLE IF EXISTS ONLY tweeks.retalho DROP CONSTRAINT IF EXISTS fk_retalho_to_espaco;
ALTER TABLE IF EXISTS ONLY tweeks.retalho DROP CONSTRAINT IF EXISTS fk_retalho_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.retalho DROP CONSTRAINT IF EXISTS fk_retalho_to_artigo_composto;
ALTER TABLE IF EXISTS ONLY tweeks.retalho DROP CONSTRAINT IF EXISTS fk_retalho_to_artigo_base;
ALTER TABLE IF EXISTS ONLY tweeks.posto DROP CONSTRAINT IF EXISTS fk_posto_to_tposto;
ALTER TABLE IF EXISTS ONLY tweeks.posto DROP CONSTRAINT IF EXISTS fk_posto_to_espaco;
ALTER TABLE IF EXISTS ONLY tweeks.posto DROP CONSTRAINT IF EXISTS fk_posto_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.posto DROP CONSTRAINT IF EXISTS fk_posto_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.movimento DROP CONSTRAINT IF EXISTS fk_movimento_to_toperacao;
ALTER TABLE IF EXISTS ONLY tweeks.movimento DROP CONSTRAINT IF EXISTS fk_movimento_to_tmovimento;
ALTER TABLE IF EXISTS ONLY tweeks.movimento DROP CONSTRAINT IF EXISTS fk_movimento_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.movimento DROP CONSTRAINT IF EXISTS fk_movimento_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.movimento DROP CONSTRAINT IF EXISTS fk_movimento_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.link DROP CONSTRAINT IF EXISTS fk_link_to_tlink;
ALTER TABLE IF EXISTS ONLY tweeks.link DROP CONSTRAINT IF EXISTS fk_link_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.link DROP CONSTRAINT IF EXISTS fk_link_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.link DROP CONSTRAINT IF EXISTS fk_link_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.lancamento DROP CONSTRAINT IF EXISTS fk_lancamento_to_ttrasacao;
ALTER TABLE IF EXISTS ONLY tweeks.lancamento DROP CONSTRAINT IF EXISTS fk_lancamento_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.lancamento DROP CONSTRAINT IF EXISTS fk_lancamento_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.lancamento DROP CONSTRAINT IF EXISTS fk_lancamento_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.lancamento DROP CONSTRAINT IF EXISTS fk_lancamento_to_cliente;
ALTER TABLE IF EXISTS ONLY tweeks.impostovenda DROP CONSTRAINT IF EXISTS fk_impostovenda_to_venda;
ALTER TABLE IF EXISTS ONLY tweeks.impostovenda DROP CONSTRAINT IF EXISTS fk_impostovenda_to_tipovenda;
ALTER TABLE IF EXISTS ONLY tweeks.impostovenda DROP CONSTRAINT IF EXISTS fk_impostovenda_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.impostovenda DROP CONSTRAINT IF EXISTS fk_impostovenda_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.impostovenda DROP CONSTRAINT IF EXISTS fk_impostovenda_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.imposto DROP CONSTRAINT IF EXISTS fk_imposto_to_tipoimposto;
ALTER TABLE IF EXISTS ONLY tweeks.imposto DROP CONSTRAINT IF EXISTS fk_imposto_to_taplicar;
ALTER TABLE IF EXISTS ONLY tweeks.imposto DROP CONSTRAINT IF EXISTS fk_imposto_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.imposto DROP CONSTRAINT IF EXISTS fk_imposto_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.imposto DROP CONSTRAINT IF EXISTS fk_imposto_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.imposto DROP CONSTRAINT IF EXISTS fk_imposto_to_artigo;
ALTER TABLE IF EXISTS ONLY tweeks.guia DROP CONSTRAINT IF EXISTS fk_guia_to_espaco;
ALTER TABLE IF EXISTS ONLY tweeks.guia DROP CONSTRAINT IF EXISTS fk_guia_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.guia DROP CONSTRAINT IF EXISTS fk_guia_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.fornecedor DROP CONSTRAINT IF EXISTS fk_fornecedor_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.fornecedor DROP CONSTRAINT IF EXISTS fk_fornecedor_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.fornecedor DROP CONSTRAINT IF EXISTS fk_fornecedor_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.fluxo DROP CONSTRAINT IF EXISTS fk_fluxo_to_toperacao;
ALTER TABLE IF EXISTS ONLY tweeks.fluxo DROP CONSTRAINT IF EXISTS fk_fluxo_to_espaco_out;
ALTER TABLE IF EXISTS ONLY tweeks.fluxo DROP CONSTRAINT IF EXISTS fk_fluxo_to_espaco_in;
ALTER TABLE IF EXISTS ONLY tweeks.fluxo DROP CONSTRAINT IF EXISTS fk_fluxo_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.fluxo DROP CONSTRAINT IF EXISTS fk_fluxo_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.fluxo DROP CONSTRAINT IF EXISTS fk_fluxo_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.fluxo DROP CONSTRAINT IF EXISTS fk_fluxo_to_artigo_out;
ALTER TABLE IF EXISTS ONLY tweeks.fluxo DROP CONSTRAINT IF EXISTS fk_fluxo_to_artigo_in;
ALTER TABLE IF EXISTS ONLY tweeks.espaco DROP CONSTRAINT IF EXISTS fk_espaco_to_posto_admin;
ALTER TABLE IF EXISTS ONLY tweeks.espaco DROP CONSTRAINT IF EXISTS fk_espaco_to_espaco;
ALTER TABLE IF EXISTS ONLY tweeks.espaco DROP CONSTRAINT IF EXISTS fk_espaco_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.espaco DROP CONSTRAINT IF EXISTS fk_espaco_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.entrada DROP CONSTRAINT IF EXISTS fk_entrada_to_espaco_destito;
ALTER TABLE IF EXISTS ONLY tweeks.entrada DROP CONSTRAINT IF EXISTS fk_entrada_to_espaco;
ALTER TABLE IF EXISTS ONLY tweeks.entrada DROP CONSTRAINT IF EXISTS fk_entrada_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.entrada DROP CONSTRAINT IF EXISTS fk_entrada_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.entrada DROP CONSTRAINT IF EXISTS fk_entrada_to_artigo;
ALTER TABLE IF EXISTS ONLY tweeks.ean DROP CONSTRAINT IF EXISTS fk_ean_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.ean DROP CONSTRAINT IF EXISTS fk_ean_to_artigo;
ALTER TABLE IF EXISTS ONLY tweeks.dispoe DROP CONSTRAINT IF EXISTS fk_dispoe_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.dispoe DROP CONSTRAINT IF EXISTS fk_dispoe_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.dispoe DROP CONSTRAINT IF EXISTS fk_dispoe_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.dispoe DROP CONSTRAINT IF EXISTS fk_dispoe_to_artigo_item;
ALTER TABLE IF EXISTS ONLY tweeks.dispoe DROP CONSTRAINT IF EXISTS fk_dispoe_to_artigo;
ALTER TABLE IF EXISTS ONLY tweeks.deposito DROP CONSTRAINT IF EXISTS fk_deposito_to_serie;
ALTER TABLE IF EXISTS ONLY tweeks.custoguia DROP CONSTRAINT IF EXISTS fk_custo_to_guia;
ALTER TABLE IF EXISTS ONLY tweeks.custoguia DROP CONSTRAINT IF EXISTS fk_custo_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.custoguia DROP CONSTRAINT IF EXISTS fk_custo_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.conta DROP CONSTRAINT IF EXISTS fk_conto_to_cliente;
ALTER TABLE IF EXISTS ONLY tweeks.conta DROP CONSTRAINT IF EXISTS fk_conta_to_serie;
ALTER TABLE IF EXISTS ONLY tweeks.conta DROP CONSTRAINT IF EXISTS fk_conta_to_posto_fecho;
ALTER TABLE IF EXISTS ONLY tweeks.conta DROP CONSTRAINT IF EXISTS fk_conta_to_posto;
ALTER TABLE IF EXISTS ONLY tweeks.conta DROP CONSTRAINT IF EXISTS fk_conta_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.conta DROP CONSTRAINT IF EXISTS fk_conta_to_conta_docorigin;
ALTER TABLE IF EXISTS ONLY tweeks.conta DROP CONSTRAINT IF EXISTS fk_conta_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.conta DROP CONSTRAINT IF EXISTS fk_conta_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.cliente DROP CONSTRAINT IF EXISTS fk_cliente_to_tdocumento;
ALTER TABLE IF EXISTS ONLY tweeks.classe DROP CONSTRAINT IF EXISTS fk_classe_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.classe DROP CONSTRAINT IF EXISTS fk_classe_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.classe DROP CONSTRAINT IF EXISTS fk_classe_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.cambio DROP CONSTRAINT IF EXISTS fk_cambio_to_currency;
ALTER TABLE IF EXISTS ONLY tweeks.caixa DROP CONSTRAINT IF EXISTS fk_caixa_to_posto;
ALTER TABLE IF EXISTS ONLY tweeks.caixa DROP CONSTRAINT IF EXISTS fk_caixa_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.caixa DROP CONSTRAINT IF EXISTS fk_caixa_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.caixa DROP CONSTRAINT IF EXISTS fk_caixa_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.autorizacao DROP CONSTRAINT IF EXISTS fk_autorizacao_to_espaco;
ALTER TABLE IF EXISTS ONLY tweeks.artigo DROP CONSTRAINT IF EXISTS fk_artigo_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.artigo DROP CONSTRAINT IF EXISTS fk_artigo_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.artigo DROP CONSTRAINT IF EXISTS fk_artigo_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.artigo DROP CONSTRAINT IF EXISTS fk_artigo_to_artigo;
ALTER TABLE IF EXISTS ONLY tweeks.deposito DROP CONSTRAINT IF EXISTS fk_amortizacao_to_tpaga;
ALTER TABLE IF EXISTS ONLY tweeks.deposito DROP CONSTRAINT IF EXISTS fk_amortizacao_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.deposito DROP CONSTRAINT IF EXISTS fk_amortizacao_to_currency;
ALTER TABLE IF EXISTS ONLY tweeks.deposito DROP CONSTRAINT IF EXISTS fk_amortizacao_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY tweeks.deposito DROP CONSTRAINT IF EXISTS fk_amortizacao_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.deposito DROP CONSTRAINT IF EXISTS fk_amortizacao_to_caixa;
ALTER TABLE IF EXISTS ONLY tweeks.aloca DROP CONSTRAINT IF EXISTS fk_aloca_to_posto;
ALTER TABLE IF EXISTS ONLY tweeks.aloca DROP CONSTRAINT IF EXISTS fk_aloca_to_espaco_destino;
ALTER TABLE IF EXISTS ONLY tweeks.aloca DROP CONSTRAINT IF EXISTS fk_aloca_to_espaco;
ALTER TABLE IF EXISTS ONLY tweeks.acerto DROP CONSTRAINT IF EXISTS fk_acerto_to_espaco_auth;
ALTER TABLE IF EXISTS ONLY tweeks.acerto DROP CONSTRAINT IF EXISTS fk_acerto_to_colaborador;
ALTER TABLE IF EXISTS ONLY tweeks.classe DROP CONSTRAINT IF EXISTS classe_classe_classe_id_fk;
ALTER TABLE IF EXISTS ONLY report.filter DROP CONSTRAINT IF EXISTS filter_filter_parametrized_uid_fkey;
ALTER TABLE IF EXISTS ONLY patch.revision DROP CONSTRAINT IF EXISTS fk_revision_to_raw;
ALTER TABLE IF EXISTS ONLY geoinfo.regionalblocother DROP CONSTRAINT IF EXISTS fk_regionalblocother_to_regionalbloc;
ALTER TABLE IF EXISTS ONLY geoinfo.regionalblocname DROP CONSTRAINT IF EXISTS fk_regionalblocname_to_regionalbloc;
ALTER TABLE IF EXISTS ONLY geoinfo.countrytranslation DROP CONSTRAINT IF EXISTS fk_countrytranslation_to_language;
ALTER TABLE IF EXISTS ONLY geoinfo.countrytranslation DROP CONSTRAINT IF EXISTS fk_countrytranslation_to_country;
ALTER TABLE IF EXISTS ONLY geoinfo.countrytopleveldomain DROP CONSTRAINT IF EXISTS fk_countrytopleveldomain_to_domain;
ALTER TABLE IF EXISTS ONLY geoinfo.countrytopleveldomain DROP CONSTRAINT IF EXISTS fk_countrytopleveldomain_to_country;
ALTER TABLE IF EXISTS ONLY geoinfo.countrytimezone DROP CONSTRAINT IF EXISTS fk_countrytimezone_to_timezone;
ALTER TABLE IF EXISTS ONLY geoinfo.countrytimezone DROP CONSTRAINT IF EXISTS fk_countrytimezone_to_country;
ALTER TABLE IF EXISTS ONLY geoinfo.countryregionalbloc DROP CONSTRAINT IF EXISTS fk_countryregionalbloc_to_regionalbloc;
ALTER TABLE IF EXISTS ONLY geoinfo.countryregionalbloc DROP CONSTRAINT IF EXISTS fk_countryregionalbloc_to_country;
ALTER TABLE IF EXISTS ONLY geoinfo.countrylanguage DROP CONSTRAINT IF EXISTS fk_countrylanguage_to_language;
ALTER TABLE IF EXISTS ONLY geoinfo.countrylanguage DROP CONSTRAINT IF EXISTS fk_countrylanguage_to_country;
ALTER TABLE IF EXISTS ONLY geoinfo.countrycurrency DROP CONSTRAINT IF EXISTS fk_countrycurrency_to_currency;
ALTER TABLE IF EXISTS ONLY geoinfo.countrycurrency DROP CONSTRAINT IF EXISTS fk_countrycurrency_to_country;
ALTER TABLE IF EXISTS ONLY geoinfo.countryborder DROP CONSTRAINT IF EXISTS fk_countryborder_to_country;
ALTER TABLE IF EXISTS ONLY geoinfo.countryborder DROP CONSTRAINT IF EXISTS fk_countryborder_to_border;
ALTER TABLE IF EXISTS ONLY geoinfo.country DROP CONSTRAINT IF EXISTS fk_country_to_subregion;
ALTER TABLE IF EXISTS ONLY geoinfo.country DROP CONSTRAINT IF EXISTS fk_country_to_region;
ALTER TABLE IF EXISTS ONLY geoinfo.country DROP CONSTRAINT IF EXISTS fk_country_to_demonym;
ALTER TABLE IF EXISTS ONLY geoinfo.countrycallcode DROP CONSTRAINT IF EXISTS fk_callcode_to_country;
ALTER TABLE IF EXISTS ONLY geoinfo.altspelling DROP CONSTRAINT IF EXISTS fk_altspelling_to_country;
ALTER TABLE IF EXISTS ONLY cluster.version DROP CONSTRAINT IF EXISTS fk_version_to_cluster;
ALTER TABLE IF EXISTS ONLY cluster.auth DROP CONSTRAINT IF EXISTS fk_auth_to_cluster;
ALTER TABLE IF EXISTS ONLY auth.privilegio DROP CONSTRAINT IF EXISTS fk_privilegio_to_perfil;
ALTER TABLE IF EXISTS ONLY auth.privilegio DROP CONSTRAINT IF EXISTS fk_privilegio_to_menu;
ALTER TABLE IF EXISTS ONLY auth.privilegio DROP CONSTRAINT IF EXISTS fk_privilegio_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY auth.privilegio DROP CONSTRAINT IF EXISTS fk_privilegio_to_colaborador;
ALTER TABLE IF EXISTS ONLY auth.perfil DROP CONSTRAINT IF EXISTS fk_perfil_to_perfil;
ALTER TABLE IF EXISTS ONLY auth.perfil DROP CONSTRAINT IF EXISTS fk_perfil_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY auth.perfil DROP CONSTRAINT IF EXISTS fk_perfil_to_colaborador;
ALTER TABLE IF EXISTS ONLY auth.menu DROP CONSTRAINT IF EXISTS fk_menu_to_menu;
ALTER TABLE IF EXISTS ONLY auth.colaborador DROP CONSTRAINT IF EXISTS fk_colaborador_to_tsexo;
ALTER TABLE IF EXISTS ONLY auth.colaborador DROP CONSTRAINT IF EXISTS fk_colaborador_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY auth.colaborador DROP CONSTRAINT IF EXISTS fk_colaborador_to_colaborador;
ALTER TABLE IF EXISTS ONLY auth.autenticacao DROP CONSTRAINT IF EXISTS fk_autenticacao_to_colaborador;
ALTER TABLE IF EXISTS ONLY auth.acesso DROP CONSTRAINT IF EXISTS fk_acesso_to_menu;
ALTER TABLE IF EXISTS ONLY auth.acesso DROP CONSTRAINT IF EXISTS fk_acesso_to_colaborador_propetario;
ALTER TABLE IF EXISTS ONLY auth.acesso DROP CONSTRAINT IF EXISTS fk_acesso_to_colaborador_atualizacao;
ALTER TABLE IF EXISTS ONLY auth.acesso DROP CONSTRAINT IF EXISTS fk_acesso_to_colaborador;
DROP TRIGGER IF EXISTS tg_venda_before_sets ON tweeks.venda;
DROP TRIGGER IF EXISTS tg_venda_before_check ON tweeks.venda;
DROP TRIGGER IF EXISTS tg_transacao_after_insert_adjust_posto_montante ON tweeks.transacao;
DROP TRIGGER IF EXISTS tg_fluxo_on_venda_sets ON tweeks.venda;
DROP TRIGGER IF EXISTS tg_fluxo_on_transferencia ON tweeks.transferencia;
DROP TRIGGER IF EXISTS tg_fluxo_on_retalho ON tweeks.retalho;
DROP TRIGGER IF EXISTS tg_fluxo_on_entrada ON tweeks.entrada;
DROP TRIGGER IF EXISTS tg_fluxo_on_acerto ON tweeks.acerto;
DROP TRIGGER IF EXISTS tg_conta_after_close ON tweeks.conta;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_venda_933320 ON tweeks.venda;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_transferencia_792134 ON tweeks.transferencia;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_transacao_955905 ON tweeks.transacao;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_trabalha_583304 ON tweeks.trabalha;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_tipoimposto_504064 ON tweeks.tipoimposto;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_taxa_698634 ON tweeks.taxa;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_serie_628940 ON tweeks.serie;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_retalho_993293 ON tweeks.retalho;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_posto_103596 ON tweeks.posto;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_movimento_178685 ON tweeks.movimento;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_link_698125 ON tweeks.link;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_lancamento_531885 ON tweeks.lancamento;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_impostovenda_456497 ON tweeks.impostovenda;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_imposto_311584 ON tweeks.imposto;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_guia_829296 ON tweeks.guia;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_fornecedor_355190 ON tweeks.fornecedor;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_fluxo_335984 ON tweeks.fluxo;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_entrada_898229 ON tweeks.entrada;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_ean_965869 ON tweeks.ean;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_dispoe_291390 ON tweeks.dispoe;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_deposito_927162 ON tweeks.deposito;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_custoguia_931555 ON tweeks.custoguia;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_conta_797518 ON tweeks.conta;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_cliente_313700 ON tweeks.cliente;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_classe_800703 ON tweeks.classe;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_cambio_826027 ON tweeks.cambio;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_caixa_318184 ON tweeks.caixa;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_artigo_716909 ON tweeks.artigo;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_aloca_299370 ON tweeks.aloca;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_tweeks_acerto_440580 ON tweeks.acerto;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_venda_113044 ON tweeks.venda;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_transferencia_472244 ON tweeks.transferencia;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_transacao_213897 ON tweeks.transacao;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_trabalha_490105 ON tweeks.trabalha;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_tipoimposto_816325 ON tweeks.tipoimposto;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_taxa_484021 ON tweeks.taxa;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_serie_174114 ON tweeks.serie;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_retalho_881257 ON tweeks.retalho;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_posto_770458 ON tweeks.posto;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_movimento_501528 ON tweeks.movimento;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_link_581810 ON tweeks.link;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_lancamento_151818 ON tweeks.lancamento;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_impostovenda_524654 ON tweeks.impostovenda;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_imposto_157782 ON tweeks.imposto;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_guia_487881 ON tweeks.guia;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_fornecedor_170298 ON tweeks.fornecedor;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_fluxo_818979 ON tweeks.fluxo;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_entrada_347466 ON tweeks.entrada;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_ean_784645 ON tweeks.ean;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_dispoe_585090 ON tweeks.dispoe;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_deposito_491653 ON tweeks.deposito;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_custoguia_210607 ON tweeks.custoguia;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_conta_738120 ON tweeks.conta;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_cliente_226963 ON tweeks.cliente;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_classe_872014 ON tweeks.classe;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_cambio_189868 ON tweeks.cambio;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_caixa_609494 ON tweeks.caixa;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_artigo_940916 ON tweeks.artigo;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_aloca_545021 ON tweeks.aloca;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_tweeks_acerto_687943 ON tweeks.acerto;
DROP TRIGGER IF EXISTS cluster_version_commit_change_update_on_tweeks_trabalha_819866 ON tweeks.trabalha;
DROP TRIGGER IF EXISTS cluster_version_commit_change_update_on_tweeks_espaco_329179 ON tweeks.espaco;
DROP TRIGGER IF EXISTS cluster_version_commit_change_update_on_tweeks_branch_763687 ON tweeks.branch;
DROP TRIGGER IF EXISTS cluster_version_commit_change_insert_on_tweeks_trabalha_885890 ON tweeks.trabalha;
DROP TRIGGER IF EXISTS cluster_version_commit_change_insert_on_tweeks_espaco_656816 ON tweeks.espaco;
DROP TRIGGER IF EXISTS cluster_version_commit_change_insert_on_tweeks_branch_417147 ON tweeks.branch;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_update_on_tweeks_trabalha_4074 ON tweeks.trabalha;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_update_on_tweeks_espaco_177136 ON tweeks.espaco;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_insert_on_tweeks_trabalha_7237 ON tweeks.trabalha;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_insert_on_tweeks_espaco_297678 ON tweeks.espaco;
DROP TRIGGER IF EXISTS __tg_create_lancamento ON tweeks.deposito;
DROP TRIGGER IF EXISTS __tg_create_lancamento ON tweeks.conta;
DROP TRIGGER IF EXISTS __tg_before_update_classe ON tweeks.classe;
DROP TRIGGER IF EXISTS tg_report_format ON report.report;
DROP TRIGGER IF EXISTS trigger_sync_domsync ON libdom.domsync;
DROP TRIGGER IF EXISTS sync_trigger ON libdom.entryset;
DROP TRIGGER IF EXISTS tg_share_truncate ON cluster.share;
DROP TRIGGER IF EXISTS tg_share_check ON cluster.share;
DROP TRIGGER IF EXISTS cluster_version_commit_change_update_on_tweeks_branch_190349 ON cluster.branch;
DROP TRIGGER IF EXISTS cluster_version_commit_change_update_on_cluster_branch_185443 ON cluster.branch;
DROP TRIGGER IF EXISTS cluster_version_commit_change_insert_on_tweeks_branch_452421 ON cluster.branch;
DROP TRIGGER IF EXISTS cluster_version_commit_change_insert_on_cluster_branch_953907 ON cluster.branch;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_update_on_tweeks_branch_741787 ON cluster.branch;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_update_on_cluster_branch_37843 ON cluster.branch;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_insert_on_tweeks_branch_248909 ON cluster.branch;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_insert_on_cluster_branch_86599 ON cluster.branch;
DROP TRIGGER IF EXISTS cluster_share_map ON cluster.share;
DROP TRIGGER IF EXISTS __tg_before_create_filter ON cluster.filter;
DROP TRIGGER IF EXISTS sync_branch_map_before_update_on_auth_acesso_894121 ON auth.acesso;
DROP TRIGGER IF EXISTS sync_branch_map_before_insert_on_auth_acesso_909018 ON auth.acesso;
DROP TRIGGER IF EXISTS cluster_version_commit_change_update_on_auth_privilegio_656203 ON auth.privilegio;
DROP TRIGGER IF EXISTS cluster_version_commit_change_update_on_auth_perfil_266693 ON auth.perfil;
DROP TRIGGER IF EXISTS cluster_version_commit_change_update_on_auth_colaborador_676820 ON auth.colaborador;
DROP TRIGGER IF EXISTS cluster_version_commit_change_update_on_auth_acesso_149765 ON auth.acesso;
DROP TRIGGER IF EXISTS cluster_version_commit_change_insert_on_auth_privilegio_651705 ON auth.privilegio;
DROP TRIGGER IF EXISTS cluster_version_commit_change_insert_on_auth_perfil_158915 ON auth.perfil;
DROP TRIGGER IF EXISTS cluster_version_commit_change_insert_on_auth_colaborador_598187 ON auth.colaborador;
DROP TRIGGER IF EXISTS cluster_version_commit_change_insert_on_auth_acesso_724429 ON auth.acesso;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_update_on_auth_privilegio_7057 ON auth.privilegio;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_update_on_auth_perfil_388675 ON auth.perfil;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_update_on_auth_colaborador_456 ON auth.colaborador;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_update_on_auth_acesso_499335 ON auth.acesso;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_insert_on_auth_privilegio_4414 ON auth.privilegio;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_insert_on_auth_perfil_921824 ON auth.perfil;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_insert_on_auth_colaborador_111 ON auth.colaborador;
DROP TRIGGER IF EXISTS cluster_version_add_change_after_insert_on_auth_acesso_680140 ON auth.acesso;
CREATE OR REPLACE VIEW report.vreport_venda_artigo AS
SELECT
    NULL::character varying AS "ARTIGO",
    NULL::character varying AS "CATEGORIA",
    NULL::character varying AS "CÓD. CAT.",
    NULL::character varying AS "ARMAZÉM",
    NULL::character varying AS "POSTO",
    NULL::double precision AS "QT",
    NULL::double precision AS "$ MONT.",
    NULL::double precision AS "$ EXTRAS",
    NULL::double precision AS "$ MONT+EXT",
    NULL::double precision AS "$ IMPOSTO",
    NULL::double precision AS "$ SUBTOTAL",
    NULL::double precision AS "$ TOTAL",
    NULL::text AS "IMPOSTOS",
    NULL::text AS "TAXAS",
    NULL::uuid[] AS _tipoimposto_ids,
    NULL::uuid AS artigo_id,
    NULL::smallint AS tserie_id,
    NULL::character varying AS "SERIE",
    NULL::uuid AS posto_id,
    NULL::uuid AS espaco_id,
    NULL::text AS "COLABORADOR",
    NULL::character varying AS "CAIXA",
    NULL::uuid AS _caixa_id,
    NULL::character varying AS "CÓD ARTIGO",
    NULL::uuid AS _branch_uid;
CREATE OR REPLACE VIEW report.vreport_venda AS
SELECT
    NULL::uuid AS venda_id,
    NULL::character varying AS "FATURA",
    NULL::character varying AS "ARTIGO",
    NULL::character varying AS "CATEGORIA",
    NULL::character varying AS "CÓD. CAT.",
    NULL::character varying AS "ARMAZÉM",
    NULL::character varying AS "POSTO",
    NULL::character varying AS "NIF",
    NULL::character varying AS "CLIENTE",
    NULL::double precision AS "$ PREÇO",
    NULL::double precision AS "QT",
    NULL::double precision AS "$ MONT.",
    NULL::double precision AS "$ EXTRAS",
    NULL::double precision AS "$ MONT+EXT",
    NULL::double precision AS "$ IMPOSTO",
    NULL::double precision AS "$ SUBTOTAL",
    NULL::double precision AS "$ TOTAL",
    NULL::double precision AS "$ MONTANTE FINAL",
    NULL::boolean AS venda_isencao,
    NULL::text AS "ISEN.",
    NULL::text AS "IMPOSTOS",
    NULL::text AS "TAXAS",
    NULL::uuid[] AS _tipoimposto_ids,
    NULL::uuid AS artigo_id,
    NULL::date AS "DATA",
    NULL::smallint AS tserie_id,
    NULL::character varying AS "SERIE",
    NULL::smallint AS _tgrupo_id,
    NULL::uuid AS conta_cliente_id,
    NULL::uuid AS posto_id,
    NULL::uuid AS espaco_id,
    NULL::text AS "COLABORADOR",
    NULL::uuid AS _branch_uid,
    NULL::uuid AS colaborador_fecho,
    NULL::uuid AS classe_id,
    NULL::uuid AS deposito_id,
    NULL::uuid AS _caixa_id,
    NULL::character varying AS "CAIXA",
    NULL::character varying AS "CÓD ARTIGO";
CREATE OR REPLACE VIEW report.vreport_notacredito AS
SELECT
    NULL::uuid AS venda_id,
    NULL::character varying AS "DOCUMENTO",
    NULL::character varying AS "JUSTIFICATIVA",
    NULL::character varying AS "DOC. ORIGEM",
    NULL::character varying AS "ARTIGO",
    NULL::character varying AS "CATEGORIA",
    NULL::character varying AS "CÓD. CAT.",
    NULL::character varying AS "ARMAZÉM",
    NULL::character varying AS "POSTO",
    NULL::character varying AS "NIF",
    NULL::character varying AS "CLIENTE",
    NULL::double precision AS "$ PREÇO",
    NULL::double precision AS "QT",
    NULL::double precision AS "$ MONT.",
    NULL::double precision AS "$ EXTRAS",
    NULL::double precision AS "$ MONT+EXT",
    NULL::double precision AS "$ IMPOSTO",
    NULL::double precision AS "$ SUBTOTAL",
    NULL::double precision AS "$ TOTAL",
    NULL::double precision AS "$ MONTANTE FINAL",
    NULL::boolean AS venda_isencao,
    NULL::text AS "ISEN.",
    NULL::text AS "IMPOSTOS",
    NULL::text AS "TAXAS",
    NULL::uuid[] AS _tipoimposto_ids,
    NULL::uuid AS artigo_id,
    NULL::date AS "DATA",
    NULL::smallint AS tserie_id,
    NULL::character varying AS "SERIE",
    NULL::smallint AS _tgrupo_id,
    NULL::uuid AS conta_cliente_id,
    NULL::uuid AS posto_id,
    NULL::uuid AS espaco_id,
    NULL::text AS "COLABORADOR",
    NULL::uuid AS _branch_uid,
    NULL::uuid AS colaborador_fecho,
    NULL::uuid AS classe_id,
    NULL::uuid AS deposito_id,
    NULL::uuid AS _caixa_id,
    NULL::character varying AS "CAIXA",
    NULL::character varying AS "CÓD ARTIGO";
CREATE OR REPLACE VIEW report.vreport_guiasaida AS
SELECT
    NULL::uuid AS venda_id,
    NULL::character varying AS "SERIE",
    NULL::character varying AS "ARTIGO",
    NULL::character varying AS "CATEGORIA",
    NULL::character varying AS "CÓD. CAT.",
    NULL::character varying AS "ARMAZÉM",
    NULL::character varying AS "POSTO",
    NULL::character varying AS "NIF",
    NULL::character varying AS "CLIENTE",
    NULL::double precision AS "$ PREÇO",
    NULL::double precision AS "QT",
    NULL::double precision AS "$ MONT.",
    NULL::double precision AS "$ EXTRAS",
    NULL::double precision AS "$ MONT+EXT",
    NULL::double precision AS "$ IMPOSTO",
    NULL::double precision AS "$ SUBTOTAL",
    NULL::double precision AS "$ TOTAL",
    NULL::double precision AS "$ MONTANTE FINAL",
    NULL::boolean AS venda_isencao,
    NULL::text AS "IMPOSTOS",
    NULL::text AS "TAXAS",
    NULL::uuid[] AS _tipoimposto_ids,
    NULL::uuid AS artigo_id,
    NULL::date AS "DATA",
    NULL::smallint AS _tgrupo_id,
    NULL::uuid AS conta_cliente_id,
    NULL::uuid AS posto_id,
    NULL::uuid AS espaco_id,
    NULL::text AS "COLABORADOR",
    NULL::uuid AS colaborador_fecho,
    NULL::uuid AS classe_id,
    NULL::character varying AS "CÓD ARTIGO",
    NULL::uuid AS _branch_uid;
DROP INDEX IF EXISTS tweeks.idx_movimento_referencia_venda_hash;
DROP INDEX IF EXISTS tweeks.idx_movimento_referencia_venda_gin;
DROP INDEX IF EXISTS tweeks.idx_movimento_referencia_entrada_hash;
DROP INDEX IF EXISTS geoinfo.idx_regionalblocother_regionalbloc_id;
DROP INDEX IF EXISTS geoinfo.idx_regionalblocname_regionalbloc_id;
DROP INDEX IF EXISTS geoinfo.idx_language_nativename;
DROP INDEX IF EXISTS geoinfo.idx_currency_name;
DROP INDEX IF EXISTS geoinfo.idx_currency_code_name;
DROP INDEX IF EXISTS geoinfo.idx_currency_code;
DROP INDEX IF EXISTS geoinfo.idx_country_subregion_id;
DROP INDEX IF EXISTS geoinfo.idx_country_region_id;
DROP INDEX IF EXISTS geoinfo.idx_country_name;
DROP INDEX IF EXISTS geoinfo.idx_country_demonym_id;
DROP INDEX IF EXISTS geoinfo.idx_country_capital;
DROP INDEX IF EXISTS geoinfo.idx_altspelling_country_id;
DROP INDEX IF EXISTS auth.idx_privilegio_perfil_id;
DROP INDEX IF EXISTS auth.idx_privilegio_colaboirador_id;
DROP INDEX IF EXISTS auth.idx_privilegio_colaboirador_atualizacao;
DROP INDEX IF EXISTS auth.idx_previlegio_menu_id;
DROP INDEX IF EXISTS auth.idx_perfil_perfil_perfil_id;
DROP INDEX IF EXISTS auth.idx_perfil_colaborador_id;
DROP INDEX IF EXISTS auth.idx_perfil_colaborador_atualizacao;
DROP INDEX IF EXISTS auth.idx_colaborador_colaborador_id;
DROP INDEX IF EXISTS auth.idx_autenticacao_colaborador_id;
DROP INDEX IF EXISTS auth.idx_agenda_colaborador_id;
DROP INDEX IF EXISTS auth.idx_acesso_menu_id;
DROP INDEX IF EXISTS auth.idx_acesso_estado;
DROP INDEX IF EXISTS auth.idx_acesso_colaborador_propetario;
DROP INDEX IF EXISTS auth."IDX_session_expire";
ALTER TABLE IF EXISTS ONLY tweeks.unit DROP CONSTRAINT IF EXISTS unit_pkey;
ALTER TABLE IF EXISTS ONLY tweeks.unit DROP CONSTRAINT IF EXISTS uk_unit_code;
ALTER TABLE IF EXISTS ONLY tweeks.tpaga DROP CONSTRAINT IF EXISTS uk_tpaga_designacao;
ALTER TABLE IF EXISTS ONLY tweeks.tmovimento DROP CONSTRAINT IF EXISTS uk_tmovimento_designacao;
ALTER TABLE IF EXISTS ONLY tweeks.tipoimposto DROP CONSTRAINT IF EXISTS uk_tipoimposto;
ALTER TABLE IF EXISTS ONLY tweeks.posto DROP CONSTRAINT IF EXISTS uk_posto_matricula;
ALTER TABLE IF EXISTS ONLY tweeks.posto DROP CONSTRAINT IF EXISTS uk_posto_chave;
ALTER TABLE IF EXISTS ONLY tweeks.fornecedor DROP CONSTRAINT IF EXISTS uk_fornecedor_nif;
ALTER TABLE IF EXISTS ONLY tweeks.fornecedor DROP CONSTRAINT IF EXISTS uk_fornecedor_email;
ALTER TABLE IF EXISTS ONLY tweeks.espaco DROP CONSTRAINT IF EXISTS uk_espaco_nome;
ALTER TABLE IF EXISTS ONLY tweeks.espaco DROP CONSTRAINT IF EXISTS uk_espaco_codigo;
ALTER TABLE IF EXISTS ONLY tweeks.ean DROP CONSTRAINT IF EXISTS uk_ean_code;
ALTER TABLE IF EXISTS ONLY tweeks.deposito DROP CONSTRAINT IF EXISTS uk_deposto_key;
ALTER TABLE IF EXISTS ONLY tweeks.conta DROP CONSTRAINT IF EXISTS uk_conta_fatura;
ALTER TABLE IF EXISTS ONLY tweeks.conta DROP CONSTRAINT IF EXISTS uk_conta_chave;
ALTER TABLE IF EXISTS ONLY tweeks.cliente DROP CONSTRAINT IF EXISTS uk_cliente_nif;
ALTER TABLE IF EXISTS ONLY tweeks.classe DROP CONSTRAINT IF EXISTS uk_classe_nome;
ALTER TABLE IF EXISTS ONLY tweeks.venda DROP CONSTRAINT IF EXISTS pk_venda_id;
ALTER TABLE IF EXISTS ONLY tweeks.tlancamento DROP CONSTRAINT IF EXISTS pk_ttransacao_id;
ALTER TABLE IF EXISTS ONLY tweeks.tserie DROP CONSTRAINT IF EXISTS pk_tserie_id;
ALTER TABLE IF EXISTS ONLY tweeks.transferencia DROP CONSTRAINT IF EXISTS pk_transferencia_id;
ALTER TABLE IF EXISTS ONLY tweeks.transacao DROP CONSTRAINT IF EXISTS pk_transacao_id;
ALTER TABLE IF EXISTS ONLY tweeks.trabalha DROP CONSTRAINT IF EXISTS pk_trabalha_id;
ALTER TABLE IF EXISTS ONLY tweeks.tposto DROP CONSTRAINT IF EXISTS pk_tposto_id;
ALTER TABLE IF EXISTS ONLY tweeks.tpaga DROP CONSTRAINT IF EXISTS pk_tpaga_id;
ALTER TABLE IF EXISTS ONLY tweeks.toperacao DROP CONSTRAINT IF EXISTS pk_toperacao_id;
ALTER TABLE IF EXISTS ONLY tweeks.tmovimento DROP CONSTRAINT IF EXISTS pk_tmovimento_id;
ALTER TABLE IF EXISTS ONLY tweeks.tlink DROP CONSTRAINT IF EXISTS pk_tlink_id;
ALTER TABLE IF EXISTS ONLY tweeks.tipoimposto DROP CONSTRAINT IF EXISTS pk_tipoimposto_id;
ALTER TABLE IF EXISTS ONLY tweeks.tgrupo DROP CONSTRAINT IF EXISTS pk_tgroupo_id;
ALTER TABLE IF EXISTS ONLY tweeks.tdocuemto DROP CONSTRAINT IF EXISTS pk_tdocumento_id;
ALTER TABLE IF EXISTS ONLY tweeks.tbranch DROP CONSTRAINT IF EXISTS pk_tbranch_id;
ALTER TABLE IF EXISTS ONLY tweeks.taxa DROP CONSTRAINT IF EXISTS pk_taxa_id;
ALTER TABLE IF EXISTS ONLY tweeks.taplicar DROP CONSTRAINT IF EXISTS pk_taplicar_id;
ALTER TABLE IF EXISTS ONLY tweeks.serie DROP CONSTRAINT IF EXISTS pk_serie_id;
ALTER TABLE IF EXISTS ONLY tweeks.retalho DROP CONSTRAINT IF EXISTS pk_retalho_id;
ALTER TABLE IF EXISTS ONLY tweeks.repcolumn DROP CONSTRAINT IF EXISTS pk_repcolumn_source;
ALTER TABLE IF EXISTS ONLY tweeks.posto DROP CONSTRAINT IF EXISTS pk_posto_id;
ALTER TABLE IF EXISTS ONLY tweeks.movimento DROP CONSTRAINT IF EXISTS pk_movimento_id;
ALTER TABLE IF EXISTS ONLY tweeks.link DROP CONSTRAINT IF EXISTS pk_link_id;
ALTER TABLE IF EXISTS ONLY tweeks.lancamento DROP CONSTRAINT IF EXISTS pk_lancamento_id;
ALTER TABLE IF EXISTS ONLY tweeks.impostovenda DROP CONSTRAINT IF EXISTS pk_impostovenda_id;
ALTER TABLE IF EXISTS ONLY tweeks.imposto DROP CONSTRAINT IF EXISTS pk_imposto_id;
ALTER TABLE IF EXISTS ONLY tweeks.guia DROP CONSTRAINT IF EXISTS pk_guia_id;
ALTER TABLE IF EXISTS ONLY tweeks.fornecedor DROP CONSTRAINT IF EXISTS pk_fornecedor_id;
ALTER TABLE IF EXISTS ONLY tweeks.fluxo DROP CONSTRAINT IF EXISTS pk_fluxo_id;
ALTER TABLE IF EXISTS ONLY tweeks.espaco DROP CONSTRAINT IF EXISTS pk_espaco_id;
ALTER TABLE IF EXISTS ONLY tweeks.entrada DROP CONSTRAINT IF EXISTS pk_entrada_id;
ALTER TABLE IF EXISTS ONLY tweeks.ean DROP CONSTRAINT IF EXISTS pk_ena_id;
ALTER TABLE IF EXISTS ONLY tweeks.dispoe DROP CONSTRAINT IF EXISTS pk_dispoe_id;
ALTER TABLE IF EXISTS ONLY tweeks.custoguia DROP CONSTRAINT IF EXISTS pk_custo_id;
ALTER TABLE IF EXISTS ONLY tweeks.conta DROP CONSTRAINT IF EXISTS pk_conta_id;
ALTER TABLE IF EXISTS ONLY tweeks.codigoimposto DROP CONSTRAINT IF EXISTS pk_codigoimposto_codigo;
ALTER TABLE IF EXISTS ONLY tweeks.cliente DROP CONSTRAINT IF EXISTS pk_cliente_id;
ALTER TABLE IF EXISTS ONLY tweeks.classe DROP CONSTRAINT IF EXISTS pk_classe_id;
ALTER TABLE IF EXISTS ONLY tweeks.chave DROP CONSTRAINT IF EXISTS pk_chave_temp;
ALTER TABLE IF EXISTS ONLY tweeks.cambio DROP CONSTRAINT IF EXISTS pk_cambio_id;
ALTER TABLE IF EXISTS ONLY tweeks.caixa DROP CONSTRAINT IF EXISTS pk_caixa_id;
ALTER TABLE IF EXISTS ONLY tweeks.branchmap DROP CONSTRAINT IF EXISTS pk_branchmap_id;
ALTER TABLE IF EXISTS ONLY tweeks.autorizacao DROP CONSTRAINT IF EXISTS pk_autorizacao_uid;
ALTER TABLE IF EXISTS ONLY tweeks.artigo DROP CONSTRAINT IF EXISTS pk_artigo_id;
ALTER TABLE IF EXISTS ONLY tweeks.deposito DROP CONSTRAINT IF EXISTS pk_amortizacao_id;
ALTER TABLE IF EXISTS ONLY tweeks.aloca DROP CONSTRAINT IF EXISTS pk_aloca_id;
ALTER TABLE IF EXISTS ONLY tweeks.acerto DROP CONSTRAINT IF EXISTS pk_acerto_id;
ALTER TABLE IF EXISTS ONLY tweeks.parametrizacao DROP CONSTRAINT IF EXISTS parametrizacao_pkey;
ALTER TABLE IF EXISTS ONLY report.vcolumn DROP CONSTRAINT IF EXISTS pk_vcolumn_source;
ALTER TABLE IF EXISTS ONLY report.var DROP CONSTRAINT IF EXISTS pk_value_key;
ALTER TABLE IF EXISTS ONLY report.talias DROP CONSTRAINT IF EXISTS pk_talias_type;
ALTER TABLE IF EXISTS ONLY report.mask DROP CONSTRAINT IF EXISTS pk_reportformats;
ALTER TABLE IF EXISTS ONLY report.report DROP CONSTRAINT IF EXISTS pk_report_source;
ALTER TABLE IF EXISTS ONLY report.agg DROP CONSTRAINT IF EXISTS pk_agg_key;
ALTER TABLE IF EXISTS ONLY report.parametrized DROP CONSTRAINT IF EXISTS parametrized_pkey;
ALTER TABLE IF EXISTS ONLY report.filter DROP CONSTRAINT IF EXISTS filter_pkey;
ALTER TABLE IF EXISTS ONLY patch.revision DROP CONSTRAINT IF EXISTS uk_ref_math;
ALTER TABLE IF EXISTS ONLY patch.raw DROP CONSTRAINT IF EXISTS pk_raw_id;
ALTER TABLE IF EXISTS ONLY map.constvalue DROP CONSTRAINT IF EXISTS pk_constvalue_name;
ALTER TABLE IF EXISTS ONLY libdom.entryset DROP CONSTRAINT IF EXISTS pk_name;
ALTER TABLE IF EXISTS ONLY libdom.domsync DROP CONSTRAINT IF EXISTS domsync_pkey;
ALTER TABLE IF EXISTS ONLY geoinfo.timezone DROP CONSTRAINT IF EXISTS uk_timezone_timezone;
ALTER TABLE IF EXISTS ONLY geoinfo.subregion DROP CONSTRAINT IF EXISTS uk_subregion_name;
ALTER TABLE IF EXISTS ONLY geoinfo.regionalblocother DROP CONSTRAINT IF EXISTS uk_regionalblocother_otheracronym;
ALTER TABLE IF EXISTS ONLY geoinfo.regionalbloc DROP CONSTRAINT IF EXISTS uk_regionalbloc_name;
ALTER TABLE IF EXISTS ONLY geoinfo.regionalbloc DROP CONSTRAINT IF EXISTS uk_regionalbloc_acronym;
ALTER TABLE IF EXISTS ONLY geoinfo.region DROP CONSTRAINT IF EXISTS uk_region_name;
ALTER TABLE IF EXISTS ONLY geoinfo.language DROP CONSTRAINT IF EXISTS uk_language_name;
ALTER TABLE IF EXISTS ONLY geoinfo.language DROP CONSTRAINT IF EXISTS uk_language_iso3;
ALTER TABLE IF EXISTS ONLY geoinfo.language DROP CONSTRAINT IF EXISTS uk_language_iso2;
ALTER TABLE IF EXISTS ONLY geoinfo.domain DROP CONSTRAINT IF EXISTS uk_domain_code;
ALTER TABLE IF EXISTS ONLY geoinfo.demonym DROP CONSTRAINT IF EXISTS uk_demonym_name;
ALTER TABLE IF EXISTS ONLY geoinfo.dataset DROP CONSTRAINT IF EXISTS uk_dataset_link;
ALTER TABLE IF EXISTS ONLY geoinfo.countrytranslation DROP CONSTRAINT IF EXISTS uk_countrytranslation_country_language;
ALTER TABLE IF EXISTS ONLY geoinfo.countrytopleveldomain DROP CONSTRAINT IF EXISTS uk_countrytopleveldomain_country_domain;
ALTER TABLE IF EXISTS ONLY geoinfo.countrytimezone DROP CONSTRAINT IF EXISTS uk_countrytimezone_country_timezone;
ALTER TABLE IF EXISTS ONLY geoinfo.countryregionalbloc DROP CONSTRAINT IF EXISTS uk_countryregionalbloc_country_regionalblock;
ALTER TABLE IF EXISTS ONLY geoinfo.countrylanguage DROP CONSTRAINT IF EXISTS uk_countrylanguage_country_language;
ALTER TABLE IF EXISTS ONLY geoinfo.countrycurrency DROP CONSTRAINT IF EXISTS uk_countrycurrency_country_currency;
ALTER TABLE IF EXISTS ONLY geoinfo.countryborder DROP CONSTRAINT IF EXISTS uk_countryborder_country_border;
ALTER TABLE IF EXISTS ONLY geoinfo.country DROP CONSTRAINT IF EXISTS uk_country_numericcode;
ALTER TABLE IF EXISTS ONLY geoinfo.country DROP CONSTRAINT IF EXISTS uk_country_nativename;
ALTER TABLE IF EXISTS ONLY geoinfo.country DROP CONSTRAINT IF EXISTS uk_country_iso3;
ALTER TABLE IF EXISTS ONLY geoinfo.country DROP CONSTRAINT IF EXISTS uk_country_iso2;
ALTER TABLE IF EXISTS ONLY geoinfo.country DROP CONSTRAINT IF EXISTS uk_country_country_cioc;
ALTER TABLE IF EXISTS ONLY geoinfo.altspelling DROP CONSTRAINT IF EXISTS uk_altspelling_desc;
ALTER TABLE IF EXISTS ONLY geoinfo.timezone DROP CONSTRAINT IF EXISTS pk_timezone_id;
ALTER TABLE IF EXISTS ONLY geoinfo.subregion DROP CONSTRAINT IF EXISTS pk_subregion_id;
ALTER TABLE IF EXISTS ONLY geoinfo.regionalblocother DROP CONSTRAINT IF EXISTS pk_regionalblocother_id;
ALTER TABLE IF EXISTS ONLY geoinfo.regionalblocname DROP CONSTRAINT IF EXISTS pk_regionalblocname_id;
ALTER TABLE IF EXISTS ONLY geoinfo.regionalbloc DROP CONSTRAINT IF EXISTS pk_regionalbloc_id;
ALTER TABLE IF EXISTS ONLY geoinfo.region DROP CONSTRAINT IF EXISTS pk_region_id;
ALTER TABLE IF EXISTS ONLY geoinfo.language DROP CONSTRAINT IF EXISTS pk_language_id;
ALTER TABLE IF EXISTS ONLY geoinfo.domain DROP CONSTRAINT IF EXISTS pk_domain_id;
ALTER TABLE IF EXISTS ONLY geoinfo.demonym DROP CONSTRAINT IF EXISTS pk_demonym_id;
ALTER TABLE IF EXISTS ONLY geoinfo.dataset DROP CONSTRAINT IF EXISTS pk_dataset_id;
ALTER TABLE IF EXISTS ONLY geoinfo.currency DROP CONSTRAINT IF EXISTS pk_currency_id;
ALTER TABLE IF EXISTS ONLY geoinfo.countrytranslation DROP CONSTRAINT IF EXISTS pk_countrytranslation_id;
ALTER TABLE IF EXISTS ONLY geoinfo.countrytopleveldomain DROP CONSTRAINT IF EXISTS pk_countrytopleveldomain_id;
ALTER TABLE IF EXISTS ONLY geoinfo.countrytimezone DROP CONSTRAINT IF EXISTS pk_countrytimezone_id;
ALTER TABLE IF EXISTS ONLY geoinfo.countryregionalbloc DROP CONSTRAINT IF EXISTS pk_countryregionalbloc_id;
ALTER TABLE IF EXISTS ONLY geoinfo.countrylanguage DROP CONSTRAINT IF EXISTS pk_countrylanguage_id;
ALTER TABLE IF EXISTS ONLY geoinfo.countrycurrency DROP CONSTRAINT IF EXISTS pk_countrycurrency_id;
ALTER TABLE IF EXISTS ONLY geoinfo.countryborder DROP CONSTRAINT IF EXISTS pk_countryborder_id;
ALTER TABLE IF EXISTS ONLY geoinfo.country DROP CONSTRAINT IF EXISTS pk_country_id;
ALTER TABLE IF EXISTS ONLY geoinfo.countrycallcode DROP CONSTRAINT IF EXISTS pk_callcode_idcountrycallcode;
ALTER TABLE IF EXISTS ONLY geoinfo.altspelling DROP CONSTRAINT IF EXISTS pk_altspelling_id;
ALTER TABLE IF EXISTS ONLY cluster.version DROP CONSTRAINT IF EXISTS uk_version_share_cluster;
ALTER TABLE IF EXISTS ONLY cluster.cluster DROP CONSTRAINT IF EXISTS uk_cluster_namespace;
ALTER TABLE IF EXISTS ONLY cluster.version DROP CONSTRAINT IF EXISTS pk_version_uid;
ALTER TABLE IF EXISTS ONLY cluster.tperiod DROP CONSTRAINT IF EXISTS pk_trepeat_id;
ALTER TABLE IF EXISTS ONLY cluster.share DROP CONSTRAINT IF EXISTS pk_share_regclass;
ALTER TABLE IF EXISTS ONLY cluster.resource DROP CONSTRAINT IF EXISTS pk_reference_uid;
ALTER TABLE IF EXISTS ONLY cluster.pull DROP CONSTRAINT IF EXISTS pk_pull_uid;
ALTER TABLE IF EXISTS ONLY cluster.object DROP CONSTRAINT IF EXISTS pk_object_id;
ALTER TABLE IF EXISTS ONLY cluster.filter DROP CONSTRAINT IF EXISTS pk_filter_id;
ALTER TABLE IF EXISTS ONLY cluster.collector DROP CONSTRAINT IF EXISTS pk_collector_uid;
ALTER TABLE IF EXISTS ONLY cluster.sequence DROP CONSTRAINT IF EXISTS pk_cluster_sequence_id;
ALTER TABLE IF EXISTS ONLY cluster.cluster DROP CONSTRAINT IF EXISTS pk_cluster_id;
ALTER TABLE IF EXISTS ONLY cluster.classmap DROP CONSTRAINT IF EXISTS pk_classname;
ALTER TABLE IF EXISTS ONLY cluster.break DROP CONSTRAINT IF EXISTS pk_break_uid;
ALTER TABLE IF EXISTS ONLY cluster.branch DROP CONSTRAINT IF EXISTS pk_branch_uid;
ALTER TABLE IF EXISTS ONLY cluster.auth DROP CONSTRAINT IF EXISTS cluster_auth_uid;
ALTER TABLE IF EXISTS ONLY auth.menu DROP CONSTRAINT IF EXISTS uq_menu_codigo;
ALTER TABLE IF EXISTS ONLY auth.tsexo DROP CONSTRAINT IF EXISTS uk_tsexo_nome;
ALTER TABLE IF EXISTS ONLY auth.tsexo DROP CONSTRAINT IF EXISTS uk_tsexo_codigo;
ALTER TABLE IF EXISTS ONLY auth.perfil DROP CONSTRAINT IF EXISTS uk_perfil_nome;
ALTER TABLE IF EXISTS ONLY auth.colaborador DROP CONSTRAINT IF EXISTS uk_colaborador_nif;
ALTER TABLE IF EXISTS ONLY auth.colaborador DROP CONSTRAINT IF EXISTS uk_colaborador_email;
ALTER TABLE IF EXISTS ONLY auth.session DROP CONSTRAINT IF EXISTS session_pkey;
ALTER TABLE IF EXISTS ONLY auth.tsexo DROP CONSTRAINT IF EXISTS pk_tsexo_id;
ALTER TABLE IF EXISTS ONLY auth.privilegio DROP CONSTRAINT IF EXISTS pk_privilegio_id;
ALTER TABLE IF EXISTS ONLY auth.perfil DROP CONSTRAINT IF EXISTS pk_perfil_id;
ALTER TABLE IF EXISTS ONLY auth.menu DROP CONSTRAINT IF EXISTS pk_menu_id;
ALTER TABLE IF EXISTS ONLY auth.colaborador DROP CONSTRAINT IF EXISTS pk_colaborador_id;
ALTER TABLE IF EXISTS ONLY auth.autenticacao DROP CONSTRAINT IF EXISTS pk_autenticacao_id;
ALTER TABLE IF EXISTS ONLY auth.acesso DROP CONSTRAINT IF EXISTS pk_acesso_id;
ALTER TABLE IF EXISTS tweeks.lancamento ALTER COLUMN lancamento_sequencia DROP DEFAULT;
ALTER TABLE IF EXISTS tweeks.fluxo ALTER COLUMN fluxo_sequencia DROP DEFAULT;
ALTER TABLE IF EXISTS patch.revision ALTER COLUMN seq DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.timezone ALTER COLUMN timezone_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.subregion ALTER COLUMN subregion_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.regionalblocother ALTER COLUMN regionalblocother_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.regionalblocname ALTER COLUMN regionalblocname_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.regionalbloc ALTER COLUMN regionalbloc_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.region ALTER COLUMN region_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.language ALTER COLUMN language_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.domain ALTER COLUMN domain_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.demonym ALTER COLUMN demonym_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.dataset ALTER COLUMN dataset_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.currency ALTER COLUMN currency_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.countrytranslation ALTER COLUMN countrytranslation_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.countrytopleveldomain ALTER COLUMN countrytopleveldomain_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.countrytimezone ALTER COLUMN countrytimezone_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.countryregionalbloc ALTER COLUMN countryregionalbloc_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.countrylanguage ALTER COLUMN countrylanguage_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.countrycurrency ALTER COLUMN countrycurrency_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.countrycallcode ALTER COLUMN countrycallcode_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.countryborder ALTER COLUMN countryborder_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.country ALTER COLUMN country_id DROP DEFAULT;
ALTER TABLE IF EXISTS geoinfo.altspelling ALTER COLUMN altspelling_id DROP DEFAULT;
ALTER TABLE IF EXISTS cluster.pull ALTER COLUMN pull_sequence DROP DEFAULT;
ALTER TABLE IF EXISTS cluster.object ALTER COLUMN object_sseq DROP DEFAULT;
ALTER TABLE IF EXISTS cluster.object ALTER COLUMN object_seq DROP DEFAULT;
ALTER TABLE IF EXISTS cluster.filter ALTER COLUMN filter_sequence DROP DEFAULT;
ALTER TABLE IF EXISTS cluster.filter ALTER COLUMN filter_id DROP DEFAULT;
ALTER TABLE IF EXISTS cluster.collector ALTER COLUMN collector_sequence DROP DEFAULT;
ALTER TABLE IF EXISTS cluster.auth ALTER COLUMN auth_seq DROP DEFAULT;
DROP TABLE IF EXISTS tweeks.unit;
DROP TABLE IF EXISTS tweeks.transferencia;
DROP TABLE IF EXISTS tweeks.trabalha;
DROP TABLE IF EXISTS tweeks.tposto;
DROP TABLE IF EXISTS tweeks.tlink;
DROP TABLE IF EXISTS tweeks.tdocuemto;
DROP TABLE IF EXISTS tweeks.tbranch;
DROP TABLE IF EXISTS tweeks.taplicar;
DROP VIEW IF EXISTS tweeks.stock;
DROP SEQUENCE IF EXISTS tweeks.serie_serie_sequencia_seq;
DROP SEQUENCE IF EXISTS tweeks.seq_cliente_code;
DROP SEQUENCE IF EXISTS tweeks.seq_classe_code;
DROP TABLE IF EXISTS tweeks.retalho;
DROP TABLE IF EXISTS tweeks.repcolumn;
DROP TABLE IF EXISTS tweeks.parametrizacao;
DROP SEQUENCE IF EXISTS tweeks.lancamento_lancamento_sequencia_seq;
DROP TABLE IF EXISTS tweeks.impostovenda;
DROP TABLE IF EXISTS tweeks.imposto;
DROP SEQUENCE IF EXISTS tweeks.fluxo_fluxo_sequencia_seq;
DROP TABLE IF EXISTS tweeks.ean;
DROP TABLE IF EXISTS tweeks.dispoe;
DROP TABLE IF EXISTS tweeks.custoguia;
DROP TABLE IF EXISTS tweeks.codigoimposto;
DROP TABLE IF EXISTS tweeks.chave;
DROP TABLE IF EXISTS tweeks.cambio;
DROP TABLE IF EXISTS tweeks.branchmap;
DROP VIEW IF EXISTS tweeks.branch;
DROP TABLE IF EXISTS tweeks.aloca;
DROP TABLE IF EXISTS tweeks.acerto;
DROP VIEW IF EXISTS tweeks._vserie;
DROP TABLE IF EXISTS tweeks._temp_forece_table;
DROP TABLE IF EXISTS sys.version;
DROP VIEW IF EXISTS report.vreport_venda_artigo;
DROP VIEW IF EXISTS report.vreport_venda;
DROP VIEW IF EXISTS report.vreport_notacredito;
DROP VIEW IF EXISTS report.vreport_imposto;
DROP TABLE IF EXISTS tweeks.tipoimposto;
DROP VIEW IF EXISTS report.vreport_guiasaida;
DROP VIEW IF EXISTS report.vreport_guiaentrada;
DROP TABLE IF EXISTS tweeks.fornecedor;
DROP VIEW IF EXISTS report.vreport_fluxo;
DROP TABLE IF EXISTS tweeks.toperacao;
DROP TABLE IF EXISTS tweeks.fluxo;
DROP VIEW IF EXISTS report.vreport_fatura;
DROP TABLE IF EXISTS tweeks.tserie;
DROP VIEW IF EXISTS report.vreport_conta;
DROP TABLE IF EXISTS tweeks.tlancamento;
DROP TABLE IF EXISTS tweeks.tgrupo;
DROP TABLE IF EXISTS tweeks.lancamento;
DROP VIEW IF EXISTS report.vreport_caixa;
DROP TABLE IF EXISTS tweeks.tpaga;
DROP TABLE IF EXISTS tweeks.deposito;
DROP TABLE IF EXISTS tweeks.cliente;
DROP VIEW IF EXISTS report.vreport_balanco;
DROP TABLE IF EXISTS tweeks.entrada;
DROP TABLE IF EXISTS report.vcolumn;
DROP TABLE IF EXISTS report.var;
DROP TABLE IF EXISTS report.template;
DROP TABLE IF EXISTS report.talias;
DROP TABLE IF EXISTS report.report;
DROP TABLE IF EXISTS report.parametrized;
DROP TABLE IF EXISTS report.mask;
DROP TABLE IF EXISTS report.filter;
DROP TABLE IF EXISTS report.agg;
DROP SEQUENCE IF EXISTS patch.revision_seq_seq;
DROP TABLE IF EXISTS patch.revision;
DROP TABLE IF EXISTS patch.raw;
DROP TABLE IF EXISTS map.constvalue;
DROP TABLE IF EXISTS libdom.domsync;
DROP SEQUENCE IF EXISTS geoinfo.seq_timezone;
DROP TABLE IF EXISTS geoinfo.timezone;
DROP SEQUENCE IF EXISTS geoinfo.seq_subregion;
DROP TABLE IF EXISTS geoinfo.subregion;
DROP SEQUENCE IF EXISTS geoinfo.seq_regionalblocother;
DROP SEQUENCE IF EXISTS geoinfo.seq_regionalblocname;
DROP SEQUENCE IF EXISTS geoinfo.seq_regionalbloc;
DROP SEQUENCE IF EXISTS geoinfo.seq_region;
DROP SEQUENCE IF EXISTS geoinfo.seq_language;
DROP SEQUENCE IF EXISTS geoinfo.seq_domain;
DROP SEQUENCE IF EXISTS geoinfo.seq_demonym;
DROP SEQUENCE IF EXISTS geoinfo.seq_dataset;
DROP SEQUENCE IF EXISTS geoinfo.seq_currency;
DROP SEQUENCE IF EXISTS geoinfo.seq_countrytranslation;
DROP SEQUENCE IF EXISTS geoinfo.seq_countrytopleveldomain;
DROP SEQUENCE IF EXISTS geoinfo.seq_countrytimezone;
DROP SEQUENCE IF EXISTS geoinfo.seq_countryregionalbloc;
DROP SEQUENCE IF EXISTS geoinfo.seq_countrylanguage;
DROP SEQUENCE IF EXISTS geoinfo.seq_countrycurrency;
DROP SEQUENCE IF EXISTS geoinfo.seq_countrycallcode;
DROP SEQUENCE IF EXISTS geoinfo.seq_countryborder;
DROP SEQUENCE IF EXISTS geoinfo.seq_country;
DROP SEQUENCE IF EXISTS geoinfo.seq_altspelling;
DROP TABLE IF EXISTS geoinfo.regionalblocother;
DROP TABLE IF EXISTS geoinfo.regionalblocname;
DROP TABLE IF EXISTS geoinfo.regionalbloc;
DROP TABLE IF EXISTS geoinfo.region;
DROP TABLE IF EXISTS geoinfo.language;
DROP TABLE IF EXISTS geoinfo.domain;
DROP TABLE IF EXISTS geoinfo.demonym;
DROP TABLE IF EXISTS geoinfo.currency;
DROP TABLE IF EXISTS geoinfo.countrytranslation;
DROP TABLE IF EXISTS geoinfo.countrytopleveldomain;
DROP TABLE IF EXISTS geoinfo.countrytimezone;
DROP TABLE IF EXISTS geoinfo.countryregionalbloc;
DROP TABLE IF EXISTS geoinfo.countrylanguage;
DROP TABLE IF EXISTS geoinfo.countrycurrency;
DROP TABLE IF EXISTS geoinfo.countrycallcode;
DROP TABLE IF EXISTS geoinfo.countryborder;
DROP TABLE IF EXISTS geoinfo.country;
DROP TABLE IF EXISTS geoinfo.altspelling;
DROP TABLE IF EXISTS cluster.tperiod;
DROP TABLE IF EXISTS cluster.share;
DROP TABLE IF EXISTS cluster.sequence;
DROP SEQUENCE IF EXISTS cluster.pull_pull_sequence_seq;
DROP TABLE IF EXISTS cluster.pull;
DROP SEQUENCE IF EXISTS cluster.object_object_sseq_seq;
DROP SEQUENCE IF EXISTS cluster.object_object_seq_seq;
DROP TABLE IF EXISTS cluster.ignore;
DROP SEQUENCE IF EXISTS cluster.filter_filter_sequence_seq;
DROP SEQUENCE IF EXISTS cluster.filter_filter_id_seq;
DROP TABLE IF EXISTS cluster.filter;
DROP SEQUENCE IF EXISTS cluster.collector_collector_sequence_seq;
DROP TABLE IF EXISTS cluster.classmap;
DROP TABLE IF EXISTS cluster.break;
DROP SEQUENCE IF EXISTS cluster.auth_auth_seq_seq;
DROP TABLE IF EXISTS cluster.auth;
DROP TABLE IF EXISTS auth.tsexo;
DROP TABLE IF EXISTS auth.session;
DROP TABLE IF EXISTS auth.privilegio;
DROP TABLE IF EXISTS auth.autenticacao;
DROP TABLE IF EXISTS auth.acesso;
DROP OPERATOR IF EXISTS public.|| (lib.result, text);
DROP OPERATOR IF EXISTS public.|| (lib.result, integer);
DROP OPERATOR IF EXISTS public.|| (lib.result, lib.result);
DROP OPERATOR IF EXISTS public.|| (lib.result, jsonb);
DROP OPERATOR IF EXISTS public.? (boolean, jsonb);
DROP OPERATOR IF EXISTS public.? (boolean, text);
DROP OPERATOR IF EXISTS public.- (lib.result, integer);
DROP OPERATOR IF EXISTS public.- (lib.result, text);
DROP AGGREGATE IF EXISTS lib.last(anyelement);
DROP AGGREGATE IF EXISTS lib.first(anyelement);
DROP FUNCTION IF EXISTS tweeks.viewargs_show(OUT param text, OUT key text, OUT value jsonb, OUT text text);
DROP FUNCTION IF EXISTS tweeks.viewargs_sets(jsonb);
DROP FUNCTION IF EXISTS tweeks.viewargs_set(key text, element anyelement);
DROP FUNCTION IF EXISTS tweeks.viewargs_object();
DROP FUNCTION IF EXISTS tweeks.viewarg(argname text);
DROP FUNCTION IF EXISTS tweeks.sets_tipoimposto(args jsonb);
DROP FUNCTION IF EXISTS tweeks.sets_parametrizacao(args jsonb);
DROP FUNCTION IF EXISTS tweeks.sets_lancamento(args jsonb);
DROP FUNCTION IF EXISTS tweeks.main(function regproc, args jsonb, mode text);
DROP FUNCTION IF EXISTS tweeks.load_clusters(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_sets_unit(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_sets_serie(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_sets_guia(args jsonb);
DROP TABLE IF EXISTS tweeks.guia;
DROP FUNCTION IF EXISTS tweeks.funct_sets_fornecedor(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_sets_branch(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_sets_autorizacao_continue(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_sets_autorizacao(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_report_venda_conta(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_report_venda_artigo(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_report_venda(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_report_transacao(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_report_stock_movimentos(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_report_estatistica_venda(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_report_estatistica_posto(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_report_compra_entrada(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_report_caixa(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_transferencia(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_transacao_movimentacao_posto(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_trabalha(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_taxa(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_stock(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_precario(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_posto(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_mesa(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_link_tecla(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_link_associacao(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_item(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_imposto(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_fornecedor(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_espaco(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_entrada(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_ean(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_dispoe(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_conta_nota_credito(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_colaborador(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_classe(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_cambio(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_artigo(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_reg_acerto(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_report_venda(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_reg_vendaimposto(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_reg_venda(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_reg_retalho(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_reg_deposito(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_reg_conta(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_reg_cliente(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_reg_caixa(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_load_posto(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_load_conta_proforma(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_load_conta_dia(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_load_conta_data(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_load_conta_aberto(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_load_colaborador(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_load_cliente(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_load_class(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_load_caixa_auth(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_load_artigo_search(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_load_artigo_extras(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_load_artigo_composto(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_load_artigo(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_generate_key(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_change_conta_proforma(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_change_conta_fechar(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_change_conta_anular(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos_change_caixa_close(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos__sync_conta_amount(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_pos__calc_imposto(arg_artigo_id uuid, montante double precision, args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_unit(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_transferencia(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_trabalha(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_tpaga(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_tipoimposto(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_tespaco(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_stoks(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_serie_available(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_serie(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_posto_status(filters jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_posto_simple(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_posto_closed();
DROP FUNCTION IF EXISTS tweeks.funct_load_posto_by_endereco(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_posto(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_parametrizacao(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_mesa_livre(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_mesa(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_lancamento(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_items_simple(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_guia_data(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_fornecedor_simple(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_fornecedor(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_espaco_simple(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_espaco_migrate(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_espaco_configuracao(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_espaco(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_entrada(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_device_unregistered(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_deposito_data(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_conta_preparacao(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_conta_notacredito(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_conta_by_caixa(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_colaborador(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_cluster_by_branch(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_cliente(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_classe_simple_report(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_classe(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_chave(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_cambio_history(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_cambio_ativo(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_caixa_by_colaborador(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_caixa(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_branch(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_autorizacao(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_artigo_simple(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_artigo_data(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_artigo_base(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_artigo_associar(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_artigo(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_artig_check_nome(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_load_acerto(filter jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_generate_chave(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_venda_preparado(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_venda(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_tipoimposto_estado(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_posto_open(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_posto_estado(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_ordem_classe(parms jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_mesa_estado(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_mesa(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_link_unlink(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_link_switch(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_link_move(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_link_disable(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_item_estado(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_fornecedor_estado(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_espaco_migrate(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_espaco_estado(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_espaco_configuracao(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_espaco(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_conta_preparar(args json);
DROP FUNCTION IF EXISTS tweeks.funct_change_conta_imprimir(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_conta(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_colaborador(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_classe_estado(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_chave_restore(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_autorizacao_closeyear(args jsonb);
DROP FUNCTION IF EXISTS tweeks.funct_change_artigo_estado(args jsonb);
DROP FUNCTION IF EXISTS tweeks._get_venda(arg_venda_id uuid);
DROP TABLE IF EXISTS tweeks.venda;
DROP FUNCTION IF EXISTS tweeks._get_tmovimento(arg_tmovimento_id smallint);
DROP TABLE IF EXISTS tweeks.tmovimento;
DROP FUNCTION IF EXISTS tweeks._get_stock(_artigo_id uuid, _espaco_id uuid);
DROP FUNCTION IF EXISTS tweeks._get_posto(arg_posto_id uuid);
DROP TABLE IF EXISTS tweeks.posto;
DROP FUNCTION IF EXISTS tweeks._get_link(arg_link_id uuid);
DROP TABLE IF EXISTS tweeks.link;
DROP FUNCTION IF EXISTS tweeks._get_item(arg_artigo_item uuid);
DROP FUNCTION IF EXISTS tweeks._get_impostos_taxa(args jsonb);
DROP FUNCTION IF EXISTS tweeks._get_espaco(arg_espaco_id uuid);
DROP FUNCTION IF EXISTS tweeks._get_conta(arg_conta_id uuid);
DROP TABLE IF EXISTS tweeks.conta;
DROP FUNCTION IF EXISTS tweeks._get_classe(arg_classe_id uuid);
DROP TABLE IF EXISTS tweeks.classe;
DROP FUNCTION IF EXISTS tweeks._get_caixa(arg_caixa_id uuid);
DROP TABLE IF EXISTS tweeks.caixa;
DROP FUNCTION IF EXISTS tweeks._get_branch_by_espaco(uuid);
DROP FUNCTION IF EXISTS tweeks._get_branch_by_colaborador(uuid);
DROP FUNCTION IF EXISTS tweeks._get_artigo(arg_atigo_id uuid);
DROP TABLE IF EXISTS tweeks.artigo;
DROP FUNCTION IF EXISTS tweeks.__tg_venda_before_sets();
DROP FUNCTION IF EXISTS tweeks.__tg_venda_before_check();
DROP FUNCTION IF EXISTS tweeks.__tg_use_branch();
DROP FUNCTION IF EXISTS tweeks.__tg_fluxo_on_venda();
DROP FUNCTION IF EXISTS tweeks.__tg_fluxo_on_transferencia();
DROP FUNCTION IF EXISTS tweeks.__tg_fluxo_on_retalho();
DROP FUNCTION IF EXISTS tweeks.__tg_fluxo_on_entrada();
DROP FUNCTION IF EXISTS tweeks.__tg_fluxo_on_acerto();
DROP FUNCTION IF EXISTS tweeks.__tg_create_lancamento();
DROP FUNCTION IF EXISTS tweeks.__tg_conta_after_close();
DROP FUNCTION IF EXISTS tweeks.__tg_before_update_classe();
DROP FUNCTION IF EXISTS tweeks.__sync_branch_map();
DROP FUNCTION IF EXISTS tweeks.__sets_generate_documento(arg_espaco_auth uuid, arg_tserie integer);
DROP FUNCTION IF EXISTS tweeks.__precario(jsonb);
DROP FUNCTION IF EXISTS tweeks.__lote(args jsonb);
DROP FUNCTION IF EXISTS tweeks.__load_cambio_day(arg_espaco_auth uuid, arg_currency_id smallint, arg_cambio_data date, _const map.constant);
DROP FUNCTION IF EXISTS tweeks.__lancamento_regularizacao(args jsonb);
DROP FUNCTION IF EXISTS tweeks.__infinity_loop(_espaco tweeks.espaco);
DROP FUNCTION IF EXISTS tweeks.__get_serie_espaco(arg_espaco_auth uuid, arg_tserie integer);
DROP TABLE IF EXISTS tweeks.serie;
DROP FUNCTION IF EXISTS tweeks.__get_branch(uuid);
DROP TABLE IF EXISTS cluster.branch;
DROP FUNCTION IF EXISTS tweeks.__get_autorizacao(uuid);
DROP TABLE IF EXISTS tweeks.autorizacao;
DROP FUNCTION IF EXISTS tweeks.__generate_retalho_code(brc uuid, user_brc uuid, space_brc uuid);
DROP FUNCTION IF EXISTS tweeks.__generate_posto_chave();
DROP FUNCTION IF EXISTS tweeks.__generate_guia_code(_branch uuid, toperacao_id integer);
DROP FUNCTION IF EXISTS tweeks.__generate_fornecedor_code(_branch uuid);
DROP FUNCTION IF EXISTS tweeks.__generate_cliente_code(colaborador uuid, espaco uuid);
DROP FUNCTION IF EXISTS tweeks.__generate_classe_code(brc uuid, user_brc uuid, space_brc uuid);
DROP FUNCTION IF EXISTS tweeks.__generate_caixa_code(brc uuid, user_brc uuid, space_brc uuid);
DROP FUNCTION IF EXISTS tweeks.__generate_artigo_code(arg_classe_id uuid);
DROP FUNCTION IF EXISTS tweeks.__generate_acerto_code(brc uuid, user_brc uuid, space_brc uuid);
DROP FUNCTION IF EXISTS tweeks.__fluxo_stock(_artigo_uid uuid, _espaco_uid uuid, _classe_uid uuid, _branch uuid);
DROP FUNCTION IF EXISTS tweeks.__fluxo_scan(_artigo_id uuid, _espaco_id uuid, _resume boolean, _branch uuid);
DROP FUNCTION IF EXISTS tweeks.__conta_adjust(arg_cliente_id uuid, arg_conta_id uuid, _const map.constant);
DROP FUNCTION IF EXISTS tweeks.__cluster_filter_branch(share character varying, _object cluster.object, _collector cluster.collector, _cluster cluster.cluster, _origin cluster.cluster);
DROP FUNCTION IF EXISTS tweeks.__check_stock_on_venda(_espaco_auth uuid, _vendas jsonb);
DROP FUNCTION IF EXISTS tweeks.__check_conta_data(_tserie_id integer, _conta_data date, _raise boolean);
DROP FUNCTION IF EXISTS tweeks.__branch_uid(_colaborador_uid uuid, _espaco_uid uuid);
DROP FUNCTION IF EXISTS tweeks.__branch_menu(_branch_uid uuid, _user uuid, _espaco uuid, _force boolean);
DROP TABLE IF EXISTS auth.menu;
DROP FUNCTION IF EXISTS tweeks.__artigo_has_stock(arg_artigo_id uuid, arg_espaco_id uuid, arg_quantidadedebito double precision);
DROP FUNCTION IF EXISTS tweeks.___override_auth_funct_load_menu(args jsonb);
DROP FUNCTION IF EXISTS tweeks.___override_auth_funct_load_grants(args jsonb);
DROP FUNCTION IF EXISTS tweeks.___override_auth_funct_autenticacao(args jsonb);
DROP FUNCTION IF EXISTS rule.transacao_create(arg_espaco_auth uuid, arg_posto_id uuid, arg_toperacao_id smallint, arg_tmovimento_id smallint, arg_colaborador_id integer, arg_transacao_montante double precision, arg_transacao_documento character varying, arg_transacao_referencia jsonb, arg_transacao_zera boolean, arg_transacao_observacao character varying);
DROP TABLE IF EXISTS tweeks.transacao;
DROP FUNCTION IF EXISTS rule.tipoimposto_referencia(arg_tipoimposto_id uuid);
DROP FUNCTION IF EXISTS rule.tg_venda_after_update_create_or_cansel_movimento();
DROP FUNCTION IF EXISTS rule.tg_venda_after_update_adjust_conta_montante();
DROP FUNCTION IF EXISTS rule.tg_venda_after_update_adjust_agrega_estado();
DROP FUNCTION IF EXISTS rule.tg_venda_after_insert_create_movimento();
DROP FUNCTION IF EXISTS rule.tg_transacao_after_insert_adjust_posto_montante();
DROP FUNCTION IF EXISTS rule.tg_stock_before_insert_or_update_check_quantidade();
DROP FUNCTION IF EXISTS rule.tg_stock_after_update();
DROP FUNCTION IF EXISTS rule.tg_retalho_after_insert_create_movimento();
DROP FUNCTION IF EXISTS rule.tg_conta_after_update_adjust_venda_estado();
DROP FUNCTION IF EXISTS rule.tg_caixa_after_updade_fechar_posto();
DROP FUNCTION IF EXISTS rule.tg_caixa_after_insert_abrir_posto();
DROP FUNCTION IF EXISTS rule.tg_amortizacao_afeter_insert_syncronize_montante();
DROP FUNCTION IF EXISTS rule.taxa_retirar_percentagem_adicionada(arg_value double precision, arg_percentagem double precision);
DROP FUNCTION IF EXISTS rule.taxa_espaco(_taxa tweeks.taxa, _const map.constant, arg_espaco_auth uuid);
DROP TABLE IF EXISTS tweeks.taxa;
DROP FUNCTION IF EXISTS rule.movimento_revert(arg_espaco_auth uuid, arg_colaborador_id uuid, arg_toperacao_id smallint, arg_movimento_tmovimento_id smallint, arg_referencia_key character varying, arg_referencia_value text, arg_movimento_estado smallint, arg_movimento_observacao character varying);
DROP FUNCTION IF EXISTS rule.movimento_create(arg_espaco_auth uuid, arg_colaborador_id uuid, arg_stock_id uuid, arg_toperacao_id smallint, arg_movimento_referencia jsonb, arg_movimento_quantidade double precision, arg_tmovimento_id smallint, arg_movimento_quantidadefinal double precision, arg_movimento_data date, arg_movimento_documento character varying);
DROP TABLE IF EXISTS tweeks.movimento;
DROP FUNCTION IF EXISTS rule.espaco_get_serializer(arg_espaco_id uuid);
DROP TABLE IF EXISTS tweeks.espaco;
DROP FUNCTION IF EXISTS tweeks.__space_branch_level(_espaco_id uuid);
DROP FUNCTION IF EXISTS rule.espaco_get_parent(arg_espaco_id uuid);
DROP FUNCTION IF EXISTS rule.espaco_get_childrens_static(arg_espaco_id uuid);
DROP FUNCTION IF EXISTS rule.espaco_get_childrens(arg_espaco_id uuid);
DROP FUNCTION IF EXISTS rule.constant();
DROP FUNCTION IF EXISTS rule.classe_referencia(arg_classe_id uuid);
DROP FUNCTION IF EXISTS rule.calculate_cost(arg_precario_quantidade double precision, arg_precario_custo double precision, arg_quantidade double precision);
DROP FUNCTION IF EXISTS rule.artigo_referencia(arg_artigo_id uuid);
DROP FUNCTION IF EXISTS rule.artigo_has_open_account(arg_artigo_id uuid);
DROP FUNCTION IF EXISTS rule.artigo_generate_nextcodigo(arg_classe_id uuid);
DROP FUNCTION IF EXISTS report.vreport_imposto_financas(args jsonb);
DROP FUNCTION IF EXISTS report.vcolumns(args jsonb);
DROP FUNCTION IF EXISTS report.vars(args jsonb);
DROP FUNCTION IF EXISTS report.sync(regclass, name text, priority integer, active boolean);
DROP FUNCTION IF EXISTS report.source_map(regclass);
DROP FUNCTION IF EXISTS report.source_filter(args jsonb);
DROP FUNCTION IF EXISTS report.sets_parametrized_report(args jsonb);
DROP FUNCTION IF EXISTS report.reduce_name(text);
DROP FUNCTION IF EXISTS report.funct_load_report_parametrized_filter(args jsonb);
DROP FUNCTION IF EXISTS report.funct_load_report_parametrized(args jsonb);
DROP FUNCTION IF EXISTS report.eval(expression text, args anyelement);
DROP FUNCTION IF EXISTS report.engine(report jsonb);
DROP FUNCTION IF EXISTS report.configs(args jsonb);
DROP FUNCTION IF EXISTS report.columns(regclass);
DROP FUNCTION IF EXISTS report.__template_of(ref jsonb, colconfigs jsonb);
DROP FUNCTION IF EXISTS report.__rownumber_of(text);
DROP FUNCTION IF EXISTS report.__prepare_where(report jsonb);
DROP FUNCTION IF EXISTS report.__prepare_wf(report jsonb);
DROP FUNCTION IF EXISTS report.__prepare_row_number(report jsonb);
DROP FUNCTION IF EXISTS report.__prepare_order(report jsonb, columns jsonb[], aggregates jsonb[]);
DROP FUNCTION IF EXISTS report.__prepare_column(report jsonb);
DROP FUNCTION IF EXISTS report.__prepare_aggregate(report jsonb);
DROP FUNCTION IF EXISTS report.__prepare(report jsonb);
DROP FUNCTION IF EXISTS report.__mask_reduce(anyelement, type text, format text);
DROP FUNCTION IF EXISTS report.__mask(anyelement, type text, format text, representation boolean);
DROP FUNCTION IF EXISTS report.__formattable();
DROP FUNCTION IF EXISTS report.____tg_report_format();
DROP FUNCTION IF EXISTS report."3x"(report jsonb);
DROP FUNCTION IF EXISTS patch.revision(args jsonb);
DROP FUNCTION IF EXISTS patch.ref(file character varying, identifier character varying);
DROP FUNCTION IF EXISTS patch.raw_of(text text);
DROP FUNCTION IF EXISTS patch.create_raw(text text);
DROP FUNCTION IF EXISTS map.funct_load_constvalue(filter jsonb);
DROP FUNCTION IF EXISTS map.funct_change_constvalue(arg jsonb);
DROP FUNCTION IF EXISTS map.describe(VARIADIC name character varying[]);
DROP FUNCTION IF EXISTS map.constants(name character varying);
DROP FUNCTION IF EXISTS map.constantdrop(arg_constant_name name, arg_dropforce boolean);
DROP FUNCTION IF EXISTS map.constant_rename(name name, newname name, force boolean);
DROP FUNCTION IF EXISTS map.constant_list(name character varying);
DROP FUNCTION IF EXISTS map.constant_list(VARIADIC name character varying[]);
DROP FUNCTION IF EXISTS map.constant(name name, type regtype, val anyelement, description character varying, editable boolean, comment character varying);
DROP FUNCTION IF EXISTS map.as_json();
DROP FUNCTION IF EXISTS map."array"(anyelement, VARIADIC name name[]);
DROP FUNCTION IF EXISTS map.any_equal(anyelement, VARIADIC name name[]);
DROP FUNCTION IF EXISTS libdom.trigger_sync_entry();
DROP FUNCTION IF EXISTS libdom.trigger_sync_domsync();
DROP FUNCTION IF EXISTS libdom.sync_entry(name name, classtype regtype);
DROP FUNCTION IF EXISTS libdom.sync_drop(name name, classtype regtype);
DROP FUNCTION IF EXISTS libdom.set(name name, value character varying, label character varying, domain character varying, force boolean);
DROP FUNCTION IF EXISTS libdom.rebuild(clean boolean);
DROP FUNCTION IF EXISTS libdom.prefix(VARIADIC prefix character varying[]);
DROP TABLE IF EXISTS libdom.entryset;
DROP FUNCTION IF EXISTS libdom.get(arg_name name);
DROP FUNCTION IF EXISTS libdom.exports(schema_name character varying, VARIADIC name character varying[]);
DROP FUNCTION IF EXISTS libdom.entry_list(args jsonb);
DROP FUNCTION IF EXISTS libdom.entry_drop(arg_name name, arg_dropforce boolean);
DROP FUNCTION IF EXISTS libdom.entry(name name, type regtype, val anyelement, domain character varying, label character varying, editable boolean, comment character varying, force boolean);
DROP FUNCTION IF EXISTS libdom.domsync(classname character varying, columnname character varying, domain character varying);
DROP FUNCTION IF EXISTS libdom.domset(_class character varying, _column character varying, _domain character varying, _comment character varying);
DROP FUNCTION IF EXISTS libdom.domain_of(domain character varying, value text);
DROP FUNCTION IF EXISTS libdom.domain_of(name name);
DROP FUNCTION IF EXISTS libdom.domain_document(VARIADIC prefix character varying[]);
DROP FUNCTION IF EXISTS libdom.domain(VARIADIC prefix character varying[]);
DROP FUNCTION IF EXISTS libdom.describe(VARIADIC prefix character varying[]);
DROP FUNCTION IF EXISTS libdom.constant_document(VARIADIC prefix character varying[]);
DROP FUNCTION IF EXISTS libdom.constant(VARIADIC prefix character varying[]);
DROP FUNCTION IF EXISTS libdom.columns(regclass);
DROP FUNCTION IF EXISTS libdom.api_load_entryset(args jsonb);
DROP FUNCTION IF EXISTS libdom.api_change_entryset(args jsonb);
DROP FUNCTION IF EXISTS lib."when"(boolean, _then anyelement, _else anyelement);
DROP FUNCTION IF EXISTS lib.version();
DROP FUNCTION IF EXISTS lib.swith(VARIADIC list anyarray);
DROP FUNCTION IF EXISTS lib.switch(anyelement, VARIADIC list anyarray);
DROP FUNCTION IF EXISTS lib.str_nospace(text);
DROP FUNCTION IF EXISTS lib.str_is_numeric_sequence(argment text);
DROP FUNCTION IF EXISTS lib.sets_up(_row anyelement, replacer jsonb, defaults text[], ref jsonb, t_where text, "with" jsonb);
DROP FUNCTION IF EXISTS lib.sets_ref_clean("table" regclass, document jsonb);
DROP FUNCTION IF EXISTS lib.sets_ref("table" regclass, document jsonb);
DROP FUNCTION IF EXISTS lib.sets_ref(jsonb, name[]);
DROP FUNCTION IF EXISTS lib.sets_ref(_record anyelement);
DROP FUNCTION IF EXISTS lib.sets_pks_array(regclass);
DROP FUNCTION IF EXISTS lib.sets_pks(regclass);
DROP FUNCTION IF EXISTS lib.sets_in(_row anyelement, replacer jsonb, "with" jsonb);
DROP FUNCTION IF EXISTS lib.sets_doc_up(regclass, doc jsonb, defaults text[], ref jsonb, t_where text, "with" jsonb);
DROP FUNCTION IF EXISTS lib.sets_doc_in(regclass, doc jsonb, "with" jsonb);
DROP FUNCTION IF EXISTS lib.sets_doc(regclass, doc jsonb, defaults name[], ref jsonb, t_where text, "with" jsonb);
DROP FUNCTION IF EXISTS lib.sets_defaults(regclass, replacer jsonb);
DROP FUNCTION IF EXISTS lib.sets_defaults(anyelement, replacer jsonb);
DROP FUNCTION IF EXISTS lib.sets(_row anyelement, replacer jsonb, defaults text[], ref jsonb, t_where text, "with" jsonb);
DROP FUNCTION IF EXISTS lib.result_true(message text);
DROP FUNCTION IF EXISTS lib.result_true(content jsonb);
DROP FUNCTION IF EXISTS lib.result_true();
DROP FUNCTION IF EXISTS lib.result_remove(lib.result, text);
DROP FUNCTION IF EXISTS lib.result_remove(lib.result, integer);
DROP FUNCTION IF EXISTS lib.result_false(message text);
DROP FUNCTION IF EXISTS lib.result_false(content jsonb);
DROP FUNCTION IF EXISTS lib.result_exception(text text, errcode character varying, hint text, detail text);
DROP FUNCTION IF EXISTS lib.result_concat(lib.result, jsonb);
DROP FUNCTION IF EXISTS lib.result_concat(lib.result, lib.result);
DROP FUNCTION IF EXISTS lib.result_catch(errocode character varying, message text, hint text, detail text, context text);
DROP FUNCTION IF EXISTS lib.result_catch(message text);
DROP FUNCTION IF EXISTS lib.result(result boolean, text text);
DROP FUNCTION IF EXISTS lib.result(result boolean, message jsonb);
DROP FUNCTION IF EXISTS lib.result(result boolean);
DROP FUNCTION IF EXISTS lib.res_true(data jsonb, message text, level integer);
DROP FUNCTION IF EXISTS lib.res_false(message text, error jsonb, level integer);
DROP FUNCTION IF EXISTS lib.res_exception(errocode character varying, message text, hint text, detail text, context text, user_message text, level integer);
DROP FUNCTION IF EXISTS lib.res(result boolean, message text, data jsonb, error jsonb, level integer);
DROP FUNCTION IF EXISTS lib.represent(number bigint, base text, length integer, lpad character);
DROP FUNCTION IF EXISTS lib.money(moneyvalue anyelement);
DROP FUNCTION IF EXISTS lib.jsonb_values_as(document jsonb, VARIADIC keys text[]);
DROP FUNCTION IF EXISTS lib.jsonb_values(document jsonb, VARIADIC keys text[]);
DROP FUNCTION IF EXISTS lib.jsonb_values(document jsonb, VARIADIC indexes integer[]);
DROP FUNCTION IF EXISTS lib.jsonb_values(element anyelement, VARIADIC keys text[]);
DROP FUNCTION IF EXISTS lib.jsonb_values(element anyelement, VARIADIC indexes integer[]);
DROP FUNCTION IF EXISTS lib.jsonb_object_length(object jsonb);
DROP FUNCTION IF EXISTS lib.jsonb_iterate_cascade(document jsonb);
DROP FUNCTION IF EXISTS lib.jsonb_iterate(document jsonb);
DROP FUNCTION IF EXISTS lib.jsonb_concat(VARIADIC jsonb[]);
DROP FUNCTION IF EXISTS lib.is_numeric(argment text);
DROP FUNCTION IF EXISTS lib.is_integer(argment text);
DROP FUNCTION IF EXISTS lib.is_bigint(argment text);
DROP FUNCTION IF EXISTS lib.initials(name character varying);
DROP FUNCTION IF EXISTS lib.in_year(interval);
DROP FUNCTION IF EXISTS lib.in_week(interval);
DROP FUNCTION IF EXISTS lib.in_second(interval);
DROP FUNCTION IF EXISTS lib.in_month(interval);
DROP FUNCTION IF EXISTS lib.in_minute(interval);
DROP FUNCTION IF EXISTS lib.in_hour(interval);
DROP FUNCTION IF EXISTS lib.in_day(interval);
DROP FUNCTION IF EXISTS lib.format(jsonb);
DROP FUNCTION IF EXISTS lib."extract"(jsonb);
DROP FUNCTION IF EXISTS lib.exception(errocode character varying, text text, hint text, detail text);
DROP FUNCTION IF EXISTS lib.eval(expression text);
DROP FUNCTION IF EXISTS lib.each(jsonb, force boolean);
DROP FUNCTION IF EXISTS lib.duplicates(list jsonb, maps jsonb, aggregate boolean);
DROP FUNCTION IF EXISTS lib.dump_functions(VARIADIC schemas text[]);
DROP FUNCTION IF EXISTS lib.dset_random_text(elements character varying, length integer);
DROP FUNCTION IF EXISTS lib.dset_random_text(length integer);
DROP FUNCTION IF EXISTS lib.dset_random_serial(length integer);
DROP FUNCTION IF EXISTS lib.dset_random_nexttimestamptz(min timestamp with time zone, max timestamp with time zone);
DROP FUNCTION IF EXISTS lib.dset_random_nextdate(arg_datainicio date, arg_datafim date);
DROP FUNCTION IF EXISTS lib.dset_random_next(min anyelement, max anyelement);
DROP FUNCTION IF EXISTS lib.dset_random_next(anyelement);
DROP FUNCTION IF EXISTS lib.dset_random_name(min integer, max integer);
DROP FUNCTION IF EXISTS lib.dset_random_element(elements anyarray);
DROP FUNCTION IF EXISTS lib.combinator(items text[], start integer, parent text[], indexs integer[], size integer);
DROP FUNCTION IF EXISTS lib.coincidences_likes(arguments_left text[], arguments_right text[], option jsonb);
DROP FUNCTION IF EXISTS lib.coincidences(arguments_left anyarray, arguments_right anyarray, option jsonb);
DROP FUNCTION IF EXISTS lib.array_min_element(arr anyarray, element anyelement);
DROP FUNCTION IF EXISTS lib.array_max_element(arr anyarray, element anyelement);
DROP FUNCTION IF EXISTS lib.array_delete(list anyarray, start integer, elements integer);
DROP FUNCTION IF EXISTS lib.array_delete(list anyarray, element integer);
DROP FUNCTION IF EXISTS lib.agg_last(anyelement, anyelement);
DROP FUNCTION IF EXISTS lib.agg_first(anyelement, anyelement);
DROP FUNCTION IF EXISTS lib.age(timestamp with time zone);
DROP FUNCTION IF EXISTS geoinfo.dataset_use(arg_dataset_link character varying);
DROP FUNCTION IF EXISTS geoinfo.dataset_update(arg_dataset_link character varying, arg_dataset_version character varying, arg_dataset_data jsonb);
DROP FUNCTION IF EXISTS geoinfo.dataset_setup();
DROP FUNCTION IF EXISTS geoinfo.dataset_populate(arg_dataset_link character varying, arg_dataset_version character varying, arg_dataset_data jsonb);
DROP FUNCTION IF EXISTS geoinfo.dataset(arg_dataset_link character);
DROP TABLE IF EXISTS geoinfo.dataset;
DROP FUNCTION IF EXISTS geoinfo.dataset();
DROP FUNCTION IF EXISTS cluster.unlink_cluster(args jsonb);
DROP FUNCTION IF EXISTS cluster.switch_remote_connection(args jsonb);
DROP FUNCTION IF EXISTS cluster.status(args jsonb);
DROP FUNCTION IF EXISTS cluster.sets_resources_downloaded(args jsonb);
DROP FUNCTION IF EXISTS cluster.sets_resources_downloaded(args json);
DROP FUNCTION IF EXISTS cluster.sets_clusters_admin(args jsonb);
DROP FUNCTION IF EXISTS cluster.sets_cluster_tree_position(args jsonb);
DROP FUNCTION IF EXISTS cluster.sets_cluster_remote(args jsonb);
DROP FUNCTION IF EXISTS cluster.sets_cluster_machine_id(args jsonb);
DROP FUNCTION IF EXISTS cluster.sets_cluster_license(args jsonb);
DROP FUNCTION IF EXISTS cluster.sets_cluster_configs(args jsonb);
DROP FUNCTION IF EXISTS cluster.reduce(VARIADIC jsonb[]);
DROP FUNCTION IF EXISTS cluster.push(args jsonb);
DROP FUNCTION IF EXISTS cluster.pull(args jsonb);
DROP FUNCTION IF EXISTS cluster.object_filter(share character varying, _object cluster.object, _collector cluster.collector, _req cluster.cluster, _origin cluster.cluster);
DROP FUNCTION IF EXISTS cluster.next(name character varying, sub character varying, zero_base boolean, steep integer, lpad integer, lpad_char character, exist text, exist_limit integer);
DROP FUNCTION IF EXISTS cluster.load_resources_pendents(args jsonb);
DROP FUNCTION IF EXISTS cluster.load_paths(args jsonb);
DROP FUNCTION IF EXISTS cluster.load_clusters_local_as_remotes(args jsonb);
DROP FUNCTION IF EXISTS cluster.load_clusters_configs_to_child(args jsonb);
DROP FUNCTION IF EXISTS cluster.load_clusters(args jsonb);
DROP FUNCTION IF EXISTS cluster.load_cluster_by_namespace(namespace character varying);
DROP FUNCTION IF EXISTS cluster.funct_reg_acesso(args jsonb);
DROP FUNCTION IF EXISTS cluster.funct_load_configs();
DROP FUNCTION IF EXISTS cluster.define_namespace(args jsonb);
DROP PROCEDURE IF EXISTS cluster.declare_filter(IN regnamespace, IN name character varying, IN share regclass, IN describe character varying);
DROP FUNCTION IF EXISTS cluster.create_resource(args jsonb);
DROP TABLE IF EXISTS cluster.resource;
DROP FUNCTION IF EXISTS cluster.commit(args jsonb);
DROP FUNCTION IF EXISTS cluster.change(jsonb, VARIADIC keys text[]);
DROP FUNCTION IF EXISTS cluster.can_send_revision(args jsonb);
DROP FUNCTION IF EXISTS cluster.can_send_object(_object cluster.object, _collector cluster.collector, _origin cluster.cluster, _request cluster.cluster, _local cluster.cluster, _master cluster.cluster, _child cluster.cluster, _const map.constant);
DROP FUNCTION IF EXISTS map.constant();
DROP FUNCTION IF EXISTS cluster.add(args jsonb);
DROP FUNCTION IF EXISTS cluster.accept_revision(args jsonb);
DROP FUNCTION IF EXISTS cluster.accept_remote_cluster(args jsonb);
DROP FUNCTION IF EXISTS cluster._get_version_local(regclass, increment boolean);
DROP FUNCTION IF EXISTS cluster._get_cluster_master();
DROP FUNCTION IF EXISTS cluster._get_cluster_local(increment boolean, try integer);
DROP FUNCTION IF EXISTS cluster._get_cluster_child(identifier character varying);
DROP FUNCTION IF EXISTS cluster._get_cluster(character varying);
DROP TABLE IF EXISTS cluster.cluster;
DROP FUNCTION IF EXISTS cluster._cluster_accept_child(args jsonb);
DROP FUNCTION IF EXISTS cluster.__user_replication();
DROP FUNCTION IF EXISTS cluster.__user_map();
DROP TABLE IF EXISTS cluster.users;
DROP FUNCTION IF EXISTS cluster.__user_default();
DROP FUNCTION IF EXISTS cluster.__tg_version_commit();
DROP FUNCTION IF EXISTS cluster.__tg_version_add_when_update();
DROP FUNCTION IF EXISTS cluster.__tg_version_add_when_insert();
DROP FUNCTION IF EXISTS cluster.__tg_share_truncate();
DROP FUNCTION IF EXISTS cluster.__tg_share_map();
DROP FUNCTION IF EXISTS cluster.__tg_share_guard_upgrade();
DROP FUNCTION IF EXISTS cluster.__tg_share_check();
DROP FUNCTION IF EXISTS cluster.__tg_before_create_filter();
DROP FUNCTION IF EXISTS cluster.__rows(VARIADIC regclass[]);
DROP FUNCTION IF EXISTS cluster.__pull(args jsonb);
DROP TABLE IF EXISTS cluster.object;
DROP FUNCTION IF EXISTS cluster.__pks(regclass);
DROP FUNCTION IF EXISTS cluster.__is_sub_path(base text, child_path text);
DROP FUNCTION IF EXISTS cluster.__is_replication();
DROP FUNCTION IF EXISTS cluster.__get(regclass, jsonb);
DROP FUNCTION IF EXISTS cluster.__generate_cluster_code();
DROP FUNCTION IF EXISTS cluster.__format_proc(regproc);
DROP FUNCTION IF EXISTS cluster.__format(regclass);
DROP FUNCTION IF EXISTS cluster.__create_object_version(regclass);
DROP TABLE IF EXISTS cluster.version;
DROP FUNCTION IF EXISTS cluster.__create_identifier();
DROP FUNCTION IF EXISTS cluster.__create_api();
DROP FUNCTION IF EXISTS cluster.__collect_change(regclass, _change jsonb, _old jsonb, _operation character, _ref jsonb, _force boolean);
DROP FUNCTION IF EXISTS cluster.__add(_regclass regclass);
DROP TABLE IF EXISTS cluster.collector;
DROP FUNCTION IF EXISTS cluster.__transaction_uid();
DROP FUNCTION IF EXISTS auth.funct_reg_trabalha(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_reg_privilegio(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_reg_perfil(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_reg_colaborador(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_reg_acesso(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_load_menu_cascade(filter jsonb);
DROP FUNCTION IF EXISTS auth.funct_load_menu(filter jsonb);
DROP FUNCTION IF EXISTS auth.funct_load_grants(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_load_colaborador_token_restore(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_load_colaborador_simple(filter jsonb);
DROP FUNCTION IF EXISTS auth.funct_load_colaborador_by_token(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_load_colaborador_any_menu(filter jsonb);
DROP FUNCTION IF EXISTS auth.funct_load_colaborador_all_menu(filter jsonb);
DROP FUNCTION IF EXISTS auth.funct_load_colaborador(filter jsonb);
DROP FUNCTION IF EXISTS auth.funct_change_perfil(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_change_colaborador_token_ativate(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_change_colaborador_token_acesso(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_change_colaborador_senha(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_change_colaborador_pin(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_change_colaborador_estado_disable(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_change_colaborador_accesso_reativar(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_change_colaborador_accesso_disable(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_change_colaborador(args jsonb);
DROP FUNCTION IF EXISTS auth.funct_autenticacao_logoff(arg jsonb);
DROP FUNCTION IF EXISTS auth.funct_autenticacao(args jsonb);
DROP FUNCTION IF EXISTS auth._menu_load_structure(filter jsonb);
DROP FUNCTION IF EXISTS auth._menu_create_set_up();
DROP FUNCTION IF EXISTS auth._menu_create(arg_menu_codigo character varying, arg_menu_nome character varying, arg_menu_menu_codigo character varying, arg_menu_link character varying, arg_menu_icon character varying);
DROP FUNCTION IF EXISTS auth._get_perfil(arg_perfil_id uuid);
DROP TABLE IF EXISTS auth.perfil;
DROP FUNCTION IF EXISTS lib.str_normalize(text text);
DROP FUNCTION IF EXISTS lib.str_is_normalized(text);
DROP FUNCTION IF EXISTS auth._get_colaborador(arg_colaborador_id uuid);
DROP FUNCTION IF EXISTS auth._encrypt(word text);
DROP FUNCTION IF EXISTS auth._colaborador_token_encrypt(_colaborador auth.colaborador);
DROP TABLE IF EXISTS auth.colaborador;
DROP FUNCTION IF EXISTS map.get(arg_constant_name name);
DROP FUNCTION IF EXISTS lib.to_uuid(anyelement);
DROP FUNCTION IF EXISTS auth._colaborador_generate_senha_token();
DROP FUNCTION IF EXISTS auth._colaborador_generate_pin_token();
DROP FUNCTION IF EXISTS auth._colaborador_estado_desc(arg_colaborador_estado smallint);
DROP FUNCTION IF EXISTS auth._colaborador_accesso_desc(arg_colaborador_acesso smallint);
DROP FUNCTION IF EXISTS auth._autenticacao_chave_generate();
DROP TYPE IF EXISTS map.constant;
DROP TYPE IF EXISTS libdom.domain;
DROP TYPE IF EXISTS libdom.constant;
DROP TYPE IF EXISTS lib.result;
DROP TYPE IF EXISTS lib.res;
DROP TYPE IF EXISTS lib.exception;
DROP EXTENSION IF EXISTS "uuid-ossp";
DROP EXTENSION IF EXISTS unaccent;
DROP SCHEMA IF EXISTS tweeks;
DROP SCHEMA IF EXISTS sys;
DROP SCHEMA IF EXISTS rule;
DROP SCHEMA IF EXISTS report;
DROP SCHEMA IF EXISTS patch;
DROP SCHEMA IF EXISTS map;
DROP SCHEMA IF EXISTS libdom;
DROP SCHEMA IF EXISTS lib;
DROP SCHEMA IF EXISTS geoinfo;
DROP SCHEMA IF EXISTS cluster;
DROP SCHEMA IF EXISTS auth;
--
-- TOC entry 9 (class 2615 OID 16405)
-- Name: auth; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA auth;


--
-- TOC entry 10 (class 2615 OID 16406)
-- Name: cluster; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA cluster;


--
-- TOC entry 12 (class 2615 OID 16407)
-- Name: geoinfo; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA geoinfo;


--
-- TOC entry 11 (class 2615 OID 16408)
-- Name: lib; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA lib;


--
-- TOC entry 18 (class 2615 OID 19638)
-- Name: libdom; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA libdom;


--
-- TOC entry 13 (class 2615 OID 16409)
-- Name: map; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA map;


--
-- TOC entry 17 (class 2615 OID 19452)
-- Name: patch; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA patch;


--
-- TOC entry 7 (class 2615 OID 16410)
-- Name: report; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA report;


--
-- TOC entry 15 (class 2615 OID 16411)
-- Name: rule; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA rule;


--
-- TOC entry 8 (class 2615 OID 16412)
-- Name: sys; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA sys;


--
-- TOC entry 16 (class 2615 OID 16413)
-- Name: tweeks; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA tweeks;


--
-- TOC entry 2 (class 3079 OID 16387)
-- Name: unaccent; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS unaccent WITH SCHEMA public;


--
-- TOC entry 5536 (class 0 OID 0)
-- Dependencies: 2
-- Name: EXTENSION unaccent; Type: COMMENT; Schema: -; Owner: -
--

COMMENT ON EXTENSION unaccent IS 'text search dictionary that removes accents';


--
-- TOC entry 3 (class 3079 OID 16394)
-- Name: uuid-ossp; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS "uuid-ossp" WITH SCHEMA public;


--
-- TOC entry 5537 (class 0 OID 0)
-- Dependencies: 3
-- Name: EXTENSION "uuid-ossp"; Type: COMMENT; Schema: -; Owner: -
--

COMMENT ON EXTENSION "uuid-ossp" IS 'generate universally unique identifiers (UUIDs)';


--
-- TOC entry 1536 (class 1247 OID 16416)
-- Name: exception; Type: TYPE; Schema: lib; Owner: -
--

CREATE TYPE lib.exception AS (
	errcode character varying,
	message text,
	hint text,
	detail text,
	context text,
	exception boolean
);


--
-- TOC entry 1539 (class 1247 OID 16419)
-- Name: res; Type: TYPE; Schema: lib; Owner: -
--

CREATE TYPE lib.res AS (
	result boolean,
	message text,
	data jsonb,
	error jsonb,
	level integer
);


--
-- TOC entry 1542 (class 1247 OID 16422)
-- Name: result; Type: TYPE; Schema: lib; Owner: -
--

CREATE TYPE lib.result AS (
	result boolean,
	message jsonb
);


--
-- TOC entry 1836 (class 1247 OID 19641)
-- Name: constant; Type: TYPE; Schema: libdom; Owner: -
--

CREATE TYPE libdom.constant AS (
	report_filter_state_active smallint,
	report_filter_state_fechado smallint,
	report_filter_filter_valuemode_samevalue smallint,
	report_filter_filter_valuemode_dateprocess smallint,
	report_filter_filter_valuemode_daterelative smallint,
	report_filter_filter_valuemode_ask smallint,
	report_filter_filter_valuemode_askallways smallint
);


--
-- TOC entry 1839 (class 1247 OID 19644)
-- Name: domain; Type: TYPE; Schema: libdom; Owner: -
--

CREATE TYPE libdom.domain AS (
	report_filter_state_active text,
	report_filter_state_fechado text,
	report_filter_filter_valuemode_samevalue text,
	report_filter_filter_valuemode_dateprocess text,
	report_filter_filter_valuemode_daterelative text,
	report_filter_filter_valuemode_ask text,
	report_filter_filter_valuemode_askallways text
);


--
-- TOC entry 1545 (class 1247 OID 16425)
-- Name: constant; Type: TYPE; Schema: map; Owner: -
--

CREATE TYPE map.constant AS (
	acesso_estado_fechado smallint,
	colaborador_tipo_system smallint,
	colaborador_estado_ativo smallint,
	perfil_estado_fechado smallint,
	menu_estado_ativo smallint,
	perfil_estado_ativo smallint,
	privilegio_estado_ativo smallint,
	privilegio_estado_fechado smallint,
	colaborador_tipo_user_master smallint,
	acesso_estado_ativo smallint,
	colaborador_estado_fechado smallint,
	colaborador_accesso_ativo smallint,
	autenticacao_estado_ativo smallint,
	autenticacao_estado_fechado smallint,
	colaborador_accesso_fechado smallint,
	menu_maxchildren smallint,
	menu_estado_fechado smallint,
	colaborador_tipo_user smallint,
	colaborador_token_limit interval,
	colaborador_token_length smallint,
	colaborador_accesso_pendente smallint,
	autenticacao_chave_length smallint,
	colaborador_system_data uuid,
	colaborador_system_support uuid,
	tespaco_venda smallint,
	tespaco_armazem smallint,
	classe_estado_ativo smallint,
	classe_estado_fechado smallint,
	espaco_estado_ativo smallint,
	espaco_estado_fechado smallint,
	artigo_estado_ativo smallint,
	artigo_estado_fechado smallint,
	item_estado_ativo smallint,
	dispoe_estado_ativo smallint,
	dispoe_estado_fechado smallint,
	stock_estado_ativo smallint,
	stock_estado_fechado smallint,
	entrada_estado_ativo smallint,
	entrada_estado_anulado smallint,
	transferencia_estado_ativo smallint,
	transferencia_estado_aanulado smallint,
	acerto_estado_ativo smallint,
	acerto_estado_anulado smallint,
	precario_estado_ativo smallint,
	precario_estado_fechado smallint,
	cambio_estado_ativo smallint,
	cambio_estado_fechado smallint,
	espaco_default smallint,
	item_estado_fechado smallint,
	movimento_estado_ativo smallint,
	movimento_estado_anulado smallint,
	movimento_estado_canselado smallint,
	classe_itemextra uuid,
	colaborador_chavemodo_padrao smallint,
	colaborador_chavemodo_gerado smallint,
	colaborador_chavemodo_utilizador smallint,
	cambio_estado_anulado smallint,
	currency_std smallint,
	toperacao_classe_stock smallint,
	toperacao_classe_montante smallint,
	menu_raizcomplete character varying,
	mesa_estado_disponivel smallint,
	mesa_estado_ocupado smallint,
	mesa_estado_desativado smallint,
	tposto_venda smallint,
	tposto_cobranca smallint,
	tposto_tudo smallint,
	taxa_estado_ativo smallint,
	taxa_estado_fechado smallint,
	impostovenda_estado_ativo smallint,
	impostovenda_estado_fechado smallint,
	tipoimposto_estado_ativo smallint,
	tipoimposto_estado_fechado smallint,
	maguita_retalho_estado_ativo smallint,
	maguita_ean_estado_ativo smallint,
	maguita_ean_estado_fechado smallint,
	maguita_tlink_preco smallint,
	maguita_fornecedor_estado_ativo smallint,
	maguita_fornecedor_estado_fechado smallint,
	maguita_aloca_estado_fechado smallint,
	maguita_aloca_estado_ativo smallint,
	maguita_posto_estado_encerado smallint,
	maguita_posto_estado_fechado smallint,
	maguita_posto_estado_aberto smallint,
	maguita_tlink_classe smallint,
	maguita_posto_caixamodo_pessoal smallint,
	maguita_posto_caixamodo_espaco smallint,
	maguita_posto_caixamodo_posto smallint,
	maguita_caixa_estado_ativo smallint,
	maguita_caixa_estado_fechado smallint,
	maguita_venda_estado_aberto smallint,
	maguita_venda_estado_fechado smallint,
	maguita_venda_estado_anulado smallint,
	maguita_venda_estado_canselado smallint,
	maguita_venda_estadopreparacao_pendente smallint,
	maguita_venda_estadopreparacao_preparado smallint,
	maguita_imposto_estado_ativo smallint,
	maguita_imposto_estado_fechado smallint,
	maguita_taplicar_adicionar smallint,
	maguita_taplicar_retirar smallint,
	maguita_cliente_estado_ativo smallint,
	maguita_conta_estado_anulado smallint,
	maguita_espaco_estado_ativo smallint,
	maguita_espaco_estado_fechado smallint,
	maguita_cambio_estado_ativo smallint,
	maguita_cambio_estado_fechado smallint,
	maguita_espaco_default smallint,
	maguita_cambio_estado_anulado smallint,
	maguita_tpaga_cash smallint,
	maguita_tpaga_deposito smallint,
	maguita_tpaga_transferencia smallint,
	maguita_tpaga_cheque smallint,
	maguita_tpaga_contacorrente smallint,
	maguita_deposito_estado_ativo smallint,
	maguita_tlancamento_deposito smallint,
	maguita_tlancamento_conta smallint,
	maguita_lancamento_estado_ativo smallint,
	maguita_conta_estado_aberto smallint,
	maguita_conta_estado_fechado smallint,
	maguita_transacao_estado_ativo smallint,
	maguita_link_estado_fechado smallint,
	maguita_link_estado_ativo smallint,
	maguita_trabalha_estado_ativo smallint,
	maguita_trabalha_estado_fechado smallint,
	maguita_cliente_estado_desativo smallint,
	maguita_tmovimento_credito smallint,
	maguita_tmovimento_debito smallint,
	maguita_toperacao_acerto smallint,
	maguita_toperacao_venda smallint,
	maguita_toperacao_transferencia smallint,
	maguita_toperacao_entrada smallint,
	maguita_toperacao_movimento smallint,
	maguita_toperacao_pagamento smallint,
	maguita_toperacao_retalho smallint,
	maguita_fluxo_estado_anulado smallint,
	maguita_serie_estado_ativo smallint,
	cluster_tcluster_local smallint,
	cluster_tcluster_master smallint,
	cluster_tcluster_remote smallint,
	cluster_tcluster_child smallint,
	cluster_treplication_replicate smallint,
	cluster_treplication_readonly smallint,
	cluster_tree_position_trunc smallint,
	cluster_tree_position_branch smallint,
	cluster_grant_revision_child character varying,
	cluster_grant_revision_sub_path character varying,
	cluster_break_status_pendent smallint,
	cluster_break_status_solved smallint,
	cluster_break_status_rejected smallint,
	cluster_grant_revision_supper_path text,
	maguita_tserie_fatura smallint,
	maguita_tserie_faturarecibo smallint,
	maguita_tserie_recibo smallint,
	maguita_tgrupo_cnormal smallint,
	maguita_tgrupo_ccorrente smallint,
	maguita_guia_estado_ativo smallint,
	maguita_tguia_entrada smallint,
	maguita_tguia_saida smallint,
	maguita_custoguia_estado_ativo smallint,
	maguita_custoguia_estado_canselado smallint,
	maguita_tlink_associacao smallint,
	money_round integer,
	maguita_tlancamento_outros smallint,
	maguita_lancamento_mode_automatic smallint,
	maguita_lancamento_mode_manual smallint,
	maguita_serie_estado_fechado smallint,
	maguita_lancamento_estado_anulado smallint,
	cluster_auth_status_active smallint,
	cluster_auth_status_close smallint,
	maguita_tserie_notacredito smallint,
	maguita_autorizacao_estado_ativo smallint,
	maguita_autorizacao_estado_fechado smallint,
	maguita_tserie_guiasaida smallint,
	maguita_cliente_final uuid,
	maguita_cliente_finalnotacredito uuid,
	maguita_fluxo_estado_ativo smallint,
	maguita_fluxo_estado_fechado smallint,
	maguita_unit_state_active smallint,
	maguita_unit_state_fechado smallint,
	maguita_tserie_faturaproforma smallint,
	maguita_parametrizacao_estado_ativo smallint,
	maguita_parametrizacao_estado_fechado smallint
);


--
-- TOC entry 575 (class 1255 OID 16426)
-- Name: _autenticacao_chave_generate(); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth._autenticacao_chave_generate() RETURNS character varying
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para gerar a chave de atutenticação para uma autenticação
   */
  arg_autenticacao_chave character varying;
  _const map.constant;
begin
  _const := map.constant();

  <<random_key>> -- gerar uma chave unica para a proxima autenticação
  while arg_autenticacao_chave is null loop
    arg_autenticacao_chave := lib.dset_random_text( _const.autenticacao_chave_length );
    if (
      select count( * ) > 0
        from auth.autenticacao au
        where au.autenticacao_chave = arg_autenticacao_chave
    ) then
      arg_autenticacao_chave := null;
    end if;
  end loop;

  return arg_autenticacao_chave;
end;
$$;


--
-- TOC entry 615 (class 1255 OID 16427)
-- Name: _colaborador_accesso_desc(smallint); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth._colaborador_accesso_desc(arg_colaborador_acesso smallint) RETURNS character varying
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  /**
    Essa função serve para obter a descrição do accesso colaborador
   */
  _const map.constant := map.constant();
begin

  if arg_colaborador_acesso = _const.colaborador_accesso_ativo then return 'Ativo';
  elseif arg_colaborador_acesso = _const.colaborador_accesso_pendente then return 'Pendente';
  elseif arg_colaborador_acesso = _const.colaborador_accesso_fechado then return 'Desativo';
  end if;
end;

$$;


--
-- TOC entry 616 (class 1255 OID 16428)
-- Name: _colaborador_estado_desc(smallint); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth._colaborador_estado_desc(arg_colaborador_estado smallint) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para devolver os estados do colaborador
   */
  _const map.constant;
begin
  _const := map.constant();
  if arg_colaborador_estado = _const.colaborador_estado_ativo then return 'Ativo'   ; end if;
  if arg_colaborador_estado = _const.colaborador_estado_fechado then return 'Desativo'; end if;

end;
$$;


--
-- TOC entry 392 (class 1255 OID 16429)
-- Name: _colaborador_generate_pin_token(); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth._colaborador_generate_pin_token() RETURNS character varying
    LANGUAGE sql
    AS $$
  -- gerar um pin automatico
  select to_char( ( random() * 9999 ), '0000' )
$$;


--
-- TOC entry 617 (class 1255 OID 16430)
-- Name: _colaborador_generate_senha_token(); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth._colaborador_generate_senha_token() RETURNS character varying
    LANGUAGE plpgsql
    AS $$
declare
      /**
        Essa função serve para criar um token novo
       */
      token character varying;
    begin
      loop
        token := lib.dset_random_text( 16 );
        if (
          select count( * )
            from auth.colaborador co
            where co.colaborador_token = token
        ) = 0 then
          return token;
        end if;
      end loop;
    end;
$$;


--
-- TOC entry 576 (class 1255 OID 16431)
-- Name: to_uuid(anyelement); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.to_uuid(anyelement) RETURNS uuid
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
    select cast(lpad(to_hex( $1::int8 ), 32, '0') as uuid )
$_$;


--
-- TOC entry 706 (class 1255 OID 16432)
-- Name: get(name); Type: FUNCTION; Schema: map; Owner: -
--

CREATE FUNCTION map.get(arg_constant_name name) RETURNS text
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  /**
      Essa função serve para devolver o valor especifico de uma constante
   */
begin
  return (
    select cv.constvalue_value
      from map.constvalue cv
      where cv.constvalue_name = arg_constant_name
  );
end;
$$;


SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- TOC entry 231 (class 1259 OID 16433)
-- Name: colaborador; Type: TABLE; Schema: auth; Owner: -
--

CREATE TABLE auth.colaborador (
    colaborador_id uuid DEFAULT gen_random_uuid() NOT NULL,
    colaborador_tsexo_id smallint,
    colaborador_colaborador_id uuid NOT NULL,
    colaborador_colaborador_atualizacao uuid,
    colaborador_espaco_auth uuid,
    colaborador_nome character varying NOT NULL,
    colaborador_apelido character varying,
    colaborador_email character varying NOT NULL,
    colaborador_nif character varying,
    colaborador_datanascimento date,
    colaborador_senha character varying,
    colaborador_pin character varying,
    colaborador_pinmodo smallint,
    colaborador_senhamodo smallint,
    colaborador_accesso smallint DEFAULT (map.get('colaborador_accesso_pendente'::name))::smallint NOT NULL,
    colaborador_tipo smallint DEFAULT (map.get('colaborador_tipo_user'::name))::smallint NOT NULL,
    colaborador_foto character varying,
    colaborador_token character varying,
    colaborador_tokenlimit timestamp with time zone,
    colaborador_dataultimaatualizacasenha timestamp with time zone,
    colaborador_dataultimologin timestamp with time zone,
    colaborador_ficha jsonb,
    colaborador_estado smallint DEFAULT (map.get('colaborador_estado_ativo'::name))::smallint NOT NULL,
    colaborador_dataregisto timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    colaborador_dataatualizacao timestamp with time zone,
    colaborador_branch_uid uuid,
    _branch_uid uuid GENERATED ALWAYS AS (colaborador_branch_uid) STORED,
    CONSTRAINT ck_colaborador_unique_super_master CHECK (((colaborador_id <> colaborador_colaborador_id) OR (colaborador_id = lib.to_uuid(1))))
);


--
-- TOC entry 5545 (class 0 OID 0)
-- Dependencies: 231
-- Name: TABLE colaborador; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON TABLE auth.colaborador IS 'Entidade para armazenar os colaboradores';


--
-- TOC entry 5546 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_id IS 'Identificacao do colaborador';


--
-- TOC entry 5547 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_tsexo_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_tsexo_id IS 'Identificador do sexo do colaborador';


--
-- TOC entry 5548 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_colaborador_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_colaborador_id IS 'Identificacao do colaborador master';


--
-- TOC entry 5549 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_colaborador_atualizacao; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_colaborador_atualizacao IS 'Identificação do ultimo colaborador que modificou o registo';


--
-- TOC entry 5550 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_nome; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_nome IS 'Corresponde ao nome do colaborador';


--
-- TOC entry 5551 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_apelido; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_apelido IS 'Corresponde ao apelido do colaborador';


--
-- TOC entry 5552 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_email; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_email IS 'Corresponde ao email único do colaborador';


--
-- TOC entry 5553 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_nif; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_nif IS 'Corresponde ao nif único do colaborador';


--
-- TOC entry 5554 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_datanascimento; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_datanascimento IS 'Corresponde a data do nascimento do colaborador';


--
-- TOC entry 5555 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_senha; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_senha IS 'Corresponde a senha do colaborador - É utilizado a função auth.encrypt( $passWord );';


--
-- TOC entry 5556 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_accesso; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_accesso IS 'Esse atributo indica o estado do acesso do colaborador ao sistema
<ul>
  <li> 2 - Pendente | O prochimo acesso ao sistema devera ser por meio do token e o colaborador sera obrigatorio a mudar de senha</li>
  <li> 1 - Ativo | O colaborador pode entrar e sair do sistema livrimente</li>
  <li> 0 - Fechado | O colaborador não pode mais entrar no sistema </li>
</ul>';


--
-- TOC entry 5557 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_tipo; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_tipo IS 'Indica o tipo do colaborador
<ul>
  <li> 0 - Sistema </li>
  <li> 1 - Utilizador normal </li>
  <li> 2 - Super utilizador </li>
</ul>';


--
-- TOC entry 5558 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_foto; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_foto IS 'Corresponde a fotografia do colaborador';


--
-- TOC entry 5559 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_token; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_token IS 'Corresponde ao token gerado para a primeira autenticação do colaborador no sistema ou a recuperação da senha do mesmo.';


--
-- TOC entry 5560 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_tokenlimit; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_tokenlimit IS 'A data limite do token (indica o tempo de validade to token de ativação)';


--
-- TOC entry 5561 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_dataultimaatualizacasenha; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_dataultimaatualizacasenha IS 'Indica a última data em que o a senha do colaborador foi atualizada';


--
-- TOC entry 5562 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_ficha; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_ficha IS 'A ficha do colaborador, serve para registar as informações do colaborador não planeada no momento do planejamento sem ter que mudar a estrutura da base de dados';


--
-- TOC entry 5563 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_estado; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_estado IS 'Corresponde ao estado do colaborador na base de dados, diferente do acesso esse indica se o colaborador esta valido ou invalido no sistama
<br/> Os colaboradores invalidos (Desativos) não podem mais entrar no sistema muito menos aparecer nas listagem (excepto uma listagem expecifica para ver os colaboradores nessa situação)
<ul>
  <li> 1 - Ativo | O colaborador pode comportar livrimente no sistema</li>
  <li> 0 - Destivo | É como se o registro fosse eliminado do sistam</li>
</ul>';


--
-- TOC entry 5564 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_dataregisto; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_dataregisto IS 'Corresponde a data em que o colaborador foi registrado no sistema';


--
-- TOC entry 5565 (class 0 OID 0)
-- Dependencies: 231
-- Name: COLUMN colaborador.colaborador_dataatualizacao; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.colaborador.colaborador_dataatualizacao IS 'Corresponde a última data em que o colaborador foi atualizado no sistema';


--
-- TOC entry 618 (class 1255 OID 16445)
-- Name: _colaborador_token_encrypt(auth.colaborador); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth._colaborador_token_encrypt(_colaborador auth.colaborador) RETURNS character varying
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
    /**
      Essa função serve para criar o token de ativação para um colaborador
     */
  begin
    return auth._encrypt( coalesce( _colaborador.colaborador_token, '' ) )
      || auth._encrypt( coalesce( _colaborador.colaborador_email, '' ) )
      || auth._encrypt( _colaborador.colaborador_id::text )
      || auth._encrypt( _colaborador.colaborador_senha::text );
  end;

$$;


--
-- TOC entry 588 (class 1255 OID 16446)
-- Name: _encrypt(text); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth._encrypt(word text) RETURNS character varying
    LANGUAGE plpgsql
    AS $_$
declare
  wordMd5 character varying default md5( word );
begin
  return md5(
      md5(
          wordMd5
          ||substring( wordMd5, 1, 20 )
          ||md5(
              md5( $$%#*//-+@$£€{}[]()?!&|\\:;,.^~ºª«»<>çáèíÒú$$ )
              || word
              || substring( wordMd5, 15, 28 )
              || substring( wordMd5, 13, 11 )
              || substring( wordMd5, 17, 20 )
              || substring( wordMd5, 7,  21 )
          )
      )
  );
end;
$_$;


--
-- TOC entry 590 (class 1255 OID 16447)
-- Name: _get_colaborador(uuid); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth._get_colaborador(arg_colaborador_id uuid) RETURNS auth.colaborador
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  /**
    Essa função serve para obter a instancia de um colaborador a partir do seu identificador único
   */
  _colaborador auth.colaborador;
begin

  select * into _colaborador
    from auth.colaborador co
    where co.colaborador_id = arg_colaborador_id
  ;
  return _colaborador;
end;
$$;


--
-- TOC entry 592 (class 1255 OID 16448)
-- Name: str_is_normalized(text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.str_is_normalized(text) RETURNS boolean
    LANGUAGE plpgsql IMMUTABLE
    AS $_$
declare
  /**
    Essa função serve para vefificar se um texto esta normalizado
   */
  arg_normalized text := lib.str_normalize( $1 );
begin
  if arg_normalized is null and $1 is not null then return false; end if;
  if arg_normalized != $1 then return false; end if;
  return true;
end;
$_$;


--
-- TOC entry 484 (class 1255 OID 16449)
-- Name: str_normalize(text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.str_normalize(text text) RETURNS text
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função serve para verificar se uma string esta normalizada (sem espacos desnecessarios)
   */
  new_text text;
begin
  new_text := trim( regexp_replace( text, '\s+', ' ', 'g') );
  if length( new_text ) = 0 then return null; end if;
  return new_text;
end;
$$;


--
-- TOC entry 232 (class 1259 OID 16450)
-- Name: perfil; Type: TABLE; Schema: auth; Owner: -
--

CREATE TABLE auth.perfil (
    perfil_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    perfil_perfil_id uuid,
    perfil_colaborador_id uuid NOT NULL,
    perfil_colaborador_atualizacao uuid,
    perfil_nome character varying NOT NULL,
    perfil_codigo character varying,
    perfil_estado smallint DEFAULT (map.get('perfil_estado_ativo'::name))::smallint NOT NULL,
    perfil_dataregisto timestamp with time zone DEFAULT now() NOT NULL,
    perfil_dataatualizacao timestamp with time zone,
    CONSTRAINT ck_perfil_codigo CHECK ((lib.str_is_normalized((perfil_codigo)::text) AND ((perfil_codigo)::text = lib.str_normalize((perfil_codigo)::text)))),
    CONSTRAINT ck_perfil_nome_is_normalizedo CHECK (lib.str_is_normalized((perfil_nome)::text)),
    CONSTRAINT ck_perfil_nome_normalized CHECK (lib.str_is_normalized((perfil_nome)::text))
);


--
-- TOC entry 5573 (class 0 OID 0)
-- Dependencies: 232
-- Name: TABLE perfil; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON TABLE auth.perfil IS 'Essa entidade serve para armazenar os prefis para os colaboradores (um perfil indiga um agrupamento de menus)';


--
-- TOC entry 5574 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN perfil.perfil_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.perfil.perfil_id IS 'Identificador único do perfil';


--
-- TOC entry 5575 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN perfil.perfil_perfil_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.perfil.perfil_perfil_id IS 'Identificador do perfil parente';


--
-- TOC entry 5576 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN perfil.perfil_colaborador_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.perfil.perfil_colaborador_id IS 'Identificador do colaborador responsável pela criação do prefil.';


--
-- TOC entry 5577 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN perfil.perfil_colaborador_atualizacao; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.perfil.perfil_colaborador_atualizacao IS 'Identificador do último colaborador responsavel pela atualização do perfil';


--
-- TOC entry 5578 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN perfil.perfil_nome; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.perfil.perfil_nome IS 'Corresponde ao nome do perfil';


--
-- TOC entry 5579 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN perfil.perfil_codigo; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.perfil.perfil_codigo IS 'Corresponde ao código do perfil (perfil com codigos são perfis padrão e não podem ser modificados nem atualizados)';


--
-- TOC entry 5580 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN perfil.perfil_estado; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.perfil.perfil_estado IS 'Corresponde ao estado do perfil
<ul>
  <li> 1 - Ativo </li>
  <li> 0 - Desativo </li>
</ul>';


--
-- TOC entry 5581 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN perfil.perfil_dataregisto; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.perfil.perfil_dataregisto IS 'Corresponde ao instante em que a inscrição foi cadastrado';


--
-- TOC entry 5582 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN perfil.perfil_dataatualizacao; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.perfil.perfil_dataatualizacao IS 'Corresponde ao último instante em que o perfil foi atualizado';


--
-- TOC entry 405 (class 1255 OID 16461)
-- Name: _get_perfil(uuid); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth._get_perfil(arg_perfil_id uuid) RETURNS auth.perfil
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  /**
    Essa função serve para obter a instancia do perfil a partir do seu identificador único
   */
  _perfil auth.perfil;
begin

  select * into _perfil
    from auth.perfil pe
    where pe.perfil_id = arg_perfil_id
  ;

  return _perfil;

end;
$$;


--
-- TOC entry 619 (class 1255 OID 16462)
-- Name: _menu_create(character varying, character varying, character varying, character varying, character varying); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth._menu_create(arg_menu_codigo character varying, arg_menu_nome character varying, arg_menu_menu_codigo character varying DEFAULT NULL::character varying, arg_menu_link character varying DEFAULT NULL::character varying, arg_menu_icon character varying DEFAULT NULL::character varying) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
DECLARE
  /**
    Essa função serve para criar um novo menu
   */
  arg_menu_nivel int default 0;
  arg_menu_raiz character varying;
  arg_total_raiz int;
  _menu auth.menu;
  _menu_menu auth.menu;
  _const constant map.constant := map.constant();
BEGIN
  -- O codigo do menu deve ser unico
  if (
       select count(*)
       from  auth.menu m
       where lower(m.menu_codigo) = lower( arg_menu_codigo )
     ) > 0 then
    raise exception 'Já existe um menu com esse codigo';
  end if;

  -- O codigo do menu super tem de existir
  if arg_menu_menu_codigo is not null and (
    select count(*)
    from  auth.menu m
    where lower(m.menu_codigo) =  lower( arg_menu_menu_codigo )
  ) = 0 then
    raise exception 'Identificador do menu super não foi encontrado!';
  end if;

  if arg_menu_menu_codigo is not null then
    select * into _menu_menu
      from  auth.menu m
      where upper( m.menu_codigo ) = upper( arg_menu_menu_codigo )
    ;

    select count (*) into arg_total_raiz
      from  auth.menu me
      where me.menu_menu_id = _menu_menu.menu_id
    ;

    arg_menu_raiz := _menu_menu.menu_raiz||'.'||trim(to_char( arg_total_raiz, _const.menu_raizcomplete ));
    arg_menu_nivel := _menu_menu.menu_nivel +1;
  else
    select count (*) into arg_total_raiz
      from auth.menu me
      where me.menu_menu_id is null;

    -- Quando exeder a quantidade de sub menu maximo em um menu entao abortar a operacao emitindo uma message de eroo
    if arg_total_raiz > _const.menu_maxchildren then
      return lib.result_false(
          lib.message('max-submenu-exceeded')
      );
    END IF;
    arg_menu_raiz := trim(to_char(arg_total_raiz, _const.menu_raizcomplete));
  end if;

  insert into auth.menu(
    menu_menu_id,
    menu_nome,
    menu_link,
    menu_codigo,
    menu_nivel,
    menu_raiz
  ) values (
    _menu_menu.menu_id,
    arg_menu_nome,
    arg_menu_link,
    arg_menu_codigo,
    arg_menu_nivel,
    arg_menu_raiz
  ) returning * into _menu;

  perform  auth._menu_create_set_up();

  return lib.result_false(
      jsonb_build_object(
          'data', to_jsonb( _menu ),
          'text', 'success'
      )
  );

END;
$$;


--
-- TOC entry 587 (class 1255 OID 16463)
-- Name: _menu_create_set_up(); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth._menu_create_set_up() RETURNS void
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para estruturar os  eus depois que o novo menu é registrado
   */
  _menu record;
  icount int default 0;
begin
  for _menu in (
    select *
    from auth._menu_load_structure( )
  ) loop
    update auth.menu cur
    set menu_children = (
      select count( * )
      from auth.menu mm
      where mm.menu_raiz like cur.menu_raiz||'.%'
    ),
      menu_directchildern = (
        select count( * )
        from auth.menu mm
        where mm.menu_menu_id = cur.menu_id
      ),
      menu_maxnode = (
        select length( replace( substr( mm.menu_raiz, length( cur.menu_raiz )+1, length( mm.menu_raiz ) ), '.', '') ) /2
        from auth.menu mm
        where mm.menu_raiz like cur.menu_raiz||'%'
        order by mm.menu_nivel desc
        limit 1
      ),
      menu_position = icount
    where cur.menu_id = _menu.menu_id;

    icount := icount  + 1 ;
  end loop;
end;
$$;


--
-- TOC entry 620 (class 1255 OID 16464)
-- Name: _menu_load_structure(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth._menu_load_structure(filter jsonb DEFAULT NULL::jsonb) RETURNS TABLE(menu_id smallint, menu_codigo character varying, menu_nome character varying, menu_raiz character varying, menu_nivel smallint, menu_link character varying, menu_icon character varying, menu_estado smallint, menu_children smallint, menu_directchildern smallint, menu_maxnode smallint, menu_position smallint, menu_menu_id smallint, menu_menu_codigo character varying, menu_menu_nome character varying, menu_menu_raiz character varying, menu_menu_nivel smallint, menu_menu_link character varying, menu_menu_icon character varying)
    LANGUAGE plpgsql
    AS $$
declare
  _menu record;
  menu_super_id int2 default filter->>'menu_id';
begin
  for _menu in (
    select
      me.menu_id,
      me.menu_codigo,
      me.menu_nome,
      me.menu_raiz,
      me.menu_nivel,
      me.menu_link,
      me.menu_icon,
      me.menu_estado,
      me.menu_children,
      me.menu_directchildern,
      me.menu_maxnode,
      me.menu_position,
      super.menu_id as menu_menu_id,
      super.menu_codigo as menu_menu_codigo,
      super.menu_nome as menu_menu_nome,
      super.menu_raiz as menu_menu_raiz,
      super.menu_nivel as menu_menu_nivel,
      super.menu_link as menu_menu_link,
      super.menu_icon as menu_menu_icon
    from auth.menu me
      left join auth.menu super on  me.menu_menu_id = super.menu_id
    where me.menu_menu_id = menu_super_id or (
      menu_super_id is null and me.menu_menu_id is null
    )
    order by
      me.menu_position,
      me.menu_nome
  ) loop -- proximo concorente



    -- Quando um menu tem filhos emtao motra todos os filhos desse menu antes de passa para o proximo meno
    return query
      select
        _menu.menu_id,
        _menu.menu_codigo,
        _menu.menu_nome,
        _menu.menu_raiz,
        _menu.menu_nivel,
        _menu.menu_link,
        _menu.menu_icon,
        _menu.menu_estado,
        _menu.menu_children,
        _menu.menu_directchildern,
        _menu.menu_maxnode,
        _menu.menu_position,
        _menu.menu_menu_id,
        _menu.menu_menu_codigo,
        _menu.menu_menu_nome,
        _menu.menu_menu_raiz,
        _menu.menu_menu_nivel,
        _menu.menu_menu_link,
        _menu.menu_menu_icon
    ;

    if _menu.menu_children > 0 then
      return query select *
        from auth._menu_load_structure(
          jsonb_build_object(
            'menu_id', _menu.menu_id
          )
        );
    end if;

  end loop;
end;
$$;


--
-- TOC entry 621 (class 1255 OID 16465)
-- Name: funct_autenticacao(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_autenticacao(args jsonb) RETURNS TABLE(autenticacao_id uuid, autenticacao_chave character varying, autenticacao_dataregistro character varying, colaborador_id uuid, colaborador_email character varying, colaborador_nome character varying, colaborador_apelido character varying, colaborador_foto character varying, colaborador_accesso smallint, colaborador_estado smallint, colaborador_dataultimaatualizacasenha timestamp with time zone, colaborador_accessodesc character varying, colaborador_estadodesc character varying, tsexo_id smallint, tsexo_codigo character, tsexo_nome character varying, acesso jsonb)
    LANGUAGE plpgsql
    AS $$
declare
/**
  Essa funcao serve para autenticar um colaborador
  no final da autenticacao sera devolvido as informacoes basica do colaborador
  args :{
    arg_auth_name: id | nif | email
    arg_auth_value: VALUE_OF_AUTH_NAME,
    arg_auth_method: senha | pin,
    arg_auth_key: VALUE_OF_AUTH_METHOD
    menus:[]
  }
*/

    arg_auth_name varchar := lib.str_normalize( lower( args->>'arg_auth_name' ) );
    arg_auth_value varchar := args->>'arg_auth_value';
    arg_auth_method varchar := lib.str_normalize( lower( args->>'arg_auth_method' ) );
    arg_auth_key varchar := args->>'arg_auth_key';


    _data record;
    _autenticacao auth.autenticacao;
    _const map.constant := map.constant();
    arg_autenticacao_chave character varying;
    arg_acessos jsonb;

begin
    if arg_auth_name is null then return; end if;
    if arg_auth_value is null then return; end if;
    if arg_auth_method is null then return; end if;
    if arg_auth_key is null then return; end if;

    if arg_auth_name not in ( 'id', 'nif', 'email' ) then return; end if;
    if arg_auth_method not in ( 'pin', 'senha' ) then return; end if;


    arg_auth_name := lower( lib.str_normalize( arg_auth_name ) );

    select * into _data
    from auth.colaborador co
             left join auth.tsexo sex on co.colaborador_tsexo_id = sex.tsexo_id
    where to_jsonb( co )->>format( 'colaborador_%s', arg_auth_name )  = arg_auth_value
      and to_jsonb( co )->>format( 'colaborador_%s', arg_auth_method )  = auth._encrypt( arg_auth_key )
      and co.colaborador_estado = _const.colaborador_estado_ativo
      and co.colaborador_accesso in ( _const.colaborador_accesso_ativo, _const.colaborador_accesso_pendente )
      and co.colaborador_tipo in ( _const.colaborador_tipo_user, _const.colaborador_tipo_user_master )
    ;



-- Quando as credenciais nao se conicedem
    if _data.colaborador_id is null then
        return;
    end if;

    -- Criar a chave única de autenticação
    arg_autenticacao_chave := auth._autenticacao_chave_generate();

    -- Criar a instancia de autenticação
    insert into auth.autenticacao(
        autenticacao_colaborador_id,
        autenticacao_chave
    ) values (
                 _data.colaborador_id,
                 arg_autenticacao_chave
             ) returning * into _autenticacao;

-- Carregar todos os menus do colaborador
  select jsonb_agg( e._grants ) into arg_acessos
    from auth.funct_load_grants( jsonb_build_object(
      'menus', args->'menus',
      'colaborador_id', _data.colaborador_id
    )) e ( _grants );

-- Devolver as informações do colaborador autenticado
    funct_autenticacao.autenticacao_id                        := _autenticacao.autenticacao_id;
    funct_autenticacao.autenticacao_chave                     := _autenticacao.autenticacao_chave;
    funct_autenticacao.autenticacao_dataregistro              := _autenticacao.autenticacao_dataregisto;

    funct_autenticacao.colaborador_id                         := _data.colaborador_id;
    funct_autenticacao.colaborador_email                      := _data.colaborador_email;
    funct_autenticacao.colaborador_nome                       := _data.colaborador_nome;
    funct_autenticacao.colaborador_apelido                    := _data.colaborador_apelido;
    funct_autenticacao.colaborador_foto                       := _data.colaborador_foto;
    funct_autenticacao.colaborador_estado                     := _data.colaborador_estado;
    funct_autenticacao.colaborador_accesso                    := _data.colaborador_accesso;
    funct_autenticacao.colaborador_dataultimaatualizacasenha  := _data.colaborador_dataultimaatualizacasenha;
    funct_autenticacao.colaborador_estadodesc                 := auth._colaborador_estado_desc( _data.colaborador_estado );
    funct_autenticacao.colaborador_accessodesc                := auth._colaborador_accesso_desc( _data.colaborador_accesso );

    funct_autenticacao.tsexo_id                               := _data.tsexo_id;
    funct_autenticacao.tsexo_nome                             := _data.tsexo_nome;
    funct_autenticacao.tsexo_codigo                           := _data.tsexo_codigo;
    funct_autenticacao.acesso                                 := arg_acessos;
    return next ;
end;
$$;


--
-- TOC entry 407 (class 1255 OID 16466)
-- Name: funct_autenticacao_logoff(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_autenticacao_logoff(arg jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
    /**
      Essa funçãos serve para terminar a seção de um colaborador
     */

  arg_autenticacao_chave character varying := arg->>'arg_autenticacao_chave';

  _autenticacao auth.autenticacao;
  _const constant map.constant := map.constant();
begin
  select * into _autenticacao
    from auth.autenticacao au
    where  au.autenticacao_chave = arg_autenticacao_chave
  ;

  if _autenticacao.autenticacao_estado != _const.autenticacao_estado_ativo then
    return lib.result_true();
  end if;

  update auth.autenticacao
    set autenticacao_estado = _const.autenticacao_estado_fechado,
        autenticacao_dataatualizacao = now()
    where autenticacao_id = _autenticacao.autenticacao_id;

  return lib.result_true( 'sucesso' );

end;
$$;


--
-- TOC entry 622 (class 1255 OID 16467)
-- Name: funct_change_colaborador(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_change_colaborador(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para aatualizar as informações do colaborador
    args := {
      arg_colaborador_id: ID,
      arg_colaborador_editar: ID,
      arg_colaborador_email: MAIL,
      arg_colaborador_nome: NOME,
      arg_colaborador_apelido: APELIDO,
      arg_colaborador_datanascimento: DATA,
      arg_colaborador_nif: NIF,
      arg_colaborador_ficha: FICHA,
      arg_colaborador_foto: FICHA,
      arg_tsexo_id: SEXO
    }
    arg_colaborador_editar corresponde ao id do colaborador que sera atualizado
    arg_colaborador_id corresponde ao id do colaborador que esata efetuar a atualização
  */

  arg_colaborador_id uuid not null       := args->>'arg_colaborador_id';
  arg_colaborador_editar uuid not null   := args->>'arg_colaborador_editar';

  arg_colaborador_email character varying   := args->>'arg_colaborador_email';
  arg_colaborador_nome character varying    := args->>'arg_colaborador_nome';
  arg_colaborador_apelido character varying := args->>'arg_colaborador_apelido';
  arg_colaborador_datanascimento date       := args->>'arg_colaborador_datanascimento';
  arg_colaborador_nif character varying     := args->>'arg_colaborador_nif';
  arg_colaborador_ficha jsonb               := args->>'arg_colaborador_ficha';
  arg_colaborador_foto varchar               := args->>'arg_colaborador_foto';
  arg_tsexo_id int2                         := args->>'arg_tsexo_id';

  _colaborador auth.colaborador := auth._get_colaborador( arg_colaborador_editar );
  _const map.constant;
begin
    _const := map.constant();

    -- Tanto o nif, quanto o email deve ser único na base de dados
    arg_colaborador_email := lib.str_normalize( lower( arg_colaborador_email ) );
    arg_colaborador_nif := lib.str_normalize( lower( arg_colaborador_nif ) );

    -- Quando existir email e estiver associado ao utro colaborador então
    if arg_colaborador_email is not null  and (
      select count( * )
        from auth.colaborador
        where colaborador_email = arg_colaborador_email
          and colaborador_id != _colaborador.colaborador_id
    ) > 0 then
      return lib.result_false( '@auth.colaborador.email-exist' );
    end if;

    -- Quando existir um colaborador o nif expecificado
    if arg_colaborador_nif is not null is not null and  (
      select count( * ) > 0
        from auth.colaborador co
        where co.colaborador_nif = arg_colaborador_nif
          and co.colaborador_id != _colaborador.colaborador_id
    ) then
      return lib.result_false( '@auth.colaborador.nif-exist' );
    end if;

    -- A atualização deve ser feita apenas quando o novo valor vier nulo
    update auth.colaborador
      set colaborador_email = coalesce( arg_colaborador_email, colaborador_email ),
          colaborador_nome = coalesce( lib.str_normalize( arg_colaborador_nome ), colaborador_nome ),
          colaborador_apelido = coalesce( lib.str_normalize( arg_colaborador_apelido ), colaborador_apelido ),
          colaborador_tsexo_id = coalesce( arg_tsexo_id, colaborador_tsexo_id ),
          colaborador_datanascimento = coalesce( arg_colaborador_datanascimento, colaborador_datanascimento ),
          colaborador_nif = coalesce( arg_colaborador_nif, colaborador_nif ),
          colaborador_foto = coalesce( arg_colaborador_foto, colaborador_foto ),
          colaborador_ficha = coalesce( arg_colaborador_ficha, colaborador_ficha ),
          colaborador_colaborador_atualizacao = arg_colaborador_id,
          colaborador_dataatualizacao = now()
      where colaborador_id = _colaborador.colaborador_id
    ;

    return lib.result_true();
  end;
$$;


--
-- TOC entry 408 (class 1255 OID 16468)
-- Name: funct_change_colaborador_accesso_disable(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_change_colaborador_accesso_disable(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
    /**
      Essa função serve para disativar o accesso de um dado colaborador no sistema
      args := {
        arg_colaborador_id: ID,
        arg_colaborador_disable: ID
      }
      -- argumentos
        arg_colaborador_id corresponde ao colaborador logado no sistema que esta a efetuar a operação de desativação
        arg_colaborador_disable corresponde ao colaborador que tera o acesso desabilitado do sistema
     */

  arg_colaborador_id uuid := args->>'arg_colaborador_id';
  arg_colaborador_disable uuid := args->>'arg_colaborador_disable';
  _colaborador auth.colaborador := auth._get_colaborador( arg_colaborador_disable );
  _const map.constant;
begin
  _const := map.constant();

  -- Um colaborador master não pode ser desabilitado do sistema
  if _colaborador.colaborador_tipo = _const.colaborador_tipo_user_master then
    return lib.result_false( 'auth.colaborador.disable-master' );
  end if;

  update auth.colaborador
    set colaborador_accesso = 0,
        colaborador_colaborador_atualizacao = arg_colaborador_id,
        colaborador_dataatualizacao = current_timestamp
    where colaborador_id = arg_colaborador_disable
    returning * into _colaborador;

  return lib.result_true(
    jsonb_build_object(
      'colaborador', _colaborador
    )
  );
end;
$$;


--
-- TOC entry 611 (class 1255 OID 16469)
-- Name: funct_change_colaborador_accesso_reativar(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_change_colaborador_accesso_reativar(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
    /**
      Essa função serve para reativar um colaborador
        * Na reativação do colaborador sera gerado um token de ativação

      args := {
        arg_colaborador_id: ID,
        arg_colaborador_reative: ID,
        arg_colaborador_senha: SENHA,
        arg_colaborador_pin: PIN,
        arg_start:BOOLEAN
      }
      -- argumentos
        -- arg_colaborador_id corresponde ao colaborador logado no sistema que esta efetuar a operação de ativação
        -- arg_colaborador_reative corresponde ao colaborador que tera o acesso reativo no sistema.
     */

    arg_colaborador_id uuid := args->>'arg_colaborador_id';
    arg_colaborador_reative uuid := args->>'arg_colaborador_reative';
    arg_colaborador_senha varchar default args->>'arg_colaborador_senha';
    arg_colaborador_pin varchar default args->>'arg_colaborador_pin';
    arg_start boolean := args->>'arg_start';

    arg_token_senha boolean default false;
    arg_token_pin boolean default false;
    _colaborador auth.colaborador := auth._get_colaborador( arg_colaborador_reative );
    _const map.constant;
begin
    _const := map.constant();
    arg_start := coalesce( arg_start, false );

    -- Um colaborador já ativo não pode ser novamente reativado
    if _colaborador.colaborador_estado != _const.colaborador_estado_ativo then
        return lib.result_false( '@auth.colaborador.active-active' );
    end if;

    if arg_start and arg_colaborador_senha is not null then
      _colaborador.colaborador_senhamodo := _const.colaborador_chavemodo_utilizador;

    elsif arg_start and arg_colaborador_pin is not null then
      _colaborador.colaborador_pinmodo := _const.colaborador_chavemodo_utilizador;

    elseif not arg_start then
      _colaborador.colaborador_senhamodo := _const.colaborador_chavemodo_padrao;
      if arg_colaborador_senha is null then
          arg_token_senha := true;
          _colaborador.colaborador_senhamodo := _const.colaborador_chavemodo_gerado;
          arg_colaborador_senha := auth._colaborador_generate_senha_token();
      end if;

      _colaborador.colaborador_pinmodo := _const.colaborador_chavemodo_padrao;
      if arg_colaborador_pin is null then
        _colaborador.colaborador_pinmodo := _const.colaborador_chavemodo_gerado;
        arg_token_pin := true;
        arg_colaborador_pin := auth._colaborador_generate_pin_token();
      end if;
    end if;

    if arg_start then
      _colaborador.colaborador_token := null;
      _colaborador.colaborador_tokenlimit := null;
      _colaborador.colaborador_accesso := _const.colaborador_accesso_ativo;
    else
      _colaborador.colaborador_accesso := _const.colaborador_accesso_pendente;
    end if;

    update auth.colaborador
      set colaborador_accesso = _colaborador.colaborador_accesso,
        colaborador_estado = _const.colaborador_estado_ativo,

        colaborador_senhamodo = _colaborador.colaborador_senhamodo,
        colaborador_senha = case
            when arg_colaborador_senha is not null then auth._encrypt( arg_colaborador_senha )
            else colaborador_senha
          end,

        colaborador_pinmodo = _colaborador.colaborador_pinmodo,
        colaborador_pin = case
            when arg_colaborador_pin is not null then auth._encrypt( arg_colaborador_pin )
            else colaborador_pin
          end,

        colaborador_dataultimaatualizacasenha = now(),
        colaborador_token = _colaborador.colaborador_token,
        colaborador_tokenlimit = _colaborador.colaborador_tokenlimit,

        colaborador_colaborador_atualizacao = arg_colaborador_id,
        colaborador_dataatualizacao = now()
      where colaborador_id = arg_colaborador_reative
      returning * into _colaborador
    ;

    return lib.result_true(
      jsonb_build_object(
        'colaborador_token', case
          when arg_token_senha then auth._colaborador_token_encrypt( _colaborador )
        end,

        'colaborador_pin', case
          when arg_token_pin then arg_colaborador_pin
        end
      )
    );
end;
$$;


--
-- TOC entry 623 (class 1255 OID 16470)
-- Name: funct_change_colaborador_estado_disable(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_change_colaborador_estado_disable(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
    /**
    Essa função serve para disativar o estaod de um dado colaborador no sistema
    args := {
      arg_colaborador_id: ID,
      arg_colaborador_disable: ID
    }
    -- argumentos
      arg_colaborador_id corresponde ao colaborador logado no sistema que esta a efetuar a operação de desativação
      arg_colaborador_disable corresponde ao colaborador que tera o acesso desabilitado do sistema
   */

    arg_colaborador_id uuid := args->>'arg_colaborador_id';
    arg_colaborador_disable uuid := args->>'arg_colaborador_disable';
    _colaborador auth.colaborador := auth._get_colaborador( arg_colaborador_disable );
    _const map.constant;
begin

   -- Um colaborador master não pode ser desabilitado do sistema
  if _colaborador.colaborador_tipo = _const.colaborador_tipo_user_master then
    return lib.result_false( 'auth.colaborador.disable-master' );
  end if;

  update auth.colaborador
    set colaborador_accesso = _const.colaborador_accesso_fechado,
        colaborador_estado = _const.colaborador_estado_fechado,
        colaborador_colaborador_atualizacao = arg_colaborador_id,
        colaborador_dataatualizacao = current_timestamp
    where colaborador_id = arg_colaborador_disable
    returning * into _colaborador;

  return lib.result_true(
    jsonb_build_object(
      'colaborador', _colaborador
    )
  );
end;
$$;


--
-- TOC entry 409 (class 1255 OID 16471)
-- Name: funct_change_colaborador_pin(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_change_colaborador_pin(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa funcao serve para alterar a senha de um colaborador autenticado

    -- argumentos
      args := {
        arg_colaborador_id: ID,
        arg_colaborador_senha: OLD-PIN,
        arg_colaborador_pin: PIN
      }
      arg_colaborador_id corresponde ao identificador do colaborador que esta a alterar a sua propia senha
      arg_colaborador_senha corresponde a antiga senha do colaborador
      arg_colaborador_pin corresponde a nova senha do colaboarador
  */
  arg_colaborador_id uuid                      := args->>'arg_colaborador_id';
  arg_colaborador_senha character varying  := args->>'arg_colaborador_senha';
  arg_colaborador_pin character varying  := args->>'arg_colaborador_pin';
  _colaborador auth.colaborador := auth._get_colaborador( arg_colaborador_id );
  _const map.constant;

begin

  _const := map.constant();

  -- A antiga senha do colaborador tem que bater igual senha atual cadastrada na base de dados
  if auth._encrypt( arg_colaborador_senha ) not in ( _colaborador.colaborador_pin ) then
    return lib.result_false( 'PIN atual inválida!' );
  end if;

  -- A nova senha tem que ser uma senha diferente da senha antiga
  if _colaborador.colaborador_pin = auth._encrypt( arg_colaborador_pin ) then
    return lib.result_false( 'Novo PIN tem que ser diferente do PIN atual!' );
  end if;

  update auth.colaborador
    set colaborador_pin = auth._encrypt( arg_colaborador_pin ),
        colaborador_dataultimaatualizacasenha = now(),
        colaborador_dataatualizacao = now(),
        colaborador_colaborador_atualizacao = arg_colaborador_id,
        colaborador_pinmodo = _const.colaborador_chavemodo_utilizador,
        colaborador_accesso = _const.colaborador_accesso_ativo
    where colaborador_id = arg_colaborador_id
  ;

  return lib.result_true( 'success' );
end;
$$;


--
-- TOC entry 410 (class 1255 OID 16472)
-- Name: funct_change_colaborador_senha(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_change_colaborador_senha(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa funcao serve para alterar a senha de um colaborador autenticado

      args := {
        arg_colaborador_id: ID,
        arg_colaborador_senhaold: SENHA,
        arg_colaborador_senhanew: SENHA
      }
    -- argumentos
      arg_colaborador_id corresponde ao identificador do colaborador que esta a alterar a sua propia senha
      arg_colaborador_senhaold corresponde a antiga senha do colaborador
      arg_colaborador_senhanew corresponde a nova senha do colaboarador
  */
  arg_colaborador_id uuid                      := args->>'arg_colaborador_id';
  arg_colaborador_senhaold character varying  := args->>'arg_colaborador_senhaold';
  arg_colaborador_senhanew character varying  := args->>'arg_colaborador_senhanew';
  _colaborador auth.colaborador := auth._get_colaborador( arg_colaborador_id );
  _const map.constant;

begin
  _const := map.constant();

  -- A antiga senha do colaborador tem que bater igual senha atual cadastrada na base de dados
  if _colaborador.colaborador_senha != auth._encrypt( arg_colaborador_senhaold ) then
    return lib.result_false( 'Palavra-passe atual inválida!' );
  end if;

  -- A nova senha tem que ser uma senha diferente da senha antiga
  if _colaborador.colaborador_senha = auth._encrypt( arg_colaborador_senhanew ) then
    return lib.result_false( 'Nova palavra-passe tem que ser diferente da palavra-passe atual!' );
  end if;

  update auth.colaborador
    set colaborador_senha = auth._encrypt( arg_colaborador_senhanew ),
        colaborador_dataultimaatualizacasenha = now(),
        colaborador_dataatualizacao = now(),
        colaborador_colaborador_atualizacao = arg_colaborador_id,
        colaborador_senhamodo = _const.colaborador_chavemodo_utilizador
    where colaborador_id = arg_colaborador_id
  ;

  return lib.result_true( 'success' );
end;
$$;


--
-- TOC entry 612 (class 1255 OID 16473)
-- Name: funct_change_colaborador_token_acesso(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_change_colaborador_token_acesso(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa funcao serve para recria o token de ativacao de conta de um colaborador
    -- Quando um utilizador perder a senha dever ser usada essa função para a recupereção da sua senha.

    -- argumentos
      -- arg_colaborador_email corresponde ao email do colaborador que pretende recuperar a senha
  */

  arg_colaborador_email character varying := args->>'arg_colaborador_email';

  arg_colaborador_token character varying;

  _const constant map.constant := map.constant();
  _colaborador auth.colaborador;
  _tsexo auth.tsexo;

begin
    arg_colaborador_email := lower( lib.str_normalize( arg_colaborador_email  ) );
    select  * into _colaborador
      from auth.colaborador co
      where co.colaborador_email = arg_colaborador_email
    ;

    if _colaborador.colaborador_estado != _const.colaborador_estado_ativo
      or  _colaborador.colaborador_accesso not in ( _const.colaborador_accesso_ativo, _const.colaborador_accesso_pendente )
    then
      return lib.result_false( '@auth.colaborador.acesso-can-not-active' );
    end if;

    if _colaborador.colaborador_id is null then
      return lib.result_false( '@auth.colaborador.mail-not-found' );
    end if;

    arg_colaborador_token := auth._colaborador_generate_senha_token()
                                 ||auth._colaborador_generate_pin_token();

    update auth.colaborador
      set colaborador_token = arg_colaborador_token,
          colaborador_tokenlimit = current_timestamp + _const.colaborador_token_limit,
          colaborador_dataatualizacao = current_timestamp
      where colaborador_id = _colaborador.colaborador_id
      returning * into _colaborador;

    select * into _tsexo
        from auth.tsexo sx
        where sx.tsexo_id = _colaborador.colaborador_tsexo_id;

    return lib.result_true(
      jsonb_build_object(
        'colaborador', jsonb_build_object(
          'colaborador_nome', _colaborador.colaborador_nome,
          'colaborador_apelido', _colaborador.colaborador_apelido,
          'tsexo_id', _tsexo.tsexo_id,
          'tsexo_nome', _tsexo.tsexo_nome,
          'colaborador_email', _colaborador.colaborador_email
        ),
        'colaborador_token', auth._colaborador_token_encrypt( _colaborador )
      )
    );
  end;
$$;


--
-- TOC entry 411 (class 1255 OID 16474)
-- Name: funct_change_colaborador_token_ativate(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_change_colaborador_token_ativate(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa funcao serve para ativar um colaborador quando tem token ativo
    Na ativação a senha ser definida, o acesso passara a ser ativo e o token deixara de existir

   */

  arg_colaborador_id integer              := args->>'arg_colaborador_id';
  arg_colaborador_token character varying := args->>'arg_colaborador_token';
  arg_colaborador_senha character varying  := args->>'arg_colaborador_senha';
  arg_colaborador_pin character varying  := args->>'arg_colaborador_pin';


  _const map.constant := map.constant();
  _colaborador auth.colaborador := auth._get_colaborador( arg_colaborador_id := arg_colaborador_id );
begin
  if _colaborador.colaborador_token is null then
    return lib.result_false( '@auth.colaborador.token-not-found' );
  end if;

  if _colaborador.colaborador_estado != _const.colaborador_estado_ativo
    or  _colaborador.colaborador_accesso not in ( _const.colaborador_accesso_ativo, _const.colaborador_accesso_pendente )
  then
    return lib.result_false( 'auth.colaborador.acesso-can-not-active' );
  end if;

  if auth._colaborador_token_encrypt( _colaborador ) != arg_colaborador_token then
    return lib.result_false( '@auth.colaborador.token-invalid' );
  end if;

  -- Ativar o colaborador
  update auth.colaborador
    set
      colaborador_accesso = _const.colaborador_accesso_ativo,
      colaborador_token = null,
      colaborador_tokenlimit = null,
      colaborador_senha = auth._encrypt( arg_colaborador_senha ),
      colaborador_pin = auth._encrypt( arg_colaborador_pin ),
      colaborador_pinmodo = _const.colaborador_chavemodo_utilizador,
      colaborador_senhamodo = _const.colaborador_chavemodo_utilizador,
      colaborador_dataultimaatualizacasenha = now(),
      colaborador_dataatualizacao = now(),
      colaborador_colaborador_atualizacao = arg_colaborador_id
    where colaborador_id = arg_colaborador_id
  ;

  return lib.result_true( 'sucesso' );

end;
$$;


--
-- TOC entry 624 (class 1255 OID 16475)
-- Name: funct_change_perfil(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_change_perfil(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para modificar dos dados do perfil como o nome
    --args
      -- arg_colaborador_id corresponde ao identificador do colaborador responsavel pelo atualização do perfil
      -- arg_perfil_id corresponed ao identificador do perfil que tera as informações alterada
      -- arg_perfil_nome corresponde ao novo nome para o perfil
   */

  arg_colaborador_id uuid           := args ->>'arg_colaborador_id';
  arg_perfil_id uuid                := args ->>'arg_perfil_id';
  arg_menu jsonb                    := args ->>'arg_menus';
  arg_perfil_nome character varying := args ->>'arg_perfil_nome';

  _const map.constant;
  _perfil auth.perfil;
  _res lib.result;
begin
  _const := map.constant();
  _perfil := auth._get_perfil( arg_perfil_id );

  arg_perfil_nome := lib.str_normalize( arg_perfil_nome );

  -- para os perfil com código não pode ter as informações alteradas
  if _perfil.perfil_codigo is not null then
    return lib.result_false( '@auth.perfil.codigo.locked' );
  end if;

  update auth.perfil
    set perfil_nome = arg_perfil_nome,
        perfil_colaborador_atualizacao = arg_colaborador_id,
        perfil_dataatualizacao = current_timestamp
    where perfil_id = arg_perfil_id
  ;

  _res := auth.funct_reg_privilegio( args );
  _res.message := _res.message || jsonb_build_object(
    'perfil', _perfil
  );

  return _res;

end;
$$;


--
-- TOC entry 625 (class 1255 OID 16476)
-- Name: funct_load_colaborador(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_load_colaborador(filter jsonb) RETURNS TABLE(colaborador_id uuid, colaborador_nome character varying, colaborador_apelido character varying, colaborador_mail character varying, colaborador_estado smallint, colaborador_estadodesc character varying, colaborador_acesso smallint, colaborador_acessodesc character varying, colaborador_foto character varying, sexo_id smallint, sexo_nome character varying, sexo_codigo character, colaborador_datanascimento date, colaborador_nif character varying)
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função sere para carregar os colaborador apartir dos filtros expecificados
   */
  arg_colaborador_email character varying default filter->>'arg_colaborador_email';
  arg_colaborador_nif character varying default filter->>'arg_colaborador_nif';
  _const map.constant;
begin
  _const :=  map.constant();

  return query
    select co.colaborador_id,
        co.colaborador_nome,
        co.colaborador_apelido,
        co.colaborador_email,
        co.colaborador_estado,
        auth._colaborador_estado_desc( co.colaborador_estado ),
        co.colaborador_accesso,
        auth._colaborador_accesso_desc( co.colaborador_accesso ),
        co.colaborador_foto,
        s2.tsexo_id,
        s2.tsexo_nome,
        s2.tsexo_codigo,
        co.colaborador_datanascimento,
        co.colaborador_nif
      from auth.colaborador co
        left join auth.tsexo s2 ON co.colaborador_tsexo_id = s2.tsexo_id
      where co.colaborador_tipo in ( _const.colaborador_tipo_user, _const.colaborador_tipo_user_master )
        and co.colaborador_email = coalesce( arg_colaborador_email, co.colaborador_email )
        and co.colaborador_nif = coalesce( arg_colaborador_nif, co.colaborador_nif )
      order by
        case
          when co.colaborador_accesso = _const.colaborador_accesso_ativo then 1
          when co.colaborador_accesso = _const.colaborador_accesso_pendente then 2
          when co.colaborador_accesso = _const.colaborador_accesso_fechado then 3
        end asc,
        co.colaborador_nome,
        co.colaborador_apelido
      ;
end;
$$;


--
-- TOC entry 613 (class 1255 OID 16477)
-- Name: funct_load_colaborador_all_menu(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_load_colaborador_all_menu(filter jsonb) RETURNS TABLE(colaborador_id uuid, colaborador_nome character varying, colaborador_apelido character varying, colaborador_foto character varying)
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para devolver os colaboradores que tenham o conjunto de menu especificado
    filter := {
      arg_colaborador_id: ID
      arg_menus: [
        menu_codigo,
        menu_codigo,
        menu_codigo
      ]
    }
  **/
  arg_colaborador_id uuid default filter->>'arg_colaborador_id';
  args_menus varchar[ ] := array( select distinct doc.menu_codigo from jsonb_array_elements_text( filter->'arg_menus' ) doc( menu_codigo ) );
  _const map.constant;
begin
  _const := map.constant();

  return query
    select
        co.colaborador_id,
        co.colaborador_nome,
        co.colaborador_apelido,
        co.colaborador_foto
      from auth.colaborador co
        inner join auth.acesso acc on co.colaborador_id = acc.acesso_colaborador_propetario
        inner join auth.menu men on acc.acesso_menu_id = men.menu_id
      where acc.acesso_estado = _const.acesso_estado_ativo
        and co.colaborador_estado = _const.colaborador_estado_ativo
        and co.colaborador_id = coalesce( arg_colaborador_id, co.colaborador_id )
      group by co.colaborador_id
      having array_agg( men.menu_codigo ) @> args_menus
      order by co.colaborador_dataultimologin desc nulls last,
        co.colaborador_nome,
        co.colaborador_apelido
  ;
end;
$$;


--
-- TOC entry 412 (class 1255 OID 16478)
-- Name: funct_load_colaborador_any_menu(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_load_colaborador_any_menu(filter jsonb) RETURNS TABLE(colaborador_id uuid, colaborador_nome character varying, colaborador_apelido character varying, colaborador_foto character varying)
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para devolver os colaboradores que tenha pelo menos um menu especificado
    filter := {
      arg_colaborador_id: ID,
      arg_menus: [
        menu_codigo,
        menu_codigo,
        menu_codigo
      ]
    }
  **/
  arg_colaborador_id uuid default filter->>'arg_colaborador_id';
  args_menus varchar[ ] := array( select distinct doc.menu_codigo from jsonb_array_elements_text( filter->'arg_menus' ) doc( menu_codigo ) );
  _const map.constant;
begin
  _const := map.constant();

  return query
    select
        co.colaborador_id,
        co.colaborador_nome,
        co.colaborador_apelido,
        co.colaborador_foto
      from auth.colaborador co
        inner join auth.acesso acc on co.colaborador_id = acc.acesso_colaborador_propetario
        inner join auth.menu men on acc.acesso_menu_id = men.menu_id
      where acc.acesso_estado = _const.acesso_estado_ativo
        and co.colaborador_estado = _const.colaborador_estado_ativo
        and men.menu_codigo = any( args_menus )
        and co.colaborador_id = coalesce( arg_colaborador_id, co.colaborador_id )
      group by co.colaborador_id
      having count( men.menu_id ) > 0
      order by
       co.colaborador_dataultimologin  desc nulls last,
       co.colaborador_nome,
       co.colaborador_apelido
  ;
end;
$$;


--
-- TOC entry 607 (class 1255 OID 16479)
-- Name: funct_load_colaborador_by_token(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_load_colaborador_by_token(args jsonb) RETURNS TABLE(colaborador_id uuid, colaborador_nome character varying, colaborador_apelido character varying, colaborador_mail character varying, colaborador_nif character varying, colaborador_foto character varying, colaborador_ficha jsonb, tsexo_id smallint, tsexo_nome character varying, tsexo_codigo character)
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  /**
    Essa função serve para devolver as informações de um colaborador apartir do seu token de acesso
    O tokem a ser devolvido tem que estar no prazo

    -- argumentos
      -- arg_colaborador_token corresponde ao token encripitado do colaborador
   */

  arg_colaborador_token character varying := args->>'arg_colaborador_token';
begin
  return query
    select
      co.colaborador_id,
      co.colaborador_nome,
      co.colaborador_apelido,
      co.colaborador_email,
      co.colaborador_foto,
      co.colaborador_nif,
      co.colaborador_ficha,
      sx.tsexo_id,
      sx.tsexo_nome,
      sx.tsexo_codigo
    from auth.colaborador co
      left join auth.tsexo sx on co.colaborador_tsexo_id = sx.tsexo_id
    where auth._colaborador_token_encrypt( co ) = arg_colaborador_token
      and co.colaborador_tokenlimit >= current_timestamp
  ;
end;
$$;


--
-- TOC entry 413 (class 1255 OID 16480)
-- Name: funct_load_colaborador_simple(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_load_colaborador_simple(filter jsonb DEFAULT NULL::jsonb) RETURNS TABLE(colaborador_id uuid, colaborador_nome character varying, colaborador_apelido character varying, colaborador_nomecompleto character varying)
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para carregar os colaboradores
   */
  _const map.constant;
begin
  _const := map.constant();

  return query
    select
        co.colaborador_id,
        co.colaborador_nome,
        co.colaborador_apelido,
        format( '%s %s',co. colaborador_nome, co.colaborador_apelido )::character varying
      from auth.colaborador co
      where co.colaborador_estado != _const.colaborador_estado_fechado
        and co.colaborador_tipo != _const.colaborador_tipo_system
  ;
end;
$$;


--
-- TOC entry 414 (class 1255 OID 16481)
-- Name: funct_load_colaborador_token_restore(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_load_colaborador_token_restore(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para recuperar o token do acesso do colaborador ao sistema.
    -- argumentos
      -- arg_colaborador_restore identificador do colaborador a qual pretente restaurar o token de ativação
   */

  arg_colaborador_restore uuid := args->>'arg_colaborador_id';

  _const map.constant;
  _colaborador auth.colaborador;
begin
    _const := map.constant();
    _colaborador := auth._get_colaborador( arg_colaborador_restore );

  if _colaborador.colaborador_token is null
    or _colaborador.colaborador_tokenlimit is null
    or _colaborador.colaborador_tokenlimit < current_timestamp
  then
    return lib.result_false( 'auth.colaborador.token-not-restore' );
  end if;

  return lib.result_true(
    jsonb_build_object(
      'colaborador_token', auth._colaborador_token_encrypt( _colaborador )
    )
  );
end;
$$;


--
-- TOC entry 608 (class 1255 OID 16482)
-- Name: funct_load_grants(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_load_grants(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    menus: [ID, ID] || null
    colaborador_id: UID
   */
  _menu int[];
  _const map.constant;
  useMenu jsonb default args->'menus';
  _colaborador_id uuid default args->>'colaborador_id';

begin
  _const := map.constant();

  if jsonb_typeof( useMenu ) != 'array' then useMenu := null; end if;

  if useMenu is null or jsonb_array_length( useMenu ) = 0 then
    _menu := array(
        select me.menu_id
        from auth.menu me
      );
  else
    _menu := array(
        select e.text::int
        from jsonb_array_elements_text( useMenu ) e( text )
      );
  end if;

  return query
    select  to_jsonb( ac ) || to_jsonb( me )
      from auth.menu me
        inner join auth.acesso ac on me.menu_id = ac.acesso_menu_id
      where ac.acesso_estado = _const.acesso_estado_ativo
        and ac.acesso_colaborador_propetario = _colaborador_id
        and me.menu_id = any( _menu )
      order by me.menu_position
  ;
end;
$$;


--
-- TOC entry 626 (class 1255 OID 16483)
-- Name: funct_load_menu(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_load_menu(filter jsonb DEFAULT NULL::jsonb) RETURNS TABLE(menu_id smallint, menu_codigo character varying, menu_raiz character varying, menu_nivel smallint, menu_icon character varying, menu_nome character varying, menu_link character varying, menu_estado smallint, menu_children smallint, menu_maxnode smallint, menu_directchildern smallint, menu_position smallint, menu_falta boolean, menu_mais boolean, menu_sincronizado boolean, acesso_id uuid, perfil_id uuid, menu_menu_id smallint, menu_menu_codigo character varying, menu_menu_raiz character varying, menu_menu_nivel smallint, menu_menu_icon character varying, menu_menu_nome character varying, menu_menu_link character varying, menu_menu_estado smallint, menu_menu_children smallint, menu_menu_maxnode smallint, menu_menu_directchildern smallint, menu_menu_position smallint)
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  /**
    Essa função carrega os menus e faz um mach entre e perfil e o colaborador
    -- argumentos
      -- arg_colaborador_id identificador do colaborador o qual pretende-se obter os menus (opcional)
      -- arg_perfil_id identificador do perfil o qual pretende-se obter os menus (opcional)
      -- arg_allmenu boolean | quando true significa carregar todos os menus independete mente se o colaborador
        ou menu estiver associado ao mesmo
   */
  arg_colaborador_id uuid := filter->>'arg_colaborador_id';
  arg_perfil_id uuid := filter->>'arg_perfil_id';
  arg_allmenu boolean := filter->>'arg_allmenu';

  _const map.constant;
begin
    _const := map.constant();
  -- Quando o filtro não for expecificado carregar todos os menus
  arg_allmenu := coalesce( arg_allmenu, true );


  return query
    select
        me.menu_id                ,
        me.menu_codigo            ,
        me.menu_raiz              ,
        me.menu_nivel             ,
        me.menu_icon              ,
        me.menu_nome              ,
        me.menu_link              ,
        me.menu_estado            ,
        me.menu_children          ,
        me.menu_maxnode           ,
        me.menu_directchildern    ,
        me.menu_position          ,

        ac.acesso_id is null and perf.perfil_id is not null,
        ac.acesso_id is not null and perf.perfil_id is null,
        ac.acesso_id is not null and perf.perfil_id is not null,

        ac.acesso_id              ,
        perf.perfil_id,

        super.menu_id             ,
        super.menu_codigo         ,
        super.menu_raiz           ,
        super.menu_nivel          ,
        super.menu_icon           ,
        super.menu_nome           ,
        super.menu_link           ,
        super.menu_estado         ,
        super.menu_children       ,
        super.menu_maxnode        ,
        super.menu_directchildern ,
        super.menu_position

      from auth.menu me
        left join auth.menu super on me.menu_menu_id = super.menu_id
        left join auth.acesso ac on me.menu_id = ac.acesso_menu_id
          and ac.acesso_estado = _const.acesso_estado_ativo
          and ac.acesso_colaborador_propetario = arg_colaborador_id
        left join auth.colaborador col on ac.acesso_colaborador_propetario = col.colaborador_id
        left join auth.privilegio pri on me.menu_id = pri.privilegio_menu_id
          and pri.privilegio_estado = _const.privilegio_estado_ativo
        left join auth.perfil perf on pri.previlegio_perfil_id = perf.perfil_id
          and perf.perfil_estado = _const.perfil_estado_ativo
          and perf.perfil_id = arg_perfil_id
      where me.menu_estado = _const.menu_estado_ativo
        and (
          ac.acesso_id is not null
            or perf.perfil_id is not null
            or col.colaborador_tipo = _const.colaborador_tipo_user_master -- para os colaboradores master carregar dodos os menus disponiveis
            or arg_allmenu
        )
      order by me.menu_position
  ;
end;
$$;


--
-- TOC entry 614 (class 1255 OID 16484)
-- Name: funct_load_menu_cascade(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_load_menu_cascade(filter jsonb DEFAULT NULL::jsonb) RETURNS TABLE(menu_id smallint, menu_menu_id smallint, menu_codigo character varying, menu_raiz character varying, menu_nivel smallint, menu_icon character varying, menu_nome character varying, menu_link character varying, menu_estado smallint, menu_children smallint, menu_maxnode smallint, menu_directchildern smallint, menu_position smallint, menu_falta boolean, menu_mais boolean, menu_sincronizado boolean, acesso_id uuid, perfil_id uuid, menu_childrenlist jsonb)
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  /**
    Essa função carrega os menus e faz um mach entre e perfil e o colaborador
    args := {
      arg_colaborador_id: ID,
      arg_perfil_id: ID,
      arg_allmenu: TRUE | FALSE
    }
    -- argumentos
      -- arg_colaborador_id identificador do colaborador o qual pretende-se obter os menus (opcional)
      -- arg_perfil_id identificador do perfil o qual pretende-se obter os menus (opcional)
      -- arg_allmenu boolean | quando true significa carregar todos os menus independete mente se o colaborador
        ou menu estiver associado ao mesmo
   */
  arg_colaborador_id uuid := filter->>'arg_colaborador_id';
  arg_perfil_id uuid := filter->>'arg_perfil_id';
  arg_allmenu boolean := filter->>'arg_allmenu';

  _const constant map.constant := map.constant();
begin
  arg_allmenu := coalesce( arg_allmenu, false );

  -- Quando o filtro não for expecificado carregar todos os menus
  if filter is null then arg_allmenu := true; end if;

  return query
    with menu_colaborador as (
      select
        me.menu_id                ,
        me.menu_menu_id           ,
        me.menu_codigo            ,
        me.menu_raiz              ,
        me.menu_nivel             ,
        me.menu_icon              ,
        me.menu_nome              ,
        me.menu_link              ,
        me.menu_estado            ,
        me.menu_children          ,
        me.menu_maxnode           ,
        me.menu_directchildern    ,
        me.menu_position          ,

        ac.acesso_id is null and perf.perfil_id is not null as menu_falta,
        ac.acesso_id is not null and perf.perfil_id is null as menu_mais,
        ac.acesso_id is not null and perf.perfil_id is not null as menu_sincronizado,
        ac.acesso_id              ,
        perf.perfil_id

      from auth.menu me
             left join auth.menu super on me.menu_menu_id = super.menu_id
             left join auth.acesso ac on me.menu_id = ac.acesso_menu_id
        and ac.acesso_estado = _const.acesso_estado_ativo
        and ac.acesso_colaborador_propetario = arg_colaborador_id
             left join auth.colaborador col on ac.acesso_colaborador_propetario = col.colaborador_id
             left join auth.privilegio pri on me.menu_id = pri.privilegio_menu_id
        and pri.privilegio_estado = _const.privilegio_estado_ativo
             left join auth.perfil perf on pri.previlegio_perfil_id = perf.perfil_id
        and perf.perfil_estado = _const.perfil_estado_ativo
        and perf.perfil_id = arg_perfil_id
      where me.menu_estado = _const.menu_estado_ativo
        and (
          ac.acesso_id is not null
          or perf.perfil_id is not null
          or col.colaborador_tipo = _const.colaborador_tipo_user_master -- para os colaboradores master carregar dodos os menus disponiveis
          or arg_allmenu
        )
      order by me.menu_position asc
    ) select mc.*,
        jsonb_agg( to_jsonb( child ) ) filter ( where child.menu_id is not null ) menu_childrenlist
      from menu_colaborador mc
        left join menu_colaborador child on mc.menu_id = child.menu_menu_id
      where mc.menu_menu_id is null
      group by
        mc.menu_id,
        mc.menu_menu_id,
        mc.menu_codigo,
        mc.menu_raiz,
        mc.menu_nivel,
        mc.menu_icon,
        mc.menu_nome,
        mc.menu_link ,
        mc.menu_estado,
        mc.menu_children,
        mc.menu_maxnode,
        mc.menu_directchildern,
        mc.menu_position,
        mc.menu_falta,
        mc.menu_mais ,
        mc.menu_sincronizado,
        mc.acesso_id,
        mc.perfil_id
      order by mc.menu_position asc
  ;
end;
$$;


--
-- TOC entry 627 (class 1255 OID 16485)
-- Name: funct_reg_acesso(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_reg_acesso(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa funcao serve para dar acesse de um menu ao um colaborador
    -- Para dar acess o colaborador não pode ter previamente o acesso ao menu
    args := {
      arg_colaborador_id: ID,
      _branch_uid: UID
      arg_colaborador_propetario: ID,
      arg_menu_list: [
        ID, ID, ID
      ]
    }
      -- arg_colaborador_id corresponde ao colaborador que esta a definir os previlegio de acesso
      -- arg_colaborador_propetario corresponde ao colaborador que tera o acesso definido
      -- arg_menu_ids corresponde a lista de identificadores do menus que o colaborador tera acesso
   */

  arg__branch_uid uuid          := args->>'_branch_uid';
  arg_colaborador_id uuid          := args->>'arg_colaborador_id';
  arg_colaborador_propetario uuid  := args->>'arg_colaborador_propetario';
  arg_menu_list int2[]                := array( select jsonb_array_elements_text( args->'arg_menu_list' )::int2 );

  arg_acesso_lista auth.acesso[];

  _const map.constant;
begin

    _const := map.constant();

  -- Revogar os menus que o colaborador tinha acesso anteriormente mas atualmente já nao os têm
  -- São menus que aperecem no acesso ativo mas nao aperencem na nova lista de menus a ser dado ao colaborador
  update auth.acesso
    set acesso_estado = _const.acesso_estado_fechado,
        acesso_dataatualizacao = current_timestamp,
        acesso_colaborador_atualizacao = arg_colaborador_id
    where acesso_estado = _const.acesso_estado_ativo
      and acesso_colaborador_propetario = arg_colaborador_propetario
      and acesso_menu_id != all( arg_menu_list )
      and _branch_uid = arg__branch_uid
  ;

  -- Registrar para o colaborador apenas menus listado na lista que estão em faltas
  insert into auth.acesso(
    acesso_menu_id,
    acesso_colaborador_propetario,
    acesso_colaborador_id,
    _branch_uid
  ) select
      me.menu_id,
      arg_colaborador_propetario,
      arg_colaborador_id,
      arg__branch_uid
    from unnest( arg_menu_list ) un ( menu_id )
      inner join auth.menu me on un.menu_id = me.menu_id
      left join auth.acesso ac on me.menu_id = ac.acesso_menu_id
        and ac.acesso_estado = _const.acesso_estado_ativo
        and ac.acesso_colaborador_propetario = arg_colaborador_propetario
    where ac.acesso_id is null
  ;

  -- Obter todos os acessos ativos para esse colaborador
  select array_agg( ac ) into arg_acesso_lista
    from auth.acesso ac
    where ac.acesso_colaborador_propetario = arg_colaborador_propetario
      and ac.acesso_estado = _const.acesso_estado_ativo
  ;

  return lib.result_true(
    jsonb_build_object(
      'acesso', arg_acesso_lista
    )
  );

end;
$$;


--
-- TOC entry 415 (class 1255 OID 16486)
-- Name: funct_reg_colaborador(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_reg_colaborador(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para cadastra novos colaboradores
    Ao cadastar o colaborador a senha é atribuida automaticamente em um random
    E gerado tambem um token que devera ser enviado pela aplicao ao email do colaborador cadastrado
    O email e o NIF tem que ser unico
    args := {
      arg_colaborador_id: ID,
      arg_colaborador_email: EMAIL,
      arg_colaborador_nome: NOME,
      arg_colaborador_apelido: APELIDO,
      arg_colaborador_nif: NIF,
      arg_colaborador_datanascimento: DATA,
      arg_colaborador_ficha: FICHA,
      arg_colaborador_foto: FICHA,
      arg_tsexo_id: ID,

      arg_colaborador_senha: DEFAULT_SENHA_IF_EXIST,
      arg_colaborador_pin: DEFAULT_PIN_IF_SET,
    }

   */
  arg_colaborador_id uuid                := args->>'arg_colaborador_id';
  arg_colaborador_email character varying   := args->>'arg_colaborador_email';
  arg_colaborador_nome character varying    := args->>'arg_colaborador_nome';
  arg_colaborador_apelido character varying := args->>'arg_colaborador_apelido';
  arg_colaborador_nif character varying     := args->>'arg_colaborador_nif';
  arg_colaborador_datanascimento date       := args->>'arg_colaborador_datanascimento';
  arg_colaborador_ficha jsonb               := args->>'arg_colaborador_ficha';
  arg_colaborador_foto varchar               := args->>'arg_colaborador_foto';
  arg_tsexo_id int2                         := args->>'arg_tsexo_id';
  arg_colaborador_token text;
  arg_menu_list jsonb                       := args->>'arg_menu_list';
  arg_colaborador_pin varchar               := args->>'arg_colaborador_pin';
  arg_colaborador_senha varchar             := args->>'arg_colaborador_senha';


  _const map.constant := map.constant();
  _colaborador auth.colaborador;
  _res lib.result;

begin
  -- normalizar os dados do colaborador
  arg_colaborador_email := lower( lib.str_normalize( arg_colaborador_email ) );
  arg_colaborador_nif := lower( lib.str_normalize( arg_colaborador_nif ) );
  arg_colaborador_nome := lib.str_normalize( arg_colaborador_nome );
  arg_colaborador_apelido := lib.str_normalize( arg_colaborador_apelido );

  -- As informacoes do tipo texto tem que estar normalizados
  if arg_colaborador_email is null then
    return lib.result_false( '@auth.colaborador.invalid-mail' );
  end if;

  if arg_colaborador_nome is null then
    return lib.result_false( '@auth.colaborador.invalid-name' );
  end if;

  -- Garantir que nao exista o  NIF
  if (
    select count( * )
      from auth.colaborador co
      where co.colaborador_email =  arg_colaborador_email
  ) > 0 then
    return lib.result_false( '@auth.colaborador.email-exist' );
  end if;

  -- Garantir que o nif seja unico
  if (
    select count( * )
      from auth.colaborador co
      where co.colaborador_nif = arg_colaborador_nif
  ) > 0 then
    return lib.result_false( '@auth.colaborador.nif-exist' );
  end if;

  insert into auth.colaborador(
    colaborador_colaborador_id,
    colaborador_email,
    colaborador_nome,
    colaborador_apelido,
    colaborador_nif,
    colaborador_datanascimento,
    colaborador_foto,
    colaborador_tsexo_id
  ) values (
    arg_colaborador_id,
    arg_colaborador_email,
    arg_colaborador_nome,
    arg_colaborador_apelido,
    arg_colaborador_nif,
    arg_colaborador_datanascimento,
    arg_colaborador_foto,
    arg_tsexo_id
  ) returning * into _colaborador;

  perform auth.funct_reg_acesso(
    jsonb_build_object(
      'arg_colaborador_id', arg_colaborador_id,
      'arg_colaborador_propetario', _colaborador.colaborador_id,
      'arg_menu_list', arg_menu_list
    )
  );

  _res := auth.funct_change_colaborador_accesso_reativar(
    jsonb_build_object(
      'arg_colaborador_id', arg_colaborador_id,
      'arg_colaborador_reative', _colaborador.colaborador_id,
      'arg_colaborador_senha', arg_colaborador_senha,
      'arg_colaborador_pin', arg_colaborador_pin
    )
  );


  return lib.result_true(
    jsonb_build_object(
      'colaborador',
        lib.jsonb_values(
          to_jsonb( _colaborador ),
          'colaborador_id',
          'colaborador_tsexo_id',
          'colaborador_email',
          'colaborador_nif',
          'colaborador_nome',
          'colaborador_apelido',
          'colaborador_datanascimento',
          'colaborador_ficha',
          'colaborador_dataultimaatualizacasenha',
          'colaborador_accesso',
          'colaborador_estado',
          'colaborador_dataregisto'
        )
    ) || _res.message
  );
end;
$$;


--
-- TOC entry 628 (class 1255 OID 16487)
-- Name: funct_reg_perfil(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_reg_perfil(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para registar um novo tipo de perfil dos colaboradores
    -- paramentros
      -- arg_colaborador_id corresponde ao colaborador responsavél pelo regustro do perfil «
      -- arg_perfil_perfil_id corresponde ao identificador do perfil parente
      -- arg_perfil_nome corresponde ao nome do perfil a ser criado
      -- arg_menus corresponde aos identificadores dos menus que esse perfil deve ter por padrão
        [ ID, ID, ID ... ]
   */

  arg_colaborador_id uuid                := args ->>'arg_colaborador_id';
  arg_perfil_perfil_id uuid             := args ->>'arg_perfil_perfil_id';
  arg_perfil_nome character varying     := args ->>'arg_perfil_nome';
  arg_menus jsonb                       := args ->'arg_menus';

  _perfil auth.perfil;
  _res lib.result;
begin

  -- Não pode existir mais de um perfil com o mesmo nome
  if(
    select count( * ) > 0
      from auth.perfil pef
      where pef.perfil_nome = arg_perfil_nome
  ) then
    return lib.result_false( 'auth.perfil.nome.already-exist' );
  end if;

  insert into auth.perfil (
    perfil_perfil_id,
    perfil_colaborador_id,
    perfil_nome
  ) values (
    arg_perfil_perfil_id,
    arg_colaborador_id,
    arg_perfil_nome
  ) returning * into _perfil;

  _res := auth.funct_reg_privilegio(
    args || jsonb_build_object(
      'arg_perfil_id', _perfil.perfil_id
    )
  );

  _res.message := _res.message || jsonb_build_object(
    'perfil', _perfil
  );

  return _res;
end;
$$;


--
-- TOC entry 416 (class 1255 OID 16488)
-- Name: funct_reg_privilegio(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_reg_privilegio(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para registrar os menus que um perfil tem privilegiso por padrão
    -- argumentos
      -- arg_colaborador_id corresponde ao identificador do colabrador responsavel por privilegiar o menu ao perfil
      -- arg_menus corresponde aos identificadores dos menus em que serão associados ao perfil
      -- arg_perfil_id corresponde ao identificador do perfil que ira ter acesso aos menus
   */

  arg_colaborador_id uuid  := args ->>'arg_colaborador_id';
  arg_perfil_id uuid       := args ->>'arg_perfil_id';
  arg_menus         jsonb := args ->>'arg_menus';

  arg_menu_list int[ ] := array( select jsonb_array_elements_text( arg_menus )::int );

  _const map.constant;
  arg_privilegios auth.privilegio[];
begin

  _const := map.constant();
  -- Desativar todos os menus que não farão parte desse perfil
  update auth.privilegio
    set privilegio_estado = _const.privilegio_estado_fechado,
        privilegio_dataatualuzacao = current_timestamp,
        privilegio_colaborador_atualizacao = arg_colaborador_id
    where previlegio_perfil_id = arg_perfil_id
      and privilegio_estado = _const.perfil_estado_ativo
      and privilegio_menu_id != all( arg_menu_list )
  ;

  -- Associar os novos menus ao perfil
  insert into auth.privilegio(
    previlegio_perfil_id,
    privilegio_menu_id,
    privilegio_colaborador_id
  ) select
      arg_perfil_id,
      me.menu_id,
      arg_colaborador_id
    from unnest( arg_menu_list ) m( id )
      inner join auth.menu me on m.id = me.menu_id
      left join auth.privilegio pri on me.menu_id = pri.privilegio_menu_id
        and pri.privilegio_estado = _const.privilegio_estado_ativo
    where pri.privilegio_id is null
  ;

  -- Obter todos os privilegios associados ao perfil
  select array_agg( pri ) into arg_privilegios
    from auth.privilegio pri
    where pri.previlegio_perfil_id = arg_perfil_id
      and pri.privilegio_estado = _const.privilegio_estado_ativo
  ;

  return lib.result_true(
    jsonb_build_object(
      'privilegios', arg_privilegios
    )
  );
end;
$$;


--
-- TOC entry 417 (class 1255 OID 16489)
-- Name: funct_reg_trabalha(jsonb); Type: FUNCTION; Schema: auth; Owner: -
--

CREATE FUNCTION auth.funct_reg_trabalha(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para registar os locas que um colaborador pode trabalhar
    args := {
      arg_espaco_auth: ID
      arg_colaborador_id: ID,
      arg_colaborador_propetario: ID,
      _branch_uid: UID
      arg_espaco : [
        { arg_espaco_id: ID }
      ]
    }
  */
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_auth uuid  not null default args->>'arg_espaco_auth';
  arg_espaco_child uuid[ ] default rule.espaco_get_childrens( arg_espaco_auth );
  arg_colaborador_propetario uuid default args->>'arg_colaborador_propetario';
  arg_espaco uuid[ ] not null default array ( select ( el.doc->>'arg_espaco_id' )::uuid from jsonb_array_elements( args->'arg_espaco' ) el ( doc ) );
  _const map.constant;
  _branch  tweeks.branch;
begin
  _const := map.constant();
  _branch := tweeks._get_branch_by_colaborador( arg_colaborador_propetario );


  -- Fechar todos os espaços em que o colaborador não vai mais trabalhar
  update tweeks.trabalha
    set trabalha_estado = _const.maguita_trabalha_estado_fechado,
        trabalha_colaborador_atualizacao = arg_colaborador_id,
        trabalha_dataatualizacao = current_timestamp
    where trabalha_estado = _const.maguita_trabalha_estado_ativo
      and trabalha_colaborador_proprietario = arg_colaborador_propetario
      and trabalha_espaco_auth = any( arg_espaco_child )
      and _branch_uid = _branch.branch_uid

  ;

  insert into tweeks.trabalha (
    trabalha_colaborador_id,
    trabalha_colaborador_proprietario,
    trabalha_perfil_id,
    trabalha_espaco_destino,
    trabalha_espaco_auth,
    _branch_uid
  ) select arg_colaborador_id,
      arg_colaborador_propetario,
      null,
      es.arg_espaco_id,
      arg_espaco_auth,
     _branch.branch_uid
    from unnest( arg_espaco ) es ( arg_espaco_id )
  ;

  return true ? jsonb_build_object(
    'trabalha', array(
      select tr
        from tweeks.trabalha tr
        where tr.trabalha_estado = _const.maguita_trabalha_estado_ativo
          and tr.trabalha_colaborador_proprietario = arg_colaborador_propetario
    )
  );
end;
$$;


--
-- TOC entry 418 (class 1255 OID 16490)
-- Name: __transaction_uid(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__transaction_uid() RETURNS uuid
    LANGUAGE sql IMMUTABLE STRICT
    AS $$select gen_random_uuid();$$;


--
-- TOC entry 233 (class 1259 OID 16491)
-- Name: collector; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.collector (
    collector_transuid uuid DEFAULT cluster.__transaction_uid() NOT NULL,
    collector_uid uuid DEFAULT gen_random_uuid() NOT NULL,
    collector_share_regclass character varying NOT NULL,
    collector_cluster_origin uuid NOT NULL,
    collector_sequence bigint NOT NULL,
    collector_order bigint,
    collector_minseq bigint,
    collector_maxseq bigint,
    collector_ref jsonb,
    collector_metadata jsonb,
    collector_old jsonb,
    collector_date timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    collector_version boolean DEFAULT false NOT NULL,
    collector_pid bigint DEFAULT pg_backend_pid(),
    collector_operation character(1),
    collector_remoteold jsonb,
    collector_originold jsonb,
    collector_changes character varying[] DEFAULT ARRAY[]::text[] NOT NULL,
    collector_metaapply jsonb,
    collector_changevalue jsonb,
    collector_usechage jsonb
);


--
-- TOC entry 5614 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN collector.collector_ref; Type: COMMENT; Schema: cluster; Owner: -
--

COMMENT ON COLUMN cluster.collector.collector_ref IS 'Correspondem as chaves de acesso ao objecto real';


--
-- TOC entry 5615 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN collector.collector_metadata; Type: COMMENT; Schema: cluster; Owner: -
--

COMMENT ON COLUMN cluster.collector.collector_metadata IS 'São os dados do proprio objecto real';


--
-- TOC entry 633 (class 1255 OID 16502)
-- Name: __add(regclass); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__add(_regclass regclass) RETURNS SETOF cluster.collector
    LANGUAGE plpgsql
    AS $_$
declare
  /**
    PROPOSE: Coletar nova modificação ocoridas numa tabela que ainda não foram versionadas,
      coletadas ou que a versão esteje ultrapassadas
   */
  _share cluster.share;
  _statement text;
begin
  select s.* into _share
    from cluster.share s
    where s.share_regclass = _regclass
  ;

  -- language=PostgreSQL
  _statement :=  $sql$
    with
      __unvercollector as (
        select
          uvcol.*,
          rank() over ( partition by uvcol.collector_ref order by uvcol.collector_sequence desc ) as rank
        from cluster.collector uvcol
        where not uvcol.collector_version
          and uvcol.collector_share_regclass = ($1::cluster.share).share_regclass
      ), __object as (
        select
            o.*,
            rank() over ( partition by o.object_ref order by o.object_seq desc ) as rank
          from cluster.object o
          where o.object_share_regclass = ($1::cluster.share).share_regclass
      ), __change as (
        select
            to_jsonb( _t ) as change,
            lib.sets_ref( to_jsonb( _t ), ($1::cluster.share).share_pks ) as ref
          from _$table as _t
      ), __news as (
        select _c.*, coalesce( uvcol.collector_metadata, vcol.collector_metadata ) as collector_metadata
          from __change _c
            left join  __object _ol on _ol.object_ref = _c.ref
              and _ol.rank = 1
            left join cluster.collector vcol on vcol.collector_uid = _ol.object_collector_uid
            left join __unvercollector uvcol on not uvcol.collector_version
              and uvcol.rank = 1
              and uvcol.collector_share_regclass = ( $1::cluster.share ).share_regclass
              and uvcol.collector_ref = _c.ref
        where (vcol.collector_uid is null or vcol.collector_metadata != _c.change)
          and ( uvcol.collector_uid is null or uvcol.collector_metadata != _c.change )
      ) select col.*
          from __news _n
            inner join cluster.__collect_change(
              ( $1::cluster.share ).share_regclass,
              _n.change,
              _n.collector_metadata,
              case when _n.collector_metadata is null then 'I' else 'U' end,
              ref
            ) col on true
  $sql$;

  _statement := replace( _statement, '_$table'::text, _regclass::text );
  return query execute _statement using _share;
end;
$_$;


--
-- TOC entry 558 (class 1255 OID 16503)
-- Name: __collect_change(regclass, jsonb, jsonb, character, jsonb, boolean); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__collect_change(regclass, _change jsonb, _old jsonb DEFAULT NULL::jsonb, _operation character DEFAULT 'I'::bpchar, _ref jsonb DEFAULT NULL::jsonb, _force boolean DEFAULT false) RETURNS SETOF cluster.collector
    LANGUAGE plpgsql
    AS $_$
declare
  _collector cluster.collector;
  _origin uuid default '00000000-0000-0000-0000-000000000000'::uuid;
begin
  if not _force and _change is null then return; end if;
  if not _force and _old is not null and _change = _old then return; end if;

  _collector.collector_share_regclass := cluster.__format( $1 );
  _collector.collector_metadata := _change;
  _collector.collector_changes := array(
    select e.key
      from jsonb_each( _change||coalesce( _old, jsonb_build_object() ) ) e( key, value )
      where _old isnull
        or _change -> ( e.key ) != _old ->( e.key )
  );

  _collector.collector_changevalue = (
    select jsonb_object_agg( e.key, e.value )
    from jsonb_each( _change||coalesce( _old, jsonb_build_object() ) ) e( key, value )
    where _old isnull
       or _change -> ( e.key ) != _old ->( e.key )
  );

  insert into cluster.collector(
    collector_share_regclass,
    collector_metadata,
    collector_metaapply,
    collector_changevalue,
    collector_changes,
    collector_cluster_origin,
    collector_old,
    collector_originold,
    collector_operation,
    collector_ref
  ) values (
    _collector.collector_share_regclass,
    _collector.collector_metadata,
    _collector.collector_metadata,
    _collector.collector_changevalue,
    _collector.collector_changes,
    _origin,
    _old,
    _old,
    coalesce( _operation, case
      when _old is null then 'I'
      else 'U'
    end),
    _ref
  ) returning * into _collector;

  return next _collector;
end;
$_$;


--
-- TOC entry 634 (class 1255 OID 16504)
-- Name: __create_api(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__create_api() RETURNS character varying
    LANGUAGE plpgsql
    AS $$
  declare
    _leter character varying default 'ABCDEFGHIJKLMNOQRSTUVWXYZ';
  begin
    return format( '%s', lib.dset_random_text( _leter || '0123456789', 128 ) );
  end;
$$;


--
-- TOC entry 629 (class 1255 OID 16505)
-- Name: __create_identifier(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__create_identifier() RETURNS character varying
    LANGUAGE plpgsql
    AS $$
  declare
    _leter character varying default 'ABCDEFGHIJKLMNOQRSTUVWXYZ';
  begin
    return format(
    '%s-%s-%s',
    lib.dset_random_text( _leter, 4 ),
    lib.dset_random_text( _leter||'0123456789', 5 ),
    lib.dset_random_text( '0123456789', 3 )
  );
  end;
$$;


--
-- TOC entry 234 (class 1259 OID 16506)
-- Name: version; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.version (
    version_uid uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    version_share_regclass character varying NOT NULL,
    version_cluster_id uuid NOT NULL,
    version_number bigint DEFAULT 0 NOT NULL
);


--
-- TOC entry 641 (class 1255 OID 16513)
-- Name: __create_object_version(regclass); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__create_object_version(regclass) RETURNS cluster.version
    LANGUAGE plpgsql
    AS $_$
declare
  declare
  _regclass regclass default cluster.__format( $1 );
  _share record;
  _object cluster.object;
  _cluster cluster.cluster;
  _version cluster.version;
  _data record;
  _results record;
  _pid int default pg_backend_pid();
begin
  _cluster := cluster._get_cluster_local(  );
  _version := cluster._get_version_local( _regclass );

  select s.* into _share
    from cluster.share s
    where s.share_regclass::regclass = _regclass;

  _object.object_share_regclass := _share.share_regclass;
  _object.object_cluster_origin := _cluster.cluster_uid;
  _object.object_cluster_receiver := _cluster.cluster_uid;

  with __objects as (
    select
      count( o.object_uid )  as _object_localversion,
      count( o.object_uid ) filter ( where o.object_share_regclass::regclass = _regclass and o.object_cluster_origin = _cluster.cluster_uid )  as _object_originsseq,
      count( o.object_uid ) filter ( where o.object_share_regclass::regclass = _regclass  )  as _object_sseq
      from cluster.object o
  ), __collectors as (
    select
      count( c.collector_uid ) as collectors,
      min( c.collector_sequence ) as _collector_minseq,
      max( c.collector_sequence ) as _collector_maxseq
    from cluster.collector c
    where not c.collector_version
      and c.collector_share_regclass::regclass = _regclass
      and c.collector_cluster_origin = _cluster.cluster_uid
      and c.collector_pid = _pid
      and c.collector_ref is null
  ) select * into _data from __collectors, __objects;

  if _data.collectors = 0 then return _version; end if;

  with __apply_collector as  (
      update cluster.collector c
        set
          collector_version = true,
          collector_ref = lib.sets_ref( coalesce( collector_old, collector_metadata ), _share.share_pks ),
          collector_order = c.collector_sequence - _data._collector_minseq +1,
          collector_minseq = _data._collector_minseq,
          collector_maxseq = _data._collector_maxseq
        where not c.collector_version
          and c.collector_share_regclass::regclass = _regclass
          and c.collector_ref is null
          and c.collector_pid = _pid
          and c.collector_cluster_origin = _cluster.cluster_uid
        returning
          c.collector_transuid,
          c.collector_uid,
          c.collector_sequence,
          c.collector_minseq,
          c.collector_maxseq,
          c.collector_share_regclass,
          c.collector_ref,
          c.collector_metadata,
          c.collector_date,
          c.collector_order
      ) ,__creat_object as (
        insert into cluster.object (
          object_ref,
          object_transuid,
          object_share_regclass,
          object_cluster_origin,
          object_cluster_receiver,
          object_originver,
          object_originsver,
          object_origincver,
          object_originsseq,
          object_sseq,
          object_originrev,
          object_collector_uid
        ) select
              _ac.collector_ref,
              _ac.collector_transuid,
              cluster.__format( _regclass ),
              _object.object_cluster_origin,
              _object.object_cluster_receiver,
              _ac.collector_sequence,
              _version.version_number,
              _cluster.cluster_version,
              _data._object_originsseq + _ac.collector_order,
              _data._object_sseq + _ac.collector_order,
              count( col.collector_uid )+1,
              _ac.collector_uid
            from __apply_collector  _ac
              left join cluster.collector col on  _ac.collector_ref = col.collector_ref
                and _ac.collector_uid != col.collector_uid
            group by
              _regclass,
              _object.object_cluster_origin,
              _object.object_cluster_receiver,
              _version.version_number,
              _ac.collector_order,
              _ac.collector_sequence,
              _ac.collector_ref,
              _ac.collector_metadata,
              _ac.collector_uid,
              _ac.collector_transuid
            order by _ac.collector_sequence
            returning
                object_uid,
                object_originver,
                object_transuid,
                object_seq,
                object_cluster_origin,
                object_share_regclass,
                object_collector_uid
      )
      select
          count( o.object_uid ) as objects,
          max( o.object_originver ) as object_originver,
          max( c.collector_sequence ) as collector_sequence,
          max( o.object_seq ) as object_seq
        into _results
      from __creat_object o
        inner join cluster.collector c on c.collector_uid = o.object_collector_uid
          and c.collector_transuid = o.object_transuid
          and c.collector_cluster_origin = o.object_cluster_origin
          and c.collector_share_regclass = o.object_share_regclass
  ;

  if _results.objects > 0 then
      update cluster.version
        set version_number = version_number +1
        where version_uid = _version.version_uid
        returning  * into _version
      ;
  end if;

  if _results.objects > 0 then
      update cluster.cluster
        set cluster_sequence = _results.object_seq,
            cluster_version = cluster_version +1,
            cluster_objectver = _results.object_originver
        where cluster_uid = _cluster.cluster_uid;
  end if;

  return _version;
end;
$_$;


--
-- TOC entry 424 (class 1255 OID 16514)
-- Name: __format(regclass); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__format(regclass) RETURNS character varying
    LANGUAGE sql STABLE STRICT
    AS $_$
  with __source as (
    select schemaname, tablename
      from pg_tables 
    union all 
      select schemaname, viewname
        from pg_views
  )
    select format( '%I.%I', schemaname, tablename )
      from __source
      where format( '%s.%s', schemaname, tablename )::regclass = $1
$_$;


--
-- TOC entry 419 (class 1255 OID 16515)
-- Name: __format_proc(regproc); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__format_proc(regproc) RETURNS character varying
    LANGUAGE sql STABLE STRICT
    AS $_$
select format( '%I.%I', p.pronamespace::regnamespace::text, p.proname::text  )
  from pg_proc p
  where format( '%I.%I', p.pronamespace::regnamespace::text, p.proname::text  )::regproc = $1
$_$;


--
-- TOC entry 642 (class 1255 OID 16516)
-- Name: __generate_cluster_code(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__generate_cluster_code() RETURNS character varying
    LANGUAGE plpgsql
    AS $$
declare
  chars character varying default '0123456789';
  code character varying;
  repeate integer default 0;
  codeLen integer default 3;
begin
  while code is null loop
    code := lib.dset_random_text( chars, codeLen );
    if exists(
        select *
          from cluster.cluster
          where  code in ( cluster.cluster_code, lpad('', codeLen, '0' ) )
    ) then
      code := null;
      if repeate  = 9999 then
        chars := '012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      elseif repeate = 99999 then
        chars := '012345678901234567890123456789012345678901234567890123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      elseif repeate = 999999 then
        chars := '012345678901234567890123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      elseif repeate = 9999999 then
        chars := '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      elseif repeate = 99999999 then
        raise exception 'O sistema não consegue determinar um codigo para o cluster';
      end if;
    end if;
    repeate := repeate +1;
  end loop;

  return code;
end;
$$;


--
-- TOC entry 420 (class 1255 OID 16517)
-- Name: __get(regclass, jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__get(regclass, jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $_$
declare

begin
  --language=PostgreSQL
  return query execute replace( $sql$
    select to_jsonb( _t )
      from __tablename _t
      where lib.sets_ref( _t ) = $1
  $sql$, '__tablename', $1::text ) using $2;
end;
$_$;


--
-- TOC entry 421 (class 1255 OID 16518)
-- Name: __is_replication(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__is_replication() RETURNS boolean
    LANGUAGE plpgsql STABLE
    AS $$
declare
  _users cluster.users;
begin
  _users := cluster.__user_map();
  return _users.user_replication is not null
    and _users.user_replication = "current_user"()::regrole;
end;
$$;


--
-- TOC entry 630 (class 1255 OID 16519)
-- Name: __is_sub_path(text, text); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__is_sub_path(base text, child_path text) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
declare
  _left text;
  _right text;
  _right_char char;
  _left_char char;
begin
  if child_path is null or base is null then return false; end if;
  if substr( base, length( base ) ) = '/' then base := substr( base, 1, length( base )-1 ); end if;
  if substr( child_path, length( child_path ) ) = '/' then child_path := substr( child_path, 1, length( child_path )-1 ); end if;

  if length( base ) >= length( child_path ) then return false; end if;

  _left := substr( child_path, 1, length(  base ) );
  _right := substr( child_path, length( base ) +1, length( child_path ) );
  _right_char := (regexp_split_to_array( _right, '' ) )[1];
  _left_char := (regexp_split_to_array( _left, '' ) )[1];


  return _left is not  null
    and _right is not null
    and _right_char is not null
    and _left = base
    and _right_char = '/'
  ;
end
$$;


--
-- TOC entry 422 (class 1255 OID 16520)
-- Name: __pks(regclass); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__pks(regclass) RETURNS name[]
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
  select array(
    select pk.name
      from lib.sets_pks( $1 ) pk( name )
  );
$_$;


--
-- TOC entry 235 (class 1259 OID 16521)
-- Name: object; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.object (
    object_transuid uuid DEFAULT cluster.__transaction_uid() NOT NULL,
    object_uid uuid DEFAULT gen_random_uuid() NOT NULL,
    object_share_regclass character varying NOT NULL,
    object_cluster_origin uuid NOT NULL,
    object_cluster_receiver uuid,
    object_collector_uid uuid,
    object_ref jsonb NOT NULL,
    object_seq bigint NOT NULL,
    object_sseq bigint NOT NULL,
    object_originver bigint NOT NULL,
    object_originsver bigint NOT NULL,
    object_origincver bigint NOT NULL,
    object_originsseq bigint NOT NULL,
    object_originrev bigint NOT NULL,
    object_date timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    object_instant timestamp with time zone DEFAULT clock_timestamp() NOT NULL,
    object_receiver timestamp with time zone DEFAULT clock_timestamp() NOT NULL,
    object_sync boolean DEFAULT true NOT NULL,
    object_status smallint DEFAULT 1 NOT NULL,
    object_outdate boolean DEFAULT false NOT NULL
);


--
-- TOC entry 5630 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN object.object_uid; Type: COMMENT; Schema: cluster; Owner: -
--

COMMENT ON COLUMN cluster.object.object_uid IS 'Identificador unico do objecto';


--
-- TOC entry 5631 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN object.object_share_regclass; Type: COMMENT; Schema: cluster; Owner: -
--

COMMENT ON COLUMN cluster.object.object_share_regclass IS 'Correspone a tabela na qual o objecto pertense';


--
-- TOC entry 5632 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN object.object_cluster_origin; Type: COMMENT; Schema: cluster; Owner: -
--

COMMENT ON COLUMN cluster.object.object_cluster_origin IS 'Corresponde ao cluster/maquina/pc na qual foi responsavel pela criação do objecto';


--
-- TOC entry 5633 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN object.object_cluster_receiver; Type: COMMENT; Schema: cluster; Owner: -
--

COMMENT ON COLUMN cluster.object.object_cluster_receiver IS 'Corresponde ao cluster/maquina/pc na qual recebeu-se o objecto';


--
-- TOC entry 5634 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN object.object_seq; Type: COMMENT; Schema: cluster; Owner: -
--

COMMENT ON COLUMN cluster.object.object_seq IS 'Corresponde a sequencia da ordem de entrada do objecto independente da origem e da regclass';


--
-- TOC entry 5635 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN object.object_sseq; Type: COMMENT; Schema: cluster; Owner: -
--

COMMENT ON COLUMN cluster.object.object_sseq IS 'Corresponde a sequencia de entrada do objecto na tabela independentemente da origem';


--
-- TOC entry 5636 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN object.object_originver; Type: COMMENT; Schema: cluster; Owner: -
--

COMMENT ON COLUMN cluster.object.object_originver IS 'Versão global do objecto';


--
-- TOC entry 5637 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN object.object_originsver; Type: COMMENT; Schema: cluster; Owner: -
--

COMMENT ON COLUMN cluster.object.object_originsver IS 'Versão do share (table/regclss) as criar o objecto';


--
-- TOC entry 5638 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN object.object_origincver; Type: COMMENT; Schema: cluster; Owner: -
--

COMMENT ON COLUMN cluster.object.object_origincver IS 'Versão em que o cluster que criou o objecto';


--
-- TOC entry 5639 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN object.object_originsseq; Type: COMMENT; Schema: cluster; Owner: -
--

COMMENT ON COLUMN cluster.object.object_originsseq IS 'Numero de sequencia dentro do share';


--
-- TOC entry 5640 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN object.object_originrev; Type: COMMENT; Schema: cluster; Owner: -
--

COMMENT ON COLUMN cluster.object.object_originrev IS 'Reivisao, ordem de mofificação ocorrida no objecto original';


--
-- TOC entry 5641 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN object.object_date; Type: COMMENT; Schema: cluster; Owner: -
--

COMMENT ON COLUMN cluster.object.object_date IS 'Corresponde ao instante em que foi criado a versão do objecto';


--
-- TOC entry 423 (class 1255 OID 16534)
-- Name: __pull(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__pull(args jsonb) RETURNS cluster.object
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      _classname: CLASS.NAME

      _current: JSONB
      _change: JSONB
      _outdate: BOOLEAN

      _origin: UID
      _receiver: UID

      _result: BOOLEAN
      _exist_object BOOLEAN
      _exist_collector BOOLEAN

      _object: CLUSTER.OBJECT
      _collector: CLUSTER.COLLECTOR
    }
   */
  _ref jsonb;
  _object cluster.object;
  _collector cluster.collector;

  _regclass regclass default (args->>'_classname')::text::regclass;
  _current jsonb default args->'_current';
  _change jsonb default args->'_change';
  _use_change jsonb;


  _origin uuid default args->>'_origin';
  _receiver uuid default args->>'_receiver';

  _outdate boolean not null default args->>'_outdate';
  _result boolean not null default args->>'_result';
  _exist_collector boolean default args->>'_exist_collector';
  _exist_object boolean default args->>'_exist_object';
  _metadata jsonb;


  _res cluster.object;
begin

  _object := jsonb_populate_record( _object, args->'_object' );
  _collector := jsonb_populate_record( _collector, args->'_collector' );
  _use_change := _change;

  if _current is not null and jsonb_typeof( _current ) != 'object' then
    _current := null;
  end if;

  _ref := coalesce( _object.object_ref, _collector.collector_ref, lib.sets_ref( _regclass, _collector.collector_metadata ) );
  _object.object_ref := _ref;
  _collector.collector_ref := _ref;

  if _ref is null then
    raise exception 'pull reference is null';
  end if;

  if _change is null or  jsonb_typeof( _change ) != 'object' or not exists(
    select * from jsonb_each( _change )
  ) then
    _use_change := _collector.collector_metadata;
  end if;

  if _current is null  then
    _metadata := _collector.collector_metadata;
  else
    _metadata := _current || _use_change;
  end if;

  if _regclass = 'cluster.resource'::regclass then
    _object.object_status := 2;
  else
    _object.object_status := 1;
  end if;

  _collector.collector_cluster_origin = _origin;
  _collector.collector_old = _current;
  _collector.collector_share_regclass = cluster.__format( _regclass );
  _collector.collector_ref = _object.object_ref;
  _collector.collector_metaapply = _metadata;
  _collector.collector_changevalue = _change;
  _collector.collector_usechage = _use_change;

  begin
    if not _outdate and _result and ( _current is null or _current != _metadata ) then
      perform lib.sets_doc(
        _regclass, _metadata,
        ref := _ref
      );
    end if;

    if not coalesce( _exist_collector, false ) then
      insert into cluster.collector (
        collector_transuid,
        collector_uid,
        collector_share_regclass,
        collector_cluster_origin,
        collector_sequence,
        collector_order,
        collector_minseq,
        collector_maxseq,
        collector_ref,
        collector_metadata,
        collector_date,
        collector_version,
        collector_operation,
        collector_old,
        collector_remoteold,
        collector_originold,
        collector_changes,
        collector_metaapply,
        collector_changevalue,
        collector_usechage
      ) values (
         _collector.collector_transuid,
         _collector.collector_uid,
         _collector.collector_share_regclass,
         _collector.collector_cluster_origin,
         _collector.collector_sequence,
         _collector.collector_order,
         _collector.collector_minseq,
         _collector.collector_maxseq,
         _collector.collector_ref,
         _collector.collector_metadata,
         _collector.collector_date,
         _collector.collector_version,
         _collector.collector_operation,
         _collector.collector_old,
         _collector.collector_old,
         _collector.collector_originold,
         _collector.collector_changes,
         _collector.collector_metaapply,
         _collector.collector_changevalue,
         _collector.collector_usechage
       );
    end if;

    if not coalesce( _exist_object, false ) then
      insert into cluster.object(
        object_transuid,
        object_uid,
        object_share_regclass,
        object_cluster_origin,
        object_cluster_receiver,
        object_collector_uid,
        object_ref,
        object_seq,
        object_sseq,
        object_originver,
        object_originsver,
        object_origincver,
        object_originsseq,
        object_originrev,
        object_date,
        object_instant,
        object_receiver,
        object_status,
        object_outdate
      ) values (
         _collector.collector_transuid,
         _object.object_uid,
         cluster.__format( _regclass ),
         _origin,
         _receiver,
         _collector.collector_uid,
         _object.object_ref,
         default,
         default,
         _object.object_originver,
         _object.object_originsver,
         _object.object_origincver,
         _object.object_originsseq,
         _object.object_originrev,
         _object.object_date,
         _object.object_instant,
         now(),
         _object.object_status,
         _outdate
       ) returning * into _res;
    else
      select * into _res
        from cluster.object ob
        where true
          and ob.object_uid = _object.object_uid
          and ob.object_collector_uid = _collector.collector_uid
          and ob.object_transuid = _collector.collector_transuid
          and ob.object_ref = _object.object_ref
          and ob.object_share_regclass = cluster.__format( _regclass )
      ;
    end if;

    if _outdate then return null;
    else return _res;
    end if;

  exception when others then
    <<_ex>>
    declare
      s text; m text; d text; h text; c text;
    begin
      get stacked diagnostics
        s = returned_sqlstate,
        m = message_text,
        d = pg_exception_detail,
        h = pg_exception_hint,
        c = pg_exception_context;

      insert into cluster.break(
        break_collector,
        break_object,
        break_old,
        break_regclass,
        break_origin,
        break_receiver,
        break_sqlstate,
        break_message,
        break_detail,
        break_hint,
        break_context,
        break_ref,
        break_current,
        break_change,
        break_metadata,
        break_document
      ) values (
        to_jsonb( _collector),
        to_jsonb( _object ),
        _current,
        cluster.__format( _regclass ),
        _origin,
        _receiver,
        _ex.s,
        _ex.m,
        _ex.d,
        _ex.h,
        _ex.c,
        _object.object_ref,
        _current,
        _change,
        _metadata,
        _collector.collector_metadata
      );
      return null;
    end;
  end;
end
$$;


--
-- TOC entry 864 (class 1255 OID 19613)
-- Name: __rows(regclass[]); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__rows(VARIADIC regclass[]) RETURNS TABLE(document jsonb, reference jsonb, classname regclass)
    LANGUAGE plpgsql
    AS $_$
declare
  _next record;
  _regclass regclass;
begin

  for _next in
    select *
    from unnest( $1 ) n( tname )
    loop
      _regclass := _next.tname::regclass;

      return query execute format( $sql$
        select
          to_jsonb( _t ),
          lib.sets_ref( _t ),
          %L::regclass
          from %s _t
        $sql$, _regclass, _regclass ) using $2;
    end loop;
end;
$_$;


--
-- TOC entry 631 (class 1255 OID 16536)
-- Name: __tg_before_create_filter(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__tg_before_create_filter() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  _new cluster.filter;
begin
  _new := new;
  _new.filter_regproc := cluster.__format_proc( _new.filter_regproc::regproc );
  return _new;
end
$$;


--
-- TOC entry 883 (class 1255 OID 16537)
-- Name: __tg_share_check(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__tg_share_check() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
begin
  if( to_regclass( new.share_regclass ) is null ) then
    raise exception '% is not a table', new.share_regclass;
  end if;
  new.share_regclass := cluster.__format( new.share_regclass );
  new.share_pksfrom := cluster.__format( new.share_pksfrom );
  new.share_pks := lib.sets_pks_array( coalesce( new.share_pksfrom, new.share_regclass ) );
  return new;
end;
$$;


--
-- TOC entry 514 (class 1255 OID 16538)
-- Name: __tg_share_guard_upgrade(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__tg_share_guard_upgrade() RETURNS event_trigger
    LANGUAGE plpgsql
    AS $$
declare
  _regclass regclass;
  _share cluster.share;
  _record record;
begin
  for _record  IN
    select *
      from pg_event_trigger_ddl_commands()
      where tg_tag in ( 'ALTER TABLE', 'CREATE TABLE' )
  loop
    _regclass := _record.object_identity;
    select * into _share
      from cluster.share s
      where s.share_regclass::regclass = _regclass;

    if _share.share_regclass::regclass is not null then
      update cluster.share
        set share_pks = default
        where share_regclass = _regclass;
      end if;
  end loop;
end;
$$;


--
-- TOC entry 643 (class 1255 OID 16539)
-- Name: __tg_share_map(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__tg_share_map() RETURNS trigger
    LANGUAGE plpgsql
    AS $_$
declare
  PROCEDURE_COMMIT regprocedure default 'cluster.__tg_version_commit()'::regprocedure;
  PROCEDURE_ADD_INSERT regprocedure default 'cluster.__tg_version_add_when_insert()'::regprocedure;
  PROCEDURE_ADD_UPDATE regprocedure default 'cluster.__tg_version_add_when_update()'::regprocedure;

  _new cluster.share;
  _old cluster.share;
  _share record;
  _data record;
  _base_name character varying;
  _trigger_name name;
  _statement text;
  _tg record;
begin
  if tg_op in ( 'INSERT', 'UPDATE' ) then
    _new := new;
    select
        c.relname as table_name,
        c.relnamespace::regnamespace::text as table_scheme,
        _new.*
        into _share
      from pg_class c
      where c.oid::regclass = _new.share_regclass::regclass;
  end if;


  if tg_op in ( 'UPDATE', 'DELETE' ) then
    _old := old;
  end if;

  if tg_when = 'BEFORE' then
    if _old.share_regclass is not null and _old.share_triggers is not null and array_length( _old.share_triggers, 1 ) > 0 then
      for _data in
        select *  from unnest( _old.share_triggers ) u( trigger_name )
      loop
        begin 
          execute format( 'drop trigger %I on %s', _data.trigger_name, _old.share_regclass );
        exception when others then null;
        end;
      end loop;
    end if;
  end if;

  if tg_when = 'BEFORE' and _new.share_regclass is not null then
    select array_agg( tgname ) as triggers into _data
      from pg_trigger tg
      where tg.tgrelid::regclass = _new.share_regclass::regclass
    ;

    _new.share_triggers := array[]::name[];
    for _tg in
      with __when ( _tg_op, _for, _procedure ) as (
        select 'insert', 'each row', PROCEDURE_ADD_INSERT where _new.share_insert
        union all select 'insert', 'each statement', PROCEDURE_COMMIT where _new.share_insert
        union all select 'update', 'each row', PROCEDURE_ADD_UPDATE where _new.share_update
        union all select 'update', 'each statement', PROCEDURE_COMMIT where _new.share_update
      ) select *
      from __when w
    loop

      if _tg._for  = 'each row' then
        _base_name := format( 'cluster_version_add_change_after_%s_on_%s_%s', _tg._tg_op, _share.table_scheme, _share.table_name );
      else
        _base_name := format( 'cluster_version_commit_change_%s_on_%s_%s', _tg._tg_op, _share.table_scheme, _share.table_name );
      end if;

      _trigger_name := format( '%s_%s', _base_name, ( random() * (999999 - 100000 )+100000)::int );
      while _trigger_name = any( _data.triggers ) loop
        _trigger_name := format( '%s_%s', _base_name, ( random() * (999999 - 100000 )+100000)::int );
      end loop;

      --language=PostgreSQL
      _statement := $sql$
        create trigger _tg_name
          after delete
          on _table_name
          for statement
          when ( not cluster.__is_replication() )
          execute procedure _use_procedure
        ;
      $sql$;

      _statement := replace( _statement, '_tg_name', '%I' );
      _statement := replace( _statement, 'delete', '%s' );
      _statement := replace( _statement, '_table_name', '%s' );
      _statement := replace( _statement, 'statement', '%s' );
      _statement := replace( _statement, '_use_procedure', '%s' );
      _statement := format( _statement, _trigger_name, _tg._tg_op, _new.share_regclass::text, _tg._for, _tg._procedure );
      
      begin 
        execute _statement;
      exception when others then null;
      end;
      _new.share_triggers := _new.share_triggers || _trigger_name;
      _data.triggers := _data.triggers || _trigger_name;
    end loop;
  end if;

  if tg_when = 'BEFORE' and tg_op in (  'INSERT', 'UPDATE' ) then
    return _new;
  elseif tg_when = 'BEFORE' and tg_op in( 'DELETE' ) then
    return _old;
  end if;

  return null;
end;
$_$;


--
-- TOC entry 425 (class 1255 OID 16540)
-- Name: __tg_share_truncate(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__tg_share_truncate() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  _add_insert regprocedure default 'cluster.__tg_version_add_when_insert()'::regprocedure;
  _add_update regprocedure default 'cluster.__tg_version_add_when_update()'::regprocedure;
  _commit regprocedure default 'cluster.__tg_version_commit()'::regprocedure;
  _data record;
begin
  for _data in
    select
      tg.tgrelid::regclass::text as share_regclass,
      tg.tgname as trigger_name,
      tg.*
    from pg_trigger tg
    where tg.tgfoid in( _add_insert, _add_update, _commit )
  loop
    begin
      execute format( 'drop trigger %I on %s', _data.trigger_name, _data.share_regclass );
    exception when others then null;
    end;
  end loop;
  return null;
end;
$$;


--
-- TOC entry 426 (class 1255 OID 16541)
-- Name: __tg_version_add_when_insert(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__tg_version_add_when_insert() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
begin
  perform cluster.__collect_change(
      tg_relid::regclass,
      to_jsonb( new )
    );
  return null;
end;
$$;


--
-- TOC entry 427 (class 1255 OID 16542)
-- Name: __tg_version_add_when_update(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__tg_version_add_when_update() RETURNS trigger
    LANGUAGE plpgsql
    AS $$

begin
  perform cluster.__collect_change(
    tg_relid::regclass,
    to_jsonb( new ),
    to_jsonb( old ),
    'U'
  );
  return null;
end;
$$;


--
-- TOC entry 428 (class 1255 OID 16543)
-- Name: __tg_version_commit(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__tg_version_commit() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  declare
  _regclass regclass default format( '%s.%s', tg_table_schema, tg_table_name )::regclass;

begin

  if cluster.__is_replication() then
    return null;
  end if;

  perform cluster.__create_object_version( _regclass );
  return null;
end;
$$;


--
-- TOC entry 429 (class 1255 OID 16544)
-- Name: __user_default(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__user_default() RETURNS regrole
    LANGUAGE sql STABLE
    AS $$select user_default from cluster.users limit 1$$;


--
-- TOC entry 236 (class 1259 OID 16545)
-- Name: users; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.users (
    user_default regrole NOT NULL,
    user_replication regrole
);


--
-- TOC entry 515 (class 1255 OID 16548)
-- Name: __user_map(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__user_map() RETURNS cluster.users
    LANGUAGE sql STABLE
    AS $$
  select * from cluster.users limit 1;
$$;


--
-- TOC entry 516 (class 1255 OID 16549)
-- Name: __user_replication(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.__user_replication() RETURNS regrole
    LANGUAGE sql STABLE
    AS $$select user_replication from cluster.users limit 1$$;


--
-- TOC entry 517 (class 1255 OID 16550)
-- Name: _cluster_accept_child(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster._cluster_accept_child(args jsonb) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
declare
  _cluster cluster.cluster;
  _const map.constant;
begin
  _cluster := jsonb_populate_record( _cluster, args );
  _const := map.constant();
  return exists(
    select *
      from cluster.cluster c
      where c.cluster_identifier = _cluster.cluster_identifier
        and c.cluster_type = _const.cluster_tcluster_child
        and c.cluster_api = _cluster.cluster_api
  );
end;
$$;


--
-- TOC entry 237 (class 1259 OID 16551)
-- Name: cluster; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.cluster (
    cluster_uid uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    cluster_identifier character varying,
    cluster_type smallint,
    cluster_path character varying,
    cluster_name character varying,
    cluster_domain character varying,
    cluster_port character varying,
    cluster_api character varying,
    cluster_pid integer,
    cluster_version bigint DEFAULT 0 NOT NULL,
    cluster_sequence bigint DEFAULT 0 NOT NULL,
    cluster_objectver bigint DEFAULT 0 NOT NULL,
    cluster_grants character varying[] DEFAULT ARRAY[]::text[] NOT NULL,
    cluster_configs jsonb DEFAULT jsonb_build_object() NOT NULL,
    cluster_tree smallint DEFAULT (map.get('cluster_tree_position_branch'::name))::smallint NOT NULL,
    cluster_private text,
    cluster_key text,
    cluster_machineid text,
    cluster_license timestamp without time zone,
    cluster_licenselife smallint,
    cluster_code character varying DEFAULT cluster.__generate_cluster_code(),
    cluster_verbose boolean DEFAULT false NOT NULL,
    cluster_tperiod_id smallint,
    cluster_namespace character varying,
    cluster_remote boolean DEFAULT false NOT NULL
);


--
-- TOC entry 518 (class 1255 OID 16565)
-- Name: _get_cluster(character varying); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster._get_cluster(character varying) RETURNS cluster.cluster
    LANGUAGE sql
    AS $_$ select * from cluster.cluster where cluster_identifier = $1 $_$;


--
-- TOC entry 519 (class 1255 OID 16566)
-- Name: _get_cluster_child(character varying); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster._get_cluster_child(identifier character varying) RETURNS cluster.cluster
    LANGUAGE plpgsql
    AS $$
declare
  _cluster cluster.cluster;
  _const map.constant;
begin
  _const := map.constant();
  select * into _cluster
    from cluster.cluster c
    where c.cluster_identifier = identifier
      and c.cluster_type = _const.cluster_tcluster_child
  ;
  return  _cluster;
end
$$;


--
-- TOC entry 644 (class 1255 OID 16567)
-- Name: _get_cluster_local(boolean, integer); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster._get_cluster_local(increment boolean DEFAULT false, try integer DEFAULT 0) RETURNS cluster.cluster
    LANGUAGE plpgsql
    AS $$
declare
  _cluster cluster.cluster;
  -- local origin
  _origin uuid default '00000000-0000-0000-0000-000000000000'::uuid;
  _const map.constant;
begin
  _const := map.constant();

  if coalesce( increment, false ) then
    update cluster.cluster
      set cluster_version = cluster_version +1
      where cluster_uid = _origin
      returning * into _cluster;
  else
    select * into _cluster
      from cluster.cluster c
      where c.cluster_type = _const.cluster_tcluster_local;
  end if;

  if _cluster.cluster_uid is null then
    insert into cluster.cluster(
      cluster_uid,
      cluster_identifier,
      cluster_type,
      cluster_version
    ) values (
      _origin,
      cluster.__create_identifier(),
      _const.cluster_tcluster_local,
      lib."when"( coalesce( increment, false), 1, 0 )
    ) returning * into _cluster;
  end if;

  return _cluster;
exception when others then
  <<_ex>>
  declare
    e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    if try < 10 then
      perform pg_sleep( try );
      return cluster._get_cluster_local( increment, try+1 );
    else raise exception '%', m;
    end if;
  end;
end;
$$;


--
-- TOC entry 520 (class 1255 OID 16568)
-- Name: _get_cluster_master(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster._get_cluster_master() RETURNS cluster.cluster
    LANGUAGE plpgsql
    AS $$
declare
  _const map.constant;
  _cluster cluster.cluster;
begin
  _const := map.constant();
  select c.* into _cluster
    from cluster.cluster c
    where c.cluster_type = _const.cluster_tcluster_master
  ;
  return _cluster;
end;
$$;


--
-- TOC entry 645 (class 1255 OID 16569)
-- Name: _get_version_local(regclass, boolean); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster._get_version_local(regclass, increment boolean DEFAULT false) RETURNS cluster.version
    LANGUAGE plpgsql STRICT
    AS $_$
declare
  _version cluster.version;
  _cluster cluster.cluster;
begin
  _cluster := cluster._get_cluster_local();

  if coalesce( increment, false ) then
    update cluster.version
      set version_number = version_number +1
      where version_share_regclass::regclass = $1
        and version_cluster_id = _cluster.cluster_uid
      returning * into _version
    ;
  else
    select * into _version
      from cluster.version
      where version_cluster_id = _cluster.cluster_uid
        and version_share_regclass::regclass = $1;
  end if;

  if _version.version_uid is null then
    _version.version_number := lib."when"( coalesce( increment, false ), 1, 0 );
    _version.version_cluster_id := _cluster.cluster_uid;
    _version.version_share_regclass := cluster.__format( $1 );
    select ( "returning" ).* into _version from lib.sets_in( _version );
  end if;

  return _version;
end;
$_$;


--
-- TOC entry 430 (class 1255 OID 16570)
-- Name: accept_remote_cluster(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.accept_remote_cluster(args jsonb) RETURNS SETOF boolean
    LANGUAGE plpgsql
    AS $$
declare
  _cluster cluster.cluster;
  _local cluster.cluster;
  _is_sub_path boolean;
  _const map.constant;

  _can_receiver_sub_path_revision boolean;
begin
  _cluster := jsonb_populate_record( _cluster, args );

  _const := map.constant();
  _local := cluster._get_cluster_local();
  _is_sub_path := cluster.__is_sub_path( _local.cluster_path, _cluster.cluster_path );
  _local.cluster_path := coalesce( _local.cluster_path, '/' );
  _cluster.cluster_path := coalesce( _cluster.cluster_path, '' );
  _can_receiver_sub_path_revision := _const.cluster_grant_revision_sub_path = any( _local.cluster_grants );

  if not (
    _cluster.cluster_path = _local.cluster_path
      or ( _is_sub_path and _can_receiver_sub_path_revision )
  ) then return; end if;

  return query select true;
end
$$;


--
-- TOC entry 646 (class 1255 OID 16571)
-- Name: accept_revision(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.accept_revision(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      cluster_identifier
      cluster_path
    }
   */
  _master cluster.cluster;
  _local cluster.cluster;
  _remote_child cluster.cluster;
  _remote cluster.cluster;

  _const map.constant;

  _local_is_child_of_remote boolean;
  _local_is_super_path_remote boolean;
  _local_is_master_of_remote boolean;
begin

  if args is null then return; end if;
  _remote := jsonb_populate_record( _remote, args );
  _master := cluster._get_cluster_master();

  _const := map.constant();
  _local := cluster._get_cluster_local();
  _local.cluster_path := coalesce( _local.cluster_path, '/' );
  _remote.cluster_path := coalesce( _remote.cluster_path, '/' );

  if _local.cluster_identifier = _remote.cluster_identifier then return; end if;

  select * into _remote_child
    from cluster.cluster c
    where c.cluster_type = _const.cluster_tcluster_child
      and c.cluster_identifier = _remote.cluster_identifier
  ;


  _local_is_child_of_remote := _master.cluster_identifier = _remote.cluster_identifier;
  _local_is_super_path_remote := cluster.__is_sub_path( _local.cluster_path, _remote.cluster_path );
  _local_is_master_of_remote := _remote_child.cluster_identifier is not null;

  if not (
    coalesce( _local.cluster_path = _remote.cluster_path, false )
    or coalesce( _local_is_child_of_remote, false )
    or coalesce( _local_is_super_path_remote and _const.cluster_grant_revision_sub_path = any( _local.cluster_grants ), false )
    or coalesce( _local_is_master_of_remote and _const.cluster_grant_revision_child = any ( _remote_child.cluster_grants ), false )
  ) then return; end if;

  return query
    select *
      from cluster.status( args );
end;
$$;


--
-- TOC entry 635 (class 1255 OID 16572)
-- Name: add(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.add(args jsonb DEFAULT NULL::jsonb) RETURNS SETOF cluster.collector
    LANGUAGE plpgsql
    AS $$
declare
  /**
    PROPOSE: Efetuar uma varedura completa nas tabelas verificação por modificações
      diferente das últimas que foram versionadas e colletalas para que sejas versionadas

    args := {
      regclass:[]
    }
   */
  _regclass regclass[] default array( select e.text::regclass from jsonb_array_elements_text( args->'regclass')e ( text ) );
begin
  if array_length( _regclass, 1 )  = 0 then _regclass := null; end if;

  return query
    with __foregin_key as (
      select
        tc.constraint_name,
        format( '%s.%s', tc.table_schema, tc.table_name )::regclass as local_table,
        kcu.column_name as local_column,
        format( '%s.%s',  ccu.table_schema, ccu.table_name )::regclass as foreign_table,
        ccu.column_name AS foreign_column_name
      from
        information_schema.table_constraints tc
          join information_schema.key_column_usage kcu on tc.constraint_name = kcu.constraint_name
          and  tc.table_schema = kcu.table_schema
          join information_schema.constraint_column_usage ccu on ccu.constraint_name = tc.constraint_name
          and ccu.table_schema = tc.table_schema
      where tc.constraint_type = 'FOREIGN KEY'
    ), __share as (
      select
        local_table,
        s.share_regclass,
        array_agg( foreign_table ),
        count( * ) as depencies,
        count( * ) filter ( where foreign_table = local_table ) as self
      from __foregin_key fk
        inner join cluster.share s on fk.local_table = s.share_regclass
      where s.share_regclass = any ( coalesce(_regclass, array[ s.share_regclass ]))
      group by local_table,
        s.share_regclass
    )
    select (cluster.__add( s.share_regclass )).*
      from __share s
      order by
        case
          when s.depencies = 0 then 1
          when s.depencies = s.self then 2
          else 3
        end,
        s.depencies,
        s.self
  ;
end;
$$;


--
-- TOC entry 432 (class 1255 OID 16573)
-- Name: constant(); Type: FUNCTION; Schema: map; Owner: -
--

CREATE FUNCTION map.constant() RETURNS map.constant
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
  /**
        Essa função serve para carregar os valores das constante e inicia-la
       */
select
  jsonb_populate_record(
      null::map.constant,
      jsonb_object_agg( cv.constvalue_name, cv.constvalue_value )
    )
from map.constvalue cv;
$$;


--
-- TOC entry 431 (class 1255 OID 16574)
-- Name: can_send_object(cluster.object, cluster.collector, cluster.cluster, cluster.cluster, cluster.cluster, cluster.cluster, cluster.cluster, map.constant); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.can_send_object(_object cluster.object, _collector cluster.collector, _origin cluster.cluster, _request cluster.cluster, _local cluster.cluster, _master cluster.cluster, _child cluster.cluster, _const map.constant DEFAULT map.constant()) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
declare
  begin

--   raise exception 'sshsnjsd nsd';
    -- Quando o custer PEDITNTE testiver no mesmo path que o cluster origem [OK]
    if _origin.cluster_path = _request.cluster_path then return true; end if;

    -- QUANDO TANTO O CLUSTER PEDINTE E O CLUSTER LOCAL ESTIVEREM EM PATH DIFERENTE [NEGAR]
    if not ( cluster.__is_sub_path( _request.cluster_path, _origin.cluster_path )
      or cluster.__is_sub_path( _origin.cluster_path, _request.cluster_path ) )
    then return false; end if;


    -- QUANDO O CLUSTER ORIGEM FOR SUBPATH DO CLUSTER PEDINTE E O CLUSTER PEDINTE ACEITA REVISÕES INFERIOR [OK]
    if _const.cluster_grant_revision_sub_path = any( _request.cluster_grants )
      and cluster.__is_sub_path( _request.cluster_path, _origin.cluster_path )
    then return true; end if;

    -- QUANDO O CLUSTER ORIGEM FOR O SUPER-PATH DO CLUSTER PEDINTE E O CLUSTER PEDINTE ACEITAR REVISÕS DE CAMINHO SUPERIOR [OK]
    if _const.cluster_grant_revision_supper_path = any( _request.cluster_grants )
      and cluster.__is_sub_path( _origin.cluster_path, _request.cluster_path  )
    then return true; end if;

    -- QUANDO O CLUSTER PEDINTE FOR O MASTER E O CLUSTER ORIGEN FOR LOCAL E O CLUSTER LOCAL SALVA REVISÕES NO MASTER [OK!]
    if _request.cluster_identifier = _master.cluster_identifier
      and _local.cluster_identifier = _origin.cluster_identifier
      and _const.cluster_grant_revision_child = any( _local.cluster_grants )
    then return true; end if;

    -- QUANDO O CLUSTER PEDINTE FOR UM FILHO DO CLUSTER LOCAL E A ORIGEM FOR CLUSTER LOCAL
    if _request.cluster_identifier = _child.cluster_identifier
      and _origin.cluster_identifier = _local.cluster_identifier
    then  return true; end if;

    return false;
  end;
$$;


--
-- TOC entry 636 (class 1255 OID 16575)
-- Name: can_send_revision(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.can_send_revision(args jsonb) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      cluster_identifier
      cluster_path
      cluster_grants
    }
   */
  _remote cluster.cluster;
  _master cluster.cluster;

  _local cluster.cluster;
  _remote_child cluster.cluster;
  _local_is_master_of_remote boolean;
  _local_is_child_of_remote boolean;
  _local_is_sub_path_of_remote boolean;
  _const map.constant;

begin
  _const := map.constant();
  _remote := jsonb_populate_record( _remote, args );
  _local := cluster._get_cluster_local();
  _master := cluster._get_cluster_master();

  _local.cluster_path := coalesce( _local.cluster_path, '/' );
  _remote.cluster_path := coalesce( _remote.cluster_path, '/' );

--   if _local.cluster_identifier = _remote.cluster_identifier then return; end if;
  if _local.cluster_identifier = _remote.cluster_identifier then return false; end if;

    select * into _remote_child
      from cluster.cluster c
      where c.cluster_identifier = _remote.cluster_identifier
        and c.cluster_type = _const.cluster_tcluster_child
  ;

--   return next jsonb_build_object(
--     '01', _local.cluster_path = _remote.cluster_path,
--     '02', _local_is_master_of_remote,
--     '03', _local_is_sub_path_of_remote and _const.cluster_grant_revision_sub_path = any( _remote.cluster_grants ) ,
--     '04',  _local_is_child_of_remote and _const.cluster_grant_revision_child = any( _local.cluster_grants )
--   );

  _local_is_master_of_remote := _remote_child.cluster_identifier is not null;
  _local_is_sub_path_of_remote := cluster.__is_sub_path( _remote.cluster_path, _local.cluster_path );
  _local_is_child_of_remote := _master.cluster_identifier = _remote.cluster_identifier;

  return (
    coalesce( _local.cluster_path = _remote.cluster_path, false )
      or coalesce( _local_is_master_of_remote, false )
      or coalesce( _local_is_sub_path_of_remote and _const.cluster_grant_revision_sub_path = any( _remote.cluster_grants ), false )
      or coalesce( _local_is_child_of_remote and _const.cluster_grant_revision_child = any( _local.cluster_grants ), false )
  );
end;
$$;


--
-- TOC entry 647 (class 1255 OID 16576)
-- Name: change(jsonb, text[]); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.change(jsonb, VARIADIC keys text[]) RETURNS jsonb
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
  with __values as (
    select *
      from jsonb_each( $1 ) e
      where e.key = any ( keys )
  ) select jsonb_object_agg( e.key, e.value )
  from __values e
$_$;


--
-- TOC entry 648 (class 1255 OID 16577)
-- Name: commit(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.commit(args jsonb) RETURNS SETOF cluster.version
    LANGUAGE plpgsql
    AS $$
declare
  /**
    PROPOSE: Versionar tadas as modificações ocoridas na tabala já coletada
   */
begin

  return query
    with __foregin_key as (
      select
        tc.constraint_name,
        format( '%s.%s', tc.table_schema, tc.table_name )::regclass as local_table,
        kcu.column_name as local_column,
        format( '%s.%s',  ccu.table_schema, ccu.table_name )::regclass as foreign_table,
        ccu.column_name AS foreign_column_name
      from
        information_schema.table_constraints tc
          join information_schema.key_column_usage kcu on tc.constraint_name = kcu.constraint_name
          and  tc.table_schema = kcu.table_schema
          join information_schema.constraint_column_usage ccu on ccu.constraint_name = tc.constraint_name
          and ccu.table_schema = tc.table_schema
      where tc.constraint_type = 'FOREIGN KEY'
    ), __share as (
      select
        local_table,
        s.share_regclass,
        array_agg( foreign_table ),
        count( * ) as depencies,
        count( * ) filter ( where foreign_table = local_table ) as self
      from __foregin_key fk
        inner join cluster.share s on fk.local_table = s.share_regclass
      group by local_table,
        s.share_regclass
    )
    select (cluster.__create_object_version( s.share_regclass )).*
      from __share s
      order by
        case
          when s.depencies = 0 then 1
          when s.depencies = s.self then 2
          else 3
        end,
        s.depencies,
        s.self
  ;
end;
$$;


--
-- TOC entry 238 (class 1259 OID 16578)
-- Name: resource; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.resource (
    resource_identifier character varying NOT NULL,
    resource_cluster character varying NOT NULL,
    resource_name character varying NOT NULL,
    resource_subpath character varying,
    resource_extension character varying,
    resource_reference character varying NOT NULL,
    resource_url character varying NOT NULL,
    resource_metadata jsonb DEFAULT jsonb_build_object() NOT NULL,
    resource_version smallint DEFAULT 1 NOT NULL,
    resource_date timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    resource_update timestamp with time zone
);


--
-- TOC entry 433 (class 1255 OID 16586)
-- Name: create_resource(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.create_resource(args jsonb) RETURNS cluster.resource
    LANGUAGE plpgsql
    AS $_$
declare
  /*
    args := {
      resource_name character varying
      resource_subpath character varying
      reference_extension character varying
      reference_metadata jsonb not null default jsonb_build_object()
    }
   */
  _local cluster.cluster;
  _res cluster.resource;
  _letters character varying default 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  _number character varying default '0123456789';
  _rec record;
begin
  _local := cluster._get_cluster_local();
  _res := jsonb_populate_record( _res, args );

  _res.resource_cluster := upper( _local.cluster_identifier );
  _res.resource_identifier := format( '%s-%s-%s',
    lib.dset_random_text( _letters, 6 ),
    lib.dset_random_text( format( '%s%s', _letters, _number), 8 ),
    lib.dset_random_text( _number, 4 )
  );

  while exists(
    select *
      from cluster.resource r
      where r.resource_identifier = _res.resource_identifier
        and r.resource_cluster = _res.resource_cluster
  ) loop
      _res.resource_identifier := format( '%s-%s-%s',
        lib.dset_random_text( _letters, 6 ),
        lib.dset_random_text( format( '%s%s', _letters, _number), 8 ),
        lib.dset_random_text( _number, 4 )
      );
  end loop;

  for _rec in
    select *
      from unnest( array[
        '/', '\', '-', ' ', ':', '%', '$', '*', '?', '=', '"', '&',
        $c$'$c$,
       --  '(', ')', '[', ']',
        '{', '}'
      ]::text[]) c ( character )
  loop
    _res.resource_name := replace( _res.resource_name, _rec.character, '_' );
  end loop;

  _res.resource_name := lower( _res.resource_name );
  _res.resource_subpath := (
    with __sub as (
      select part
        from regexp_split_to_table( _res.resource_subpath, '/' ) part
        where part is not null and part.length > 0
    ) select string_agg( part, '/' )
      from __sub
  );

  _res.resource_reference := (
    with _path_part as (
      select path_part
        from regexp_split_to_table(
          format( '%s/%s/%s',
            _res.resource_cluster,
            _res.resource_subpath,
            _res.resource_identifier
          ), '/'
        ) t( path_part )
        where path_part is not null
          and length( path_part ) > 0
    ) select string_agg( _p.path_part, '/' )
      from _path_part _p
  );

  _res.resource_url := format( '%s/%s', _res.resource_reference, _res.resource_name );
  _res.resource_reference := format( '%s-%s', _res.resource_reference, _res.resource_name );

  if _res.resource_extension is not null and length( _res.resource_extension ) > 0 then
    _res.resource_reference := format( '%s.%s', _res.resource_reference, _res.resource_extension );
    _res.resource_url := format( '%s.%s', _res.resource_url, _res.resource_extension );
  end if;

  select ("returning" ).* into _res
    from lib.sets_in( _res );

  return _res;
end
$_$;


--
-- TOC entry 434 (class 1255 OID 16587)
-- Name: declare_filter(regnamespace, character varying, regclass, character varying); Type: PROCEDURE; Schema: cluster; Owner: -
--

CREATE PROCEDURE cluster.declare_filter(IN regnamespace, IN name character varying, IN share regclass DEFAULT NULL::regclass, IN describe character varying DEFAULT NULL::character varying)
    LANGUAGE plpgsql
    AS $_$
declare
  _regp character varying;
  _statement text;
begin
  _regp := format( '%I.%I', $1, name );

  --language=PostgreSQL
  _statement := format( $sql$
    create function __func_ ( share character varying, _object cluster.object, _collector cluster.collector, _req cluster.cluster, _origin cluster.cluster )
    returns boolean
    language plpgsql as $body$
      declare
      begin
        -- Accepted object
        -- return false;

        -- Accepted object
        return true;
      end;
    $body$
  $sql$ );

  _statement := replace( _statement, '__func_', _regp );
  execute _statement;

  insert into cluster.filter(
    filter_regclass,
    filter_regproc,
    filter_name,
    filter_describe
  ) values (
    cluster.__format( share ),
    _regp::regproc::text,
    name,
    describe
 );
end;
$_$;


--
-- TOC entry 852 (class 1255 OID 19512)
-- Name: define_namespace(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.define_namespace(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      cluster_uid: UID
      cluster_namespace: NAMESPACE
    }
   */
  _cluster cluster.cluster;
  _chars character varying[] = regexp_split_to_array( lower( 'ABCDEFGHIJKLMNOPQRSTUVWXYZ-0123456789_'), '' );
  _check record;
begin
  _cluster := jsonb_populate_record( _cluster, args );
  _cluster.cluster_namespace := lower( _cluster.cluster_namespace );
  
  select 
      string_agg( format( '%I posição %s', c.character, c.ordinality ), ', ' ) characters,
      count( * ) as count
      into _check
    from  unnest( regexp_split_to_array( _cluster.cluster_namespace, '' ) ) with ordinality c( character )
    where not c = any( _chars);
  
  if _check.count > 0 then 
    return lib.res_false( format( 'Namespace está invalido! caracteres: %s', _check.characters ) );
  end if;
  
  _cluster.cluster_namespace := lib.str_normalize( _cluster.cluster_namespace );
  if _cluster.cluster_namespace is null then
    return lib.res_false( 'Namespace está invalido ou não definido!' );
  end if;
  
  select ("returning").* into _cluster
    from lib.sets_up( _cluster, ref := lib.sets_ref(_cluster));
  
  return lib.result_true( jsonb_build_object(
    'cluster', _cluster
  ));
end;
$$;


--
-- TOC entry 856 (class 1255 OID 19548)
-- Name: funct_load_configs(); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.funct_load_configs() RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
  declare
    _local cluster.cluster;
    _master cluster.cluster;
    _branch record;
    _source record;
  begin
    _local := cluster._get_cluster_local();
    _master := cluster._get_cluster_master();
    
    select 
        array_agg( b.branch_uid ) as branch_uid,
        array_agg( b ) as branch
        into _branch
      from cluster.branch b
        inner join source s2 on b.branch_uid = s2.source_branch_uid
      where s2.source_cluster_uid = _local.cluster_uid
    ;
    
    select 
        array_agg( s.source_uid ) as source_uid,
        array_agg( s ) as source
        into _source
      from cluster.source s
        inner join cluster c on s.source_cluster_uid = c.cluster_uid
      where s.source_branch_uid = any ( _branch.branch_uid )
    ;
    
    return jsonb_build_object(
      'local', _local,
      'master', _master,
      'branch', _branch.branch, 
      'branch_uid', _branch.branch_uid, 
      'sources', _source.source,
      'sources_uid', _source.source_uid
    );
  end;
  $$;


--
-- TOC entry 637 (class 1255 OID 16588)
-- Name: funct_reg_acesso(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.funct_reg_acesso(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa funcao serve para dar acesse de um menu ao um colaborador
    -- Para dar acess o colaborador não pode ter previamente o acesso ao menu
    args := {
      arg_colaborador_id: ID,
      arg_colaborador_propetario: ID,
      arg_menu_list: [
        ID, ID, ID
      ]
    }
      -- arg_colaborador_id corresponde ao colaborador que esta a definir os previlegio de acesso
      -- arg_colaborador_propetario corresponde ao colaborador que tera o acesso definido
      -- arg_menu_ids corresponde a lista de identificadores do menus que o colaborador tera acesso
   */

  arg_colaborador_id uuid          := args->>'arg_colaborador_id';
  arg_colaborador_propetario uuid  := args->>'arg_colaborador_propetario';
  arg_menu_list int2[]                := array( select jsonb_array_elements_text( args->'arg_menu_list' )::int2 );

  arg_acesso_lista auth.acesso[];
  arg_branch_uid uuid default args->>'_branch_uid';

  _const map.constant;
begin

    _const := map.constant();

  -- Revogar os menus que o colaborador tinha acesso anteriormente mas atualmente já nao os têm
  -- São menus que aperecem no acesso ativo mas nao aperencem na nova lista de menus a ser dado ao colaborador
  update auth.acesso
    set acesso_estado = _const.acesso_estado_fechado,
        acesso_dataatualizacao = current_timestamp,
        acesso_colaborador_atualizacao = arg_colaborador_id
    where acesso_estado = _const.acesso_estado_ativo
      and acesso_colaborador_propetario = arg_colaborador_propetario
      and acesso_menu_id != all( arg_menu_list )
  ;

  -- Registrar para o colaborador apenas menus listado na lista que estão em faltas
  insert into auth.acesso(
    acesso_menu_id,
    acesso_colaborador_propetario,
    acesso_colaborador_id,
    _branch_uid
  ) select
      me.menu_id,
      arg_colaborador_propetario,
      arg_colaborador_id,
      arg_branch_uid
    from unnest( arg_menu_list ) un ( menu_id )
      inner join auth.menu me on un.menu_id = me.menu_id
      left join auth.acesso ac on me.menu_id = ac.acesso_menu_id
        and ac.acesso_estado = _const.acesso_estado_ativo
        and ac.acesso_colaborador_propetario = arg_colaborador_propetario
    where ac.acesso_id is null
  ;

  -- Obter todos os acessos ativos para esse colaborador
  select array_agg( ac ) into arg_acesso_lista
    from auth.acesso ac
    where ac.acesso_colaborador_propetario = arg_colaborador_propetario
      and ac.acesso_estado = _const.acesso_estado_ativo
  ;

  return lib.result_true(
    jsonb_build_object(
      'acesso', arg_acesso_lista
    )
  );

end;
$$;


--
-- TOC entry 843 (class 1255 OID 19510)
-- Name: load_cluster_by_namespace(character varying); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.load_cluster_by_namespace(namespace character varying) RETURNS SETOF jsonb
    LANGUAGE sql
    AS $$
    select to_jsonb( c ) from cluster.cluster c where cluster_namespace = namespace;
  $$;


--
-- TOC entry 638 (class 1255 OID 16589)
-- Name: load_clusters(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.load_clusters(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  _const map.constant;
begin
  _const := map.constant();
  return query with
    __cluster as (
      select
          c.cluster_uid,
          c.cluster_identifier,
          c.cluster_type,
          c.cluster_code,
          c.cluster_path,
          c.cluster_domain,
          c.cluster_licenselife,
          c.cluster_license,
          case
            when c.cluster_name is null and c.cluster_type = _const.cluster_tcluster_local then 'Local server'
            else c.cluster_name
          end as cluster_name,
          c.cluster_port,
          c.cluster_api,
          c.cluster_version,
          c.cluster_grants,
          c.cluster_configs,
          c.cluster_sequence,
          tp.*
        from cluster.cluster c
          left join cluster.tperiod tp on c.cluster_tperiod_id = tp.tperiod_id
    ) select to_jsonb( _c )
      from __cluster _c
      order by case
        when _c.cluster_type = _const.cluster_tcluster_local then 1
        when _c.cluster_type = _const.cluster_tcluster_master then 2
        when _c.cluster_type = _const.cluster_tcluster_child then 3
        when _c.cluster_type = _const.cluster_tcluster_remote then 4
      end,
      _c.cluster_name
  ;
end;
$$;


--
-- TOC entry 844 (class 1255 OID 16590)
-- Name: load_clusters_configs_to_child(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.load_clusters_configs_to_child(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      cluster_identifier: PATH
      cluster_api: PATH
      cluster_key
    }
   */
  _const map.constant;
  _cluster cluster.cluster;
begin
  _const := map.constant();
  _cluster := jsonb_populate_record( _cluster, args );

  if not exists(
      select *
      from cluster.cluster c
      where c.cluster_api = _cluster.cluster_api
        and c.cluster_identifier = _cluster.cluster_identifier
        and c.cluster_type = _const.cluster_tcluster_child
    ) then
    return;
  end if;

  return query with
     __cluster as (
       select
         c.cluster_identifier,
         case
           when c.cluster_type = _const.cluster_tcluster_child then _const.cluster_tcluster_local
           when c.cluster_type = _const.cluster_tcluster_local then _const.cluster_tcluster_master
           end as cluster_type,

         case
           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_key
           end as cluster_key,

         case
           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_configs
           else jsonb_build_object()
           end as cluster_configs,

         case
           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_grants
           else array[ ]::text[ ]
           end as cluster_grants,

         coalesce( c.cluster_path, '/' ) as cluster_path,

         case
           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_license
           end as cluster_license,
         case
           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_code
           end as cluster_code,

        case
           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_licenselife
           end as cluster_licenselife,

        case
           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_tperiod_id
           end as cluster_tperiod_id,

        case
           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_namespace
           end as cluster_namespace,
       
         c.cluster_name
       
       
       from cluster.cluster c
       where c.cluster_type = _const.cluster_tcluster_local
          or ( c.cluster_identifier = _cluster.cluster_identifier and c.cluster_type = _const.cluster_tcluster_child )
     ) select
     case
       when _c.cluster_type = _const.cluster_tcluster_master and _c.cluster_name is null then to_jsonb( _c )
        - 'cluster_key'
        || jsonb_build_object( 'cluster_name', 'Main Master (trunc)' )
       else to_jsonb( _c )
       end
   from __cluster _c
  ;
end
$$;


--
-- TOC entry 649 (class 1255 OID 16591)
-- Name: load_clusters_local_as_remotes(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.load_clusters_local_as_remotes(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      cluster_path: PATH,
      cluster_grants:grants
    }
   */
  _cluster cluster.cluster;
  _const map.constant;
begin
  _const := map.constant();
  _cluster := jsonb_populate_record( _cluster, args );



  return query with
    __cluster as (
      select
          c.cluster_identifier,
          c.cluster_name,
          c.cluster_path,
          _const.cluster_tcluster_remote as cluster_type
        from cluster.cluster c
        where c.cluster_type = _const.cluster_tcluster_local
          and cluster.can_send_revision( args )
    ) select to_jsonb( _c )
      from __cluster _c
  ;
end;
$$;


--
-- TOC entry 439 (class 1255 OID 16592)
-- Name: load_paths(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.load_paths(args jsonb DEFAULT json_build_object()) RETURNS SETOF text
    LANGUAGE sql
    AS $$ select distinct lower( cluster_path ) from cluster.cluster where cluster_path is not null order by lower( cluster_path ) $$;


--
-- TOC entry 435 (class 1255 OID 16593)
-- Name: load_resources_pendents(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.load_resources_pendents(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  _cluster cluster.cluster;
begin
  _cluster := jsonb_populate_record( _cluster, args );
  _cluster := cluster._get_cluster( _cluster.cluster_identifier );
  return query
    with __object as (
      select
          o.object_uid,
          o.object_transuid as collector_transuid,
          o.object_ref,
          res.*
        from cluster.object o
          inner join cluster.resource res on lib.sets_ref( res ) = o.object_ref
        where o.object_share_regclass::regclass = 'cluster.resource'::regclass
          and o.object_status = 2
          and _cluster.cluster_uid in ( o.object_cluster_origin, o.object_cluster_receiver )
    ) select to_jsonb( _o )
        from __object _o;
end;
$$;


--
-- TOC entry 650 (class 1255 OID 16594)
-- Name: next(character varying, character varying, boolean, integer, integer, character, text, integer); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.next(name character varying, sub character varying DEFAULT NULL::character varying, zero_base boolean DEFAULT false, steep integer DEFAULT 1, lpad integer DEFAULT 0, lpad_char character DEFAULT ''::bpchar, exist text DEFAULT NULL::text, exist_limit integer DEFAULT 1000) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
declare
  _sequence cluster.sequence;
  _cluster cluster.cluster;
  _repeat boolean default true;
  _next_value character varying;
  _record record;
  _iterate int default 0;
begin

  if sub is null then sub := ''; end if;
  if next.name is null then
    raise exception 'Sequence name is required!';
  end if;

  if next.steep = 0 then
    raise exception 'Sequence steep can not by zero!';
  end if;

  if exist is not null then
    exist_limit := coalesce( exist_limit, 1000 );
  end if;

  _cluster := cluster._get_cluster_local();

  while _repeat loop

    update cluster.sequence
      set sequence = sequence.sequence + sequence.steep
      where sequence.name = next.name
        and  next.sub = sequence.sub
      returning * into _sequence
    ;

    if _sequence.name is null then
      next.zero_base := coalesce( next.zero_base, false );
      next.steep := coalesce( next.steep, 1 );

      insert into cluster.sequence ( name, steep, zerobase, lpad, lpad_char, sub, sequence )
        values ( next.name, next.steep , next.zero_base, next.lpad, next.lpad_char, next.sub,
          case
            when next.zero_base then next.steep
            else next.steep
          end
        )
      returning * into _sequence;
    end if;

    if _sequence.zerobase then
      _sequence.sequence := _sequence.sequence + case
        when _sequence.steep > 0 then -1
        else 1
      end;
    end if;

    _next_value :=  format( '%s%s', _cluster.cluster_code, lpad( _sequence.sequence::text, greatest( _sequence.lpad, length( _sequence.sequence::text ) ), _sequence.lpad_char ) );
    _repeat := false;

    if exist is not null then
      <<find_duplicate>>
      for _record in execute exist using _next_value loop
        _repeat := true;
        exit find_duplicate;
      end loop;
    end if;

    _iterate := _iterate +1;
    if _iterate = exist_limit then
      raise exception 'Next code generation limit';
    end if;
  end loop;

  return _next_value;
end
$$;


--
-- TOC entry 436 (class 1255 OID 16595)
-- Name: object_filter(character varying, cluster.object, cluster.collector, cluster.cluster, cluster.cluster); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.object_filter(share character varying, _object cluster.object, _collector cluster.collector, _req cluster.cluster, _origin cluster.cluster) RETURNS boolean
    LANGUAGE plpgsql
    AS $_$
declare
  _validator record;
  _statement text;
  _result boolean;
begin

  $4.cluster_path := coalesce( $4.cluster_path, '/' );
  $5.cluster_path := coalesce( $5.cluster_path, '/' );


  -- Quando os cluster origem e o cluster requerente não tiver nehuma relação com os seus caminho
  -- Então reistar
  if _req.cluster_path != _origin.cluster_path
    and not cluster.__is_sub_path( _req.cluster_path, _origin.cluster_path )
    and not cluster.__is_sub_path( _origin.cluster_path, _req.cluster_path )
  then return false;
  end if;

  for _validator in
    select *
      from cluster.filter f
      where  share = coalesce( f.filter_regclass, share )
  loop
    _statement := format( 'select %s( $1, $2, $3, $4, $5 )', _validator.filter_regproc );
    execute _statement into _result using $1, $2, $3, $4, $5;
    if not _result then return false; end if;
  end loop;
  return true;
end
$_$;


--
-- TOC entry 438 (class 1255 OID 16596)
-- Name: pull(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.pull(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
    /**
      PROPOSE: Descaregar para o cluster local todas as modificações vinda dos outros cluster
      args := {
        server:ClusterSource,
        objects:( ObjectRevision[] )| DynamicReducer|any,
        ignores:cluster.ignore[]
        result:ClusterResult[]
        total:number
        limit:number,
        revCode:number,
        rejected:number,
      }
    */
    _limit int default args->>'limit';
    _server cluster.cluster;
    _cluster cluster.cluster;
    _local cluster.cluster;
    _data record;
    _i record;
    _obj jsonb default args->'objects';
    _objests cluster.object[] default array[]::cluster.object[];
    _next cluster.object;
    _pull cluster.pull;
  begin
    _pull.pull_server     :=  args->'server';
    _pull.pull_objects    :=  args->'objects';
    _pull.pull_ignores    :=  args->'ignores';
    _pull.pull_result     :=  args->'result';
    _pull.pull_total      :=  args->>'total';
    _pull.pull_limit      :=  args->>'limit';
    _pull.pull_revcode    :=  args->>'revCode';
    _pull.pull_rejected   :=  args->>'rejected';
    
    select ( "returning" ).* into _pull
      from lib.sets_in( _pull )
    ;
    
    _server := jsonb_populate_record( _server, args->'server');
    _cluster := cluster._get_cluster( _server.cluster_identifier );
    _local := cluster._get_cluster_local(  );

    with __object as (
      select o.*
        from jsonb_array_elements( _obj ) e( document )
          inner join jsonb_populate_record( null::cluster.object, e.document ) o on true
    ) select max( _o.object_seq ) as _cluster_sequence
      into _data
        from __object _o
    ;

    set session_replication_role to replica;

    for _i in
      with __map as (
        select
            obj as _object,
            col as _collector,
            ( e.document->>'_origin_identifier' ) as _origin_identifier,
            coalesce( cmp.classnameref, e.document->>'_regclass' ) as _classname,
            e.document->'_change' as _change,
            e.document->>'_result' as _result,
            ( e.document->>'_regclass' )::regclass as _regclass,
            col.collector_uid as current_collector_uid,
            col.collector_transuid as current_transuid
          from jsonb_array_elements( args->'objects' ) e ( document )
            inner join jsonb_populate_record( null::cluster.object, e.document ) as obj on true
            inner join jsonb_populate_record( null::cluster.collector, e.document ) as col on true
            left join cluster.classmap cmp on e.document->>'_regclass' = cmp.classname
      ), __objects as (
        select
            v.*,
            co.cluster_uid as _origin,
            _cluster.cluster_uid as _receiver,
            ( v._object ).object_ref,
            ( v._object ).object_date,
            ( v._object ).object_uid,
            ( v._collector ).collector_uid,
            ( v._collector ).collector_transuid
          from __map v
            inner join cluster.cluster co on co.cluster_identifier =  v._origin_identifier

    ), __classnames as (
        select array_agg( distinct  mp._classname) as allclass
        from __map mp
    
      ), __row as (
        select _r.*
          from __classnames
          inner join cluster.__rows( variadic allclass ) _r on true

      ), __current as (
        select
            _up.object_ref,
            _up._classname,
            e.document as _current,
            max( ob.object_date ) as date
          from __objects _up
            left join __row e  on e.classname = _up._regclass
              and e.reference = _up.object_ref 
            left join cluster.object ob on ob.object_share_regclass = _up._classname
              and ob.object_ref = _up.object_ref
          group by
            _up.object_ref,
            _up._classname,
            e.document
          
      ), __new as (
        select
            _ob.*,
            _cur.*,
            _created_object.object_uid is not null as _exists_object,
            _create_collector.collector_uid is not null _exists_collector,
            _cur._current is null as _exists_ref,
            (
                _cur._current is not null -- Desatualiazado: Quando já existir previamente a instancia do objecto na tabela
                and _cur.date is not null -- Desatualiazado: & Quando ja existir pelo menus algum objecto para essa referencia
                and _cur.date > _ob.object_date -- Desatualizado: & Quando a data a instancia atual for superior a data do objecto recebido

--               not all: _cur._current is null -- Quando ainda não existir a instancia do dado na tabela
--               or  _cur.date is null -- Ainda não existir nenhuma revisão para a referencia do objecto
--               or _cur.date < _ob.object_date -- Data da ultima revisão registrada for inferior a data da reisão recebida
            ) as _outdate
          from __objects _ob
            inner join __current _cur on _ob.object_ref = _cur.object_ref and _ob._classname = _cur._classname

            -- object_uid, object_share_regclass, object_cluster_origin
            left join cluster.object _created_object on
              ( _ob ).object_uid = _created_object.object_uid
              and ( _ob ).collector_transuid = _created_object.object_transuid
              and _cur._classname = _created_object.object_share_regclass
              and ( _ob )._origin = _created_object.object_cluster_origin

            -- collector_uid, collector_transuid, collector_share_regclass, collector_cluster_origin
            left join cluster.collector _create_collector on
              ( _ob ).collector_uid = _create_collector.collector_uid
              and ( _ob ).collector_transuid = _create_collector.collector_transuid
              and _cur._classname  = _create_collector.collector_share_regclass
              and ( _ob )._origin = _create_collector.collector_cluster_origin
        ) select  *
      from __new
    loop
      _next := cluster.__pull( to_jsonb( _i ) );
      if _next.object_uid is not null then
        _objests := _objests || _next;
      end if;

    end loop;
    set session_replication_role to default;

    return query
      with __object as (
        select (o::cluster.object).*
          from unnest( _objests ) o
      ), __collector as (
        select
            _o.*,
            c.*,
            _o.object_share_regclass as _regclass,
            cc.cluster_identifier as _origin_identifier
          from __object _o
          inner join cluster.collector c on _o.object_collector_uid = c.collector_uid
            and _o.object_transuid = c.collector_transuid
            and _o.object_cluster_origin = c.collector_cluster_origin
          inner join cluster.cluster cc on _o.object_cluster_origin = cc.cluster_uid
      )select to_jsonb( _c )
        from __collector _c
    ;

    -- Atualizar a versão do cluster
    with
    __result as (
      select
          pc.cluster_identifier,
          coalesce( pc.cluster_version, 0 ) as cluster_version,
          coalesce( pc.cluster_sequence, 0 ) as cluster_sequence
        from jsonb_array_elements( args->'result') e( doc )
          inner join jsonb_populate_record( null::cluster.cluster, e.doc ) pc on true
    ), __clusters as (
      select
          c.cluster_identifier,
          c.cluster_sequence,
          max( o.object_origincver ) as object_origincver,
          max( o.object_seq ) as object_seq
        from cluster.object o
          inner join cluster.cluster c on c.cluster_uid = o.object_cluster_origin
        where o.object_cluster_origin != _local.cluster_uid
        group by c.cluster_uid

    ), __status as (
      select
          _r.cluster_identifier,
          case
            when _c.cluster_identifier = _server.cluster_identifier then _r.cluster_version
            when _c.object_origincver >= _r.cluster_version then _c.object_origincver
            else _r.cluster_version
          end as cluster_version,
          case
            when _c.cluster_identifier = _server.cluster_identifier then _r.cluster_sequence
            when _c.cluster_sequence >= _r.cluster_sequence then _c.cluster_sequence
            else _r.cluster_sequence
          end as cluster_sequence
        from __clusters _c
          inner join __result _r on _c.cluster_identifier = _r.cluster_identifier

    ) update cluster.cluster c
        set
          cluster_version = _s.cluster_version,
          cluster_sequence = _s.cluster_sequence,
          cluster_verbose = case
            when _s.cluster_identifier = _cluster.cluster_identifier
              and _limit is not null
              and _limit > jsonb_array_length( _obj ) then false
            else c.cluster_verbose
          end
        from __status _s
        where c.cluster_identifier = _s.cluster_identifier
    ;

    with __ignore as (
      select _pi.*
        from jsonb_array_elements( args->'ignores' ) e( doc )
          inner join jsonb_populate_record( null::cluster.ignore, e.doc ) _pi on true
    ) insert into cluster.ignore
        select _ignor.*
        from __ignore _ignor
    ;
    
    update cluster.pull
      set pull_status = 1,
          pull_pulled = to_jsonb( _objests )
      where pull_uid = _pull.pull_uid;

    return query
      with __clusters as (
        select
            c.cluster_identifier,
            c.cluster_name,
            c.cluster_path,
            c.cluster_version,
            c.cluster_sequence
          from cluster.cluster c
      ) select jsonb_agg( _c )
        from __clusters _c;
  end;
$$;


--
-- TOC entry 651 (class 1255 OID 16598)
-- Name: push(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.push(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    PROPOSE: Devolver as modificações que o cluster cliente tem em falta
      Push funciona relativamente ao cluster cliente
    args := {
      request:*CLUSTER{
        cluster_identifier
        cluster_path,
        cluster_grants
      }
      limit:row limit
      clusters :[  -- all cluster include request
          cluster_identifier: CID -- request cluster
          cluster_sequence:   CSE
          cluster_version:    CVE
          cluster_verbose:    CVB
      ]
    }
   */
  _local cluster.cluster;
  _master cluster.cluster;
  _child cluster.cluster;
  _request cluster.cluster;
  _const map.constant;
  _limit int8 default args->>'limit';
  _cluster cluster.cluster;
begin
  _const := map.constant();
  _local := cluster._get_cluster_local();
  _master := cluster._get_cluster_master();
  _request := jsonb_populate_record( _request, args->'request' );
  _child := cluster._get_cluster_child( _request.cluster_identifier );
  select * into _cluster
    from cluster.cluster c
    where c.cluster_identifier = _request.cluster_identifier
  ;

  if _cluster.cluster_identifier is null then return; end if;
  if _cluster.cluster_type = _const.cluster_tcluster_child then
    _request := _cluster;
  else
    _request.cluster_uid = _cluster.cluster_uid;
  end if;

  return query
    with  __clusters_statuas as (
      select
          ( e.doc->>'cluster_identifier' ) as cluster_identifier,
          ( e.doc->>'cluster_identifier' ) = _request.cluster_identifier as _is_cluster_to,
          ( e.doc->>'cluster_version' )::int8 as cluster_version,
          ( e.doc->>'cluster_sequence' )::int8 as cluster_sequence,
          ( e.doc->>'cluster_verbose' )::boolean as cluster_verbose
        from jsonb_array_elements( args-> 'clusters' ) e( doc )

    ), __clusters as (
      select _cs.*,
             c.cluster_uid
        from __clusters_statuas _cs
          inner join cluster.cluster c on _cs.cluster_identifier = c.cluster_identifier

    ), __objects as (
      select
          o.*,
          o as _obj,
          array_agg( cluster.change( col.collector_metadata, variadic col.collector_changes )
            order by oi.object_seq
          ) as _change
        from  cluster.object o
          left join __clusters _co on o.object_cluster_origin = _co.cluster_uid
          left join cluster.object oi on o.object_seq > _co.cluster_sequence
            and o.object_ref = oi.object_ref
            and o.object_share_regclass = oi.object_share_regclass
            and oi.object_seq <= o.object_seq
          left join cluster.collector col on oi.object_collector_uid = col.collector_uid
            and oi.object_transuid = col.collector_transuid
            and oi.object_share_regclass = col.collector_share_regclass
            and oi.object_ref = col.collector_ref

        where o.object_seq > _co.cluster_sequence
          and ( o.object_cluster_origin != _request.cluster_uid or _co.cluster_verbose )
          and ( o.object_cluster_receiver != _request.cluster_uid or _co.cluster_verbose )
          and o.object_originver > _co.cluster_version
        group by o.object_uid,
          o.object_share_regclass,
          o.object_cluster_origin

    ), __ranks as (
      select
          o.*,
          rank() over ( partition by o.object_ref order by o.object_seq desc ) as rank,
          min( o.object_seq ) over ( partition by o.object_ref ) as minseq
        from  __objects o
    ), __collector as (
      select
        _o.object_uid             ,
        _o.object_originver       ,
        _o.object_originsver      ,
        _o.object_origincver      ,
        _o.object_originsseq      ,
        _o.object_originrev       ,
        _o.object_date            ,
        _o.object_instant         ,
        _o.object_ref             ,
        _o.object_seq             ,

        col.collector_metadata    ,
        col.collector_changes     ,
        col.collector_transuid    ,
        col.collector_uid         ,
        col.collector_sequence    ,
        col.collector_order       ,
        col.collector_minseq      ,
        col.collector_maxseq      ,
        col.collector_date        ,
        col.collector_version     ,
        col.collector_operation   ,
        col.collector_old         ,
        col.collector_originold   ,

        _origin.cluster_identifier as _origin_identifier,
        _o.object_share_regclass   as _regclass,
        _o.rank = 1 as _result,
        coalesce( cluster.reduce( variadic _o._change ), col.collector_metadata ) as _change
      from __ranks _o
          inner join cluster.collector col on _o.object_collector_uid = col.collector_uid
            and _o.object_transuid = col.collector_transuid
            and _o.object_share_regclass = col.collector_share_regclass
            and _o.object_ref = col.collector_ref
          inner join cluster.cluster _origin on _origin.cluster_uid = _o.object_cluster_origin
        where true
         and cluster.can_send_object( _o._obj, col, _origin, _request, _local, _master, _child, _const )
      order by _o.object_seq
      limit _limit
    ) select to_jsonb( _c )
      from __collector _c;
end;
$$;


--
-- TOC entry 437 (class 1255 OID 16599)
-- Name: reduce(jsonb[]); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.reduce(VARIADIC jsonb[]) RETURNS jsonb
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
  select jsonb_object_agg( it.key, it.value order by e.index, it.index )
    from unnest( $1 ) with ordinality e( document, index )
      inner join jsonb_each( e.document ) with ordinality it( key, value, index ) on e.document ? it.key
$_$;


--
-- TOC entry 652 (class 1255 OID 16600)
-- Name: sets_cluster_configs(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.sets_cluster_configs(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      clusters: [{
        cluster_uid
        cluster_identifier
        cluster_path
        cluster_name
        cluster_domain
        cluster_port
        cluster_key,
        cluster_license,
        cluster_licenselife,
        cluster_tperiod_id
      }]
    }
   */
  _const map.constant;
  _data record;
begin
  _const := map.constant();

  with __clusters as (
    select c as _cluster, e.doc as cluster_replace
      from jsonb_array_elements( args->'clusters' ) e( doc )
        inner join jsonb_populate_record( null::cluster.cluster, e.doc ) _clu on true
        inner join cluster.cluster c on  _clu.cluster_type = c.cluster_type
          and _clu.cluster_type in ( _const.cluster_tcluster_master, _const.cluster_tcluster_local )
  ), __sets as (
    select s."returning" as cluster
    from __clusters _c
      inner join lib.sets( _c._cluster, _c.cluster_replace ) s on true
  ) select array_agg( s.cluster ) as clusters into _data
  from __sets s
  ;

  return lib.res_true(  to_jsonb( _data ) );
end;
$$;


--
-- TOC entry 440 (class 1255 OID 16601)
-- Name: sets_cluster_license(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.sets_cluster_license(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      cluster_uid:UID
      cluster_tperiod_id
      cluster_licenselife: NUMBER >> REPITICAO DO PERIODO
    }
   */
  _cluster cluster.cluster;
  _interval interval;
  _tperid cluster.tperiod;
  _result cluster.cluster;
begin
  _cluster := jsonb_populate_record( _cluster, args );
  select * into _tperid from cluster.tperiod where tperiod_id = _cluster.cluster_tperiod_id;

  if _cluster.cluster_licenselife > 0
    and _cluster.cluster_tperiod_id is not null
  then
    _interval := format( '%L %s',  _cluster.cluster_licenselife, _tperid.tperiod_code )::interval;
    _cluster.cluster_license := current_timestamp + _interval;

    select ( "returning" ).* into _result
      from lib.sets( _cluster );

    return lib.res_true( jsonb_build_object(
      '_cluster', _result
    ));
  end if;

  return lib.res_false( 'Licensa invalida!' );
end;
$$;


--
-- TOC entry 653 (class 1255 OID 16602)
-- Name: sets_cluster_machine_id(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.sets_cluster_machine_id(args jsonb) RETURNS TABLE(result boolean, message text, data jsonb)
    LANGUAGE plpgsql
    AS $$
declare
  _machine cluster.cluster;
  _status cluster.cluster;
  _const map.constant;
begin
  _const := map.constant();
  _machine := jsonb_populate_record( _machine, args );

  select * into _status
    from cluster.cluster c
    where c.cluster_identifier = _machine.cluster_identifier
      and c.cluster_type = _const.cluster_tcluster_child
  ;

    sets_cluster_machine_id.result := true;
    sets_cluster_machine_id.message := 'Success';

  if _machine.cluster_machineid is null then
    sets_cluster_machine_id.result := false;
    sets_cluster_machine_id.message := 'Required machine ID form connect';

  elseif _status.cluster_identifier is null then
    sets_cluster_machine_id.result := false;
    sets_cluster_machine_id.message := 'Cluster not registered in current server as child as child';

  elseif _status.cluster_machineid is not null
    and _machine.cluster_machineid != _status.cluster_machineid
  then
    sets_cluster_machine_id.result := false;
    sets_cluster_machine_id.message := 'Cluster is active in another server';

  elseif _status.cluster_machineid is null then
    update cluster.cluster
      set cluster_machineid = _machine.cluster_machineid
      where cluster_identifier = _status.cluster_identifier
        and cluster_type = _status.cluster_type
        and cluster_api = _status.cluster_api
      returning *  into _status
    ;
  end if;

  sets_cluster_machine_id.data := to_jsonb( _status );
  return next ;
end;
$$;


--
-- TOC entry 640 (class 1255 OID 16603)
-- Name: sets_cluster_remote(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.sets_cluster_remote(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      clusters: [{
        cluster_uid
        cluster_identifier
        cluster_receive
        cluster_send
        cluster_path
        cluster_name
        cluster_domain
        cluster_port
      }]
    }
   */
  _const map.constant;
  _data record;
begin
  _const := map.constant();

  with __clusters as (
    select c as _cluster, e.doc as cluster_replace
      from jsonb_array_elements( args->'clusters' ) e( doc )
        inner join jsonb_populate_record( null::cluster.cluster, e.doc ) _clu on true
        left join cluster.cluster c on
          ( _clu.cluster_identifier = c.cluster_identifier and c.cluster_type = _const.cluster_tcluster_remote )
      where _clu.cluster_identifier not in (
        select c.cluster_identifier
          from cluster.cluster c
          where c.cluster_type != _const.cluster_tcluster_remote
      )
  ), __sets as (
    select s."returning" as cluster
      from __clusters _c
        inner join lib.sets( _c._cluster, _c.cluster_replace ) s on true
  ) select array_agg( s.cluster ) as clusters into _data
      from __sets s
  ;

  return lib.res_true(  to_jsonb( _data ) );
end;
$$;


--
-- TOC entry 441 (class 1255 OID 16604)
-- Name: sets_cluster_tree_position(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.sets_cluster_tree_position(args jsonb) RETURNS SETOF cluster.cluster
    LANGUAGE plpgsql
    AS $$
declare
  _const map.constant;
  _cluster cluster.cluster;
begin
  _cluster := jsonb_populate_record( cluster._get_cluster_local(), args );
  _const := map.constant();
  return query
    select ( "returning" ).*
      from lib.sets_up( _cluster );
end;
$$;


--
-- TOC entry 442 (class 1255 OID 16605)
-- Name: sets_clusters_admin(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.sets_clusters_admin(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      cluster_license?: ( no carragamento de license )
      cluster_licenselife: QT
      cluster_tperiod_id: PERIODO (select * from cluster.tperiod order by tperiod_id)
    }
   */
  _cluster cluster.cluster;
  _result cluster.cluster;
  _res lib.res;
  _const map.constant;
  _master cluster.cluster;
  _local cluster.cluster;
  _tperiod cluster.tperiod;

  _doc jsonb default jsonb_build_object();
begin
  _const := map.constant();
  _cluster := jsonb_populate_record( _cluster, args );

  select * into _tperiod
    from cluster.tperiod tp
    where tp.tperiod_id = _cluster.cluster_tperiod_id
  ;


  -- Quando for o cluster master
  if _cluster.cluster_type = _const.cluster_tcluster_master then
--       raise exception 'Master:%', args;

    -- Aplicar as confifurações de cluster master
    _master := cluster._get_cluster_master();
    _master.cluster_domain := _cluster.cluster_domain;
    _master.cluster_api := _cluster.cluster_api;
    _master.cluster_port := _cluster.cluster_port;
    _master.cluster_type := _const.cluster_tcluster_master;
    _master.cluster_name := coalesce( _master.cluster_name, 'Master' );
    select ( "returning" ).* into _result from lib.sets( _master );
    _doc := _doc || jsonb_build_object( 'master', _result );


    -- Aplicar as configuraçõa do cluster local
    _local := cluster._get_cluster_local();
    _local.cluster_name := coalesce( _local.cluster_name, 'Local' );
    _local.cluster_identifier := _cluster.cluster_identifier;
    _local.cluster_license := _cluster.cluster_license;
    _local.cluster_licenselife := _cluster.cluster_licenselife;
    _local.cluster_tperiod_id := _cluster.cluster_tperiod_id;
    select ( "returning" ).* into _result from  lib.sets( _local );
    _doc := _doc || jsonb_build_object( 'local', _result );

  elseif _cluster.cluster_type = _const.cluster_tcluster_child then

    _cluster.cluster_identifier := cluster.__create_identifier();
    _cluster.cluster_api := cluster.__create_api();
    _cluster.cluster_key := format( '%s-%s', cluster.__create_api(), cluster.__create_api() );

    select ( "returning" ).* into _result
      from lib.sets( _cluster );

    if _cluster.cluster_uid is null then
      select * into _res
        from cluster.sets_cluster_license( to_jsonb( _cluster ) || lib.sets_ref( _result ) );
    end if;

    _doc := _doc || jsonb_build_object( 'child', _res );
  end if;

  return lib.res_true( _doc );
end;
$$;


--
-- TOC entry 524 (class 1255 OID 16606)
-- Name: sets_resources_downloaded(json); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.sets_resources_downloaded(args json) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  _object uuid default args->>'object_uid';
  _trans uuid default args->>'collector_transuid';
  _ref jsonb default args->>'object_ref';
begin
  return query
    update cluster.object o
      set object_status = 1
      where object_status = 2
        and object_share_regclass::regclass = 'cluster.resource'::regclass
        and object_uid = _object
        and object_transuid = _trans
        and object_ref = _ref
      returning to_jsonb( o )
  ;
end;
$$;


--
-- TOC entry 654 (class 1255 OID 16607)
-- Name: sets_resources_downloaded(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.sets_resources_downloaded(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  _object uuid default args->>'object_uid';
  _trans uuid default args->>'collector_transuid';
  _ref jsonb default args->>'object_ref';
begin
  return query
    update cluster.object o
      set object_status = 1
      where object_status = 2
        and object_share_regclass::regclass = 'cluster.resource'::regclass
        and object_uid = _object
        and object_transuid = _trans
        and object_ref = _ref
      returning to_jsonb( o )
  ;
end;
$$;


--
-- TOC entry 655 (class 1255 OID 16608)
-- Name: status(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.status(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    PROPOSE: Devolver o atual estado do cluster cluster local, isso é até onde o atual custer conhecer os outros

    args:={}

    return ({
      cluster:[{
        cluster_identifier: CID,
        cluster_version: VN
        cluster_sequence
      }],
      versions:[{
        cluster_identifier: CID,
        share_regclass: SRC,
        version_number: VN,
      }],
      creq:?{
        cluster_version: VN
        cluster_sequence,
        versions: [{
          share_regclass: SRC,
          version_number: VN,
        }]
      }
    })
 */
--   _cluster_identifier character varying default args->>'cluster_identifier';
--   _cluster cluster.cluster;
--   _local cluster.cluster;
begin

  --   _cluster := cluster._get_cluster( _cluster_identifier );
--   _local := cluster._get_cluster_local(  );

  return query with
  __clusters as (
     select
       c.cluster_identifier,
       c.cluster_name,
       c.cluster_path,
       c.cluster_version,
       c.cluster_sequence,
       c.cluster_verbose
     from cluster.cluster c
       group by c.cluster_uid
  ) select to_jsonb( array_agg( c ) )
  from __clusters c
  ;
end;
$$;


--
-- TOC entry 853 (class 1255 OID 19513)
-- Name: switch_remote_connection(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.switch_remote_connection(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  _local cluster.cluster;
  _result cluster.cluster;
begin
  _local := cluster._get_cluster_local();
  _result := jsonb_populate_record( _result, args );
  if _local.cluster_namespace is null then
    return lib.res_true( jsonb_build_object( 'cluster_remote', false, 'cluster_remote_old', false ));
  end if;
  
  update cluster.cluster
    set cluster_remote = _result.cluster_remote 
    where cluster_uid = _local.cluster_uid
    returning * into _result;
  
  return lib.res_true( jsonb_build_object(
    'cluster_remote', _result.cluster_remote,
    'cluster_remote_old', _local.cluster_remote
    
  ));
end;
$$;


--
-- TOC entry 557 (class 1255 OID 16609)
-- Name: unlink_cluster(jsonb); Type: FUNCTION; Schema: cluster; Owner: -
--

CREATE FUNCTION cluster.unlink_cluster(args jsonb) RETURNS TABLE(result boolean, message text, data jsonb, error jsonb)
    LANGUAGE plpgsql
    AS $$
declare
  _cluster cluster.cluster;
  _const map.constant;
begin
  _const := map.constant();
  _cluster := jsonb_populate_record( _cluster, args );

  update cluster.cluster
    set cluster_machineid = null,
        cluster_api = cluster.__create_api()
    where cluster_uid = _cluster.cluster_uid
      and cluster_type = _const.cluster_tcluster_child
    returning * into _cluster;

  if _cluster.cluster_uid is null then
    unlink_cluster.result := false;
    unlink_cluster.message := 'Cluster not found!';
  else
    unlink_cluster.result := true;
  end if;

  return next;
end;
$$;


--
-- TOC entry 695 (class 1255 OID 16610)
-- Name: dataset(); Type: FUNCTION; Schema: geoinfo; Owner: -
--

CREATE FUNCTION geoinfo.dataset() RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para carregar os data set
   */
  _dataset geoinfo.dataset;
begin
  select * into _dataset
    from geoinfo.dataset ds
    where ds.dataset_use
    order by ds.dataset_updatedate desc nulls last,
      ds.dataset_registerdate desc
    limit 1
  ;
  return _dataset.dataset_data;
end;
$$;


--
-- TOC entry 239 (class 1259 OID 16611)
-- Name: dataset; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.dataset (
    dataset_id smallint NOT NULL,
    dataset_link character varying NOT NULL,
    dataset_version character varying NOT NULL,
    dataset_use boolean DEFAULT false NOT NULL,
    dataset_registerdate timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    dataset_updatedate timestamp with time zone,
    dataset_data jsonb
);


--
-- TOC entry 696 (class 1255 OID 16618)
-- Name: dataset(character); Type: FUNCTION; Schema: geoinfo; Owner: -
--

CREATE FUNCTION geoinfo.dataset(arg_dataset_link character) RETURNS geoinfo.dataset
    LANGUAGE sql
    AS $$
  select *
    from geoinfo.dataset ds
    where ds.dataset_link = arg_dataset_link;
$$;


--
-- TOC entry 697 (class 1255 OID 16619)
-- Name: dataset_populate(character varying, character varying, jsonb); Type: FUNCTION; Schema: geoinfo; Owner: -
--

CREATE FUNCTION geoinfo.dataset_populate(arg_dataset_link character varying, arg_dataset_version character varying, arg_dataset_data jsonb) RETURNS geoinfo.dataset
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para povoar o data set bruto
   */
  _dataset geoinfo.dataset;
begin
  if (
    select count( * )
      from geoinfo.dataset ds
      where ds.dataset_link = arg_dataset_link
  ) > 0 then
    return geoinfo.dataset_update(
      arg_dataset_link,
      arg_dataset_version,
      arg_dataset_data
    );
  end if;

  insert into geoinfo.dataset( dataset_link, dataset_version, dataset_data, dataset_use )
    values ( arg_dataset_link, arg_dataset_version,  arg_dataset_data, true )
    returning * into _dataset;

  update geoinfo.dataset
    set dataset_use = false
    where dataset_link != arg_dataset_link
  ;

  return _dataset;
end;
$$;


--
-- TOC entry 698 (class 1255 OID 16620)
-- Name: dataset_setup(); Type: FUNCTION; Schema: geoinfo; Owner: -
--

CREATE FUNCTION geoinfo.dataset_setup() RETURNS void
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para set o dataset para as suas respectiva tabela
   */
begin
  -- delete all data
  delete from geoinfo.altspelling where true;
  delete from geoinfo.country where true;
  delete from geoinfo.countryborder where true;
  delete from geoinfo.countrycallcode where true;
  delete from geoinfo.countrycurrency where true;
  delete from geoinfo.countrylanguage where true;
  delete from geoinfo.countryregionalbloc where true;
  delete from geoinfo.countrytimezone where true;
  delete from geoinfo.countrytopleveldomain where true;
  delete from geoinfo.currency where true;
  delete from geoinfo.demonym where true;
  delete from geoinfo.domain where true;
  delete from geoinfo.language where true;
  delete from geoinfo.region where true;
  delete from geoinfo.regionalbloc where true;
  delete from geoinfo.regionalblocname where true;
  delete from geoinfo.regionalblocother where true;
  delete from geoinfo.subregion where true;
  delete from geoinfo.timezone where true;
  delete from geoinfo.countrytranslation where true;

  -- //Insert region
  perform setval('geoinfo.seq_region', 1, false );
  insert into geoinfo.region(region_name )
    select distinct region
      from geoinfo.dataset_region
      where region  is not null
  ;

  -- //Insert subregion
  perform setval('geoinfo.seq_subregion', 1, false );
  insert into geoinfo.subregion(subregion_name )
    select distinct subregion
      from geoinfo.dataset_subregion
      where subregion is not null
  ;

  -- //Insert subregion
  perform setval('geoinfo.seq_demonym', 1, false );
  insert into geoinfo.demonym(demonym_name )
    select distinct demonym
      from geoinfo.dataset_demonym
      where demonym is not null
  ;


  --//set domain
  perform setval( 'geoinfo.seq_domain', 1, false );
  insert into geoinfo.domain( domain_name )
    select distinct "topLevelDomain"
      from geoinfo.dataset_topleveldomain
      where "topLevelDomain" is not null
  ;

  --//set currency
  perform setval( 'geoinfo.seq_currency', 1, false );
  insert into geoinfo.currency ( currency_code, currency_name, currency_symbol )
    select distinct code, name, symbol
      from geoinfo.dataset_currencies
      where coalesce( code, name, symbol ) is not null;

  --//set language
  perform setval( 'geoinfo.seq_language', 1, false );
  insert into geoinfo.language ( language_iso2, language_iso3, language_name, language_nativename )
    select distinct lan.iso639_1, lan.iso639_2, lan.name, lan."nativeName"
      from geoinfo.dataset_languages lan
      where coalesce( lan.iso639_1, lan.iso639_2, lan.name, lan."nativeName" ) is not null
  ;

  --//set timezone
  perform setval( 'geoinfo.seq_timezone', 1, false );
  insert into geoinfo.timezone( timezone_timezone )
    select distinct dtz.timezones
      from geoinfo.dataset_timezones dtz
      where dtz.timezones is not null
  ;

  --//set regionalBlocs
  perform setval( 'geoinfo.seq_regionalbloc', 1, false );
  insert into geoinfo.regionalbloc( regionalbloc_acronym, regionalbloc_name )
    select distinct rb.acronym, rb.name
      from geoinfo.dataset_regionalblocs rb
  ;

  --//set regionalblocks other
  perform setval( 'geoinfo.seq_regionalblocother', 1, false  );
  insert into geoinfo.regionalblocother( regionalblocother_regionalbloc_id, regionalblocother_otheracronym )
    select distinct rb.regionalbloc_id, drb."otherAcronyms"
      from geoinfo.regionalbloc rb
        inner join geoinfo.dataset_regionalblocs drb on rb.regionalbloc_acronym = drb.acronym
      where drb."otherAcronyms" is not null
  ;

  --//set regionalblocks names
  perform setval( 'geoinfo.seq_regionalblocname', 1, false  );
  insert into geoinfo.regionalblocname( regionalblocname_regionalbloc_id, regionalblocname_name )
    select distinct rb.regionalbloc_id, drb."otherNames"
      from geoinfo.regionalbloc rb
        inner join geoinfo.dataset_regionalblocs drb on rb.regionalbloc_acronym = drb.acronym
      where drb."otherNames" is not null
  ;

  --//set country
  perform setval('geoinfo.seq_country', 1, false );
  insert into geoinfo.country (
    country_region_id,
    country_subregion_id,
    country_demonym_id,
    country_name,
    country_iso2,
    country_iso3,
    country_capital,
    country_population,
    country_latitude,
    country_longitude,
    country_area,
    country_gini,
    country_nativename,
    country_numericcode,
    country_flag,
    country_cioc
  ) select distinct
      reg.region_id,
      sub.subregion_id,
      de.demonym_id,
      ds.name,
      ds."alpha2Code",
      ds."alpha3Code",
      ds.capital,
      ds.population,
      ds.latitude,
      ds.longitude,
      ds.area,
      ds.gini,
      ds."nativeName",
      ds."numericCode",
      ds.flag,
      ds.cioc
    from geoinfo.dataset_country ds
      left join geoinfo.subregion sub on ds.subregion = sub.subregion_name
      left join geoinfo.region reg on ds.region = reg.region_name
      left join geoinfo.demonym de on ds.demonym = de.demonym_name
    ;

  --// set altspelling
  perform setval('geoinfo.seq_altspelling', 1, false );
  insert into geoinfo.altspelling(
    altspelling_country_id,
    altspelling_altspelling
  ) select
      c.country_id,
      al."altSpelling"
    from geoinfo.country c
      inner join geoinfo.dataset_altSpelling al on c.country_iso2 = al."alpha2Code"
        and c.country_iso3 = al."alpha3Code"
    where "altSpelling" is not null
   ;

  --//set countrycallcode
  perform setval('geoinfo.seq_countrycallcode', 1, false );
  insert into geoinfo.countrycallcode(
    countrycallcode_country_id,
    countrycallcode_callcode
  )
    select distinct
        co.country_id,
        ca."callingCode"
      from geoinfo.country co
        inner join geoinfo.dataset_callingcode ca on co.country_iso2 = ca."alpha2Code"
          and co.country_iso3 = ca."alpha3Code"
  ;

  --//set countrytopleveldomain
  perform setval( 'geoinfo.seq_countrytopleveldomain', 1, false );
  insert into geoinfo.countrytopleveldomain( countrytopleveldomain_country_id, countrytopleveldomain_domain_id )
    select distinct co.country_id, dom.domain_id
      from geoinfo.country co
        inner join geoinfo.dataset_topleveldomain topl on co.country_iso2 = topl."alpha2Code"
          and co.country_iso3 = topl."alpha3Code"
        inner join geoinfo.domain dom on topl."topLevelDomain" = dom.domain_name
  ;

  --//set contryborders
  perform setval( 'geoinfo.seq_countryborder', 1, false );
  insert into geoinfo.countryborder( countryborder_country_id, countryborder_country_broder)
    select distinct co.country_id, bor.country_id
      from geoinfo.country co
        inner join geoinfo.dataset_borders dbor on co.country_iso2 = dbor."alpha2Code"
          and co.country_iso3 = dbor."alpha3Code"
        inner join geoinfo.country bor on dbor.borders = bor.country_iso3
  ;

  --//set countrycurrency
  perform setval( 'geoinfo.seq_countrycurrency', 1, false );
  insert into geoinfo.countrycurrency( countrycurrency_country_id, countrycurrency_currency_id )
    select distinct cu.country_id, curr.currency_id
      from geoinfo.country cu
        inner join geoinfo.dataset_currencies dcurs on cu.country_iso2 = dcurs."alpha2Code"
          and cu.country_iso3 = dcurs."alpha3Code"
        inner join geoinfo.currency curr on coalesce( dcurs."code" ) = curr.currency_code
          and coalesce( dcurs.name ) = curr.currency_name
          and coalesce( dcurs.symbol ) = curr.currency_symbol
  ;

  --//set countrylanguage
  perform setval( 'geoinfo.seq_countrylanguage', 1, false );
  insert into geoinfo.countrylanguage( countrylanguage_country_id, countrylanguage_language_id )
    select distinct cu.country_id, lan.language_id
      from geoinfo.country cu
        inner join geoinfo.dataset_languages dlang on cu.country_iso2 = dlang."alpha2Code"
          and cu.country_iso3 = dlang."alpha3Code"
        inner join geoinfo.language lan on coalesce( lan.language_iso2, '' ) = coalesce( dlang.iso639_1, '' )
          and coalesce( lan.language_iso3, '' ) = coalesce( dlang.iso639_2, '' )
          and coalesce( lan.language_name, '' ) = coalesce( dlang.name, '' )
          and coalesce( lan.language_nativename, '' ) = coalesce( dlang."nativeName", '' )
  ;

  ---//set countrytimezone
  perform setval( 'geoinfo.seq_countrytimezone', 1, false );
  insert into geoinfo.countrytimezone( countrytimezone_country_id, countrytimezone_timezone_id )
    select distinct curr.country_id, tz.timezone_id
      from geoinfo.country curr
        inner join geoinfo.dataset_timezones dtz on curr.country_iso2 = dtz."alpha2Code"
          and curr.country_iso3 = dtz."alpha3Code"
        inner join geoinfo.timezone tz on dtz.timezones = tz.timezone_timezone
  ;

  --//set country regionalBlocks
  perform setval( 'geoinfo.seq_countryregionalbloc', 1, false );
  insert into geoinfo.countryregionalbloc( countryregionalbloc_country_id, countryregionalbloc_regionalbloc_id )
    select distinct cu.country_id, rb.regionalbloc_id
      from geoinfo.country cu
        inner join geoinfo.dataset_regionalblocs drb on cu.country_iso2 = drb."alpha2Code"
          and cu.country_iso3 = drb."alpha3Code"
        inner join geoinfo.regionalbloc rb on drb.acronym = rb.regionalbloc_acronym
  ;

  --//set countrytranslation
  perform setval( 'geoinfo.seq_countrytranslation', 1, false );
  insert into geoinfo.countrytranslation( countrytranslation_country_id, countrytranslation_language_id, countrytranslation_translation )
    select distinct coun.country_id, lang.language_id, dtrans.translations
      from geoinfo.dataset_translations dtrans
        inner join geoinfo.country coun on dtrans."alpha2Code" = coun.country_iso2
          and dtrans."alpha3Code" = coun.country_iso3
        inner join geoinfo.language lang on dtrans.language = lang.language_iso2
      where dtrans.translations is not null
    ;
end;
$$;


--
-- TOC entry 699 (class 1255 OID 16622)
-- Name: dataset_update(character varying, character varying, jsonb); Type: FUNCTION; Schema: geoinfo; Owner: -
--

CREATE FUNCTION geoinfo.dataset_update(arg_dataset_link character varying, arg_dataset_version character varying, arg_dataset_data jsonb) RETURNS geoinfo.dataset
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para povoar o data set bruto
   */
  _dataset geoinfo.dataset;
begin
  update geoinfo.dataset
    set dataset_data = arg_dataset_data,
        dataset_version = arg_dataset_version,
        dataset_updatedate = current_timestamp
    where dataset_link = arg_dataset_link
    returning * into _dataset
  ;

  return _dataset;
end;
$$;


--
-- TOC entry 700 (class 1255 OID 16623)
-- Name: dataset_use(character varying); Type: FUNCTION; Schema: geoinfo; Owner: -
--

CREATE FUNCTION geoinfo.dataset_use(arg_dataset_link character varying) RETURNS geoinfo.dataset
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Definir o data set a ser usado
   */
begin

  update dataset
    set dataset_use = dataset_link = arg_dataset_link
  ;

  return geoinfo.dataset( arg_dataset_link );
end;
$$;


--
-- TOC entry 443 (class 1255 OID 16624)
-- Name: age(timestamp with time zone); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.age(timestamp with time zone) RETURNS integer
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
/**
  Essa função serve para calcular a idade apartir de um timestamptz estabelecido
 */
select cast(to_char(age( $1 ), 'yyyy') as integer);
$_$;


--
-- TOC entry 444 (class 1255 OID 16625)
-- Name: agg_first(anyelement, anyelement); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.agg_first(anyelement, anyelement) RETURNS anyelement
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
/**
  Essa função serve de base para obter o primeiro elemento aggregado na função de agregação first
 */
select $1;
$_$;


--
-- TOC entry 580 (class 1255 OID 16626)
-- Name: agg_last(anyelement, anyelement); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.agg_last(anyelement, anyelement) RETURNS anyelement
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
/**
  Essa função serve de base para obter o último elemento agregado na função de agregação last
  */
select $2;
$_$;


--
-- TOC entry 581 (class 1255 OID 16627)
-- Name: array_delete(anyarray, integer); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.array_delete(list anyarray, element integer) RETURNS anyarray
    LANGUAGE sql
    AS $$
/**
  Essa função serve para remover um elemento em uma dada posição do array
  list corresponde ao array com elementos
  element corresponde ao elemento que devera ser removido
*/
select lib.array_delete( list, element, 1 );
$$;


--
-- TOC entry 582 (class 1255 OID 16628)
-- Name: array_delete(anyarray, integer, integer); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.array_delete(list anyarray, start integer, elements integer) RETURNS anyarray
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função serve para remover um range de elementos em um array e devolver um novo array com elementos que não foram eliminados
   */
begin
  return list[ :start -1 ] || list[ ( start + elements ): ];
end;
$$;


--
-- TOC entry 583 (class 1255 OID 16629)
-- Name: array_max_element(anyarray, anyelement); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.array_max_element(arr anyarray, element anyelement DEFAULT NULL::unknown) RETURNS anyelement
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  /**
    Essa função serve para obeter o maior elemento em um array
  */
begin
  element := null;
  for iterator in 1.. array_length( arr, 1 ) loop
    if arr[ iterator ]  is not null and element is null or element < arr[ iterator ] then
      element := arr [ iterator ];
    end if;
  end loop;

  return element;
end;
$$;


--
-- TOC entry 601 (class 1255 OID 16630)
-- Name: array_min_element(anyarray, anyelement); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.array_min_element(arr anyarray, element anyelement DEFAULT NULL::unknown) RETURNS anyelement
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  /**
    Essa função serve para obter o menor elemento em um array
   */
begin
  element := null;
  for iterator in 1 .. lib.array_length( arr ) loop
    if arr[ iterator ]  is not null and element is null or element > arr[ iterator ] then
      element := arr [ iterator ];
    end if;
  end loop;

  return element;
end;
$$;


--
-- TOC entry 675 (class 1255 OID 16631)
-- Name: coincidences(anyarray, anyarray, jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.coincidences(arguments_left anyarray, arguments_right anyarray, option jsonb DEFAULT NULL::jsonb) RETURNS numeric
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare

  --     iterator_left numeric default 1;

  -- text_left text;
  -- text_iterator text;
  coincidences_match_found numeric default 0;
  coincidences_total numeric;
begin
  coincidences_total := array_length( arguments_right, 1 );

  if arguments_left is null
     or coincidences_total = 0
     or arguments_right is null
     or array_length( arguments_right, 1 ) = 0
  then
    return 0;
  end if;


  for iterator_left in 1 .. array_length( arguments_left, 1 ) loop
    if  arguments_left[ iterator_left ] = any ( arguments_right ) then
      coincidences_match_found := coincidences_match_found + 1;
    end if;
  end loop;
  return ( 100 * coincidences_match_found ) / coincidences_total;
end;
$$;


--
-- TOC entry 676 (class 1255 OID 16632)
-- Name: coincidences_likes(text[], text[], jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.coincidences_likes(arguments_left text[], arguments_right text[], option jsonb DEFAULT NULL::jsonb) RETURNS numeric
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare

  --     iterator_left numeric default 1;

  -- text_left text;
  -- text_iterator text;
  coincidences_match_found numeric default 0;
  coincidences_total numeric;
begin
  coincidences_total := array_length( arguments_right, 1 );

  if arguments_left is null
     or coincidences_total = 0
     or arguments_right is null
     or array_length( arguments_right, 1 ) = 0
  then
    return 0;
  end if;


  for iterator_left in 1 .. array_length( arguments_left, 1 ) loop
    if  arguments_left[ iterator_left ] like any ( arguments_right ) then
      coincidences_match_found := coincidences_match_found + 1;
    end if;
  end loop;

  return ( 100 * coincidences_match_found ) / coincidences_total;
end;
$$;


--
-- TOC entry 658 (class 1255 OID 16633)
-- Name: combinator(text[], integer, text[], integer[], integer); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.combinator(items text[], start integer DEFAULT 1, parent text[] DEFAULT NULL::text[], indexs integer[] DEFAULT NULL::integer[], size integer DEFAULT NULL::integer) RETURNS TABLE(combination_items text[], combination_elements integer, combination_indexs integer[])
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare

    /**
      Essa função serve para combinar de uma forma unica os elementos de uma lista
      items corresponde aos elementos que devem ser combinados ( arg_element_items )
      start corresponde a possição a qual a combinação devera iniciar (arg_element_start)
      parent cooresponde aos elementos já combinado que as novas combinações deverão conter na raiz (arg_element_parent)
      indexs corresponde ao index de todos os elementos já combinados no parrente (arg_element_index)
      size corresponde ao tamanho do array dos elementos que deverão ser combinadoos (arg_element_sizes)
     */

    arg_complete text[];
    arg_index int[];
    arg_items_count int default array_length( parent, 1 );
  begin

    -- Quando a lista dos itens a se combinar for nulo ou vazia então deve-se sair das tentativas de combinação
    if items is null or array_length( items, 1 ) = 0 then
      return;
    end if;

    -- Obter o tamanho total da lista dos elementos
    if size is null then
      size := array_length( items, 1 );
    end if;

    arg_items_count := coalesce( arg_items_count, 0 );
    start := coalesce( start, 1 );

    -- Combinar o parrente com todos os item apartir da posição atual do array
    for i in start .. size loop

      if parent is null then
        arg_complete := array [ items[ i ] ];
        arg_index := array [ i ];
      else
        arg_complete := parent || items[ i ];
        arg_index := indexs || i;
      end if;

      -- Para a nova combinação encontrada, combitar com os proximos item da lista caso tiver mais item na lista
      if i < size then
        return query
          select *
            from lib.combinator( items, i+1, arg_complete, arg_index, size )
        ;
      end if;

      return query select arg_complete, arg_items_count +1, arg_index;

    end loop;
  end;
$$;


--
-- TOC entry 445 (class 1255 OID 16634)
-- Name: dset_random_element(anyarray); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.dset_random_element(elements anyarray) RETURNS anyelement
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função serve para devolver um elemento aleatoriamente de uma lista
   */
begin
  return elements[ lib.dset_random_next( 1, array_length( elements, 1 ) ) ];
end;
$$;


--
-- TOC entry 446 (class 1255 OID 16635)
-- Name: dset_random_name(integer, integer); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.dset_random_name(min integer, max integer) RETURNS text
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para gerar um termo composto apebas por letras com um minimo de sentido de leitura
   */
  vogais text[] default regexp_split_to_array( 'aeiyou', '' );
  consuant text[] default regexp_split_to_array( 'bcdfghjklmnprstvwxz', '' );
  consuant_composid text[] default array[ 'ch', 'qu' ];
  sufix text[] default regexp_split_to_array( 'lmnrsxz', '' );
  sufix_compused text[] default array [ 'ch' ];

  silabaQuant int := lib.dset_random_next( min, max );
  silabaFinal boolean;

  numConsuant int;
  numVogais int;
  numSufixo int;

  name text default '';
begin


  -- Unir todas as consoantes & sufixo
  consuant := consuant || consuant_composid;
  sufix := sufix || sufix_compused;

    numConsuant := array_length( consuant, 1 );
  numVogais := array_length( vogais, 1 );
  numSufixo := array_length( sufix, 1 );

  for i in 1 .. silabaQuant loop
    silabaFinal := i = silabaQuant;

    if not silabaFinal then
      name := name || consuant[ lib.dset_random_next( 1, numConsuant ) ];
      name := name || vogais [ lib.dset_random_next( 1, numVogais ) ];

    -- ? Opcao para colocar sufixo (10% de chance para colocar o sufixo)
    elseif lib.dset_random_next( 1, 100 ) <= 10 then
      -- SUFIXO: consoante, vogal, sufixo
      name := name || consuant[ lib.dset_random_next( 1, numConsuant ) ];
      name := name || vogais [ lib.dset_random_next( 1, numVogais ) ];
      name := name || sufix [ lib.dset_random_next( 1, numSufixo ) ];

    -- ? Adicionar consuante e vogal (90% de chanse de colocar consuante e vogal)
    elseif lib.dset_random_next( 1, 100 ) <= 90 then
      name := name || consuant[ lib.dset_random_next( 1, numConsuant ) ];
      name := name || vogais [ lib.dset_random_next( 1, numVogais ) ];

    else
      name := name || consuant[ lib.dset_random_next( 1, numConsuant ) ];

    end if;

  end loop;

  return name;
end;
$$;


--
-- TOC entry 659 (class 1255 OID 16636)
-- Name: dset_random_next(anyelement); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.dset_random_next(anyelement) RETURNS anyelement
    LANGUAGE plpgsql STRICT
    AS $_$
declare
  arg_next numeric default ( random() * $1 );
begin
  if arg_next < 0 then return lib.dset_random_next( $1 );
  elseif arg_next > $1 then return lib.dset_random_next( $1 );
  end if;
  return arg_next;
end;
$_$;


--
-- TOC entry 660 (class 1255 OID 16637)
-- Name: dset_random_next(anyelement, anyelement); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.dset_random_next(min anyelement, max anyelement) RETURNS anyelement
    LANGUAGE plpgsql
    AS $$
declare
    arg_max_abs numeric default case when abs( max ) > abs( min ) then abs( max ) else abs( min ) end;

    -- definir o sinal para o numero que sera gerado
    arg_sigal int default case
                              when min < 0 and max < 0 then -1
                              when min >= 0 and max >= 0 then 1
                              when lib.dset_random_next( 100 ) <= 50 then -1
                              else 1
        end;

    random numeric default random() * arg_max_abs * arg_sigal;
begin

    if min > max then return null; end if;

    if min = max then return min; end if;

    if random between min  and max then
        return random;
    else
        return lib.dset_random_next( min, max );
    end if;
end;
$$;


--
-- TOC entry 661 (class 1255 OID 16638)
-- Name: dset_random_nextdate(date, date); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.dset_random_nextdate(arg_datainicio date, arg_datafim date) RETURNS date
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
    diferenca int;
begin
    if arg_datainicio > arg_datafim then return null; end if;
    diferenca := arg_datafim - arg_datainicio;

    return arg_datainicio + make_interval(
            0,
            0,
            0,
            lib.dset_random_next( 0, diferenca )
        );
end;
$$;


--
-- TOC entry 594 (class 1255 OID 16639)
-- Name: dset_random_nexttimestamptz(timestamp with time zone, timestamp with time zone); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.dset_random_nexttimestamptz(min timestamp with time zone, max timestamp with time zone) RETURNS timestamp with time zone
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
    diferenca interval;
begin
    if min > max then return null; end if;
    diferenca := max - min;

    return min + make_interval(
            0,
            0,
            0,
            lib.dset_random_next( 0, extract( days from diferenca )::int ),
            lib.dset_random_next( 0, extract( hours from diferenca )::int ),
            lib.dset_random_next( 0, extract( minutes from diferenca )::int ),
            lib.dset_random_next( 0.0::double precision, extract( seconds from diferenca ) )
        );
end;
$$;


--
-- TOC entry 577 (class 1255 OID 16640)
-- Name: dset_random_serial(integer); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.dset_random_serial(length integer) RETURNS text
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função serve para gerar uma combinação eleatoria dos elementos em uma string
   */
  arg_elements constant character varying default 'AaBbC0cDdEe1FfGgH2hIiJj3KkLlM4mNnOo5PpQqR6rSsTt7UuVvW8wXxYy9Zz';

begin
    return lib.dset_random_text( arg_elements, length );
end;
$$;


--
-- TOC entry 578 (class 1255 OID 16641)
-- Name: dset_random_text(integer); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.dset_random_text(length integer) RETURNS text
    LANGUAGE plpgsql STRICT
    AS $$
declare
  /**
    Essa função serve para gerar uma combinação eleatoria dos elementos em uma string
   */
  arg_elements constant character varying default 'AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz';

begin
    return lib.dset_random_text( arg_elements, length );
end;
$$;


--
-- TOC entry 579 (class 1255 OID 16642)
-- Name: dset_random_text(character varying, integer); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.dset_random_text(elements character varying, length integer) RETURNS text
    LANGUAGE plpgsql STRICT
    AS $$
declare
  /**
    Essa função serve para gerar uma combinação eleatoria dos elementos em uma string
   */
  K constant character [] default regexp_split_to_array( elements, '' );
  gen text default '';
  max int default array_length( K, 1 );
begin
  for iterator in 1 .. length loop
    gen := gen || K[ lib.dset_random_next( 1, max ) ];
  end loop;
  return gen;
end;
$$;


--
-- TOC entry 662 (class 1255 OID 16643)
-- Name: dump_functions(text[]); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.dump_functions(VARIADIC schemas text[]) RETURNS SETOF text
    LANGUAGE sql
    AS $$

  select pg_get_functiondef(f.oid) || e';\n\n'
    from unnest( schemas ) with ordinality s ( schema_name, schema_index)
      inner join pg_catalog.pg_namespace n on n.nspname = s.schema_name
      inner join pg_catalog.pg_proc f on f.pronamespace = n.oid
    where f.oid not in (
      select aggfnoid from pg_catalog.pg_aggregate
    )
    order by s.schema_index
  ;
$$;


--
-- TOC entry 677 (class 1255 OID 16644)
-- Name: duplicates(jsonb, jsonb, boolean); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.duplicates(list jsonb, maps jsonb, aggregate boolean DEFAULT false) RETURNS SETOF text
    LANGUAGE plpgsql
    AS $$
declare
  _keys text[] default array(
    select key
      from jsonb_each( maps )
  );
begin
  return query
    with __keys as (
      select distinct kv.key
        from jsonb_array_elements( list ) e( document )
          inner join jsonb_each( e.document ) kv ( key, value ) on kv.key = any( _keys )
        where kv.value = maps->( kv.key )
          and jsonb_typeof( kv.value ) != 'null'
    ) select distinct
        case
          when aggregate then  string_agg( _k.key, ', ') over ()
          else _k.key
        end
      from __keys _k
  ;
end
$$;


--
-- TOC entry 663 (class 1255 OID 16645)
-- Name: each(jsonb, boolean); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.each(jsonb, force boolean DEFAULT false) RETURNS TABLE(name text, index bigint, key text, value jsonb, text text, literal_text text, literal_json text, type text, source text)
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $_$
declare
  _dd numeric;
begin
  each.source := jsonb_typeof( $1 );
  if each.source = 'object' then
    return query
      select
          e.key,
          null::int8,
          e.key,
          e.value,
          lib.extract( e.value ),
          format( '%L', case
            when jsonb_typeof( e.value ) = 'array' then array( select jsonb_array_elements_text( e.value) )::text
            else lib.extract( e.value )
          end) as literal_text,
          format( '%L', e.value::text ),
          jsonb_typeof( e.value ),
          each.source
        from jsonb_each( $1 )e( key, value );
  elseif each.source = 'array' then
    return query
      select
          e.index::text,
          e.index,
          null,
          e.value,
          lib.extract( e.value ),
          format( '%L', case
            when jsonb_typeof( e.value ) = 'array' then array( select jsonb_array_elements_text( e.value) )::text
            else lib.extract( e.value )
          end) as literal_text,
          format( '%L', e.value::text ) as literal_json,
          jsonb_typeof( e.value ),
          each.source
        from  jsonb_array_elements( $1 ) with ordinality e( value, index );
  elseif force then
    each.name := null;
    each.index := null;
    each.key := null;
    each.value := $1;
    each.text := lib.extract( $1 );
    each.literal_text := format( '%L', lib.extract( $1 ));
    each.literal_json := format( '%L', $1::text);
    each.type := jsonb_typeof( $1 );
    return next;
  else
    raise exception 'cannot call each on a non-object or a non-array';
  end if;
end;
$_$;


--
-- TOC entry 447 (class 1255 OID 16646)
-- Name: eval(text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.eval(expression text) RETURNS text
    LANGUAGE plpgsql
    AS $$
declare
  result text;
begin
   execute( format( 'select (%s)::text', expression ) ) into result;
   return result;
end
$$;


--
-- TOC entry 664 (class 1255 OID 16647)
-- Name: exception(character varying, text, text, text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.exception(errocode character varying DEFAULT NULL::character varying, text text DEFAULT NULL::text, hint text DEFAULT NULL::text, detail text DEFAULT NULL::text) RETURNS lib.exception
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para criar uma instancia exception
   */
  _ex lib.exception;
begin
  _ex.errcode :=  errocode;
  _ex.text := text;
  _ex.hint := hint;
  _ex.detail := detail;

  return _ex;
end;
$$;


--
-- TOC entry 448 (class 1255 OID 16648)
-- Name: extract(jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib."extract"(jsonb) RETURNS text
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
select case jsonb_typeof( $1 )
    when 'array' then $1::text
    when 'object' then $1::text
    else $1->>0
  end;
$_$;


--
-- TOC entry 665 (class 1255 OID 16649)
-- Name: format(jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.format(jsonb) RETURNS text
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
  select case jsonb_typeof( $1 )
      when 'array' then $1::text
      when 'object' then $1::text
      else to_jsonb( $1 )::text
    end;
$_$;


--
-- TOC entry 666 (class 1255 OID 16650)
-- Name: in_day(interval); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.in_day(interval) RETURNS double precision
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $_$
declare
  /**
    Devolver o intervalo em termos de segundos
   */
begin
  return extract( epoch from $1 )/( 60.0 * 60.0 * 24.0 );
end;
$_$;


--
-- TOC entry 667 (class 1255 OID 16651)
-- Name: in_hour(interval); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.in_hour(interval) RETURNS double precision
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $_$
declare
  /**
    Devolver o intervalo em termos de segundos
   */
begin
  return extract( epoch from $1 )/( 60.0 * 60.0 );
end;
$_$;


--
-- TOC entry 584 (class 1255 OID 16652)
-- Name: in_minute(interval); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.in_minute(interval) RETURNS double precision
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $_$
declare
  /**
    Devolver o intervalo em termos de segundos
   */
begin
  return extract( epoch from $1 )/60.0;
end;
$_$;


--
-- TOC entry 585 (class 1255 OID 16653)
-- Name: in_month(interval); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.in_month(interval) RETURNS double precision
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $_$
declare
  /**
    Devolver o intervalo em termos de segundos
   */
begin
  return extract( epoch from $1 )/( 60.0 * 60.0 * 24.0 * 30 );
end;
$_$;


--
-- TOC entry 586 (class 1255 OID 16654)
-- Name: in_second(interval); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.in_second(interval) RETURNS double precision
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $_$
declare
  /**
    Devolver o intervalo em termos de segundos
   */
begin
  return extract( epoch from $1 );
end;
$_$;


--
-- TOC entry 589 (class 1255 OID 16655)
-- Name: in_week(interval); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.in_week(interval) RETURNS double precision
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $_$
declare
  /**
    Devolver o intervalo em termos de segundos
   */
begin
  return extract( epoch from $1 )/( 60.0 * 60.0 * 24.0 * 7 );
end;
$_$;


--
-- TOC entry 656 (class 1255 OID 16656)
-- Name: in_year(interval); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.in_year(interval) RETURNS double precision
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $_$
declare
  /**
    Devolver o intervalo em termos de segundos
   */
begin
  return extract( epoch from $1 )/ extract( epoch from make_interval( 1 ));
end;
$_$;


--
-- TOC entry 678 (class 1255 OID 16657)
-- Name: initials(character varying); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.initials(name character varying) RETURNS character varying
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  parts character varying [] default regexp_split_to_array(name, ' ');
  part character varying;
  initials character varying default '';
begin
  FOREACH part in ARRAY parts LOOP
    part := upper(trim(part));
    if part is not null and length(part)> 0 then
      initials := initials || substr(part, 1, 1);
    END IF;
  END LOOP;
  return initials;
end;
$$;


--
-- TOC entry 657 (class 1255 OID 16658)
-- Name: is_bigint(text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.is_bigint(argment text) RETURNS boolean
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  num numeric;
begin
  num := argment::BIGINT;
  return true;
  exception when OTHERS  then return false;
end;

$$;


--
-- TOC entry 609 (class 1255 OID 16659)
-- Name: is_integer(text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.is_integer(argment text) RETURNS boolean
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  num numeric;
begin
  num := argment::integer;
  return true;
  exception when OTHERS  then return false;
end;

$$;


--
-- TOC entry 610 (class 1255 OID 16660)
-- Name: is_numeric(text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.is_numeric(argment text) RETURNS boolean
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  num numeric;
begin
  num := argment::numeric;
  return true;
  exception when OTHERS  then return false;
end;

$$;


--
-- TOC entry 679 (class 1255 OID 16661)
-- Name: jsonb_concat(jsonb[]); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.jsonb_concat(VARIADIC jsonb[]) RETURNS jsonb
    LANGUAGE plpgsql
    AS $_$
  declare
    doc jsonb;
  begin
    for i in 1 .. array_length( $1, 1 ) loop
      if $1[ i ] is null then continue; end if;

      if doc is null then doc := $1[ i ];
      else doc := doc || $1 [ i ];
      end if;
    end loop;
    return doc;
  end;
$_$;


--
-- TOC entry 680 (class 1255 OID 16662)
-- Name: jsonb_iterate(jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.jsonb_iterate(document jsonb) RETURNS TABLE(key text, key_type regtype, value jsonb, value_type text)
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função serve para iterar qualquer tipo de jsonb composta (array ou object )
      e devolver os valores disponiveis no mesmo
   */
begin
  -- para documento null não efetuar nehuma operção
  if document is null then return; end if;

  -- Quando o documento for objecto então iterar as key
  if jsonb_typeof( document ) in ( 'object' ) then
    return query
      select
          doc.key,
          'text'::regtype,
          doc.value,
          jsonb_typeof( doc.value )
        from jsonb_each( document ) doc
    ;
  end if;

  -- Quando o documento for array então iterar os index
  if jsonb_typeof( document ) in ( 'array' ) then
    return query
      select
          doc.index::text,
          'integer'::regtype,
          doc.value,
          jsonb_typeof( doc.value )
        from jsonb_array_elements( document ) with ordinality doc ( value, index )
    ;
  end if;

end;
$$;


--
-- TOC entry 449 (class 1255 OID 16663)
-- Name: jsonb_iterate_cascade(jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.jsonb_iterate_cascade(document jsonb) RETURNS TABLE(path text[], level integer, key text, key_type regtype, value jsonb, value_type text)
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função serve para iterar em cascada qualquer tipo de jsonb composto (array ou object )
      e devolver os valores disponiveis no mesmo
   */
begin
  return query
    with recursive cascade as (
          select
              array[ i.key ] as path,
              0 as level,
              i.*
            from lib.jsonb_iterate ( document ) i
        union all
          select
            ca.path|| i.key,
              ca.level +1,
              i.*
              from cascade ca
            inner join lib.jsonb_iterate( ca.value ) i on true
          where ca.value_type in ( 'object', 'array' )
      )
    select *
      from cascade
      order by path
  ;

end;
$$;


--
-- TOC entry 450 (class 1255 OID 16664)
-- Name: jsonb_object_length(jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.jsonb_object_length(object jsonb) RETURNS integer
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função serve para obtter o tamanho de um objecto json ( a quantidade de par chave valor que o objecto possui )
   */
  iCount int;
  objType text default jsonb_typeof( object );
begin
  if objType is null or objType != 'object' then return null; end if;
  select count(*)  into iCount
  from jsonb_object_keys(object);
  return iCount;
end;
$$;


--
-- TOC entry 536 (class 1255 OID 16665)
-- Name: jsonb_values(anyelement, integer[]); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.jsonb_values(element anyelement, VARIADIC indexes integer[]) RETURNS jsonb
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função serve para devolver varios valores de um documento em um sub-documento jsonb
   */
  sub jsonb := jsonb_build_object();
  doc jsonb;
begin
  doc := to_jsonb( element );
  if array_length( indexes, 1 ) = 0 then return jsonb_build_array(); end if;

  select
    jsonb_agg(
        doc->( key.index )
      ) into sub
  from unnest( indexes ) key( index )
  ;

  return coalesce( sub, jsonb_build_object() );
end;
$$;


--
-- TOC entry 537 (class 1255 OID 16666)
-- Name: jsonb_values(anyelement, text[]); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.jsonb_values(element anyelement, VARIADIC keys text[]) RETURNS jsonb
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função serve para devolver varios valores de um documento em um sub-documento jsonb
   */
  doc jsonb;
  sub jsonb := jsonb_build_object();
begin
  doc := to_jsonb( element );
  if array_length( keys, 1 ) = 0 then return jsonb_build_object(); end if;

  select
    jsonb_object_agg(
        key.name, doc->( key.name )
      ) into sub
  from unnest( keys ) key( name )
  ;

  return coalesce( sub, jsonb_build_object() );
end;
$$;


--
-- TOC entry 541 (class 1255 OID 16667)
-- Name: jsonb_values(jsonb, integer[]); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.jsonb_values(document jsonb, VARIADIC indexes integer[]) RETURNS jsonb
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função serve para devolver varios valores de um documento em um sub-documento jsonb
   */
  sub jsonb := jsonb_build_object();
begin
  if array_length( indexes, 1 ) = 0 then return jsonb_build_object(); end if;

  select
    jsonb_agg(
        document->( key.index )
      ) into sub
  from unnest( indexes ) key( index )
  ;

  return coalesce( sub, jsonb_build_object() );
end;
$$;


--
-- TOC entry 596 (class 1255 OID 16668)
-- Name: jsonb_values(jsonb, text[]); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.jsonb_values(document jsonb, VARIADIC keys text[]) RETURNS jsonb
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função serve para devolver varios valores de um documento em um sub-documento jsonb
   */
  sub jsonb := jsonb_build_object();
begin
  if array_length( keys, 1 ) = 0 then return jsonb_build_object(); end if;

  select
      jsonb_object_agg(
        key.name, document->( key.name )
      ) into sub
    from unnest( keys ) key( name )
  ;

  return coalesce( sub, jsonb_build_object() );
end;
$$;


--
-- TOC entry 681 (class 1255 OID 16669)
-- Name: jsonb_values_as(jsonb, text[]); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.jsonb_values_as(document jsonb, VARIADIC keys text[]) RETURNS jsonb
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função devolve um sub-docomento com os valores renomeados
    urgent: o numero de chave passada tem que ser par
   */
  sub jsonb := jsonb_build_object();
  length int;
begin

  length := array_length( keys, 1 );

  if length = 0 then return jsonb_build_object(); end if;

  -- A lista de chaves a ser renomeadas tem que ser par
  if ( length % 2 ) != 0 then
    raise exception 'lib.jsonb_values_as: lista de chaves impar';
  end if;

  select
      jsonb_object_agg(
        keys[ next.index +1 ], document-> keys[ next.index ]
      ) into sub
    from generate_series( 1, length, 2 ) next( index )
  ;

  return coalesce( sub, jsonb_build_object() );
end;
$$;


--
-- TOC entry 598 (class 1255 OID 16670)
-- Name: money(anyelement); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.money(moneyvalue anyelement) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
declare
  vMoney character varying;
  positive boolean default moneyvalue >= 0;
begin
  if moneyvalue is null then return null; end if;
  moneyvalue := abs( moneyvalue );
  vMoney := to_char(moneyValue, 'FM999G999G999G999G999G999G999G999G999G999G999G999G999G999G999G999G999G999G999G999G999G999G999G999G999G999G999G999G999D90');
  vMoney := replace( vMoney, ',', ' ' );
  vMoney := replace( vMoney, '.', ',' );

  if not positive then
    vMoney := '-'||vMoney;
  end if;

  return lib.normalize( vMoney );
END;

$$;


--
-- TOC entry 682 (class 1255 OID 16671)
-- Name: represent(bigint, text, integer, character); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.represent(number bigint, base text DEFAULT ''::text, length integer DEFAULT 0, lpad character DEFAULT ''::bpchar) RETURNS text
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare

  _base_chars char[] default case
    when base is null or base = '' then '{0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z}'::char[]
    else regexp_split_to_array( base, '' )::char[]
  end;
  _base_length int default array_length( _base_chars, 1 );

  result int8;
  rest int8;
  _rest_char char;
  _code text default '';

begin
  if _base_length < 2 then return null; end if;
  if number is null then return null; end if;
  if number < 0 then return null; end if;


  if exists(
    select c
      from unnest( _base_chars ) c
      group by c
      having count( c ) > 1
  ) then raise exception 'Invalid base representation'; end if;

  result := number;

  while result > 0 loop
    rest := result%_base_length;
    result := result/_base_length;
    _rest_char := _base_chars[ rest+1 ];
    _code := format( '%s%s', _rest_char, _code );
  end loop;

  if( length( _code ) < 1 and number >= 0 ) then _code := _base_chars[ 1 ]; end if;
  if lpad is not null and length is not null and length > length( _code ) then
    _code := lpad( _code, length, lpad );
  end if;

  return  _code;
end
$$;


--
-- TOC entry 451 (class 1255 OID 16672)
-- Name: res(boolean, text, jsonb, jsonb, integer); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.res(result boolean, message text, data jsonb, error jsonb, level integer DEFAULT 0) RETURNS lib.res
    LANGUAGE sql IMMUTABLE
    AS $_$ select row ($1, $2, $3, $4, $5)$_$;


--
-- TOC entry 684 (class 1255 OID 16673)
-- Name: res_exception(character varying, text, text, text, text, text, integer); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.res_exception(errocode character varying DEFAULT NULL::character varying, message text DEFAULT NULL::text, hint text DEFAULT NULL::text, detail text DEFAULT NULL::text, context text DEFAULT NULL::text, user_message text DEFAULT NULL::text, level integer DEFAULT '-1'::integer) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para criar uma instancia exception*/
  _ex lib.exception;
  _res lib.res;
begin
  _ex.errcode :=  errocode;
  _ex.message := coalesce( user_message, message );
  _ex.hint := hint;
  _ex.detail := detail;
  _ex.context := context;
  _ex.exception := true;

  _res.result := false;
  _res.message := message;
  _res.error := to_jsonb( _ex );
  _res.level := level;
  return _res;
end;
$$;


--
-- TOC entry 452 (class 1255 OID 16674)
-- Name: res_false(text, jsonb, integer); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.res_false(message text DEFAULT 'error'::text, error jsonb DEFAULT '{}'::jsonb, level integer DEFAULT 0) RETURNS lib.res
    LANGUAGE sql IMMUTABLE
    AS $_$select lib.res( false, $1, null, $2, level )$_$;


--
-- TOC entry 453 (class 1255 OID 16675)
-- Name: res_true(jsonb, text, integer); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.res_true(data jsonb DEFAULT '{}'::jsonb, message text DEFAULT 'success'::text, level integer DEFAULT 1) RETURNS lib.res
    LANGUAGE sql IMMUTABLE
    AS $_$select lib.res( true, $2, $1, null, level )$_$;


--
-- TOC entry 454 (class 1255 OID 16676)
-- Name: result(boolean); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result(result boolean) RETURNS lib.result
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  /**
    Essa função serve para devolver um resultado
   */
  _res lib.result;
begin
  _res.result := result;
  return _res;
end;
$$;


--
-- TOC entry 455 (class 1255 OID 16677)
-- Name: result(boolean, jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result(result boolean, message jsonb) RETURNS lib.result
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  /**
    Essa função serve para devolver um resultado contumizado a medido do programador que fara uso
   */
  _res lib.result;
begin
  _res.result = result ;
  _res.message = message;
  return _res;
end;
$$;


--
-- TOC entry 599 (class 1255 OID 16678)
-- Name: result(boolean, text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result(result boolean, text text DEFAULT NULL::text) RETURNS lib.result
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  _res lib.result;
begin
  _res.result := result;
  _res.message := jsonb_build_object( 'text', text );
  return _res;
end;
$$;


--
-- TOC entry 591 (class 1255 OID 16679)
-- Name: result_catch(text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result_catch(message text) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** converter a caputra do SQLERRM em um result
  */
  _res lib.result;
begin
  _res := message::lib.result;
  return _res;

  exception when others then
    _res := lib.result_false( message::text );
    return _res;
end;
$$;


--
-- TOC entry 685 (class 1255 OID 16680)
-- Name: result_catch(character varying, text, text, text, text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result_catch(errocode character varying DEFAULT NULL::character varying, message text DEFAULT NULL::text, hint text DEFAULT NULL::text, detail text DEFAULT NULL::text, context text DEFAULT NULL::text) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para criar uma instancia exception
   */
  _ex lib.exception;
  _res lib.result;
begin
  _ex.errcode :=  errocode;
  _ex.message := message;
  _ex.hint := hint;
  _ex.detail := detail;
  _ex.context := context;
  _ex.exception := true;

  _res.result := false;
  _res.message := to_jsonb( _ex ) || jsonb_build_object( 'text', _ex.message );
  return _res;
end;
$$;


--
-- TOC entry 456 (class 1255 OID 16681)
-- Name: result_concat(lib.result, lib.result); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result_concat(lib.result, lib.result) RETURNS lib.result
    LANGUAGE sql IMMUTABLE
    AS $_$
  -- This function concat the result message with other result message value
  select $1.result, $1.message||$2.message ;
$_$;


--
-- TOC entry 457 (class 1255 OID 16682)
-- Name: result_concat(lib.result, jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result_concat(lib.result, jsonb) RETURNS lib.result
    LANGUAGE sql IMMUTABLE
    AS $_$
  -- This function concat the result message with any jsonb value
  select $1.result, $1.message||$2 ;
$_$;


--
-- TOC entry 686 (class 1255 OID 16683)
-- Name: result_exception(text, character varying, text, text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result_exception(text text, errcode character varying DEFAULT NULL::character varying, hint text DEFAULT NULL::text, detail text DEFAULT NULL::text) RETURNS void
    LANGUAGE plpgsql
    AS $$
  -- base comment here
declare
  /** Essa função serve para criar uma exception
    errcode = R9999
  */
  DEFAULT_ERRCODE varchar default 'R9999';
  _res lib.result;
  _ex lib.exception;
begin
    _res := lib.result_false(
      to_jsonb( lib.exception(
          coalesce( errcode, DEFAULT_ERRCODE ),
          text,
          hint,
          detail
        )
      )
    );

  raise exception using
    errcode = coalesce( errcode, DEFAULT_ERRCODE ),
    message = coalesce( _res::text, '' )
  ;
end;
$$;


--
-- TOC entry 458 (class 1255 OID 16684)
-- Name: result_false(jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result_false(content jsonb) RETURNS lib.result
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  _res lib.result;
begin
  _res.result = false ;
  _res.message = content;
  return _res;
end;
$$;


--
-- TOC entry 459 (class 1255 OID 16685)
-- Name: result_false(text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result_false(message text) RETURNS lib.result
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare

begin
  return lib.result_false(
      jsonb_build_object( 'text', message::text)
  );
end;
$$;


--
-- TOC entry 460 (class 1255 OID 16686)
-- Name: result_remove(lib.result, integer); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result_remove(lib.result, integer) RETURNS lib.result
    LANGUAGE sql IMMUTABLE
    AS $_$
  -- This function remove a key in result message
  select $1.result, $1.message - $2 ;
$_$;


--
-- TOC entry 461 (class 1255 OID 16687)
-- Name: result_remove(lib.result, text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result_remove(lib.result, text) RETURNS lib.result
    LANGUAGE sql IMMUTABLE
    AS $_$
  -- This function remove a key in result message
  select $1.result, $1.message - $2 ;
$_$;


--
-- TOC entry 462 (class 1255 OID 16688)
-- Name: result_true(); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result_true() RETURNS lib.result
    LANGUAGE sql IMMUTABLE
    AS $$
-- result_true
select lib.result_true( 'true'  );
$$;


--
-- TOC entry 463 (class 1255 OID 16689)
-- Name: result_true(jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result_true(content jsonb) RETURNS lib.result
    LANGUAGE plpgsql IMMUTABLE
    AS $$
begin
  return lib.result(
      true,
      content
  );
end;
$$;


--
-- TOC entry 464 (class 1255 OID 16690)
-- Name: result_true(text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.result_true(message text) RETURNS lib.result
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  /**
    Essa função serve para devolver um resultado verdadeiro acompanhado com a sua mensagem de texto
   */
begin
  return lib.result_true( jsonb_build_object( 'text', message::text) );
end;
$$;


--
-- TOC entry 687 (class 1255 OID 16691)
-- Name: sets(anyelement, jsonb, text[], jsonb, text, jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.sets(_row anyelement, replacer jsonb DEFAULT NULL::jsonb, defaults text[] DEFAULT NULL::text[], ref jsonb DEFAULT NULL::jsonb, t_where text DEFAULT NULL::text, "with" jsonb DEFAULT NULL::jsonb) RETURNS TABLE("returning" anyelement, action integer, operation text)
    LANGUAGE plpgsql
    AS $_$
declare
  _regclass regclass default pg_typeof( _row )::text::regclass;
  _document jsonb;
begin
  select
      coalesce( jsonb_object_agg( e.key, e.value ), jsonb_build_object() ) into _document
    from jsonb_each( to_jsonb( _row ) ) e
    where jsonb_typeof( e.value ) != 'null'
  ;

  _document := _document || coalesce( replacer, jsonb_build_object() );

  --language=PostgreSQL
  return query execute format('
    select
        cast( iu.sets as %s ),
        iu.action,
        iu.operation
      from lib.sets_doc( $1, $2, $3, $4, $5, $6 ) iu
    ', _regclass) using _regclass, _document, defaults, ref, t_where, "with";
end
$_$;


--
-- TOC entry 465 (class 1255 OID 16692)
-- Name: sets_defaults(anyelement, jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.sets_defaults(anyelement, replacer jsonb DEFAULT NULL::jsonb) RETURNS anyelement
    LANGUAGE plpgsql
    AS $_$
declare
  _doc jsonb;
begin
  _doc := (
      select coalesce( jsonb_object_agg(e.key, e.value ), jsonb_build_object())
      from jsonb_each( to_jsonb($1) )e
      where jsonb_typeof( e.value ) != 'null'
  );
  _doc := _doc || coalesce( $2, '{}' );

  return jsonb_populate_record( $1, lib.sets_defaults( pg_typeof( $1 )::text::regclass, _doc) );
end
$_$;


--
-- TOC entry 688 (class 1255 OID 16693)
-- Name: sets_defaults(regclass, jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.sets_defaults(regclass, replacer jsonb DEFAULT NULL::jsonb) RETURNS jsonb
    LANGUAGE plpgsql
    AS $_$
declare
  _doc jsonb;
begin
  select jsonb_object_agg(
      col.column_name,
      lib.eval( col.column_default::text )
    ) into _doc
  from information_schema.columns col
           inner join pg_class c on c.relname = col.table_name
      and col.table_schema::regnamespace = c.relnamespace
  where col.column_default is not null
    and c.oid = $1;

  if replacer is not null then
    _doc := _doc || replacer;
  end if;
  return _doc;
end;
$_$;


--
-- TOC entry 691 (class 1255 OID 16694)
-- Name: sets_doc(regclass, jsonb, name[], jsonb, text, jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.sets_doc(regclass, doc jsonb DEFAULT NULL::jsonb, defaults name[] DEFAULT NULL::name[], ref jsonb DEFAULT NULL::jsonb, t_where text DEFAULT NULL::text, "with" jsonb DEFAULT NULL::jsonb) RETURNS TABLE(sets text, action integer, rows bigint, operation text)
    LANGUAGE plpgsql
    AS $_$
declare
  _result record;
begin
  -- Try update first
  select array_agg( up.sets ) as sets, count( * ) as rows into _result
    from lib.sets_doc_up( $1, doc, defaults, ref, t_where, "with" ) up( sets )
  ;

  if _result.rows > 0 then
    return query
      select
          n.doc,
          0::int,
          _result.rows,
          'update'
        from unnest( _result.sets ) n( doc );
  else
    return query
      select
          ins.sets,
          1::int,
          _result.rows,
          'insert'
        from lib.sets_doc_in( $1, doc, "with" ) ins ( sets );
  end if;
end
$_$;


--
-- TOC entry 668 (class 1255 OID 16695)
-- Name: sets_doc_in(regclass, jsonb, jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.sets_doc_in(regclass, doc jsonb DEFAULT '{}'::jsonb, "with" jsonb DEFAULT NULL::jsonb) RETURNS SETOF text
    LANGUAGE plpgsql
    AS $_$
declare
  alias text default "with"->>'alias';
begin
  doc := coalesce( doc, '{}'::jsonb );
  alias := coalesce( nullif( trim( alias), '' ), 't' );

  return query execute(
    with __columns as (
        select
          col.column_name,
          format_type( pt.oid, atttypmod ) column_type,
          col.data_type = 'ARRAY' as is_array,
          col.column_default,
          col.is_generated = 'ALWAYS' as is_generated
        from information_schema.columns col
          inner join pg_class c on c.relname = col.table_name
            and col.table_schema::regnamespace = c.relnamespace
          inner join pg_attribute att on col.column_name = att.attname
            and att.attrelid = format( '%s.%s', col.table_schema, col.table_name )::regclass::oid
          inner join pg_type pt on att.atttypid = pt.oid
        where c.oid = $1

    ), __values as (
      select
          c.*,
          case
            when e.key is null and c.column_default is not null then 'default'
            when e.key is not null and jsonb_typeof( e.value ) = 'null' then format( 'null::%s', c.column_type )
            when e.key is not null then format( '%s::%s', case
              when c.column_type in ( 'json', 'jsonb' ) then e.literal_json
              else e.literal_text
            end, c.column_type )
            else 'null'
          end as value
        from __columns c
          left join lib.each( doc ) e on c.column_name = e.name
    ), __prepare as (
        select
            string_agg( quote_ident( v.column_name ), ', ' ) filter ( where not  v.is_generated ) as prepare_columns,
            string_agg( v.value, ', ' ) filter ( where not  v.is_generated ) as prepare_values
          from __values v
          where v.value is not null
    ) select
        case
          when p.prepare_columns is not null then
            --language=PostgreSQL
            format('insert into %s as %I ( %s ) values( %s ) returning ( %I.* )::text', $1, alias, p.prepare_columns, p.prepare_values, alias )
            --language=PostgreSQL
          else format( 'insert into %s as %I default values returning ( %I.* )::text', alias, alias )
        end
      from __prepare p
  );
end;
$_$;


--
-- TOC entry 466 (class 1255 OID 16696)
-- Name: sets_doc_up(regclass, jsonb, text[], jsonb, text, jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.sets_doc_up(regclass, doc jsonb DEFAULT '{}'::jsonb, defaults text[] DEFAULT ARRAY[]::name[], ref jsonb DEFAULT NULL::jsonb, t_where text DEFAULT NULL::text, "with" jsonb DEFAULT NULL::jsonb) RETURNS SETOF text
    LANGUAGE plpgsql
    AS $_$
declare
  /**
    extension:[
      switch = lib.switch
    ]
   */
  _ref jsonb;
  statement text;
  _data record;
  _use_where text default '';
  "security" boolean default "with"->>'security';
  alias text default "with"->>'alias';
  lib_switch boolean default false;
  lib_switch_column text[] default array[]::text[];

begin
  "security" := coalesce( security, true );
  _ref := lib.sets_ref( $1, doc );
  _ref := coalesce( ref, _ref );

  if jsonb_typeof( "with"->'lib.switch' ) = 'boolean' then
    lib_switch := "with"->>'lib.switch';
  elseif jsonb_typeof( "with"->'lib.switch' ) = 'array' then
    lib_switch_column :=  array( select text from  lib.each( "with"->'lib.switch' ) where text is not null );
  end if;
  lib_switch := coalesce( lib_switch, false );

  if security and ( _ref is null or lib.jsonb_object_length( _ref ) = 0 ) then
    return;
  end if;

  defaults := coalesce( defaults, array[]::name[] );
  alias := coalesce( nullif( trim( alias ), '' ), 't' );
  doc := coalesce( doc, '{}'::jsonb );

  with __columns as (
      select
        col.column_name,
        format_type( pt.oid, atttypmod ) column_type,
        col.data_type = 'ARRAY' as is_array,
        col.column_default,
        col.is_generated = 'ALWAYS' as is_generated

      from information_schema.columns col
             inner join pg_class c on c.relname = col.table_name
        and col.table_schema::regnamespace = c.relnamespace
             inner join pg_attribute att on col.column_name = att.attname
        and att.attrelid = format( '%s.%s', col.table_schema, col.table_name )::regclass::oid
             inner join pg_type pt on att.atttypid = pt.oid
      where c.oid = $1
  ), __values as (
    select
        c.column_name,
        c.column_type,
        c.is_generated,
        r.name is not null as _in_ref,
        case
          when c.column_default is not null and d.name is not null then 'default'
          when e.key is not null and jsonb_typeof( e.value ) = 'null' then 'null'
          when e.key is not null and c.column_type in ( 'json', 'jsonb' ) then e.literal_json
          else e.literal_text
        end as value,
        jsonb_typeof( e.value ) = 'array' and not c.is_array and
          true in ( lib_switch, c.column_name = any( lib_switch_column ) )
        as use_swith,
        case
          when r.name is not null and c.column_type in ( 'json', 'jsonb' ) then r.literal_json::text
          when r.name is not null then r.literal_text
        end as ref_value
      from __columns c
        left join lib.each( doc ) e on c.column_name = e.name
        left join lib.each( _ref ) r on c.column_name = r.name
        left join unnest( defaults ) d( name ) on c.column_name = d.name
  ), __sets as (
    select
        v.*,
        v.value is not null as _in_value,
        case
          when not use_swith then format( '%I = %s::%s', v.column_name, v.value, v.column_type )
          else format( '%I = %s::%s', v.column_name, format( 'lib.switch( %I, variadic %s::%s[] )', v.column_name, v.value, v.column_type ), v.column_type )
        end as set
      from __values v
  )
  select
      count( * ) filter ( where s._in_ref ) as _keys,
      string_agg( format( e'   %I = %s::%s\n', s.column_name, s.ref_value, s.column_type ),  e' and ' ) filter ( where s._in_ref ) as _where,

      count( * ) filter ( where s._in_value and not s.is_generated ) as _changes,
      string_agg( format( '    %s', s.set ),          e',\n' ) filter ( where s._in_value and not s.is_generated ) as prepare_sets
      into _data
    from __sets s
    where true in ( s._in_ref, s._in_value )
  ;
  if _data._changes > 0 and ( _data._keys > 0 or not security ) then
    _use_where := case
      when _data._keys > 0 and t_where is null   then  format( e'  where\n %s', _data._where )
      when t_where is not null and  not security then  format( e'  where %s', t_where )
      else                                              format( e'  where false' ) -- don't update anything
    end;

    statement := format( e'update %s as %I set\n %s\n  %s\n  returning ( %I.* )::text', $1, alias, _data.prepare_sets, _use_where, alias );
    return query execute statement;
  end if;
end
$_$;


--
-- TOC entry 467 (class 1255 OID 16698)
-- Name: sets_in(anyelement, jsonb, jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.sets_in(_row anyelement, replacer jsonb DEFAULT NULL::jsonb, "with" jsonb DEFAULT NULL::jsonb) RETURNS TABLE("returning" anyelement, action integer, operation text)
    LANGUAGE plpgsql
    AS $_$
declare
  _regclass regclass default pg_typeof( _row )::text::regclass;
  _document jsonb;
begin
  select
      coalesce( jsonb_object_agg( e.key, e.value ), jsonb_build_object() ) into _document
    from jsonb_each( to_jsonb( _row ) ) e
    where jsonb_typeof( e.value ) != 'null'
  ;

  _document := _document || coalesce( replacer, jsonb_build_object() );

  --language=PostgreSQL
  return query execute format( $sql$
    select
        cast( iu.sets as %s ),
        1,
        'insert'
      from lib.sets_doc_in( $1,  $2, $3 ) iu ( sets )
    ;$sql$, _regclass ) using _regclass, _document, "with";
end
$_$;


--
-- TOC entry 669 (class 1255 OID 16699)
-- Name: sets_pks(regclass); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.sets_pks(regclass) RETURNS TABLE(column_name name, column_type regtype)
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
  select
      pg_attribute.attname,
      format_type(pg_attribute.atttypid, pg_attribute.atttypmod)::regtype
    from pg_index, pg_class, pg_attribute, pg_namespace
    where pg_class.oid = $1
      and indrelid = pg_class.oid
      and pg_class.relnamespace = pg_namespace.oid
      and pg_attribute.attrelid = pg_class.oid
      and pg_attribute.attnum = any( pg_index.indkey )
      and indisprimary
$_$;


--
-- TOC entry 670 (class 1255 OID 16700)
-- Name: sets_pks_array(regclass); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.sets_pks_array(regclass) RETURNS name[]
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
  select array(
    select
        pg_attribute.attname
      from pg_index, pg_class, pg_attribute, pg_namespace
      where pg_class.oid = $1
        and indrelid = pg_class.oid
        and pg_class.relnamespace = pg_namespace.oid
        and pg_attribute.attrelid = pg_class.oid
        and pg_attribute.attnum = any( pg_index.indkey )
        and indisprimary
  )
$_$;


--
-- TOC entry 671 (class 1255 OID 16701)
-- Name: sets_ref(anyelement); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.sets_ref(_record anyelement) RETURNS jsonb
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
select jsonb_object_agg( column_name, to_jsonb( $1 )->column_name )
from lib.sets_pks( pg_typeof( $1 )::text::regclass );
$_$;


--
-- TOC entry 672 (class 1255 OID 16702)
-- Name: sets_ref(jsonb, name[]); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.sets_ref(jsonb, name[]) RETURNS jsonb
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
  select jsonb_object_agg( r.name, to_jsonb( $1 )->( r.name ) )
    from unnest( $2 ) r( name );
$_$;


--
-- TOC entry 692 (class 1255 OID 16703)
-- Name: sets_ref(regclass, jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.sets_ref("table" regclass, document jsonb) RETURNS jsonb
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
  select jsonb_object_agg( column_name, $2->column_name )
  from lib.sets_pks( $1 );
$_$;


--
-- TOC entry 693 (class 1255 OID 16704)
-- Name: sets_ref_clean(regclass, jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.sets_ref_clean("table" regclass, document jsonb) RETURNS jsonb
    LANGUAGE plpgsql
    AS $_$
declare
  _data record;
begin
  with __doc_each as (
    select
        edoc.key,
        edoc.value,
        edoc.text,
        edoc.type
      from lib.each( document ) edoc
  )
  select
      jsonb_object_agg( pk.column_name , lib.eval( format('to_jsonb((%L)::%s)', e.text, pk.column_type ) )::jsonb ) as reference,
      count( * ) filter ( where e.value is null or e.type = 'null') as invalids
      into _data
    from lib.sets_pks( $1 ) pk
      left join __doc_each e on pk.column_name = e.key
  ;

  if _data.invalids = 0 then
    return _data.reference;
  end if;
  return null;
end;
$_$;


--
-- TOC entry 694 (class 1255 OID 16705)
-- Name: sets_up(anyelement, jsonb, text[], jsonb, text, jsonb); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.sets_up(_row anyelement, replacer jsonb DEFAULT NULL::jsonb, defaults text[] DEFAULT NULL::text[], ref jsonb DEFAULT NULL::jsonb, t_where text DEFAULT NULL::text, "with" jsonb DEFAULT NULL::jsonb) RETURNS TABLE("returning" anyelement, action integer, operation text)
    LANGUAGE plpgsql
    AS $_$
declare
  _regclass regclass default pg_typeof( _row )::text::regclass;
  _document jsonb;
begin
  select
      coalesce( jsonb_object_agg( e.key, e.value ), jsonb_build_object() ) into _document
    from jsonb_each( to_jsonb( _row ) ) e
    where jsonb_typeof( e.value ) != 'null'
  ;

  _document := _document || coalesce( replacer, jsonb_build_object() );

  --language=PostgreSQL
  return query execute format($sql$
    select
        iu.sets::%s ,
        0,
        'update'
      from lib.sets_doc_up( $1, $2, $3, $4, $5, $6 ) iu( sets )
    $sql$, _regclass ) using _regclass, _document, defaults, ref, t_where, "with";
end
$_$;


--
-- TOC entry 468 (class 1255 OID 16706)
-- Name: str_is_numeric_sequence(text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.str_is_numeric_sequence(argment text) RETURNS boolean
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função serve para verificar se uma string é uma sequencia numerica inteira
   */
  list character [] default regexp_split_to_array( argment, '');
  nums character [] default regexp_split_to_array( '0123456789', '');
  c character;

begin
  foreach c in array list loop
    -- quando do carracter for diferente de todos os algarismos expressos no array
    if  c != all ( nums ) then
      return false;
    end if;
  end loop;

  return true;
end;

$$;


--
-- TOC entry 469 (class 1255 OID 16707)
-- Name: str_nospace(text); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.str_nospace(text) RETURNS text
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
/**
  Essa função serve para remover todos os espaçõs em uma string
 */
select lib.str_normalize( replace( $1, ' ', '' ) )
$_$;


--
-- TOC entry 673 (class 1255 OID 16708)
-- Name: switch(anyelement, anyarray); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.switch(anyelement, VARIADIC list anyarray) RETURNS anyelement
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $_$
declare
  _element record;
begin

  -- List na posição 1 é o valor atual por isso não pode ser nulo
  if $1 is null then return null; end if;

  with __clean as (
    select v.value,
        mode() within group ( order by index ) as findex
      from  unnest( list ) with ordinality v( value, index)
      where value is not null
      group by v.value
  ) select array_agg( value order by findex ) into list from __clean;

  if list is null then return $1; end if;
  
  if array_length( list, 1 ) = 0 then
    return $1;
  end if;

  -- Quando a lista tiver apenas um unico elemento
  if array_length( list, 1 ) = 1 then
    return list[ 1 ];
  end if;

  -- Para lista de mais de um elemento
  for i in 1 .. array_length( list, 1 ) loop

    if $1 = list[ i ] and i = array_length( list, 1 ) then
      return list[ 1 ];
    elseif $1 = list[ i ] then
      return list [ i+1 ];
    end if;
  end loop;

  return null;
end;
$_$;


--
-- TOC entry 674 (class 1255 OID 16709)
-- Name: swith(anyarray); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.swith(VARIADIC list anyarray) RETURNS anyelement
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  _element record;
begin

  -- List na posição 1 é o valor atual por isso não pode ser nulo
  if list[ 1 ] is null then return null; end if;

  -- distinct elements and clean null
  for _element in
    select *
      from unnest( list ) with ordinality li( element, index )
      where li.element is not null
  loop
    if _element.element = any ( list ) then continue;
    else list := list || _element.element;
    end if;
  end loop;

  -- Quando a lista tiver apenas um unico elemento
  if array_length( list, 1 ) = 2 and list[ 1 ] = list[ 2 ] then
    return list[ 1 ];
  elseif array_length( list, 1 ) = 2 then
    return null;
  end if;

  -- Para lista de mais de um elemento
  for i in 2 .. array_length( list, 1 ) loop

    if list[ i ] = list[ 1 ] and i = array_length( list, 1 ) then
      return list[ 2 ];
    elseif list[ i ] = list[ 1 ] then
      return list [ i+1 ];
    end if;
  end loop;

  return null;
end;
$$;


--
-- TOC entry 470 (class 1255 OID 16710)
-- Name: version(); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib.version() RETURNS text
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
select 'v1-uuid.3.7::0 - 2019.04.09'
$$;


--
-- TOC entry 471 (class 1255 OID 16711)
-- Name: when(boolean, anyelement, anyelement); Type: FUNCTION; Schema: lib; Owner: -
--

CREATE FUNCTION lib."when"(boolean, _then anyelement, _else anyelement DEFAULT NULL::unknown) RETURNS anyelement
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$ select case when $1 then $2 else $3 end $_$;


--
-- TOC entry 857 (class 1255 OID 19645)
-- Name: api_change_entryset(jsonb); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.api_change_entryset(args jsonb) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    essa funcao server para editar uma entrada editavel
   */
  name name default args->>'name';
  value varchar default args->>'value';
  label varchar default args->>'label';
  domain varchar default args->>'domain';
begin
  return libdom.set( name, value, label, domain, false );
end;
$$;


--
-- TOC entry 866 (class 1255 OID 19646)
-- Name: api_load_entryset(jsonb); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.api_load_entryset(args jsonb) RETURNS SETOF jsonb
    LANGUAGE sql
    AS $$
  select to_jsonb( e )
    from libdom.entryset e
    where e.editable
    order by e.domain nulls last,
      e.label,
      e.name,
      e.value

$$;


--
-- TOC entry 761 (class 1255 OID 19647)
-- Name: columns(regclass); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.columns(regclass) RETURNS TABLE(name character varying, type character varying, defaults text, isarray boolean, isgenerated boolean)
    LANGUAGE sql IMMUTABLE STRICT PARALLEL SAFE
    AS $_$
with __columns as (
  select
    col.column_name,
    format_type( pt.oid, atttypmod )::varchar column_type,
    col.column_default,
    col.data_type = 'ARRAY' as is_array,
    col.is_generated = 'ALWAYS' as is_generated
  from information_schema.columns col
         inner join pg_class c on c.relname = col.table_name
    and col.table_schema::regnamespace = c.relnamespace
         inner join pg_attribute att on col.column_name = att.attname
    and att.attrelid = format( '%s.%s', col.table_schema, col.table_name )::regclass::oid
         inner join pg_type pt on att.atttypid = pt.oid
  where c.oid = $1
) select *
from __columns _c
$_$;


--
-- TOC entry 762 (class 1255 OID 19648)
-- Name: constant(character varying[]); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.constant(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS libdom.constant
    LANGUAGE sql IMMUTABLE PARALLEL SAFE
    AS $$
  /**
    Essa função serve para carregar os valores das constante e inicia-la
   */
  select jsonb_populate_record( null::libdom.constant, libdom.constant_document( variadic prefix ));
$$;


--
-- TOC entry 763 (class 1255 OID 19649)
-- Name: constant_document(character varying[]); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.constant_document(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS jsonb
    LANGUAGE sql IMMUTABLE PARALLEL SAFE
    AS $$
  -- Devolver o mapeamento dos estados
   select
      jsonb_object_agg( cv.name, cv.value )
    from libdom.prefix( variadic prefix ) cv
;
$$;


--
-- TOC entry 881 (class 1255 OID 19686)
-- Name: describe(character varying[]); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.describe(VARIADIC prefix character varying[] DEFAULT NULL::character varying[]) RETURNS TABLE(declaration text, name name, type regtype, value text, domain character varying, label character varying, editable boolean, comment character varying, "default" character varying)
    LANGUAGE sql IMMUTABLE
    AS $$
-- Devolver o mapeamento dos estados
  select
      format( '%I %s default %L::%s;', cv.name, cv.type, cv.value, cv.type ),
      cv.*,
      format( 'libdom.get(%L::name)::%s', cv.name, cv.type )
    from libdom.prefix(  variadic prefix ) cv
$$;


--
-- TOC entry 764 (class 1255 OID 19651)
-- Name: domain(character varying[]); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.domain(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS libdom.domain
    LANGUAGE sql IMMUTABLE PARALLEL SAFE
    AS $$
      /**
        Essa função serve para carregar os valores das constante e inicia-la
       */
  select jsonb_populate_record( null::libdom.domain, libdom.domain_document( variadic prefix ));
$$;


--
-- TOC entry 765 (class 1255 OID 19652)
-- Name: domain_document(character varying[]); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.domain_document(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS jsonb
    LANGUAGE sql IMMUTABLE PARALLEL SAFE
    AS $$
  -- Devolver o mapeamento dos estados
  select
      jsonb_object_agg( cv.name, cv.label )
    from libdom.prefix( variadic prefix ) cv
  ;
$$;


--
-- TOC entry 766 (class 1255 OID 19653)
-- Name: domain_of(name); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.domain_of(name name) RETURNS text
    LANGUAGE sql IMMUTABLE PARALLEL SAFE
    AS $$

  /**
      Essa função serve para devolver o valor especifico de uma constante
   */
  select cv.label
    from libdom.entryset cv
    where cv.name = domain_of.name;
$$;


--
-- TOC entry 767 (class 1255 OID 19654)
-- Name: domain_of(character varying, text); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.domain_of(domain character varying, value text) RETURNS text
    LANGUAGE sql IMMUTABLE PARALLEL SAFE
    AS $$

  /**
      Essa função serve para devolver o valor especifico de uma constante
   */
  select cv.label
    from libdom.entryset cv
    where cv.name = domain_of.domain
      and cv.value = domain_of.value;
$$;


--
-- TOC entry 834 (class 1255 OID 19765)
-- Name: domset(character varying, character varying, character varying, character varying); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.domset(_class character varying, _column character varying, _domain character varying, _comment character varying DEFAULT NULL::character varying) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
declare
  /**doc

   doc*/
  _data record;
begin
    update libdom.domsync
      set domain = _domain,
          comment = _comment
    where classname = _class
      and columnname = _column
    returning * into _data
  ;

  if _data.classname is null then
    insert into libdom.domsync(
      classname,
      columnname,
      domain,
      comment
    ) values (
      _class,
      _column,
      _domain,
      _comment
    );
  end if;
  return true;
end;
$$;


--
-- TOC entry 871 (class 1255 OID 19655)
-- Name: domsync(character varying, character varying, character varying); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.domsync(classname character varying, columnname character varying, domain character varying) RETURNS SETOF text
    LANGUAGE plpgsql
    AS $_$
declare
  _comment record;
  _domsync record;
  _command text;
begin
  for _domsync in
    with __column_comment as (
      select
          ds.classname,
          ds.columnname,
          array_agg( ds.domain ) as _domain,
          format( '<ul>%s</ul>',
            string_agg( format( '<li>%s ->> %s</li>', ds.domain, ds.comment ), e'\n' ) filter ( where ds.comment is not null )
          ) as comment
        from libdom.domsync ds
          inner join libdom.columns( ds.classname::regclass ) c on ds.columnname = c.name
        where ds.classname = coalesce ( $1, ds.classname )
          and ds.columnname = coalesce( $2, ds.columnname )
          and ds.domain = coalesce( $3, ds.domain )
        group by ds.classname, ds.columnname
    ) select *
        from __column_comment cc
        where domsync.domain = any ( cc._domain ) or domsync.domain is null
  loop
      select
          format( '<table><tr><th>lable</th><th>value</th><th>domain</th><th>name</th></tr>%s</table>', string_agg( format( '<tr>%s %s %s %s </tr>',
            format( '<td>%s</td>', es.label ),
            format( '<td>%s</td>', es.value ),
            format( '<td>%s</td>', es.domain ),
            format( '<td>%s</td>', es.name )
          ), e'\n' ) ) as comment
          into _comment
        from libdom.entryset es
        where es.domain = any ( _domsync._domain );

      _command := format( 'comment on column %s.%I is $comment$ %s $comment$;', _domsync.classname, _domsync.columnname, format( e'<html><style>
table, th, td {
  border:1px solid black;
}
</style><body><div>%s\n%s</div></body></html>', _domsync.comment, _comment.comment ) );
      execute _command;
      return next _command;
  end loop;
end
$_$;


--
-- TOC entry 872 (class 1255 OID 19656)
-- Name: entry(name, regtype, anyelement, character varying, character varying, boolean, character varying, boolean); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.entry(name name, type regtype, val anyelement, domain character varying DEFAULT NULL::character varying, label character varying DEFAULT NULL::character varying, editable boolean DEFAULT false, comment character varying DEFAULT NULL::character varying, force boolean DEFAULT false) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
declare
  /**
    * Essa função serve para registrar o valor de uma constante na base de dados
    * Se a constante já tiver o valor definido esse valor pode ser subistituido
      pelo novo desde que o parametro arg_entryset_replace estiver verdadeiro
    * Caso existir sem o parametro arg_entryset_replace verdadeiro uma excessão sera lançada
   */
  _entryset libdom.entryset;

begin

  editable := coalesce( editable, false );

  if domain is null and exists(
    select *
      from libdom.entryset e
      where e.domain = entry.domain
        and e.name != entry.name
        and e.value = val::text
  ) and not force then
    raise exception 'Já existe um dominio com o mesmo valor para este grupo!';
  end if;

  select * into _entryset
    from libdom.entryset const
    where const.name = entry.name
  ;


  -- Deletar o valor de constante
  delete from libdom.entryset e where e.name = entry.name;

  -- Recriar o valor de constante
  insert into libdom.entryset(
    name,
    type,
    value,
    editable,
    label,
    comment,
    domain
  ) values (
     entry.name,
     entry.type,
     entry.val,
     entry.editable,
     entry.label,
     entry.comment,
     entry.domain
   ) returning * into _entryset;
  return true;
end;
$$;


--
-- TOC entry 873 (class 1255 OID 19657)
-- Name: entry_drop(name, boolean); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.entry_drop(arg_name name, arg_dropforce boolean DEFAULT false) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
declare
  /**
    * Essa função serve para registrar o valor de uma constante na base de dados
    * Se a constante já tiver o valor definido esse valor pode ser subistituido
      pelo novo desde que o parametro arg_entryset_replace estiver verdadeiro
    * Caso existir sem o parametro arg_entryset_replace verdadeiro uma excessão sera lançada
   */
  _entryset libdom.entryset;
  command text;
  arg_entryset_continer regtype := 'libdom.constant'::regtype;
begin
  arg_dropforce := coalesce( arg_dropforce, false );
  select * into _entryset
    from libdom.entryset const
    where const.name = arg_name
  ;

  -- Destruir a constante casao existir
  if arg_dropforce then
    command := format( 'alter type %s drop attribute if exists %I cascade;', arg_entryset_continer, arg_name );
  else
    command := format( 'alter type %s drop attribute if exists %I;', arg_entryset_continer, arg_name );
  end if;
  execute command;

  -- Deletar o valor de constante
  delete from libdom.entryset where name = arg_name;

  return true;
end;
$$;


--
-- TOC entry 874 (class 1255 OID 19658)
-- Name: entry_list(jsonb); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.entry_list(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  _name character varying default args->>'name';
  _value character varying default args->>'value';
  _domain character varying default args->>'domain';
  _label character varying default args->>'label';
begin
  return query
    with __entry as (
      select
          es.name,
          es.type,
          es.value,
          es.domain,
          es.label
        from libdom.entryset es
        where es.name = coalesce( _name, es.name )
          and es.value = coalesce( _value, es.value )
          and coalesce( es.domain, '' ) = coalesce( _domain, es.domain, '' )
          and coalesce( es.label, '' ) = coalesce( _label, es.label, '' )
      ) select to_jsonb( _e )
          from __entry _e
          order by _e.domain,
            _e.label,
            _e.name,
            _e.value
  ;
end;
$$;


--
-- TOC entry 875 (class 1255 OID 19659)
-- Name: exports(character varying, character varying[]); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.exports(schema_name character varying DEFAULT 'libdom'::character varying, VARIADIC name character varying[] DEFAULT ARRAY[]::character varying[]) RETURNS TABLE(name character varying, type regtype, value text, declaration text)
    LANGUAGE sql
    AS $_$
with names as (
  select array_agg( distinct coalesce( un, '')||'%' ) as list
  from unnest( $2 ) un
)
  select
    cv.name,
    cv.type,
    cv.value,
    format( 'select %I.entry(name := %L, type := %L::regtype, val := %L::text, domain := %L::varchar, label := %L, editable := %L, comment := %L );',
            schema_name,
            cv.name,
            cv.type,
            cv.value,
            cv.domain,
            cv.label,
            cv.editable,
            cv.comment
      )
  from libdom.entryset cv inner join names na on true
  where cv.name like any( na.list )
$_$;


--
-- TOC entry 876 (class 1255 OID 19660)
-- Name: get(name); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.get(arg_name name) RETURNS text
    LANGUAGE sql IMMUTABLE PARALLEL SAFE
    AS $$

  /**
      Essa função serve para devolver o valor especifico de uma constante
   */
  select cv.value
    from libdom.entryset cv
    where cv.name = arg_name;
$$;


--
-- TOC entry 363 (class 1259 OID 19661)
-- Name: entryset; Type: TABLE; Schema: libdom; Owner: -
--

CREATE TABLE libdom.entryset (
    name name NOT NULL,
    type regtype NOT NULL,
    value text NOT NULL,
    domain character varying,
    label character varying,
    editable boolean DEFAULT false NOT NULL,
    comment character varying
);


--
-- TOC entry 5789 (class 0 OID 0)
-- Dependencies: 363
-- Name: TABLE entryset; Type: COMMENT; Schema: libdom; Owner: -
--

COMMENT ON TABLE libdom.entryset IS 'Essa entidade serve para armazenar os valores das constantes';


--
-- TOC entry 5790 (class 0 OID 0)
-- Dependencies: 363
-- Name: COLUMN entryset.name; Type: COMMENT; Schema: libdom; Owner: -
--

COMMENT ON COLUMN libdom.entryset.name IS 'Corresponde ao nome da constante';


--
-- TOC entry 5791 (class 0 OID 0)
-- Dependencies: 363
-- Name: COLUMN entryset.type; Type: COMMENT; Schema: libdom; Owner: -
--

COMMENT ON COLUMN libdom.entryset.type IS 'Corresponde ao tipo da constante';


--
-- TOC entry 5792 (class 0 OID 0)
-- Dependencies: 363
-- Name: COLUMN entryset.value; Type: COMMENT; Schema: libdom; Owner: -
--

COMMENT ON COLUMN libdom.entryset.value IS 'Corresponde ao valor da constante';


--
-- TOC entry 5793 (class 0 OID 0)
-- Dependencies: 363
-- Name: COLUMN entryset.label; Type: COMMENT; Schema: libdom; Owner: -
--

COMMENT ON COLUMN libdom.entryset.label IS 'Corresponde a descrição da constante';


--
-- TOC entry 5794 (class 0 OID 0)
-- Dependencies: 363
-- Name: COLUMN entryset.editable; Type: COMMENT; Schema: libdom; Owner: -
--

COMMENT ON COLUMN libdom.entryset.editable IS 'Esse atributo indica se a constante pode ser editavel';


--
-- TOC entry 5795 (class 0 OID 0)
-- Dependencies: 363
-- Name: COLUMN entryset.comment; Type: COMMENT; Schema: libdom; Owner: -
--

COMMENT ON COLUMN libdom.entryset.comment IS 'Commentario para a constante';


--
-- TOC entry 796 (class 1255 OID 19667)
-- Name: prefix(character varying[]); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.prefix(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS SETOF libdom.entryset
    LANGUAGE plpgsql IMMUTABLE PARALLEL SAFE
    AS $$
declare
  _prefix varchar[];
  _length int default coalesce( array_length( prefix, 1), 0 );
begin
  select array_agg( format( '%s%%', e.element ) ) into _prefix
  from unnest( coalesce( prefix, '{}'::text[] ) ) e ( element );

  return query
    select e.*
    from libdom.entryset e
    where e.name like any( _prefix )
       or _length = 0
  ;
end;
$$;


--
-- TOC entry 797 (class 1255 OID 19668)
-- Name: rebuild(boolean); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.rebuild(clean boolean) RETURNS SETOF text
    LANGUAGE plpgsql
    AS $$
declare
  _data record;
  _const libdom.constant;
  _dom libdom.domain;
  command text;
  constant_class regtype default 'libdom.constant'::regtype;
  domain_class regtype default 'libdom.domain'::regtype;
begin

  -- Lipar todos os atributos atual nas classe de dominio e de constant
  if clean then
    for _data in
      select *
        from jsonb_each (to_jsonb( _const ))
    loop
      command := format( 'alter type %s drop attribute if exists %I', _data.key, constant_class );
      execute command;
    end loop;

    for _data in
      select *
        from jsonb_each (to_jsonb( _dom ))
    loop
      command := format( 'alter type %s drop attribute if exists %I', _data.key, domain_class);
      execute command;
    end loop;

  end if;

  -- Recriar todos os atributos para a classe de dominio e de constant
  for _data in
    select *
      from libdom.entryset e
  loop
    return next to_jsonb( _data )::text;
    return query select * from libdom.sync_entry( _data.name, 'libdom.constant' );
    return query select * from libdom.sync_entry( _data.name, 'libdom.domain' );
  end loop;
  
  return query select * from libdom.domsync( null, null, null );
end;
$$;


--
-- TOC entry 877 (class 1255 OID 19669)
-- Name: set(name, character varying, character varying, character varying, boolean); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.set(name name, value character varying DEFAULT NULL::character varying, label character varying DEFAULT NULL::character varying, domain character varying DEFAULT NULL::character varying, force boolean DEFAULT false) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
      Essa função serve para atualizar o valor de uma constante
   */
  _entryset libdom.entryset;
begin

  if domain is null and exists(
      select *
      from libdom.entryset e
      where e.domain = set.domain
        and e.name != set.name
        and e.value = set.value::text
    ) and not force then
    return jsonb_build_object(
      'result', false,
      'message', 'Já existe um dominio com o mesmo valor para este grupo!'
    );
  end if;

  if !exists(
    select *
      from libdom.entryset e
      where e.name = set.name
        and e.editable
  ) then
    return jsonb_build_object(
        'result', false,
        'message', 'Não existe uma entrada editavel com este nome!'
      );
  end if;

  update libdom.entryset
    set ( value, label, domain ) = ( value, label, domain )
    where name = name
    returning * into _entryset
  ;

  return jsonb_build_object(
    'result', true,
    'data', jsonb_build_object(
      'entryset', _entryset
    )
  );
end;
$$;


--
-- TOC entry 878 (class 1255 OID 19670)
-- Name: sync_drop(name, regtype); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.sync_drop(name name, classtype regtype) RETURNS SETOF text
    LANGUAGE plpgsql
    AS $$
declare
  command text;
begin
  command := format( 'alter type %s drop attribute if exists %I', classtype, name );
  execute command;
end;
$$;


--
-- TOC entry 879 (class 1255 OID 19671)
-- Name: sync_entry(name, regtype); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.sync_entry(name name, classtype regtype) RETURNS SETOF text
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Syncronizar uma entry em na calsse expecificada
   */
  command text;
  _entry libdom.entryset;
  _type regtype default 'text'::regtype;
begin

  select * into _entry
    from libdom.entryset e
    where e.name = sync_entry.name;

  if classtype = 'libdom.constant'::regtype then
    _type := _entry.type;
  end if;

  -- Destruir a constante casao existir
  command := format( 'alter type %s drop attribute if exists %I;', classtype, name );
  execute command;
  return next command;

  -- Recriar a constante novamente
  command := format( 'alter type %s add attribute %I %s;', classtype, name, _type );
  execute command;
  return next command;

  if _entry.comment is not null then
    command := format( 'comment on column %s.%I is %L;', classtype, name, _entry.comment );
    execute command;
    return next command;
  end if;
end;
$$;


--
-- TOC entry 882 (class 1255 OID 19672)
-- Name: trigger_sync_domsync(); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.trigger_sync_domsync() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  _new libdom.domsync;
  _old libdom.domsync;
begin
  if tg_op in ( 'UPDATE', 'INSERT' ) then
    perform libdom.domsync( _new.classname, _new.columnname, _new.domain );
  end if;
  return null;
end;
$$;


--
-- TOC entry 880 (class 1255 OID 19673)
-- Name: trigger_sync_entry(); Type: FUNCTION; Schema: libdom; Owner: -
--

CREATE FUNCTION libdom.trigger_sync_entry() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  _new libdom.entryset;
  _old libdom.entryset;
begin
  _new := new;
  _old := old;


  if tg_op = 'UPDATE' and _new.name != _old.name then
    perform libdom.sync_drop( _old.name, 'libdom.constant' );
    perform libdom.sync_drop( _old.name, 'libdom.domain' );
  end if;

  if tg_op in ( 'INSERT', 'UPDATE' ) and (
    coalesce( _new.name::text, '' ) != coalesce( _old.name::text, '' )
    or coalesce( _new.type::text, '' ) != coalesce( _old.type::text, '' )
    or coalesce( _new.comment::text, '' ) != coalesce( _old.comment::text, '' )
  ) then
    perform libdom.sync_entry( _new.name, 'libdom.constant' );
    perform libdom.sync_entry( _new.name, 'libdom.domain' );
    perform libdom.domsync( null, null, _new.domain );
  end if;

  if tg_op in ( 'DELETE'  ) then
    perform libdom.sync_drop( _old.name, 'libdom.constant' );
    perform libdom.sync_drop( _old.name, 'libdom.domain' );
    return null;
  end if;


  if tg_op in ( 'INSERT', 'UPDATE' ) then
    return _new;
  end if;
end;
$$;


--
-- TOC entry 602 (class 1255 OID 16712)
-- Name: any_equal(anyelement, name[]); Type: FUNCTION; Schema: map; Owner: -
--

CREATE FUNCTION map.any_equal(anyelement, VARIADIC name name[]) RETURNS boolean
    LANGUAGE sql
    AS $_$
select $1 = any( map.array( $1, variadic $2 ) );
$_$;


--
-- TOC entry 603 (class 1255 OID 16713)
-- Name: array(anyelement, name[]); Type: FUNCTION; Schema: map; Owner: -
--

CREATE FUNCTION map."array"(anyelement, VARIADIC name name[]) RETURNS anyarray
    LANGUAGE plpgsql
    AS $_$
declare
begin
  return array(
    select kv.constvalue_value
      from map.constvalue kv
      where kv.constvalue_name = any( $2 )
  );
end
$_$;


--
-- TOC entry 604 (class 1255 OID 16714)
-- Name: as_json(); Type: FUNCTION; Schema: map; Owner: -
--

CREATE FUNCTION map.as_json() RETURNS jsonb
    LANGUAGE sql
    AS $$
  --
  select to_jsonb( map.constant() );
$$;


--
-- TOC entry 707 (class 1255 OID 16715)
-- Name: constant(name, regtype, anyelement, character varying, boolean, character varying); Type: FUNCTION; Schema: map; Owner: -
--

CREATE FUNCTION map.constant(name name, type regtype, val anyelement, description character varying DEFAULT NULL::character varying, editable boolean DEFAULT false, comment character varying DEFAULT NULL::character varying) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
declare
  /**
    * Essa função serve para registrar o valor de uma constante na base de dados
    * Se a constante já tiver o valor definido esse valor pode ser subistituido
      pelo novo desde que o parametro arg_constant_replace estiver verdadeiro
    * Caso existir sem o parametro arg_constant_replace verdadeiro uma excessão sera lançada
   */
  _constvalue map.constvalue;
  command text;
  arg_constant_continer regtype := 'map.constant'::regtype;
begin

  editable := coalesce( editable, false );

  select * into _constvalue
  from map.constvalue const
  where const.constvalue_name = name
  ;

  -- Destruir a constante casao existir
  command := format( 'alter type %s drop attribute if exists %I;', arg_constant_continer, name );
  execute command;

  -- Recriar a constante novamente
  command := format( 'alter type %s add attribute %I %s;', arg_constant_continer, name, type );
  execute command;

  if comment is not null then
    command := format( 'comment on column %s.%I is %L;', arg_constant_continer, name, comment );
  end if;

  -- Deletar o valor de constante
  delete from map.constvalue where constvalue_name = name;

  -- Recriar o valor de constante
  insert into map.constvalue(
    constvalue_name,
    constvalue_type,
    constvalue_value,
    constvalue_editable,
    constvalue_descrision,
    constvalue_comment
  ) values (
     name,
     type,
     val,
     editable,
     description,
     comment
   ) returning * into _constvalue;

  return false;
end;
$$;


--
-- TOC entry 472 (class 1255 OID 16716)
-- Name: constant_list(character varying[]); Type: FUNCTION; Schema: map; Owner: -
--

CREATE FUNCTION map.constant_list(VARIADIC name character varying[] DEFAULT NULL::character varying[]) RETURNS jsonb
    LANGUAGE plpgsql IMMUTABLE
    AS $_$
declare
begin
  $1 := coalesce( $1, array[ '' ]::text[] );
  -- Devolver o mapeamento dos estados
  return (
    with names as (
      select array_agg( distinct coalesce( un, '')||'%' ) as list
        from unnest( $1 ) un
    )
    select jsonb_object_agg( cv.constvalue_name, cv.constvalue_value )
      from map.constvalue cv
        inner join names na on true
      where cv.constvalue_name like any( na.list )
  );
end;
$_$;


--
-- TOC entry 605 (class 1255 OID 16717)
-- Name: constant_list(character varying); Type: FUNCTION; Schema: map; Owner: -
--

CREATE FUNCTION map.constant_list(name character varying DEFAULT NULL::character varying) RETURNS jsonb
    LANGUAGE sql IMMUTABLE
    AS $_$
  -- Devolver o mapeamento dos estados
  select jsonb_object_agg( cv.constvalue_name, cv.constvalue_value )
    from map.constvalue cv
    where cv.constvalue_name like coalesce( $1, '')||'%';
$_$;


--
-- TOC entry 701 (class 1255 OID 16718)
-- Name: constant_rename(name, name, boolean); Type: FUNCTION; Schema: map; Owner: -
--

CREATE FUNCTION map.constant_rename(name name, newname name, force boolean DEFAULT false) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
declare
  /**
    * Essa função serve para registrar o valor de uma constante na base de dados
    * Se a constante já tiver o valor definido esse valor pode ser subistituido
      pelo novo desde que o parametro arg_constant_replace estiver verdadeiro
    * Caso existir sem o parametro arg_constant_replace verdadeiro uma excessão sera lançada
   */
  _constvalue map.constvalue;

begin


  select * into _constvalue
    from map.constvalue const
    where const.constvalue_name = name
  ;

  if _constvalue.constvalue_name is null then return false; end if;
  perform map.constantdrop(name, force );
  return map.constant(
    newname,
    _constvalue.constvalue_type,
    _constvalue.constvalue_value,
    _constvalue.constvalue_descrision,
    _constvalue.constvalue_editable,
    _constvalue.constvalue_comment
  );
end;
$$;


--
-- TOC entry 702 (class 1255 OID 16719)
-- Name: constantdrop(name, boolean); Type: FUNCTION; Schema: map; Owner: -
--

CREATE FUNCTION map.constantdrop(arg_constant_name name, arg_dropforce boolean DEFAULT false) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
declare
  /**
    * Essa função serve para registrar o valor de uma constante na base de dados
    * Se a constante já tiver o valor definido esse valor pode ser subistituido
      pelo novo desde que o parametro arg_constant_replace estiver verdadeiro
    * Caso existir sem o parametro arg_constant_replace verdadeiro uma excessão sera lançada
   */
  _constvalue map.constvalue;
  command text;
  arg_constant_continer regtype := 'map.constant'::regtype;
begin
  arg_dropforce := coalesce( arg_dropforce, false );
  select * into _constvalue
    from map.constvalue const
    where const.constvalue_name = arg_constant_name
  ;

  -- Destruir a constante casao existir
  if arg_dropforce then
    command := format( 'alter type %s drop attribute if exists %I cascade;', arg_constant_continer, arg_constant_name );
  else
    command := format( 'alter type %s drop attribute if exists %I;', arg_constant_continer, arg_constant_name );
  end if;
  execute command;

  -- Deletar o valor de constante
  delete from map.constvalue where constvalue_name = arg_constant_name;

  return true;
end;
$$;


--
-- TOC entry 703 (class 1255 OID 16720)
-- Name: constants(character varying); Type: FUNCTION; Schema: map; Owner: -
--

CREATE FUNCTION map.constants(name character varying DEFAULT NULL::character varying) RETURNS jsonb
    LANGUAGE sql IMMUTABLE
    AS $_$
  -- Devolver o mapeamento dos estados
  select jsonb_object_agg( cv.constvalue_name, cv.constvalue_value )
    from map.constvalue cv
    where cv.constvalue_name like coalesce( $1, '')||'%';
$_$;


--
-- TOC entry 704 (class 1255 OID 16721)
-- Name: describe(character varying[]); Type: FUNCTION; Schema: map; Owner: -
--

CREATE FUNCTION map.describe(VARIADIC name character varying[] DEFAULT NULL::character varying[]) RETURNS TABLE(name name, type regtype, value text, editable boolean, descrision character varying, comment character varying)
    LANGUAGE sql IMMUTABLE
    AS $_$
  -- Devolver o mapeamento dos estados
  with names as (
    select array_agg( distinct coalesce( un, '')||'%' ) as list
      from unnest( $1 ) un
  )
  select cv.*
    from map.constvalue cv
      inner join names na on true
    where cv.constvalue_name like any( na.list ) ;
$_$;


--
-- TOC entry 705 (class 1255 OID 16722)
-- Name: funct_change_constvalue(jsonb); Type: FUNCTION; Schema: map; Owner: -
--

CREATE FUNCTION map.funct_change_constvalue(arg jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
      Essa função serve para atualizar o valor de uma constante
   */
  arg_constvalue_name name default arg->>'constvalue_name';
  arg_constvalue_value name default arg->>'constvalue_value';
  _constvalue map.constvalue;
begin
  select * into _constvalue
  from map.constvalue const
  where const.constvalue_name = arg_constvalue_name
  ;

  if not _constvalue.constvalue_editable then
    return lib.result_false( 'map.constvalue.editable-false' );
  end if;

  update map.constvalue
  set constvalue_value = arg_constvalue_value
  where constvalue_name = arg_constvalue_name
        returning * into _constvalue
  ;

  return lib.result_true(
    jsonb_build_object(
      'constvalue', _constvalue
    )
  );
end;
$$;


--
-- TOC entry 606 (class 1255 OID 16723)
-- Name: funct_load_constvalue(jsonb); Type: FUNCTION; Schema: map; Owner: -
--

CREATE FUNCTION map.funct_load_constvalue(filter jsonb DEFAULT NULL::jsonb) RETURNS TABLE(constvalue_name name, constvalue_type regtype, constvalue_value text, constvalue_editable boolean, constvalue_descrision character varying, constvalue_comment character varying)
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  /**
    Essa função serve para listar todas as constante que o valor poder ser atualizada
      == Listagem dos parametros
   */
begin
  return query
    select *
    from map.constvalue cons
    where cons.constvalue_editable;
end;
$$;


--
-- TOC entry 758 (class 1255 OID 19496)
-- Name: create_raw(text); Type: FUNCTION; Schema: patch; Owner: -
--

CREATE FUNCTION patch.create_raw(text text) RETURNS TABLE(raw_uid uuid, raw_math text, raw_text text)
    LANGUAGE plpgsql
    AS $$
  declare
    _data record;
    _raw patch.raw;
  begin
    select * into _data from /**/ patch . /**/ raw_of( text );
    create_raw.raw_text := _data.raw_text;
    create_raw.raw_math := _data.raw_math;
    create_raw.raw_uid := _data.raw_uid;
    
    if create_raw.raw_uid is null then
      insert into patch.raw ( raw_text, raw_match ) values ( _data.raw_text, _data.raw_math )
      returning * into _raw;
      create_raw.raw_uid := _raw.raw_uid;
    end if;
    
    return next;
  end;
$$;


--
-- TOC entry 747 (class 1255 OID 19495)
-- Name: raw_of(text); Type: FUNCTION; Schema: patch; Owner: -
--

CREATE FUNCTION patch.raw_of(text text) RETURNS TABLE(raw_uid uuid, raw_math text, raw_text text)
    LANGUAGE plpgsql
    AS $$
  declare
    _data patch.raw;
  begin
    raw_of.raw_math :=  lib.str_normalize( text );
    raw_of.raw_text := text;
    select * into _data
      from patch.raw r
      where r.raw_match = raw_of.raw_math;
    
    raw_of.raw_uid := _data.raw_uid;
    return next;
  end;
$$;


--
-- TOC entry 746 (class 1255 OID 19453)
-- Name: ref(character varying, character varying); Type: FUNCTION; Schema: patch; Owner: -
--

CREATE FUNCTION patch.ref(file character varying, identifier character varying) RETURNS character varying
    LANGUAGE sql IMMUTABLE
    AS $$
  select 'ref:'||file||'//'||identifier
$$;


--
-- TOC entry 839 (class 1255 OID 19497)
-- Name: revision(jsonb); Type: FUNCTION; Schema: patch; Owner: -
--

CREATE FUNCTION patch.revision(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
  <<sys>>
  declare
    _file character varying default args->>'file';
    _identifier character varying default args->>'identifier';
    _ref character varying default patch.ref(  _file, _identifier );
    _raw text not null default args->>'raw';
    _flags text[] default array( select lower( e.text ) from jsonb_array_elements_text( args->'flags' ) e( text ) );
    _configs jsonb default coalesce( args->'configs', jsonb_build_object() );
    _connection character varying default "current_user"();
    _patches patch.revision;
    _error jsonb;
    _force boolean default '@force' = any( _flags );
    _force_number int default 0;
    _last record;
    _raw_instance record;
  begin
    raise notice '%', args;
    select * into _patches
      from patch.revision p
      where p.ref = sys._ref
    order by
      p.seq desc
    limit 1;

    if _patches.ref is not null and '@unique' = any( _patches.flags ) and not _force then return lib.res_false('unique applied' ); end if;
    
    select * into _raw_instance from /* */ patch . /* */ raw_of( _raw);
    
    select * into _last
        from patch.revision p
        where p.ref = _ref
          order by p.version desc,  p.seq desc
        ;

    if _last.ref is not null and _raw_instance.raw_uid is not null and _last._raw_uid = _raw_instance.raw_uid and not _force then return lib.res_false('no changes' );
    elseif _last.ref is not null and _raw_instance.raw_uid is not null and _last._raw_uid = _raw_instance.raw_uid then
      _force_number := _last.force +1;

    end if;
    
    select * into _raw_instance
      from /* */ patch . /* */ create_raw( _raw );

    
    insert into patch.revision(
      file,
      identifier,
      _raw_uid,
      flags,
      configs,
      status,
      connection,
      version,
      force
    ) values (
     _file,
     _identifier,
     _raw_instance.raw_uid,
     _flags,
     _configs,
     1,
     _connection,
     coalesce( _patches.version, 0 ) +1,
     _force_number
   ) returning * into _patches;

    begin
      execute _raw_instance.raw_text;
    exception when others then
      <<_ex>>
      declare
        e text; m text; d text; h text; c text;
      begin
        get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
        _error := jsonb_build_object(
          'state', e,
          'message', m
        );
      end;
    end;

    return lib.res_true( jsonb_build_object(
      'patches', _patches,
      'error', _error
    ));
  end;
$$;


--
-- TOC entry 920 (class 1255 OID 19875)
-- Name: 3x(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report."3x"(report jsonb) RETURNS SETOF json
    LANGUAGE plpgsql
    AS $_$
declare
  /**
    args := {
      row_column: column
      row_order: asc|desc (default asc)
      column_column: column
      column_order asc|desc (default asc)
      aggregation:RENAME
    }
   */
  statement text;
  _columns record;
  _row_column text default report->>'row_column';
  _row_order text default report->>'row_order';
  _column_column text default report->>'column_column';
  _column_order text default report->>'column_order';
  _aggregation text default report->>'aggregation';
  _row_reduce text;
  _column_reduce text;
  _sources record;
  _limit int8 default report->>'limit';
  _offset int8 default report->>'offset';
begin
  report := report - 'limit' - 'offset';

  select * into _columns
    from report.__prepare_column( report );

  raise notice '%', to_jsonb( _columns );

  if _row_column = any( _columns.reduces ) then _row_reduce := _columns.reduces_map->>( _row_column ); end if;
  if _column_column = any( _columns.reduces ) then _column_reduce := _columns.reduces_map->>( _column_column ); end if;

  _row_reduce := coalesce( _row_reduce, _row_column );
  _column_reduce := coalesce( _column_reduce, _column_column );

  raise notice '_row_reduce: %', _row_reduce;
  raise notice '_column_reduce: %', _column_reduce;

  select jsonb_object_agg( c.column_name, jsonb_build_object(
      'type', c.column_type,
      'basetype', c.column_basetype,
      'default', c.column_default,
      'is_array', c.is_array,
      'is_generated', c.is_generated
    )) as maps into _sources
    from report.columns( (report->>'source')::text::regclass ) c;

-- $1 => report
-- $2 => row_column
-- $3 => row_reduce
-- $4 => column_column
-- $5 => column_reduce
-- $6 => aggregation

--language=sql
statement := $sql$
  with __source as (
    select e.data::text::jsonb as data
      from report.engine( $1 ) e( data )
  ), __xxx as (
    select
        _s.data->>$2 as "($rowColumnName)",
        json_object_agg( _s.data ->> $4, (_s.data-> $6) order by (_s.data ->> $5)::"($columnColumnType)" "($columnOrder)" nulls last ) as "($columnColumnName)"
      from __source _s
      group by
        _s.data->>$2,
        _s.data->>$3
      order by (_s.data->>$3)::"($rowColumnType)" "($rowOrder)" nulls last
  ), __xxx_header as (
    select
        distinct _s.data ->> $4 as header_representation,
        ( _s.data ->> $5)::"($columnColumnType)" as header_reduce
      from __source _s
  ), __result as  (
    select json_agg( _xh.header_representation order by _xh.header_reduce "($columnOrder)" nulls last )  as data
      from __xxx_header _xh
    union all
      select to_json( _x )
        from __xxx _x
  ) select data
      from __result
      limit $7
      offset $8

$sql$;

  statement := replace( statement, '"($rowColumnName)"', format( '%I', _row_column ) );
  statement := replace( statement, '"($columnColumnType)"', _sources.maps->( _column_column )->>'type' );
  statement := replace( statement, '"($columnColumnName)"', format( '%I', _column_column ) );
  statement := replace( statement, '"($columnOrder)"', coalesce( _column_order, 'asc' ) );
  statement := replace( statement, '"($rowColumnType)"', _sources.maps->( _row_column )->>'type' );
  statement := replace( statement, '"($rowOrder)"', coalesce( _row_order, 'asc' ) );

  raise notice  '%', statement;

  return query execute statement using
    report,
    _row_column,
    _row_reduce,
    _column_column,
    _column_reduce,
    _aggregation,
    _limit,
    _offset
  ;
end;
$_$;


--
-- TOC entry 474 (class 1255 OID 16725)
-- Name: ____tg_report_format(); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.____tg_report_format() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  _source record;
  _repcoll report.vcolumn;
  _report report.report;
begin
  if pg_typeof( new )::text::regclass = 'report.report'::regclass then
    _report := new;
    select * into _source
    from report.source_map( _report.report_source::regclass );
    _report.report_source := _source.source_format;
    return _report;
  elsif pg_typeof( new )::text::regclass = 'report.vcolumn'::regclass then
    _repcoll := new;
    select * into _source
    from report.source_map( _repcoll.source::regclass );
    _repcoll.source := _source.source_format;
    return _repcoll;
  end if;
  return new;
end;
$$;


--
-- TOC entry 391 (class 1255 OID 19863)
-- Name: __formattable(); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.__formattable() RETURNS text[]
    LANGUAGE sql IMMUTABLE
    AS $$
  select array_agg( distinct te.name )
    from report.talias ta
      inner join unnest(( ta.alias|| ta.type) ) te( name ) on true
    where ( ta.alias|| ta.type) && array[ 'date', 'timestamp', 'timestamptz' ]::text[];
$$;


--
-- TOC entry 918 (class 1255 OID 19873)
-- Name: __mask(anyelement, text, text, boolean); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.__mask(anyelement, type text, format text, representation boolean DEFAULT false) RETURNS text
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $_$
<<func>>
declare
  _format report.mask;
  mouth_group double precision;
  base int;
begin
  representation := coalesce( representation, false );
  select * into _format
    from report.mask rf
    where rf.mask = __mask.format
      and __mask.type = any( rf.type );

  if _format.mask is null then return null; end if;

  -- to_char
  if lower( _format.function ) = 'to_char' then
    return to_char( $1, case
      when representation then _format.representation
      else _format.mask
    end);
  end if;

  if lower( _format.function ) = 'mouth_group' then
    mouth_group := extract( months from $1 ) / ( 12.0 / _format.mask::double precision);
    base := case
      when mouth_group::int < mouth_group then  mouth_group::int+1
      else mouth_group::int
    end;
    return to_char( $1,
      case when representation then format( '%I%I"º" YYYY', _format.representation, base )
           else format( 'YYYY %I%I', _format.representation, base )
      end);
  end if;
end;
$_$;


--
-- TOC entry 919 (class 1255 OID 16728)
-- Name: __mask_reduce(anyelement, text, text); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.__mask_reduce(anyelement, type text, format text) RETURNS anyelement
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $_$
<<func>>
declare
  _format report.mask;
  _types record;
  mouth_group double precision;
  base int;
  _month int;
  _year int;
begin
  select * into _format
    from report.mask rf
    where rf.mask = __mask_reduce.format
      and __mask_reduce.type = any( rf.type );

  select * into _types
    from report.talias ta
    where __mask_reduce.type = any( ta.alias )
  ;

  if _format.mask is null then return null; end if;

  -- to_char
  if lower( _format.function ) = 'to_char' then
    case
      when 'date' = any( _types.alias ) then return to_date( to_char( $1, _format.mask ), _format.mask );
      when 'timestamp' = any( _types.alias ) then return to_timestamp( to_char( $1, _format.mask ), _format.mask );
      when 'timestamptz' = any( _types.alias ) then return to_timestamp( to_char( $1, _format.mask ), _format.mask )::timestamptz;
      else return $1;
    end case;
  end if;

  if lower( _format.function ) = 'mouth_group' then
    mouth_group := extract( months from $1 ) / ( 12.0 / _format.mask::double precision);
    base := case
      when mouth_group::int < mouth_group then  mouth_group::int+1
      else mouth_group::int
    end;
    _month := base * ( 12.0 / _format.mask::double precision )-( 12.0 / _format.mask::double precision)+1;
    _year := extract( year from $1 );
    case
      when 'date' = any( _types.alias ) then return make_date( _year, _month, 1 );
      when 'timestamp' = any( _types.alias ) then return make_timestamp( _year, _month, 1, 0, 0, 0 );
      when 'timestamptz' = any( _types.alias ) then return make_timestamptz( _year, _month, 1, 0, 0, 0, to_char( $1, 'tz' ) );
    end case;
  end if;
end;
$_$;


--
-- TOC entry 916 (class 1255 OID 19870)
-- Name: __prepare(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.__prepare(report jsonb) RETURNS SETOF text
    LANGUAGE plpgsql IMMUTABLE
    AS $_X$
declare
  /**
    report := {
      source: view|table
      _branch_uid: BRANCH-UID
      windows_function_key: [sum | avg | max | min | count | count::distinct],
      with_reduce?:boolean
      with_column_row_number?:boolean
      orders: [{
        *column: "COLUMN" value para coluna | "RENAME" value para o grupo,
        orientation?: "asc" | "desc" (default "first",
        nulls?: "last" | "first" (default "last" ),
        priority? number-level
      }],

      columns: [{
        column:COLUMN,
        format?: YYYY | YYYY-MM | YYYY-MM-DD | YYYY-MM-DD HH:MI
      }]
      filters: [{
        column: src.COL-NAME,
        opr: =|<|>|<=|>=|like
        mode?: default|right
        value: VALUE-FILTER
      }],
      groups:[{
        column: src.COL-NAME
        func: count|sum|max|min|avg
        rename: NEW-NAME
      }]
    }
   */
  _orders record;
  _columns record;
  _rownumber record;
  _aggregate record;
  _windows record;
  _statement text;
  _where record;
  _source record;
  _formattable record;
begin
  select * into _source from report.source_map( (report->>'source' )::regclass );
  select * into _formattable from report.__formattable() f( types );
  select * into _columns from report.__prepare_column( report );
  select * into _aggregate from report.__prepare_aggregate( report );
  select * into _rownumber from report.__prepare_row_number( report );
  select * into _where from report.__prepare_where( report );
  select * into _windows from report.__prepare_wf( report );
  select * into _orders from report.__prepare_order( report, _columns.selected, _aggregate.selected );

  --language=PostgreSQL
  _statement := $sql$
    with 
    __report_fixe ( "$_*_fixed") as (
      values(1)
    ), __report_engine as (
      select
          '(__$report__columns_expression)'
          '(__$report_aggregate_expression)'
        from '(select * from __$report_source)'
        where _branch_uid = $1
          and '(__$report_where)'
        group by '(__$report_group_by)'
    ), __distinct as (
      select pr.*, '(__$report_row_number_expression)' as "$ROW-NUMBER"
        from __report_engine pr
    ), __windows as (
        select _re.*,
          jsonb_build_object(
            '(__$report_windows_functions)'
          ) as "*_$"
          from __report_fixe _rf
            left join __distinct _re on true
          order by '(__$report_order_by)'
          limit $2
          offset $3
    ) select to_json( _w )
        from __windows _w
  $sql$;


  _statement := replace( _statement, $$'(select * from __$report_source)'$$, _source.source_format );
  if _columns.counts > 0 then
    _statement := replace( _statement, $$'(__$report__columns_expression)'$$, format( '%s', _columns.expression ) );
  else
    _statement := replace( _statement, $$'(__$report__columns_expression)'$$, '' );
  end if;

  if _columns.counts > 0 and _aggregate.counts >0 then
    _statement := replace( _statement, $$'(__$report_aggregate_expression)'$$, format( ', %s', _aggregate.expression ) );
  elsif _aggregate.counts > 0 then
    _statement := replace( _statement, $$'(__$report_aggregate_expression)'$$, format( '%s', _aggregate.expression ) );
  else
    _statement := replace( _statement, $$'(__$report_aggregate_expression)'$$, format( '%s', '' ) );
  end if;


  if _where.counts > 0 then
    _statement := replace( _statement, $$'(__$report_where)'$$, _where.expression );
  else
    _statement := replace( _statement, $$and '(__$report_where)'$$, '' );
  end if;

  if _rownumber.expression is null then
    raise exception 'Row Number Is NUll';
  end if;

  if _rownumber.counts > 0 then
    _statement := replace( _statement, $$'(__$report_row_number_expression)' as "$ROW-NUMBER"$$, _rownumber.expression );
  else
    _statement := replace( _statement, $$, '(__$report_row_number_expression)' as "$ROW-NUMBER"$$, '' );
  end if;

  if _columns.counts > 0 and _aggregate.counts > 0 then
    _statement := replace( _statement, $$'(__$report_group_by)'$$, _columns.groupby_expression );
  else
    _statement := replace( _statement, $$group by '(__$report_group_by)'$$, '' );
  end if;

  if _orders.counts > 0 then
    _statement := replace( _statement, $$'(__$report_order_by)'$$, _orders.expression );
  else
    _statement := replace( _statement, $$order by '(__$report_order_by)'$$, '' );
  end if;

  if _windows.counts > 0 then
    _statement := replace( _statement, $s$'(__$report_windows_functions)'$s$, _windows.expression );
  else
    _statement := replace( _statement, $s$'(__$report_windows_functions)'$s$, '' );
  end if;

  select string_agg( e.line, e'
' ) into _statement
    from regexp_split_to_table( _statement, e'
' ) e( line )
    where length( trim( e.line ) ) > 0
  ;
  _statement := trim( _statement );
  return next _statement;
end;
$_X$;


--
-- TOC entry 909 (class 1255 OID 19864)
-- Name: __prepare_aggregate(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.__prepare_aggregate(report jsonb) RETURNS TABLE(counts bigint, expression text, selected jsonb[], exports_expression text, exports_rename text[])
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  _source record;
  _aggregate record;
  _selected jsonb[];
begin
  select * into _source from report.source_map( (report->>'source' )::regclass );

  select array_agg( coalesce( rc.element, jsonb_build_object() ) || e.doc ) into _selected
    from jsonb_array_elements( report->'groups' ) with ordinality e( doc )
      left join report.vcolumns( report ) rc( element ) on rc.element->>'column' = e.doc->>'column'
        and rc.element->>'key' = e.doc->>'key'
        and rc.element->>'type' = 'group'
  ;

  with  __group as (
    select
        e.doc->>'column' as group_column,
        e.doc->>'mode' as group_mode,
        e.doc->>'func' as group_func,
        e.doc->>'rename' as group_rename,
        e.doc->>'expression' as group_expression,
        e.doc->>'column_position' as column_position,
        e.doc->>'priority' as group_priority
      from unnest( _selected ) e( doc )
  ), __prepare_group as (
    select
      g.*
      from __group g
      where g.group_func is not null
  ), __prepare_group_by as (
    select
        _sc.*,
        _g.*
      from report.columns( _source.source_class ) _sc
        inner join __prepare_group _g on _sc.column_name = _g.group_column
  ) select
        count( * ) as counts,
        string_agg( agg.group_expression, e',
          ' order by agg.column_position desc nulls last, agg.group_priority ) as expression,
        string_agg( format( '%I', agg.group_rename ), ', ' ) as exports_expression,
        array_agg( agg.group_rename ) as exports_rename

        into _aggregate
      from __prepare_group_by agg
  ;

  __prepare_aggregate.counts := _aggregate.counts;
  __prepare_aggregate.expression := _aggregate.expression;
  __prepare_aggregate.selected := _selected;
  __prepare_aggregate.exports_rename := _aggregate.exports_rename;
  __prepare_aggregate.exports_expression := _aggregate.exports_expression;
  return next;
end;
$$;


--
-- TOC entry 914 (class 1255 OID 19869)
-- Name: __prepare_column(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.__prepare_column(report jsonb) RETURNS TABLE(expression text, expression_map jsonb, counts bigint, selected jsonb[], reduces text[], reduces_counts bigint, reduces_map jsonb, reduces_expression text, groupby_expression text, exports text[], exports_reduce text[], exports_representation text[], exports_expression text)
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  __selected jsonb[];
  _formattable record;
  _columns record;
  _source record;
begin
  select * into _source from report.source_map( (report->>'source' )::regclass );

  select * into _formattable from report.__formattable() f( types );

  select array_agg( coalesce( rc.element, jsonb_build_object() ) || e.doc || jsonb_build_object(
      '_reduce_name',  report.reduce_name( rc.element->>'column' )
    )) into __selected
    from jsonb_array_elements( report->'columns' ) with ordinality e( doc )
      inner join report.vcolumns( report ) rc( element ) on rc.element->>'column' = e.doc->>'column'
        and rc.element->>'key' = e.doc->>'key'
        and rc.element->>'type' = 'column'
  ;

  -- COLUMNS
  with __representation as (
    select *,
        true as representation,
        false as reduce
       from report.columns( _source.source_class )
    union all
      select *,
          false as representation,
          true as reduce
         from report.columns( _source.source_class )
  ), __columns as (
    select
        e.doc->>'column' as column_name,
        e.doc->>'order' as column_order,
        e.doc->>'mask' as column_mask,
        e.doc->>'format' as column_formattype,
        e.doc->>'_reduce_name' as _reduce_name,
        e.ordinality
      from unnest( __selected ) with ordinality e( doc )
  ), __prepare_columns as (
    select
        _rp.column_name as _original_column_name,
        format( '%I', _rp.column_name ) as column_name,
         format( '%I', _c._reduce_name ) as column_reduce,
        _c._reduce_name,
        _rp.reduce,
        _rp.representation,
        case
          when _rp.reduce then 2
          else 1
        end as ___priority,
        case
          when _rp.column_type = any( _formattable.types ) and _c.column_mask is not null and _rp.reduce then format( 'report.__mask_reduce( %I::%s, %L, %L )',  _rp.column_name, _rp.column_type, column_formattype, _c.column_mask )
          when _rp.column_type = any( _formattable.types ) and _c.column_mask is not null and _rp.representation then format( 'report.__mask( %I::%s, %L, %L, %L )', _rp.column_name, _rp.column_type, column_formattype, _c.column_mask, _rp.representation )
          else format( '%I', _rp.column_name )
        end as expression,
        _c.ordinality
      from __representation _rp
        inner join __columns _c on _rp.column_name = _c.column_name
  ) select
      count( pc.column_name ) as counts,
      string_agg( format( '%s', pc.expression ), e',
          'order by pc.___priority, pc.ordinality ) as columns,
      string_agg( pc.column_reduce, ', '  ) filter ( where pc.reduce ) reduces_expression,
      array_agg( pc._original_column_name ) filter ( where pc.reduce ) reduces,
      jsonb_object_agg( pc._original_column_name, pc._reduce_name  ) filter ( where pc.reduce ) reduces_map,

      count( * )  filter ( where pc.reduce ) reduces_counts,
      string_agg( format( '%s as %s', pc.expression,
        case
          when pc.reduce then pc.column_reduce
          else pc.column_name
        end ), e',
          ' order by pc.___priority, pc.ordinality ) as expression,
      jsonb_object_agg( case when pc.reduce then pc._reduce_name else pc._original_column_name end, jsonb_build_object(
        'expression', pc.expression,
        'reduce', pc.reduce,
        'representation', pc.representation,
        'reduce_name', pc._reduce_name,
        'column_name', pc._original_column_name
      )) as expression_map,
      array_agg( case when pc.reduce then pc._reduce_name else pc._original_column_name end ) as exports,
      array_agg( pc._reduce_name ) filter ( where pc.reduce )as exports_reduce,
      array_agg( pc._original_column_name ) filter ( where pc.representation )as exports_representation,
      string_agg( case when pc.reduce then pc.column_reduce else pc.column_name end, ', ') as exports_expresssion,
      string_agg( format( '%s', pc.expression ), e',
          ' order by pc.___priority, pc.ordinality ) filter ( where true in ( pc.reduce, pc.representation) ) as groupby_expression
      into _columns
    from __prepare_columns pc
  ;

  __prepare_column.selected := __selected;
  __prepare_column.counts := _columns.counts;
  __prepare_column.expression := _columns.expression;
  __prepare_column.expression_map := _columns.expression_map;
  __prepare_column.reduces := _columns.reduces;
  __prepare_column.reduces_map := _columns.reduces_map;
  __prepare_column.reduces_counts := _columns.reduces_counts;
  __prepare_column.reduces_expression := _columns.reduces_expression;
  __prepare_column.groupby_expression := _columns.groupby_expression;
  __prepare_column.exports := _columns.exports;
  __prepare_column.exports_reduce := _columns.exports_reduce;
  __prepare_column.exports_representation := _columns.exports_representation;
  __prepare_column.exports_expression := _columns.exports_expresssion;
  return next;
end;
$$;


--
-- TOC entry 908 (class 1255 OID 16732)
-- Name: __prepare_order(jsonb, jsonb[], jsonb[]); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.__prepare_order(report jsonb, columns jsonb[], aggregates jsonb[]) RETURNS TABLE(counts bigint, expression text, selected jsonb[])
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  _orders record;
  _source record;
  _selected jsonb[];
  _formattable record;
begin
  select * into _source from report.source_map( (report->>'source' )::regclass );
  select * into _formattable from report.__formattable() f( types );

  with __orders as (
    select
      e.element,
      ( e.element->>'priority' )::int as priority,
      e.ordinality as ordinality
    from jsonb_array_elements( report->'orders' ) with ordinality e( element )
  ) select array_agg( e.element order by e.priority desc nulls last, e.ordinality ) as orders into _selected
      from __orders e
  ;

  if( coalesce( array_length( _selected, 1 ), 0 ) ) = 0 then
    with __columns as (
    select
        e.element->>'column' as "column",
        e.element->>'rename' as rename,
        e.element->>'type' as "type",
        e.ordinality,
        -- Prioridade igual a ordem reverva, quanto maoir for a ordem posicional menor a prioridade
        e.ordinality * -1 as priority
      from unnest( columns || aggregates ) with ordinality e ( element )
    ), __orders as (
      select
          case
            when cc.type = 'group' then cc.rename
            when cc.type = 'column' then cc.column
          end as "column",
          'asc' as "orientation",
          'last' as "nulls",
          cc.ordinality,
          cc.priority
        from __columns cc
        order by cc.ordinality
    ) select array_agg( to_jsonb( o ) order by o.priority desc nulls last, o.ordinality) as orders into _selected
        from __orders o
        where o."column" is not null
    ;
  end if;

  with __orders as (
    select
        case
          when ( sc."column"->>'mask' ) is not null and c.column_type = any( _formattable.types ) then format( '\:%s', c.column_name )
          else c.column_name
        end as "column",
        (o."order"->>'priority')::int as "priority",
        coalesce( lib.str_normalize( o."order"->>'orientation' ), 'asc' ) as "orientation",
        coalesce( lib.str_normalize( o."order"->>'nulls' ), 'last' ) as "nulls",
        o.ordinality
      from report.columns( _source.source_class ) c
        inner join unnest( _selected ) with ordinality o( "order" ) on c.column_name = o."order"->>'column'
        inner join unnest( columns ) sc( "column" ) on o."order"->>'column' = sc."column"->>'column' and sc."column"->>'column' = c.column_name
  ) select
        string_agg( format( '%I %s nulls %s', o."column", o.orientation, o.nulls ), e',
            '
          order by o.priority desc nulls last, o.ordinality
        ) as expression,
        count( * ) as counts
        into _orders
      from __orders o
      where o.orientation in ( 'asc', 'desc')
        and o.nulls in ( 'last', 'first' )
  ;

  __prepare_order.counts := _orders.counts;
  __prepare_order.expression := _orders.expression;
  __prepare_order.selected := _selected;
  return next;
end;
$$;


--
-- TOC entry 915 (class 1255 OID 16733)
-- Name: __prepare_row_number(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.__prepare_row_number(report jsonb) RETURNS TABLE(counts bigint, expression text, exports_expression text, exports_rownumber text[])
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  _columns record;
  _aggregate record;
  _rn record;
begin
  select * into _aggregate
    from report.__prepare_aggregate( report );

  select * into _columns
    from report.__prepare_column( report );

  with __exports as (
    select
        e.export,
        report.__rownumber_of( e.export ) as row_numbername,
        format( 'row_number() over ( partition by %I )', e.export ) as row_expression
      from unnest( _columns.exports_reduce || _aggregate.exports_rename ) e( export )
  ) select
        count( * ) as counts,
        string_agg( format( '%s as %I', row_expression, row_numbername), e',
            ' ) as expression,
        array_agg( row_numbername ) as exports_rownumber,
        string_agg( format('%I', row_numbername ), ', ') as exports_expression
        into _rn
      from __exports;

  __prepare_row_number.expression := _rn.expression;
  __prepare_row_number.counts := _rn.counts;
  __prepare_row_number.exports_rownumber := _rn.exports_rownumber;
  __prepare_row_number.exports_expression := _rn.exports_expression;
  return next;
end;
$$;


--
-- TOC entry 912 (class 1255 OID 19867)
-- Name: __prepare_wf(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.__prepare_wf(report jsonb) RETURNS TABLE(counts bigint, expression text)
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  _columns record;
  _aggregates record;
  _wfunction record;
  _wf_keys text[] default array( select e.text from jsonb_array_elements_text( report->'windows_function_key' )e( text));
begin

  if coalesce( array_length( _wf_keys, 1 ), 0 ) = 0  then
    _wf_keys := array [ 'sum' ]::text[];
  end if;
  select * into _columns from report.__prepare_column( report );
  select * into _aggregates from report.__prepare_aggregate( report );

  -- WINDOWS FUNCTIONS
  with  __columns as (
      select
        e.element->>'format' as format,
        coalesce( e.element->>'rename', e.element->>'_reduce_name' ) as "rename"
      from unnest( _columns.selected || _aggregates.selected || jsonb_build_object(
        'rename', '*',
        'format', '*'
      )) e( element )
  ), __expression as (
      select
        format( '%s:%s', _c.rename, _wf.key ) as name,
        format( _wf.over, case when _c.rename = '*' then '*' else format( '%I', _c.rename ) end, report.__rownumber_of( _c.rename ) ) as expression
        from __columns _c
          inner join report.agg _wf on _c.format = any( _wf.types )
            and true in ( _wf.key = any( _wf_keys ), _c.rename = '*' )
            and _wf.over is not null
  )  select
        string_agg( format( '%L, %s', _exp.name, _exp.expression ), e',
            ' ) as expression,
        count( * ) as counts
        into _wfunction
      from __expression _exp
  ;

  __prepare_wf.counts := _wfunction.counts;
  __prepare_wf.expression := _wfunction.expression;
  return next ;
end;
$$;


--
-- TOC entry 910 (class 1255 OID 19865)
-- Name: __prepare_where(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.__prepare_where(report jsonb) RETURNS TABLE(counts bigint, expression text, selected jsonb[])
    LANGUAGE plpgsql IMMUTABLE
    AS $$
declare
  _source record;
  _where record;
  _selected jsonb[];
begin
  select * into _source from report.source_map( (report->>'source' )::regclass );

  select array_agg( coalesce( rc.element, jsonb_build_object() ) || e.doc ) into _selected
    from jsonb_array_elements( report->'filters' ) with ordinality e( doc )
      left join report.vcolumns( report ) rc( element ) on rc.element->>'column' = e.doc->>'column'
        and rc.element->>'key' = e.doc->>'key'
        and rc.element->>'type' = 'filter'
  ;


  -- FILTERS
  with __filters as (
    select
        e.doc->>'column' as filter_column,
        coalesce( e.doc->>'opr', '=' ) as filter_opr,
        coalesce( e.doc->>'mode', 'default' ) as filter_oprmode,
        e.doc->>'value' as filter_value,
        e.doc->>'key' as filter_key
      from unnest( _selected ) e( doc )
  ), __prepare_filter as (
    select
        _f.filter_column,
        _f.filter_opr,
        _f.filter_oprmode,
        _f.filter_key,
        case
          when lower( _f.filter_opr ) = 'like' and _f.filter_oprmode = 'default' then format( '%s%s%s', '%', lower( _f.filter_value ), '%' )
          when lower( _f.filter_opr ) = 'like' and _f.filter_oprmode = 'right' then format( '%s%s', lower( _f.filter_value ), '%')
          else filter_value
        end as filter_value
      from __filters _f
  ), __prepare_where as (
    select
        case
          when _sc.is_array then format( 'any( %I )', _sc.column_name)
          when _f.filter_opr = 'like' then format( 'lower( %I )::text', _sc.column_name )
          else format( '%I', _sc.column_name )
        end as column_exp,

        case
          when _sc.is_array then format( '(%L)::%s', _f.filter_value, _sc.column_basetype )
          when _f.filter_opr = 'like' then format( '(%L)::text', _f.filter_value )
          else format( '(%L)::%s', _f.filter_value, _sc.column_type )
        end as args,
        _sc.*,
        _f.*

      from report.columns( _source.source_class ) _sc
        inner join __prepare_filter _f on _sc.column_name = _f.filter_column
  ), __group_where as (
    select
        _pr.filter_key,
        string_agg(
            case
              when  _pr.is_array then format( '%s %s %s', args, filter_opr, column_exp )
              else format( '%s %s %s', column_exp, filter_opr, args )
              end, e',
            '
          ) as expression
      from __prepare_where _pr
      group by _pr.filter_key
  ) select
        count( * ) as counts,
        string_agg(
          format( e'true in ( 
%s )', _pr.expression )
          , e'
          and '

        ) as expression
        into _where
      from __group_where _pr
  ;

  __prepare_where.selected := _selected;
  __prepare_where.expression := _where.expression;
  __prepare_where.counts := _where.counts;
  return next;
end;
$$;


--
-- TOC entry 911 (class 1255 OID 19866)
-- Name: __rownumber_of(text); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.__rownumber_of(text) RETURNS text
    LANGUAGE sql IMMUTABLE
    AS $_$ select format('\:$( %s ):#ROW_NUMBER', $1 ) $_$;


--
-- TOC entry 476 (class 1255 OID 16737)
-- Name: __template_of(jsonb, jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.__template_of(ref jsonb, colconfigs jsonb) RETURNS jsonb
    LANGUAGE plpgsql
    AS $_$
declare
  refname text;
  args jsonb;
  _name text;
  _type text;
begin
  if ref is null then return null; end if;
  if jsonb_typeof( ref ) = 'object' then return ref; end if;
  if jsonb_typeof( ref ) = 'string' then refname = ref->>0;
  elseif jsonb_typeof( ref ) = 'array' then
    refname := ref->>0;
    args := ref->1;
  end if;

  if args is not null and jsonb_typeof( args ) != 'object' then raise exception 'args is not object, %', args ; end if;
  _type := (regexp_split_to_array( refname, '\.' ))[1];
  _name := (
    select string_agg( u.text, '.' )
    from  unnest( ( regexp_split_to_array( refname, '\.' ))[2:] ) u( text)
  );

--  raise exception 'type: %, _name: %, LENGTH: %', _type, _name, array_length (regexp_split_to_array( refname, '\.' ), 1);

  if _type is null or _name is null or array_length(regexp_split_to_array( refname, '\.' ), 1)  < 2 then
    raise exception 'Type or name indeterminated %: ', ref;
  end if;

  declare
    _template record;
    _i record;
    _j record;
    _obj jsonb default jsonb_build_object();
    _conversion text;
    _value jsonb;
  begin
    select * into _template
    from report.template t
    where type = _type
      and t.name = _name;

    if _template.name is null then raise exception 'Template not found with ref: % | type: % | name: %', ref, _type, _name; end if;
    for _i in
      select
        e.key,
        e.value,
        jsonb_typeof( e.value ) as type,
        case
          when jsonb_typeof( e.value ) in ( 'object', 'array' ) then e.value::text
          else e.value->>0
          end as text
      from jsonb_each( _template.configs ) e
      loop
        if _i.type in ( 'string', 'boolean', 'null', 'number' ) then _value := _i.value;
        elsif _i.type = 'object' and (_i.value->>'$template')::boolean then
          _conversion := _i.value->>'$structure';
          if _conversion is null then raise exception 'Null AQUI 452739'; end if;
          for _j in
            select
              e.key,
              e.value,
              jsonb_typeof( e.value ) as type,
              case
                when jsonb_typeof( e.value ) in ( 'object', 'array' ) then e.value::text
                else e.value->>0
                end as text
            from jsonb_each( colConfigs ) e
            loop
              _conversion := replace( _conversion, format( '${%s}', _j.key ), coalesce( _j.text, '' ) );
              if _conversion is null then raise exception 'Null AQUI 77736'; end if;
            end loop;

          for _j in
            select
              e.key,
              e.value,
              jsonb_typeof( e.value ) as type,
              case
                when jsonb_typeof( e.value ) in ( 'object', 'array' ) then e.value::text
                else e.value->>0
                end as text
            from jsonb_each( args ) e
            loop
              _conversion := replace( _conversion, format( '${args.%s}', _j.key ), coalesce( _j.text, '' ) );
              if _conversion is null then raise exception 'Null AQUI kjskdhs'; end if;
            end loop;

          _conversion := coalesce( _conversion, _i.value->>'$default', _i.value->>'$defaults' );
          if _conversion is null then raise exception '#C001 Conversion is null template: %; key: %; value %; args <= %', _template.name , _j.key, _j.value, args; end if;
          if _conversion = _i.value->>'$structure' then _conversion := coalesce(  _i.value->>'$default', _i.value->>'$defaults' ); end if;
          if _conversion is null then raise exception '#C002 Conversion is null template: %; key: %; value %; args <= %', _template.name , _j.key, _j.value, args;  end if;

          if _i.value->>'$type' in ( 'string', 'text', 'varchar', 'character varying' ) then
            _value := to_jsonb( _conversion );
          elseif _i.value->>'$type' in ( 'number', 'numeric', 'int', 'integer', 'double', 'double precision' ) then
            _value := to_jsonb( _conversion::numeric );

          elseif _i.value->>'$type' in ( 'bool', 'boolean' ) then
            _value := to_jsonb( _conversion::boolean );
          else
            _value := to_jsonb( _conversion );
          end if;
        else _value := _i.value;
        end if;

        _obj := _obj || jsonb_build_object(
          _i.key,
          _value
          );

        if _obj is null then raise exception 'Object is null in {%:%} args: % base: %', _i.key, _i.value, args, colConfigs; end if;
        if _value is null then raise exception 'Object.value is null in {%:%} args: % base: %', _i.key, _i.value, args, colConfigs; end if;
        if jsonb_typeof(_value) = 'null' then raise exception 'Type Object.value is null in {%:%} args: % base: %', _i.key, _i.value, args, colConfigs; end if;
      end loop;
    return _obj;
  end;
end
$_$;


--
-- TOC entry 477 (class 1255 OID 16738)
-- Name: columns(regclass); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.columns(regclass) RETURNS TABLE(column_name text, column_type text, column_basetype text, column_default text, is_array boolean, is_generated boolean)
    LANGUAGE sql STRICT
    AS $_$
select
    col.column_name::text,
    format_type( pt.oid, atttypmod )::text column_type,
    case
      when col.data_type = 'ARRAY' then format_type( pt.typelem, atttypmod )
      else format_type( pt.oid, atttypmod )
    end as column_basetype,
    col.column_default::text,
    col.data_type = 'ARRAY' as is_array,
    col.is_generated = 'ALWAYS' as is_generated
  from information_schema.columns col
         inner join report.source_map( $1 ) c on c.source_name = col.table_name
    and col.table_schema::regnamespace = c.source_schema::regnamespace
         inner join pg_attribute att on col.column_name = att.attname
    and att.attrelid = format( '%s.%s', col.table_schema, col.table_name )::regclass::oid
         inner join pg_type pt on att.atttypid = pt.oid
  where format('%s.%s', c.source_schema, c.source_name)::regclass = $1
$_$;


--
-- TOC entry 475 (class 1255 OID 16739)
-- Name: configs(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.configs(args jsonb) RETURNS SETOF jsonb
    LANGUAGE sql
    AS $$
with __report as (
      select
        r.*,
        jsonb_agg( conf.doc  ) as configs
      from report.report r
        inner join report.vcolumns( jsonb_build_object('source', r.report_source ) ) conf ( doc ) on true
      where r.report_active
      group by r.report_source
    ) select to_jsonb( _r )
        from __report _r
        order by _r.report_priority desc nulls last,
          _r.report_name nulls last
$$;


--
-- TOC entry 917 (class 1255 OID 19872)
-- Name: engine(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.engine(report jsonb) RETURNS SETOF json
    LANGUAGE plpgsql
    AS $$
declare
  /**
    report := {
      _branch_uid: BRANCH
      limit?: int
      offset?: int
      source: view|table
      columns: [ COL1, COL2, COL3 ]
      filters: [{
        column: src.COL-NAME,
        opr: =|<|>|<=|>=|like
        mode?: default|right
        value: VALUE-FILTER
      }],
      groups:[{
        column: src.COL-NAME
        func: count|sum|max|min|avg
        rename: NEW-NAME
      }]
    }
   */
  _limit int8 default report->>'limit';
  _offset int8 default report->>'offset';
  ___branch uuid default report->>'_branch_uid';
  _next record;
begin
  for _next in select * from report.__prepare( report ) n( statement ) loop
      raise notice 'REPORT %', report;
      raise notice e'REPORT:STATEMENT 
%', _next.statement;
      return query execute _next.statement using ___branch, _limit, _offset;
  end loop;
end;
$$;


--
-- TOC entry 393 (class 1255 OID 19942)
-- Name: eval(text, anyelement); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.eval(expression text, args anyelement) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
declare
  result text;
  statement text;
begin
  statement := format( 'select to_jsonb((%s))', expression );
  raise notice 'eval: %', statement;
  execute statement using args into result;
  return result;
end
$$;


--
-- TOC entry 899 (class 1255 OID 19799)
-- Name: funct_load_report_parametrized(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.funct_load_report_parametrized(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**doc
    args := {
      _branch:text
      _user_id: text
      _workspace: text,
      _grants: text
    }
   doc*/
    _branch text default args->>'_branch';
    _user_id text default args->>'_user_id';
    _workspace text default args->>'_workspace';
    _grants text default args->>'_grants';
begin
  return query 
    with __parametrized_report as (
      select *
        from report.parametrized p
        where p._branch_uid = _branch
          and _workspace = any ( p.parametrized_grants )
          and ( _grants is null or _grants = any ( p.parametrized_grants ) )  
    )  select to_jsonb( _pr )
          from __parametrized_report _pr;
end;
$$;


--
-- TOC entry 900 (class 1255 OID 19800)
-- Name: funct_load_report_parametrized_filter(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.funct_load_report_parametrized_filter(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**doc
    args := {
      _branch:text
      _user_id: text
      _workspace: text
      _parametrized_uid
    }
   doc*/
  _branch text default args->>'_branch';
  _user_id text default args->>'_user_id';
  _workspace text default args->>'_workspace';
  _parametrized_uid uuid default args->>'_parametrized_uid';

  _filter record;
  _const libdom.constant;
  _is_date boolean;
  _is_timestamp boolean;
  _use_value text;
begin
  _const := libdom.constant();
  for _filter in 
    select *
      from report.filter f
      where f._branch_uid = _branch
        and f.filter_parametrized_uid = _parametrized_uid
  loop
    _use_value := null;
      _is_date := _filter.filter_type::regtype in (
        'date'::regtype
      );
    
      _is_timestamp := _filter.filter_type::regtype in (
        'timestamp'::regtype,
        'timestamptz'::regtype
      );
      
      if (_is_date or _is_timestamp) and  _filter.filter_valuemode = _const.report_filter_filter_valuemode_daterelative  then
        _use_value := _filter.filter_basevalue::timestamptz + (_filter.filter_increment)::interval;
      elsif ( _is_date or _is_timestamp ) and _filter.filter_valuemode = _const.report_filter_filter_valuemode_dateprocess then
        _use_value := now();
      elsif _filter.filter_valuemode = _const.report_filter_filter_valuemode_samevalue then 
        _use_value := _filter.filter_basevalue;
      end if;
    
      if _use_value is not null and _is_date then 
          _use_value := _use_value::date;
      end if;
    
      return next to_jsonb( _filter )|| jsonb_build_object(
        'filter_value', _use_value
      );
    
  end loop;
end;
$$;


--
-- TOC entry 913 (class 1255 OID 19868)
-- Name: reduce_name(text); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.reduce_name(text) RETURNS text
    LANGUAGE sql IMMUTABLE
    AS $_$
  select format( '\:%s', $1 )
$_$;


--
-- TOC entry 898 (class 1255 OID 19798)
-- Name: sets_parametrized_report(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.sets_parametrized_report(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
  declare
    /**doc
      args := {
        _user_id character varying not null,
        _espaco_auth character varying not null,
        _branch  character varying not null

        parametrized_uid uuid primary key not null default gen_random_uuid(),
        parametrized_name character varying not null,
        parametrized_source character varying not null,
        parametrized_columns jsonb not null default jsonb_build_array(),
        parametrized_groups jsonb not null default jsonb_build_array(),
        parametrized_props jsonb not null default jsonb_build_object(),
        parametrized_grants character varying[] not null,

        filters:[{
          filter_uid uuid not null primary key default gen_random_uuid(),
          filter_name character varying not null,
          filter_props jsonb not null default jsonb_build_object(),
          filter_require boolean not null default false,
          filter_column character varying not null,
          filter_type character varying not null,
          filter_opr character varying not null,
          filter_basevalue character varying default null,
          filter_valuemode int not null default libdom.get( 'report_filter_filter_valuemode_raw' )::int2,
          filter_increment character varying default null,
          filter_espaco_destino character varying[] not null
        }]
      }
     doc*/
    _filters_id uuid[] default array( select (e.doc->>'filter_uid')::uuid from jsonb_array_elements( args->'filters' ) e( doc ));
    _parametrized report.parametrized;
    _user_id character varying default args->>'_user_id';
    _branch character varying default args->>'_branch';
    _espaco_auth character varying default args->>'_espaco_auth';
    _const libdom.constant;
    _filter report.filter;
  begin
    _parametrized := jsonb_populate_record( _parametrized, args );
    _const := libdom.constant();
    
    -- Garantir que o nome do retatorio não se duplique
    if _parametrized.parametrized_uid is null and exists(
      select *
        from report.parametrized 
        where trim( lower( parametrized_name ) ) = lower( trim( _parametrized.parametrized_name ) )
          and _branch_uid = _branch
    ) then 
      return next jsonb_build_object(
        'result', false,
        'message', 'Já existe uma relatorio parametizado com o nome'
      );
      return;
    end if;
    
    if _parametrized.parametrized_uid is null then
      _parametrized.parametrized_user_id := _user_id;
      _parametrized._branch_uid := _branch;
      _parametrized.parametrized_espaco_auth := _espaco_auth;
    else
      _parametrized.parametrized_user_update := _user_id;
      _parametrized.parametrized_update := clock_timestamp();
    end if;
    
    if _user_id != all( _parametrized.parametrized_grants ) then 
        _parametrized.parametrized_grants := _parametrized.parametrized_grants || _user_id;
    end if;
    if _espaco_auth != all( _parametrized.parametrized_grants ) then 
        _parametrized.parametrized_grants := _parametrized.parametrized_grants || _espaco_auth;
    end if;

    select ( "returning" ).* into _parametrized
      from lib.sets( _parametrized )
    ;

    return next jsonb_build_object(
      'result', true
    )||jsonb_build_object( 'type', 'result');

    return next to_jsonb( _parametrized )
      ||jsonb_build_object( 'type', 'report.parametrized');


    update report.filter
      set filter_state = _const.report_filter_state_active,
          filter_update  = clock_timestamp()
      where filter_parametrized_uid = _parametrized.parametrized_uid
        and filter_state = _const.report_filter_state_active
        and filter_uid != all ( _filters_id )
    ;


    for _filter in
      select f.*
        from jsonb_array_elements( args->'filters' ) e( doc )
          inner join jsonb_populate_record( null::report.filter, e.doc ) f on true
    loop
      if _filter.filter_uid is null then
        _filter.filter_user_id := _user_id;
        _filter._branch_uid := _branch;
        _filter.filter_espaco_auth := _user_id;
        _filter.filter_parametrized_uid := _parametrized.parametrized_uid;
      else
        _filter.filter_user_update := _user_id;
        _filter.filter_update := clock_timestamp();
      end if;

      if _user_id != all( _filter.filter_grants ) then
          _filter.filter_grants := _filter.filter_grants || _user_id;
      end if;
      if _espaco_auth != all( _filter.filter_grants ) then
          _filter.filter_grants := _filter.filter_grants || _espaco_auth;
      end if;
      
      if _filter.filter_type::regtype in ( 
        'date'::regtype,
        'timestamp'::regtype,
        'timestamptz'::regtype
      ) and _filter.filter_valuemode = _const.report_filter_filter_valuemode_daterelative then
        _filter.filter_increment := clock_timestamp() - ( _filter.filter_basevalue::timestamptz );
      end if;
      
      select ("returning").* into _filter
        from lib.sets( _filter )
      ;
      return next to_jsonb( _filter )
          ||jsonb_build_object( 'type', 'filter');
    end loop;
    
  end
$$;


--
-- TOC entry 479 (class 1255 OID 16743)
-- Name: source_filter(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.source_filter(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
    _source text default args->>'source';
    _user uuid default args->>'user';
    _space uuid default args->>'space';
    _branch uuid default args->>'branch';
    _const map.constant;
  begin
    _const := map.constant();

    if _source = 'tweeks.posto' then
      return query
        with __posto as (
          select
              s.posto_id as id,
              s.posto_designacao as label
            from tweeks.posto s
            where s._branch_uid = _branch
        ) select to_jsonb( _p )
          from __posto _p;
    end if;

    if _source = 'auth.colaborador' then
      return query
        with __posto as (
          select
            s.colaborador_id as id,
            s.colaborador_nome as label
          from auth.colaborador s
          where s._branch_uid = _branch
        ) select to_jsonb( _p )
        from __posto _p;
    end if;

    if _source = 'tweeks.espaco' then
      return query
        with __posto as (
          select
            s.espaco_id as id,
            s.espaco_nome as label
          from tweeks.espaco s
          where s.espaco_branch_uid = _branch
        ) select to_jsonb( _p )
        from __posto _p;
    end if;

    if _source = 'geoinfo.currency' then
      return query
        with __posto as (
          select
            s.currency_id as id,
            s.currency_code as label
          from geoinfo.currency s
          where currency_code in ( 'STN', 'EUR', 'USD' )
        ) select to_jsonb( _p )
        from __posto _p;
    end if;

    if _source = 'tweeks.artigo' then
      return query
        with __posto as (
          select
            s.artigo_id as id,
            s.artigo_nome as label
          from tweeks.artigo s
          where s._branch_uid = _branch
          order by s.artigo_nome
        ) select to_jsonb( _p )
        from __posto _p;
    end if;
    
    if _source = 'boolean|Y/N' then
      return query
        with __yes_no ( id, label ) as (
          values ( true, 'SIM' )
          union all values ( false, 'NÃO')
        ) select to_jsonb( _p )
        from __yes_no _p;
    end if;

    if _source = 'boolean|ON/OFF' then
      return query
        with __yes_no ( id, label ) as (
          values ( true, 'ATIVO' )
          union all values ( false, 'DESATIVO')
        ) select to_jsonb( _p )
        from __yes_no _p;
    end if;

    if _source = 'STATUS' then
      return query
        with __yes_no ( id, label ) as (
          values ( 0, 'DESATIVO' )
          union all values ( 1, 'ATIVO' )
          union all values ( 2, 'PENDENTE' )
          union all values ( -1, 'ANULADO' )
        ) select to_jsonb( _p )
        from __yes_no _p;
    end if;

    if _source = 'tweeks.toperacao' then
      return query
        with __posto as (
          select
            s.toperacao_id as id,
            s.toperacao_designacao as label
          from tweeks.toperacao s
        ) select to_jsonb( _p )
        from __posto _p;
    end if;


    if _source = 'tweeks.tgroup' then
      return query
        with __tgroup as (
          select
            s.tgrupo_id as id,
            s.tgrupo_desc as label
          from tweeks.tgrupo s
        ) select to_jsonb( _p )
        from __tgroup _p;
    end if;

    if _source = 'tweeks.tpaga' then
      return query
        with __posto as (
          select
            s.tpaga_id as id,
            s.tpaga_designacao as label
          from tweeks.tpaga s
        ) select to_jsonb( _p )
        from __posto _p;
    end if;

    if _source = 'tweeks.cliente' then
      return query
        with __posto as (
          select
            s.cliente_id as id,
            s.cliente_titular as label
          from tweeks.cliente s
          where s._branch_uid = _branch
        ) select to_jsonb( _p )
        from __posto _p;
    end if;

    if _source = 'tweeks.fornecedor' then
      return query
        with __posto as (
          select
            s.fornecedor_id as id,
            s.fornecedor_nome as label
          from tweeks.fornecedor s
          where s._branch_uid = _branch
        ) select to_jsonb( _p )
        from __posto _p;
    end if;

    if _source = 'tweeks.tipoimposto' then
      return query
        with __source as (
          select
            s.tipoimposto_id as id,
            s.tipoimposto_codigo as label
          from tweeks.tipoimposto s
          where s._branch_uid = _branch
        ) select to_jsonb( _s )
        from __source _s;
    end if;

    if _source = 'tweeks.serie' then
      return query
        with __source as (
          select
            s.serie_id as id,
            format( '%s (%s)', ts.tserie_desc,  s.serie_numero) as label
          from tweeks.serie s
            inner join tweeks.tserie ts on s.serie_tserie_id = ts.tserie_id
          where s._branch_uid = _branch
        ) select to_jsonb( _s )
        from __source _s;
    end if;

    if _source = 'tweeks.tserie' then
      return query
        with __source as (
          select
            s.tserie_id as id,
            s.tserie_desc as label
          from tweeks.tserie s
        ) select to_jsonb( _s )
        from __source _s;
    end if;

    if _source = 'tweeks.tserie::venda' then
      return query
        with __source as (
          select
            s.tserie_id as id,
            s.tserie_desc as label
          from tweeks.tserie s
          where tserie_id in (
            _const.maguita_tserie_fatura,
            _const.maguita_tserie_faturarecibo
          )
        ) select to_jsonb( _s )
        from __source _s;
    end if;

    if _source = 'tweeks.caixa::estado' then
      return query
        with __source( id, label ) as (
          values ( _const.maguita_caixa_estado_ativo, 'ABERTA' )
          union all values ( _const.maguita_caixa_estado_fechado, 'FECHADA' )
        ) select to_jsonb( _s )
        from __source _s;
    end if;

    if _source = 'tweeks.lancamento::mode' then
      return query
        with __source( id, label ) as (
          values ( _const.maguita_lancamento_mode_automatic, 'AUTOMATICO' )
          union all values ( _const.maguita_lancamento_mode_manual, 'MANUAL' )
        ) select to_jsonb( _s )
        from __source _s;
    end if;

    if _source = 'tweeks.tlancamento' then
      return query
        with __source( id, label ) as (
          select tlancamento_id, tlancamento_desc
            from tweeks.tlancamento
        ) select to_jsonb( _s )
        from __source _s;
    end if;

    if _source = 'tweeks.tmovimento' then
      return query
        with __source( id, label ) as (
          select tmovimento_multiplo, tmovimento_designacao
            from tweeks.tmovimento
        ) select to_jsonb( _s )
        from __source _s;
    end if;
    
    if _source = 'tweeks.classe' then
      return query
        with __source( id, label ) as (
          select classe_id, classe_nome
            from tweeks.classe
        ) select to_jsonb( _s )
        from __source _s
        order by _s.label
      ;
    end if;
    
    if _source = 'tweeks.caixa' then
      return query 
        with __caixa as (
            select
              caixa_id as id,
              to_char( cx.caixa_dataatualizacao, 'YYYY-MM-DD HH24:MI') fecho,
              coalesce( cx.caixa_dataatualizacao, cx.caixa_dataregistro ) as date,
              p.posto_designacao,
              cx.caixa_estado,
              max(coalesce( cx.caixa_dataatualizacao, cx.caixa_dataregistro )) filter ( where cx.caixa_estado = (map.constant()).maguita_caixa_estado_fechado ) over ( partition by cx.caixa_posto_id ) last
              from tweeks.caixa cx
                inner join tweeks.posto p on cx.caixa_posto_id = p.posto_id
              where cx._branch_uid = _branch
              order by cx.caixa_dataatualizacao desc nulls first, cx.caixa_dataregistro desc
          ), __source( id, label ) as (
             select
                cx.id,
                format( '%s %s %s', cx.posto_designacao, cx.fecho,
                  case
                    when cx.caixa_estado = (map.constant()).maguita_caixa_estado_ativo then '(aberta)'
                    when cx.date = cx.last then '(ultima fechada)'
                  end
                ) as label
              from __caixa cx
          ) select to_jsonb( _s )
        from __source _s
      ;
    end if;
  end;
$$;


--
-- TOC entry 923 (class 1255 OID 16744)
-- Name: source_map(regclass); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.source_map(regclass) RETURNS TABLE(source_name character varying, source_schema character varying, source_class regclass, source_format character varying, type text)
    LANGUAGE sql
    AS $_$
with __class as (
  select
         pc.tablename::text,
         pc.schemaname::text,
         format( '%s.%s', pc.schemaname::regnamespace::text, pc.tablename )::regclass,
         format( '%s.%s', pc.schemaname::regnamespace::text, pc.tablename ),
         'table'
  from pg_tables pc
  where (format( '%s.%s', pc.schemaname::regnamespace::text, pc.tablename )::regclass = $1)
  union all
  select pv.viewname::text,
         pv.schemaname::text,
         format( '%s.%s', pv.schemaname::regnamespace::text, pv.viewname )::regclass,
         format( '%s.%s', pv.schemaname::regnamespace::text, pv.viewname ),
         'view'
  from pg_views pv
  where (format( '%s.%s', pv.schemaname::regnamespace::text, pv.viewname )::regclass = $1)
) select *
from __class
$_$;


--
-- TOC entry 922 (class 1255 OID 19950)
-- Name: sync(regclass, text, integer, boolean); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.sync(regclass, name text DEFAULT NULL::text, priority integer DEFAULT NULL::integer, active boolean DEFAULT true) RETURNS SETOF json
    LANGUAGE plpgsql
    AS $_$
declare
  _rec record;
  _report report.report;
  _source record;
begin
  select * into _source
  from report.source_map( $1 );

  active := coalesce( active, true );

  with __columns as (
    select
      col.column_name,
      format_type( pt.oid, atttypmod ) column_type,
      col.data_type = 'ARRAY' as is_array,
      col.column_default,
      col.is_generated = 'ALWAYS' as is_generated
    from information_schema.columns col
           inner join report.source_map( _source.source_class ) c on c.source_name = col.table_name
      and col.table_schema::regnamespace = c.source_schema::regnamespace
           inner join pg_attribute att on col.column_name = att.attname
      and att.attrelid = format( '%s.%s', col.table_schema, col.table_name )::regclass::oid
           inner join pg_type pt on att.atttypid = pt.oid
    where format('%s.%s', c.source_schema, c.source_name)::regclass = _source.source_class
  )

  select array_agg( to_jsonb( c ) ) as configs,
         array_agg(c.column_name ) as columns
  into _rec
  from __columns c
  ;

  select * into _report
  from report.report r
  where r.report_source = cluster.__format( $1 )
  ;
  _report.report_name := coalesce( name, _report.report_name, cluster.__format( $1 ) );
  _report.report_source := _source.source_format;
  _report.report_columns := _rec.columns;
  _report.report_priority := priority;
  _report.report_active := active;

  select  ("returning").* into _report
  from lib.sets( _report );

  return next to_json( _report );


  delete from report.vcolumn r
    where r.name != all ( _rec.columns )
      and source = _source.source_format
  ;


  with __news as (
    select
      n.doc->>'column_name' as name,
      n.doc->>'column_type' as type
    from unnest( _rec.configs ) n ( doc )
      left join report.vcolumn rc on n.doc->>'column_name' = rc.name
        and rc.source = _source.source_format
    where rc.name is null
  )
  insert into report.vcolumn (
    source,
    name,
    filter,
    agg,
    type
  ) select
      _report.report_source,
      _n.name,
      jsonb_build_array(),
      jsonb_build_array(),
      _n.type
  from __news _n;

  with __updates as  (
    select
      n.doc->>'column_name' as name,
      n.doc->>'column_type' as type
    from unnest( _rec.configs ) n ( doc )
  ) update report.vcolumn c
  set
    type = _up.type
  from __updates _up
  where c.name = _up.name
    and c.source = _source.source_format
  ;

  return query
    select  to_json( rc )
      from report.vcolumn rc
      where rc.source = _report.report_source
  ;
end;
$_$;


--
-- TOC entry 478 (class 1255 OID 16746)
-- Name: vars(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.vars(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      var_key: [key, key, key],
      arg_colaborador_id::UID
      arg_espaco_id::UID
      source::(report-source)
    }
   */
  _var_key text[] default array( select e.text from jsonb_array_elements_text( args->'var_key') e ( text ) );
begin
  if coalesce( array_length(_var_key, 1), 0 ) = 0 then
    select array_agg( var_key ) into  _var_key
      from report.var v;
  end if;

  return query
    with __vars as (
      select vk.*,
        report.eval( format( 'select (%s)::%s', vk.var_expression, vk.var_type ), '{}'::jsonb ) as value
      from report.var vk
      where vk.var_key = any( _var_key )
    ) select to_jsonb( _vk )
    from __vars _vk
  ;
end;
$$;


--
-- TOC entry 921 (class 1255 OID 16747)
-- Name: vcolumns(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.vcolumns(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args: {
      "source":"REPORT_SOURCE"
    },
   */
  _src character varying default args->>'source';
  _source record;
begin
  select * into _source
  from report.source_map( _src );

  -- COLUMNS
  return query
    select
      jsonb_build_object(
          'key', format( 'column|%s.%s', _src, rc.name ),
          'column', rc.name,
          'name', coalesce( rc.rename, rc.name ),
          'type', 'column',
          'format', rc.format,
          'dataType', rc.type,
          'init', rc.init
        )
    from report.vcolumn rc
    where rc.source = _source.source_format
      and rc.show
    order by rc.position desc
      nulls last,
             coalesce( rc.rename, rc.name )
  ;

  -- FILTER
  return query
    with __filters as (
      select rc.*, f.ordinality, report.__template_of( f.doc, to_jsonb( rc ) || to_jsonb( _source ) || to_jsonb( r ) ) as doc
      from report.vcolumn rc
         inner join report.report r on rc.source = r.report_source
         inner join jsonb_array_elements( rc.filter ) with ordinality f( doc ) on true
      where rc.source = _source.source_format
        and jsonb_array_length( rc.filter ) > 0
    ) select f.doc || jsonb_build_object(
        'key', format( 'filter|%s.%s::#%s', _src, f.name, f.ordinality ),
        'opr', f.doc->'opr',
        'column', f.name,
        'dataType', f.type,
        'name', f.doc->'name',
        'mode', f.doc->'mode',
        'source', f.doc->'source',
        'src', f.doc->'src',
        'format', f.doc->'format',
        'type', 'filter'
      ) from __filters  f
    order by
      coalesce( ( f.doc->>'position')::int2, f.position ) desc
      nulls last,
      f.ordinality,
      coalesce( f.doc->>'name', f.name )
  ;

  -- GROUP
  return query
    with __filters as (
      select rc.*,
             agg.function as agg_function,
             agg.label as agg_label,
             agg.key as agg_key,
             agg.priority as agg_priority,
             lib.str_normalize( format( agg.name, rc.name ) ) as agg_name,
             agg.format as agg_format,
             lib.str_normalize( format( agg.rename, rc.name ) ) as agg_rename,
             agg.simple as agg_simple,
             agg.expression as agg_expresion,
             agg.over as agg_over,
             agg.types as agg_types,
             format( '%I', rc.name ) as agg_usecolumn,
             lib.str_normalize( format( agg.rename, rc.name ) ) as agg_userename
      from report.vcolumn rc
             inner join report.report r on rc.source = r.report_source
             inner join report.agg agg on rc.format = any( agg.types )

      where rc.source = _source.source_format
        and rc.show
    ) select jsonb_build_object(
                 'key', format( 'aggregation|%s.%s::#%s', _src, f.name, f.agg_key ),
                 'column', f.name,
                 'name',  f.agg_name,
                 'func', f.agg_function,  -- f.doc -> 'func',
                 'format', coalesce( f.agg_format, f.format ), -- f.doc -> 'format',
                 'rename', f.agg_rename,
                 'type', 'group',
                 'label', f.agg_label,
                 'init', false,
                 'dataType', f.type,
                 'simple', format( f.agg_simple,  f.agg_usecolumn ),
                 'expression', format( f.agg_expresion, f.agg_usecolumn, f.agg_rename ),
                 'priority', f.agg_priority,
                 'column_position', f.position,
                 'over', format( f.agg_over, f.agg_usecolumn, format( '\\\\:%s:#ROW_NUMBER', f.name  ) )
               ) from __filters  f
    order by
      f.position desc nulls last,
      f.name,
      f.agg_priority nulls last;

  -- INDEPENDENT AGGREGATION
  return query
    with __vcolumn as (
      select
        rc.*,
        agg.function,
        agg.label,
        agg.key,
        agg.priority,
        agg.simple,
        agg.expression,
        agg.over,
        agg.types,
        agg.format _agg_format,
        lib.str_normalize( format( agg.name, rc.name ) ) as _agg_name,
        lib.str_normalize( format( agg.rename, rc.name ) ) as _agg_rename

        from report.vcolumn rc
          inner join report.report r on rc.source = r.report_source
          inner join report.agg agg on rc.format = any( agg.types )



    ),  __filters as (
      select rc.*,
             rc.function as agg_function,
             rc.label as agg_label,
             rc.key as agg_key,
             rc.priority as agg_priority,
             coalesce( e.doc->>'name', rc._agg_name ) as agg_name,
             coalesce( e.doc->>'format', rc._agg_format, rc.format ) as agg_format,
             coalesce( e.doc->>'rename', rc._agg_rename, e.doc->>'name', rc._agg_name ) as agg_rename,
             rc.simple as agg_simple,
             rc.expression as agg_expresion,
             rc.over as agg_over,
             rc.types as agg_types,
             format( '%I', rc.name )  as agg_usecolumn,
             format( '%I', coalesce( e.doc->>'rename', rc._agg_rename, e.doc->>'name', rc._agg_name, rc.name ) ) as agg_userename
      from __vcolumn rc
             inner join jsonb_array_elements( rc.agg ) with ordinality e( doc ) on true
               and ( e.doc->>'func' ) = rc.key
      where rc.source = _source.source_format
        and jsonb_array_length( rc.agg ) > 0
    ) select jsonb_build_object(
                 'key', format( 'aggregation|%s.%s::#%s', _src, f.name, f.agg_key ),
                 'column', f.name,
                 'dataType', f.type,
                 'name',  f.agg_name,
                 'func', f.agg_function,
                 'format', agg_format,
                 'rename', f.agg_rename,
                 'type', 'group',
                 'label', f.agg_label,
                 'init', false,
                 'simple', format( f.agg_simple,  f.agg_usecolumn ),
                 'expression', format( f.agg_expresion, f.agg_usecolumn, f.agg_rename ),
                 'priority', f.agg_priority,
                 'column_position', f.position,
                 'over', format( f.agg_over, f.agg_usecolumn, format( '\\\\:%s:#ROW_NUMBER', f.name  ) )
               ) from __filters  f
    order by
      f.position desc nulls last,
      f.name,
      f.agg_priority nulls last;
end
$$;


--
-- TOC entry 924 (class 1255 OID 20030)
-- Name: vreport_imposto_financas(jsonb); Type: FUNCTION; Schema: report; Owner: -
--

CREATE FUNCTION report.vreport_imposto_financas(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /*
    args := {
      arg_colaborador_id: UID
      arg_espaco_auth: UID
      arg_datainicio
      arg_datafim
    }
   */
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_datainicio date default args->>'arg_datainicio';
  arg_datafim date default args->>'arg_datafim';
  arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _const map.constant;

begin
  _const := map.constant();
  return query
    with __declaracao as (
      select
         se.serie_sequencia as documento_numero,
         se.serie_numero as documento_serie,
         ct.conta_data as documento_data,
         coalesce( ct.conta_titularnif, cli.cliente_nif) as nif_consumidor,
         abs( ve.venda_montantesemimposto::numeric(100,6) ) as total_valor_itens,
         tx.taxa_percentagem as taxa_aplicavel_itens,
         coalesce( ve.venda_codigoimposto, ar.artigo_codigoimposto) as codigo_isento,
         abs( ve.venda_quantidade ) quant_itens,
         coalesce( ve.venda_descricao, ar.artigo_nome ) desc_itens,
         ctorigin.conta_numerofatura numero_documento_origem,
         ctorigin.conta_data data_documento_origem,
         tsorigin.tserie_code as tipo_documento_origem,
         ts.tserie_code,
         ct.conta_id,
         ve.venda_id,
         cli.cliente_id,
         tx.taxa_id,
         se.serie_id,
         ar.artigo_id,
         ct.conta_conta_docorigin,
         ct._branch_uid
         
      from tweeks.conta ct
        inner join json_populate_record( null::tweeks.serie, ct.conta_serie ) se on true
        inner join tweeks.serie _se on se.serie_id = _se.serie_id
        inner join tweeks.tserie ts on _se.serie_tserie_id = ts.tserie_id
        inner join tweeks.venda ve on ct.conta_id = ve.venda_conta_id
          and ve.venda_estado = _const.maguita_venda_estado_fechado
          and ve.venda_venda_id is null
        inner join tweeks.taxa tx on tx.taxa_id = any( ve.venda_taxas )
        inner join tweeks.artigo ar on ve.venda_artigo_id = ar.artigo_id
        left join tweeks.conta ctorigin on ct.conta_conta_docorigin = ctorigin.conta_id
        left join json_populate_record( null::tweeks.serie, ctorigin.conta_serie ) seorign on true
        left join tweeks.serie _seorign on seorign.serie_id = _seorign.serie_id
        left join tweeks.tserie tsorigin on _seorign.serie_tserie_id = tsorigin.tserie_id
        left join tweeks.cliente cli on ct.conta_cliente_id = cli.cliente_id

      where ve._branch_uid = arg_branch_uid
        and ct._branch_uid = arg_branch_uid
        and ct.conta_estado = _const.maguita_conta_estado_fechado
        and ve.venda_estado = _const.maguita_venda_estado_fechado
        and ct.conta_datafecho >= coalesce( arg_datainicio, ct.conta_data )
        and ct.conta_datafecho <= coalesce( arg_datafim, ct.conta_data )
        and ts.tserie_id in (
          _const.maguita_tserie_fatura,  
          _const.maguita_tserie_faturarecibo,  
          _const.maguita_tserie_notacredito  
        )
    ) select to_jsonb( _de ) from __declaracao _de
  ;
end;
$$;


--
-- TOC entry 708 (class 1255 OID 16748)
-- Name: artigo_generate_nextcodigo(uuid); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.artigo_generate_nextcodigo(arg_classe_id uuid) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
declare
  _classe tweeks.classe;
begin
  update tweeks.classe
    set classe_lastcodigo = classe.classe_lastcodigo +1
    where classe_id = arg_classe_id
    returning * into _classe
  ;

  return lib.str_nospace( format('%s%s', _classe.classe_codigo, to_char( _classe.classe_lastcodigo, '0000' ) ) );
end;
$$;


--
-- TOC entry 690 (class 1255 OID 16749)
-- Name: artigo_has_open_account(uuid); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.artigo_has_open_account(arg_artigo_id uuid) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
declare
  -- Essa função serve para verificar se existe contas aberta com um artigo
  _const map.constant;
begin
  _const := map.constant();
  return (
    select count( * ) > 0
      from tweeks.venda vd
      where vd.venda_estado = _const.venda_estado_aberto
        and vd.venda_artigo_id = arg_artigo_id
  );
end
$$;


--
-- TOC entry 715 (class 1255 OID 16750)
-- Name: artigo_referencia(uuid); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.artigo_referencia(arg_artigo_id uuid) RETURNS jsonb
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
  select jsonb_build_object( 'artigo_id', arg_artigo_id );
$$;


--
-- TOC entry 406 (class 1255 OID 16751)
-- Name: calculate_cost(double precision, double precision, double precision); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.calculate_cost(arg_precario_quantidade double precision, arg_precario_custo double precision, arg_quantidade double precision) RETURNS double precision
    LANGUAGE sql
    AS $_$
  /** Essa função calcula o custo x quantidade de uma compra
    arg_precario_quantidade ----> arg_precario_custo
    arg_quantidade  ------------> $x
    $x = arg_quantidade * arg_precario_custo / arg_precario_quantidade
    */
  select arg_quantidade * arg_precario_custo / arg_precario_quantidade
$_$;


--
-- TOC entry 563 (class 1255 OID 16752)
-- Name: classe_referencia(uuid); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.classe_referencia(arg_classe_id uuid) RETURNS jsonb
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
select jsonb_build_object( 'classe_id', arg_classe_id );
$$;


--
-- TOC entry 564 (class 1255 OID 16753)
-- Name: constant(); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.constant() RETURNS map.constant
    LANGUAGE sql IMMUTABLE
    AS $$ select map.constant()$$;


--
-- TOC entry 473 (class 1255 OID 16754)
-- Name: espaco_get_childrens(uuid); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.espaco_get_childrens(arg_espaco_id uuid DEFAULT NULL::uuid) RETURNS uuid[]
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função devolve os espaços afilhado a um espaco
    arg_espaco_id := id do espaço
   */
begin
  if arg_espaco_id is null then
    return array( select esp.espaco_id from tweeks.espaco esp );
  else
    return array(
      with recursive __parent as (
        select e.espaco_id from tweeks.espaco e where e.espaco_id = arg_espaco_id
        union all
        select e.espaco_id
          from __parent l
            inner join tweeks.espaco e on l.espaco_id = e.espaco_espaco_id
      ) select l.espaco_id
        from __parent l
    );
  end if;
end;
$$;


--
-- TOC entry 716 (class 1255 OID 16755)
-- Name: espaco_get_childrens_static(uuid); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.espaco_get_childrens_static(arg_espaco_id uuid DEFAULT NULL::uuid) RETURNS uuid[]
    LANGUAGE sql IMMUTABLE
    AS $$select * from rule.espaco_get_childrens( arg_espaco_id );$$;


--
-- TOC entry 565 (class 1255 OID 16756)
-- Name: espaco_get_parent(uuid); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.espaco_get_parent(arg_espaco_id uuid) RETURNS smallint[]
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função devolve os espaços afilhado a um espaco
    arg_espaco_id := id do espaço
    arg_tespaco_id := o tipo do espaço
   */
begin
    return array(
      with recursive list as (
        select e.espaco_id, e.espaco_espaco_id from tweeks.espaco e where e.espaco_id = arg_espaco_id
        union all
        select e.espaco_id, e.espaco_espaco_id
          from list l
            inner join tweeks.espaco e on l.espaco_espaco_id = e.espaco_id
      ) select l.espaco_id
        from list l
    );
end;
$$;


--
-- TOC entry 724 (class 1255 OID 16757)
-- Name: __space_branch_level(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__space_branch_level(_espaco_id uuid) RETURNS integer
    LANGUAGE sql IMMUTABLE
    AS $_$
with recursive __espaco as (
  select
    e.espaco_id,
    e.espaco_espaco_id,
    0 as _espaco_nivel
  from tweeks.espaco e
  where e.espaco_espaco_id is null
  union all
  select
    e2.espaco_id,
    e2.espaco_espaco_id,
    e3._espaco_nivel +1
  from tweeks.espaco e2
         inner join __espaco e3  on e2.espaco_espaco_id = e3.espaco_id
) select e._espaco_nivel
from __espaco e
where e.espaco_id = $1
$_$;


--
-- TOC entry 240 (class 1259 OID 16758)
-- Name: espaco; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.espaco (
    espaco_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    espaco_vender character varying,
    espaco_espaco_id uuid,
    espaco_colaborador_id uuid NOT NULL,
    espaco_colaborador_atualizaco uuid,
    espaco_nome character varying,
    espaco_descricao character varying,
    espaco_estado smallint DEFAULT (map.get('espaco_estado_ativo'::name))::smallint NOT NULL,
    espaco_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    espaco_dataatualizacao timestamp with time zone,
    espaco_gerarfatura boolean DEFAULT true NOT NULL,
    espaco_configurar boolean DEFAULT true NOT NULL,
    espaco_codigo character varying NOT NULL,
    espaco_faturaano smallint DEFAULT date_part('year'::text, CURRENT_DATE) NOT NULL,
    espaco_seriefatura integer DEFAULT 0 NOT NULL,
    espaco_serieconta integer DEFAULT 0 NOT NULL,
    espaco_configuracao jsonb,
    espaco_seriedeposito bigint DEFAULT 0 NOT NULL,
    espaco_branch_uid uuid,
    espaco_espaco_auth uuid,
    espaco_nivel smallint GENERATED ALWAYS AS ((COALESCE(tweeks.__space_branch_level(espaco_espaco_id), '-1'::integer) + 1)) STORED NOT NULL,
    espaco_posto_admin uuid,
    _branch_uid uuid GENERATED ALWAYS AS (espaco_branch_uid) STORED,
    CONSTRAINT ck_esoaco_descricao_normalized CHECK (lib.str_is_normalized((espaco_descricao)::text)),
    CONSTRAINT ck_esoaco_nome_normalized CHECK (lib.str_is_normalized((espaco_nome)::text))
);


--
-- TOC entry 5831 (class 0 OID 0)
-- Dependencies: 240
-- Name: TABLE espaco; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.espaco IS '#Espaço - Essa entidade serve para armazenar os espaços do stock';


--
-- TOC entry 5832 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN espaco.espaco_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.espaco.espaco_id IS 'Identificador único do espaço';


--
-- TOC entry 5833 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN espaco.espaco_vender; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.espaco.espaco_vender IS 'Esse campo indica em qual dos nucleo o espaço deve permitir a venda';


--
-- TOC entry 5834 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN espaco.espaco_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.espaco.espaco_colaborador_id IS 'Identificador do colaborador responsável pelo registro do espaço';


--
-- TOC entry 5835 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN espaco.espaco_colaborador_atualizaco; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.espaco.espaco_colaborador_atualizaco IS 'Identificador do último colaborador responsavél pela atualização do espaço';


--
-- TOC entry 5836 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN espaco.espaco_nome; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.espaco.espaco_nome IS 'Corresponde ao nome do espaço';


--
-- TOC entry 5837 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN espaco.espaco_descricao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.espaco.espaco_descricao IS 'Corresponde a descrição do espaço';


--
-- TOC entry 5838 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN espaco.espaco_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.espaco.espaco_estado IS '
  Estado do espaco
  <ul>
    <li> 1 - Ativo </li>
    <li> 0 - Fechado </li>
  </ul>
';


--
-- TOC entry 5839 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN espaco.espaco_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.espaco.espaco_dataregistro IS 'Corresponde ao instante em que o espaço foi registrado no sistema';


--
-- TOC entry 5840 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN espaco.espaco_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.espaco.espaco_dataatualizacao IS 'Corresponde ao instante em que o espaço foi atualizado pelo última vez';


--
-- TOC entry 709 (class 1255 OID 16776)
-- Name: espaco_get_serializer(uuid); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.espaco_get_serializer(arg_espaco_id uuid) RETURNS tweeks.espaco
    LANGUAGE plpgsql STRICT
    AS $$
declare
  /**
    Essa função serve para devolver o espaço onde deve ser processado a fatura
    arg_espaco_id := id do espaço
   */
  _espaco tweeks.espaco;
begin

  with recursive parent as (
      select e.* from tweeks.espaco e where e.espaco_id = arg_espaco_id
    union all
      select e.*
        from parent p
          inner join tweeks.espaco e on p.espaco_espaco_id = e.espaco_id
        where not p.espaco_gerarfatura
  ) select l.* into _espaco
    from parent l
    where l.espaco_gerarfatura
  ;

  -- Quando saltar do ano reiniciar a contagem das faturas
  if _espaco.espaco_id is not null and _espaco.espaco_faturaano < extract( year from current_date ) then
    update tweeks.espaco
      set espaco_faturaano = extract( year from current_date ),
          espaco_seriefatura  = 0
      where espaco_id = _espaco.espaco_id
      returning  * into _espaco;
  end if;

  return _espaco;
end;
$$;


--
-- TOC entry 241 (class 1259 OID 16777)
-- Name: movimento; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.movimento (
    movimento_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    movimento_stock_id uuid NOT NULL,
    movimento_movimento_reference uuid,
    movimento_toperacao_id smallint NOT NULL,
    movimento_tmovimento_id smallint NOT NULL,
    movimento_espaco_auth uuid NOT NULL,
    movimento_colaborador_id uuid NOT NULL,
    movimento_colaborador_atualizacao uuid,
    movimento_referencia jsonb,
    movimento_data date,
    movimento_documento character varying,
    movimento_quantidade double precision,
    movimento_quantidadeinicia double precision,
    movimento_quantidadefinal double precision,
    movimento_observacao character varying,
    movimento_estado smallint DEFAULT (map.get('movimento_estado_ativo'::name))::smallint NOT NULL,
    movimento_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    movimento_dataatualizacao timestamp with time zone,
    movimento_artigo_in uuid,
    movimento_artigo_out uuid,
    movimento_espaco_in uuid,
    movimento_espaco_out uuid,
    movimento_valorin double precision,
    movimento_valorout double precision,
    movimento_valorstock double precision,
    movimento_regclass regclass,
    movimento_refuid uuid,
    _branch_uid uuid
);


--
-- TOC entry 5843 (class 0 OID 0)
-- Dependencies: 241
-- Name: TABLE movimento; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.movimento IS 'Essa entidade serve para armazenar as movimentações dos artigos feito nos stocks';


--
-- TOC entry 5844 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_id IS 'Corresponde ao identificador único da movimentação';


--
-- TOC entry 5845 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_stock_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_stock_id IS 'Identificador do stock a qual foi moviemntado o artigo';


--
-- TOC entry 5846 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_toperacao_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_toperacao_id IS 'Identificador do timo de movimentação';


--
-- TOC entry 5847 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_tmovimento_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_tmovimento_id IS 'O tipo de operação da movimentação
<ul>
  <li> credito: 1 </li>
  <li> debito: -1 </li>
</ul>
';


--
-- TOC entry 5848 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_colaborador_id IS 'Identificador do colaborador responsável pelo registro da movimentação';


--
-- TOC entry 5849 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_colaborador_atualizacao IS 'Identificador do colaborador responsável pela atualização';


--
-- TOC entry 5850 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_referencia; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_referencia IS 'Referencia da operação que criou a movimentação
<ul>
  <li> acreto_id: ID </li>
  <li> entrada_id: ID </li>
  <li> venda_id: ID </li>
  <li> transferencia_id: ID </li>
</ul>';


--
-- TOC entry 5851 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_data; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_data IS 'A data em que a movimentação foi feita';


--
-- TOC entry 5852 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_documento; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_documento IS 'O documento da movimentação';


--
-- TOC entry 5853 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_quantidade; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_quantidade IS 'A quantidade do artigo movimentado';


--
-- TOC entry 5854 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_quantidadeinicia; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_quantidadeinicia IS 'A quantidade inicial do artigo antes da movimentação';


--
-- TOC entry 5855 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_quantidadefinal; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_quantidadefinal IS 'A quantidade final do artigo após a movimentação';


--
-- TOC entry 5856 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_observacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_observacao IS 'Corresponde a observação da movimentação';


--
-- TOC entry 5857 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_estado IS 'Corresponde ao estado da movimentação
<ul>
  <li> 1 - Ativo </li>
  <li> 0 - Anulado | siginifica que a operação foi anulada (uma operação já confirmada que é anulado) </li>
  <li> -1 - Canselado | significa que a operação foi canselado (o caso de venda quado o produto é removido do carinho) </li>
</ul>';


--
-- TOC entry 5858 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_dataregistro IS 'Corresponde ao instante em que a movimentação foi criada';


--
-- TOC entry 5859 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN movimento.movimento_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.movimento.movimento_dataatualizacao IS 'Corresponde ao instante em que a movimentação foi atualiza pela sua última vez';


--
-- TOC entry 717 (class 1255 OID 16785)
-- Name: movimento_create(uuid, uuid, uuid, smallint, jsonb, double precision, smallint, double precision, date, character varying); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.movimento_create(arg_espaco_auth uuid, arg_colaborador_id uuid, arg_stock_id uuid, arg_toperacao_id smallint, arg_movimento_referencia jsonb, arg_movimento_quantidade double precision, arg_tmovimento_id smallint, arg_movimento_quantidadefinal double precision DEFAULT NULL::double precision, arg_movimento_data date DEFAULT CURRENT_DATE, arg_movimento_documento character varying DEFAULT NULL::character varying) RETURNS tweeks.movimento
    LANGUAGE plpgsql
    AS $$
declare
  /** Registar um novo movimento no stock*/
  arg_operacao_nome varchar;

  _stock tweeks.stock;
  _artigo tweeks.artigo;
  _espaco tweeks.espaco;
  _const map.constant;
  _movimento tweeks.movimento;
  _tmovimento tweeks.tmovimento;
begin

  _const := map.constant();
  if arg_tmovimento_id not in ( _const.tmovimento_credito, _const.tmovimento_debito ) then
    raise exception 'Movimento rejeitado (tipo de movimento desconhecido)';
  end if;

  if arg_movimento_quantidade < 0 then
    raise exception 'Movimento rejeitado (Quantidade negativa)';
  end if;

  _tmovimento := tweeks._get_tmovimento( arg_tmovimento_id );
  _stock := tweeks._get_stock( arg_stock_id );
  _artigo := tweeks._get_artigo( _stock.stock_artigo_id );
  _espaco := tweeks._get_espaco( _stock.stock_espacao_id );


  arg_movimento_quantidadefinal := coalesce( arg_movimento_quantidadefinal, _stock.stock_quantidade + ( arg_movimento_quantidade * _tmovimento.tmovimento_multiplo ) );
  arg_movimento_data := coalesce( arg_movimento_data, current_date );

  if arg_movimento_quantidadefinal < 0  and not _artigo.artigo_stocknegativo then

    arg_operacao_nome := case
      when _tmovimento.tmovimento_id = _const.tmovimento_debito then 'Debito'
      when _tmovimento.tmovimento_id = _const.tmovimento_credito then 'Credito'
    end;
    --                             OPR    ART   ESP
    raise exception '%', format( 'O %s de %s %s em %s não pode ser concluido! Stock disponivél não soficiente para a operação (artigo não aceita stock negativo).',
      arg_operacao_nome,
      arg_movimento_quantidade,
      _artigo.artigo_nome,
      _espaco.espaco_nome
    );
  end if;

  insert into tweeks.movimento(
    movimento_espaco_auth,
    movimento_colaborador_id,
    movimento_stock_id,
    movimento_toperacao_id,
    movimento_referencia,
    movimento_data,
    movimento_quantidade,
    movimento_quantidadeinicia,
    movimento_quantidadefinal,
    movimento_tmovimento_id,
    movimento_documento
  ) values (
    arg_espaco_auth,
    arg_colaborador_id,
    _stock.stock_id,
    arg_toperacao_id,
    arg_movimento_referencia,
    arg_movimento_data,
    arg_movimento_quantidade,
    _stock.stock_quantidade,
    arg_movimento_quantidadefinal,
    arg_tmovimento_id,
    arg_movimento_documento
  ) returning * into _movimento;

  return _movimento;
end;
$$;


--
-- TOC entry 710 (class 1255 OID 16786)
-- Name: movimento_revert(uuid, uuid, smallint, smallint, character varying, text, smallint, character varying); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.movimento_revert(arg_espaco_auth uuid, arg_colaborador_id uuid, arg_toperacao_id smallint, arg_movimento_tmovimento_id smallint, arg_referencia_key character varying, arg_referencia_value text, arg_movimento_estado smallint, arg_movimento_observacao character varying) RETURNS tweeks.movimento
    LANGUAGE plpgsql
    AS $$
declare
  _movimento tweeks.movimento;
  _const map.constant;
begin
  _const := map.constant();

  if arg_movimento_estado not in ( _const.movimento_estado_canselado, _const.movimento_estado_canselado ) then
    raise exception 'Não pode reverter o movimento! estado invalido, code:{key: %, value: %, opr: %, tmv: %, usr: %, rev-mod: % }',
      arg_referencia_key, arg_referencia_value, arg_movimento_tmovimento_id, arg_toperacao_id, arg_colaborador_id, arg_movimento_estado;
  end if;

  select * into _movimento
    from tweeks.movimento mv
    where mv.movimento_referencia ->> ( arg_referencia_key ) = arg_referencia_value
      and mv.movimento_estado = _const.movimento_estado_ativo
      and mv.movimento_toperacao_id = arg_toperacao_id
      and mv.movimento_tmovimento_id = arg_movimento_tmovimento_id
      and mv.movimento_espaco_auth = arg_espaco_auth
    order by mv.movimento_dataregistro desc
  ;

  -- Se encontar alguma movimento que possa ser revertito então reverte
  if _movimento.movimento_id is not null then
    update tweeks.movimento
      set movimento_colaborador_atualizacao = arg_colaborador_id,
        movimento_dataatualizacao = current_timestamp,
        movimento_estado = arg_movimento_estado
      where movimento_id = _movimento.movimento_id
      returning * into _movimento
    ;
  end if;

  return _movimento;
end;
$$;


--
-- TOC entry 242 (class 1259 OID 16787)
-- Name: taxa; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.taxa (
    taxa_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    taxa_tipoimposto_id uuid NOT NULL,
    taxa_espaco_auth uuid NOT NULL,
    taxa_colaborador_id uuid NOT NULL,
    taxa_colaborador_atualizacao uuid,
    taxa_percentagem double precision,
    taxa_taxa double precision,
    taxa_estado smallint DEFAULT (map.get('taxa_estado_ativo'::name))::smallint NOT NULL,
    taxa_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    taxa_dataatualizacao timestamp with time zone,
    _branch_uid uuid,
    CONSTRAINT ck_taxa_percentagem_or_value_isnull CHECK (((taxa_percentagem IS NULL) OR (taxa_taxa IS NULL))),
    CONSTRAINT ck_taxa_percentagem_or_value_notnull CHECK (((taxa_percentagem IS NOT NULL) OR (taxa_taxa IS NOT NULL)))
);


--
-- TOC entry 5863 (class 0 OID 0)
-- Dependencies: 242
-- Name: TABLE taxa; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.taxa IS 'Essa entidade serve para registar as taxa de impostos';


--
-- TOC entry 5864 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN taxa.taxa_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.taxa.taxa_id IS 'Identificador único da taxa do imposto';


--
-- TOC entry 5865 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN taxa.taxa_tipoimposto_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.taxa.taxa_tipoimposto_id IS 'O imposto o qual a taxa pertence';


--
-- TOC entry 5866 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN taxa.taxa_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.taxa.taxa_colaborador_id IS 'Identificador do colaborador responsável pelo registro da taxa';


--
-- TOC entry 5867 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN taxa.taxa_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.taxa.taxa_colaborador_atualizacao IS 'Identificador do colaborador responsável pela atualização dat taxa (colaborador que fechou a taxa)';


--
-- TOC entry 5868 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN taxa.taxa_percentagem; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.taxa.taxa_percentagem IS 'Corresponde a percentagem da taxa a ser aplicado nos atrigos';


--
-- TOC entry 5869 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN taxa.taxa_taxa; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.taxa.taxa_taxa IS 'Corresponde ao valor da taxa (para o caso de imposto em que o valor da taxa não varia)';


--
-- TOC entry 5870 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN taxa.taxa_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.taxa.taxa_estado IS 'Corresponde ao estado da taxa';


--
-- TOC entry 5871 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN taxa.taxa_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.taxa.taxa_dataregistro IS 'Corresponde ao instante em que a taxa foi registrado';


--
-- TOC entry 5872 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN taxa.taxa_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.taxa.taxa_dataatualizacao IS 'Corresponde ao instante em que a taxa foi atualizado';


--
-- TOC entry 718 (class 1255 OID 16795)
-- Name: taxa_espaco(tweeks.taxa, map.constant, uuid); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.taxa_espaco(_taxa tweeks.taxa, _const map.constant, arg_espaco_auth uuid) RETURNS tweeks.taxa
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para devolver a taxa subscrita em um espaco
   */
  _taxa_over tweeks.taxa;
begin
  -- Quando o espaço que pediu for espaço da taxa então devolver a propria taxa
  if _taxa.taxa_espaco_auth = arg_espaco_auth then return _taxa; end if;

  with recursive parent as (
      select
        e.*,
        tx over_taxa,
        tx.taxa_id is not null self_taxa

      from tweeks.espaco e
        left join tweeks.taxa tx on tx.taxa_espaco_auth = e.espaco_id
          and tx.taxa_tipoimposto_id = _taxa.taxa_tipoimposto_id
          and tx.taxa_estado = _const.taxa_estado_ativo
      where e.espaco_id = arg_espaco_auth

    union all
      select
          e.*,
          tx as over_taxa,
          tx.taxa_id is not null as self_taxa
        from parent p
          inner join tweeks.espaco e on p.espaco_espaco_id = e.espaco_id
          left join tweeks.taxa tx on e.espaco_id = tx.taxa_espaco_auth
            and tx.taxa_estado = _const.taxa_estado_ativo
            and tx.taxa_tipoimposto_id = _taxa.taxa_tipoimposto_id
        where not p.self_taxa --quando o parente não gerar fatura || quando o parente não ter taxa
  ) select (l.over_taxa).* into _taxa_over
  from parent l
    where l.self_taxa
  ;

  raise notice '% %', _taxa_over.taxa_id, _taxa.taxa_id ;
  if _taxa_over.taxa_id is null then
    _taxa_over := _taxa;
  end if;
  return _taxa_over;
end;
$$;


--
-- TOC entry 480 (class 1255 OID 16796)
-- Name: taxa_retirar_percentagem_adicionada(double precision, double precision); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.taxa_retirar_percentagem_adicionada(arg_value double precision, arg_percentagem double precision) RETURNS double precision
    LANGUAGE sql
    AS $$
    select ( arg_value * arg_percentagem ) / ( 100.0 + arg_percentagem );
  $$;


--
-- TOC entry 481 (class 1255 OID 16797)
-- Name: tg_amortizacao_afeter_insert_syncronize_montante(); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.tg_amortizacao_afeter_insert_syncronize_montante() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para atualizar o valor do montante em (posto, conta, ... )
   */
  arg_conta_id uuid;

  _new tweeks.amortizacao;
  _conta tweeks.conta;
  _const map.constant;
  _caixa tweeks.caixa;
begin
  _const := map.constant();
  _new := new;
  arg_conta_id := _new.amortizacao_referencia->>'conta_id';
  _caixa := tweeks._get_caixa( _new.amortizacao_caixa_id );

  -- Se o movimentação for de uma conta
  if arg_conta_id is not null then
    _conta := tweeks._get_conta( arg_conta_id );
    _conta.conta_montanteamortizado := _conta.conta_montanteamortizado + _new.amortizacao_montante + _new.amortizacao_montantetroco;
    _conta.conta_montantemoeda := _conta.conta_montantemoeda + _new.amortizacao_montantemoeda;
    _conta.conta_taxacambio := _new.amortizacao_taxacambio;

    -- Calcular o valor do troco
    if _conta.conta_montanteamortizado > ( _conta.conta_montante - _conta.conta_desconto ) then
      _conta.conta_montantetroco := _conta.conta_montanteamortizado - ( _conta.conta_montante - _conta.conta_desconto );
      _conta.conta_montanteamortizado := ( _conta.conta_montante - _conta.conta_desconto );
    end if;

    -- Fechar a conta se o novo montante amortizado pagar o valor da conta
    if _conta.conta_montanteamortizado >= ( _conta.conta_montante - _conta.conta_desconto ) and _conta.conta_estado != _const.conta_estado_pago then
      _conta.conta_estado := _const.conta_estado_pago;
    end if;

    update tweeks.conta
      set conta_montanteamortizado = _conta.conta_montanteamortizado,
          conta_montantemoeda = _conta.conta_montantemoeda,
          conta_taxacambio = _conta.conta_taxacambio,
          conta_caixa_fechopagamento = _caixa.caixa_id,
          conta_montantetroco = _conta.conta_montantetroco,
          conta_estado = _conta.conta_estado,
          conta_dataatualizacao = current_timestamp,
          conta_colaborador_atualizacao = _new.amortizacao_colaborador_id
      where conta_id = _conta.conta_id
    ;
  end if;

  perform rule.transacao_create(
    _new.amortizacao_espaco_auth,
    _caixa.caixa_posto_id,
    _const.toperacao_pagamento,
    _const.tmovimento_credito,
    _new.amortizacao_colaborador_id,
    _new.amortizacao_montante,
    _new.amortizacao_documento,
    jsonb_build_object( 'amortizacao_id', _new.amortizacao_id ),
    false,
    null
  );

  return null;
end;
$$;


--
-- TOC entry 566 (class 1255 OID 16798)
-- Name: tg_caixa_after_insert_abrir_posto(); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.tg_caixa_after_insert_abrir_posto() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função deve abrir uma posto depois que for inserido uma nova caixa de posto
   */
  _new tweeks.caixa;
  _const map.constant;
begin
  _new := new;
  _const := map.constant();

  update tweeks.posto cx
    set posto_estado = _const.posto_estado_aberto
    where posto_id = _new.caixa_posto_id
  ;

  return null;
end;
$$;


--
-- TOC entry 719 (class 1255 OID 16799)
-- Name: tg_caixa_after_updade_fechar_posto(); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.tg_caixa_after_updade_fechar_posto() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função deve fechar uma posto depois que a sua caixa tiver fechada
   */
  _new tweeks.caixa;
  _old tweeks.caixa;
  _const map.constant;
begin
  _new := new;
  _old := old;
  _const := map.constant();

  -- Quando o estado da caixa for fechado
  if _new.caixa_estado = _const.caixa_estado_fechado
    and _new.caixa_estado != _old.caixa_estado
  then
    update tweeks.posto cx
      set posto_estado = _const.posto_estado_fechado
      where posto_id = _new.caixa_posto_id
    ;
  end if;

  return null;
end;
$$;


--
-- TOC entry 720 (class 1255 OID 16800)
-- Name: tg_conta_after_update_adjust_venda_estado(); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.tg_conta_after_update_adjust_venda_estado() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  /** Esse trigger serve para ajustar o montante da caixa depois que uma conta for atualizada
  */
  _new tweeks.conta;
  _old tweeks.conta;
  _const map.constant;

  arg_venda_estado int2;
begin
  _const := map.constant();
  _new := new;
  _old := old;

  /**
    Atualizar o estado das vendas depois que a conta for atualizado
    O montante da caixa sera atualizado no momento que for feito o registro de amortizacao
    É nesse momento que um trigger de amortizacão atualizara tambem a conta{
      +> amortizacao
        => posto
        => conta
    }
   */

  -- prepar o novo estado para avenda
  if _old.conta_estado != _new.conta_estado and _old.conta_estado in (
    _const.conta_estado_aberto,
    _const.conta_estado_fechado
  ) and _new.conta_estado in (
    _const.conta_estado_fechado,
    _const.conta_estado_pago,
    _const.conta_estado_anulado
  ) then
    arg_venda_estado := case
      when _new.conta_estado = _const.conta_estado_fechado then _const.venda_estado_fechado
      when _new.conta_estado = _const.conta_estado_pago    then _const.venda_estado_fechado
      when _new.conta_estado = _const.conta_estado_anulado then _const.venda_estado_anulado
    end;

    -- fechar ou anular a venda da conta
    update tweeks.venda
      set venda_estado = arg_venda_estado
      where venda_conta_id = _old.conta_id
        and venda_estado != arg_venda_estado
        and venda_estado in (
          _const.venda_estado_aberto,
          _const.venda_estado_fechado
        );
  end if;

  return null;
end;
$$;


--
-- TOC entry 482 (class 1255 OID 16801)
-- Name: tg_retalho_after_insert_create_movimento(); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.tg_retalho_after_insert_create_movimento() RETURNS trigger
    LANGUAGE plpgsql
    AS $$

declare

    /** Esse trigger deve decrementar o valor do stock depois que um nova venda for registrado
     **/

    _new tweeks.retalho;
    _stock_retalho tweeks.stock;
    _stock_composto tweeks.stock;
    _artigo_retalho tweeks.artigo;
    _artigo_composto tweeks.artigo;
    _const map.constant;

begin

    _const := map.constant();
    _new := new;
    _artigo_retalho := tweeks._get_artigo( _new.retalho_artigo_retalho );
    _artigo_composto := tweeks._get_artigo( _new.retalho_artigo_composto );
    _stock_retalho := tweeks._get_stock( _artigo_retalho.artigo_id, _new.retalho_espaco_auth );
    _stock_composto := tweeks._get_stock( _artigo_composto.artigo_id, _new.retalho_espaco_auth );


    -- Debitar a quantidade a retalhar do artigo composto\
    perform rule.movimento_create(
            _new.retalho_espaco_auth,
            _new.retalho_colaborador_id,
            _stock_composto.stock_id,
            _const.toperacao_retalho,
            jsonb_build_object( 'retalho_id', _new.retalho_id ),
            _new.retalho_compostoquantidade,
            _const.tmovimento_debito,
            null,
            null,
            replace( to_char( _new.retalho_sequence, 'RT-0000-0000-0000/"C"' ), ' ', '' )
        );

    -- Debitar a quantidade a retalhar do artigo composto\
    perform rule.movimento_create(
            _new.retalho_espaco_auth,
            _new.retalho_colaborador_id,
            _stock_retalho.stock_id,
            _const.toperacao_retalho,
            jsonb_build_object( 'retalho_id', _new.retalho_id ),
            _new.retalho_retalhoquantidade,
            _const.tmovimento_credito,
            null,
            null,
            replace( to_char( _new.retalho_sequence, 'RT-0000-0000-0000/"R"' ), ' ', '' )
        );

    return null;
end;
$$;


--
-- TOC entry 711 (class 1255 OID 16802)
-- Name: tg_stock_after_update(); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.tg_stock_after_update() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Esse trigger atualiza o valor do stok total do artigo
   */
  _new tweeks.stock;
  _old tweeks.stock;
  arg_artigo_stock double precision;
  _const map.constant;
begin
  _const := map.constant();
  _new := new;
  _old := old;

  if _new.stock_quantidade != _old.stock_quantidade then
    arg_artigo_stock := (
      select sum( stt.stock_quantidade )
      from tweeks.stock stt
      where stt.stock_artigo_id = _old.stock_artigo_id
        and stt.stock_estado = _const.stock_estado_ativo
    );

    update tweeks.artigo
      set artigo_stock = coalesce( arg_artigo_stock, 0.0 )
      where artigo_id = _old.stock_artigo_id
    ;
  end if;


  return null;
end;
$$;


--
-- TOC entry 712 (class 1255 OID 16803)
-- Name: tg_stock_before_insert_or_update_check_quantidade(); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.tg_stock_before_insert_or_update_check_quantidade() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  /** Validadar a nova quantidade do artigo em stock*/
  _new tweeks.stock;
  _artigo tweeks.artigo;
  _espaco tweeks.espaco;
begin

  _new := new;
  _artigo := tweeks._get_artigo( _new.stock_artigo_id );
  _espaco := tweeks._get_espaco( _new.stock_espacao_id );



  if _new.stock_quantidade < 0 and not _artigo.artigo_stocknegativo then
    raise exception 'Operção rejeitada! A nova quantidade em stock do % em % inferior é de %s. Esse artigo não aceita stock negativo!',
      _artigo.artigo_nome,
      _espaco.espaco_nome,
      _new.stock_quantidade
    ;
  end if;

  return _new;
end;
$$;


--
-- TOC entry 593 (class 1255 OID 16804)
-- Name: tg_transacao_after_insert_adjust_posto_montante(); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.tg_transacao_after_insert_adjust_posto_montante() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  _new tweeks.transacao;
begin
  _new := new;

  -- Atualizar o valor no posto
  update tweeks.posto
    set posto_montante = _new.transacao_montantefinal
    where posto_id = _new.transacao_posto_id
  ;

  return null;
end;
$$;


--
-- TOC entry 713 (class 1255 OID 16805)
-- Name: tg_venda_after_insert_create_movimento(); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.tg_venda_after_insert_create_movimento() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  /** Esse trigger deve decrementar o valor do stock depois que um nova venda for registrado
   **/
  _new tweeks.venda;
  _stock tweeks.stock;
  _data record;
  _conta tweeks.conta;
  _const map.constant;
begin
  _const := map.constant();
  _new := new;
  _data := tweeks._get_conta( _new.venda_conta_id );
  _stock := tweeks._get_stock( _new.venda_artigo_id, _new.venda_espaco_auth );
  _conta := tweeks._get_conta( _new.venda_conta_id );

  perform rule.movimento_create(
    _new.venda_espaco_auth,
    _new.venda_colaborador_id,
    _stock.stock_id,
    _const.toperacao_venda,
    jsonb_build_object( 'venda_id', _new.venda_id ),
    _new.venda_quantidade,
    _const.tmovimento_debito,
    null,
    null,
    _conta.conta_numerofatura
  );

  return null;
end;
$$;


--
-- TOC entry 721 (class 1255 OID 16806)
-- Name: tg_venda_after_update_adjust_agrega_estado(); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.tg_venda_after_update_adjust_agrega_estado() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para ajustar os estados dos item extras agregado a venda depois que a venda for atualizado
  */
  _old tweeks.venda;
  _new tweeks.venda;
  _const map.constant;
  arg_agrega_estado int2;
begin
  _const := map.constant();
  _new:=new;
  _old:=old;

  -- Quando houver mudancas no estado de venda atualizar o estados nos itens agregado
  if _new.venda_estado != _old.venda_estado and _old.venda_estado in (
    _const.maguita_venda_estado_aberto,
    _const.maguita_venda_estado_fechado
  )  and _new.venda_estado in (
    _const.maguita_venda_estado_fechado,
    _const.maguita_venda_estado_anulado,
    _const.maguita_venda_estado_canselado
  ) then

    arg_agrega_estado := case
      when _new.venda_estado = _const.maguita_venda_estado_fechado then _const.maguita_venda_estado_fechado
      when _new.venda_estado = _const.maguita_venda_estado_canselado then _const.maguita_venda_estado_anulado
      when _new.venda_estado = _const.maguita_venda_estado_anulado then _const.maguita_venda_estado_anulado
    end;

    -- Todos os itens agregados a
    update tweeks.venda
      set venda_estado = arg_agrega_estado
      where venda_venda_id = _old.venda_id
        and venda_estado in (
          _const.maguita_venda_estado_fechado,
          _const.maguita_venda_estado_aberto
        );
  end if;

  return null;
end;
$$;


--
-- TOC entry 485 (class 1255 OID 16807)
-- Name: tg_venda_after_update_adjust_conta_montante(); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.tg_venda_after_update_adjust_conta_montante() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  /** Esse trigger serve para atualizar o montante de conta */
  _new tweeks.venda;
  _old tweeks.venda;
  _const map.constant;
begin

  _const := map.constant();
  _new := new;
  _old := old;

  -- raise exception 'ola works --11111';

  -- Quando o estada da venda for desativadao decrementar o valor
  if _old.venda_estado != _new.venda_estado and _new.venda_estado = _const.maguita_venda_estado_canselado then

    update tweeks.conta
      set conta_montante = conta_montante - coalesce( _old.venda_montantecomimposto, 0 )
      where conta_id  = _old.venda_conta_id
    ;

  -- Quando o valor do imposto para a venda for determinado então
  elseif _old.venda_montantecomimposto is null and _new.venda_montantecomimposto is not null then

    update tweeks.conta
      set conta_montante = conta_montante + _new.venda_montantecomimposto
      where conta_id = _old.venda_conta_id
    ;

  -- Quando o montante total da venda for atualizado
  elseif _old.venda_montantecomimposto != _new.venda_montantecomimposto then

    update tweeks.conta
      set conta_montante = conta_montante - coalesce( _old.venda_montantecomimposto, 0 ) + coalesce( _new.venda_montantecomimposto, 0 )
      where conta_id = _old.venda_conta_id
    ;
  end if;

  return null;
end;
$$;


--
-- TOC entry 714 (class 1255 OID 16808)
-- Name: tg_venda_after_update_create_or_cansel_movimento(); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.tg_venda_after_update_create_or_cansel_movimento() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para ajustar o stock do artigo depois que uma nova venda for inserida
  **/
  _new tweeks.venda;
  _old tweeks.venda;
  _conta tweeks.conta;
  _stock_old tweeks.stock;
  _stock_new tweeks.stock;
  _const map.constant;
begin
  _const := map.constant();
  _new := new;
  _old := old;
  _conta := tweeks._get_conta( _old.venda_conta_id );
  _stock_old := tweeks._get_stock( _old.venda_artigo_id, _old.venda_espaco_auth );
  _stock_new := tweeks._get_stock( _old.venda_artigo_id, _new.venda_espaco_auth );

  -- Se a quantidade de venda for atualizado ou a venda mover do espaço
    -- reverver o movemento do stock anterior e criar um novo movimento do stock
  if _old.venda_quantidade != _new.venda_quantidade
    or _old.venda_espaco_auth != _new.venda_espaco_auth
  then
    perform rule.movimento_revert(
      _old.venda_espaco_auth,
      coalesce( _new.venda_colaborador_atualizacao, _new.venda_colaborador_id ),
      _const.toperacao_venda,
      _const.tmovimento_debito,
      'venda_id',
      _old.venda_id::text,
      _const.movimento_estado_canselado,
      'Arigo removido da venda'
    );

    perform rule.movimento_create(
      _new.venda_espaco_auth,
      coalesce( _new.venda_colaborador_atualizacao, _new.venda_colaborador_id ),
      _stock_new.stock_id,
      _const.toperacao_venda,
      jsonb_build_object( 'venda_id', _new.venda_id ),
      _new.venda_quantidade,
      _const.tmovimento_debito,
      null,
      null,
      _conta.conta_numerofatura
    );
  end if;


  -- Se a venda for canselado da conta então repor o stock do produto inicial
  if _old.venda_estado in ( _const.maguita_venda_estado_fechado, _const.maguita_venda_estado_aberto )
    and _new.venda_estado in ( _const.maguita_venda_estado_canselado, _const.maguita_venda_estado_anulado )
  then
    perform rule.movimento_revert(
      _old.venda_espaco_auth,
      coalesce( _new.venda_colaborador_atualizacao, _new.venda_colaborador_id ),
      _const.toperacao_venda,
      _const.tmovimento_debito,
      'venda_id',
      _old.venda_id::text,
      _const.movimento_estado_canselado,
      'Arigo removido da venda'
    );

  -- Quando a quantidade do produto for atualizado na venda
  -- Canselar o movimento anterior e criar um novo movimento
  end if;

  return null;
end;
$$;


--
-- TOC entry 483 (class 1255 OID 16809)
-- Name: tipoimposto_referencia(uuid); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.tipoimposto_referencia(arg_tipoimposto_id uuid) RETURNS jsonb
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
select jsonb_build_object( 'tipoimposto_id', arg_tipoimposto_id );
$$;


--
-- TOC entry 243 (class 1259 OID 16810)
-- Name: transacao; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.transacao (
    transacao_id uuid NOT NULL,
    transacao_posto_id uuid NOT NULL,
    transacao_toperacao_id smallint NOT NULL,
    transacao_tmovimento_id smallint NOT NULL,
    transacao_espaco_auth uuid NOT NULL,
    transacao_colaborador_id uuid NOT NULL,
    transacao_colaborador_atualizacao uuid,
    transacao_referencia jsonb,
    transacao_documento character varying,
    transacao_zerar boolean NOT NULL,
    transacao_montante double precision NOT NULL,
    transacao_montanteinicial double precision NOT NULL,
    transacao_montantefinal double precision NOT NULL,
    transacao_observacao character varying,
    transacao_estado smallint DEFAULT (map.get('transacao_estado_ativo'::name))::smallint NOT NULL,
    transacao_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    transacao_dataatualizacao timestamp with time zone,
    _branch_uid uuid
);


--
-- TOC entry 5889 (class 0 OID 0)
-- Dependencies: 243
-- Name: TABLE transacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.transacao IS 'Essa entidade serve para registar todas as transações em um posto';


--
-- TOC entry 5890 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_id IS 'Identificador único da transação';


--
-- TOC entry 5891 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_posto_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_posto_id IS 'Identificador do posto o qual foi transacionado';


--
-- TOC entry 5892 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_toperacao_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_toperacao_id IS 'Identificador do tipo de operação';


--
-- TOC entry 5893 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_tmovimento_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_tmovimento_id IS 'Identificador do tipo de movimento o qual foi feito na transação';


--
-- TOC entry 5894 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_colaborador_id IS 'Identificador do colaborador responsável pelo registro do transacionamento';


--
-- TOC entry 5895 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_colaborador_atualizacao IS 'Identificador do colaborador responsável pela última atualização da transação';


--
-- TOC entry 5896 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_referencia; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_referencia IS 'Esse atribuito indica a referência da transação
<ul>
  <li> amortizacao_id: ID </li>
</ul>';


--
-- TOC entry 5897 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_documento; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_documento IS 'Corresponde ao documento usado para atranzação';


--
-- TOC entry 5898 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_zerar; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_zerar IS 'Esse atributo indica se a tranzação foi com intuito de zerar ou não';


--
-- TOC entry 5899 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_montante; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_montante IS 'Corresponde ao montante que foi transacionado';


--
-- TOC entry 5900 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_montanteinicial; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_montanteinicial IS 'Corresponde ao montente inicial antes da transação';


--
-- TOC entry 5901 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_montantefinal; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_montantefinal IS 'Corresponde ao montante final depois da transação';


--
-- TOC entry 5902 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_observacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_observacao IS 'Corresponde a uma observação para a transação';


--
-- TOC entry 5903 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_estado IS 'Corresponde ao estado da transação';


--
-- TOC entry 5904 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_dataregistro IS 'Corresponde ao instante em que a transação foi resgistrada no sistema';


--
-- TOC entry 5905 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN transacao.transacao_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transacao.transacao_dataatualizacao IS 'Corresponde ao instante em qua atransação foi atualizado pela última vez no sistema';


--
-- TOC entry 722 (class 1255 OID 16817)
-- Name: transacao_create(uuid, uuid, smallint, smallint, integer, double precision, character varying, jsonb, boolean, character varying); Type: FUNCTION; Schema: rule; Owner: -
--

CREATE FUNCTION rule.transacao_create(arg_espaco_auth uuid, arg_posto_id uuid, arg_toperacao_id smallint, arg_tmovimento_id smallint, arg_colaborador_id integer, arg_transacao_montante double precision, arg_transacao_documento character varying, arg_transacao_referencia jsonb DEFAULT NULL::jsonb, arg_transacao_zera boolean DEFAULT false, arg_transacao_observacao character varying DEFAULT NULL::character varying) RETURNS tweeks.transacao
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para registar as transações*/
  arg_transacao_montanteinicial double precision;
  arg_transacao_montantefinal double precision;
  _posto tweeks.posto;
  _const map.constant;
  _tmovimento tweeks.tmovimento;
  _transacao tweeks.transacao;

begin
  _const := map.constant();
  _posto := tweeks._get_posto( arg_posto_id );
  _tmovimento := tweeks._get_tmovimento( arg_tmovimento_id );


  -- Quando for para zerar o posto então o montante a debitar tem que ser o montante do posto
  arg_transacao_zera := coalesce( arg_transacao_zera, false );
  if arg_transacao_zera then
    arg_transacao_montante := _posto.posto_montante;
  end if;

  arg_transacao_montanteinicial := _posto.posto_montante;
  arg_transacao_montantefinal := _posto.posto_montante + ( _tmovimento.tmovimento_multiplo * arg_transacao_montante );

  insert into tweeks.transacao(
    transacao_posto_id,
    transacao_espaco_auth,
    transacao_toperacao_id,
    transacao_tmovimento_id,
    transacao_colaborador_id,
    transacao_referencia,
    transacao_documento,
    transacao_zerar,
    transacao_montante,
    transacao_montanteinicial,
    transacao_montantefinal,
    transacao_observacao
  ) values (
    arg_posto_id,
    arg_espaco_auth,
    arg_toperacao_id,
    arg_tmovimento_id,
    arg_colaborador_id,
    arg_transacao_referencia,
    arg_transacao_documento,
    arg_transacao_zera,
    arg_transacao_montante,
    arg_transacao_montanteinicial,
    arg_transacao_montantefinal,
    arg_transacao_observacao
  ) returning * into _transacao;

  return _transacao;
end;
$$;


--
-- TOC entry 865 (class 1255 OID 16818)
-- Name: ___override_auth_funct_autenticacao(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.___override_auth_funct_autenticacao(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa funcao serve para autenticar um colaborador
    no final da autenticacao sera devolvido as informacoes basica do colaborador
    args :{
      arg_auth_name: id | nif | email
      arg_auth_value: VALUE_OF_AUTH_NAME,
      arg_auth_method: senha | pin,
      arg_auth_key: VALUE_OF_AUTH_METHOD
    }
 */
  _auth record;
  espacos jsonb;
  ___branch tweeks.branch;
  _const map.constant;
begin
  _const := map.constant();

  select * into _auth
    from auth.funct_autenticacao( args );

  -- Quando o colaborador tiver accesso
  if _auth.colaborador_id is not null then
    ___branch := tweeks.__get_branch( tweeks.__branch_uid(
      _auth.colaborador_id
    ));

    if ___branch.branch_uid is not null then
      _auth.acesso := to_jsonb(array(
        select e.grants
          from auth.funct_load_grants(jsonb_build_object(
            'menus', ___branch.branch_grants->'menu',
            'colaborador_id', _auth.colaborador_id
          )) e( grants )
      ));
    end if;

    return query
      with __trabaha as (
          select array_agg( to_jsonb( tr ) || to_jsonb( es ) ) as espaco_trabalha
            from tweeks.trabalha tr
              inner join tweeks.espaco es on tr.trabalha_espaco_destino = es.espaco_id
                and tr.trabalha_colaborador_proprietario = _auth.colaborador_id
            where tr.trabalha_estado = _const.maguita_trabalha_estado_ativo
              and es.espaco_estado = _const.maguita_espaco_estado_ativo
      ) select jsonb_build_object(
            'auth', _auth,
            'espaco_trabalha', tr.espaco_trabalha
          )
        from __trabaha tr
      ;

    return query with
      __clusters as ( select c.cluster_uid, c.cluster_identifier, c.cluster_name, c.cluster_path  from cluster.cluster c ),
      __branch as (
        select
              b.branch_uid,
              b.branch_path,
              b.branch_clusters,
              b.branch_main_user,
              b.branch_main_workspace,
              b.branch_grants,
              b.branch_name,
              b.branch_licence,
              b.branch_state,
              b.branch_date,
              tb.tbranch_id,
              tb.tbranch_configs,
              tb.tbranch_name,
              e.espaco_id,
              e.espaco_nome,
              e.espaco_nivel,
              e.espaco_codigo,
              cmain.colaborador_id,
              cmain.colaborador_nome,
              cmain.colaborador_apelido,
              cmain.colaborador_email,
              cmain.colaborador_estado,
              cmain.colaborador_accesso,
              cmain.colaborador_tipo,
              array_agg( _clus ) as clusters

          from auth.colaborador cauth
            inner join cluster.branch b on cauth.colaborador_branch_uid = b.branch_uid
            inner join tweeks.tbranch tb on b.branch_tbranch_id = tb.tbranch_id
            inner join tweeks.espaco e on b.branch_uid = e.espaco_branch_uid
              and e.espaco_id = b.branch_main_workspace
            inner join auth.colaborador cmain on b.branch_uid = cmain.colaborador_branch_uid
              and cmain.colaborador_id = b.branch_main_user
            left join __clusters _clus on _clus.cluster_path = b.branch_path
              and ( b.branch_clusters is null or _clus.cluster_identifier = any( b.branch_clusters ) )
          where cauth.colaborador_id = _auth.colaborador_id
          group by
            cauth.colaborador_id,
            b.branch_uid,
            e.espaco_id,
            cmain.colaborador_id,
            tb.tbranch_id
      ) select to_jsonb( _b )
        from __branch _b;
  end if;
end;
$$;


--
-- TOC entry 792 (class 1255 OID 16819)
-- Name: ___override_auth_funct_load_grants(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.___override_auth_funct_load_grants(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    arg_colaborador_id: UID,
    arg_espaco_auth?: UID
   */
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  _branch tweeks.branch;
  _adminMenus jsonb;
begin
  _branch := tweeks.__get_branch( tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ));

  _adminMenus := _branch.branch_grants->'menu';

  if _branch.branch_uid is null then
    _adminMenus := to_jsonb(array(
      select me.menu_id
        from auth.menu me
        where me.menu_codigo in ( 'maguita.colaboradores', 'maguita.definicao' )
    ));
  end if;

  return query select *
    from auth.funct_load_grants( jsonb_build_object(
      'colaborador_id', arg_colaborador_id,
      'menus', _adminMenus
    ));
end;
$$;


--
-- TOC entry 793 (class 1255 OID 16820)
-- Name: ___override_auth_funct_load_menu(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.___override_auth_funct_load_menu(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_branch_uid: UID
    }
   */
  arg_branch_uid uuid default args->>'arg_branch_uid';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_id uuid default args->>'arg_espaco_id';
  _branch tweeks.branch;
  _menus int2[];
begin
  _branch := tweeks.__get_branch( arg_branch_uid );
  if _branch.branch_uid is null and arg_colaborador_id is not null then
    _branch := tweeks._get_branch_by_colaborador( arg_colaborador_id );
  end if;

  if _branch.branch_uid is null and arg_espaco_id is not null then
    _branch := tweeks._get_branch_by_colaborador( arg_espaco_id );
  end if;

  _menus := array( select e.text from jsonb_array_elements_text( _branch.branch_grants->'menu') e( text ) );

--   raise exception '%', args;

  return query with
                 __menu as (
                   select m.*
                   from auth.funct_load_menu( args ) as m
                   where menu_id = any( _menus )
                      or _branch.branch_uid is null
                 ) select to_jsonb( _m )
               from __menu _m;
end;
$$;


--
-- TOC entry 487 (class 1255 OID 16821)
-- Name: __artigo_has_stock(uuid, uuid, double precision); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__artigo_has_stock(arg_artigo_id uuid, arg_espaco_id uuid, arg_quantidadedebito double precision) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
declare
    /** Essa função serve para verificar se existe diponibilidade de um artig em um stock para cobrir uma quantidade de debito
     */
    _artigo tweeks.artigo;
    _stock record;
begin
    _artigo := tweeks._get_artigo( arg_artigo_id );

    -- Aceitar sempre que o artigo for do tipo staock negativo
    if _artigo.artigo_stocknegativo then return true; end if;

    select *
      from tweeks._get_stock( arg_artigo_id, arg_espaco_id )
      into _stock
    ;
    
    return _stock.stock_quantidade >= arg_quantidadedebito;
end;
$$;


--
-- TOC entry 244 (class 1259 OID 16822)
-- Name: menu; Type: TABLE; Schema: auth; Owner: -
--

CREATE TABLE auth.menu (
    menu_id smallint NOT NULL,
    menu_menu_id smallint,
    menu_codigo character varying NOT NULL,
    menu_raiz character varying NOT NULL,
    menu_nivel smallint NOT NULL,
    menu_icon character varying,
    menu_nome character varying NOT NULL,
    menu_link character varying,
    menu_estado smallint DEFAULT (map.get('menu_estado_ativo'::name))::smallint NOT NULL,
    menu_children smallint DEFAULT 0 NOT NULL,
    menu_maxnode smallint DEFAULT 0 NOT NULL,
    menu_directchildern smallint DEFAULT 0 NOT NULL,
    menu_position smallint DEFAULT 0 NOT NULL
);


--
-- TOC entry 5912 (class 0 OID 0)
-- Dependencies: 244
-- Name: TABLE menu; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON TABLE auth.menu IS 'Essa entidade serve para armazenar os menus de acesso';


--
-- TOC entry 5913 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN menu.menu_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.menu.menu_id IS 'Identificador único do menu do acesso';


--
-- TOC entry 5914 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN menu.menu_menu_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.menu.menu_menu_id IS 'Identificador do menu parente';


--
-- TOC entry 5915 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN menu.menu_codigo; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.menu.menu_codigo IS 'Código único do menu';


--
-- TOC entry 5916 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN menu.menu_raiz; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.menu.menu_raiz IS 'Indica a raiz do menu';


--
-- TOC entry 5917 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN menu.menu_nivel; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.menu.menu_nivel IS 'Corresponde ao nível do menu';


--
-- TOC entry 5918 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN menu.menu_icon; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.menu.menu_icon IS 'Indica o nível do menu (quanto parrente esse menu possui)';


--
-- TOC entry 5919 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN menu.menu_nome; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.menu.menu_nome IS 'Corresponde ao nome do menu';


--
-- TOC entry 5920 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN menu.menu_link; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.menu.menu_link IS 'Corresponde ao link do menu';


--
-- TOC entry 5921 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN menu.menu_estado; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.menu.menu_estado IS 'Corresponde ao estado do menu
<ul>
  <li> 1 - Ativo </li>
  <li> 0 - Desativo </li>
</ul>';


--
-- TOC entry 5922 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN menu.menu_children; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.menu.menu_children IS 'Indica a quantidade de submenus esse menu possui';


--
-- TOC entry 5923 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN menu.menu_maxnode; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.menu.menu_maxnode IS 'Indica a quantidade de node (entradas) maximas que se conseguira a partir desse menu
<br>Indica a distacncia dos filhos mais longe';


--
-- TOC entry 5924 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN menu.menu_directchildern; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.menu.menu_directchildern IS 'Indica a quantidade de filhos diretamente ligado a esse menu';


--
-- TOC entry 5925 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN menu.menu_position; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.menu.menu_position IS 'Indica a possição da ordem do menu';


--
-- TOC entry 794 (class 1255 OID 16832)
-- Name: __branch_menu(uuid, uuid, uuid, boolean); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__branch_menu(_branch_uid uuid DEFAULT NULL::uuid, _user uuid DEFAULT NULL::uuid, _espaco uuid DEFAULT NULL::uuid, _force boolean DEFAULT false) RETURNS SETOF auth.menu
    LANGUAGE plpgsql
    AS $$
declare
  _rec record;
  _branch tweeks.branch;
  _menus int[];
begin
  if _force then
    select array_agg( me.menu_id ) into _menus
      from auth.menu me
    ;
  else
    if _branch_uid is null then
      _branch_uid := tweeks.__branch_uid( _user, _espaco );
    end if;

    if _branch_uid is null then
      select
          b.*,
          count( * ) over () as _branchs_count
          into _rec
        from tweeks.branch b;
        if _rec._branchs_count = 1 then _branch_uid := _rec.branch_uid; end if;
    end if;

    _branch := tweeks.__get_branch( _branch_uid );
    _menus := array(
      select e.menu_id::int
        from jsonb_array_elements_text( _branch.branch_grants->'menu' ) e( menu_id )
    );
  end if;

  return query
    select me.*
      from auth.menu me
      where me.menu_id = any( _menus )
  ;
end;
$$;


--
-- TOC entry 486 (class 1255 OID 16833)
-- Name: __branch_uid(uuid, uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__branch_uid(_colaborador_uid uuid DEFAULT NULL::uuid, _espaco_uid uuid DEFAULT NULL::uuid) RETURNS uuid
    LANGUAGE sql
    AS $$
  select b.branch_uid
    from tweeks.branch b
      left join tweeks.espaco e on b.branch_uid = e.espaco_branch_uid
        and e.espaco_id = _espaco_uid
      left join auth.colaborador c on b.branch_uid = c.colaborador_branch_uid
        and c.colaborador_id = _colaborador_uid
    where coalesce ( _colaborador_uid, _espaco_uid ) is not null
      and ( e.espaco_branch_uid = c.colaborador_branch_uid
        or( _colaborador_uid is null and e.espaco_id is not null )
        or( _espaco_uid is null and c.colaborador_id is not null )
      )
$$;


--
-- TOC entry 904 (class 1255 OID 19844)
-- Name: __check_conta_data(integer, date, boolean); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__check_conta_data(_tserie_id integer, _conta_data date, _raise boolean) RETURNS text
    LANGUAGE plpgsql
    AS $$
declare 
  _data record;
  _tserie tweeks.tserie;
  _message text;
begin
    select max( ct.conta_data ) as conta_data
      from tweeks.conta ct 
      where ct.conta_tserie_id = _tserie_id 
        and ct.conta_data <= current_date
      into _data
    ;
    
    _data.conta_data := coalesce( _data.conta_data, _conta_data, current_date );
    
    select *
      from tweeks.tserie ts 
      where ts.tserie_id = _tserie_id
      into _tserie
    ;
    
    if _conta_data > current_date and _message is null then 
      _message :=  format( 'Data de emissão invalida para a operação! A data para a %I não pode ser superior a data atual!', _tserie.tserie_desc );
    end if;
    
    if _conta_data < _data.conta_data and _message is null then
      _message := format( 'Data de emissão invalida para a operação! A última data de emissão para %I foi de %I!', _tserie.tserie_desc, _data.conta_data );
    end if;
    
    if _raise and _message is not null then
        raise exception '%', _message;
    end if;
    
    return _message;
end;
$$;


--
-- TOC entry 795 (class 1255 OID 16834)
-- Name: __check_stock_on_venda(uuid, jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__check_stock_on_venda(_espaco_auth uuid, _vendas jsonb) RETURNS TABLE(stocks boolean, message text, items text, counts text)
    LANGUAGE plpgsql
    AS $$
declare
  _data record;
begin
  -- Garrantir que tenha o stock disponivel para os artigos
  with recursive __venda as (
    select
      ( e.document->>'venda_artigo_id' )::uuid as venda_artigo_id,
      ( e.document->>'venda_quantidade' )::double precision as venda_quantidade,
      ( e.document->>'venda_custounitario' )::double precision as venda_custounitario,
      ( e.document->>'venda_custoquantidade' )::double precision as venda_custoquantidade,
      ( e.document->'arg_itens' ) as itens
    from jsonb_array_elements( _vendas ) e( document )
    union all
      select
         ( e.document->>'venda_artigo_id' )::uuid as venda_artigo_id,
         ( e.document->>'venda_quantidade' )::double precision as venda_quantidade,
         ( e.document->>'venda_custounitario' )::double precision as venda_custounitario,
         ( e.document->>'venda_custoquantidade' )::double precision as venda_custoquantidade,
         ( null )::jsonb as itens
        from __venda v
          inner join jsonb_array_elements( v.itens ) e( document ) on true
        where jsonb_array_length( coalesce( v.itens, jsonb_build_array() ) ) > 0
  ), __venda_group as (
      select
          v.venda_artigo_id,
          sum( v.venda_quantidade ) as venda_quantidade
        from __venda v
        group by v.venda_artigo_id
  ) select
      count( art.artigo_id ) as items_count,
      string_agg( art.artigo_nome, ', ' ) as items
      into _data
    from __venda_group vds
       inner join tweeks.artigo art on  vds.venda_artigo_id = art.artigo_id
       inner join tweeks._get_stock( art.artigo_id, _espaco_auth ) s on true
    where not  art.artigo_stocknegativo
      and not tweeks.__artigo_has_stock( art.artigo_id, _espaco_auth, vds.venda_quantidade )
  ;
  __check_stock_on_venda.stocks := _data.items_count = 0;
  __check_stock_on_venda.counts := _data.items_count;
  __check_stock_on_venda.items := _data.items;
  if _data.items_count > 1 then
    __check_stock_on_venda.message := format( 'Os stock dos produtos (%s) não cobrem a venda para essa conta', _data.items );
  elseif _data.items_count = 1 then
    __check_stock_on_venda.message := format( 'Os stock de %s não cobre a venda para essa conta', _data.items );
  end if;
  return next;
end;
$$;


--
-- TOC entry 726 (class 1255 OID 16835)
-- Name: __cluster_filter_branch(character varying, cluster.object, cluster.collector, cluster.cluster, cluster.cluster); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__cluster_filter_branch(share character varying, _object cluster.object, _collector cluster.collector, _cluster cluster.cluster, _origin cluster.cluster) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
declare
  _rec record;
  _branch tweeks.branch;
  _class regclass[] default array[
    'auth.colaborador'::regclass,
    'auth.acesso'::regclass,
    'tweeks.branch'::regclass,
    'tweeks.espaco'::regclass,
    'tweeks.cambio'::regclass,
    'tweeks.trabalha'::regclass
  ]::regclass[];
begin

  if share::regclass != all( _class ) then return true; end if;

  if share::regclass = 'tweeks.branch'::regclass then
    _branch := jsonb_populate_record( _branch, _collector.collector_metadata );

  --- Obter os branch dos registros
  elsif share::regclass = 'auth.colaborador'::regclass then
    _rec := jsonb_populate_record( null::auth.colaborador, _collector.collector_metadata );
    select * into _branch
      from tweeks.branch b
      where b.branch_uid = _rec.colaborador_branch_uid
    ;

  elsif share::regclass = 'auth.acesso'::regclass then
    _rec := jsonb_populate_record( null::auth.acesso, _collector.collector_metadata );
    select b.* into _branch
      from tweeks.branch b
        inner join auth.colaborador co on co.colaborador_branch_uid = b.branch_uid
      where co.colaborador_id = _rec.acesso_colaborador_propetario
    ;

  elsif share::regclass = 'tweeks.espaco'::regclass then
    _rec := jsonb_populate_record( null::tweeks.espaco, _collector.collector_metadata );
    select * into _branch
      from tweeks.branch b
      where b.branch_uid = _rec.espaco_branch_uid
    ;

  elsif share::regclass = 'tweeks.trabalha'::regclass then

    _rec := jsonb_populate_record( null::tweeks.trabalha, _collector.collector_metadata );
    select * into _branch
      from tweeks.branch br
        inner join tweeks.espaco e on br.branch_uid = e.espaco_branch_uid
      where e.espaco_id = _rec.trabalha_espaco_destino
    ;

  elsif share::regclass = 'tweeks.cambio'::regclass then

    _rec := jsonb_populate_record( null::tweeks.cambio, _collector.collector_metadata );
    select * into _branch
      from tweeks.branch br
        inner join tweeks.espaco e on br.branch_uid = e.espaco_branch_uid
      where e.espaco_id = _rec.cambio_espaco_auth
    ;
  end if;

  if share::regclass = 'tweeks.branch'::regclass then

    if _branch.branch_path is null then return false; end if;

    if _branch.branch_path != _cluster.cluster_path
        and not cluster.__is_sub_path( _branch.branch_path, _cluster.cluster_path )
    then return false;

    end if;

    if cluster.__is_sub_path( _cluster.cluster_path, _branch.branch_path ) then return true; end if;
    if cluster.__is_sub_path( _cluster.cluster_path, _branch.branch_path ) then return true; end if;

  end if;
  return true;
end;
$$;


--
-- TOC entry 798 (class 1255 OID 16836)
-- Name: __conta_adjust(uuid, uuid, map.constant); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__conta_adjust(arg_cliente_id uuid, arg_conta_id uuid DEFAULT NULL::uuid, _const map.constant DEFAULT map.constant()) RETURNS TABLE(conta_id uuid, conta_montante double precision, conta_montanteamortizado double precision, conta_montantependente double precision, conta_pago boolean, conta_pagamento smallint)
    LANGUAGE plpgsql
    AS $$
declare
  _balanco record;
begin
  select
      coalesce( sum( d.deposito_montantefinal ), 0.0 ) as deposito_montantefinal
      into _balanco
    from tweeks.deposito d
    where d.deposito_cliente_id = arg_cliente_id
      and d.deposito_estado = _const.maguita_deposito_estado_ativo
  ;

  return query
  with recursive __conta as (
    select
        row_number() over () as conta_posicao,
        ct.conta_id,
        ct.conta_montante,
        ct.conta_datafecho,
        ct.conta_dataregistro
      from tweeks.conta ct
      where ct.conta_cliente_id = arg_cliente_id
        and ct.conta_estado in (
          _const.maguita_conta_estado_fechado
        )
      order by ct.conta_datafecho,
        ct.conta_numero,
        ct.conta_dataregistro
  ), __ajuste as (
    select
      _ct.*,
        _balanco.deposito_montantefinal as deposito_montante,
        arg_conta_id is not null and _ct.conta_id = arg_conta_id as conta_find,
        case
          when _balanco.deposito_montantefinal >= _ct.conta_montante then _ct.conta_montante
          when _balanco.deposito_montantefinal > 0 then _balanco.deposito_montantefinal
          else 0
        end as conta_montanteamortizado,
        case
          when _balanco.deposito_montantefinal >= _ct.conta_montante then _balanco.deposito_montantefinal - _ct.conta_montante
          else 0
        end as deposito_restante
      from __conta _ct
      where _ct.conta_posicao = 1
    union all
      select
          _ct.*,
          _balanco.deposito_montantefinal as deposito_montante,
          arg_conta_id is not null and _ct.conta_id = arg_conta_id as conta_find,
          case
            when _aj.deposito_restante >= _ct.conta_montante then _ct.conta_montante
            when _aj.deposito_restante > 0 then _aj.deposito_restante
            else 0
          end as conta_montanteamortizado,
          case
            when _aj.deposito_restante >= _ct.conta_montante then _aj.deposito_restante - _ct.conta_montante
            else 0
          end as deposito_restante
        from __conta _ct
          inner join __ajuste _aj on _ct.conta_posicao + 1 = _aj.conta_posicao
        where not _aj.conta_find
  ) select
        _aj.conta_id,
        _aj.conta_montante,
        _aj.conta_montanteamortizado,
        _aj.conta_montante - _aj.conta_montanteamortizado,
        _aj.conta_montante = _aj.conta_montanteamortizado,
        case
          when _aj.conta_montanteamortizado = 0 then 2
          when _aj.conta_montanteamortizado > 0 and _aj.conta_montanteamortizado < _aj.conta_montante then 1
          else 0
        end::int2 as conta_pagamento
      from __ajuste _aj
      where _aj.conta_id = coalesce( arg_conta_id, _aj.conta_id )
  ;
end;
$$;


--
-- TOC entry 895 (class 1255 OID 19753)
-- Name: __fluxo_scan(uuid, uuid, boolean, uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__fluxo_scan(_artigo_id uuid DEFAULT NULL::uuid, _espaco_id uuid DEFAULT NULL::uuid, _resume boolean DEFAULT true, _branch uuid DEFAULT NULL::uuid) RETURNS TABLE(fluxo_artigo_id uuid, fluxo_espaco_id uuid, fluxo_preview double precision, fluxo_resultado double precision, fluxo_checkmarks uuid, fluxo_check double precision, fluxo_order bigint, fluxo_end bigint, fluxo_resume boolean, fluxo_credito double precision, fluxo_debito double precision, fluxo_calc double precision, fluxo_quantidade double precision, fluxo_id uuid, fluxo_date timestamp with time zone, fluxo_sequencia bigint)
    LANGUAGE sql
    AS $$
with recursive
  __map as ( select maguita_fluxo_estado_ativo, maguita_fluxo_estado_fechado, maguita_fluxo_estado_anulado from map.constant()

  ), __espaco as (
    select a.espaco_id
      from tweeks.espaco a
      where a.espaco_id = coalesce( _espaco_id, a.espaco_id )
      and a._branch_uid = coalesce( _branch, a._branch_uid )
  ), __artigo as (
    select a.artigo_id
      from tweeks.artigo a
      where a.artigo_id = coalesce( _artigo_id, a.artigo_id )
      and a._branch_uid = coalesce( _branch, a._branch_uid )
 ), __stock_point as(
    select
      a.artigo_id,
      e.espaco_id,
      mode() within group ( order by f.fluxo_dataregistro desc ) as point
    from tweeks.fluxo f
      inner join __map _const on f.fluxo_estado = _const.maguita_fluxo_estado_ativo
      inner join __artigo a on a.artigo_id in ( f.fluxo_artigo_in, f.fluxo_artigo_out )
      inner join __espaco e on e.espaco_id in ( f.fluxo_espaco_in, f.fluxo_espaco_out )
    where f.fluxo_checkpoint = 0
      and f._branch_uid = coalesce( _branch, f._branch_uid )
      and f.fluxo_estado = _const.maguita_fluxo_estado_ativo
    group by a.artigo_id,
      e.espaco_id
  ),
  __fluxo as (
    select
      a.artigo_id,
      e.espaco_id,
      f.fluxo_id,
      f.fluxo_dataregistro,
      f.fluxo_sequencia,
      f.fluxo_checkpoint,
      case
        when e.espaco_id = f.fluxo_espaco_in and a.artigo_id = f.fluxo_artigo_in then f.fluxo_quantidadein
        else 0
        end as fluxo_credito,
      case
        when e.espaco_id = f.fluxo_espaco_out and a.artigo_id = f.fluxo_artigo_out then f.fluxo_quantidadeout
        else 0
        end as fluxo_debito,
      case
        when f.fluxo_quantidadefinal is not null then f.fluxo_quantidadefinal
        when e.espaco_id = f.fluxo_espaco_in and a.artigo_id = f.fluxo_artigo_in then f.fluxo_quantidadein * 1
        when e.espaco_id = f.fluxo_espaco_out and a.artigo_id = f.fluxo_artigo_out then f.fluxo_quantidadeout * -1
        end as fluxo_quantidade,
      row_number() over ( partition by a.artigo_id, e.espaco_id ) as fluxo_order,
      count( f.fluxo_id ) over ( partition by a.artigo_id, e.espaco_id ) as fluxo_end

    from tweeks.fluxo f
      inner join __map _const on f.fluxo_estado = _const.maguita_fluxo_estado_ativo
      inner join __artigo a on a.artigo_id in ( f.fluxo_artigo_in, f.fluxo_artigo_out )
      inner join __espaco e on e.espaco_id in ( f.fluxo_espaco_in, f.fluxo_espaco_out )
      left join __stock_point _sp on _sp.artigo_id = a.artigo_id and _sp.espaco_id = e.espaco_id
    where  f.fluxo_dataregistro >= coalesce( _sp.point, f.fluxo_dataregistro )
      and f._branch_uid = coalesce( _branch, f._branch_uid )
    order by a.artigo_id,
      e.espaco_id,
      f.fluxo_dataregistro,
      f.fluxo_sequencia
  ), __fluxo_stock as (
  select
    _f.artigo_id,
    _f.espaco_id,
    _f.fluxo_order,
    _f.fluxo_end,
    _f.fluxo_credito,
    _f.fluxo_debito,
    _f.fluxo_quantidade,
    _f.fluxo_id,
--     _f.fluxo_dataregistro,
--     _f.fluxo_sequencia,

    _f.fluxo_quantidade as fluxo_resultado,
    0.0::double precision as fluxo_preview,
--     _f.fluxo_id as fluxo_checkmarks,
--     _f.fluxo_quantidade as fluxo_checkquant,
    _f.fluxo_order = _f.fluxo_end as fluxo_resume
  from __fluxo _f
    inner join __map _const on true
  where _f.fluxo_order = 1
  union all
  select
    _f.artigo_id,
    _f.espaco_id,
    _f.fluxo_order,
    _f.fluxo_end,
    _f.fluxo_credito,
    _f.fluxo_debito,
    _f.fluxo_quantidade,
    _f.fluxo_id,
--     _f.fluxo_dataregistro,
--     _f.fluxo_sequencia,
    
    ( _fs.fluxo_resultado * _f.fluxo_checkpoint ) + ( _f.fluxo_quantidade ),
    _fs.fluxo_resultado as fluxo_priview,
--     case
--       when _f.fluxo_checkpoint = 0 then _f.fluxo_id
--       else _fs.fluxo_checkmarks
--       end,
--     case
--       when _f.fluxo_checkpoint = 0 then _f.fluxo_quantidade
--       else _fs.fluxo_checkquant
--       end,
    _f.fluxo_order = _f.fluxo_end as fluxo_resume

  from __fluxo_stock _fs
    inner join __fluxo _f on _fs.espaco_id = _f.espaco_id
        and _fs.artigo_id = _f.artigo_id
        and _fs.fluxo_order +1 = _f.fluxo_order
) select
    _fs.artigo_id as stock_artigo_id,
    _fs.espaco_id as stock_espaco_id,
    _fs.fluxo_preview,
    _fs.fluxo_resultado,

    null::uuid as fluxo_checkmarks,--     _fs.fluxo_checkmarks,
    null::double precision as fluxo_checkquant, --     _fs.fluxo_checkquant,
    _fs.fluxo_order,
    _fs.fluxo_end,
    _fs.fluxo_resume,

    _fs.fluxo_credito,
    _fs.fluxo_debito,
    _fs.fluxo_credito - _fs.fluxo_debito,
    _fs.fluxo_quantidade,
    _fs.fluxo_id,
    null::timestamptz, ---_fs.fluxo_dataregistro,
    null::int8 -- _fs.fluxo_sequencia
from __fluxo_stock _fs
where true in (
    coalesce( _resume, true ) = _fs.fluxo_resume,
    not _resume
  )
$$;


--
-- TOC entry 896 (class 1255 OID 19761)
-- Name: __fluxo_stock(uuid, uuid, uuid, uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__fluxo_stock(_artigo_uid uuid DEFAULT NULL::uuid, _espaco_uid uuid DEFAULT NULL::uuid, _classe_uid uuid DEFAULT NULL::uuid, _branch uuid DEFAULT NULL::uuid) RETURNS TABLE(espaco_id uuid, artigo_id uuid, stock_quantidade double precision)
    LANGUAGE sql
    AS $$
    with  __artigo as (
      select a.artigo_id
        from tweeks.artigo a
      where a.artigo_id = coalesce( _artigo_uid, a.artigo_id )
        and a.artigo_classe_id = coalesce( _classe_uid, a.artigo_classe_id )
        and a._branch_uid = coalesce( _branch, a._branch_uid )
        and not a.artigo_stocknegativo
    ), __espaco as (
      select e.espaco_id
        from tweeks.espaco e
        where e.espaco_id = coalesce( _espaco_uid, e.espaco_id )
          and e._branch_uid = coalesce( _branch, e._branch_uid )
    ), __fluxo as (
      select
          a.artigo_id,
          e.espaco_id,
          f.fluxo_id,
          f.fluxo_sequencia,
          f.fluxo_dataregistro,
          f.fluxo_quantidadefinal,
          f.fluxo_quantidadein,
          f.fluxo_quantidadeout,
          f.fluxo_artigo_in as artigo_in,
          f.fluxo_artigo_out as artigo_out,
          f.fluxo_espaco_out as espaco_out,
          f.fluxo_espaco_in as espaco_in,
          f.fluxo_checkpoint
        from tweeks.fluxo f
          inner join __espaco e on e.espaco_id  in ( f.fluxo_espaco_in, f.fluxo_espaco_out)
          inner join __artigo a on a.artigo_id in ( f.fluxo_artigo_in, f.fluxo_artigo_out )
        where f._branch_uid = coalesce( _branch, f._branch_uid )
    ), __check_point as (
      select
          f.artigo_id,
          f.espaco_id,
          f.fluxo_id,
          f.fluxo_dataregistro,
          f.fluxo_quantidadefinal,
          rank() over ( partition by f.artigo_id, f.espaco_id order by f.fluxo_dataregistro desc , f.fluxo_sequencia desc ) as fluxo_rank
        from __fluxo f
        where f.fluxo_checkpoint = 0
    ), __sumary as (
      select
        f.artigo_id,
        f.espaco_id,
        coalesce(
            sum( f.fluxo_quantidadein ) filter ( where f.artigo_id = f.artigo_in and f.espaco_id = f.espaco_in ),
            0
        ) + coalesce( cp.fluxo_quantidadefinal, 0.0 ) as credito,
        coalesce(
            sum( f.fluxo_quantidadeout ) filter ( where f.artigo_id = f.artigo_out and f.espaco_id = f.espaco_out ),
            0
        ) + coalesce( cp.fluxo_quantidadefinal, 0.0 ) as debigo
      from __fluxo f
        left join __check_point cp on  f.artigo_id = cp.artigo_id
          and f.espaco_id = cp.espaco_id
          and cp.fluxo_rank = 1
        where (f.fluxo_dataregistro > cp.fluxo_dataregistro)
           or cp.fluxo_id is null
        group by
          f.artigo_id,
          f.espaco_id,
          cp.fluxo_quantidadefinal
    ) select
          s.espaco_id,
          s.artigo_id,
          s.credito - s.debigo as stock
        from __sumary s
    ;
  $$;


--
-- TOC entry 488 (class 1255 OID 16838)
-- Name: __generate_acerto_code(uuid, uuid, uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__generate_acerto_code(brc uuid, user_brc uuid DEFAULT NULL::uuid, space_brc uuid DEFAULT NULL::uuid) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
declare
  _cluster cluster.cluster;
  _code character varying;
  _len int default 6;
begin
  _cluster := cluster._get_cluster_local();
  brc := coalesce( brc, tweeks.__branch_uid( user_brc, space_brc ));

  while _code is null loop
      _code := cluster.next( 'acerto.code/seq', sub := brc::text, lpad := _len, lpad_char := '0' );
      if( exists(
          select *
          from tweeks.acerto c
          where c.acerto_codigo = _code
            and c._branch_uid = coalesce( brc, c._branch_uid )
        )) then
        _code := null;
      end if;
    end loop;
  return _code;
end;
$$;


--
-- TOC entry 729 (class 1255 OID 16839)
-- Name: __generate_artigo_code(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__generate_artigo_code(arg_classe_id uuid) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
declare
  _classe tweeks.classe;
  _cluster cluster.cluster;
  code character varying;
begin
  _cluster := cluster._get_cluster_local();

  while code is null loop
    update tweeks.classe
      set classe_lastcodigo = classe.classe_lastcodigo +1
      where classe_id = arg_classe_id
      returning * into _classe
    ;

    code := lib.str_nospace( format( '%s%s%s',
      _cluster.cluster_code,
      "right"( _classe.classe_codigo, 2 ),
      greatest( _classe.classe_codigo::text, lpad( _classe.classe_codigo, 2, '0') )
    ));

    if( exists(
      select *
        from tweeks.artigo a
        where a.artigo_codigo = code
          and a._branch_uid = _classe._branch_uid
    )) then code := null; end if;
  end loop;

  return code;
end;
$$;


--
-- TOC entry 727 (class 1255 OID 16840)
-- Name: __generate_caixa_code(uuid, uuid, uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__generate_caixa_code(brc uuid, user_brc uuid DEFAULT NULL::uuid, space_brc uuid DEFAULT NULL::uuid) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
declare
  _cluster cluster.cluster;
  _code character varying;
  _len int default 6;
begin
  _cluster := cluster._get_cluster_local();
  brc := coalesce( brc, tweeks.__branch_uid( user_brc, space_brc ));

  while _code is null loop
      _code := cluster.next( 'caixa.code/seq', sub := brc::text, lpad := _len, lpad_char := '0' );
      if( exists(
          select *
          from tweeks.caixa c
          where c.caixa_code = _code
            and c._branch_uid = coalesce( brc, c._branch_uid )
        )) then
        _code := null;
      end if;
    end loop;
  return _code;
end;
$$;


--
-- TOC entry 489 (class 1255 OID 16841)
-- Name: __generate_classe_code(uuid, uuid, uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__generate_classe_code(brc uuid, user_brc uuid, space_brc uuid) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
declare
  _cluster cluster.cluster;
  _code character varying;
  _len int default 3;
begin
  _cluster := cluster._get_cluster_local();
  brc := coalesce( brc, tweeks.__branch_uid( user_brc, space_brc ));

  while _code is null loop
    _code := cluster.next( 'artigo.code/seq', sub := brc::text, lpad := _len, lpad_char := '0' );
    if( exists(
      select *
        from tweeks.classe c
        where c.classe_codigo = _code
          and c._branch_uid = coalesce( brc, c._branch_uid )
    )) then
      _code := null;
    end if;
  end loop;

  return _code;
end;
$$;


--
-- TOC entry 799 (class 1255 OID 16842)
-- Name: __generate_cliente_code(uuid, uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__generate_cliente_code(colaborador uuid, espaco uuid) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
declare
  code character varying;
  repeate integer default 0;
  codeLen integer default 4;
  _cluster cluster.cluster;
  _branch uuid default tweeks.__branch_uid( colaborador, espaco );
begin
  _cluster := cluster._get_cluster_local();

  while code is null loop
      code := cluster.next( 'client/seq', lpad := codeLen, lpad_char := '0', sub := _branch::text  );
    if exists(
        select *
          from tweeks.cliente c
          where  code = c.cliente_code
    ) then
      code := null;
    end if;
    repeate := repeate +1;
  end loop;
  return code;
end;
$$;


--
-- TOC entry 860 (class 1255 OID 19568)
-- Name: __generate_fornecedor_code(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__generate_fornecedor_code(_branch uuid) RETURNS text
    LANGUAGE plpgsql
    AS $$
declare
  __fornecedor_code text;
begin
  while __fornecedor_code is null loop
      __fornecedor_code := cluster.next( 'fornecedor/seq', lpad := 2, lpad_char := '0', sub :=  _branch::text );
      if exists(
          select *
          from tweeks.fornecedor f
          where f.fornecedor_code = __fornecedor_code
        ) then
        __fornecedor_code := null;
      end if;
    end loop;

  return  __fornecedor_code;
end;
$$;


--
-- TOC entry 862 (class 1255 OID 19570)
-- Name: __generate_guia_code(uuid, integer); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__generate_guia_code(_branch uuid, toperacao_id integer) RETURNS text
    LANGUAGE plpgsql
    AS $$
declare
  __guia_code text;
begin
    while __guia_code is null loop
        __guia_code := cluster.next( format( 'guia|%s', toperacao_id ), sub := _branch::text, lpad := 4, lpad_char := '0' );
        if exists(
            select *
            from tweeks.guia g
            where g.guia_numero = __guia_code
              and g.guia_toperacao_id = toperacao_id
              and g._braunc_uid = _branch
          ) then
          __guia_code := null;
        end if;
      end loop;
    return  __guia_code;
  end;
$$;


--
-- TOC entry 495 (class 1255 OID 19572)
-- Name: __generate_posto_chave(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__generate_posto_chave() RETURNS text
    LANGUAGE plpgsql
    AS $_$
    declare
      chars character varying default 'abcdefghijklmnopqrstuvwxyz'||upper('abcdefghijklmnopqrstuvwxyz')||'0123456789'||'$#%';
      _posto_chave varchar;
    begin
      _posto_chave := lib.dset_random_text( chars, (2^8)::int )::character varying;
      return _posto_chave;
    end;
    $_$;


--
-- TOC entry 490 (class 1255 OID 16843)
-- Name: __generate_retalho_code(uuid, uuid, uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__generate_retalho_code(brc uuid, user_brc uuid DEFAULT NULL::uuid, space_brc uuid DEFAULT NULL::uuid) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
declare
  _cluster cluster.cluster;
  _code character varying;
  _len int default 6;
begin
  _cluster := cluster._get_cluster_local();
  brc := coalesce( brc, tweeks.__branch_uid( user_brc, space_brc ));

  while _code is null loop
      _code := cluster.next( 'retalho.code/seq', sub := brc::text, lpad := _len, lpad_char := '0' );
      if( exists(
          select *
          from tweeks.retalho c
          where c.retalho_codigo = _code
            and c._branch_uid = coalesce( brc, c._branch_uid )
        )) then
        _code := null;
      end if;
    end loop;
  return _code;
end;
$$;


--
-- TOC entry 365 (class 1259 OID 19693)
-- Name: autorizacao; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.autorizacao (
    autorizacao_uid uuid DEFAULT gen_random_uuid() NOT NULL,
    autorizacao_colaborador_uid uuid NOT NULL,
    autorizacao_colaborador_atualizacao uuid,
    autorizacao_espaco_auth uuid NOT NULL,
    autorizacao_espaco_uid uuid NOT NULL,
    autorizacao_designacao character varying NOT NULL,
    autorizacao_ano integer NOT NULL,
    autorizacao_numero character varying,
    autorizacao_estado smallint DEFAULT (map.get('maguita_autorizacao_estado_ativo'::name))::smallint NOT NULL,
    autorizacao_dataregistro timestamp without time zone DEFAULT now() NOT NULL,
    autorizacao_dataatualizacao timestamp without time zone,
    _branch_uid uuid NOT NULL
);


--
-- TOC entry 802 (class 1255 OID 19716)
-- Name: __get_autorizacao(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__get_autorizacao(uuid) RETURNS tweeks.autorizacao
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
    select * from tweeks.autorizacao where autorizacao_uid = $1;
$_$;


--
-- TOC entry 245 (class 1259 OID 16844)
-- Name: branch; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.branch (
    branch_uid uuid DEFAULT gen_random_uuid() NOT NULL,
    branch_tbranch_id smallint NOT NULL,
    branch_name character varying NOT NULL,
    branch_path character varying NOT NULL,
    branch_user jsonb,
    branch_workspace jsonb,
    branch_licence jsonb,
    branch_grants jsonb,
    branch_main_user uuid,
    branch_main_workspace uuid,
    branch_clusters character varying[] NOT NULL,
    branch_date timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    branch_update timestamp with time zone,
    branch_state smallint,
    _branch_uid uuid GENERATED ALWAYS AS (branch_uid) STORED
);


--
-- TOC entry 491 (class 1255 OID 16852)
-- Name: __get_branch(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__get_branch(uuid) RETURNS cluster.branch
    LANGUAGE sql
    AS $_$select * from tweeks.branch b where b.branch_uid = $1 $_$;


--
-- TOC entry 246 (class 1259 OID 16853)
-- Name: serie; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.serie (
    serie_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    serie_sequencia bigint DEFAULT 0 NOT NULL,
    serie_tserie_id smallint NOT NULL,
    serie_espaco_id uuid NOT NULL,
    serie_espaco_auth uuid NOT NULL,
    serie_colaborador_id uuid NOT NULL,
    serie_colaborador_atualizacao uuid,
    serie_designacao character varying NOT NULL,
    serie_numero character varying NOT NULL,
    serie_quantidade integer NOT NULL,
    serie_estado smallint DEFAULT (map.get('maguita_serie_estado_ativo'::name))::smallint NOT NULL,
    serie_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    serie_dataatualizacao timestamp with time zone,
    _branch_uid uuid,
    serie_numatorizacao character varying,
    serie_numcertificacao character varying,
    serie_autorizacao_uid uuid,
    serie_fechoautorizacao boolean DEFAULT false NOT NULL
);


--
-- TOC entry 492 (class 1255 OID 16862)
-- Name: __get_serie_espaco(uuid, integer); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__get_serie_espaco(arg_espaco_auth uuid, arg_tserie integer) RETURNS SETOF tweeks.serie
    LANGUAGE plpgsql STRICT
    AS $$
declare
    _const map.constant;
begin
    return query
    select * from tweeks.serie s
    where s.serie_espaco_id = arg_espaco_auth::uuid
      and s.serie_tserie_id = arg_tserie::int2
    limit 1;
end;
$$;


--
-- TOC entry 730 (class 1255 OID 16863)
-- Name: __infinity_loop(tweeks.espaco); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__infinity_loop(_espaco tweeks.espaco) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
declare
  __loop record;
begin
  with recursive __espaco as (
    select
        e.espaco_id,
        e.espaco_espaco_id,
        e.espaco_nome,
        _espaco.espaco_id as find
      from tweeks.espaco e
  ), __infinite_lop as (
    select e.*, array[]::uuid[] as family from __espaco e
    union all
      select _es.*, _c.family || _es.espaco_id
        from __espaco _es
          inner join __infinite_lop _c on _es.espaco_id = _c.espaco_espaco_id
        where _es.espaco_id != all( _c.family )
  ) select * into __loop
    from __infinite_lop c
    where c.espaco_id  = c.find
      and c.espaco_id = any( c.family )
  ;

  if __loop.espaco_id is null then __loop := null; end if;
  return to_jsonb( __loop );

end;
$$;


--
-- TOC entry 493 (class 1255 OID 16864)
-- Name: __lancamento_regularizacao(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__lancamento_regularizacao(args jsonb DEFAULT NULL::jsonb) RETURNS TABLE(ordem bigint, ordem_grupo bigint, cd character varying, credito double precision, debito double precision, valor double precision, entrada double precision, saldo double precision, resumo boolean, acomulacao double precision, regula_acumulacao double precision, regula_montante double precision, regula numeric[], regula_id uuid[], regula_refid uuid[], cliente_id uuid, tgrupo_id smallint, lancamento_id uuid, lancamento_refid uuid, lancamento_ref jsonb, lancamento_class character varying, lancamento_doc character varying, lancamento_data date, lancamento_time timestamp with time zone, lancamento_sequencia bigint)
    LANGUAGE plpgsql
    AS $$
declare
    arg_cliente_id uuid default args->>'cliente_id';
    arg_tgropu_id int2 default args->>'tgrupo_id';
    arg_branch_uid uuid default args->>'_braunc_uid';
    arg_resumo boolean default args->>'resumo';
  begin
    arg_resumo := coalesce( arg_resumo, false );
    return query
      with recursive _const as ( select * from map.constant() ),
        __lancamento as (
        select
            row_number() over ( partition by la.lancamento_cliente_id, la._branch_uid, la._tgrupo_id order by la.lancamento_dataregistro, la.lancamento_sequencia ) as ordem,
            count(*) over ( partition by la.lancamento_cliente_id, la._branch_uid, la._tgrupo_id) as counts,
            la.lancamento_valor * la.lancamento_operacao as entrada,
            la.lancamento_valor as valor,
            la.lancamento_credito as credito,
            la.lancamento_debito as debito,
            la.lancamento_cliente_id as cliente,
            la._tgrupo_id as grupo,
            la._branch_uid as branch,
            la.lancamento_id as id,
            la.lancamento_refid as refid,
            case
              when la.lancamento_operacao = -1 then 'D'
              when la.lancamento_operacao = 1 then 'C'
            end::character varying as cd,
            la as _lan
          from tweeks.lancamento la
            inner join _const _c on la.lancamento_estado = _c.maguita_lancamento_estado_ativo
          where la.lancamento_cliente_id = coalesce( arg_cliente_id, la.lancamento_cliente_id )
            and la._branch_uid = coalesce( arg_branch_uid, la._branch_uid )
            and la._tgrupo_id = coalesce( arg_tgropu_id, la._tgrupo_id )
          order by la.lancamento_dataregistro,
            la.lancamento_sequencia
      ), __sequence as (
        select  _l.*,
            _l.entrada as saldo,
            1::int8 as ordem_tipo,
            case
              when _l.cd = 'D' then _l.ordem
              else 0
            end seq_debito,
            case
              when _l.cd = 'C' then _l.ordem
              else 0
            end seq_credito
          from __lancamento _l
          where _l.ordem = 1
          union all
            select _l.*,
               s.saldo + _l.entrada,
               case
                 when _l.cd = 'D' then s.seq_debito +1
                 else s.seq_credito +1
                end,
              case
                when _l.cd = 'D' then s.seq_debito +1
                else s.seq_debito
              end,
              case
                when _l.cd = 'C' then s.seq_credito +1
                else s.seq_credito
              end
              from __sequence s
                inner join __lancamento _l on s.ordem + 1 = _l.ordem
                  and _l.cliente = s.cliente
                  and  _l.branch = s.branch
                  and  _l.grupo = s.grupo
      ), __acomulacao as (
        select s.*,
            0::double precision as previewac,
            s.valor as acomulacao
          from __sequence s
          where s.ordem_tipo = 1
        union all
          select s.*,
            sp.valor + ac.previewac as preview,
            s.valor  + ac.acomulacao
        from __acomulacao ac
          inner join __sequence s on ac.ordem_tipo + 1 = s.ordem_tipo
            and ac.cd = s.cd
            and ac.cliente = s.cliente
            and ac.branch = s.branch
            and ac.grupo = s.grupo
          left join __sequence sp on sp.cd = s.cd
            and s.ordem_tipo - 1 = sp.ordem_tipo
            and s.cliente = sp.cliente
            and s.branch = sp.branch
            and s.grupo = sp.grupo
      ), __regularizacao as (
      select
            array_agg(_reg.valor::numeric order by _reg.ordem ) filter ( where _reg.valor is not null ) regularizacao,
            array_agg(_reg.id order by _reg.ordem ) filter ( where _reg.valor is not null  ) regularizacao_id,
            array_agg(_reg.refid order by _reg.ordem ) filter ( where _reg.valor is not null )  regularizacao_refid,
            max( _reg.acomulacao )  regularizacao_acomulacao,
          _lanc
        from __acomulacao _lanc
          left join __acomulacao _reg on _reg.cd != _lanc.cd
            and _lanc.cliente = _reg.cliente
            and _lanc.branch = _reg.branch
            and _lanc.grupo = _reg.grupo
            and _reg.previewac < _lanc.acomulacao
            and _reg.acomulacao > _lanc.previewac
      group by _lanc
      ) select
          ( _lanc ).ordem,
          ( _lanc ).ordem_tipo,
          ( _lanc ).cd,
          ( _lanc ).credito,
          ( _lanc ).debito,
          ( _lanc ).valor,
          ( _lanc ).entrada,
          ( _lanc ).saldo,
          ( _lanc ).counts = ( _lanc ).ordem as resumo,
           --- AGUI
          ( _lanc ).acomulacao,
          ( coalesce(_reg.regularizacao_acomulacao, lag( _reg.regularizacao_acomulacao , 1 ) over ()) ) as acomulacao,
          case
            when coalesce( regularizacao_acomulacao, lag( regularizacao_acomulacao, 1 ) over () ) - ( _lanc ).acomulacao >= 0 then ( _lanc ).valor
            when coalesce( regularizacao_acomulacao, lag( regularizacao_acomulacao, 1 ) over () ) - ( _lanc ).acomulacao  < 0
            and ( coalesce( regularizacao_acomulacao, lag( regularizacao_acomulacao, 1 ) over () ) - ( _lanc ).acomulacao ) * -1 < ( _lanc ).valor
            then ( _lanc ).valor +  (coalesce( regularizacao_acomulacao, lag( regularizacao_acomulacao, 1 ) over () ) - ( _lanc ).acomulacao)
            else 0
          end as regulado,
          _reg.regularizacao,
          _reg.regularizacao_id,
          _reg.regularizacao_refid,

          ( _lanc ).cliente,
          ((_lanc)._lan )._tgrupo_id,
          ((_lanc)._lan ).lancamento_id,
          ((_lanc)._lan ).lancamento_refid,
          ((_lanc)._lan ).lancamento_referencia,
          ((_lanc)._lan ).lancamento_regclass,
          ((_lanc)._lan ).lancamento_documento,
          ((_lanc)._lan ).lancamento_data,
          ((_lanc)._lan ).lancamento_dataregistro,
          ((_lanc)._lan ).lancamento_sequencia
        from __regularizacao _reg
          where not arg_resumo or  ( _lanc ).counts = ( _lanc ).ordem
        order by
          ( _lanc ).cliente,
          ( _lanc ).grupo,
          ( _lanc ).branch,
          ( _lanc ).ordem
    ;
  end;
$$;


--
-- TOC entry 731 (class 1255 OID 16866)
-- Name: __load_cambio_day(uuid, smallint, date, map.constant); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__load_cambio_day(arg_espaco_auth uuid, arg_currency_id smallint, arg_cambio_data date, _const map.constant DEFAULT map.constant()) RETURNS TABLE(cambio_id uuid, cambio_taxa numeric, cambio_data date, cambio_estado smallint, cambio_dataregistro timestamp with time zone)
    LANGUAGE sql
    AS $$
  select
      cb.cambio_id,
      cb.cambio_taxa,
      cb.cambio_data,
      cb.cambio_estado,
      cb.cambio_dataatualizacao
    from tweeks.cambio cb
    where cb.cambio_currency_id = arg_currency_id
      and cb.cambio_data <= coalesce( arg_cambio_data, current_date )
      and cb.cambio_estado != _const.maguita_cambio_estado_anulado
      and cb.cambio_espaco_auth = arg_espaco_auth
    order by cb.cambio_dataregistro desc
    limit 1;
$$;


--
-- TOC entry 800 (class 1255 OID 16867)
-- Name: __lote(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__lote(args jsonb) RETURNS TABLE(espaco_id uuid, artigo_id uuid, lote_numero character varying, lote_validade date, lote_ref jsonb, lote_refuid uuid, lote_refclass character varying, lote_entrada double precision, lote_saida double precision)
    LANGUAGE plpgsql
    AS $$
declare
  arg_colaborador_id uuid default args->>'colaborador_id';
  arg_espaco_auth uuid default args->>'espaco_auth';
  arg_espaco_armazem uuid default args->>'espaco_armazem';
  arg_artigo_id uuid default args->>'artigo_id';
  arg_with_reference boolean default args->>'withRef';
  _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _const map.constant;
begin
  arg_with_reference := coalesce( arg_with_reference, false );
  _const := map.constant();
  return query with __lote_entrada as (
    select
        e.entrada_espaco_destino as espaco_id,
        e.entrada_artigo_id as artigo_id,
        e.entrada_lote as lote_numero,
        e.entrada_validade as lote_validade,
        e.entrada_quantidade as lote_entrada,
        0::double precision as lote_saida,
        case when arg_with_reference then lib.sets_ref( e ) end as lote_ref,
        case when arg_with_reference then e.entrada_id end as lote_refuid,
        case when arg_with_reference then cluster.__format( e.TABLEOID ) end as lote_refclass
      from tweeks.entrada e
      where true
--         and e.entrada_lote is not null
--         and e.entrada_validade is not null
        and e._branch_uid = _branch

        and e.entrada_estado = _const.entrada_estado_ativo
        and e.entrada_espaco_destino = coalesce( arg_espaco_armazem, e.entrada_espaco_destino )
        and e.entrada_artigo_id = coalesce( arg_artigo_id, e.entrada_artigo_id )
    union all
      select
          e.transferencia_espaco_destino,
          e.transferencia_artigo_id,
          e.transferencia_lote,
          e.transferencia_validade,
          0::double precision lote_entrada,
          e.transferencia_quantidade as lote_saida,
          case when arg_with_reference then lib.sets_ref( e ) end as lote_ref,
          case when arg_with_reference then e.transferencia_id end as lote_refuid,
          case when arg_with_reference then cluster.__format( e.TABLEOID ) end as lote_refclass
        from tweeks.transferencia e
        where true
--           and e.transferencia_lote is not null
--           and e.transferencia_validade is not null
          and e._branch_uid = _branch

          and e.transferencia_estado = _const.transferencia_estado_ativo
          and e.transferencia_espaco_destino = coalesce( arg_espaco_armazem, e.transferencia_espaco_destino )
          and e.transferencia_artigo_id = coalesce( arg_artigo_id, e.transferencia_artigo_id )

  ), __lote_saida as (
    select
        e.venda_espaco_auth as espaco_id,
        e.venda_artigo_id as artigo_id,
        e.venda_lote as lote_numero,
        e.venda_validade as lote_validade,
        e.venda_quantidade as lote_entrada,
        0::double precision as lote_saida,
        case when arg_with_reference then lib.sets_ref( e ) end as lote_ref,
        case when arg_with_reference then e.venda_id end as lote_refuid,
        case when arg_with_reference then cluster.__format( e.TABLEOID ) end as lote_refclass
      from tweeks.venda e
      where true
--         and e.venda_lote is not null
--         and e.venda_validade is not null
        and e._branch_uid = _branch

        and e.venda_estado not in ( _const.maguita_venda_estado_anulado, _const.maguita_venda_estado_canselado )
        and e.venda_espaco_auth = coalesce( arg_espaco_armazem, e.venda_artigo_id )
        and e.venda_artigo_id = coalesce( arg_artigo_id, e.venda_artigo_id )
    union all
      select
          e.transferencia_espaco_origem,
          e.transferencia_artigo_id,
          e.transferencia_lote,
          e.transferencia_validade,
          0::double precision lote_entrada,
          e.transferencia_quantidade as lote_saida,
          case when arg_with_reference then lib.sets_ref( e ) end as lote_ref,
          case when arg_with_reference then e.transferencia_id end as lote_refuid,
          case when arg_with_reference then cluster.__format( e.TABLEOID ) end as lote_refclass
        from tweeks.transferencia e
        where true
--           and e.transferencia_lote is not null
--           and e.transferencia_validade is not null
          and e._branch_uid = _branch

          and e.transferencia_estado = _const.transferencia_estado_ativo
          and e.transferencia_espaco_origem = coalesce( arg_espaco_armazem, e.transferencia_espaco_origem )
          and e.transferencia_artigo_id = coalesce( arg_artigo_id, e.transferencia_artigo_id )
  ), __lote as (
    select
        coalesce( le.espaco_id, ls.espaco_id ) as espaco_id,
        coalesce( le.artigo_id, ls.artigo_id ) as atrigo_id,
        coalesce( le.lote_numero, ls.lote_numero ) as lote_numero,
        coalesce( le.lote_validade, ls.lote_validade ) as lote_validade,
        coalesce( le.lote_entrada, ls.lote_entrada, 0.0 ) as lote_entrada,
        coalesce( le.lote_saida, ls.lote_saida, 0.0 ) as lote_saida,
        coalesce( le.lote_ref, ls.lote_ref ) as lote_ref,
        coalesce( le.lote_refuid, ls.lote_refuid ) as lote_refuid,
        coalesce( le.lote_refclass, ls.lote_refclass ) as lote_refclass
      from __lote_entrada le
        full join __lote_saida ls on le.artigo_id = ls.artigo_id
          and le.espaco_id = ls.espaco_id
          and le.lote_numero = ls.lote_numero
          and le.lote_validade = ls.lote_validade
  ), __filter as (
    select
        _l.espaco_id,
        _l.atrigo_id,
        _l.lote_numero,
        _l.lote_validade,
        _l.lote_ref,
        _l.lote_refuid,
        _l.lote_refclass,
        sum( _l.lote_entrada ) lote_entrada,
        sum( _l.lote_saida ) lote_saida
      from __lote _l
      group by _l.espaco_id,
        _l.atrigo_id,
        _l.lote_numero,
        _l.lote_validade,
        _l.lote_ref,
        _l.lote_refuid,
        _l.lote_refclass
  ) select _l.*
      from __filter _l;
end;
$$;


--
-- TOC entry 595 (class 1255 OID 16868)
-- Name: __precario(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__precario(jsonb) RETURNS TABLE(precario_custo double precision, precario_quantidade double precision)
    LANGUAGE sql IMMUTABLE
    AS $_$
  select ($1->>'precario_custo')::double precision,
         ($1->>'precario_quantidade')::double precision
$_$;


--
-- TOC entry 889 (class 1255 OID 19722)
-- Name: __sets_generate_documento(uuid, integer); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__sets_generate_documento(arg_espaco_auth uuid, arg_tserie integer) RETURNS TABLE(document character varying, serie_id uuid, serie_numero character varying, serie_numatorizacao character varying, serie_numcertificacao character varying, serie_sequencia bigint, serie_quantidade bigint, autorizacao_uid uuid, autorizacao_ano integer, autorizacao_numero character varying)
    LANGUAGE plpgsql STRICT
    AS $$
declare
  _serie tweeks.serie;
  _numero_documento varchar;
  ___branch uuid default tweeks.__branch_uid( null, arg_espaco_auth );
  _const map.constant;
  _espaco tweeks.espaco;
  _tserie tweeks.tserie;
  _iterate int default 0;
  _autorizacao tweeks.autorizacao;
begin
    _const := map.constant();

    select * into _tserie
      from tweeks.tserie ts
      where ts.tserie_id = arg_tserie
    ;

    -- Obter o espaço superior que pode gerar numero de seire
    with recursive __espaco as (
      select e.*, e.espaco_gerarfatura as __generate_serie
      from tweeks.espaco e
      where e.espaco_id =arg_espaco_auth
      union all
      select w.*, w.espaco_gerarfatura
        from __espaco _e
          inner join tweeks.espaco w on _e.espaco_espaco_id = w.espaco_id
        and not _e.__generate_serie
    ) select * into _espaco from __espaco __e
      where __e.__generate_serie
    ;

    while _numero_documento is null loop
      update tweeks.serie s
        set serie_sequencia = s.serie_sequencia +1
        from tweeks.autorizacao a
        where s.serie_autorizacao_uid = a.autorizacao_uid
          and s._branch_uid = ___branch
          and a._branch_uid = ___branch
          and s.serie_espaco_id = _espaco.espaco_id
          and s.serie_tserie_id = arg_tserie
          and s.serie_estado = _const.maguita_serie_estado_ativo
          and a.autorizacao_estado = _const.maguita_autorizacao_estado_ativo
          and a.autorizacao_ano = extract( years from now() )::int
        returning * into _serie
      ;

      if _serie.serie_id is null then
        raise exception 'Nenhuma serie disponivel para gerar a sequencia!';
      end if;

      if length( _serie.serie_sequencia::text ) > _tserie.tserie_seqlimit::int then
        raise exception 'O numero de sequencia excede o tamanho maximo definido para e seire';
      end if;

      _autorizacao := tweeks.__get_autorizacao( _serie.serie_autorizacao_uid );

      -- ex: FT0000119000001
      -- TIPO|FIXA|ANO|SEQUENCIA
      _numero_documento := format(
        '%s%s%s%s',
        _tserie.tserie_code, --TYPE
        lpad( "left"( _serie.serie_numero, _tserie.tserie_numlimit-2), _tserie.tserie_numlimit-2, '0'), --FIXA
        to_char( make_date( _autorizacao.autorizacao_ano, 1, 1 ), 'yy' ), --YEAR
        lpad( _serie.serie_sequencia::text, _tserie.tserie_seqlimit::int,  '0' ) --SEQUENCE
      );

      if _tserie.tserie_id in ( _const.maguita_tserie_fatura, _const.maguita_tserie_faturarecibo )
        and exists(
          select *
            from tweeks.conta c
            where c.conta_numerofatura = _numero_documento
              and c._branch_uid = ___branch
      ) then
        _numero_documento := null;
      end if;

      if _numero_documento is not null
        and _tserie.tserie_id in ( _const.maguita_tserie_recibo, _const.maguita_tserie_faturarecibo )
        and exists(
          select *
            from tweeks.deposito de
            where de.deposito_documento = _numero_documento
              and de._branch_uid = ___branch
      ) then
        _numero_documento := null;
      end if;
      _iterate := _iterate +1;

      if _iterate = 1000 then
        raise exception 'Exedeu o limite de tentativa para geração de numero de serie, por favor proucure pelo suporte.';
      end if;
    end loop;

    __sets_generate_documento.document := _numero_documento;
    __sets_generate_documento.serie_id := _serie.serie_id;
    __sets_generate_documento.serie_sequencia := _serie.serie_sequencia;
    __sets_generate_documento.serie_numero := _serie.serie_numero;
    __sets_generate_documento.serie_quantidade := _serie.serie_quantidade;
    __sets_generate_documento.serie_numatorizacao := _serie.serie_numatorizacao;
    __sets_generate_documento.serie_numcertificacao := _serie.serie_numcertificacao;
    __sets_generate_documento.autorizacao_uid := _autorizacao.autorizacao_uid;
    __sets_generate_documento.autorizacao_ano := _autorizacao.autorizacao_ano;
    __sets_generate_documento.autorizacao_numero := _autorizacao.autorizacao_numero;

    return next;
end;
$$;


--
-- TOC entry 494 (class 1255 OID 16870)
-- Name: __sync_branch_map(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__sync_branch_map() RETURNS SETOF text
    LANGUAGE plpgsql
    AS $_$
declare
  __branch_auto regprocedure default 'tweeks.__tg_use_branch()'::regprocedure;
  _tg record;
  _data record;
  _base_name text;
  _trigger_name text;
  _statement text;
begin
  for _tg in
    select
      tg.tgrelid::regclass::text as share_regclass,
      tg.tgname as trigger_name,
      tg.*
    from pg_trigger tg
    where tg.tgfoid in( __branch_auto )
    loop
        _statement  :=  format( 'drop trigger %I on %s', _tg.trigger_name, _tg.share_regclass );
        return next _statement;
      begin
        execute _statement;
      exception when others then null;
      end;
  end loop;

  for _tg in
    select *
    from tweeks.branchmap _b
  loop
    --language=PostgreSQL
    _statement := $sql$
      alter table __schema_name.__table_name add column if not exists _branch_uid uuid;
    $sql$;
    _statement := replace( _statement, '__schema_name', '%I' );
    _statement := replace( _statement, '__table_name', '%I' );
    _statement := format( _statement, _tg.map_sch, _tg.map_tbl );
    return next _statement;
--     begin
      execute _statement;
--     exception when others then null; end;

 end loop;

  for _tg in
    with __when ( class, schema, tbl, _tg_op, _procedure ) as (
      select  _b.class, _b.map_sch, _b.map_tbl, 'insert', __branch_auto from tweeks.branchmap _b
      union all select  _b.class, _b.map_sch, _b.map_tbl, 'update',  __branch_auto from tweeks.branchmap _b
    ) select *
    from __when w
    loop
      select array_agg( tgname ) as triggers into _data
        from pg_trigger tg
        where tg.tgrelid::regclass = _tg.class::regclass
      ;

      _base_name := format( 'sync_branch_map_before_%s_on_%s_%s', _tg._tg_op, _tg.schema, _tg.tbl );

      _trigger_name := format( '%s_%s', _base_name, ( random() * (999999 - 100000 )+100000)::int );
      while _trigger_name = any( _data.triggers ) loop
        _trigger_name := format( '%s_%s', _base_name, ( random() * (999999 - 100000 )+100000)::int );
      end loop;

      --language=PostgreSQL
      _statement := $sql$
        create trigger _tg_name
          before delete
          on _table_name
          for each row
          when ( not cluster.__is_replication() )
        execute procedure _use_procedure
      ;
      $sql$;

      _statement := replace( _statement, '_tg_name', '%I' );
      _statement := replace( _statement, 'delete', '%s' );
      _statement := replace( _statement, '_table_name', '%s' );
      _statement := replace( _statement, '_use_procedure', '%s' );
      _statement := format( _statement, _trigger_name, _tg._tg_op, _tg.class, _tg._procedure );

      begin
        execute _statement;
      return next _statement;
      exception when others then null;
      end;
    end loop;
end;
$_$;


--
-- TOC entry 732 (class 1255 OID 16871)
-- Name: __tg_before_update_classe(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__tg_before_update_classe() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
begin
  if new.classe_codigo is null then
    new.classe_codigo := tweeks.__generate_classe_code(
      new._branch_uid,
      new.classe_colaborador_id,
      new.classe_espaco_auth
    );
  end if;
  return new;
end;
$$;


--
-- TOC entry 733 (class 1255 OID 16872)
-- Name: __tg_conta_after_close(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__tg_conta_after_close() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare

  _new tweeks.conta;
  _old tweeks.conta;
  _const map.constant;
begin
  if cluster.__is_replication() then
    return null;
  end if;

  _new := new;
  _old := old;
  _const := map.constant();

  if _new.conta_estado != _old.conta_estado and _new.conta_estado in (
    _const.maguita_conta_estado_fechado,
    _const.maguita_conta_estado_anulado
  ) then
    update tweeks.venda
      set venda_estado = case
            when _new.conta_estado = _const.maguita_conta_estado_fechado then _const.maguita_venda_estado_fechado
            when _new.conta_estado = _const.maguita_conta_estado_anulado then _const.maguita_venda_estado_anulado
        end
      where venda_estado = _const.maguita_venda_estado_aberto
        and venda_conta_id = _old.conta_id;
  end if;

  return null;
end;
$$;


--
-- TOC entry 734 (class 1255 OID 16873)
-- Name: __tg_create_lancamento(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__tg_create_lancamento() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  _deposito tweeks.deposito;
  _conta tweeks.conta;
  _conta_old tweeks.conta;
  _const map.constant;
  _lancamento tweeks.lancamento;
  _data record;
  _conta_data record;
begin

  --Abortar o trigger quando for conexão com utilizador de replicação
  if cluster.__is_replication() then
    return null;
  end if;

  _const := map.constant();

  if pg_typeof( new ) = pg_typeof( _deposito ) and tg_op = 'INSERT' then
    _deposito :=  new;
    select * into _data from tweeks.tpaga where tpaga_id = _deposito.deposito_tpaga_id;

    _lancamento.lancamento_tlancamento_id := _const.maguita_tlancamento_deposito;
    _lancamento._tgrupo_id := _deposito._tgrupo_id;
    _lancamento.lancamento_refid := _deposito.deposito_id;
    _lancamento.lancamento_regclass := cluster.__format( pg_typeof( _deposito )::text::regclass );
    _lancamento.lancamento_valor := _deposito.deposito_montantefinal;
    _lancamento.lancamento_operacao := 1;
    _lancamento.lancamento_cliente_id := _deposito.deposito_cliente_id;
    _lancamento.lancamento_espaco_auth := _deposito.deposito_espaco_auth;
    _lancamento.lancamento_colaborador_id := _deposito.deposito_colaborador_id;
    _lancamento.lancamento_data := _deposito.deposito_data;
    _lancamento.lancamento_descricao := case
      when _deposito.deposito_docref is not null then format( 'Lançamente de deposito na conta em modalidade %I usando documento nº %I em %I', _data.tpaga_designacao, _deposito.deposito_docref, _deposito.deposito_data )
      else format( 'Lançamente de deposito na conta em modalidade %I em %I', _data.tpaga_designacao, _deposito.deposito_data )
    end;
    _lancamento.lancamento_documento := _deposito.deposito_documento;
    _lancamento.lancamento_referencia := lib.sets_ref( _deposito );

  elseif pg_typeof( new ) = pg_typeof( _conta ) and tg_op = 'UPDATE' then
    _conta := new;
    _conta_old := old;
    
    select * 
      from tweeks.conta ct 
        inner join tweeks.serie s on ct.conta_serie_id = s.serie_id
        inner join tweeks.tserie ts on s.serie_tserie_id = ts.tserie_id
      where ct.conta_id = _conta.conta_id
      into _conta_data
    ;

    if _conta_old.conta_estado != _conta.conta_estado and _conta.conta_estado = _const.maguita_conta_estado_fechado and not exists(
      select *
        from tweeks.lancamento l
        where l.lancamento_regclass = cluster.__format( pg_typeof(_conta)::text::regclass )
          and l.lancamento_refid = _conta.conta_id
    ) then
      _lancamento.lancamento_tlancamento_id := _const.maguita_tlancamento_conta;
      _lancamento._tgrupo_id := _conta._tgrupo_id;
      _lancamento.lancamento_refid := _conta.conta_id;
      _lancamento.lancamento_regclass := cluster.__format( pg_typeof( _conta )::text::regclass );
      _lancamento.lancamento_valor := _conta.conta_montante;
      _lancamento.lancamento_cliente_id := _conta.conta_cliente_id;
      _lancamento.lancamento_espaco_auth := _conta.conta_espaco_auth;
      _lancamento.lancamento_colaborador_id := coalesce( _conta.conta_colaborador_fecho, _conta.conta_colaborador_atualizacao, _conta.conta_colaborador_id );
      _lancamento.lancamento_data := _conta.conta_data;
      _lancamento.lancamento_descricao := format( 'Lançamento de divida na conta com fatura nº %s', _conta.conta_numerofatura );
      _lancamento.lancamento_operacao := -1;
      
      if _conta_data.tserie_id = _const.maguita_tserie_notacredito then
        _lancamento.lancamento_descricao := format( 'Lançamento de nota de credito na conta com fatura nº %s', _conta.conta_numerofatura );
        _lancamento.lancamento_operacao := 1;
        _lancamento.lancamento_valor := _conta.conta_montante * -1;
      elsif _conta_data.tserie_id in(  _const.maguita_tserie_faturarecibo, _const.maguita_tserie_fatura ) then 
        _lancamento.lancamento_descricao := format( 'Lançamento de divida na conta com fatura nº %s', _conta.conta_numerofatura );
      elsif _conta_data.tserie_id = _const.maguita_tserie_guiasaida then 
        _lancamento.lancamento_descricao := format( 'Lançamento de guia de saida com fatura nº %s', _conta.conta_numerofatura );
      end if;
      
      _lancamento.lancamento_documento := _conta.conta_numerofatura;
      _lancamento.lancamento_referencia := lib.sets_ref( _conta );
    end if;
  end if;

  if _lancamento.lancamento_tlancamento_id is not null then
    _lancamento.lancamento_estado := _const.maguita_lancamento_estado_ativo;
    perform lib.sets( _lancamento );
  end if;

  return null;
end;
$$;


--
-- TOC entry 728 (class 1255 OID 16874)
-- Name: __tg_fluxo_on_acerto(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__tg_fluxo_on_acerto() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  _new tweeks.acerto;
  _fluxo tweeks.fluxo;
  _const map.constant;
begin

  if cluster.__is_replication() then
    return null;
  end if;

  _const := map.constant();
  _new := new::tweeks.acerto;


  _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_acerto;
  -- AC#3049940
  _fluxo.fluxo_documento := _new.acerto_codigo;
  _fluxo.fluxo_data := null;
  _fluxo.fluxo_referencia := lib.sets_ref(new );
  _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass );
  _fluxo.fluxo_refuid := _new.acerto_id;

  _fluxo.fluxo_quantidadefinal := _new.acerto_quantidade;
  _fluxo.fluxo_artigo_in := _new.acerto_artigo_id;
  _fluxo.fluxo_espaco_in := _new.acerto_espaco_id;

  _fluxo.fluxo_espaco_auth := _new.acerto_espaco_auth;
  _fluxo.fluxo_colaborador_id := _new.acerto_colaborador_id;
  _fluxo.fluxo_checkpoint := 0;

  perform lib.sets_in( _fluxo );
  return null;
end;
$$;


--
-- TOC entry 735 (class 1255 OID 16875)
-- Name: __tg_fluxo_on_entrada(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__tg_fluxo_on_entrada() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  _new tweeks.entrada;
  _fluxo tweeks.fluxo;
  _const map.constant;
  _guia record;

begin

  if cluster.__is_replication() then
    return null;
  end if;

  _const := map.constant();
  _new := new;

  select * into _guia
    from tweeks.guia g
    where g.guia_uid = _new.entrada_guia_id
  ;

  _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_entrada;
  _fluxo.fluxo_documento := _guia.guia_documentoperacao ;
  _fluxo.fluxo_data := null;
  _fluxo.fluxo_referencia := lib.sets_ref(new );
  _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass );

  _fluxo.fluxo_refuid := _new.entrada_id;
  _fluxo.fluxo_quantidadein := _new.entrada_quantidade;
--   _fluxo.fluxo_quantidadeout :=;

  _fluxo.fluxo_artigo_in := _new.entrada_artigo_id;
--   _fluxo.fluxo_artigo_out := ;

--   _fluxo.fluxo_espaco_out := ;
  _fluxo.fluxo_espaco_in := _new.entrada_espaco_destino;

  _fluxo.fluxo_espaco_auth := _new.entrada_espaco_auth;
  _fluxo.fluxo_colaborador_id := _new.entrada_colaborador_id;

  perform lib.sets_in( _fluxo );
  return null;
end;
$$;


--
-- TOC entry 801 (class 1255 OID 16876)
-- Name: __tg_fluxo_on_retalho(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__tg_fluxo_on_retalho() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  _new tweeks.retalho;
  _fluxo tweeks.fluxo;
  _const map.constant;
begin

  if cluster.__is_replication() then
    return null;
  end if;

  _const := map.constant();
  _new := new;

  _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_retalho;
  _fluxo.fluxo_documento := _new.retalho_codigo;
  _fluxo.fluxo_data := null;
  _fluxo.fluxo_referencia := lib.sets_ref(new );
  _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass );

  _fluxo.fluxo_refuid := _new.retalho_id;
  _fluxo.fluxo_quantidadeout := _new.retalho_quantidade;
  _fluxo.fluxo_quantidadein := _new.retalho_total;

  _fluxo.fluxo_artigo_out := _new.retalho_artigo_composto;
  _fluxo.fluxo_artigo_in := _new.retalho_artigo_base;

  _fluxo.fluxo_espaco_out := _new.retalho_espaco_auth;
  _fluxo.fluxo_espaco_in  := _new.retalho_espaco_auth;

  _fluxo.fluxo_espaco_auth := _new.retalho_espaco_auth;
  _fluxo.fluxo_colaborador_id := _new.retalho_colaborador_id;

  perform lib.sets_in( _fluxo );
  return null;
end;
$$;


--
-- TOC entry 736 (class 1255 OID 16877)
-- Name: __tg_fluxo_on_transferencia(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__tg_fluxo_on_transferencia() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  _new tweeks.transferencia;
  _fluxo tweeks.fluxo;
  _const map.constant;
begin

  if cluster.__is_replication() then
    return null;
  end if;

  _const := map.constant();
  _new := new;

  _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_transferencia;
  _fluxo.fluxo_documento := _new.transferencia_documento;
  _fluxo.fluxo_data := null;
  _fluxo.fluxo_referencia := lib.sets_ref(new );
  _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass );

  _fluxo.fluxo_refuid := _new.transferencia_id;
  _fluxo.fluxo_quantidadein := _new.transferencia_quantidade;
  _fluxo.fluxo_quantidadeout := _new.transferencia_quantidade;

  _fluxo.fluxo_artigo_in := _new.transferencia_artigo_id;
  _fluxo.fluxo_artigo_out := _new.transferencia_artigo_id;

  _fluxo.fluxo_espaco_out := _new.transferencia_espaco_origem;
  _fluxo.fluxo_espaco_in := _new.transferencia_espaco_destino;

  _fluxo.fluxo_espaco_auth := _new.transferencia_espaco_auth;
  _fluxo.fluxo_colaborador_id := _new.transferencia_colaborador_id;

  perform lib.sets_in( _fluxo );
  return null;
end;
$$;


--
-- TOC entry 496 (class 1255 OID 16878)
-- Name: __tg_fluxo_on_venda(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__tg_fluxo_on_venda() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  _new tweeks.venda;
  _old tweeks.venda;
  _fluxo tweeks.fluxo;
  _const map.constant;
  _conta tweeks.conta;
  ___restaurar boolean default true;
  __debitar boolean default true;
begin

  if cluster.__is_replication() then
    return null;
  end if;

  _const := map.constant();
  _new := new;
  if tg_op = 'UPDATE' then
      _old := old;
  end if;
  
  if _new.venda_proforma is null then
    raise exception 'O campo venda_proforma não foi definido!';
  end if;

  _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_venda;
  _fluxo.fluxo_documento := null;
  _fluxo.fluxo_data := null;
  _fluxo.fluxo_referencia := jsonb_build_object( 'venda_id', _new.venda_id );
  _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass );
  _fluxo.fluxo_refuid := _new.venda_id;
  _fluxo.fluxo_colaborador_id := _new.venda_colaborador_id;
  _fluxo.fluxo_espaco_auth := _new.venda_espaco_auth;
  
  
  -- Report o stock quando mudar a conta de normal para proforma
  if tg_op = 'UPDATE' 
    and ___restaurar
    and not _old.venda_proforma 
    and _new.venda_proforma 
  then
    _fluxo.fluxo_quantidadein := _old.venda_quantidade;
    _fluxo.fluxo_artigo_in := _old.venda_artigo_id;
    _fluxo.fluxo_espaco_in := _old.venda_espaco_auth;
    _fluxo.fluxo_observacao := format( 'Reposição do artigo no stock por transformação de conta normal em proforma' );
    perform lib.sets_in( _fluxo );
    ___restaurar := false;
  end if;
  
  
  -- Report o stock quando atualizar a  quantidade na venda normal ou o venda for anulada
  if tg_op = 'UPDATE'
    and ___restaurar
    and not _old.venda_proforma 
    and _old.venda_quantidade != _new.venda_quantidade
  then
    _fluxo.fluxo_quantidadein := _old.venda_quantidade;
    _fluxo.fluxo_artigo_in := _old.venda_artigo_id;
    _fluxo.fluxo_espaco_in := _old.venda_espaco_auth;
    _fluxo.fluxo_observacao := format( 'Reposição do artigo no stock por atualização da quantidade na conta' );
    perform lib.sets_in( _fluxo );
    ___restaurar := false;
  end if;
  
  -- Report o stock quando a venda for anulada
  if tg_op = 'UPDATE'
    and ___restaurar
    and not _old.venda_proforma 
    and _old.venda_estado != _new.venda_estado
    and _new.venda_estado in (
      _const.maguita_venda_estado_anulado,
      _const.maguita_venda_estado_canselado
    )
  then
    _fluxo.fluxo_quantidadein := _old.venda_quantidade;
    _fluxo.fluxo_artigo_in := _old.venda_artigo_id;
    _fluxo.fluxo_espaco_in := _old.venda_espaco_auth;
    _fluxo.fluxo_observacao := format( 'Reposição do artigo no stock por Anulação/Canselamento da conta');
    perform lib.sets_in( _fluxo );
    ___restaurar := false;
  end if;

  _fluxo.fluxo_quantidadein := null;
  _fluxo.fluxo_artigo_in := null;
  _fluxo.fluxo_espaco_in := null;
  _fluxo.fluxo_quantidadeout := _new.venda_quantidade;
  _fluxo.fluxo_artigo_out := _new.venda_artigo_id;
  _fluxo.fluxo_espaco_out := _new.venda_espaco_auth;
  
  if tg_op = 'INSERT' 
    and not _new.venda_proforma 
    and __debitar 
  then
    _fluxo.fluxo_observacao := format( 'Debito no stock atravez de uma venda' );
    perform lib.sets_in( _fluxo );
    __debitar := false;
  end if;
  
  if tg_op = 'UPDATE'
    and __debitar
    and not _new.venda_proforma
    and _new.venda_quantidade != _old.venda_quantidade
    and _new.venda_estado not in (
      _const.maguita_venda_estado_anulado,
      _const.maguita_venda_estado_canselado
    )
  then
    _fluxo.fluxo_observacao := format( 'Debito no stock atravez de uma venda' );
    perform lib.sets_in( _fluxo );
    __debitar := false;
  end if;


  if _old.venda_estado != _new.venda_estado and _new.venda_estado = _const.maguita_venda_estado_fechado then
    _conta := tweeks._get_conta( _old.venda_conta_id );
    update tweeks.fluxo
      set fluxo_documento = _conta.conta_numerofatura
      where fluxo_regclass = cluster.__format( pg_typeof( _new )::text::regclass )
      and ( fluxo_referencia->>'venda_id')::uuid = _old.venda_id
    ;
  end if;
  return null;
end
$$;


--
-- TOC entry 737 (class 1255 OID 16879)
-- Name: __tg_use_branch(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__tg_use_branch() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
  declare
    _class text default cluster.__format( format('%I.%I', tg_table_schema, tg_table_name ) );
    _map record;
    __branch_uid uuid;
    __colaborador_uid uuid;
    __espaco_uid uuid;
  begin

    -- Quando houver branch previeamente definido
    if new._branch_uid is not null then
      return new;
    end if;

    select * into _map
      from tweeks.branchmap b
      where b.class = _class;

    if _map.class is null then return new; end if;
    if _map.map_spc is null and _map.map_usr is null then return new; end if;
    if _map.map_brc is not null then
      new._branch_uid := to_jsonb( new )->>( _map.map_brc );
      return new;
    end if;

    __colaborador_uid := to_jsonb( new )->>( _map.map_usr );
    __espaco_uid := to_jsonb( new )->>( _map.map_spc );

    __branch_uid := tweeks.__branch_uid(__colaborador_uid, __espaco_uid );
    if __branch_uid is not null then
  --       raise exception 'Não pode determinar o branch para o registro, verificar o mapeamento dos branch!';
  --     else
      new._branch_uid := __branch_uid;
    else
  --       raise exception 'USR: % = %, SPC: % = %', _map.map_usr, __colaborador_uid, _map.map_spc, __espaco_uid;
    end if;

    return new;
  end;
$$;


--
-- TOC entry 903 (class 1255 OID 19832)
-- Name: __tg_venda_before_check(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__tg_venda_before_check() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  _conta record;
  _artigo record;
  _new tweeks.venda;
begin
  if upper( tg_op ) in ( 'INSERT', 'UPDATE' ) then
    _new := new;
    select *
      from tweeks.conta ct
      where ct.conta_id = _new.venda_conta_id
      into _conta
    ;

    select *
      from tweeks.artigo a
      where a.artigo_id = _new.venda_artigo_id
      into _artigo
    ;
    
    -- Garantir que a quantidade vendida nunca seja de zero
    if new.venda_quantidade = 0 then
      raise exception '%', format('A quantidade de artigo para %I %s não pode ser zero', _artigo.artigo_nome, case
        when _new.venda_descricao != _artigo.artigo_nome then format( 'com descrição %I', _new.venda_descricao )
        else ''
      end) ;
    end if;

    -- Garantir que a quantidade vendida só seja negativa para o caso de conta corrente
    if _new.venda_quantidade < 0 and _conta.conta_conta_docorigin is null then
      raise exception '%', format( 'Não vender o artigo %I %s com quantidade negativa!', _artigo.artigo_nome, case
        when _new.venda_descricao != _artigo.artigo_nome then format( 'com descrição %I', _new.venda_descricao )
        else ''
      end);
    end if;

    return new;
  end if;
end;
$$;


--
-- TOC entry 893 (class 1255 OID 19829)
-- Name: __tg_venda_before_sets(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.__tg_venda_before_sets() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
declare
  _sets record;
  _new tweeks.venda;
begin
  _new := new;
  if _new.venda_proforma is null then
      select * into _sets
        from tweeks.conta ct 
        where ct.conta_id = _new.venda_conta_id
      ;
      
      _new.venda_proforma := _sets.conta_proforma;
  end if;
  return _new;
end;
$$;


--
-- TOC entry 247 (class 1259 OID 16880)
-- Name: artigo; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.artigo (
    artigo_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    artigo_artigo_id uuid,
    artigo_classe_id uuid NOT NULL,
    artigo_espaco_auth uuid NOT NULL,
    artigo_colaborador_id uuid NOT NULL,
    artigo_colaborador_atualizacao uuid,
    artigo_codigo character varying NOT NULL,
    artigo_nome character varying NOT NULL,
    artigo_preparacao boolean DEFAULT false NOT NULL,
    artigo_foto character varying,
    artigo_descricao character varying,
    artigo_stock double precision DEFAULT 0.0 NOT NULL,
    artigo_stocknegativo boolean DEFAULT false NOT NULL,
    artigo_compostoquantidade double precision,
    artigo_estado smallint DEFAULT (map.get('artigo_estado_ativo'::name))::smallint NOT NULL,
    artigo_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    artigo_dataatualizacao timestamp with time zone,
    _branch_uid uuid,
    artigo_codigoimposto character varying,
    artigo_unit_id uuid,
    CONSTRAINT ck_artigo_nome CHECK (lib.str_is_normalized((artigo_nome)::text))
);


--
-- TOC entry 5957 (class 0 OID 0)
-- Dependencies: 247
-- Name: TABLE artigo; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.artigo IS '#Artigo - Essa entidade serve para registrar o astigos que serão vendidos';


--
-- TOC entry 5958 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN artigo.artigo_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.artigo.artigo_id IS 'Identificador único do artigo';


--
-- TOC entry 5959 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN artigo.artigo_classe_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.artigo.artigo_classe_id IS 'Identificador da classe a qual pertence o artigo';


--
-- TOC entry 5960 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN artigo.artigo_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.artigo.artigo_colaborador_id IS 'Identificador do colaborador responsavel pelo resistro do artigo';


--
-- TOC entry 5961 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN artigo.artigo_codigo; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.artigo.artigo_codigo IS 'Corresponde ao codigo do artigo';


--
-- TOC entry 5962 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN artigo.artigo_nome; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.artigo.artigo_nome IS 'Corresponde ao nome do artigo';


--
-- TOC entry 5963 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN artigo.artigo_preparacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.artigo.artigo_preparacao IS 'Indica se o artigo tem que ser preparado antes da sua venda';


--
-- TOC entry 5964 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN artigo.artigo_foto; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.artigo.artigo_foto IS 'Referencia da foto do artigo';


--
-- TOC entry 5965 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN artigo.artigo_descricao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.artigo.artigo_descricao IS 'Descrição do artigo';


--
-- TOC entry 5966 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN artigo.artigo_stocknegativo; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.artigo.artigo_stocknegativo IS 'Esse atributo indica se o produto pode aceitar stock negativo ou não';


--
-- TOC entry 5967 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN artigo.artigo_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.artigo.artigo_estado IS '
Estado do artigo
<ul>
  <li> 1 - Ativo | O artigo pode ser comercializado </li>
  <li> 0 - Fechado | O artigo não poder ser comercializado nesse estado </li>
</ul>
';


--
-- TOC entry 5968 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN artigo.artigo_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.artigo.artigo_dataregistro IS 'Corresponde ao instante em que o artigo foi registrado do sistema';


--
-- TOC entry 5969 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN artigo.artigo_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.artigo.artigo_dataatualizacao IS 'Corresponde ao instante em que o artigo foi atualizado pela última vez';


--
-- TOC entry 738 (class 1255 OID 16892)
-- Name: _get_artigo(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks._get_artigo(arg_atigo_id uuid) RETURNS tweeks.artigo
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
  -- Ess funcao serve para obter uma instancia de artigo
  select * from tweeks.artigo art where art.artigo_id = arg_atigo_id;
$$;


--
-- TOC entry 739 (class 1255 OID 16893)
-- Name: _get_branch_by_colaborador(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks._get_branch_by_colaborador(uuid) RETURNS cluster.branch
    LANGUAGE sql
    AS $_$
select b.*
from tweeks.branch b
       inner join auth.colaborador c on c.colaborador_branch_uid = b.branch_uid
where c.colaborador_id = $1;
$_$;


--
-- TOC entry 740 (class 1255 OID 16894)
-- Name: _get_branch_by_espaco(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks._get_branch_by_espaco(uuid) RETURNS cluster.branch
    LANGUAGE sql
    AS $_$
select b.*
from tweeks.branch b
       inner join tweeks.espaco e on b.branch_uid = e.espaco_branch_uid
where e.espaco_id = $1

$_$;


--
-- TOC entry 248 (class 1259 OID 16895)
-- Name: caixa; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.caixa (
    caixa_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    caixa_posto_id uuid NOT NULL,
    caixa_espaco_auth uuid NOT NULL,
    caixa_colaborador_id uuid NOT NULL,
    caixa_colaborador_atualizacao uuid,
    caixa_montanteinicial double precision NOT NULL,
    caixa_montanteinicialposto double precision,
    caixa_montantefecho double precision,
    caixa_montantefechoposto double precision,
    caixa_quantidadecheque smallint,
    caixa_quantidadechequeposto smallint,
    caixa_observacao character varying,
    caixa_estado smallint DEFAULT (map.get('maguita_caixa_estado_ativo'::name))::smallint NOT NULL,
    caixa_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    caixa_dataatualizacao timestamp with time zone,
    _branch_uid uuid,
    caixa_code character varying
);


--
-- TOC entry 5974 (class 0 OID 0)
-- Dependencies: 248
-- Name: TABLE caixa; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.caixa IS 'Essa entidade serve para registar as caixas abertas pelos colaboradores';


--
-- TOC entry 5975 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN caixa.caixa_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.caixa.caixa_id IS 'Identificador único da caixa';


--
-- TOC entry 5976 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN caixa.caixa_posto_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.caixa.caixa_posto_id IS 'Identificador do posto o qual emcontra-se a caixa';


--
-- TOC entry 5977 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN caixa.caixa_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.caixa.caixa_colaborador_id IS 'Identificador do colaborador responsável pelo registro da caixa';


--
-- TOC entry 5978 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN caixa.caixa_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.caixa.caixa_colaborador_atualizacao IS 'Identificador do colaborador responsável pela atualização da caixa';


--
-- TOC entry 5979 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN caixa.caixa_montanteinicial; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.caixa.caixa_montanteinicial IS 'Corresponde ao montante inicial em que a caixa foi aberta com ele';


--
-- TOC entry 5980 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN caixa.caixa_montantefecho; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.caixa.caixa_montantefecho IS 'Corresponde ao montante em que a caixa foi fechado com ele';


--
-- TOC entry 5981 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN caixa.caixa_quantidadecheque; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.caixa.caixa_quantidadecheque IS 'Corresponde a quantidade de pagamentos feitos em cheques na caixa';


--
-- TOC entry 5982 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN caixa.caixa_observacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.caixa.caixa_observacao IS 'Observação deixada no fecho da caixa';


--
-- TOC entry 5983 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN caixa.caixa_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.caixa.caixa_estado IS 'Estado da caixa
<ul>
  <li> 1 - Ativo </li>
  <li> 0 - Fechado </li>
</ul>';


--
-- TOC entry 5984 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN caixa.caixa_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.caixa.caixa_dataregistro IS 'Corresponde ao instante em que a caixa foi registrada';


--
-- TOC entry 5985 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN caixa.caixa_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.caixa.caixa_dataatualizacao IS 'Corresponde ao instante em que a caixa foi atualizado pela última vez (instante em que a caixa foi fechada)';


--
-- TOC entry 741 (class 1255 OID 16903)
-- Name: _get_caixa(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks._get_caixa(arg_caixa_id uuid) RETURNS tweeks.caixa
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
  -- Essa função serve para obter uma instancia da caixa
select * from tweeks.caixa cx where cx.caixa_id = arg_caixa_id;
$$;


--
-- TOC entry 249 (class 1259 OID 16904)
-- Name: classe; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.classe (
    classe_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    classe_classe_id uuid,
    classe_espaco_auth uuid NOT NULL,
    classe_colaborador_id uuid NOT NULL,
    classe_colaborador_atualizacao uuid,
    classe_nome character varying NOT NULL,
    classe_codigo character varying,
    classe_foto character varying,
    classe_position smallint DEFAULT 0 NOT NULL,
    classe_lastcodigo integer DEFAULT 0 NOT NULL,
    classe_estado smallint DEFAULT (map.get('classe_estado_ativo'::name))::smallint NOT NULL,
    classe_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    classe_dataatualizacao timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    _branch_uid uuid,
    CONSTRAINT ck_classe_nome_normalized CHECK (lib.str_is_normalized((classe_nome)::text))
);


--
-- TOC entry 5988 (class 0 OID 0)
-- Dependencies: 249
-- Name: TABLE classe; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.classe IS '#Classe - Essa entidade serve para armazenar as classes do produto (categoria do porduto)';


--
-- TOC entry 5989 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN classe.classe_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.classe.classe_id IS 'Identificador único da classe';


--
-- TOC entry 5990 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN classe.classe_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.classe.classe_colaborador_id IS 'Identificador do colaborador responsável pela última atualização';


--
-- TOC entry 5991 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN classe.classe_nome; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.classe.classe_nome IS 'Corresponde ao nome da classe';


--
-- TOC entry 5992 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN classe.classe_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.classe.classe_estado IS ' Estado da classe
<ul>
  <li> 1 - Ativo </li>
  <li> 0 - Fechado </li>
</ul>
';


--
-- TOC entry 5993 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN classe.classe_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.classe.classe_dataregistro IS 'Corresponde ao instante em que a classe for registrada no sistema';


--
-- TOC entry 5994 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN classe.classe_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.classe.classe_dataatualizacao IS 'Corresponde ao instnate em que a classe for atualizado pela sua última vez';


--
-- TOC entry 742 (class 1255 OID 16916)
-- Name: _get_classe(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks._get_classe(arg_classe_id uuid) RETURNS tweeks.classe
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
  -- Essa função devolve uma instancia da classe do artigo
select * from tweeks.classe clas where clas.classe_id = arg_classe_id;
$$;


--
-- TOC entry 250 (class 1259 OID 16917)
-- Name: conta; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.conta (
    conta_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    conta_cliente_id uuid,
    conta_posto_id uuid,
    conta_posto_fecho uuid,
    conta_espaco_auth uuid NOT NULL,
    conta_colaborador_id uuid NOT NULL,
    conta_colaborador_atualizacao uuid,
    conta_numero integer NOT NULL,
    conta_titularnif character varying,
    conta_titular character varying,
    conta_data date,
    conta_numerofatura character varying,
    conta_montante double precision DEFAULT 0.0 NOT NULL,
    conta_imprensa smallint DEFAULT 0 NOT NULL,
    conta_observacao character varying,
    conta_desconto double precision DEFAULT 0 NOT NULL,
    conta_estado smallint DEFAULT (map.get('maguita_conta_estado_aberto'::name))::smallint NOT NULL,
    conta_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    conta_dataatualizacao timestamp with time zone,
    conta_extension jsonb DEFAULT '{}'::jsonb NOT NULL,
    conta_mesa json,
    conta_datafecho timestamp with time zone,
    _tgrupo_id smallint,
    conta_colaborador_fecho uuid,
    conta_proforma boolean DEFAULT false,
    conta_proformavencimento date,
    conta_proformaextras jsonb,
    conta_serie_id uuid,
    _branch_uid uuid,
    conta_serie json,
    conta_chave character varying,
    conta_conta_docorigin uuid,
    conta_props jsonb,
    conta_tserie_id smallint,
    CONSTRAINT ck_conto_titular CHECK (lib.str_is_normalized((conta_titular)::text))
);


--
-- TOC entry 5997 (class 0 OID 0)
-- Dependencies: 250
-- Name: TABLE conta; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.conta IS 'Essa entidade serve para armazenar as contas das vendas feitas';


--
-- TOC entry 5998 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_id IS 'Identificador único da conta';


--
-- TOC entry 5999 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_posto_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_posto_id IS 'Identificador da caixa a qual a conta foi aberta';


--
-- TOC entry 6000 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_posto_fecho; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_posto_fecho IS 'Corresponde a caixa em que a conta teve o seu pagamento de fecho (apenas a última que conta, mas pode-se ver todas anterior na entidade amortização)';


--
-- TOC entry 6001 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_colaborador_id IS 'Identificador do colaborador responsável pelo registro da conta';


--
-- TOC entry 6002 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_colaborador_atualizacao IS 'Identificador do último colaborador responsavél pela atualização da conta (colaborador quem finalizou a conta)';


--
-- TOC entry 6003 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_titularnif; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_titularnif IS 'O nif do titular da conta';


--
-- TOC entry 6004 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_titular; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_titular IS 'Corresponde ao titular da conta (o nome do cliente)';


--
-- TOC entry 6005 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_data; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_data IS 'Corresponde a data da conta';


--
-- TOC entry 6006 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_numerofatura; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_numerofatura IS 'Corresponde ao numero de fatura gerado para a conta';


--
-- TOC entry 6007 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_montante; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_montante IS 'Corresponde ao montante total da conta';


--
-- TOC entry 6008 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_imprensa; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_imprensa IS 'Corresponde ao numeros de impressão que a conta já teve';


--
-- TOC entry 6009 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_observacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_observacao IS 'Corresponde a observação da conta, normalmente setado na anulação da conta';


--
-- TOC entry 6010 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_desconto; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_desconto IS 'Esse atributo indica o montante em desconto da conta';


--
-- TOC entry 6011 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_estado IS 'Corresponde ao estado atuala da conta
<ul>
  <li> 2 - Aberto  | pode efetuar quaisquer alteração na conta</li>
  <li> 1 - Fechado | não se pode alterar mais nada na conta (só anulação)</li>
  <li> 0 - Pago    | conta paga não se pode efetuar mais nenhuma alteração (só anulaçõa)</li>
  <li> -1 Anulado </li>
</ul>';


--
-- TOC entry 6012 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_dataregistro IS 'Corresponde ao instante em que a conta foi registrada';


--
-- TOC entry 6013 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN conta.conta_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.conta.conta_dataatualizacao IS 'Corresponde ao instante em que a conta foi atualizada pela última vez';


--
-- TOC entry 743 (class 1255 OID 16931)
-- Name: _get_conta(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks._get_conta(arg_conta_id uuid) RETURNS tweeks.conta
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
  -- Essa função devolve a instancia de uma conta
select * from tweeks.conta ct where ct.conta_id = arg_conta_id;
$$;


--
-- TOC entry 744 (class 1255 OID 16932)
-- Name: _get_espaco(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks._get_espaco(arg_espaco_id uuid) RETURNS tweeks.espaco
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
  -- essa função serve para devolver uma intancia do espaco
select * from tweeks.espaco esp where esp.espaco_id = arg_espaco_id;
$$;


--
-- TOC entry 780 (class 1255 OID 16933)
-- Name: _get_impostos_taxa(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks._get_impostos_taxa(args jsonb) RETURNS TABLE(artigo_id uuid, percentagem_adicionar double precision, percentagem_retirar double precision, taxa_adicionar double precision, taxa_retirar double precision, taxas uuid[])
    LANGUAGE plpgsql
    AS $$
declare
  /**
    arg_artigo_id [ ID, ... ]
    arg_espaco_auth UID
    arg_colaborador_id UID
   */


  arg_artigo_id uuid[] default array(
    select e.text::uuid
      from jsonb_array_elements_text( args-> 'arg_artigo_id' ) e(  text )
  );
  arg_espaco_auth uuid default  args->>'arg_espaco_auth';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';

  _const map.constant;
  _data record;
  __knext record;
  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
begin
  _const := map.constant();

  for __knext in
    select *
     from unnest( arg_artigo_id ) u( _argito_id )
  loop
    select
      sum( ( txass::tweeks.taxa ).taxa_percentagem ) filter ( where tap.taplicar_id = _const.maguita_taplicar_adicionar ) as percentagem_adicionar,
      sum( ( txass::tweeks.taxa ).taxa_percentagem ) filter ( where tap.taplicar_id = _const.maguita_taplicar_retirar ) as percentagem_retivar,
      sum( ( txass::tweeks.taxa ).taxa_taxa ) filter ( where tap.taplicar_id = _const.maguita_taplicar_adicionar ) as taxa_adicionar,
      sum( ( txass::tweeks.taxa ).taxa_taxa ) filter ( where tap.taplicar_id = _const.maguita_taplicar_retirar ) as taxa_retivar,
      array_agg( distinct (txass::tweeks.taxa).taxa_id ) as taxas
      into _data
    from tweeks.imposto ip
      inner join tweeks.taplicar tap on ip.imposto_taplicar_id = tap.taplicar_id
      inner join tweeks.taxa tx on ip.imposto_tipoimposto_id = tx.taxa_tipoimposto_id
        and tx.taxa_estado = _const.taxa_estado_ativo
        and tx.taxa_espaco_auth = ip.imposto_espaco_auth
      inner join rule.taxa_espaco( tx, _const, arg_espaco_auth ) txass on true
    where ip.imposto_artigo_id = __knext._argito_id
      and ip._branch_uid = ___branch
      and tx._branch_uid = ___branch
      and ip.imposto_estado = _const.maguita_imposto_estado_ativo;

    _get_impostos_taxa.artigo_id := __knext._argito_id;
    _get_impostos_taxa.percentagem_adicionar := coalesce( _data.percentagem_adicionar, 0 );
    _get_impostos_taxa.percentagem_retirar := coalesce( _data.percentagem_retivar, 0 );
    _get_impostos_taxa.taxa_adicionar := coalesce( _data.taxa_adicionar, 0 );
    _get_impostos_taxa.taxa_retirar := coalesce( _data.taxa_retivar, 0 );
    _get_impostos_taxa.taxas := coalesce( _data.taxas, array[]::uuid[] );
    return next;
  end loop;
end;
$$;


--
-- TOC entry 497 (class 1255 OID 16934)
-- Name: _get_item(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks._get_item(arg_artigo_item uuid) RETURNS tweeks.artigo
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
  -- Essa função devolve uma instancia da item do artigo
select * from tweeks.artigo itt where itt.artigo_id = arg_artigo_item
  and itt.artigo_classe_id = lib.to_uuid( 1 ) ; -- classe dos items
$$;


--
-- TOC entry 251 (class 1259 OID 16935)
-- Name: link; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.link (
    link_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    link_link_id uuid,
    link_link_associacao uuid,
    link_tlink_id smallint NOT NULL,
    link_espaco_destino uuid NOT NULL,
    link_espaco_auth uuid NOT NULL,
    link_colaborador_id uuid NOT NULL,
    link_colaborador_atualizacao uuid,
    link_referencia jsonb,
    link_posicao smallint,
    link_nome character varying NOT NULL,
    link_metadata jsonb,
    link_config jsonb,
    link_estado smallint DEFAULT (map.get('maguita_link_estado_ativo'::name))::smallint NOT NULL,
    link_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    link_dataatualizacao timestamp with time zone,
    _branch_uid uuid
);


--
-- TOC entry 6019 (class 0 OID 0)
-- Dependencies: 251
-- Name: TABLE link; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.link IS 'Essa entidade serve para registar o item que deve ocupar uma tecla';


--
-- TOC entry 6020 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN link.link_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.link.link_id IS 'Identificador único do link';


--
-- TOC entry 6021 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN link.link_link_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.link.link_link_id IS 'Identificador da link parent';


--
-- TOC entry 6022 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN link.link_espaco_destino; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.link.link_espaco_destino IS 'Identificador do espaço o qual a link pertence';


--
-- TOC entry 6023 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN link.link_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.link.link_colaborador_id IS 'Identificador do colaborador responsavél pelo registro do link';


--
-- TOC entry 6024 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN link.link_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.link.link_colaborador_atualizacao IS 'Identificador do colaborador responsável pela atualização da link';


--
-- TOC entry 6025 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN link.link_referencia; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.link.link_referencia IS 'Corresponde a referencia a que o link se aponta (artigo, link, classe ...)';


--
-- TOC entry 6026 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN link.link_posicao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.link.link_posicao IS 'Corresponde a posição em que a link deve ocupar';


--
-- TOC entry 6027 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN link.link_nome; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.link.link_nome IS 'Corresponde ao nome da link';


--
-- TOC entry 6028 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN link.link_config; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.link.link_config IS 'Corresponde a cofifuração da link';


--
-- TOC entry 6029 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN link.link_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.link.link_estado IS 'Corresponde ao estado da link
<ul>
  <li> 2 - Ligação </ul>
  <li> 1 - Ativo </ul>
  <li> 0 - Fechado </ul>
</ul>
';


--
-- TOC entry 6030 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN link.link_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.link.link_dataregistro IS 'Corresponde ao instante em que a link foi registrada';


--
-- TOC entry 6031 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN link.link_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.link.link_dataatualizacao IS 'Corresponde ao instante em que a link foi atualizado pela última vez';


--
-- TOC entry 498 (class 1255 OID 16943)
-- Name: _get_link(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks._get_link(arg_link_id uuid) RETURNS tweeks.link
    LANGUAGE sql
    AS $$
  -- Essa função serve para devolver a instancia de uma link
select * from tweeks.link where link_id = arg_link_id;
$$;


--
-- TOC entry 252 (class 1259 OID 16944)
-- Name: posto; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.posto (
    posto_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    posto_tposto_id smallint NOT NULL,
    posto_espaco_auth uuid NOT NULL,
    posto_colaborador_id uuid NOT NULL,
    posto_colaborador_atualizacao uuid,
    posto_designacao character varying,
    posto_chave character varying NOT NULL,
    posto_multiplecaixa boolean DEFAULT true NOT NULL,
    posto_matricula character varying,
    posto_estado smallint DEFAULT (map.get('maguita_posto_estado_fechado'::name))::smallint NOT NULL,
    posto_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    posto_dataatualizacao timestamp with time zone,
    posto_authmode smallint,
    posto_caixamode smallint,
    posto_caixalimite integer,
    _branch_uid uuid,
    posto_vermontatefaturado boolean DEFAULT false NOT NULL,
    posto_definirmontanteautomaticamente boolean DEFAULT false
);


--
-- TOC entry 6034 (class 0 OID 0)
-- Dependencies: 252
-- Name: TABLE posto; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.posto IS 'Essa entidade serve para armazenar os postos de venda';


--
-- TOC entry 6035 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN posto.posto_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.posto.posto_id IS 'Identificador do posto';


--
-- TOC entry 6036 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN posto.posto_espaco_auth; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.posto.posto_espaco_auth IS 'Identificador do espaço o qual o posto está ancorado';


--
-- TOC entry 6037 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN posto.posto_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.posto.posto_colaborador_id IS 'Identificador do colaborador responsável pelo registro do posto';


--
-- TOC entry 6038 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN posto.posto_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.posto.posto_colaborador_atualizacao IS 'Identificador do último colaborador responsável pela atualização do posnto';


--
-- TOC entry 6039 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN posto.posto_designacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.posto.posto_designacao IS 'Corresponde a designação do posto';


--
-- TOC entry 6040 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN posto.posto_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.posto.posto_estado IS 'Corresponde ao estado do posto
<ul>
  <li> fechado | significa que o posto pode ser encerado ou aberto </li>
  <li> aberto | sigififica que o posto está atualmente com uma caixa aberta (não pode ser encerado nesse estado) </li>
  <li> encerado | significa que nenhuma caixa pode ser mais aberta nesse posto </li>
</ul>';


--
-- TOC entry 6041 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN posto.posto_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.posto.posto_dataregistro IS 'Corresponde ao instante que o posto foi registrado no sistema';


--
-- TOC entry 6042 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN posto.posto_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.posto.posto_dataatualizacao IS 'Corresponde ao instante em que o posto teve a sua última atualização';


--
-- TOC entry 499 (class 1255 OID 16953)
-- Name: _get_posto(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks._get_posto(arg_posto_id uuid) RETURNS tweeks.posto
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
  -- Essa função retorna uma instancia da posto
select * from tweeks.posto cx where cx.posto_id = arg_posto_id;
$$;


--
-- TOC entry 505 (class 1255 OID 16954)
-- Name: _get_stock(uuid, uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks._get_stock(_artigo_id uuid, _espaco_id uuid) RETURNS TABLE(stock_artigo_id uuid, stock_espaco_id uuid, stock_quantidade double precision)
    LANGUAGE sql STRICT
    AS $$
  select s.artigo_id, s.espaco_id, sum( s.stock_quantidade )::double precision
    from tweeks.stock s
    where s.artigo_id = coalesce( _artigo_id, s.artigo_id )
      and s.espaco_id = coalesce( _espaco_id, s.espaco_id)
    group by s.artigo_id, s.espaco_id;
$$;


--
-- TOC entry 253 (class 1259 OID 16955)
-- Name: tmovimento; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.tmovimento (
    tmovimento_id smallint NOT NULL,
    tmovimento_multiplo smallint NOT NULL,
    tmovimento_designacao character varying NOT NULL
);


--
-- TOC entry 6046 (class 0 OID 0)
-- Dependencies: 253
-- Name: TABLE tmovimento; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.tmovimento IS 'Essa entidade serve para armazenar os tipos de movimento (credito, debito)';


--
-- TOC entry 6047 (class 0 OID 0)
-- Dependencies: 253
-- Name: COLUMN tmovimento.tmovimento_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tmovimento.tmovimento_id IS 'Identificador único do tipo de movimento';


--
-- TOC entry 6048 (class 0 OID 0)
-- Dependencies: 253
-- Name: COLUMN tmovimento.tmovimento_multiplo; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tmovimento.tmovimento_multiplo IS 'Corresponde ao valor mutiplicavel do tipo de movimento';


--
-- TOC entry 6049 (class 0 OID 0)
-- Dependencies: 253
-- Name: COLUMN tmovimento.tmovimento_designacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tmovimento.tmovimento_designacao IS 'Corresponde a designação do tipo de movimento';


--
-- TOC entry 500 (class 1255 OID 16960)
-- Name: _get_tmovimento(smallint); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks._get_tmovimento(arg_tmovimento_id smallint) RETURNS tweeks.tmovimento
    LANGUAGE sql
    AS $$
  -- Essa função serve para devolver os tipos de movimento do posto
  select * from tweeks.tmovimento tm where tm.tmovimento_id = arg_tmovimento_id;
$$;


--
-- TOC entry 254 (class 1259 OID 16961)
-- Name: venda; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.venda (
    venda_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    venda_conta_id uuid NOT NULL,
    venda_artigo_id uuid NOT NULL,
    venda_espaco_auth uuid NOT NULL,
    venda_colaborador_id uuid NOT NULL,
    venda_colaborador_atualizacao uuid,
    venda_quantidade double precision NOT NULL,
    venda_custounitario double precision NOT NULL,
    venda_montante double precision DEFAULT 0.0 NOT NULL,
    venda_montanteagregado double precision DEFAULT 0.0 NOT NULL,
    venda_montantetotal double precision NOT NULL,
    venda_imposto double precision DEFAULT 0 NOT NULL,
    venda_montantesemimposto double precision DEFAULT 0.0 NOT NULL,
    venda_montantecomimposto double precision DEFAULT 0.0 NOT NULL,
    venda_impostoadicionar double precision,
    venda_impostoretirar double precision,
    venda_estadopreparacao smallint DEFAULT (map.get('venda_estadopreparacao_preparado'::name))::smallint NOT NULL,
    venda_estado smallint DEFAULT (map.get('maguita_venda_estado_aberto'::name))::smallint NOT NULL,
    venda_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    venda_dataatualizacao timestamp with time zone,
    venda_venda_id uuid,
    venda_custoquantidade double precision DEFAULT 1 NOT NULL,
    _branch_uid uuid,
    venda_descricao character varying,
    venda_lote character varying,
    venda_validade date,
    venda_metadata json,
    venda_editado boolean DEFAULT false NOT NULL,
    venda_isencao boolean DEFAULT false NOT NULL,
    venda_taxas uuid[] DEFAULT ARRAY[]::uuid[] NOT NULL,
    venda_codigoimposto character varying,
    venda_venda_docorign uuid,
    venda_proforma boolean DEFAULT false
);


--
-- TOC entry 6052 (class 0 OID 0)
-- Dependencies: 254
-- Name: TABLE venda; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.venda IS 'Essa entidade serve para registar as vendas do artigo ';


--
-- TOC entry 6053 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_id IS 'Identificador único da venda';


--
-- TOC entry 6054 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_conta_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_conta_id IS 'Identificador da conta o qual a venda esta associado';


--
-- TOC entry 6055 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_artigo_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_artigo_id IS 'Identificador do artigo o qual foi vendido';


--
-- TOC entry 6056 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_espaco_auth; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_espaco_auth IS 'Identificador do espaço onde saiu o artigo';


--
-- TOC entry 6057 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_colaborador_id IS 'Identificador do colaborador responsável pelo registro da venda';


--
-- TOC entry 6058 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_colaborador_atualizacao IS 'Identificador do colaborador responsável pela última atualização da venda';


--
-- TOC entry 6059 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_quantidade; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_quantidade IS 'Quantidade do artigo vendido';


--
-- TOC entry 6060 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_custounitario; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_custounitario IS 'Custo únitario do artigo';


--
-- TOC entry 6061 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_montante; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_montante IS 'Montente do artigo preco X quantidade';


--
-- TOC entry 6062 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_montanteagregado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_montanteagregado IS 'Corresponde ao montante total de todos os itens agregados';


--
-- TOC entry 6063 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_montantetotal; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_montantetotal IS 'Coresponde ao montante total da venda = (montante + montanteAgregado )';


--
-- TOC entry 6064 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_imposto; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_imposto IS 'Esse atributo indica o valor de imposto sobre a venda';


--
-- TOC entry 6065 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_estado IS 'Corresponde ao estado da venda
<ul>
  <li> aberto <li>
  <li> fechado </li>
  <li> anulado </li>
  <li> canselado </li>
</ul>';


--
-- TOC entry 6066 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_dataregistro IS 'Corresponde ao instanre em que a venda foi registrado no sistema';


--
-- TOC entry 6067 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN venda.venda_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.venda.venda_dataatualizacao IS 'Corresponde ao instante em que a venda foi atualizado pela última vez no sistema.';


--
-- TOC entry 745 (class 1255 OID 16979)
-- Name: _get_venda(uuid); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks._get_venda(arg_venda_id uuid) RETURNS tweeks.venda
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
  -- Essa função devolve uma instancia de venda
select * from tweeks.venda ve where ve.venda_id = arg_venda_id;
$$;


--
-- TOC entry 803 (class 1255 OID 16980)
-- Name: funct_change_artigo_estado(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_artigo_estado(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para ativar ou desativar o estado do um artigo
    args = {
      arg_colaborador_id: ID,
      arg_espaco_auth: ID,
      arg_artigo_id: ID
    }
  */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_artigo_id uuid not null default args->>'arg_artigo_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );
  _const map.constant;
  _artigo tweeks.artigo;
begin

  _const := map.constant();
  _artigo := tweeks._get_artigo( arg_artigo_id );

  -- Se o espaço for o proprietario do artigo então desativar/reativar o artigo na boa
  if _artigo.artigo_espaco_auth = any( arg_espaco_child ) then
    update tweeks.artigo
      set
        artigo_estado = lib.swith( artigo_estado, _const.artigo_estado_ativo, _const.artigo_estado_fechado  ),
        artigo_colaborador_atualizacao = arg_colaborador_id,
        artigo_dataatualizacao = current_timestamp
      where artigo_id = arg_artigo_id
      returning * into _artigo
    ;

    return true ? jsonb_build_object(
      'artigo', _artigo,
      'text', case
        when _artigo.artigo_estado = _const.artigo_estado_ativo   then format( 'O artigo "%s" foi ativado!', _artigo.artigo_nome )
        when _artigo.artigo_estado = _const.artigo_estado_fechado then format( 'O artigo "%s" foi desativo!', _artigo.artigo_nome )
      end
    );

  -- os outros só podem desativar apenas os links do artigos associados a ele
  else
    return tweeks.funct_change_link_unlink(
        jsonb_build_object(
          'arg_espaco_auth', arg_espaco_auth,
          'arg_colaborador_id', arg_colaborador_id,
          'arg_link_referencia', rule.artigo_referencia( arg_artigo_id )
        )
      );
  end if;




exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 885 (class 1255 OID 19717)
-- Name: funct_change_autorizacao_closeyear(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_autorizacao_closeyear(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /**
    {
      arg_colaborador_id: UID
      arg_espaco_auth: UID
      autorizacao_uid: UID
    }
   */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _autorizacao tweeks.autorizacao;
  _const map.constant;
begin
  _const := map.constant();
  _autorizacao := jsonb_populate_record( _autorizacao, args );
  _autorizacao := tweeks.__get_autorizacao( _autorizacao.autorizacao_uid );

  if _autorizacao.autorizacao_estado != _const.maguita_autorizacao_estado_ativo then
    return lib.res_false( 'A autorizacao selecionada para fecho já esta encerada!' );
  end if;

  update tweeks.autorizacao
    set autorizacao_colaborador_atualizacao = arg_colaborador_id,
        autorizacao_dataatualizacao = now(),
        autorizacao_estado = _const.autenticacao_estado_fechado
    where autorizacao_uid = _autorizacao.autorizacao_uid
    returning * into _autorizacao
  ;

  update tweeks.serie
    set serie_dataatualizacao = now(),
        serie_colaborador_atualizacao = arg_colaborador_id,
        serie_estado = _const.maguita_serie_estado_fechado,
        serie_fechoautorizacao = true
    where serie_estado = _const.maguita_serie_estado_ativo
      and serie_autorizacao_uid = _autorizacao.autorizacao_uid
  ;

  return lib.res_true( jsonb_build_object(
    'autorizacao', _autorizacao
  ));
end;
$$;


--
-- TOC entry 748 (class 1255 OID 16981)
-- Name: funct_change_chave_restore(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_chave_restore(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
     arg_chave_temporaria: CHAVE
     arg_chave_definitiva: CHAVE
   */
    arg_chave_temporaria character varying default args->>'arg_chave_temporaria';
    arg_chave_definitiva character varying default args->>'arg_chave_definitiva';
    _chave tweeks.chave;
begin
  select * into _chave
    from tweeks.chave ch
    where ch.chave_temporarai = arg_chave_temporaria;

  if _chave.chave_definitiva is not null then
      return lib.result_false( 'Chave temporaria já aplicada' );
  else
     update tweeks.chave
        set chave_definitiva = arg_chave_definitiva
        where chave_temporarai = arg_chave_temporaria
        returning * into _chave
      ;
     return lib.result_true( to_jsonb( _chave ) );
  end if;
end
$$;


--
-- TOC entry 749 (class 1255 OID 16982)
-- Name: funct_change_classe_estado(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_classe_estado(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para ativar ou desativar o estado do um artigo
    args = {
      arg_colaborador_id: ID,
      arg_espaco_auth: ID,
      arg_classe_id: ID
    }
  */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );
  arg_classe_id uuid not null default args->>'arg_classe_id';
  _const map.constant;
  _classe tweeks.classe;
begin
  _const := map.constant();

  if arg_classe_id = _const.classe_itemextra then
    return false ? 'Item extra não pode ser desativado';
  end if;

  _classe := tweeks._get_classe( arg_classe_id );

  if _classe.classe_espaco_auth = any( arg_espaco_child ) then
    update tweeks.classe
      set
        classe_estado = case
          when classe_estado = _const.classe_estado_ativo then   _const.classe_estado_fechado
          when classe_estado = _const.classe_estado_fechado then _const.classe_estado_ativo
          else classe_estado
        end::int2,
        classe_colaborador_atualizacao = arg_colaborador_id,
        classe_dataatualizacao = current_timestamp
      where classe_id = arg_classe_id
      returning * into _classe
    ;

    return true ? jsonb_build_object(
      'classe', _classe,
      'classe_old', _classe,
      'message', case
        when _classe.classe_estado = _const.classe_estado_ativo   then format( 'O item "%s" foi ativado!',   _classe.classe_nome )
        when _classe.classe_estado =   _const.classe_estado_fechado then format( 'O item "%s" foi desativo!',  _classe.classe_nome )
      end
    );

  -- Se não for proprietario deslinkar apenas a classe ao espaço
  else
    return tweeks.funct_change_link_unlink(
      jsonb_build_object(
        'arg_espaco_auth', arg_espaco_auth,
        'arg_colaborador_id', arg_colaborador_id,
        'arg_link_referencia', rule.classe_referencia( arg_classe_id )
      )
    );
  end if;

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 804 (class 1255 OID 16983)
-- Name: funct_change_colaborador(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_colaborador(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para aatualizar as informações do colaborador
    args := {
      arg_espaco_auth: ID
      arg_espaco: [ ]
      arg_colaborador_id: ID,
      arg_colaborador_editar: ID,
      arg_colaborador_email: MAIL,
      arg_colaborador_nome: NOME,
      arg_colaborador_apelido: APELIDO,
      arg_colaborador_datanascimento: DATA,
      arg_colaborador_nif: NIF,
      arg_colaborador_ficha: FICHA,
      arg_colaborador_foto: FICHA,
      arg_tsexo_id: SEXO
    }
    arg_colaborador_editar corresponde ao id do colaborador que sera atualizado
    arg_colaborador_id corresponde ao id do colaborador que esata efetuar a atualização
  */

  arg_colaborador_id uuid not null       := args->>'arg_colaborador_id';
  arg_colaborador_editar uuid not null   := args->>'arg_colaborador_editar';
  arg_espaco_auth uuid not null             := args->>'arg_espaco_auth';

  arg_colaborador_email character varying   := args->>'arg_colaborador_email';
  arg_colaborador_nome character varying    := args->>'arg_colaborador_nome';
  arg_colaborador_apelido character varying := args->>'arg_colaborador_apelido';
  arg_colaborador_datanascimento date       := args->>'arg_colaborador_datanascimento';
  arg_colaborador_nif character varying     := args->>'arg_colaborador_nif';
  arg_colaborador_ficha jsonb               := args->>'arg_colaborador_ficha';
  arg_colaborador_foto varchar               := args->>'arg_colaborador_foto';
  arg_tsexo_id int2                         := args->>'arg_tsexo_id';
  arg_espaco jsonb                      := args->'arg_espaco';

  _colaborador auth.colaborador := auth._get_colaborador( arg_colaborador_editar );
  _const map.constant := map.constant();
begin

  -- Tanto o nif, quanto o email deve ser único na base de dados
  arg_colaborador_email := lib.str_normalize( lower( arg_colaborador_email ) );
  arg_colaborador_nif := lib.str_normalize( lower( arg_colaborador_nif ) );

  -- Quando existir email e estiver associado ao utro colaborador então
  if arg_colaborador_email is not null  and (
    select count( * )
      from auth.colaborador
      where colaborador_email = arg_colaborador_email
        and colaborador_id != _colaborador.colaborador_id
  ) > 0 then
    return lib.result_false( 'Email já existe!' );
  end if;

  -- Quando existir um colaborador o nif expecificado
  if arg_colaborador_nif is not null is not null and  (
    select count( * ) > 0
      from auth.colaborador co
      where co.colaborador_nif = arg_colaborador_nif
        and co.colaborador_id != _colaborador.colaborador_id
  ) then
    return lib.result_false( 'NIF já existe!' );
  end if;

  -- A atualização deve ser feita apenas quando o novo valor vier nulo
  update auth.colaborador
    set colaborador_email = coalesce( arg_colaborador_email, colaborador_email ),
        colaborador_nome = coalesce( lib.str_normalize( arg_colaborador_nome ), colaborador_nome ),
        colaborador_apelido = coalesce( lib.str_normalize( arg_colaborador_apelido ), colaborador_apelido ),
        colaborador_tsexo_id = coalesce( arg_tsexo_id, colaborador_tsexo_id ),
        colaborador_datanascimento = coalesce( arg_colaborador_datanascimento, colaborador_datanascimento ),
        colaborador_nif = coalesce( arg_colaborador_nif, colaborador_nif ),
        colaborador_foto = coalesce( arg_colaborador_foto, colaborador_foto ),
        colaborador_ficha = coalesce( arg_colaborador_ficha, colaborador_ficha ),
        colaborador_colaborador_atualizacao = arg_colaborador_id,
        colaborador_dataatualizacao = now()
    where colaborador_id = _colaborador.colaborador_id
    returning * into _colaborador
  ;

  perform tweeks.funct_reg_trabalha(
    jsonb_build_object(
      'arg_espaco_auth', arg_espaco_auth,
      'arg_colaborador_id', arg_colaborador_id,
      'arg_colaborador_propetario', _colaborador.colaborador_id,
      'arg_espaco', arg_espaco
    )
  );

  return lib.result_true();
end;
$$;


--
-- TOC entry 506 (class 1255 OID 16984)
-- Name: funct_change_conta(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_conta(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    /**
      Essa função registra um nova conta
      arg = {

        -- obrigatorios
        arg_colaborador_id: ID,
        arg_conta_id: ID,
        arg_espaco_auth: ID,
        arg_posto_id: ID,
        arg_mesa_numero: NUMERO,


        -- requerido
        arg_vendas: [
          {
            arg_venda_id: ID,
            arg_artigo_id: ID,
            arg_venda_quantidade: QUANT,
            arg_venda_custounitario: CUSTO,

            arg_agregas: [
              {
                arg_agrega_id: ID,
                arg_item_id: ID,
                arg_item_quantidadecusto: QUANT/CUSTO
                arg_item_custo: CUSTO,
                arg_agrega_quantidade: QUANT,
                arg_agrega_montante: MONTANTE
              }
            ]
          }
        ]
      }
     */
   */

  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_conta_id uuid not null default args->>'arg_conta_id';
  arg_posto_id uuid not null default args->>'arg_posto_id';

  arg_mesa_numero varchar default args->>'arg_mesa_numero';
  arg_vendas jsonb not null default args->>'arg_vendas';

  arg_reserva_id uuid  default args->>'arg_reserva_id';
  arg_currency_id int2 default args->>'arg_currency_id';
  arg_tpaga_id int2 default args->>'arg_tpaga_id';
  arg_conta_titular varchar default args->>'arg_conta_titular';
  arg_conta_data date default args->>'arg_conta_data';

  arg_vendas_id uuid [] not null default array( select ( ele.doc->>'arg_venda_id' )::uuid from jsonb_array_elements( arg_vendas ) ele( doc ) where ele.doc->>'arg_venda_id' is not null );

  _conta tweeks.conta;
  _const map.constant;
  _mesa tweeks.mesa;
  _res lib.result;
  _data record;
  _data_item record;
  _stock tweeks.stock;

  arg_venda_add jsonb;
  arg_venda_change jsonb;
begin
  _const := map.constant();
  _conta := tweeks._get_conta( arg_conta_id );
  _mesa := tweeks._get_mesa( arg_colaborador_id, arg_espaco_auth, arg_mesa_numero );
  _mesa.mesa_estado := coalesce( _mesa.mesa_estado, _const.mesa_estado_disponivel );
  _mesa.mesa_id := coalesce( _mesa.mesa_id, -1 );

--   -- A mesa tem de estar disponivel para associa-la a conta
--   if _conta.conta_mesa_id != _mesa.mesa_id and _mesa.mesa_estado != _const.mesa_estado_disponivel then
--     return false ? '@tweeks.conta.mesa.estado.not-open';
--   end if;


  -- Validar as vendas e distirgir quais vão ser atualizado, e quais vão ser registrados e quais não vão ter acão
  for _data in
    select *
    from jsonb_array_elements( arg_vendas ) v( venda_document )
     inner join jsonb_to_record( v.venda_document ) as venl(
        arg_venda_id int,
        arg_artigo_id int,
        arg_venda_quantidade float,
        arg_venda_custounitario float,
        arg_agregas jsonb
      ) on true
           inner join tweeks.artigo art on venl.arg_artigo_id = art.artigo_id
           left join tweeks.venda ve on art.artigo_id = ve.venda_artigo_id
      and ve.venda_id = venl.arg_venda_id
      and ve.venda_estado = _const.venda_estado_aberto
    loop

      if _data.venda_id is not null then
        arg_venda_change := coalesce( arg_venda_change, jsonb_build_array());
        arg_venda_change := arg_venda_change || (_data.venda_document );
      else
        arg_venda_add := coalesce( arg_venda_add, jsonb_build_array() );
        arg_venda_add := arg_venda_add || _data.venda_document;
      end if;
    end loop;

  -- canselar todas as vendas não removidas da conta
  update tweeks.venda
  set venda_estado = _const.venda_estado_canselado,
      venda_colaborador_atualizacao = arg_colaborador_id,
      venda_dataatualizacao = current_timestamp
  where venda_id != all ( arg_vendas_id )
    and venda_conta_id = arg_conta_id
    and venda_estado = _const.venda_estado_aberto
  ;

  -- Alterar as vendas antigas
  if arg_venda_change is not null then

    perform tweeks.funct_change_venda(
      jsonb_build_object(
        'arg_colaborador_id', arg_colaborador_id,
        'arg_espaco_auth', arg_espaco_auth,
        'arg_message_error', true,
        'arg_conta_id', arg_conta_id,
        'arg_vendas', arg_venda_change
      )
    );
  end if;

  if arg_venda_add is not null then
    perform tweeks.funct_reg_venda(
      jsonb_build_object(
        'arg_colaborador_id', arg_colaborador_id,
        'arg_espaco_auth', arg_espaco_auth,
        'arg_message_error', true,
        'arg_conta_id', arg_conta_id,
        'arg_vendas', arg_venda_add
      )
    );
  end if;

  -- Quando houver alteração da mesa então mover a conta para outra mesa
  if _conta.conta_mesa_id != _mesa.mesa_id then
    update tweeks.conta
      set conta_mesa_id = _mesa.mesa_id
      where conta_id = _conta.conta_id
          returning * into _conta;
  end if;

  return true ? _res.message || jsonb_build_object(
    'conta', _conta,
    'venda', ( with asVend as (
      select to_jsonb( ve ) || jsonb_build_object( 'agrega', jsonb_agg( a ) )
        from tweeks.venda ve
            left join  agrega a on ve.venda_id = a.agrega_venda_id
          and a.agrega_estado = _const.agrega_estado_aberto
        where ve.venda_conta_id = _conta.conta_id
          and ve.venda_estado = _const.venda_estado_aberto
        group by ve.venda_id
      ) select
        array_agg( to_jsonb( av ) ) from asVend aV
    )
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 805 (class 1255 OID 16986)
-- Name: funct_change_conta_imprimir(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_conta_imprimir(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Alterar o estado da conta para imprensa
    args := {
      arg_espaco_auth: ID
      arg_colaborador_id: ID,
      arg_conta_id: ID,
    }
  */

  arg_espaco_auth uuid not null  default args->>'arg_espaco_auth';
  arg_conta_id uuid not null default args->>'arg_conta_id';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';

  _conta tweeks.conta;
  _const map.constant;
begin
  _const := map.constant();
  _conta := tweeks._get_conta( arg_conta_id );

  if _conta.conta_imprensa then
    return  true ? jsonb_build_object(
      'conta', _conta
    );
  end if;

  update tweeks.conta
    set conta_imprensa = conta_imprensa +1,
        conta_colaborador_atualizacao = arg_colaborador_id,
        conta_dataatualizacao = current_timestamp
    where conta_id = arg_conta_id
    returning * into _conta
  ;

  return true ? jsonb_build_object(
    'conta', _conta
  );

exception when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 507 (class 1255 OID 16987)
-- Name: funct_change_conta_preparar(json); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_conta_preparar(args json) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para marcar os pedidos de cosinha como preparados
    args := {
      arg_espaco_auth: ID,
      arg_colaborador_id: ID,
      arg_conta_id: ID,
    }
  */
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_conta_id uuid not null default args->>'arg_conta_id';

  _const map.constant;
  _conta tweeks.conta;

begin

  _const := map.constant();
  _conta := tweeks._get_conta( arg_conta_id );


  if _conta.conta_estado != _const.conta_estado_aberto then
    return false ? 'Não pode marcar mais pedidos dessa conta como preparado!';
  end if;

  update tweeks.venda
    set venda_estadopreparacao = _const.venda_estadopreparacao_preparado
    where venda_estadopreparacao = _const.venda_estadopreparacao_pendente
      and venda_conta_id = arg_conta_id
      and venda_estado = _const.venda_estado_aberto
  ;

  return true ? 'success';

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 750 (class 1255 OID 16988)
-- Name: funct_change_espaco(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_espaco(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para atualizar as informações do espaco
    args := {
      arg_espaco_change: ID -- id do espao que ser atualizado
      arg_espaco_vender: BOOLEAN
      arg_espaco_auth: ID
      arg_colaborador_id: ID
      arg_espaco_nome: NOME
      arg_espaco_descricao: DESCRICAO
      arg_espaco_gerarfatura: BOOLEAN
      arg_espaco_configurar: BOOLEAN
      arg_espaco_posto_admin: UUID,
      xBranch:boolean
    }
  */

  arg_espaco_vender character varying not null default args->>'arg_espaco_vender';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_espaco_change uuid not null default args->>'arg_espaco_change';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_nome character varying not null default args->>'arg_espaco_nome';
  arg_espaco_descricao character varying default args->>'arg_espaco_descricao';
  arg_espaco_gerarfatura boolean not null default args->>'arg_espaco_gerarfatura';
  arg_espaco_configurar boolean not null default args->>'arg_espaco_configurar';
  arg_espaco_posto_admin uuid default args->>'arg_espaco_posto_admin';
  xBranch boolean default args->>'xBranch';
  _espaco tweeks.espaco;
begin
  xBranch := coalesce( xBranch, false );

  --Quando for uma atualização do propietario
  if not xBranch then
    update tweeks.espaco
      set espaco_nome = arg_espaco_nome,
          espaco_descricao = arg_espaco_descricao,
          espaco_vender = arg_espaco_vender,
          espaco_gerarfatura = arg_espaco_gerarfatura,
          espaco_configurar = arg_espaco_configurar,
          espaco_posto_admin = coalesce( arg_espaco_posto_admin, espaco_posto_admin ),

          espaco_colaborador_atualizaco = arg_colaborador_id,
          espaco_dataatualizacao = current_timestamp
      where espaco_id = arg_espaco_change
      returning * into _espaco
    ;
  else
    update tweeks.espaco
      set espaco_nome = arg_espaco_nome,
          espaco_colaborador_atualizaco = arg_colaborador_id,
          espaco_dataatualizacao = current_timestamp
      where espaco_id = arg_espaco_change
      returning * into _espaco;
  end if;

  return true ? jsonb_build_object(
    'espaco', _espaco
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text; ll jsonb;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 751 (class 1255 OID 16989)
-- Name: funct_change_espaco_configuracao(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_espaco_configuracao(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para atualizar as informações do espaco
    args := {
      arg_espaco_auth: ID
      arg_colaborador_id: ID
      arg_espaco_configuracao: JSON
    }
  */
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_configuracao jsonb not null default args->'arg_espaco_configuracao';
  _espaco tweeks.espaco;
begin

  update tweeks.espaco
    set
        espaco_configuracao = arg_espaco_configuracao,
        espaco_colaborador_atualizaco = arg_colaborador_id,
        espaco_dataatualizacao = current_timestamp
    where espaco_id = arg_espaco_auth
    returning * into _espaco
  ;

  return true ? jsonb_build_object(
    'espaco', _espaco
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 806 (class 1255 OID 16990)
-- Name: funct_change_espaco_estado(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_espaco_estado(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para ativar ou desativar o estado do um artigo
    args = {
      arg_colaborador_id: ID,
      arg_espaco_id: ID
    }
  */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_id uuid not null default args->>'arg_espaco_id';
  _const map.constant;
  _espaco tweeks.espaco;
begin

  _const := map.constant();
  _espaco := tweeks._get_espaco( arg_espaco_id );

  update tweeks.espaco
    set
      espaco_estado = lib.swith( espaco_estado, _const.espaco_estado_ativo, _const.espaco_estado_fechado  ),
      espaco_colaborador_atualizaco = arg_colaborador_id,
      espaco_dataatualizacao = current_timestamp
    where espaco_id = arg_espaco_id
    returning * into _espaco
  ;

  return true ? jsonb_build_object(
    'espaco', _espaco,
    'text', case
      when _espaco.espaco_estado = _const.espaco_estado_ativo   then format( 'O espaco "%s" foi ativado!', _espaco.espaco_nome )
      when _espaco.espaco_estado = _const.espaco_estado_fechado then format( 'O espaco "%s" foi desativo!', _espaco.espaco_nome )
    end
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 509 (class 1255 OID 16991)
-- Name: funct_change_espaco_migrate(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_espaco_migrate(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
    /**
      args := {
        arg_espaco_auth: uuid
        arg_colaborador_id: uuid
        espaco_id: uuid
        espaco_espaco_id uuid
      }
     */
    _espaco tweeks.espaco;
    _loop jsonb;
    _data record;
  begin
    _espaco := jsonb_populate_record( _espaco, args );
    _loop := tweeks.__infinity_loop( _espaco );

    if _espaco.espaco_id is null or _espaco.espaco_espaco_id is null then
      return lib.res_false( 'Necessario informar qual espaco e para onde sera alocado!' );
    end if;

    if _espaco.espaco_id = _espaco.espaco_espaco_id then
      return lib.res_false( 'Não pode migrar um espaco para ele proprio' );
    end if;


    if _loop is not null then
      return lib.res_false( 'Não pode alocar em um sub-espaço!' );
    end if;

    select
      tweeks.__branch_uid( null, _espaco.espaco_id ) as local_branch,
      tweeks.__branch_uid( null, _espaco.espaco_espaco_id ) as master_branc
      into _data
    ;

    if _data.local_branch != _data.master_branc then
      return lib.res_false('Não pode migra armazem de branchs diferentes' );
    end if;

    _espaco.espaco_colaborador_atualizaco := args->>'arg_colaborador_id';
    _espaco.espaco_dataatualizacao := current_timestamp;

    select ( "returning" ).* into _espaco
      from lib.sets_up( _espaco, defaults := array[ 'espaco_nivel']::text[] )
    ;

    return lib.res_true( jsonb_build_object(
      'esapco', _espaco
    ));
  end;
$$;


--
-- TOC entry 510 (class 1255 OID 16992)
-- Name: funct_change_fornecedor_estado(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_fornecedor_estado(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função atualiza o estado do fornecedor (ativa/desativa)
    args := {
      arg_colaborador_id: ID,
      arg_fornecedor_id: ID
    }
  */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_fornecedor_id uuid not null default args->>'arg_fornecedor_id';

  _const map.constant;
  _fornecedor tweeks.fornecedor;

begin
  _const := map.constant();

  update tweeks.fornecedor
    set
      fornecedor_estado = lib.swith( fornecedor_estado,
          _const.maguita_fornecedor_estado_ativo,
          _const.maguita_fornecedor_estado_fechado
      ),
      fornecedor_dataatualizacao = current_timestamp,
      fornecedor_colaborador_atualizacao = arg_colaborador_id
    where fornecedor_id = arg_fornecedor_id
    returning * into _fornecedor;

  return true ? jsonb_build_object(
    'fornecedor', _fornecedor
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 752 (class 1255 OID 16993)
-- Name: funct_change_item_estado(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_item_estado(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para ativar ou desativar o estado do um artigo
    args = {
      arg_colaborador_id: ID,
      arg_item_id: ID
    }
  */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_item_id uuid not null default args->>'arg_item_id';
  _const map.constant;
  _artigo tweeks.artigo;
begin

  _artigo :=  tweeks._get_item( arg_item_id );
  _const := map.constant();

  if _artigo.artigo_classe_id != _const.classe_itemextra then
    return false ? '@artigo-is-not-item-extra';
  end if;


  -- Abrir ou fechar o item
  update tweeks.artigo
    set
      artigo_estado = lib.swith( artigo_estado, _const.item_estado_ativo, _const.item_estado_fechado ),
      artigo_colaborador_atualizacao = arg_colaborador_id,
      artigo_dataatualizacao = current_timestamp
    where artigo_id = arg_item_id
    returning * into _artigo
  ;

  return true ? jsonb_build_object(
    'artigo', _artigo
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 807 (class 1255 OID 16994)
-- Name: funct_change_link_disable(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_link_disable(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para desativar uma link
    args := {
      arg_link_id: ID,
      arg_colaborador_id: ID
    }
   */

  arg_link_id uuid not null default args->>'arg_link_id';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';

  _const map.constant;
  _link tweeks.link;

begin

  lock tweeks.link in share mode;

  _const := map.constant();
  _link := tweeks._get_link( arg_link_id );

  if _link.link_estado != _const.link_estado_ativo then
    return false ? '@tweeks.link.is-closed';
  end if;

  -- Fechar os links e os sublink associados a esse
  update tweeks.link
    set link_estado = _const.link_estado_fechado,
        link_colaborador_atualizacao = arg_colaborador_id,
        link_dataatualizacao = current_timestamp
    where link_id in (
      with recursive aux as (
          select a.link_id
            from tweeks.link a
            where a.link_id = arg_link_id
        union all
          select a2.link_id
            from tweeks.link a2
              inner join aux on a2.link_link_id = aux.link_id
            where a2.link_estado = _const.link_estado_ativo
      )
      select link_id
        from aux
    );

  return true ? jsonb_build_object(
    'link', _link
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 808 (class 1255 OID 16995)
-- Name: funct_change_link_move(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_link_move(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para trocar duas link de posição
    arg_link_id: ID,
    arg_colaborador_id: ID,
    arg_move_incremento: ID,
   */
  _link tweeks.link;
  _const map.constant;

  arg_link_id uuid default args->>'arg_link_id';
  arg_move_incremento int2 default args->>'arg_move_incremento';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_link_start int2;
  arg_link_end int2;
  arg_incremento int2;
begin

  lock tweeks.link in share mode;

  _link := tweeks._get_link( arg_link_id );
  _const := map.constant();

  if arg_move_incremento = 0 then
    return false ? '@tweeks.link.move-none';
  end if;

  if _link.link_posicao + arg_move_incremento < 0 then
    return false ? '@move-position-invalid';
  end if;

  if _link.link_estado != _const.link_estado_ativo then
    return false ? '@tweeks.link.is-closed';
  end if;

  if arg_move_incremento > 0 then
    arg_link_start := _link.link_posicao;
    arg_link_end := _link.link_posicao + arg_move_incremento;
    arg_incremento := -1;
  else
    arg_link_start := _link.link_posicao + arg_move_incremento;
    arg_link_end := _link.link_posicao;
    arg_incremento := 1;
  end if ;

  -- Mover as links todas
  update tweeks.link
    set link_posicao = case
        when link_id = _link.link_id then link_posicao + arg_move_incremento
        else link_posicao + arg_incremento
      end,
      link_colaborador_atualizacao = arg_colaborador_id,
      link_dataatualizacao = current_timestamp
    where link_posicao between arg_link_start and arg_link_end
      and link_espaco_destino = _link.link_espaco_destino
      and coalesce( link_link_id, -1 ) = coalesce( _link.link_link_id, -1 )
      and link_estado = _const.link_estado_ativo
  ;

  return true ? jsonb_build_object(
    'link', array(
      select a
        from tweeks.link a
        where link_posicao between arg_link_start and arg_link_end
          and link_espaco_destino = _link.link_espaco_destino
          and coalesce( link_link_id, -1 ) = coalesce( _link.link_link_id, -1 )
          and link_estado = _const.link_estado_ativo
        order by a.link_posicao
    )
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 753 (class 1255 OID 16996)
-- Name: funct_change_link_switch(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_link_switch(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para trocar duas link de posição
    arg_link_id: ID_LINK_PARENT,
    arg_espaco_destino: ID,
    arg_espaco_auth: ID,
    arg_colaborador_id: ID
    arg_link_posicao_1: POSICAO
    arg_link_posicao_2: POSICAO,
   */
  _link tweeks.link;
  _const map.constant;

  arg_link_id uuid default args->>'arg_link_id';
  arg_espaco_destino uuid default args->>'arg_espaco_destino';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_link_posicao_1 int not null default args->>'arg_link_posicao_1';
  arg_link_posicao_2 int not null default args->>'arg_link_posicao_2';
begin

  lock tweeks.link in share mode;
  _const := map.constant();

  arg_espaco_destino := coalesce( arg_espaco_destino, arg_espaco_auth );

  update tweeks.link
    set link_posicao = lib.swith( link_posicao, arg_link_posicao_1, arg_link_posicao_2 ),
        link_colaborador_atualizacao = arg_colaborador_id,
        link_dataatualizacao = current_timestamp
    where link_posicao in ( arg_link_posicao_1, arg_link_posicao_2 )
      and link_estado = _const.link_estado_ativo
      and link_espaco_destino = arg_posto_id
      and coalesce( link_link_id, -1 ) = coalesce( arg_link_id, -1 )
  ;

  return true ? jsonb_build_object(
    'link', array(
      select a
        from tweeks.link a
        where link_posicao in ( arg_link_posicao_1, arg_link_posicao_2 )
          and link_estado = _const.link_estado_ativo
          and link_espaco_destino = arg_espaco_destino
          and coalesce( link_link_id, -1 ) = coalesce( arg_link_id, -1 )
        order by a.link_posicao
    )
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 511 (class 1255 OID 16997)
-- Name: funct_change_link_unlink(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_link_unlink(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_espaco_auth: ID,
      arg_colaborador_id: ID,
      arg_link_referencia: REF
    }
   */
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_link_referencia jsonb not null default args->'arg_link_referencia';
  _const map.constant;
begin
  _const := map.constant();

  update tweeks.link
    set link_estado = _const.link_estado_fechado,
        link_colaborador_atualizacao = arg_colaborador_id,
        link_dataatualizacao = current_timestamp
    where link_referencia @> arg_link_referencia
      and link_espaco_destino = any( arg_espaco_child )
      and link_estado = _const.link_estado_associacao
      and link_tlink_id = _const.tlink_associacao
  ;

  return true ? jsonb_build_object(
    'text', 'A associação ao espaço foi desativado com sucesso'
  );
end;
$$;


--
-- TOC entry 754 (class 1255 OID 16998)
-- Name: funct_change_mesa(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_mesa(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para atualizar informação da mesa
    args := {
      arg_mesa_id: ID,
      arg_colaborador_id: ID,
      arg_mesa_designacao: DESIGNACAO,
      arg_mesa_numero: DESIGNACAO,
      arg_mesa_lotacao: DESIGNACAO
    }
   */
  arg_mesa_designacao character varying default args->>'arg_mesa_designacao';
  arg_mesa_numero character varying default args->>'arg_mesa_numero';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_mesa_id uuid not null default args->>'arg_mesa_id';
  _mesa tweeks.mesa;
begin

  -- Garantir que o numero de mesa seja unico
  if (
    select count( * ) > 0
      from tweeks.mesa m
      where m.mesa_numero =  arg_mesa_numero
        and m.mesa_id != arg_mesa_id
  ) then
    return false ? '@mesa.numero.already-exist';
  end if;

  update tweeks.mesa
    set mesa_designacao = coalesce( arg_mesa_designacao, mesa_designacao ),
        mesa_numero = coalesce( arg_mesa_numero, mesa_numero ),
        mesa_colaborador_atualizacao = arg_colaborador_id,
        mesa_dataatualizacao = current_timestamp
    where mesa_id = arg_mesa_id
    returning * into _mesa
  ;

  return true ? jsonb_build_object(
    'mesa', _mesa
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 755 (class 1255 OID 16999)
-- Name: funct_change_mesa_estado(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_mesa_estado(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função atualiza o estado da mesa
    args = {
      arg_colaborador_id: ID,
      arg_mesa_id: ID,
    }
   */
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_mesa_id uuid default args->>'arg_mesa_id';

  _const map.constant;
  _mesa tweeks.mesa;
begin

  _mesa := tweeks._get_mesa( arg_mesa_id );
  _const := map.constant();

  if _mesa.mesa_estado  not in ( _const.mesa_estado_disponivel, _const.mesa_estado_desativado ) then
    return false ? '@tweeks.mesa.estado.no-accept';
  end if;

  update tweeks.mesa
    set
      mesa_estado = lib.swith( _mesa.mesa_estado, _const.mesa_estado_disponivel, _const.mesa_estado_desativado ),
      mesa_dataatualizacao = current_timestamp,
      mesa_colaborador_atualizacao = arg_colaborador_id
    where mesa_id = arg_mesa_id
    returning * into _mesa
  ;

  return true ? jsonb_build_object(
      'mesa', _mesa
    );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 756 (class 1255 OID 17000)
-- Name: funct_change_ordem_classe(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_ordem_classe(parms jsonb) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
declare
    /** Essa função serve para caregar os artigos pelas sua categoria
      parms := [{
        parms_classe_id: ID
        parms_classe_position: SMALLINT
      }]
    */
    i jsonb;
begin
    for i in select * from jsonb_array_elements(parms)
    loop
        update tweeks.classe
            set
                classe_position = (i::jsonb ->>'parms_classe_position')::smallint
        where classe_id = (i::jsonb ->>'parms_classe_id')::uuid;
    end loop;
    return true;
end;
$$;


--
-- TOC entry 809 (class 1255 OID 17001)
-- Name: funct_change_posto_estado(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_posto_estado(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para ativar ou desativar o estado do um artigo
    args = {
      arg_colaborador_id: ID,
      arg_posto_id: ID
    }
  */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_posto_id uuid not null default args->>'arg_posto_id';
  _const map.constant;
  _posto tweeks.posto;
begin

  _const := map.constant();
  _posto := tweeks._get_posto( arg_posto_id );

  if _posto.posto_estado = _const.maguita_posto_estado_aberto then
    return false ? 'Posto não pode ser encerrado!';
  end if;

  update tweeks.posto
    set
      posto_estado = lib.swith( posto_estado, _const.maguita_posto_estado_encerado, _const.maguita_posto_estado_fechado  ),
      posto_colaborador_atualizacao = arg_colaborador_id,
      posto_dataatualizacao = current_timestamp
    where posto_id = arg_posto_id
    returning * into _posto
  ;

  return true ? jsonb_build_object(
    'artigo', _posto,
    'artigo_old', _posto,
    'text', case
      when _posto.posto_estado = _const.maguita_posto_estado_fechado   then format( 'O posto "%s" foi ativado!', _posto.posto_designacao )
      when _posto.posto_estado = _const.maguita_posto_estado_encerado then format( 'O posto "%s" foi desativo!', _posto.posto_designacao )
    end
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 512 (class 1255 OID 17002)
-- Name: funct_change_posto_open(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_posto_open(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para que um colaborador abra a posto
    args := {
      arg_colaborador_id: ID,
      arg_colaborador_proprietario: ID,
      arg_posto_montante: MONTANTE
    }
   */

  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_colaborador_proprietario uuid not null default args->>'arg_colaborador_proprietario';
  arg_posto_montanteinicial double precision not null default args->>'arg_posto_montanteinicial';

  _const map.constant;
  _posto record;

begin
  _const := map.constant();

  select * into _posto
    from tweeks.posto cx
    where cx.posto_colaborador_proprietario = arg_colaborador_proprietario
      and cx.posto_estado in ( _const.posto_estado_ativo, _const.posto_estado_pendete )
  ;

  if _posto.posto_id is null then
    return false ? '@posto.colaborador.not-found';
  end if;

  if _posto.posto_montanteinicial != arg_posto_montanteinicial then
    return false ? 'Montante inicial incorreto!';
  end if;

  update tweeks.posto
    set posto_estado = _const.posto_estado_ativo,
        posto_colaborador_atualizacao = arg_colaborador_id,
        posto_dataatualizacao = current_timestamp
    where posto_id = _posto.posto_id
    returning * into _posto
  ;

  return true ? jsonb_build_object(
    'posto', _posto
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 513 (class 1255 OID 17003)
-- Name: funct_change_tipoimposto_estado(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_tipoimposto_estado(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_tipoimposto_id: ID,
      arg_colaborador_id: ID,
    }
   */
  arg_tipoimposto_id int2 not null default args->>'arg_tipoimposto_id';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  _tipoimposto tweeks.tipoimposto;
  _const map.constant;
begin
  _const := map.constant();
  update tweeks.tipoimposto
    set tipoimposto_estado = lib.swith( tipoimposto_estado, _const.tipoimposto_estado_ativo, _const.tipoimposto_estado_fechado ),
        tipoimposto_colaborador_atualizacao = arg_colaborador_id,
        tipoimposto_dataatuzaliacao = current_timestamp
    where tipoimposto_id = arg_tipoimposto_id
    returning * into _tipoimposto
  ;

  return true ? jsonb_build_object(
    'tipoimposto', _tipoimposto
  );

end;
$$;


--
-- TOC entry 597 (class 1255 OID 17004)
-- Name: funct_change_venda(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_venda(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para associar mais vendas a conta
    args := {
      arg_colaborador_id: ID,
      arg_conta_id: ID,
      arg_message_error: TRUE|FALSE,
      arg_espaco_auth: ID,
      arg_vendas: [
        {
          arg_venda_id: ID,
          arg_venda_quantidade: QUANT,
          arg_venda_custounitario: CUSTO,

          arg_agregas: [
            {
              arg_item_id: ID,
              arg_item_quantidadecusto: QUANT/CUSTO
              arg_agrega_quantidade: QUANT,
              arg_item_custo: CUSTO,
              arg_agrega_montante: MONTANTE
            }
          ]
        }
      ]
    }*/

  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_conta_id uuid not null default args->>'arg_conta_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_vendas jsonb not null default args->>'arg_vendas';
  arg_message_error boolean not null default args->>'arg_message_error';

  -- colocar todos os id dos artigos em uma lista
  arg_artigos_id uuid [ ] default array( select ( doc.venda->>'arg_artigo_id' )::uuid  from jsonb_array_elements( arg_vendas ) doc( venda ) );

  arg_items_id uuid [ ];

  _const map.constant;
  _conta tweeks.conta;
  _data record;
  _venda tweeks.venda;

begin
  arg_message_error := coalesce( arg_message_error, true );

  _const := map.constant();
  _conta := tweeks._get_conta( arg_conta_id );


  -- Garrantir que tenha o stock disponivel para os artigos
  with novas_vendas as (
    select
        ( dos.venda->>'arg_venda_id' )::uuid as arg_venda_id,
        ( dos.venda->>'arg_artigo_id' )::uuid as arg_artigo_id,
        ( dos.venda->>'arg_venda_quantidade' )::double precision as arg_venda_quantidade,
        ( dos.venda->>'arg_venda_custounitario' )::double precision as arg_venda_custounitario,
        dos.venda->'arg_agregas' as arg_agregas
    from jsonb_array_elements( arg_vendas ) dos( venda )
  )
  select
      count( art.artigo_id ) as artigo_total,
      string_agg( art.artigo_nome, ', ' ) as artigo_nomes
      into _data
    from novas_vendas vds
      inner join tweeks.venda ve on vds.arg_venda_id = ve.venda_id
      inner join tweeks.artigo art on ve.venda_artigo_id = art.artigo_id
      inner join tweeks.stock st on art.artigo_id = st.stock_artigo_id
    where st.stock_espacao_id = arg_espaco_auth
      and not rule.artigo_has_stock( art.artigo_id, arg_espaco_auth, vds.arg_venda_quantidade -  ve.venda_quantidade )
  ;

  if _data.artigo_total > 0 and arg_message_error then
    raise exception '%', format( 'Os stock dos produtos "%s" não cobrem a venda para essa conta', _data.artigo_nomes );

  elsif _data.artigo_total > 0 then
    return false ? format( 'Os stock dos produtos "%s" não cobrem a venda para essa conta', _data.artigo_nomes );
  end if;


  -- Registar as novas vendas a conta
  for _data in
    with novas_vendas as (
      select
          ( dos.venda->>'arg_venda_id' )::uuid as arg_venda_id,
          ( dos.venda->>'arg_artigo_id' )::uuid as arg_artigo_id,
          ( dos.venda->>'arg_venda_quantidade' )::double precision as arg_venda_quantidade,
          ( dos.venda->>'arg_venda_custounitario' )::double precision as arg_venda_custounitario,
          dos.venda -> 'arg_agregas' as arg_agregas
        from jsonb_array_elements( arg_vendas ) dos( venda )
    )
    select *
      from novas_vendas nv
        inner join tweeks.venda ve on nv.arg_venda_id = ve.venda_id
  loop
    _data.venda_custounitario := _data.arg_venda_custounitario;
    _data.venda_quantidade := _data.arg_venda_quantidade;

    -- Anular o valor do montante anterior em campo montante
    _data.venda_montantetotal := _data.venda_montantetotal - _data.venda_montente;

    -- Atualizar o valor de novo montante
    _data.venda_montente := _data.arg_venda_quantidade * _data.arg_venda_custounitario;

    -- Atualizar o valor de montante total
    _data.venda_montantetotal := _data.venda_montantetotal + _data.venda_montente;

    update tweeks.venda
      set venda_quantidade = _data.venda_quantidade,
          venda_custounitario = _data.venda_custounitario,
          venda_montente = _data.venda_montente,
          venda_montantetotal = _data.venda_montantetotal,
          venda_espaco_auth = arg_espaco_auth
      where venda_id = _data.venda_id
      returning * into _venda
    ;

    arg_items_id := array( select ( doc.agrega->>'arg_item_id' )::uuid  from jsonb_array_elements( _data.arg_agregas ) doc( agrega ) );
    -- desagregar o item da venda
    update tweeks.agrega
      set agrega_estado = _const.agrega_estado_canselado,
          agrega_colaborador_atualizacao = arg_colaborador_id,
          agrega_dataatualizacao = current_timestamp
      where agrega_venda_id = _data.venda_id
        and agrega_artigo_item != all( arg_items_id )
        and agrega_estado = _const.agrega_estado_aberto
    ;

    -- aggregar os novos item a venda
    with item_preco as (
      select
        ( doc.agrega->>'arg_agrega_quantidade' )::double precision as arg_agrega_quantidade,
        ( doc.agrega->>'arg_item_quantidadecusto' )::double precision as arg_item_quantidadecusto,
        ( doc.agrega->>'arg_item_custo' )::double precision as arg_item_custo,
        ( doc.agrega->>'arg_item_id' )::uuid as arg_item_id
      from jsonb_array_elements( _data.arg_agregas ) doc( agrega )
    )
    insert into tweeks.agrega (
      agrega_venda_id,
      agrega_artigo_item,
      agrega_colaborador_id,
      agrega_quantidade,
      agrega_custounitario,
      agrega_montante,
      agrega_espaco_auth
    )
    select
        _data.venda_id,
        it.artigo_id,
        arg_colaborador_id,
        ip.arg_agrega_quantidade,
        ip.arg_item_custo,
        rule.calculate_cost( ip.arg_item_quantidadecusto, ip.arg_item_custo, ip.arg_agrega_quantidade ),
        arg_espaco_auth
      from tweeks.artigo it
        inner join item_preco ip on it.artigo_id = ip.arg_item_id
        left join agrega a on it.artigo_id = a.agrega_artigo_item
          and a.agrega_estado = _const.agrega_estado_aberto
      where it.artigo_id = any ( arg_items_id )
        and a.agrega_id is null
    ;

    -- Aplicar o calculo do imposto
    perform tweeks.funct_reg_vendaimposto(
      jsonb_build_object(
        'arg_colaborador_id', arg_colaborador_id,
        'arg_venda_id', _venda.venda_id,
        'arg_artigo_id', _venda.venda_artigo_id,
        'arg_espaco_auth', arg_espaco_auth
      )
    );

  end loop;

  return true ? jsonb_build_object(
    'venda', array (
      select to_jsonb( ve ) || jsonb_build_object(
          'venda_item', jsonb_agg( to_jsonb( agg ) || to_jsonb( it) )
        )
        from tweeks.venda ve
          left join tweeks.agrega agg on ve.venda_id = agg.agrega_venda_id
            and agg.agrega_estado = _const.agrega_estado_aberto
          left join tweeks.artigo it on agg.agrega_artigo_item = it.artigo_id
        where ve.venda_conta_id = arg_conta_id
          and ve.venda_artigo_id = any( arg_artigos_id )
          and ve.venda_estado = _const.venda_estado_aberto
        group by ve.venda_id
    ),

    'venda_all', array (
      select to_jsonb( ve ) || jsonb_build_object(
          'venda_item', jsonb_agg( to_jsonb( agg ) || to_jsonb( it) )
        )
        from tweeks.venda ve
          left join tweeks.agrega agg on ve.venda_id = agg.agrega_venda_id
            and agg.agrega_estado >= _const.agrega_estado_aberto
          left join tweeks.artigo it on agg.agrega_artigo_item = it.artigo_id
        where ve.venda_conta_id = arg_conta_id
          and ve.venda_estado >= _const.venda_estado_aberto
        group by ve.venda_id
    )
  );
end;
$$;


--
-- TOC entry 854 (class 1255 OID 19514)
-- Name: funct_change_venda_preparado(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_change_venda_preparado(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
    declare
      /**
          args := {
            arg_colaborador_id: UID
            arg_espaco_auth: UID
            arg_conta_id: UID
            arg_vendas: [UID, UID, ..., UID]
          }
       */
      arg_colaborador_id uuid default args->>'arg_colaborador_id';
      arg_espaco_auth uuid default args->>'arg_espaco_auth';
      
      ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
      vendas uuid[] default array( select e.text from jsonb_array_elements_text( args->'arg_vendas' ) e( text) );
      _const map.constant;
      updates tweeks.venda[];
    begin
      _const := map.constant();
      with __update as (
          update tweeks.venda
            set venda_estadopreparacao = _const.maguita_venda_estadopreparacao_preparado,
                venda_colaborador_atualizacao = arg_colaborador_id
            where venda_id = any( vendas )
              and _branch_uid = ___branch
              and venda_estado = _const.maguita_venda_estadopreparacao_pendente
            returning *
      ) select array_agg( u ) into updates
          from __update u 
      ;
      
      
      return lib.res_true( jsonb_build_object(
        'venda', updates
      ));
    end;
  $$;


--
-- TOC entry 791 (class 1255 OID 17006)
-- Name: funct_generate_chave(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_generate_chave(args jsonb DEFAULT NULL::jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  _chave tweeks.chave;
  arg_chave_descricao character varying default args->>'arg_chave_descricao';
  letters character varying default 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  numbers character varying default '0123456789';
begin
  _chave.chave_temporarai := format( '%s-%s-%s',
      lib.dset_random_text( letters, 3 ),
      lib.dset_random_text( numbers||letters||numbers, 3 ),
      lib.dset_random_text( numbers, 3 )
  );
  insert into tweeks.chave(
    chave_temporarai,
    chave_descricao
  ) values (
    _chave.chave_temporarai,
    arg_chave_descricao
  ) returning * into _chave;
  return next  to_jsonb( _chave );
end;
$$;


--
-- TOC entry 757 (class 1255 OID 17007)
-- Name: funct_load_acerto(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_acerto(filter jsonb) RETURNS TABLE(acerto_id uuid, acerto_quantidade double precision, acerto_diferenca double precision, acerto_quantidadeinicial double precision, acerto_observacao character varying, acerto_estado smallint, acerto_dataregistro timestamp with time zone, acerto_dataatualizacao timestamp with time zone, artigo_id uuid, artigo_nome character varying, artigo_codigo character varying, espaco_id uuid, espaco_nome character varying)
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para devolver a listagem dos acertos

  filter := {
    arg_artigo_id: ID,
    arg_espaco_id: ID
    arg_espaco_auth: ID
  }
  */

  arg_artigo_id uuid default filter ->>'arg_artigo_id';
  arg_espaco_auth uuid not null default filter ->>'arg_espaco_auth';
  arg_espaco_id uuid default filter ->>'arg_espaco_id';
  arg_espaco_loads uuid[] default rule.espaco_get_childrens( arg_espaco_auth );
begin

  return query
    select
        acc.acerto_id,
        acc.acerto_quantidade,
        acc.acerto_diferenca,
        acc.acerto_quantidadeinicial,
        acc.acerto_observacao,
        acc.acerto_estado,
        acc.acerto_dataregistro,
        acc.acerto_dataatualizacao,

        art.artigo_id,
        art.artigo_nome,
        art.artigo_codigo,

        esp.espaco_id,
        esp.espaco_nome
      from tweeks.acerto acc
        inner join tweeks.stock sto on acc.acerto_stock_id = sto.stock_id
        inner join tweeks.artigo art on sto.stock_artigo_id = art.artigo_id
        inner join tweeks.espaco esp on sto.stock_espacao_id = esp.espaco_id
      where art.artigo_id = coalesce( arg_artigo_id, art.artigo_id )
        and esp.espaco_id = coalesce( arg_espaco_id, esp.espaco_id )
        and esp.espaco_id = any( arg_espaco_loads )
    ;
end;
$$;


--
-- TOC entry 810 (class 1255 OID 17008)
-- Name: funct_load_artig_check_nome(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_artig_check_nome(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função devolve todos os artigos com os nomes expecificados
    filter := {
      arg_espaco_auth: ID
      arg_artigo_nome: [
        @+nome/artigo,
        @+nome/artigo,
        @+nome/artigo,
        @+nome/artigo
      ]
    }
   */
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_artigo_nome character varying [] default array( select lib.str_normalize( public.unaccent( lower( names ) ) ) from jsonb_array_elements_text( filter->'arg_artigo_nome' ) names );
  arg_espaco_child uuid[] := rule.espaco_get_childrens( arg_espaco_auth );
begin
  return query
    select lib.jsonb_values(
          to_jsonb( art ),
          'artigo_id',
          'artigo_nome',
          'artigo_custo',
          'artigo_descricao',
          'artigo_dataregistro'
        )
      from tweeks.artigo art
      where lower( lib.str_normalize( lower( public.unaccent( art.artigo_nome ) ) ) ) = any ( arg_artigo_nome )
        and art.artigo_espaco_auth = any( arg_espaco_child )
    ;
end;
$$;


--
-- TOC entry 892 (class 1255 OID 17009)
-- Name: funct_load_artigo(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_artigo(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
    /**
        Essa função serve para carregar os artigos registrado
        args := {
          arg_espaco_auth: ID
          arg_colaborador_id: ID
          arg_classe_id: ID
          arg_artigo_estado: ARTIGO_ESTADO
          query: {
            any?: CODE|NAME|DESCRICAO
            code?: CODE
            name?: NAME
            desc?: DESCRICAO
          }
        }
   */
    arg_espaco_auth uuid default args->>'arg_espaco_auth';
    arg_colaborador_id uuid default args->>'arg_colaborador_id';
    arg_espaco_childs uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth );
    arg_classe_id uuid default args->>'arg_classe_id';
    arg_artigo_estado int2 default args->>'arg_artigo_estado';

    _query_any text  default lower( args->'query'->>'any' );
    _query_code text default lower( args->'query'->>'code' );
    _query_name text default lower( args->'query'->>'name' );
    _query_desc text default lower( args->'query'->>'desc' );
    _const map.constant;
    _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
begin
    _const := map.constant();

    /**
      ID, NOME, STOCK, PRECO, [STOK-MINIMO], FOTO
     */
    return query
        with
          __stock as (
            select
                artigo_id as stock_artigo_id,
                espaco_id as stock_espaco_id,
                stock_quantidade as stock_quantidade
              from tweeks.__fluxo_stock(
                _branch := _branch,
                _espaco_uid := arg_espaco_auth,
                _classe_uid := arg_classe_id
              )
          ), __artigo as (
            select
                art.artigo_id,
                art.artigo_codigo,
                art.artigo_descricao,
                art.artigo_nome,
                art.artigo_compostoquantidade,
                art.artigo_artigo_id,
                u.unit_id,
                u.unit_code,
                u.unit_name,
                
                uorig.unit_id as unit_originid,
                uorig.unit_code as unit_origncode,
                uorig.unit_name as unit_origenname,

                art.artigo_espaco_auth = any( arg_espaco_childs ) as artigo_owner,
                coalesce( s.stock_quantidade, 0 ) as stock_quantidade,
                art.artigo_foto,
                art.artigo_espaco_auth,
                art.artigo_classe_id,
                art.artigo_estado,
                art.artigo_stocknegativo,
                art.artigo_codigoimposto,
                origin.artigo_id as origin_id,
                origin.artigo_codigo as origin_codigo,
                origin.artigo_descricao as orign_descricao,
                origin.artigo_nome as origin_nome,
                origin.artigo_compostoquantidade as orign_compostoquantidade,
                origin.artigo_artigo_id as origin_origin_id,

                coalesce( array_agg( l.link_espaco_destino ) filter ( where l.link_id is not null ), array[]::uuid[] )  as links,
                ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'precario_custo' as precario_custo,
                ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'precario_quantidade' as precario_quantidade,
                ( ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'stock_minimo' )::double precision as link_stockminimo
              from tweeks.artigo art
                left join tweeks.unit u on art.artigo_unit_id = u.unit_id
                left join tweeks.artigo origin on art.artigo_artigo_id = origin.artigo_id
                left join tweeks.unit uorig on origin.artigo_unit_id = uorig.unit_id
                left join tweeks.link l on l.link_estado = _const.maguita_link_estado_ativo
                  and l.link_referencia = rule.artigo_referencia( art.artigo_id )
                  and l.link_espaco_destino = any( arg_espaco_childs )
                  and l.link_tlink_id = _const.maguita_tlink_preco
                  and l._branch_uid = _branch
                left join __stock s on art.artigo_id = s.stock_artigo_id and s.stock_espaco_id = arg_espaco_auth
              where art._branch_uid = _branch
              group by 
                art.artigo_id,
                u.unit_id,
                uorig.unit_id,
                origin.artigo_id,
                s.stock_quantidade
          ), __filter as (
            select *,
                coalesce( art.link_stockminimo ) as stock_minimo
              from __artigo art
              where ( coalesce( art.links, array[]::uuid[] )||art.artigo_espaco_auth ) && arg_espaco_childs
                and art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id )
                and art.artigo_estado = coalesce( arg_artigo_estado, art.artigo_estado )
         ), __filter_query as (
            select *
            from __filter f
            where arg_classe_id is not null or f.artigo_classe_id != _const.classe_itemextra
            order by
              case
                when f.artigo_estado = _const.artigo_estado_ativo then 1
                else 2
              end,
              case
                when f.artigo_espaco_auth = arg_espaco_auth then 1
                when f.artigo_espaco_auth = any( arg_espaco_childs ) then 2
                else 3
              end,
              case
                when stock_quantidade < f.stock_minimo then 1
                when stock_quantidade = f.stock_minimo then 2
                else 3
               end,
               f.artigo_nome
           ), __query as (
             select *
                from __filter_query _f
                where true
                  and lower( _f.artigo_codigo ) = lower( coalesce( _query_code, _f.artigo_codigo ) )
                  and lower( _f.artigo_nome ) like lower( format( '%%%s%%', coalesce( _query_name, _f.artigo_nome ) ) )
                  and lower( coalesce( _f.artigo_descricao, '' ) ) like lower( format( '%%%s%%', coalesce( _query_desc, _f.artigo_descricao ) ) )
                  and (
                    lower( _f.artigo_codigo ) = lower( coalesce( _query_any, _f.artigo_codigo ) )
                    or lower( _f.artigo_nome) like lower( format( '%%%s%%', coalesce( _query_any, _f.artigo_nome ) ) )
                    or lower( coalesce( _f.artigo_descricao, '' ) ) like lower( format( '%%%s%%', coalesce( _query_any, _f.artigo_descricao, '' ) ))
                  )
          ) select to_jsonb( _q ) - 'links'
              from __query _q
    ;
end
$$;


--
-- TOC entry 759 (class 1255 OID 17010)
-- Name: funct_load_artigo_associar(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_artigo_associar(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para carregar os artigos associados
    filter := {
      arg_espaco_auth: ID
    }
  */
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  _const map.constant;
begin
  _const := map.constant();

  return query
    with aux as (
      select *
        from tweeks.link l
          inner join tweeks.artigo art on l.link_artigo_id = art.artigo_id
        where l.link_estado = _const.link_estado_associacao
          and l.link_tlink_id = _const.tlink_associacao
          and l.link_espaco_destino = arg_espaco_auth
          and art.artigo_estado = _const.artigo_estado_ativo
    ) select lib.jsonb_values(
      aux,
      'link_id',
      'artigo_id',
      'artigo_nome'
    )
    from aux;
end;
$$;


--
-- TOC entry 858 (class 1255 OID 17011)
-- Name: funct_load_artigo_base(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_artigo_base(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    arg_espaco_auth: UID
    arg_colaborador_id: UID
    arg_artigo_composto: UID

    arg_classe_id: ID
        arg_artigo_estado: ARTIGO_ESTADO
        query: {
          any?: CODE|NAME|DESCRICAO
          code?: CODE
          name?: NAME
          desc?: DESCRICAO
        }
   */
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_artigo_composto uuid default args->>'arg_artigo_composto';

  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _artigo tweeks.artigo;
  _result record;
begin
  _artigo := tweeks._get_artigo( arg_artigo_composto );

  with recursive __artigos as (
    select
        art.artigo_id,
        art.artigo_nome,
        art.artigo_artigo_id,
        array[ art.artigo_id ]::uuid[] as path
      from tweeks.artigo art
      where art._branch_uid = ___branch
        and art.artigo_artigo_id is null
    union all
      select
          es.artigo_id,
          es.artigo_nome,
          es.artigo_artigo_id,
          _e.path || es.artigo_id
        from __artigos _e
          inner join tweeks.artigo es on _e.artigo_id = es.artigo_artigo_id
        where es._branch_uid = ___branch
  ) select array_agg( _art.artigo_id ) as artigos into _result
      from __artigos _art
      where  arg_artigo_composto is null or (
          arg_artigo_composto != all( _art.path )
        and _art.artigo_id != coalesce( _artigo.artigo_artigo_id, _artigo.artigo_id )
        and _art.artigo_id != _artigo.artigo_id
      )
  ;
  
  return query
    select e.document
      from tweeks.funct_load_artigo( args ) e( document )
      where (e.document->>'artigo_id')::uuid = any( _result.artigos )
  ;
end;
$$;


--
-- TOC entry 811 (class 1255 OID 17013)
-- Name: funct_load_artigo_data(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_artigo_data(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_espaco_auth: UUDI,
      arg_colaborador_id: UUID,
      artigos:[
        UUID, UUID, UUID
      ]
    }
   */
  arg_espaco_auth uuid not null default args ->>'arg_espaco_auth';
  arg_colaborador_id uuid not null default args ->>'arg_colaborador_id';
  artigos uuid[] default array( select e.text::uuid from jsonb_array_elements_text( args->'artigos' ) e( text ));
  _const map.constant;
begin
  _const := map.constant();

  return query
    with
      __extras as (
        select
            d.dispoe_artigo_id,
            array_agg( to_jsonb( d ) || jsonb_build_object( 'artigo_nome', art.artigo_nome) ) as extras
          from tweeks.dispoe d
            inner join tweeks.artigo art on d.dispoe_artigo_item = art.artigo_id
          where d.dispoe_artigo_id = any( artigos )
            and d.dispoe_estado = _const.dispoe_estado_ativo
          group by d.dispoe_artigo_id
      ), __eans as (
        select
            e.ean_artigo_id,
            array_agg( to_jsonb( e ) ) as eans
          from tweeks.ean e
          where e.ean_artigo_id = any( artigos )
            and e.ean_estado = _const.maguita_ean_estado_ativo
          group by e.ean_artigo_id
    ), __links as (
      select
          art.artigo_id,
          array_agg( to_jsonb( l ) )  as links
        from tweeks.link l
          inner join tweeks.artigo art on  l.link_referencia @> lib.sets_ref( art )
        where l.link_tlink_id = _const.maguita_tlink_preco
          and art.artigo_id = any( artigos )
          and l.link_estado = _const.maguita_link_estado_ativo
        group by art.artigo_id
    ), __impostos as (
      select
          ip.imposto_artigo_id,
          array_agg( to_jsonb( ip ) ) as impostos
        from tweeks.imposto ip
        where ip.imposto_artigo_id = any( artigos )
          and ip.imposto_estado = _const.maguita_imposto_estado_ativo
        group by ip.imposto_artigo_id
    ), __artigos as (
        select art.*, cla.*, to_jsonb( a ) as artigo_base
          from tweeks.artigo art
            left join tweeks.artigo a on art.artigo_artigo_id = a.artigo_id
            left join tweeks.classe cla on art.artigo_classe_id = cla.classe_id
          where art.artigo_id = any( artigos )
    ), __exports as (
      select
          e.extras,
          ea.eans,
          l.links,
          ip.impostos,
          a.*
        from __artigos a
          left join __extras e on a.artigo_id = e.dispoe_artigo_id
          left join __eans ea on a.artigo_id = ea.ean_artigo_id
          left join __links l on a.artigo_id = l.artigo_id
          left join __impostos ip on a.artigo_id = ip.imposto_artigo_id
    ) select to_jsonb( exp )
      from __exports exp
    ;
end
$$;


--
-- TOC entry 521 (class 1255 OID 17015)
-- Name: funct_load_artigo_simple(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_artigo_simple(filter jsonb DEFAULT NULL::jsonb) RETURNS TABLE(artigo_id uuid, artigo_nome character varying, artigo_descricao character varying)
    LANGUAGE plpgsql
    AS $$
declare
  /** Devolver uma lista simples de artigos
    filter :{
      arg_espaco_auth: ID
    }
  */
  arg_espaco_auth uuid default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth );
  _const map.constant;

begin
  _const := map.constant();
  return query
    select
        art.artigo_id,
        art.artigo_nome,
        art.artigo_descricao
      from tweeks.artigo art
      where art.artigo_estado = _const.artigo_estado_ativo
        and art.artigo_classe_id != _const.classe_itemextra
        and art.artigo_espaco_auth = any( arg_espaco_child )
  ;
end;
$$;


--
-- TOC entry 886 (class 1255 OID 19720)
-- Name: funct_load_autorizacao(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_autorizacao(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
  {
    arg_colaborador_id: UID
    arg_espaco_auth: UID
  }
 */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _espaco_child uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth );

  _const map.constant;

begin
  _const := map.constant();
  return query
    with __autorizacao as (
      select
          a.autorizacao_uid,
          a.autorizacao_numero,
          a.autorizacao_ano,
          a.autorizacao_estado,
          a.autorizacao_designacao,
          a.autorizacao_dataregistro,
          e.espaco_id,
          e.espaco_nome,
          count( at.* ) filter ( where at.autorizacao_ano > a.autorizacao_ano ) as autorizacao_postone,
          count( at.* ) filter ( where at.autorizacao_ano < a.autorizacao_ano ) as autorizacao_previews
        from tweeks.autorizacao a
          inner join tweeks.espaco e on a.autorizacao_espaco_uid = e.espaco_id
          left join tweeks.autorizacao at on at.autorizacao_espaco_uid = a.autorizacao_espaco_uid
            and at._branch_uid = a._branch_uid
            and at.autorizacao_ano != a.autorizacao_ano
        where a._branch_uid = arg_branch_uid
          and true in (
            a.autorizacao_espaco_auth = any( _espaco_child ),
            a.autorizacao_espaco_uid = any( _espaco_child )
          )
        group by
          a.autorizacao_uid,
          e.espaco_id
    ), __continue as (
       select
            at.*,
            case
              when at.autorizacao_estado = _const.maguita_autorizacao_estado_fechado and at.autorizacao_postone = 0 then true
              else false
            end as autorizacao_continue
          from __autorizacao at
    ) select to_jsonb( _a )
        from __continue _a
        order by _a.autorizacao_ano desc,
          _a.autorizacao_dataregistro desc
  ;
end;
$$;


--
-- TOC entry 814 (class 1255 OID 17017)
-- Name: funct_load_branch(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_branch(args jsonb DEFAULT NULL::jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
begin
  return query with
    __branh as (
      select
          b.branch_uid,
          b.branch_name,
          b.branch_path,
          b.branch_licence,
          b.branch_grants,
          b.branch_main_user,
          b.branch_main_workspace,
          b.branch_clusters,
          b.branch_date,
          b.branch_update,
          b.branch_state,
          tb.*,
          e.espaco_id,
          e.espaco_nome,
          e.espaco_nivel,
          e.espaco_estado,
          e.espaco_codigo,
          e.espaco_vender,
          c.colaborador_id,
          c.colaborador_nome,
          c.colaborador_email,
          c.colaborador_apelido,
          c.colaborador_tipo
        from tweeks.branch b
          inner join tweeks.tbranch tb on  b.branch_tbranch_id = tb.tbranch_id
          left join tweeks.espaco e on b.branch_uid = e.espaco_branch_uid
            and e.espaco_id = b.branch_main_workspace
          left join auth.colaborador c on b.branch_uid = c.colaborador_branch_uid
            and c.colaborador_id = b.branch_main_user
    ) select to_jsonb( _b )
      from __branh _b
  ;
end;
$$;


--
-- TOC entry 760 (class 1255 OID 17018)
-- Name: funct_load_caixa(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_caixa(filter jsonb DEFAULT NULL::jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
    /** Essa função serve para devolver todas as caixas
      arg_espaco_auth: ID,
      arg_caixa_estado: [ ],
      arg_posto_showmontante: boolean,

     */
    arg_espaco_auth uuid default filter->>'arg_espaco_auth';
    arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth );
    arg_caixa_estado int2[] default array( select jsonb_array_elements_text( filter->'arg_caixa_estado' )::int2 );
    arg_posto_showmontante boolean default filter->>'arg_posto_showmontante';
    arg_show  text[];
    _const map.constant;
begin
    _const := map.constant();

    if filter->'arg_caixa_estado' is null then
        arg_caixa_estado := array[ _const.caixa_estado_ativo ];
    end if;

    arg_show := array[
        'caixa_id',
        'caixa_montanteinicial',
        'caixa_montantefecho',
        'caixa_montanteinicialposto',
        'caixa_montantefechoposto',
        'caixa_quantidadecheque',
        'caixa_observacao',
        'posto_id',
        'posto_designacao',
        'colaborador_id',
        'colaborador_nome',
        'colaborador_apelido'
        ];

    if arg_posto_showmontante then
        arg_show := arg_show || array[
            'posto_montante',
            'conta_cheques',
            'conta_montantevenda',
            'caixa_montante'
            ];
    end if;

    return query
        with loads as (
            select
                cx.*,
                pos.*,
                col.*,
                count( distinct ct.conta_id ) conta_cheques,
                sum( ct.conta_montante ) as conta_montantevenda,
                cx.caixa_montanteinicial + sum( ct.conta_montante ) as caixa_montante
            from tweeks.caixa cx
                     inner join tweeks.posto pos on cx.caixa_posto_id = pos.posto_id
                     inner join auth.colaborador col on cx.caixa_colaborador_id = col.colaborador_id
                     left join tweeks.conta ct on cx.caixa_id = ct.conta_caixa_fechopagamento
                and ct.conta_estado = _const.conta_estado_pago
            where cx.caixa_estado = any( arg_caixa_estado )
              and cx.caixa_espaco_auth = any( arg_espaco_child )
            group by cx.caixa_id,
                     pos.posto_id,
                     col.colaborador_id
            order by
                case
                    when cx.caixa_estado = _const.caixa_estado_ativo then 1
                    when cx.caixa_estado = _const.cambio_estado_fechado then 3
                    else 2
                    end asc,
                cx.caixa_dataregistro desc
        ) select lib.jsonb_values( to_jsonb( l ), variadic arg_show )
        from loads l
    ;
end;
$$;


--
-- TOC entry 815 (class 1255 OID 17019)
-- Name: funct_load_caixa_by_colaborador(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_caixa_by_colaborador(filter jsonb) RETURNS TABLE(caixa_id uuid, caixa_montanteinicial double precision, caixa_estado smallint, caixa_dataregistro timestamp with time zone, caixa_dataatualizacao timestamp with time zone, posto_id uuid, posto_designacao character varying, posto_montante double precision, posto_estado smallint, posto_dataregistro timestamp with time zone, posto_dataatualizacao timestamp with time zone, espaco_id uuid, espaco_nome character varying)
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para carragar a posto do colaborador
    filter := {
      arg_colaborador_id: ID,
    }
   */
  arg_colaborador_id uuid default filter->>'arg_colaborador_id';
  _const map.constant;
begin
  _const := map.constant();

  return query
    select
      ab.caixa_id,
      ab.caixa_montanteinicial,
      ab.caixa_estado,
      ab.caixa_dataregistro,
      ab.caixa_dataatualizacao,
      cx.posto_id,
      cx.posto_designacao,
      cx.posto_montante,
      cx.posto_estado,
      cx.posto_dataregistro,
      cx.posto_dataatualizacao,
      esp.espaco_id,
      esp.espaco_nome
    from tweeks.caixa ab
      inner join tweeks.posto cx on ab.caixa_posto_id = cx.posto_id
      inner join tweeks.espaco esp on cx.posto_espaco_id = esp.espaco_id
    where ab.caixa_colaborador_id = arg_colaborador_id
      and ab.caixa_estado = _const.caixa_estado_ativo
      and cx.posto_estado = _const.posto_estado_aberto
  ;
end;
$$;


--
-- TOC entry 523 (class 1255 OID 17020)
-- Name: funct_load_cambio_ativo(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_cambio_ativo(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql STRICT
    AS $$
declare
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _const map.constant;
  _data record;
begin
  _const := map.constant();

  select * into _data
    from geoinfo.currency cu 
      left join tweeks.cambio cb on cb.cambio_currency_id = cu.currency_id
        and cb.cambio_estado = _const.cambio_estado_ativo
        and cb.cambio_espaco_auth = arg_espaco_auth
        and cb._branch_uid = ___branch
    where upper( cu.currency_code )  = 'STN'
  ;
  
  if _data.cambio_id is null then
    insert into tweeks.cambio (
      cambio_currency_id,
      cambio_espaco_auth, 
      cambio_colaborador_id, 
      cambio_taxa, 
      _branch_uid
    ) values (
      _data.currency_id,
      arg_espaco_auth,
      _const.colaborador_system_data,
      1,
      ___branch
    );
  end if;

  return query
    with __cambio as (
      select
          cb.cambio_id,
          cb.cambio_data,
          cb.cambio_taxa,
          cb.cambio_dataregistro,
          cu.currency_id,
          cu.currency_name,
          cu.currency_code,
          cu.currency_symbol,
          rank() over ( partition by cb.cambio_currency_id order by
            case when cambio_espaco_auth = arg_espaco_auth then 1 else 2 end,
            cb.cambio_dataregistro desc )  as cambio_rank
        from tweeks.cambio cb
          inner join geoinfo.currency cu on cb.cambio_currency_id = cu.currency_id
        where cb.cambio_estado = _const.cambio_estado_ativo
          and cb.cambio_espaco_auth = arg_espaco_auth
          and cb._branch_uid = ___branch
    ) select
        to_jsonb( cb )
      from __cambio cb
      where cb.cambio_rank = 1
  ;
end;
$$;


--
-- TOC entry 522 (class 1255 OID 17021)
-- Name: funct_load_cambio_history(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_cambio_history(filter jsonb) RETURNS TABLE(cambio_id uuid, cambio_taxa double precision, cambio_data date, cambio_estado smallint, cambio_dataregistro timestamp with time zone, cambio_dataatualizacao timestamp with time zone, currency_id smallint, currency_name character varying, currency_symbol character varying, currency_code character varying)
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função carrega os cambios ativo
    filter := {
      arg_espaco_auth: ID
    }
  */
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  _const map.constant;
begin
  _const := map.constant();
  return query
    select
        cb.cambio_id,
        cb.cambio_taxa,
        cb.cambio_data,
        cb.cambio_estado,
        cb.cambio_dataregistro,
        cb.cambio_dataatualizacao,

        cur.currency_id,
        cur.currency_name,
        cur.currency_code,
        cur.currency_symbol

      from tweeks.cambio cb
        inner join geoinfo.currency cur on cb.cambio_currency_id = cur.currency_id
      where cb.cambio_espaco_auth = arg_espaco_auth
      order by cb.cambio_data desc,
        cb.cambio_dataregistro desc
  ;
end;
$$;


--
-- TOC entry 905 (class 1255 OID 17022)
-- Name: funct_load_chave(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_chave(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    arg_chave_temporaria: CHAVE-TEMP
   */
    arg_chave_temporaria character varying default args->>'arg_chave_temporaria';
    _const map.constant;
begin
  _const := map.constant();
  delete
    from tweeks.chave s
    where chave_definitiva is null
      and chave_date < now() - interval '1' day
  ;
  
  if arg_chave_temporaria is null then
      return query
          select to_jsonb( ch )
            from tweeks.chave ch
            where (ch.chave_date + interval '24' hour )  > now()
              and ch.chave_definitiva is null;
  else
      return query
          select to_jsonb( ch ) || coalesce( to_jsonb( p ), jsonb_build_object()) || jsonb_build_object(
                'posto_disponivel', coalesce( p.posto_estado != _const.maguita_posto_estado_encerado, false )
            )
          from tweeks.chave ch
            left join tweeks.posto p on ch.chave_definitiva = p.posto_chave
          where ch.chave_temporarai = arg_chave_temporaria
      ;
  end if;
end;
$$;


--
-- TOC entry 869 (class 1255 OID 17023)
-- Name: funct_load_classe(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_classe(filter jsonb DEFAULT NULL::jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para carregar as listas de classes ativas
    filter := {
      arg_espaco_auth: ID
    }
  */
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth );
  _const map.constant;
begin
  _const := map.constant();

  return query
    with
      __espaco as ( select e.espaco_id, e.espaco_nome from tweeks.espaco e),
      __links as (
        select
            l.link_referencia,
            l.link_espaco_destino,
            array_agg( to_jsonb( e ) ) as espacos
          from  __espaco e
            inner join tweeks.link l on e.espaco_id = l.link_espaco_destino
          where l.link_estado = _const.maguita_link_estado_ativo
            and l.link_tlink_id = _const.maguita_tlink_classe
          group by l.link_referencia,
            l.link_espaco_destino

        ),
      __classe as (
        select
            cla.classe_id,
            cla.classe_classe_id,
            cla.classe_nome,
            cla.classe_foto,
            cla.classe_position,
            jsonb_build_object(
              'total', count( distinct atr.artigo_id ),
              'ativos', count( distinct atr.artigo_id ) filter ( where atr.artigo_estado = _const.artigo_estado_ativo )
            ) as artigos,
            coalesce( l.espacos, array[]::jsonb[] ) as classe_espacos

        from tweeks.classe cla
          left join __links l on ( l.link_referencia->>'classe_id' )::uuid = cla.classe_id
          left join tweeks.artigo atr on cla.classe_id = atr.artigo_classe_id
        where cla.classe_estado = _const.classe_estado_ativo
          and ( 
            cla.classe_espaco_auth = any( arg_espaco_child )
              or l.link_espaco_destino = any( arg_espaco_child )
              or cla.classe_id = _const.classe_itemextra
          )
        group by cla.classe_id, cla.classe_nome, l.espacos
        order by
          case
            when cla.classe_id != _const.classe_itemextra then 1
            else 2
          end,
          cla.classe_nome
      ) select to_jsonb( c )
          from __classe c
    ;
end;
$$;


--
-- TOC entry 816 (class 1255 OID 17024)
-- Name: funct_load_classe_simple_report(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_classe_simple_report(filter jsonb DEFAULT NULL::jsonb) RETURNS TABLE(classe_id uuid, classe_nome character varying)
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para carregar as listas de classes ativas
    filter := {
      arg_espaco_auth: ID
    }
  */
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth );
  _const map.constant;
begin
  _const := map.constant();

  return query
    select
        cla.classe_id,
        cla.classe_nome
      from tweeks.classe cla
        left join tweeks.link l on l.link_referencia @> jsonb_build_object( 'classe_id', cla.classe_id )
          and l.link_estado = _const.link_estado_associacao
          and l.link_tlink_id = _const.tlink_associacao
      where cla.classe_estado = _const.classe_estado_ativo
        and ( cla.classe_espaco_auth = any( arg_espaco_child ) or l.link_espaco_auth = any( arg_espaco_child ) or l.link_espaco_destino = any( arg_espaco_child ) )
      group by cla.classe_id
      order by
        case
          when cla.classe_id != _const.classe_itemextra then 1
          else 2
        end asc,
        cla.classe_nome asc
    ;

  return query select null::int2, 'Desativados'::varchar;
end;
$$;


--
-- TOC entry 817 (class 1255 OID 17025)
-- Name: funct_load_cliente(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_cliente(args jsonb) RETURNS SETOF json
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_espaco_auth: UUID,
      arg_colaborador_id: UUID,
      query: {
        any?: any
        code?: CODE,
        name?: NAME
        mail?: MAIL
        tel?: TEL
        nif?: NIF
      }
    }
   */
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  __branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id );
  _const map.constant;

  _query_any  text default lower( args->'query'->>'any' );
  _query_code text default lower( args->'query'->>'code' );
  _query_name text default lower( args->'query'->>'name' );
  _query_mail text default lower( args->'query'->>'mail' );
  _query_tel  text default lower( args->'query'->>'tel' );
  _query_nif  text default lower( args->'query'->>'nif' );
begin
  _const := map.constant();
  return query
    with
      __deposito as (
        select
            la.lancamento_cliente_id,
            sum( la.lancamento_valor ) as balanco_credito,
            sum( la.lancamento_valor ) filter ( where la._tgrupo_id = _const.maguita_tgrupo_cnormal ) as   balanco_creditonormal,
            sum( la.lancamento_valor ) filter ( where la._tgrupo_id = _const.maguita_tgrupo_ccorrente ) as balanco_creditocorrente,
            count( la.lancamento_id ) as depositos
          from tweeks.lancamento la
          where la._branch_uid = __branch_uid
            and la.lancamento_operacao = 1
            and la.lancamento_estado =  _const.maguita_lancamento_estado_ativo
          group by la.lancamento_cliente_id

      ), __conta as (
        select
            la.lancamento_cliente_id,
            sum( la.lancamento_valor ) as balanco_debito,
            sum( la.lancamento_valor ) filter ( where la._tgrupo_id = _const.maguita_tgrupo_cnormal ) as   balanco_debitonormal,
            sum( la.lancamento_valor ) filter ( where la._tgrupo_id = _const.maguita_tgrupo_ccorrente ) as balanco_debitocorrente
          from tweeks.lancamento la
          where la._branch_uid = __branch_uid
            and la.lancamento_estado = _const.maguita_lancamento_estado_ativo
            and la.lancamento_operacao = -1
          group by la.lancamento_cliente_id

      ), __cliente as (
        select
            c.cliente_id,
            c.cliente_code,
            c.cliente_titular,
            c.cliente_nif,
            c.cliente_contactos,
            c.cliente_mail,
            c.cliente_estado,
            c.cliente_metadata,
            c.cliente_dataregistro,
            coalesce( _de.balanco_credito, 0.0 ) as balanco_credito,
            coalesce( _de.balanco_creditonormal, 0.0 ) as balanco_creditonormal,
            coalesce( _de.balanco_creditocorrente, 0.0 ) as balanco_creditocorrente,
            coalesce( _de.depositos, 0 ) as depositos,
            coalesce( _ct.balanco_debito, 0.0 ) as balanco_debito,
            coalesce( _ct.balanco_debitocorrente, 0.0 ) as balanco_debitocorrente,
            coalesce( _ct.balanco_debitonormal, 0.0 ) as balanco_debitonormal
          from tweeks.cliente c
            left join __deposito _de on c.cliente_id = _de.lancamento_cliente_id
            left join __conta _ct on c.cliente_id = _ct.lancamento_cliente_id
          where c._branch_uid = __branch_uid
      ), __cliente_saldo as (
        select
            _c.*,
            _c.balanco_creditonormal - _c.balanco_debitonormal as balanco_normal,
            _c.balanco_creditocorrente - _c.balanco_debitocorrente as balanco_corrente,
            _c.balanco_credito - _c.balanco_debito as balanco_final
          from __cliente _c
      ), __query as (
        select *
          from __cliente_saldo _cl
          where true
            and _cl.cliente_code = coalesce( _query_code, _cl.cliente_code )
            and coalesce( _cl.cliente_nif, '') = coalesce( _query_nif, _cl.cliente_nif, '' )
            and lower( _cl.cliente_titular ) like lower( format( '%%%s%%', coalesce( _query_name, _cl.cliente_titular ) ) )
            and lower( coalesce( _cl.cliente_mail, '' ) ) like lower( format( '%%%s%%', coalesce( _query_mail, _cl.cliente_mail, '' ) ) )
            and ( coalesce( _cl.cliente_contactos, jsonb_build_array()) || to_jsonb(''::text) ) @> to_jsonb(coalesce( _query_tel, '' ) )
            and ( false
                or _cl.cliente_code = coalesce( _query_any, _cl.cliente_code )
                or coalesce( _cl.cliente_nif, '') = coalesce( _query_any, _cl.cliente_nif, '' )
                or lower( _cl.cliente_titular ) like lower( format( '%%%s%%', coalesce( _query_any, _cl.cliente_titular ) ) )
                or lower( coalesce( _cl.cliente_mail, '' ) ) like lower( format( '%%%s%%', coalesce( _query_any, _cl.cliente_mail, '' ) ) )
                or (_cl.cliente_contactos || to_jsonb(''::text) ) @> to_jsonb(coalesce( _query_any, '' ) )
            )
      ) select to_json( _q )
        from __query _q;
end
$$;


--
-- TOC entry 525 (class 1255 OID 17026)
-- Name: funct_load_cluster_by_branch(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_cluster_by_branch(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_branch_uid: UID
    }
   */
  arg_branch_uid uuid default args->>'arg_branch_uid';
  _branch tweeks.branch;
begin
  _branch := tweeks.__get_branch( arg_branch_uid );

  return query with
    __clusters as (
      select
          c.cluster_identifier,
          c.cluster_name,
          c.cluster_configs,
          c.cluster_type,
          c.cluster_path,
          c.cluster_grants,
          c.cluster_version,
          c.cluster_sequence
        from cluster.cluster c
        where c.cluster_identifier = any( _branch.branch_clusters )
    ) select to_jsonb( c )
      from __clusters c;
end;
$$;


--
-- TOC entry 526 (class 1255 OID 17027)
-- Name: funct_load_colaborador(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_colaborador(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
    /**
      Essa função sere para carregar os colaborador apartir dos filtros expecificados
      filetr := {
        arg_espaco_auth: ID
      }
     */
    arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
    arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth );
    _const map.constant;
begin
    _const :=  map.constant();

    return query with
        __espacos as (
            select
                   e.espaco_id,
                   e.espaco_nivel,
                   e.espaco_nome,
                   tr.trabalha_colaborador_proprietario
               from tweeks.espaco e
                  inner join tweeks.trabalha tr on e.espaco_id = tr.trabalha_espaco_destino
                    and tr.trabalha_estado = _const.maguita_trabalha_estado_ativo
                where e.espaco_estado = _const.maguita_espaco_estado_ativo
        ), __colaborador as(
            select
                co.colaborador_id,
                co.colaborador_nome,
                co.colaborador_apelido,
                co.colaborador_email,
                co.colaborador_estado,
                co.colaborador_tipo,
                auth._colaborador_estado_desc( co.colaborador_estado ) as colaborador_estado_desc,
                co.colaborador_accesso,
                auth._colaborador_accesso_desc( co.colaborador_accesso ) as colaborador_accesso_desc,
                co.colaborador_foto,
                s2.tsexo_id,
                s2.tsexo_nome,
                s2.tsexo_codigo,
                co.colaborador_datanascimento,
                co.colaborador_nif,
                co.colaborador_dataregisto,
                co.colaborador_espaco_auth,
                min( e.espaco_nivel ) as espaco_minnivel,
                max( e.espaco_nivel ) as espaco_maxnivel,
                jsonb_agg( to_jsonb( e ) ) as colaborador_espacotrabalha,
                array_agg( e.espaco_id )||co.colaborador_espaco_auth as espacos
              from auth.colaborador co
                left join auth.tsexo s2 ON co.colaborador_tsexo_id = s2.tsexo_id
                left join __espacos e on co.colaborador_id = e.trabalha_colaborador_proprietario
              where co.colaborador_tipo in ( _const.colaborador_tipo_user, _const.colaborador_tipo_user_master )
                and ( co.colaborador_estado = _const.colaborador_estado_ativo or co.colaborador_tipo = _const.colaborador_tipo_user_master )
              group by co.colaborador_id,
                s2.tsexo_id
        )  select to_jsonb( co )
          from __colaborador co
          where arg_espaco_auth = any ( co.espacos )
        order by
            case
              when co.colaborador_espaco_auth = arg_espaco_auth then 1
              else 2
            end,
            espaco_minnivel,
            case
                when co.colaborador_accesso = _const.colaborador_accesso_ativo then 1
                when co.colaborador_accesso = _const.colaborador_accesso_pendente then 2
                when co.colaborador_accesso = _const.colaborador_accesso_fechado then 3
            end,
            co.colaborador_nome,
            co.colaborador_apelido

    ;
end;
$$;


--
-- TOC entry 527 (class 1255 OID 17028)
-- Name: funct_load_conta_by_caixa(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_conta_by_caixa(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função server para devolver a lista de todas as contas pagas em uma caixa
    filter := {
      arg_caixa_id: ID
    }
   */
  arg_caixa_id uuid default filter->>'arg_caixa_id';
  _const map.constant;
begin
  _const := map.constant();

  return query
    select to_jsonb( tweeks.funct_load_conta_data( jsonb_build_object( 'arg_conta_id', ct.conta_id ) ) )
      from tweeks.conta ct
      where ct.conta_caixa_fechopagamento = arg_caixa_id
        and ct.conta_estado = _const.conta_estado_pago
  ;
end;
$$;


--
-- TOC entry 813 (class 1255 OID 19751)
-- Name: funct_load_conta_notacredito(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_conta_notacredito(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_colaborador_id: UID
      arg_espaco_auth: UID
      conta_fatura
    }
   */
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _conta_fatura character varying := args->>'conta_fatura';
  _const map.constant;
begin
  _const := map.constant();
  return query
    with __venda as (
      select
          ve.*,
          art.*,
          sum( tx.taxa_taxa ) as taxa_taxa,
          sum( tx.taxa_percentagem ) as taxa_percentagem
        from tweeks.venda ve
          inner join tweeks.artigo art on ve.venda_artigo_id = art.artigo_id
          left join tweeks.taxa tx on tx.taxa_id = any( venda_taxas )
        where ve._branch_uid  = arg_branch
          and ve.venda_venda_id is null
          and ve.venda_estado = _const.maguita_venda_estado_fechado
        group by ve.venda_id,
          art.artigo_id
    ), __venda_group as (
      select
          _ve.venda_id,
          _ve.venda_conta_id,
          array_agg( to_jsonb( _vei ) ) as venda_itens
        from __venda _ve
          left join __venda _vei on _ve.venda_id = _vei.venda_venda_id
        where _ve.venda_venda_id is null
        group by _ve.venda_id,
          _ve.venda_conta_id

    ), __conta as (
      select
        ct.*,
        array_agg( to_jsonb( _veg ) || to_jsonb( _ved ) ) as conta_vendas
        from tweeks.conta ct
          inner join __venda_group _veg on ct.conta_id = _veg.venda_conta_id
          inner join __venda _ved on _veg.venda_id = _ved.venda_id
          left join tweeks.venda venda_ncred on _veg.venda_id = venda_ncred.venda_venda_docorign
            and venda_ncred.venda_estado = _const.maguita_venda_estado_fechado
        where ct._branch_uid = arg_branch
          and ct.conta_estado = _const.maguita_conta_estado_fechado
          and venda_ncred.venda_id is null
          and ct.conta_numerofatura = _conta_fatura
        group by ct.conta_id
    ) select to_jsonb( _ct )
        from __conta _ct
  ;
end;
$$;


--
-- TOC entry 819 (class 1255 OID 17029)
-- Name: funct_load_conta_preparacao(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_conta_preparacao(filter jsonb) RETURNS TABLE(conta_id uuid, conta_numero integer, conta_titular character varying, conta_titularnif character varying, conta_data date, conta_numerofatura character varying, conta_montante double precision, conta_montanteamortizado double precision, conta_estado smallint, conta_imprensa smallint, conta_dataregistro timestamp with time zone, conta_dataatualizacao timestamp with time zone, mesa_id uuid, mesa_numero character varying, mesa_lotacao smallint, mesa_designacao character varying, currency_id smallint, currency_code character varying, currency_name character varying, tpaga_id smallint, tpaga_designacao character varying, colaborador_id uuid, colaborador_nome character varying, colaborador_apelido character varying, vendas jsonb)
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função devolve uma mesa juntamente com as conta associada que ainda esta aberta
    filter := {
      arg_conta_id
    }
   */
  arg_conta_id uuid default filter->>'arg_conta_id';

  _const map.constant;
begin

  _const := map.constant();

  return query
    with conta_venda as (
      select
          art.*,
          ve.*,
          coalesce(
            jsonb_agg(
            lib.jsonb_values_as(
              to_jsonb( agg ) || to_jsonb( it ),
              'artigo_id', 'item_id',
              'artigo_nome', 'item_nome',
              'artigo_custo', 'item_custo',
              'agrega_id', 'agrega_id',
              'agrega_quantidade', 'agrega_quantidade',
              'agrega_custounitario', 'agrega_custounitario',
              'agrega_montante', 'agrega_montante'
            ) order by it.artigo_nome asc ) filter ( where it.artigo_id is not null ),
            jsonb_build_array()
          ) as items
        from tweeks.venda ve
          inner join tweeks.artigo art on ve.venda_artigo_id = art.artigo_id
          left join tweeks.agrega agg on ve.venda_id = agg.agrega_venda_id
            and agg.agrega_estado in ( _const.agrega_estado_aberto, _const.agrega_estado_fechado )
          left join tweeks.artigo it on agg.agrega_artigo_item = it.artigo_id
        where ve.venda_estado in ( _const.venda_estado_aberto )
          and ve.venda_estadopreparacao = _const.venda_estadopreparacao_pendente
        group by art.artigo_id,
        ve.venda_id
    )
    select
      ct.conta_id,
      ct.conta_numero,
      ct.conta_titular,
      ct.conta_titularnif,
      ct.conta_data,
      ct.conta_numerofatura,
      ct.conta_montante,
      ct.conta_montanteamortizado,
      ct.conta_estado,
      ct.conta_imprensa,
      ct.conta_dataregistro,
      ct.conta_dataatualizacao,

      m.mesa_id,
      m.mesa_numero,
      m.mesa_lotacao,
      m.mesa_designacao,

      cur.currency_id,
      cur.currency_code,
      cur.currency_name,

      tpag.tpaga_id,
      tpag.tpaga_designacao,

      col.colaborador_id,
      col.colaborador_nome,
      col.colaborador_apelido,
      jsonb_agg(
          lib.jsonb_values(
            to_jsonb( vd ),
            'artigo_id',
            'artigo_codigo',
            'artigo_nome',
            'artigo_custo',
            'artigo_stocknegativo',
            'venda_id',
            'venda_quantidade',
            'venda_custounitario',
            'venda_montente',
            'venda_montanteagregado',
            'venda_montantetotal',
            'venda_estado',
            'items'
            )
          order by vd.artigo_nome asc
        )
    from tweeks.conta ct
      inner join auth.colaborador col on ct.conta_colaborador_id = col.colaborador_id
      left join tweeks.mesa m on ct.conta_mesa_id = m.mesa_id
      left join geoinfo.currency cur on ct.conta_currency_id = cur.currency_id
      left join tweeks.tpaga tpag on ct.conta_tpaga_id = tpag.tpaga_id
      left join conta_venda vd on ct.conta_id = vd.venda_conta_id

    where ct.conta_id = arg_conta_id
    group by
      ct.conta_id,
      m.mesa_id,
      col.colaborador_id,
      tpag.tpaga_id,
      cur.currency_id
  ;
end;
$$;


--
-- TOC entry 768 (class 1255 OID 17030)
-- Name: funct_load_deposito_data(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_deposito_data(args jsonb) RETURNS SETOF json
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      deposito_id: UUID
    }
   */
  _deposito tweeks.deposito;
begin
  _deposito := jsonb_populate_record( _deposito, args );
  select * into _deposito
    from tweeks.deposito d
    where d.deposito_id = _deposito.deposito_id
  ;

  return query
    with __deposito as (
      select
          de.deposito_id,
          de.deposito_documento,
          de.deposito_montante,
          de.deposito_montantefinal,
          de.deposito_montantetroco,
          de.deposito_montantemoeda,
          de.deposito_referencia,
          de.deposito_docref,
          de.deposito_data,
          de.deposito_dataregistro,
          de.deposito_observacao,
          de._tgrupo_id,
          tp.tpaga_id,
          tp.tpaga_designacao,
          cu.currency_name,
          cu.currency_code,
          cu.currency_symbol,
          cli.cliente_id,
          cli.cliente_nif,
          cli.cliente_titular,
          col.colaborador_id,
          col.colaborador_nome,
          col.colaborador_apelido,
          col.colaborador_email,
          cx.caixa_id,
          po.posto_id,
          po.posto_designacao,
          po.posto_matricula
        from tweeks.deposito de
          inner join tweeks.cliente cli on de.deposito_cliente_id = cli.cliente_id
          inner join tweeks.tpaga tp on de.deposito_tpaga_id = tp.tpaga_id
          inner join geoinfo.currency cu on de.deposito_currency_id  = cu.currency_id
          inner join auth.colaborador col on de.deposito_colaborador_id = col.colaborador_id
          left join tweeks.caixa cx on de.deposito_caixa_id = cx.caixa_id
          left join tweeks.posto po on cx.caixa_posto_id = po.posto_id
        where de.deposito_id = _deposito.deposito_id
    ) select to_json( _d )
        from __deposito _d
  ;

  return query
    select to_json( reg )
      from tweeks.__lancamento_regularizacao( jsonb_build_object(
        'cliente_id', _deposito.deposito_cliente_id,
        'tgrupo_id', _deposito._tgrupo_id,
        'braunc_uid', _deposito._branch_uid
      )) reg
      where _deposito.deposito_id = any( reg.regula_refid )
  ;
end;
$$;


--
-- TOC entry 820 (class 1255 OID 17031)
-- Name: funct_load_device_unregistered(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_device_unregistered(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_dispositivos: [
        {
          client_ip: IP
          client_mac: IP
          client_hostname: HOSTNAME
          client_ipv4: IPV4
          client_ipv6: IPV6
          client_distro: DISTRO
          client_platform: PLATFORM
          client_vendor: VENDOR
          client_user: USER
        }
      ]
    }
   */
  arg_dispositivos jsonb default filter->'arg_dispositivos';
begin
  return query
  with devices_found as (
    select
        el.document->>'client_ip' as posto_ip,
        el.document->>'client_mac' as posto_mac,
        el.document->>'client_hostname' as posto_hostname,
        el.document->>'client_ipv6' as posto_ipv6,
        el.document->>'client_distro' as posto_distro,
        el.document->>'client_vendor' as posto_vendor,
        el.document->>'client_user' as posto_user,
        coalesce( el.document->>'client_user', el.document->>'client_hostname' ) as client_label
      from jsonb_array_elements( arg_dispositivos ) el( document )
  ), no_registred as (
    select dvf.*,
           case
             when dvf.client_label is not null then format( '%s (%s)', dvf.posto_mac, dvf.client_label )
             else  dvf.posto_mac
          end as client_label
      from devices_found dvf
        left join tweeks.posto pt on dvf.posto_mac = pt.posto_mac
      where pt.posto_id is null
  )  select lib.jsonb_values(
        nr,
        'posto_ip',
        'posto_mac',
        'posto_hostname',
        'posto_ipv4',
        'posto_ipv6',
        'posto_distro',
        'posto_platform',
        'posto_vendor',
        'posto_user',
        'client_label'
      )
    from no_registred nr
  ;
end;
$$;


--
-- TOC entry 769 (class 1255 OID 17032)
-- Name: funct_load_entrada(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_entrada(filter jsonb) RETURNS TABLE(entrada_id uuid, entrada_data date, entrada_codigofatura character varying, entrada_quantidade double precision, entrada_montante double precision, entrada_descricao character varying, entrada_estado smallint, entrada_dataregistro timestamp with time zone, entrada_dataatualizacao timestamp with time zone, artigo_id uuid, artigo_nome character varying, artigo_codigo character varying, espaco_id uuid, espaco_nome character varying, fornecedor_id uuid, fornecedor_nome character varying, fornecedor_nif character varying)
    LANGUAGE plpgsql
    AS $$
declare
  /**
      Essa função serve para listar as entradas de artigos no stock
      filter := {
        arg_fornecedor_id: ID,
        arg_artigo_id: ID,
        arg_local_id: ID,
      }
   */

  arg_fornecedor_id uuid default filter ->>'arg_fornecedor_id';
  arg_artigo_id uuid default filter ->> 'arg_artigo_id';
  arg_espaco_id uuid default filter->>'arg_espaco_id';
  arg_espaco_auth uuid default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth );

begin
  return query
    select
        ent.entrada_id ,
        ent.entrada_data,
        ent.entrada_codigofatura,
        ent.entrada_quantidade,
        ent.entrada_montante,
        ent.entrada_descricao,
        ent.entrada_estado,
        ent.entrada_dataregistro,
        ent.entrada_dataatualizacao,

        art.artigo_id,
        art.artigo_nome,
        art.artigo_codigo,

        esp.espaco_id,
        esp.espaco_nome,

        forn.fornecedor_id,
        forn.fornecedor_nome,
        forn.fornecedor_nif
      from tweeks.entrada ent
        inner join tweeks.artigo art on ent.entrada_artigo_id = art.artigo_id
        inner join tweeks.espaco esp on ent.entrada_espaco_id = esp.espaco_id
        inner join tweeks.fornecedor forn on ent.entrada_fornecedor_id = forn.fornecedor_id
      where forn.fornecedor_id = coalesce( arg_fornecedor_id, forn.fornecedor_id )
        and art.artigo_id = coalesce( arg_artigo_id, art.artigo_id )
        and esp.espaco_id = coalesce( arg_espaco_id, esp.espaco_id )
        and forn.fornecedor_espaco_auth = any( arg_espaco_child )
      order by ent.entrada_data desc,
        ent.entrada_dataregistro desc
    ;
end;
$$;


--
-- TOC entry 821 (class 1255 OID 17033)
-- Name: funct_load_espaco(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_espaco(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função lista todos os espacos registrado no sistema
    filter := {
      arg_espaco_auth: ID,
      arg_colaborador_id: UID
    }
  */
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_colaborador_id uuid not null default filter->>'arg_colaborador_id';
  arg_espaco_child uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth );
  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _const map.constant;
begin

  _const := map.constant();
  return query
    with __espaco as (

    select
        esp.espaco_id,
        esp.espaco_nome,
        esp.espaco_vender,
        esp.espaco_descricao,
        esp.espaco_codigo,
        esp.espaco_estado,
        esp.espaco_dataregistro,
        esp.espaco_dataatualizacao,
        esp.espaco_gerarfatura,
        esp.espaco_configurar,
        esp.espaco_configuracao,
        esp.espaco_nivel,
        esp.espaco_posto_admin,
        clu.cluster_identifier,
        clu.cluster_name,
        po.posto_id,
        po.posto_designacao,
        po.posto_chave,
        po.posto_matricula

      from tweeks.espaco esp
        inner join tweeks.branch br on esp.espaco_branch_uid = br.branch_uid
          and br.branch_uid = ___branch
        left join tweeks.posto po on esp.espaco_posto_admin = po.posto_id
        left join cluster.cluster clu on clu.cluster_identifier = esp.espaco_vender
--           and clu.cluster_identifier = any( br.branch_clusters )
      where esp.espaco_espaco_id = any( arg_espaco_child )
        or esp.espaco_id = arg_espaco_auth
      order by esp.espaco_nivel,
        esp.espaco_nome
    ) select to_jsonb( e  )
      from __espaco e
  ;
end;
$$;


--
-- TOC entry 528 (class 1255 OID 17034)
-- Name: funct_load_espaco_configuracao(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_espaco_configuracao(filter jsonb) RETURNS jsonb
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
declare
  /**
    Essa função serve para devolver o espaço onde deve ser processado a fatura
    arg_espaco_auth := ID
   */
  arg_espaco_id uuid not null default filter->>'arg_espaco_auth';
  _espaco record;
begin

--   Obter o espaço superior que pode gerar numero de seire
    with recursive __espaco as (
      select e.*, e.espaco_gerarfatura as __generate_serie
      from tweeks.espaco e
      where e.espaco_id = arg_espaco_id
      union all
      select w.*, w.espaco_configurar
        from __espaco _e
          inner join tweeks.espaco w on _e.espaco_espaco_id = w.espaco_id
        and not _e.__generate_serie
    ) select * into _espaco from __espaco __e
      where __e.__generate_serie
    ;

--   with recursive parent as (
--       select e.* from tweeks.espaco e where e.espaco_id = arg_espaco_id
--     union all
--       select e.*
--         from parent p
--           inner join tweeks.espaco e on p.espaco_espaco_id = e.espaco_id
--         where not p.espaco_configurar
--   ) select l.* into _espaco
--   from parent l
--     where l.espaco_configurar
--   ;

  _espaco.espaco_configurar := arg_espaco_id = _espaco.espaco_id and _espaco.espaco_configurar;

  return jsonb_build_object(
    'espaco', lib.jsonb_values( _espaco, 'espaco_configurar', 'espaco_configuracao', 'espaco_id', 'espaco_nome' )
  );
end;
$$;


--
-- TOC entry 822 (class 1255 OID 17035)
-- Name: funct_load_espaco_migrate(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_espaco_migrate(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    arg_espaco_migracao: UID
    arg_espaco_id: UID
    arg_colaborador_id: UID
   */
  arg_espaco_id uuid default args->>'arg_espaco_id';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_migracao uuid default args->>'arg_espaco_migracao';

  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_id );
  _espaco tweeks.espaco;
begin
  _espaco := tweeks._get_espaco( arg_espaco_migracao );

  return query
    with recursive __espaco as (
      select
          e.espaco_id,
          e.espaco_nome,
          e.espaco_nivel,
          e.espaco_espaco_id,
          array[ e.espaco_id ]::uuid[] as path
        from tweeks.espaco e
        where e.espaco_nivel = 1
          and _branch_uid = _branch_uid
      union all
        select
            es.espaco_id,
            es.espaco_nome,
            es.espaco_nivel,
            es.espaco_espaco_id,
            _e.path || es.espaco_id
          from __espaco _e
            inner join tweeks.espaco es on _e.espaco_id = es.espaco_espaco_id
          where es._branch_uid = ___branch
    ) select to_jsonb( _es )
        from __espaco _es
        where arg_espaco_migracao != all( _es.path )
          and _es.espaco_id != _espaco.espaco_espaco_id
  ;
end;
$$;


--
-- TOC entry 530 (class 1255 OID 17036)
-- Name: funct_load_espaco_simple(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_espaco_simple(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função lista os espacos ativos
    filter := {
      arg_espaco_auth: ID
    }
  */
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );
  _const map.constant;
begin

  _const := map.constant();
  return query
    with __espaco as (
        select
          esp.espaco_id,
          esp.espaco_nome,
          esp.espaco_codigo,
          esp._branch_uid
        from tweeks.espaco esp
        where esp.espaco_estado = _const.maguita_espaco_estado_ativo
          and ( esp.espaco_espaco_id = any( arg_arg_espaco_child ) or esp.espaco_id = arg_espaco_auth )
        order by esp.espaco_nome
    ) select to_jsonb( e )
        from __espaco e
  ;
end;
$$;


--
-- TOC entry 770 (class 1255 OID 17037)
-- Name: funct_load_fornecedor(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_fornecedor(filter jsonb) RETURNS SETOF json
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para listar os fornecedores da base de dados
    filter := {
      arg_espaco_auth: ID,
      arg_colaborador_id: UID,
      query: {
        any:,
        code: CODE,
        name: NAME,
        mail: MAIL,
        tel: CONTACTO,
        nif: NIF,
        address: ENDERECO

      }
    }
  */
  arg_espaco_auth uuid default filter->>'arg_espaco_auth';
  arg_colaborador_id uuid default filter->>'arg_colaborador_id';
  arg_espaco_child uuid[ ] default rule.espaco_get_childrens( arg_espaco_auth );
  _const map.constant;
  _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );

  _query_any text default lower( filter->'query'->>'any' );
  _query_code text default lower( filter->'query'->>'code' );
  _query_name text default lower( filter->'query'->>'name' );
  _query_mail text default lower( filter->'query'->>'mail' );
  _query_tel text default lower( filter->'query'->>'tel' );
  _query_nif text default lower( filter->'query'->>'nif' );
  _query_address text default lower( filter->'query'->>'address' );
begin
  _const := map.constant();

  return query
    with __fornecedor as  (
      select
        fo.fornecedor_id,
        fo.fornecedor_code,
        fo.fornecedor_nif,
        fo.fornecedor_nome,
        fo.fornecedor_email,
        fo.fornecedor_contacto,
        fo.fornecedor_endereco,
        fo.fornecedor_estado,
        fo.fornecedor_dataregistro,
        fo.fornecedor_dataatualizacao
      from tweeks.fornecedor fo
      where fo.fornecedor_espaco_auth = any( arg_espaco_child )
        and fo.fornecedor_estado = _const.maguita_fornecedor_estado_ativo
        and fo._branch_uid = _branch
      order by fo.fornecedor_nome
    ), __query as  (
        select _f.*
          from __fornecedor _f
          where true
            and coalesce( _f.fornecedor_code, '' ) = coalesce( _query_code, _f.fornecedor_code, '' )
            and coalesce( _f.fornecedor_nif, '' ) = coalesce( _query_nif, _f.fornecedor_nif, '' )
            and coalesce( _f.fornecedor_contacto, '' ) = coalesce( _query_tel, _f.fornecedor_contacto, '' )
            and lower( coalesce( _f.fornecedor_nome, '' ) ) like lower( format( '%%%s%%', coalesce( _query_name, _f.fornecedor_nome, '' ) ) )
            and lower( coalesce( _f.fornecedor_email, '' ) ) like lower( format( '%%%s%%', coalesce( _query_mail, _f.fornecedor_email, '' ) ) )
            and lower( coalesce( _f.fornecedor_endereco, '' ) ) like lower( format( '%%%s%%', coalesce( _query_address, _f.fornecedor_endereco, '' ) ) )
            and ( false
              or coalesce( _f.fornecedor_code, '' ) = coalesce( _query_any, _f.fornecedor_code, ''  )
              or coalesce( _f.fornecedor_nif, '') = coalesce( _query_any, _f.fornecedor_nif, ''  )
              or coalesce( _f.fornecedor_contacto, '' ) = coalesce( _query_any, _f.fornecedor_contacto, '' )
              or lower( coalesce( _f.fornecedor_nome, '' ) ) like lower( format( '%%%s%%', coalesce( _query_name, _f.fornecedor_nome, '' ) ) )
              or lower( coalesce( _f.fornecedor_email, '' ) ) like lower( format( '%%%s%%', coalesce( _query_mail, _f.fornecedor_email, '' ) ) )
              or lower( coalesce( _f.fornecedor_endereco, '' ) ) like lower( format( '%%%s%%', coalesce( _query_address, _f.fornecedor_endereco, '' ) ) )
            )
    )
    select to_json( f )
      from __query f
  ;
end;
$$;


--
-- TOC entry 771 (class 1255 OID 17038)
-- Name: funct_load_fornecedor_simple(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_fornecedor_simple(filter jsonb DEFAULT NULL::jsonb) RETURNS TABLE(fornecedor_id uuid, fornecedor_nome character varying)
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para listar todos os fornecedores ativaos (lista para as selects do form)
    filter := {
      arg_espaco_auth: ID
    }
    */
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[]not null default rule.espaco_get_childrens( arg_espaco_auth );
  _const map.constant;
begin
  _const := map.constant();

  return query
    select
        fo.fornecedor_id,
        fo.fornecedor_nome
      from tweeks.fornecedor fo
      where fo.fornecedor_estado = _const.fornecedor_estado_ativo
        and fo.fornecedor_espaco_auth = any( arg_espaco_child )
      order by fo.fornecedor_nome
  ;
end;
$$;


--
-- TOC entry 772 (class 1255 OID 17039)
-- Name: funct_load_guia_data(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_guia_data(args jsonb) RETURNS SETOF json
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      guia_id UUID,
      arg_colaborador_id UUID
      arg_espaco_auth UUID
    }
   */
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';

  _guia tweeks.guia;
  _const map.constant;
  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
begin
  _const := map.constant();
  _guia := jsonb_populate_record( _guia, args );
  select * into _guia
    from tweeks.guia
    where guia_uid = _guia.guia_uid
      and _branch_uid = ___branch
  ;

  return next json_build_object( 'type', cluster.__format( pg_typeof( _guia )::text::regclass ), 'data', _guia );

  return query with __custoguia as (
    select ent as data, cluster.__format( ent.tableoid ) as type
      from tweeks.custoguia ent
      where ent.custoguia_guia_uid = _guia.guia_uid
        and ent.custoguia_estado = _const.maguita_custoguia_estado_ativo
        and ent._branch_uid = ___branch
  ) select to_json( _e ) from __custoguia _e;

  if _guia.guia_toperacao_id = _const.maguita_toperacao_entrada then
    return query with __raw as (
      select ent.*,
             art.artigo_id,
             art.artigo_nome,
             art.artigo_codigo,
             un.unit_id,
             un.unit_code,
             un.unit_name,
             cluster.__format( ent.tableoid ) as type
        from tweeks.entrada ent
          inner join tweeks.artigo art on ent.entrada_artigo_id = art.artigo_id
          left join tweeks.unit un on art.artigo_unit_id = un.unit_id
        where ent.entrada_guia_id = _guia.guia_uid
          and ent.entrada_estado = _const.entrada_estado_ativo
          and ent._branch_uid = ___branch
    ), __entrada as (
      select to_json( r ) as data, r.type
        from __raw r
    ) select to_json( _e ) from __entrada _e;

    return query with __fornecedor as (
      select ent as data, cluster.__format( ent.tableoid ) as type
        from tweeks.fornecedor ent
      where ent._branch_uid = ___branch
        and ent.fornecedor_id = _guia.guia_refuid
        and _guia.guia_refclass::regclass = ent.TABLEOID::regclass
    ) select to_json( _f ) from __fornecedor _f;

  elseif _guia.guia_toperacao_id = _const.maguita_toperacao_venda then
    return query with __venda as (
      select ent as data, cluster.__format( 'tweeks.conta'::regclass ) as type
      from tweeks.funct_pos_load_conta_data( args ) ent
    ) select to_json( _e ) from __venda _e;

  end if;
end
$$;


--
-- TOC entry 773 (class 1255 OID 17040)
-- Name: funct_load_items_simple(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_items_simple(filter jsonb DEFAULT NULL::jsonb) RETURNS TABLE(artigo_id uuid, artigo_nome character varying, artigo_descricao character varying)
    LANGUAGE plpgsql
    AS $$
declare
  /** Devolver uma lista simples de items
    arg_espaco_auth: ID
  */
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );

  _const map.constant;
begin
  _const := map.constant();
  return query
    select
        art.artigo_id,
        art.artigo_nome,
        art.artigo_descricao
      from tweeks.artigo art
      where art.artigo_estado = _const.artigo_estado_ativo
        and art.artigo_classe_id = _const.classe_itemextra
        and art.artigo_espaco_auth = any( arg_espaco_child )
  ;
end;
$$;


--
-- TOC entry 774 (class 1255 OID 17041)
-- Name: funct_load_lancamento(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_lancamento(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_colaborador_id: UID,
      arg_espaco_auth: UID,
      arg_cliente_id: UID,
      arg_lancamento_tmodalidade_conta
    }
   */
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_tgrupo_id int2 default args->>'arg_tgrupo_id';
  arg_cliente_id uuid default args->>'arg_cliente_id';
  _const map.constant;
begin
  _const := map.constant();
  return query
    with recursive __lancamento as (
      select
          row_number() over () as lancamento_posicao,
          la.lancamento_id,
          la.lancamento_descricao,
          la.lancamento_credito,
          la.lancamento_debito,
          la.lancamento_data,
          la.lancamento_dataregistro,
          la.lancamento_refid,
          la.lancamento_regclass,
          la.lancamento_referencia,
          la.lancamento_documento,
          la.lancamento_montante,
          la.lancamento_operacao,
          la.lancamento_sequencia,
          la.lancamento_via,
          la.lancamento_valor
        from tweeks.lancamento la
        where la.lancamento_cliente_id = arg_cliente_id
          and la.lancamento_estado = _const.maguita_lancamento_estado_ativo
          and la._tgrupo_id = arg_tgrupo_id
        order by la.lancamento_dataregistro,
          la.lancamento_sequencia
    ), __lancamento_saldo as (
      select
          _la.*,
          _la.lancamento_credito - _la.lancamento_debito as lancamento_valor,
          _la.lancamento_credito - _la.lancamento_debito as lancamento_saldo
        from __lancamento _la
        where _la.lancamento_posicao = 1
        union all
          select
              _la.*,
              _la.lancamento_credito - _la.lancamento_debito as lancamento_valor,
              _ls.lancamento_saldo + ( _la.lancamento_credito - _la.lancamento_debito ) as lancamento_saldo
      from __lancamento_saldo _ls
              inner join __lancamento _la on _ls.lancamento_posicao + 1 = _la.lancamento_posicao
    ) select to_jsonb( _ls )
        from __lancamento_saldo _ls;
end;
$$;


--
-- TOC entry 725 (class 1255 OID 17042)
-- Name: funct_load_mesa(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_mesa(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
  declare
    /** Essa função serve para deveolver todas as mesas registradas na base de dados*/
  begin
    return query
      select lib.jsonb_values( m,
          'mesa_id',
          'mesa_numero',
          'mesa_designacao',
          'mesa_lotacao',
          'mesa_estado',
          'mesa_dataregistro',
          'mesa_dataatualizacao'
        )
        from tweeks.mesa m
        order by m.mesa_numero asc;
  end;
$$;


--
-- TOC entry 508 (class 1255 OID 17043)
-- Name: funct_load_mesa_livre(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_mesa_livre(filter jsonb DEFAULT NULL::jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para devolver as mesas disponiveis
  */
  _const map.constant;
begin
  _const := map.constant();

  return query
    select lib.jsonb_values( m,
        'mesa_id',
        'mesa_numero',
        'mesa_designacao',
        'mesa_lotacao',
        'mesa_estado',
        'mesa_dataregistro'
      )
      from tweeks.mesa m
      where m.mesa_estado = _const.mesa_estado_disponivel
    ;
end;
$$;


--
-- TOC entry 907 (class 1255 OID 19858)
-- Name: funct_load_parametrizacao(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_parametrizacao(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**doc
    args := {
      arg_colaborador_id:UID
      arg_espaco_auth: UID,
      parametrizacao_tags: []
    
    }
  doc*/
  
  _user_id uuid not null default args->>'arg_colaborador_id';
  _espaco_auth uuid not null default args->>'arg_espaco_auth';
  ___branch uuid default tweeks.__branch_uid( _user_id, _espaco_auth );
  _const map.constant;
  _parametrizacao tweeks.parametrizacao;
begin
  _const := map.constant();
  _parametrizacao := jsonb_populate_record( _parametrizacao, args );
  if coalesce( array_length( _parametrizacao.parametrizacao_tags, 1 ),  0 ) = 0 then 
      _parametrizacao.parametrizacao_tags := null;
  end if;
  return query 
    with __parametrizacao as (
      select *
        from tweeks.parametrizacao p 
        where p.parametrizacao_estado = _const.maguita_parametrizacao_estado_ativo
          and p.parametrizacao_tags @> coalesce( _parametrizacao.parametrizacao_tags, p.parametrizacao_tags )
          and p._branch_uid = ___branch
    ) select to_jsonb( _p )
       from __parametrizacao _p
  ;
end;
$$;


--
-- TOC entry 529 (class 1255 OID 17044)
-- Name: funct_load_posto(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_posto(filter jsonb DEFAULT NULL::jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
    declare
    /** Essa função serve para devolver os postos
      filter := {
        arg_colaborador_id UUID
        arg_espaco_auth UUID
        arg_aloca_espaco:UUID
      }
     */
    arg_colaborador_id uuid not null default filter->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';

  __branch uuid not null default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  arg_aloca_espaco uuid default filter->>'arg_aloca_espaco';
  arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth );
  _const map.constant;
    begin
  _const := map.constant();

    return query
        with __alocacao as (
      select
        a.aloca_posto_id as posto_id,
        sum( a.aloca_montante ) as posto_montante,
        coalesce( array_agg( e.espaco_id ), array[]::uuid[] )||a.aloca_posto_id as posto_espacos,
        jsonb_agg( to_jsonb( a )||to_jsonb( e ) ) as posto_alocacao
      from tweeks.aloca a
             inner join tweeks.espaco e on a.aloca_espaco_destino = e.espaco_id
      where a.aloca_estado = _const.maguita_aloca_estado_ativo
        and e.espaco_estado = _const.maguita_espaco_estado_ativo
      group by a.aloca_posto_id
    ), __posto_filter as (
      select
        pos.posto_id,
        pos.posto_designacao,
        pos.posto_estado != _const.maguita_posto_estado_encerado as posto_ativo,
        a.posto_montante as posto_montante,
        coalesce( a.posto_alocacao, jsonb_build_array() ) as posto_alocacao,
        pos.posto_estado,
        pos.posto_caixamode,
        pos.posto_authmode,
        pos.posto_chave,
        pos.posto_vermontatefaturado,
        pos.posto_multiplecaixa,
        pos.posto_definirmontanteautomaticamente,
        tpos.tposto_id,
        tpos.tposto_designacao
      from tweeks.posto pos
        inner join tweeks.tposto tpos on pos.posto_tposto_id = tpos.tposto_id
        left join __alocacao a on pos.posto_id = a.posto_id
      where pos._branch_uid = __branch
        and ( arg_aloca_espaco = any ( a.posto_espacos ) or arg_aloca_espaco is null )
      order by
        case
          when pos.posto_estado = _const.maguita_posto_estado_aberto then 1
          when pos.posto_estado = _const.maguita_posto_estado_fechado then 2
          when pos.posto_estado = _const.maguita_posto_estado_encerado then 3
        end,
        pos.posto_designacao
    ), __treat_posto as (
      select ps.*,
        coalesce( ps.posto_alocacao, jsonb_build_array() ) as posto_alocacao
        from __posto_filter ps
    ) select to_jsonb( t )
      from __treat_posto t
    ;
    end;
$$;


--
-- TOC entry 818 (class 1255 OID 17045)
-- Name: funct_load_posto_by_endereco(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_posto_by_endereco(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para devolver um posto a partir do seu endereço IP
    filter := {
      arg_posto_endereco: IP
    }
  */
  arg_posto_endereco character varying not null default filter->>'arg_posto_endereco';
  _const map.constant;
begin
  _const := map.constant();

    return query
      with aux as (
        select
          post.*,
          tp.*,
          esp.*,
          cx.*
        from tweeks.posto post
          inner join tweeks.tposto tp on post.posto_tposto_id = tp.tposto_id
          inner join tweeks.espaco esp on post.posto_espaco_destino = esp.espaco_id
          left join tweeks.caixa cx on post.posto_id = cx.caixa_posto_id
            and cx.caixa_estado = _const.caixa_estado_ativo
        where post.posto_endereco = arg_posto_endereco
        limit 1

      ) select
          jsonb_build_object(
            'posto', lib.jsonb_values( a, 'posto_id', 'posto_montante', 'posto_endereco', 'posto_multipleuser', 'posto_estado', 'posto_designacao' ),
            'caixa', lib.jsonb_values( a, 'caixa_id', 'caixa_montanteinicial', 'caixa_montanteinicialposto' ),
            'espaco', lib.jsonb_values( a, 'espaco_id', 'espaco_nome' ),
            'tposto', lib.jsonb_values( a, 'tposto_id', 'tposto_designacao' )
          )
        from aux a;
end;
$$;


--
-- TOC entry 531 (class 1255 OID 17046)
-- Name: funct_load_posto_closed(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_posto_closed() RETURNS TABLE(posto_id uuid, posto_designacao character varying, espaco_id uuid, espaco_nome character varying)
    LANGUAGE plpgsql
    AS $$
declare
  _const map.constant;
begin
  _const := map.constant();

  return query
    select
        pos.posto_id,
        pos.posto_designacao,
        esp.espaco_id,
        esp.espaco_nome
      from tweeks.posto pos
        inner join tweeks.espaco esp on pos.posto_espaco_destino = esp.espaco_id
      where pos.posto_estado != _const.posto_estado_encerado
        and esp.espaco_estado = _const.espaco_estado_ativo
  ;
end;
$$;


--
-- TOC entry 532 (class 1255 OID 17047)
-- Name: funct_load_posto_simple(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_posto_simple(filter jsonb DEFAULT NULL::jsonb) RETURNS TABLE(posto_id uuid, posto_designacao character varying)
    LANGUAGE plpgsql
    AS $$
declare

  /** Carregar a lista de posto simples
    filter := {
      arg_espaco_auth: ID
    }
  */
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );
  _const map.constant;

begin
  _const := map.constant();

  return query
    select
        pt.posto_id,
        pt.posto_designacao
      from tweeks.posto pt
      where pt.posto_estado != _const.posto_estado_encerado
        and pt.posto_espaco_auth = any( arg_espaco_child )
      order by pt.posto_designacao asc
  ;
end;
$$;


--
-- TOC entry 533 (class 1255 OID 17048)
-- Name: funct_load_posto_status(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_posto_status(filters jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para devolver o status atual do posto
    filter := {
      arg_posto_id: ID,
      arg_espaco_auth: ID
    }
  */
  arg_espaco_auth uuid not null default filters->>'arg_espaco_auth';
  arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth );
  arg_posto_id uuid not null default filters->>'arg_posto_id';
  _data record;
  _const map.constant;
begin

  _const := map.constant();

  with posto_cheques as (
    select
        cx.caixa_posto_id,
        count( ct.conta_id ) filter( where ct.conta_tpaga_id = _const.tpaga_cheque ) as conta_cheque
      from tweeks.conta ct
        inner join tweeks.caixa cx on ct.conta_caixa_fechopagamento = cx.caixa_id
      where ct.conta_espaco_auth = any ( arg_espaco_child )
        and ct.conta_estado = _const.conta_estado_pago
        and cx.caixa_posto_id = arg_posto_id
      group by cx.caixa_posto_id

  ), conta_moedas as (
    select
        cx.caixa_posto_id,
        cu.*,
        sum( ct.conta_montantemoeda ) as conta_montantemoeda
      from tweeks.conta ct
        inner join tweeks.caixa cx on ct.conta_caixa_fechopagamento = cx.caixa_id
        inner join geoinfo.currency cu on ct.conta_currency_id = cu.currency_id
      where ct.conta_espaco_auth = any ( arg_espaco_child )
        and ct.conta_estado = _const.conta_estado_pago
        and cx.caixa_posto_id = arg_posto_id
      group by cx.caixa_posto_id,
        cu.currency_id

  ), posto_moeda as (
    select
        ct.caixa_posto_id,
        jsonb_agg (
          lib.jsonb_values( ct, 'currency_id', 'currency_code', 'currency_name' )
        ) as posto_moedas
      from conta_moedas ct
      group by ct.caixa_posto_id
  )
    select * into _data
      from tweeks.posto pos
        inner join tweeks.espaco esp on pos.posto_espaco_destino = esp.espaco_id
        left join posto_moeda pm on pos.posto_id = pm.caixa_posto_id
        left join posto_cheques pc on pos.posto_id = pc.caixa_posto_id
      where pos.posto_id = arg_posto_id
        and pos.posto_espaco_destino = any( arg_espaco_child )
  ;

  return  true ? lib.jsonb_values(
    _data,
    'posto_id',
    'posto_designacao',
    'posto_montante',
    'posto_estado',
    'posto_dataregistro',
    'posto_endereco',
    'espaco_id',
    'espaco_nome',
    'conta_cheque',
    'posto_moedas'
  );

end;
$$;


--
-- TOC entry 887 (class 1255 OID 17049)
-- Name: funct_load_serie(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_serie(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    arg_espaco_auth
    arg_colaborador_id
    arg_autorizacao_id
   */
  _const map.constant;
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_autorizacao_id uuid default args->>'arg_autorizacao_id';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  ___branch_uid uuid;
  _espaco_child uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth );
begin
  _const := map.constant();
  ___branch_uid := tweeks.__branch_uid( null, arg_espaco_auth );
  return query
    with
      __serie as (
        select _vs.*,
            e.espaco_id,
            e.espaco_nome
          from tweeks.serie _vs
            inner join tweeks.espaco e on _vs.serie_espaco_id = e.espaco_id
          where _vs._branch_uid = ___branch_uid
            and coalesce( _vs.serie_autorizacao_uid ) = coalesce( arg_autorizacao_id, _vs.serie_autorizacao_uid )
            and true in (
              _vs.serie_espaco_auth = any( _espaco_child ),
              _vs.serie_espaco_id = any( _espaco_child )
            )
      )
    select to_jsonb( _s )
      from __serie _s;
end;
$$;


--
-- TOC entry 855 (class 1255 OID 19515)
-- Name: funct_load_serie_available(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_serie_available(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
    declare
      /**
        args := {
          arg_espaco_auth:UUID
          arg_colaborado_id:UUID
        }
       */
        arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
        arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
        ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
        _const map.constant;
    begin

      _const := map.constant();

      -- Obter o espaço superior que pode gerar numero de seire
      return query
        with recursive __recursive_espaco as (
          select e.espaco_id as _espaco,
               e.*,
               ts.tserie_id, ts.tserie_desc, ts.tserie_code,
               s.serie_id, s.serie_numero, s.serie_numatorizacao, s.serie_numcertificacao
            from tweeks.espaco e
               full join tweeks.tserie ts on true
               left join tweeks.serie s on e.espaco_id = s.serie_espaco_id
                and s.serie_tserie_id = ts.tserie_id
                and s.serie_estado = _const.maguita_serie_estado_ativo
                and s._branch_uid = ___branch
            where e.espaco_id = arg_espaco_auth
              and e._branch_uid = ___branch
            
            union all
            select _re._espaco, e.*,
                   _re.tserie_id, _re.tserie_desc, _re.tserie_code,
                   s.serie_id, s.serie_numero, s.serie_numatorizacao, s.serie_numcertificacao
            from __recursive_espaco _re
              inner join tweeks.espaco e on _re.espaco_espaco_id = e.espaco_id
                and not _re.espaco_gerarfatura
              inner join tweeks.serie s on e.espaco_id = s.serie_espaco_id
                and _re.tserie_id = s.serie_tserie_id
              and s.serie_tserie_id = _re.tserie_id
              and s.serie_estado = _const.maguita_serie_estado_ativo
              and s._branch_uid = ___branch
            where e._branch_uid = ___branch
        ), __serie_espaco as (
          select
                _re._espaco as espaco_id,
                _re.espaco_id as espaco_serie,
                _re.espaco_nivel,
                _re.espaco_codigo,
                _re.espaco_nome,
                _re.tserie_id,
                _re.tserie_desc,
                _re.tserie_code,
                _re.serie_id,
                _re.serie_numcertificacao,
                _re.serie_numatorizacao,
                _re.serie_numero
            from __recursive_espaco  _re
            where _re.serie_id is not null
      ) select to_jsonb( _se )
          from __serie_espaco _se
      ;
      
    end;
  $$;


--
-- TOC entry 823 (class 1255 OID 17050)
-- Name: funct_load_stoks(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_stoks(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para carragar a quantidade em stock dos diferentes espaços
    args := {
      arg_colaborador_id: UUID
      arg_espaco_auth: UUID
      espaco_destino: UUID,
      artigos:[ UUID, UUID, UUID ]
    }
   */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';

  arg_espaco_destino uuid default args->>'espaco_destino';
  arg_artigos uuid[] default array( select jsonb_array_elements_text( args->'artigos' )::uuid);
begin
  if jsonb_array_length( args->'artigos' )  = 0 then
    arg_artigos := null;
  end if;

  return query
    with __stoks as (
        select
            art.artigo_id,
            art.artigo_nome,
            e.espaco_id,
            e.espaco_nome,
            s.stock_quantidade,
            n.index
          from tweeks.artigo art
            inner join tweeks.espaco e on e.espaco_id = coalesce( arg_espaco_destino, e.espaco_id )
            inner join tweeks._get_stock(art.artigo_id, arg_espaco_destino ) s on art.artigo_id = s.stock_artigo_id
            left join unnest( arg_artigos ) with ordinality n( id, index ) on art.artigo_id = n.id
          where art.artigo_id = any( coalesce( arg_artigos, array[]::uuid[] ) )

    ) select to_jsonb( s )
      from __stoks s
      order by s.index
      ;
end;
$$;


--
-- TOC entry 775 (class 1255 OID 17051)
-- Name: funct_load_tespaco(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_tespaco(filter jsonb DEFAULT NULL::jsonb) RETURNS TABLE(tespaco_id smallint, tespaco_designacao character varying)
    LANGUAGE sql
    AS $$
  -- Essa função lista os tipos de espaco
  select * from tweeks.tespaco t order by t.tespaco_designacao asc
$$;


--
-- TOC entry 824 (class 1255 OID 17052)
-- Name: funct_load_tipoimposto(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_tipoimposto(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para carregar os tipos de impostos registrados
    filter := {
      arg_espaco_auth: ID
      arg_colaborador_id UID
    }
   */

  arg_espaco_auth uuid not null default filter ->>'arg_espaco_auth';
  arg_colaborador_id uuid default filter->>'arg_colaborador_id';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );
  _const map.constant;

  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
begin
  _const := map.constant();

  return query
    with associacao as (
      select
        ls.link_referencia,

        jsonb_agg(
          lib.jsonb_values(
            to_jsonb( esp ),
              'espaco_id',
              'espaco_nome'
          )) as link

      from tweeks.link ls
        inner join tweeks.espaco esp on ls.link_espaco_destino = esp.espaco_id
          and esp._branch_uid = ___branch
      where ls.link_tlink_id = _const.maguita_tlink_associacao
        and ls.link_estado = _const.maguita_link_estado_ativo
        and ( ls.link_espaco_auth = any( arg_espaco_child ) or ls.link_espaco_destino = any( arg_espaco_child ) )
        and ls._branch_uid = ___branch
      group by ls.link_referencia
    ), imposto_taxa as (
      select
        tip.*,
        txow.*,
        coalesce( ass.link, jsonb_build_array() ) as link,
        coalesce( tx.taxa_percentagem, (txow::tweeks.taxa).taxa_percentagem ) as taxa_percentagem,
        coalesce( tx.taxa_taxa, (txow::tweeks.taxa).taxa_taxa ) as taxa_taxa,
        arg_espaco_auth = tip.tipoimposto_espaco_auth as tipoimposto_editinfo,
        true as tipoimposto_editespaco,
        true as tipoimposto_edittaxa
      from tweeks.tipoimposto tip
        left join associacao ass on ass.link_referencia @> jsonb_build_object( 'tipoimposto_id', tip.tipoimposto_id )
        left join tweeks.taxa tx on tip.tipoimposto_id = tx.taxa_tipoimposto_id
          and tx.taxa_estado = _const.taxa_estado_ativo
          and tx.taxa_espaco_auth = arg_espaco_auth
          and tx._branch_uid = ___branch
        left join rule.taxa_espaco( tx, _const, arg_espaco_auth ) txow on true
          and tx.taxa_estado = _const.taxa_estado_ativo
          and tx.taxa_espaco_auth = tip.tipoimposto_espaco_auth
      where
          tip._branch_uid = ___branch
        and ( tip.tipoimposto_espaco_auth = any( arg_espaco_child ) or ass.link_referencia is not null )
      order by
        tip.tipoimposto_nome
    ) select
      lib.jsonb_values(
        it,
        'tipoimposto_id',
        'tipoimposto_nome',
        'tipoimposto_codigo',
        'tipoimposto_dataatuzaliacao',
        'tipoimposto_estado',
        'tipoimposto_dataregistro',
        'link',
        'taxa_percentagem',
        'taxa_taxa',
        'tipoimposto_edittaxa',
        'tipoimposto_editespaco',
        'tipoimposto_editinfo'
      )
      from imposto_taxa it
      ;
end;
$$;


--
-- TOC entry 534 (class 1255 OID 17053)
-- Name: funct_load_tpaga(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_tpaga(filter jsonb DEFAULT NULL::jsonb) RETURNS TABLE(tpaga_id smallint, tpaga_designacao character varying)
    LANGUAGE sql
    AS $$
  -- Essa função lista os tipos de pagamento
  select * from tweeks.tpaga t order by t.tpaga_designacao asc
$$;


--
-- TOC entry 825 (class 1255 OID 17054)
-- Name: funct_load_trabalha(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_trabalha(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para carragar os espaços onde um colaborador trabalha
    filter := {
      arg_colaborador_id: ID
    }
  */
  arg_colaborador_id  uuid not null default filter->>'arg_colaborador_id';
  _const map.constant;
begin
  _const := map.constant();

  return query
    with aux as (
      select tr.*, esp.*
        from tweeks.trabalha tr
          inner join tweeks.espaco esp on tr.trabalha_espaco_destino = esp.espaco_id
        where tr.trabalha_colaborador_proprietario = arg_colaborador_id
          and tr.trabalha_estado = _const.trabalha_estado_ativo
          and esp.espaco_estado = _const.espaco_estado_ativo
    ) select lib.jsonb_values(
        a,
        'espaco_id',
        'espaco_nome',
        'espaco_descricao',
        'espaco_estado',
        'espaco_dataregistro',
        'espaco_dataatualizacao',
        'espaco_gerarfatura',
        'espaco_codigo',
        'espaco_configurar',
        'trabalha_id',
        'trabalha_estado'
      )
      from aux a
      order by a.trabalha_posicao,
        a.espaco_nivel,
        a.espaco_id
    ;
end;
$$;


--
-- TOC entry 535 (class 1255 OID 17055)
-- Name: funct_load_transferencia(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_transferencia(filter jsonb) RETURNS TABLE(transferencia_id uuid, transferencia_quantidade double precision, transferencia_data date, transferencia_documento character varying, transferencia_observacao character varying, transferencia_estado smallint, transferencia_dataregistro timestamp with time zone, transferencia_dataatualizacao timestamp with time zone, artigo_id uuid, artigo_nome character varying, artigo_codigo character varying, origem_espaco_id uuid, origem_espaco_nome character varying, destino_espaco_id uuid, destino_espaco_nome character varying)
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para listar as transferencias dos artigos
    filter := {
      arg_artigo_id: ID,
      arg_espaco_origem: ID,
      arg_espaco_destino: ID,
      arg_espaco_auth: ID,
    }
  */

  arg_artigo_id uuid default filter->>'arg_artigo_id';
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );
  arg_espaco_origem uuid default filter->>'arg_espaco_origem';
  arg_espaco_destino uuid default filter->>'arg_espaco_destino';

  _const map.constant;

begin
  _const := map.constant();

  return query
    select
        trans.transferencia_id,
        trans.transferencia_quantidade,
        trans.transferencia_data,
        trans.transferencia_documento,
        trans.transferencia_observacao,
        trans.transferencia_estado,
        trans.transferencia_dataregistro,
        trans.transferencia_dataatualizacao,

        art.artigo_id,
        art.artigo_nome,
        art.artigo_codigo,

        esporg.espaco_id,
        esporg.espaco_nome,

        espdest.espaco_id,
        espdest.espaco_nome
      from tweeks.transferencia trans
        inner join tweeks.stock origen on trans.transferencia_stock_origem = origen.stock_id
        inner join tweeks.stock dest on trans.transferencia_stock_destino = dest.stock_id
        inner join tweeks.artigo art on origen.stock_artigo_id = art.artigo_id
        inner join tweeks.espaco esporg on origen.stock_espacao_id = esporg.espaco_id
        inner join tweeks.espaco espdest on dest.stock_espacao_id = espdest.espaco_id
      where art.artigo_id = coalesce( arg_artigo_id, art.artigo_id )
        and esporg.espaco_id = coalesce( arg_espaco_origem, esporg.espaco_id )
        and espdest.espaco_id = coalesce( arg_espaco_destino, espdest.espaco_id )
        and trans.transferencia_espaco_auth = any( arg_espaco_child )
  ;
end;
$$;


--
-- TOC entry 902 (class 1255 OID 19826)
-- Name: funct_load_unit(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_load_unit(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
    /**doc
        Carregar os documentos 
        args := {
          _espaco_auth
          _user_id
        }
  doc*/
    _espaco_auth uuid not null default args->>'_espaco_auth';
    _user_id uuid not null default args->>'_user_id';
    _branch uuid default tweeks.__branch_uid( _user_id, _espaco_auth );
begin
  return query
    with _unit as (
      select *
        from tweeks.unit u
        where u._branch_uid = _branch
    ) select to_jsonb( _u ) from _unit _u;
end;
$$;


--
-- TOC entry 776 (class 1255 OID 17056)
-- Name: funct_pos__calc_imposto(uuid, double precision, jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos__calc_imposto(arg_artigo_id uuid, montante double precision, args jsonb DEFAULT NULL::jsonb) RETURNS TABLE(venda_imposto double precision, venda_impostoadicionar double precision, venda_impostoretirar double precision, venda_montantesemimposto double precision, venda_montantecomimposto double precision, impostos jsonb)
    LANGUAGE plpgsql
    AS $$
declare
  _const map.constant;
  _simple tweeks.impostovenda;
  _changes record;
  _data record;
begin
  /*_const := map.constant();
  _simple.impostovenda_espaco_auth := args->>'arg_espaco_auth';
  _simple.impostovenda_colaborador_id := args->>'arg_colaborador_id';
  _simple.impostovenda_venda_id := args->>'arg_venda_id';
  with __imposto as (
    select
        i.imposto_percentagem,
        i.imposto_valor,
        ti.tipoimposto_valor,
        ti.tipoimposto_percentagem,
        i.imposto_taplicar_id as aplicar_id,
        i.imposto_taplicar_id = _const.maguita_taplicar_retirar as retirar,
        i.imposto_taplicar_id = _const.maguita_taplicar_adicionar as adicionar,
        iv.impostovenda_id,
        iv.impostovenda_valor,
        iv.impostovenda_percentagem,
        iv,
        coalesce( i.imposto_percentagem, ti.tipoimposto_percentagem ) as percentagem,
        coalesce( i.imposto_valor, ti.tipoimposto_valor ) as valor
      from tweeks.imposto i
        inner join tweeks.tipoimposto ti on i.imposto_tipoimposto_id = ti.tipoimposto_id
        left join tweeks.impostovenda iv on ti.tipoimposto_id = iv.impostovenda_tipoimposto_id
          and iv.impostovenda_venda_id = _simple.impostovenda_venda_id
          and iv.impostovenda_estado = _const.maguita_venda_estado_aberto
      where i.imposto_artigo_id = arg_artigo_id
        and i.imposto_estado = _const.maguita_imposto_estado_ativo
  ), __calc_value as (
    select
        ip.*,
        case
          when ip.valor and ip.valor > 0 then ip.valor
          when ip.percentagem and ip.percentagem > 0  then ( ip.percentagem / 100 ) * montante
        end as value_apply
      from __imposto ip
  ), __calc_percent as (
    select
        cv.*,
        case
          when cv.percentagem is not null and cv.percentagem > 0  then cv.percentagem
          when cv.value_apply is not null and cv.value_apply > 0 then cv.value_apply / montante * 100
        end as percent_apply
      from __calc_value cv
  ), __sync as (
    select
        c.*, "returning"
      from __calc_percent c
        inner join lib.sets( c.iv, replacer := jsonb_build_object(
          'impostovenda_colaborador_id', _simple.impostovenda_colaborador_id,
          'impostovenda_espaco_auth', _simple.impostovenda_espaco_auth,
          'impostovenda_venda_id', _simple.impostovenda_venda_id,
          'impostovenda_valor', c.impostovenda_valor,
          'impostovenda_percentagem', c.impostovenda_percentagem,
        ) || to_jsonb( _simple ) ) on true
      where true in (
        c.impostovenda_valor != c.value_apply,
        c.impostovenda_percentagem != c.percent_apply
      )
  ) select count( * ) as changes, array_agg( "returning" ) into _changes from __sync;
  */

  funct_pos__calc_imposto.venda_imposto := 0;
  funct_pos__calc_imposto.venda_impostoadicionar := 0;
  funct_pos__calc_imposto.venda_impostoretirar := 0;
  funct_pos__calc_imposto.venda_montantesemimposto := montante;
  funct_pos__calc_imposto.venda_montantecomimposto := montante;
  funct_pos__calc_imposto.impostos := jsonb_build_array();
  return next;
end;
$$;


--
-- TOC entry 777 (class 1255 OID 17057)
-- Name: funct_pos__sync_conta_amount(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos__sync_conta_amount(args jsonb) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
declare
  arg_conta_id uuid default args->>'arg_conta_id';
  _const map.constant;
  _conta tweeks.conta;
begin
  _const := map.constant();
--   with __vendas  as(
--     select
--         ve.*,
--         coalesce( sum( vi.venda_montantetotal ), 0.0 ) as _venda_montanteagregado
--       from tweeks.venda ve
--         left join tweeks.venda vi on ve.venda_id = vi.venda_venda_id
--           and vi.venda_conta_id = arg_conta_id
--           and vi.venda_estado in ( _const.maguita_venda_estado_aberto, _const.maguita_venda_estado_fechado )
--
--       where ve.venda_conta_id  = arg_conta_id
--         and ve.venda_estado = _const.maguita_venda_estado_aberto
--         and ve.venda_venda_id is null
--
--       group by ve.venda_id
--   ), __venda_calcs as (
--     select
--         _ve._venda_montanteagregado,
--         _ve.venda_id,
--         _ve.venda_montante + _ve._venda_montanteagregado as _venda_montantetotal,
--         _vi.*
--       from __vendas _ve
--         inner join tweeks.funct_pos__calc_imposto( _ve.venda_artigo_id, _ve.venda_montante + _ve._venda_montanteagregado, args || jsonb_build_object(
--           'arg_venda_id', _ve.venda_id
--         )) _vi on true
--       where _ve.venda_id = _ve.venda_id
--         and _ve.venda_conta_id = arg_conta_id
--         and true in (
--           _ve.venda_montantetotal != _ve.venda_montante + _ve._venda_montanteagregado,
--           _ve.venda_montanteagregado != _ve._venda_montanteagregado,
--           _ve.venda_imposto != _vi.venda_imposto,
--           _ve.venda_impostoadicionar != _vi.venda_impostoadicionar,
--           _ve.venda_impostoretirar != _vi.venda_impostoretirar,
--           _ve.venda_montantesemimposto != _vi.venda_montantesemimposto,
--           _ve.venda_montantecomimposto != _vi.venda_montantecomimposto
--         )
--     ), __sync_calc as (
--     update tweeks.venda _up
--       set
--           venda_montantetotal = _vc._venda_montantetotal,
--           venda_montanteagregado = _vc._venda_montanteagregado,
--           venda_imposto = _vc.venda_imposto,
--           venda_impostoadicionar = _vc.venda_impostoadicionar,
--           venda_impostoretirar = _vc.venda_impostoretirar,
--           venda_montantesemimposto = _vc.venda_montantesemimposto,
--           venda_montantecomimposto = _vc.venda_montantecomimposto
--       from __venda_calcs _vc
--       where _vc.venda_id = _up.venda_id
--       returning _up.*, _vc.impostos
--   ) select count( * ) as changes, jsonb_agg( to_jsonb( s )) as syncs into _data from __sync_calc s;


  with __final_amount as (
    select sum( ve.venda_montantecomimposto ) as conta_montante
      from tweeks.venda ve
      where ve.venda_conta_id = arg_conta_id
        and ve.venda_venda_id is null
        and ve.venda_estado in (
          _const.maguita_venda_estado_aberto,
          _const.maguita_venda_estado_fechado
        )
  ), __sync_conta as (
    update tweeks.conta _c set
        conta_montante = _ve.conta_montante
      from __final_amount _ve
      where _c.conta_id = arg_conta_id
        and _c.conta_montante != _ve.conta_montante
      returning *
  ) select * into _conta from __sync_conta;

  return jsonb_build_object(
    'conta', _conta
  );
end;
$$;


--
-- TOC entry 826 (class 1255 OID 17058)
-- Name: funct_pos_change_caixa_close(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_change_caixa_close(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para fechar uma posto
    args := {
      arg_caixa_id: ID,
      arg_espaco_auth: ID,
      arg_colaborador_id: ID,
      arg_caixa_montantefecho: MONTANTE,
      arg_caixa_quantidadecheque: QUANT,
      arg_caixa_observacao: OBS,
    }
  */

  arg_caixa_id uuid not null default args->>'arg_caixa_id';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_caixa_montantefecho  double precision not null default args->>'arg_caixa_montantefecho';
  arg_caixa_quantidadecheque int2 not null default args->>'arg_caixa_quantidadecheque';
  arg_caixa_observacao varchar default args->>'arg_caixa_observacao';

  _posto record;
  _caixa tweeks.caixa;
  _const map.constant;
  _movimentos record;

begin

  _const := map.constant();
  _caixa := tweeks._get_caixa( arg_caixa_id );

  if _caixa.caixa_estado != _const.maguita_caixa_estado_ativo then
    return lib.res_false( 'Essa caixa não se encontra mais aberta!' );
  end if;

  select * into _posto
    from tweeks.posto cx
      inner join tweeks.caixa ab on cx.posto_id = ab.caixa_posto_id
    where ab.caixa_id = arg_caixa_id
      and ab.caixa_estado = _const.maguita_caixa_estado_ativo
      and cx.posto_estado = _const.maguita_posto_estado_aberto
  ;

  -- Obter a quantidade de cheque de venda
  select count( * ) into arg_caixa_quantidadecheque
    from tweeks.deposito de
    where de.deposito_caixa_id = _caixa.caixa_id
      and de.deposito_tpaga_id = _const.maguita_tpaga_cheque
      and de._tgrupo_id = _const.maguita_tgrupo_cnormal
  ;

  with __deposito as  (
    select
        sum( de.deposito_montantefinal ) as deposito_montantefinal,
        count( de.deposito_id ) as depositos,
        count( de.deposito_id ) filter ( where de.deposito_tpaga_id = _const.maguita_tpaga_cheque ) as depositos_cheques
      from tweeks.deposito de
      where de.deposito_posto_id = _caixa.caixa_posto_id
        and de._tgrupo_id = _const.maguita_tgrupo_cnormal
        and de.deposito_estado = _const.maguita_deposito_estado_ativo
  ), __transacao as (
    select
        sum( tr.transacao_montante ) as transacao_montante,
        sum( tr.transacao_montante ) filter ( where tr.transacao_montante >= 0 ) as transacao_montantecredito,
        sum( abs( tr.transacao_montante ) ) filter ( where tr.transacao_montante < 0 )  as transacao_montantedebito
      from tweeks.transacao tr
      where tr.transacao_posto_id = _caixa.caixa_posto_id
        and tr.transacao_estado = _const.maguita_transacao_estado_ativo
  ), __coa as (
    select
        _de.depositos,
        _de.depositos_cheques,
        coalesce( _de.deposito_montantefinal, 0.0 ) as deposito_montantefinal,
        coalesce( _tr.transacao_montante, 0.0 ) as transacao_montante,
        coalesce( _tr.transacao_montantecredito, 0.0 ) as transacao_montantecredito,
        coalesce( _tr.transacao_montantedebito, 0.0 ) as transacao_montantedebito
      from __deposito _de, __transacao _tr
  ) select
      _c.*,
      _c.transacao_montante + _c.deposito_montantefinal as posto_montantefinal
      into _movimentos
    from __coa _c
    ;

  _caixa.caixa_estado                   := _const.maguita_caixa_estado_fechado;
  _caixa.caixa_dataatualizacao          := current_timestamp;
  _caixa.caixa_colaborador_atualizacao  := arg_colaborador_id;
  _caixa.caixa_quantidadecheque         := arg_caixa_quantidadecheque;
  _caixa.caixa_quantidadechequeposto    := arg_caixa_quantidadecheque;
  _caixa.caixa_montantefecho            := arg_caixa_montantefecho;
  _caixa.caixa_montantefechoposto       := _movimentos.posto_montantefinal;
  _caixa.caixa_observacao               := arg_caixa_observacao;

  select ( "returning" ).* into _caixa
    from lib.sets_up( _caixa );

  return lib.res_true(jsonb_build_object(
    'caixa', _caixa
  ));
end;
$$;


--
-- TOC entry 778 (class 1255 OID 17059)
-- Name: funct_pos_change_conta_anular(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_change_conta_anular(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para atualar as contas
    args := {
      arg_conta_id: ID,
      arg_colaborador_id: ID,
      arg_espaco_auth: ID,
      arg_conta_observacao: OBSERVACAO
    }
   */

  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_conta_id uuid default args->>'arg_conta_id';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_conta_observacao varchar default args->>'arg_conta_observacao';

  _conta tweeks.conta;
  _const map.constant;
begin
  _const := map.constant();
  _conta := tweeks._get_conta( arg_conta_id );

  arg_conta_observacao := lib.str_nospace( arg_conta_observacao );

  if _conta.conta_estado  = _const.maguita_conta_estado_anulado then
    return lib.res_false( 'Essa conta já está anulado' );
  end if;

  if _conta.conta_estado != _const.maguita_conta_estado_aberto and arg_conta_observacao is null then
    return lib.res_false( 'É necessario informar uma obseravção para anular as contas fechadas e pagas' );
  end if;

  _conta.conta_estado                   := _const.maguita_conta_estado_anulado;
  _conta.conta_colaborador_atualizacao  := arg_colaborador_id;
  _conta.conta_dataatualizacao          := current_timestamp;
  _conta.conta_observacao               := arg_conta_observacao;

  select ( "returning" ).* into _conta
    from lib.sets_up( _conta )
  ;

  return lib.res_true( jsonb_build_object( 'conta', _conta ) );
end;
$$;


--
-- TOC entry 538 (class 1255 OID 17060)
-- Name: funct_pos_change_conta_fechar(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_change_conta_fechar(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
    /**
      Essa função fecha uma nova conta
      arg = {
        arg_espaco_auth: ID,
        arg_colaborador_id: ID,
        arg_tserie_id: ID,      
        deposito:{
          deposito_cliente_id
          deposito_caixa_id
          deposito_tpaga_id
          deposito_currency_id
          deposito_posto_id
          deposito_montantemoeda
          deposito_montantetroco
          deposito_data
          deposito_docref: DOCUMENTO-REF?
          deposito_observacao: OBSERVACAO?
        }

        conta_id: ID,
        conta_extension: {} | { reserva_id: UID }
        conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM },

        conta_posto_id: ID,
        conta_desconto

        conta_titular: NOME-CLIENTE
        conta_titularnif: VARCHAR,
        conta_data: DATA,
        conta_cliente_id,

        //Relativos a GUIA
        guia_documentoperacao: CODIGO,
        guia_dataopeacao: DATA,
        guia_observacao: DESCRICAO
        guia_metadata: { ... any extras data }

        custos:[{
          custoguia_montante: MONTANTE,
          custoguia_descricao: DESCRICAO PARA O CUSTO
          custoguia_tcusto_id: 1 - DESPESA | 2 - RECEITA
        }]
      }
     */

    arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
    arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
    arg_tserie_id int2 default args->>'arg_tserie_id';

    arg_conta_id uuid default args->>'conta_id';
    arg_caixa_id uuid default args->>'de_caixa_id';
    _deposito_montantetroco double precision;


    _conta tweeks.conta;
    _const map.constant;
    _caixa tweeks.caixa;
    _res lib.res;
    _cambio record;
    _montante_amortizacao double precision;
    _deposito tweeks.deposito;
    _rec record;
    _guia tweeks.guia;
    _message text;
  begin
    _const := map.constant();
    _caixa := tweeks._get_caixa( arg_caixa_id );
    _conta := tweeks._get_conta( arg_conta_id );
    _conta := jsonb_populate_record( _conta, args );
    _conta.conta_data := coalesce( _conta.conta_data, current_date );
    _deposito := jsonb_populate_record( _deposito, args->'deposito' );

    _message := tweeks.__check_conta_data( 
      _tserie_id := arg_tserie_id, 
      _conta_data := _conta.conta_data,
      _raise := false
    );
    
    if _message is not null then 
        return lib.res_false( _message );
    end if;
    
    if _conta.conta_id is null then 
      raise exception '%', 'Identificador da conta a ser fechada não foi informado!';
    end if;
    
    if _conta.conta_estado = _const.maguita_conta_estado_fechado then
      return lib.res_false( 'Essa conta já se encontra fechada!' );
    end if;
    
    if arg_tserie_id not in (
        _const.maguita_tserie_fatura,
        _const.maguita_tserie_faturarecibo,
        _const.maguita_tserie_guiasaida,
        _const.maguita_tserie_notacredito
    ) then
      return lib.res_false( 'Não pode fechar a conta o com tipo de serie selecionada!' );
    end if;
    
    if _conta.conta_posto_fecho is null then
      return lib.res_false( 'Necessario indicar o posto de fecho!' );
    end if;
    
    -- Na fatura recibo não pode haver conta corrente
    if arg_tserie_id = _const.maguita_tserie_faturarecibo and _deposito.deposito_montantemoeda is null then 
      return lib.res_false( 'O pagamento para as faturas/recibo é obrigatorio!' );
    end if;
    
    -- Os cliente finais só podem receber fatura/recibo ou nota de credito
    if true in (
        _conta.conta_cliente_id is null,
        _conta.conta_cliente_id = lib.to_uuid( 1 ) -- cliente final
    ) and arg_tserie_id not in (
      _const.maguita_tserie_faturarecibo
    ) then
      return lib.res_false( 'Só pode lançar nos cliente finais as futuras/recibos!');
    end if;
    
    
    -- Quando hover necessidade de efetuar o deposito então, deve-se obter a taxa de cambio para o dia
    if arg_tserie_id = _const.maguita_tserie_faturarecibo 
      or _deposito.deposito_montantemoeda is not null
    then
      if _deposito.deposito_tpaga_id = _const.maguita_tpaga_contacorrente then
        return lib.res_false( 'Tipo de pagamento invalido' );
      end if;
      
      -- Obter o cambio para a moeda selecionada
      select * into _cambio from tweeks.__load_cambio_day(
        arg_espaco_auth,
        _deposito.deposito_currency_id,
        _conta.conta_data,
        _const
      );
      
      if _cambio.cambio_id is null then
        return lib.res_false( 'Câmbio não foi encontrado!' );
      end if;
    end if;
    
    -- O valor do deposito nas conta de fatura/recibo deve ser o suficiente para cobrir o montante da fatura
    if arg_tserie_id = _const.maguita_tserie_faturarecibo then 
      if round( ( _cambio.cambio_taxa * _deposito.deposito_montantemoeda)::numeric, _const.money_round )  < round( _conta.conta_montante::numeric, _const.money_round ) then
        return lib.res_false( 'Montante para pagamento insuficiente' );
      end if;

      -- Se for para amortizar a conta a caixa tem que estar aberta
      if _caixa.caixa_estado != _const.maguita_caixa_estado_ativo then
        return lib.res_false( 'Pagamento rejeitado!' );
      end if;
    end if;

    -- Definir em aqual conta a fatura deve ser enviado
    _conta._tgrupo_id := case
      when arg_tserie_id = _const.maguita_tserie_faturarecibo then _const.maguita_tgrupo_cnormal
      when arg_tserie_id = _const.maguita_tserie_fatura then _const.maguita_tgrupo_ccorrente
      when arg_tserie_id = _const.maguita_tserie_guiasaida then _const.maguita_tgrupo_ccorrente
      when arg_tserie_id = _const.maguita_tserie_notacredito then _const.maguita_tgrupo_ccorrente
    end;
    
    -- Gerar a serie para a conta dependento do tipo do documento (fatura, faturarecibo, notacredito, guiasaida)
    _rec := tweeks.__sets_generate_documento( arg_espaco_auth, arg_tserie_id );
    _conta.conta_numerofatura := _rec.document;
    _conta.conta_serie := to_json( _rec );
    _conta.conta_serie_id = _rec.serie_id;

    _conta.conta_estado := _const.maguita_conta_estado_fechado;
    _conta.conta_imprensa := 1;
    _conta.conta_colaborador_fecho := arg_colaborador_id;
    _conta.conta_datafecho := current_timestamp;
    _conta.conta_cliente_id := coalesce( _conta.conta_cliente_id, lib.to_uuid( 1 ) );

    -- Gerar a Guia de saida
    _guia := jsonb_populate_record( _guia, args );
    _guia.guia_tguia_id := _const.maguita_tguia_saida;
    _guia.guia_espaco_saida := arg_espaco_auth;
    _guia.guia_toperacao_id := _const.maguita_toperacao_venda;
    _guia.guia_refclass := cluster.__format( 'tweeks.conta'::regclass );
    _guia.guia_refuid := _conta.conta_id;
    _guia.guia_refs := jsonb_build_object(
      'cliente', jsonb_build_object( 'cliente_id', _conta.conta_cliente_id ),
      'saida', jsonb_build_object( 'espaco_id', _conta.conta_espaco_auth )
    );

    _guia := tweeks.funct_sets_guia( jsonb_build_object(
      'guia', _guia,
      'custoguia', args->'custos',
      'arg_colaborador_id', arg_colaborador_id,
      'arg_espaco_auth', arg_espaco_auth
    ));

    -- Vicular a informaçao de guia na conta extension com a tag guia_id
    _conta.conta_extension := coalesce( _conta.conta_extension, jsonb_build_object() )
      || jsonb_build_object( 'guia_id', _guia.guia_uid );

    select ( "returning" ).* into _conta
      from lib.sets_up( _conta )
    ;

    
    -- Caso necessairio lançar o deposito viculado a conta
    if coalesce( _deposito.deposito_montantemoeda, 0.0 ) > 0 then
      
      _montante_amortizacao  := _deposito.deposito_montantemoeda * _cambio.cambio_taxa;
      if _montante_amortizacao > _conta.conta_montante and _conta._tgrupo_id != _const.maguita_tgrupo_ccorrente then
        _deposito_montantetroco := _montante_amortizacao - _conta.conta_montante;
      end if;

      _deposito_montantetroco := coalesce( _deposito_montantetroco, _deposito.deposito_montantetroco, 0.0 );

      _res := tweeks.funct_pos_reg_deposito(( args->'deposito' ) || jsonb_build_object(
          'arg_espaco_auth', arg_espaco_auth,
          'arg_colaborador_id', arg_colaborador_id,
          'arg_balance_accounts', false,
          'deposito_cliente_id', _conta.conta_cliente_id,
          'deposito_montantetroco', _deposito_montantetroco,
          '_tgrupo_id', _conta._tgrupo_id,
          'deposito_referencia', jsonb_build_object( 'conta_id', _conta.conta_id ), -- Vincula o deposito a conta
          'deposito_documento', _conta.conta_numerofatura,
          'deposito_serie', _conta.conta_serie,
          'deposito_serie_id', _conta.conta_serie_id,
          '_raise', true -- Criar exception para comportamentos indesejados
        ));
      
      if not _res.result then
        perform lib.result_exception(
            _res.message,
            detail := _res.data::text,
            hint := _res.error::text
          );
      else
        _deposito := jsonb_populate_record( null::tweeks.deposito, _res.data->'deposito' );
      end if;
    end if;

    return lib.res_true(
        message := '@tweeks.conta.invoice-closed-success',
        data := jsonb_build_object(
            'guia', _guia,
            'conta', tweeks._get_conta( _conta.conta_id ),
            'fatura', _conta.conta_numerofatura,
            'recibo', _deposito.deposito_documento
          )
      );
  end;
$$;


--
-- TOC entry 540 (class 1255 OID 17062)
-- Name: funct_pos_change_conta_proforma(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_change_conta_proforma(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_colaborador_id: UUID,
      arg_espaco_auth: UUID,

      conta_id UUID,
      conta_cliente_id: UID,
      conta_proformavencimento: DATE
      conta_proformaextras
    }
   */
  arg_conta_id uuid default args->>'conta_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';

  _conta tweeks.conta;
  _const map.constant;
  _invalid_date_message text;
begin
  _const := map.constant();
  _conta := tweeks._get_conta( arg_conta_id );

  if _conta.conta_estado != _const.maguita_conta_estado_aberto then
    return lib.res_false( 'Não pode colocar uma conta em modo proforma para as conta já fechada!' );
  end if;

  _invalid_date_message :=  tweeks.__check_conta_data(
    _tserie_id := _const.maguita_tserie_fatura,
    _conta_data := _conta.conta_data,
    _raise := true
  );
  
  if _invalid_date_message is not null then 
    return lib.res_false( _invalid_date_message );
  end if;
  
  _conta.conta_proforma := true;

  select ( "returning" ).* into _conta
    from lib.sets( _conta, args  );
  
  update tweeks.venda
    set venda_proforma = true
    where venda_conta_id = _conta.conta_id
      and venda_estado not in (
        _const.maguita_venda_estado_anulado,  
        _const.maguita_venda_estado_canselado  
      )
      and not venda_proforma
  ;

  return lib.res_true( jsonb_build_object(
    'conta', _conta
  ));
end;
$$;


--
-- TOC entry 539 (class 1255 OID 17063)
-- Name: funct_pos_generate_key(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_generate_key(args jsonb) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
  declare
    /**
      arg_colaborador_id uuid
      arg_espaco_auth uuid
     */
    arg_colaborador_id uuid default args->>'arg_colaborador_id';
    arg_espaco_auth uuid default args->>'arg_espaco_auth';
    ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
    _key character varying;
  begin
    while _key is null loop
        _key :=  cluster.next( 'artigo.key/seq', ___branch::text, lpad := 9, lpad_char := '0' );
        _key := format( 'CTK-%s-%s', _key, lib.dset_random_text(32 ) );
        if exists(
            select *
              from tweeks.conta ct
              where ct.conta_chave = _key
                and ct._branch_uid = ___branch
        ) then
          _key := null;
        end if;
      end loop;
    return _key;
  end;
  $$;


--
-- TOC entry 867 (class 1255 OID 17064)
-- Name: funct_pos_load_artigo(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_load_artigo(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_colaborador_id: UID,
      arg_espaco_auth: UID
      arg_classe_id: UID
      arg_artigo_nome:TXT
    }
   */
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_classe_id uuid default args->>'arg_classe_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  _const map.constant;
  _branch uuid not null default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
begin
  _const := map.constant();
  return query
    
    with __stock as (
      select *
        from tweeks.__fluxo_stock(
          _classe_uid := arg_classe_id,
          _branch := _branch
        )
    ), __artigo as (
    select
        art.artigo_id,
        art.artigo_classe_id,
        art.artigo_nome,
        art.artigo_foto,
        art.artigo_stocknegativo,
        art.artigo_estado,
        s.stock_quantidade,
        l.link_metadata,
        u.unit_id,
        u.unit_code,
        u.unit_name,
        count( di.dispoe_id ) as artigos_extras
      from tweeks.artigo art
        inner join tweeks.link l on art.artigo_id =(  l.link_referencia->>'artigo_id' )::uuid
          and l.link_estado = _const.maguita_link_estado_ativo
          and l.link_tlink_id = _const.maguita_tlink_preco
          and l.link_espaco_destino = arg_espaco_auth
        left join __stock s on art.artigo_id = s.artigo_id and s.espaco_id = arg_espaco_auth
        left join tweeks.dispoe di on art.artigo_id = di.dispoe_artigo_id
          and di.dispoe_estado = _const.dispoe_estado_ativo
        left join tweeks.unit u on art.artigo_unit_id = u.unit_id

    where art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id )
      group by art.artigo_id,
        s.stock_quantidade,
        l.link_metadata,
        art.artigo_stocknegativo,
        art.artigo_nome,
        art.artigo_foto,
        u.unit_id
      order by case
          when s.stock_quantidade > 0 or art.artigo_stocknegativo then 1
          else 2
        end,
        art.artigo_nome
  ) select to_jsonb( a ) from __artigo a;
end;
$$;


--
-- TOC entry 827 (class 1255 OID 17065)
-- Name: funct_pos_load_artigo_composto(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_load_artigo_composto(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  _const map.constant;
begin
  _const := map.constant();
  return query
    with recursive __artigo as (
      select
          art.artigo_id,
          art.artigo_nome,
          art.artigo_artigo_id as artigo_base,
          ab.artigo_nome as artigo_parent,
          art.artigo_compostoquantidade,
          1 as composicao_nivel
        from tweeks.artigo art
          inner join tweeks.artigo ab on art.artigo_artigo_id = ab.artigo_id
          inner join tweeks.link l on l.link_referencia @> lib.sets_ref( art )
            and l.link_espaco_destino = arg_espaco_auth
            and l.link_estado = _const.maguita_link_estado_ativo
          inner join tweeks.link l2 on l2.link_referencia @> lib.sets_ref( ab )
            and l2.link_espaco_destino = arg_espaco_auth
            and l2.link_estado = _const.maguita_link_estado_ativo
        where art.artigo_artigo_id is not null
      union all
        select
            _a.artigo_id,
            _a.artigo_nome,
            ip.artigo_id,
            ip.artigo_nome,
            _a.artigo_compostoquantidade * lk.artigo_compostoquantidade ,
            _a.composicao_nivel +1
          from __artigo _a
            inner join tweeks.artigo lk on _a.artigo_base = lk.artigo_id
            inner join tweeks.artigo ip on lk.artigo_artigo_id = ip.artigo_id
    ), __composto_group as (
      select
          _a.artigo_id,
          _a.artigo_nome,
          array_agg( to_jsonb( _a  ) ) as artigo_bases
        from __artigo _a
        group by
          _a.artigo_id,
          _a.artigo_nome
    ) select to_jsonb( _tg )
      from __composto_group _tg
    ;
end;
$$;


--
-- TOC entry 723 (class 1255 OID 17066)
-- Name: funct_pos_load_artigo_extras(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_load_artigo_extras(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_artigo_id: UID,
      arg_espaco_auth: UID,
      arg_colaborador_id: UID
    }
   */
  arg_artigo_id uuid not null default args->>'arg_artigo_id';
--   arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
--   arg_colaborador_id uuid not null default args->>'arg_colaborador_id';

    _const map.constant;

begin
  _const := map.constant();
  return query with __item as(
      select
          art.artigo_id,
          art.artigo_nome,
          l.link_metadata
        from tweeks.artigo art
          inner join tweeks.link l on to_jsonb( art ) @> l.link_referencia
            and l.link_estado = _const.maguita_link_estado_ativo
            and l.link_tlink_id = _const.maguita_tlink_preco
        where art.artigo_classe_id = _const.classe_itemextra
          and art.artigo_estado = _const.artigo_estado_ativo
    ), __extras as(
      select it.*
        from tweeks.dispoe d
          inner join __item it on d.dispoe_artigo_item = it.artigo_id
        where d.dispoe_artigo_id = arg_artigo_id
    ) select to_jsonb( e ) from __extras e;
end;
$$;


--
-- TOC entry 870 (class 1255 OID 17067)
-- Name: funct_pos_load_artigo_search(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_load_artigo_search(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      search_text:TXT,
      arg_espaco_auth
    }
   */
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  _search_text character varying default args->>'search_text';
  _search_text_like character varying;
  _const map.constant;
  ___branch uuid;
begin
  ___branch := tweeks.__branch_uid( null, arg_espaco_auth );
  
  _search_text := lib.str_nospace( lower( public.unaccent( _search_text ) ) );
  _search_text_like := format( '%s%s%s', '%', _search_text, '%' );

  _const := map.constant();
  return query with
    __ean as( select e.ean_artigo_id, array_agg( e.ean_code ) as ean_code from tweeks.ean e where e.ean_estado = _const.maguita_ean_estado_ativo group by e.ean_artigo_id ),
    __artigo as (
    select
        c.classe_id,
        c.classe_nome,
        u.unit_id,
        u.unit_code,
        u.unit_name,
        art.artigo_id,
        art.artigo_classe_id,
        art.artigo_nome,
        art.artigo_codigo,
        art.artigo_stocknegativo,
        art.artigo_estado,
        s.stock_quantidade,
        l.link_metadata,
        e.ean_code,
        count( di.dispoe_id ) as artigos_extras
      from tweeks.artigo art
        inner join tweeks.classe c on art.artigo_classe_id = c.classe_id
        inner join tweeks.link l on art.artigo_id =  ( l.link_referencia->>'artigo_id' )::uuid
          and l.link_estado = _const.maguita_link_estado_ativo
          and l.link_tlink_id = _const.maguita_tlink_preco
          and l.link_espaco_destino = arg_espaco_auth
        inner join tweeks.stock s on s.artigo_id = art.artigo_id
          and s.espaco_id = arg_espaco_auth
        left join tweeks.dispoe di on art.artigo_id = di.dispoe_artigo_id
          and di.dispoe_estado = _const.dispoe_estado_ativo
        left join __ean e on e.ean_artigo_id = art.artigo_id
        left join tweeks.unit u on art.artigo_unit_id = u.unit_id

    where art._branch_uid = ___branch
      group by art.artigo_id,
        c.classe_id,
        u.unit_id,
        s.stock_quantidade,
        l.link_metadata,
        art.artigo_stocknegativo,
        art.artigo_nome,
        e.ean_code
      order by case
          when s.stock_quantidade > 0 or art.artigo_stocknegativo then 1
          else 2
        end,
        art.artigo_nome
  ) select to_jsonb( a )
      from __artigo a
      where
        lower( public.unaccent( a.artigo_nome ) )  like _search_text_like
          or lower( public.unaccent( a.artigo_codigo ) )  like _search_text_like
          or  _search_text = any ( a.ean_code )
  ;
end
$$;


--
-- TOC entry 891 (class 1255 OID 17069)
-- Name: funct_pos_load_caixa_auth(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_load_caixa_auth(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_colaborador_id: UUID,
      arg_espaco_auth: UUID,
      arg_posto_id:UUID
      auth: BOOLEAN
    }
   */
  arg_posto_id uuid not null default args->>'arg_posto_id';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _const map.constant;
  _posto tweeks.posto;

begin
  _const := map.constant();

  select * into _posto from tweeks.posto;

  return query with
  __deposito as (
    select
        dep.deposito_caixa_id,
        dep.deposito_currency_id,
        cur.currency_id,
        cur.currency_name,
        cur.currency_code,
        sum( dep.deposito_montantefinal ) deposito_montantefinal,
        sum( dep.deposito_montante ) deposito_montante,
        sum( dep.deposito_montantemoeda ) deposito_montantemoeda,
        sum( dep.deposito_montantetroco ) deposito_montantetroco
      from tweeks.deposito dep
        inner join geoinfo.currency cur on dep.deposito_currency_id = cur.currency_id
      where dep.deposito_estado = _const.maguita_deposito_estado_ativo
        and dep._branch_uid = branch
      group by dep.deposito_caixa_id,
        dep.deposito_currency_id,
        cur.currency_id,
        cur.currency_name,
        cur.currency_code
  ),__deposito_caixa as (
      select
          dep.deposito_caixa_id,
          sum( dep.deposito_montantefinal ) as deposito_montantefinal,
          jsonb_object_agg(
              dep.currency_code, jsonb_build_object(
                  'deposito_montantemoeda', deposito_montantemoeda,
                  'deposito_montantefinal', deposito_montantefinal,
                  'deposito_montante', deposito_montante,
                  'deposito_montantetroco', deposito_montantetroco
              )
          ) as deposito_montantemoeda,
          sum( dep.deposito_montante ) as deposito_montante,
          sum( dep.deposito_montantefinal ) as deposito_montantefinal,
          sum( dep.deposito_montantetroco ) as deposito_montantetroco
        from __deposito dep
        group by
          dep.deposito_caixa_id
  ),__posto as (
    select
        c.caixa_id,
        c.caixa_estado,
        c.caixa_montanteinicial,
        c.caixa_montanteinicialposto,
        p.posto_caixamode,
        dep.*
      from tweeks.posto p
        inner join tweeks.caixa c on p.posto_id = c.caixa_posto_id
          and c.caixa_estado = _const.maguita_caixa_estado_ativo
          and case
            when p.posto_caixamode = _const.maguita_posto_caixamodo_pessoal then c.caixa_colaborador_id = arg_colaborador_id
            when p.posto_caixamode = _const.maguita_posto_caixamodo_espaco  then c.caixa_espaco_auth    = arg_espaco_auth
            when p.posto_caixamode = _const.maguita_posto_caixamodo_posto   then c.caixa_posto_id       = arg_posto_id
            else false
          end
        left join __deposito_caixa dep on c.caixa_id = dep.deposito_caixa_id
      where p.posto_id = arg_posto_id
        and p._branch_uid = branch
        and c._branch_uid = branch
  ) select to_jsonb( p )
    from __posto p;
end;
$$;


--
-- TOC entry 830 (class 1255 OID 17070)
-- Name: funct_pos_load_class(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_load_class(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_espaco_auth: UID,
      arg_colaborador_id: UID
    }
   */
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  _branch uuid not null default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _const map.constant;
begin
  _const := map.constant();

  return query with
    __classe as (
      select
          c.classe_id,
          c.classe_classe_id,
          c.classe_nome,
          c.classe_codigo,
          c.classe_foto,
          count( distinct lart.link_id ) filter ( where lart.link_id is not null ) as classe_artigos
        from tweeks.classe c
          inner join tweeks.link lcla on c.classe_id = (lcla.link_referencia->>'classe_id')::uuid
            and lcla.link_estado = _const.maguita_link_estado_ativo
          inner join tweeks.artigo art on c.classe_id = art.artigo_classe_id
            and art.artigo_estado = _const.artigo_estado_ativo
          inner join tweeks.link lart on art.artigo_id = ( lart.link_referencia->>'artigo_id' )::uuid
            and lart.link_estado = _const.maguita_link_estado_ativo
--             and lart.link_espaco_destino = artigo_espaco_auth
        where lcla.link_espaco_destino = arg_espaco_auth
          and lcla.link_tlink_id = _const.maguita_tlink_classe
          and c._branch_uid = _branch
          and art._branch_uid = _branch
          and lcla._branch_uid = c._branch_uid
          and lart._branch_uid = c._branch_uid
        group by c.classe_id
    ) select  to_jsonb( c )
      from __classe c;
end;
$$;


--
-- TOC entry 542 (class 1255 OID 17071)
-- Name: funct_pos_load_cliente(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_load_cliente(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_posto_id uuid default args->>'arg_posto_id';
  _const map.constant;
  __branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
begin
  _const := map.constant();

  --language=PostgreSQL
  return query
    with __cliente as (
      select
          c.cliente_id,
          c.cliente_titular,
          c.cliente_nif
        from tweeks.cliente c
        where ( c._branch_uid = __branch_uid and c.cliente_estado = _const.maguita_cliente_estado_ativo )

        order by
          case
            when c.cliente_id = lib.to_uuid( 1 ) then 1
            else 2
          end,
          c.cliente_titular
    ) select to_jsonb( _c ) from __cliente _c;
end
$$;


--
-- TOC entry 829 (class 1255 OID 17072)
-- Name: funct_pos_load_colaborador(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_load_colaborador(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para devolver os colaboradores que tenha pelo menos um menu especificado
    filter := {
      posto_id: UUID,
      menus:[ CODE, CODE, CODE ]
    }
  **/
  arg_posto_id uuid default args->>'posto_id';
  arg_menus character varying[] default array(select e.text from jsonb_array_elements_text( args->'menus' ) e ( text ));
  _const map.constant;
begin
  _const := map.constant();
  return query with
    __espacos as ( select e.espaco_id, e.espaco_nome, e.espaco_estado from tweeks.espaco e ),
    __colaborador as (
        select
            co.colaborador_id,
            co.colaborador_nome,
            co.colaborador_email,
            co.colaborador_accesso,
            co.colaborador_foto,
            co.colaborador_estado
          from auth.colaborador co
            inner join auth.acesso ac on co.colaborador_id = ac.acesso_colaborador_propetario
            inner join auth.menu me on ac.acesso_menu_id = me.menu_id
          where me.menu_codigo = any( arg_menus )
            and ac.acesso_estado = _const.acesso_estado_ativo
            and co.colaborador_estado = _const.colaborador_estado_ativo
            and co.colaborador_accesso in (
              _const.colaborador_accesso_ativo,
              _const.colaborador_accesso_pendente
            )
    ),
    __posto as (
      select
          po.posto_id,
          array_agg( al.aloca_espaco_destino ) as posto_alocacao
        from tweeks.posto po
          inner join tweeks.aloca al on po.posto_id = al.aloca_posto_id
            and al.aloca_estado = _const.maguita_aloca_estado_ativo
        where po.posto_id = arg_posto_id
        group by po.posto_id
    ), __local as (
      select
          tr.trabalha_colaborador_proprietario,
          array_agg( to_jsonb( e ) ) as colaborador_workspace
        from tweeks.trabalha tr
          inner join __posto p on tr.trabalha_espaco_destino = any( p.posto_alocacao )
          inner join __espacos e on tr.trabalha_espaco_destino = e.espaco_id
        where tr.trabalha_estado = _const.maguita_trabalha_estado_ativo
        group by tr.trabalha_colaborador_proprietario
    ), __trabalhador as (
      select *
        from __local lo
          inner join __colaborador co on lo.trabalha_colaborador_proprietario = co.colaborador_id
    ) select to_jsonb( tr ) from __trabalhador tr;
end;
$$;


--
-- TOC entry 779 (class 1255 OID 17073)
-- Name: funct_pos_load_conta_aberto(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_load_conta_aberto(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_colaborador_id: UID*,
      arg_espaco_auth: UID?,
      arg_posto_id: UID*
    }
   */
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_posto_id uuid not null default args->>'arg_posto_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  _const map.constant;
begin
  _const := map.constant();
  return query
    with __conta as(
      select
          ct.conta_id,
          ct.conta_numero,
          ct.conta_montante,
          ct.conta_mesa,
          ct.conta_chave,
          c.colaborador_id,
          c.colaborador_nome,
          c.colaborador_apelido,
          e.espaco_id,
          e.espaco_nome,
          count( ve.venda_id ) as conta_vendas
        from tweeks.conta ct
          inner join auth.colaborador c on ct.conta_colaborador_id = c.colaborador_id
          inner join tweeks.espaco e on ct.conta_espaco_auth = e.espaco_id
          left join tweeks.venda ve on ct.conta_id = ve.venda_conta_id
            and ve.venda_estado = _const.maguita_venda_estado_aberto
            and ve.venda_venda_id is null
        where ct.conta_posto_id = arg_posto_id
          and ct.conta_estado = _const.maguita_conta_estado_aberto
          and ct.conta_espaco_auth = coalesce( arg_espaco_auth, ct.conta_espaco_auth )
          and not ct.conta_proforma
        group by
          c.colaborador_id,
          ct.conta_id,
          e.espaco_id
    ) select to_jsonb( ct ) from __conta ct;
end;
$$;


--
-- TOC entry 781 (class 1255 OID 17074)
-- Name: funct_pos_load_conta_data(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_load_conta_data(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
    /**
      Essa função devolve uma mesa juntamente com as conta associada que ainda esta aberta
      filter := {
        with_client:boolean
        arg_posto_id: ID
        arg_espaco_auth: ID
        arg_colaborador_id: ID
        arg_conta_id: ID
      }
     */

--     arg_posto_id uuid  not null default filter->>'arg_posto_id';
    arg_espaco_auth uuid  not null default filter->>'arg_espaco_auth';
    arg_conta_id uuid not null default filter->>'arg_conta_id';
    arg_colaborador_id uuid default filter->>'arg_colaborador_id';
    _with_client boolean default filter->>'with_client';

    _const map.constant;
    _client jsonb;
    _conta tweeks.conta;
    ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
begin

  _const := map.constant();

  if _with_client then
    select to_jsonb( c ) into _client
      from cliente c
        inner join tweeks.conta ct on c.cliente_id = ct.conta_cliente_id
      where ct.conta_id = arg_conta_id
    ;
  end if;

  if _client is null then
    _client := jsonb_build_object();
  end if;

  select * into _conta
    from tweeks.conta ct
    where ct.conta_id = arg_conta_id
  ;

  return query with
    __venda as (
      select
        v.venda_id,
        v.venda_conta_id,
        v.venda_venda_id,
        v.venda_quantidade,
        v.venda_custoquantidade,
        v.venda_custounitario,
        v.venda_montante,
        v.venda_montantesemimposto,
        v.venda_montantecomimposto,
        v.venda_montantetotal,
        v.venda_imposto,
        v.venda_impostoadicionar,
        v.venda_impostoretirar,
        v.venda_montanteagregado,
        v.venda_isencao,
        v.venda_estado,
        v.venda_estadopreparacao,
        v.venda_metadata,
        v.venda_descricao,
        v.venda_validade,
        v.venda_editado,
        v.venda_taxas,
        v.venda_lote,
        a.artigo_id,
        a.artigo_nome,
        a.artigo_codigo,
        a.artigo_compostoquantidade,
        a.artigo_artigo_id,
        u.unit_id,
        u.unit_code,
        u.unit_name,
        tx.taxa_percentagem,
        tx.taxa_taxa,
        tip.tipoimposto_id,
        tip.tipoimposto_codigo,
        tip.tipoimposto_nome
      from tweeks.venda v
        inner join tweeks.artigo a on v.venda_artigo_id = a.artigo_id
        left join tweeks.taxa tx on tx.taxa_id = any ( v.venda_taxas )
        left join tweeks.tipoimposto tip on tx.taxa_tipoimposto_id = tip.tipoimposto_id
        left join tweeks.unit u on a.artigo_unit_id = u.unit_id
      where v._branch_uid = ___branch
        and v.venda_estado in (
           _const.maguita_venda_estado_aberto,
           _const.maguita_venda_estado_fechado
        )
    ), __venda_group as (
      select
          v.venda_id as _venda_id,
          v.venda_conta_id as _venda_conta_id,
          coalesce( array_agg( vi order by vi.artigo_nome ) filter ( where vi.venda_id is not null ),
            array[]::record[]
          ) as venda_itens
        from  tweeks.venda v
          inner join tweeks.artigo a on v.venda_artigo_id = a.artigo_id
          left join __venda vi on v.venda_id = vi.venda_venda_id
        where v.venda_estado in ( _const.maguita_venda_estado_aberto,  _const.maguita_venda_estado_fechado )
          and v.venda_venda_id is null
          and v.venda_conta_id = arg_conta_id
          and v.venda_estado in (
            _const.maguita_venda_estado_aberto,
            _const.maguita_venda_estado_fechado
          )
        group by v.venda_id, a.artigo_id
    ), __conta as (
      select
          c.conta_id,
          c.conta_numero,
          c.conta_numerofatura,
          c.conta_montante,
          c.conta_mesa,
          c.conta_estado,
          c.conta_serie,
          c.conta_observacao,
          c.conta_extension,
          c.conta_props,
          c.conta_serie_id,
          c._tgrupo_id,
          c.conta_data,
          c.conta_dataregistro,
          c.conta_conta_docorigin,
          c.conta_titular,
          c.conta_titularnif,
          ccl.cliente_id,
          ccl.cliente_code,
          ccl.cliente_nif,
          ccl.cliente_titular,
          ccl.cliente_metadata,
          de.deposito_montante,
          de.deposito_montantetroco,
          de.deposito_montantefinal,
          de.deposito_montantemoeda,
          de.deposito_tpaga_id,
          corigen.conta_numerofatura as conta_documentoorigem,
          array_agg( to_jsonb( v )||to_jsonb( vg ) order by v.artigo_nome ) as conta_vendas
        from tweeks.conta c
          left join tweeks.cliente ccl on c.conta_cliente_id = ccl.cliente_id
          left join tweeks.conta corigen on c.conta_conta_docorigin = corigen.conta_id
          left join __venda_group vg on c.conta_id = vg._venda_conta_id
          left join __venda v on vg._venda_id = v.venda_id
          left join tweeks.deposito de on c.conta_id = (de.deposito_referencia->>'conta_id')::uuid
        where c.conta_id = arg_conta_id
          and c._branch_uid = ___branch
        group by c.conta_id, 
          de.deposito_id,
          ccl.cliente_id,
          corigen.conta_id
     ) select to_jsonb( c ) || _client from __conta c
  ;

  if _conta._tgrupo_id = _const.maguita_tgrupo_cnormal then
    return query
      with __deposito as (
        select
            de.deposito_id,
            de.deposito_montante,
            de.deposito_montantemoeda,
            de.deposito_montantetroco,
            de.deposito_montantefinal,
            de.deposito_taxacambio,
            cu.currency_code,
            cu.currency_id,
            cu.currency_name,
            tp.tpaga_id,
            tp.tpaga_designacao,
            p.posto_designacao,
            p.posto_id,
            cx.caixa_id
          from tweeks.deposito de
            inner join geoinfo.currency cu on de.deposito_currency_id = cu.currency_id
            inner join tweeks.tpaga tp on de.deposito_tpaga_id = tp.tpaga_id
            left join tweeks.caixa cx on de.deposito_caixa_id = cx.caixa_id
            left join tweeks.posto p on cx.caixa_posto_id = p.posto_id
          where (de.deposito_referencia->>'conta_id')::uuid = _conta.conta_id
            and de._branch_uid = ___branch
      ) select to_jsonb( _de )
          from __deposito _de
    ;
  end if;
end
$$;


--
-- TOC entry 897 (class 1255 OID 17075)
-- Name: funct_pos_load_conta_dia(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_load_conta_dia(filter jsonb DEFAULT NULL::jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
    /** Essa função serve para devolver as compras do dia em uma data especifica
      filter := {
        arg_conta_data: DATE
        arg_posto_id: DATE
      }
     */
    _const map.constant;
    arg_conta_data date default filter->>'arg_conta_data';
    arg_posto_id uuid not null default filter->>'arg_posto_id';
begin

    _const := map.constant();
    arg_conta_data := coalesce( arg_conta_data, current_date );

    if arg_conta_data < current_date - make_interval( days := 7 ) then return; end if;

    return query
        with __conta as (
            select
                ct.conta_id,
                ct.conta_data,
                ct.conta_dataregistro,
                ct.conta_titular,
                ct.conta_titularnif,
                ct.conta_montante,
                ct.conta_numerofatura,
                ct.conta_numero,
                p.posto_designacao,
                p.posto_matricula,
                de.deposito_montante,
                de.deposito_montantemoeda,
                de.deposito_montantetroco,
                de.deposito_montantefinal,
                de.deposito_taxacambio,
                cu.currency_id,
                cu.currency_code,
                cu.currency_name,
                co.colaborador_id,
                co.colaborador_nome
            from tweeks.conta ct
                inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id
                inner join tweeks.deposito de on ( de.deposito_referencia->>'conta_id' )::uuid = ct.conta_id
                inner join geoinfo.currency cu on de.deposito_currency_id = cu.currency_id
                inner join auth.colaborador co on ct.conta_colaborador_fecho = co.colaborador_id
            where ct.conta_posto_fecho = arg_posto_id
              and ct.conta_estado = _const.maguita_conta_estado_fechado
              and ct._tgrupo_id = _const.maguita_tgrupo_cnormal
              and ct.conta_datafecho::date = arg_conta_data
        ) select to_jsonb( _ct )
        from __conta _ct
    ;
end
$$;


--
-- TOC entry 545 (class 1255 OID 17076)
-- Name: funct_pos_load_conta_proforma(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_load_conta_proforma(filter jsonb DEFAULT NULL::jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para devolver as compras do dia em uma data especifica
    filter := {
      arg_posto_id: DATE
      arg_espaco_id uuid
      arg_colaborador_id
    }
   */
  _const map.constant;
--   arg_posto_id uuid not null default filter->>'arg_posto_id';
  arg_colaborador_id uuid not null default filter->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';

  _posto tweeks.posto;
  __branch_uid uuid not null default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
begin
--   _posto := tweeks._get_posto( arg_posto_id );
  _const := map.constant();

  return query
    with __conta as (
      select
          ct.conta_id,
          ct.conta_data,
          ct.conta_dataregistro,
          ct.conta_titular,
          ct.conta_titularnif,
          ct.conta_montante,
          ct.conta_numerofatura,
          ct.conta_numero,
          ct.conta_proformavencimento,
          ct.conta_proformaextras,
          ct.conta_props,
          cli.cliente_id,
          cli.cliente_titular,
          cli.cliente_nif,
          cli.cliente_metadata,
          cli.cliente_documento,
          td.tdocumento_id,
          td.tdocumento_nome,
          co.colaborador_id,
          co.colaborador_nome,
          co.colaborador_apelido
        from tweeks.conta ct
          left join auth.colaborador co on coalesce( ct.conta_colaborador_fecho, ct.conta_colaborador_atualizacao, ct.conta_colaborador_id ) = co.colaborador_id
          left join tweeks.cliente cli on ct.conta_cliente_id = cli.cliente_id
          left join tweeks.tdocuemto td on cli.cliente_tdocument_id = td.tdocumento_id
        where ct._branch_uid = __branch_uid
          and ct.conta_estado = _const.maguita_conta_estado_aberto
          and ct.conta_proforma
    ) select to_jsonb( _ct )
        from __conta _ct
    ;
end
$$;


--
-- TOC entry 831 (class 1255 OID 17077)
-- Name: funct_pos_load_posto(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_load_posto(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para devolver o cambio do dia de uma moeda
    filter := {
      arg_chave_temporaria: CHAVE;
    }
  */

  _const map.constant;
  _chave_doc jsonb;
  _posto tweeks.posto;
  _posto_disponivel boolean;
  _local cluster.cluster;
begin
  _const := map.constant();
  _local := cluster._get_cluster_local();
  select * into _chave_doc
    from tweeks.funct_load_chave( args );

  _posto := jsonb_populate_record( _posto, _chave_doc );
  _posto_disponivel := _chave_doc->>'posto_disponivel';

  if _chave_doc is not null and not _posto_disponivel or _posto.posto_id is null then
    return next _chave_doc;
    return;
  elseif _chave_doc is null then
    return;
  end if;

  return next _chave_doc;

  return query
    with __cambio as (
      select
        c.currency_id,
        c.currency_name,
        c.currency_code,
        cb.cambio_id,
        cb.cambio_taxa,
        cb.cambio_data,
        cb.cambio_estado,
        cb.cambio_dataatualizacao,
        cb.cambio_espaco_auth,
        rank( ) over ( partition by cb.cambio_currency_id, cb.cambio_espaco_auth order by cb.cambio_dataregistro desc ) as cambio_rank
      from tweeks.cambio cb
        inner join geoinfo.currency c on cb.cambio_currency_id = c.currency_id
      where cb.cambio_data <= current_timestamp::date
        and cb.cambio_estado != _const.maguita_cambio_estado_anulado
      order by cb.cambio_dataregistro desc
    ), __space_cambio as (
      select
          e.espaco_id,
          e.espaco_nome,
          e.espaco_nivel,
          e.espaco_vender,
          _local.cluster_identifier,
          _local.cluster_name,
          _local.cluster_domain,
          _local.cluster_port,
          array_agg( c ) as espaco_cambios
        from __cambio c
          inner join tweeks.espaco e on c.cambio_espaco_auth = e.espaco_id
            and e.espaco_estado = _const.maguita_espaco_estado_ativo
          inner join tweeks.aloca al on e.espaco_id = al.aloca_espaco_destino
            and al.aloca_posto_id = _posto.posto_id
            and al.aloca_estado = _const.maguita_aloca_estado_ativo
        where c.cambio_rank = 1
          and e.espaco_vender = _local.cluster_identifier
        group by al.aloca_id,
          e.espaco_id
    ) select to_jsonb( sc )
      from __space_cambio sc
  ;
end;
$$;


--
-- TOC entry 543 (class 1255 OID 17078)
-- Name: funct_pos_reg_caixa(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_reg_caixa(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para registar uma nova caixa
    args := {
      arg_espaco_auth: ID
      arg_posto_id: ID
      arg_colaborador_id: ID
      caixa_montanteinicial: MONTANTE
    }
  */

  arg_posto_id uuid not null default args->>'arg_posto_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_caixa_montanteinicial double precision not null default args->>'caixa_montanteinicial';

  _data record;
  _posto tweeks.posto;
  _caixa tweeks.caixa;
  _const map.constant;
  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
begin

  select * into _posto
    from tweeks.posto
    where posto_id = arg_posto_id
  ;

  _const := map.constant();

  with __aloca as (
    select
      a.aloca_posto_id,
      sum( a.aloca_montante ) as aloca_montante
    from tweeks.aloca a
    where a.aloca_estado = _const.maguita_aloca_estado_ativo
      and a.aloca_posto_id = arg_posto_id
      and case
            when _posto.posto_caixamode = _const.maguita_posto_caixamodo_posto then true
            when _posto.posto_caixamode = _const.maguita_posto_caixamodo_espaco then a.aloca_espaco_destino = arg_espaco_auth
            when _posto.posto_caixamode = _const.maguita_posto_caixamodo_pessoal then a.aloca_espaco_destino = arg_espaco_auth
            else false
      end
    group by a.aloca_posto_id
  ), __caixa as (
    select
      cx.caixa_posto_id,
      mode() within group ( order by e.espaco_nome desc ) as espaco_nome,
      count( cx.caixa_id ) as posto_caixas
    from tweeks.caixa cx
           inner join tweeks.espaco e on cx.caixa_espaco_auth = e.espaco_id
    where cx.caixa_posto_id = arg_posto_id
      and cx.caixa_estado = _const.maguita_caixa_estado_ativo
    group by cx.caixa_posto_id
  ) select
      *,
      coalesce( aloca_montante, 0.0 ) as _aloca_montante
  into _data
  from tweeks.posto p
         left join __aloca al on p.posto_id = al.aloca_posto_id
         left join __caixa cx on p.posto_id = cx.caixa_posto_id
  where p.posto_id = arg_posto_id
  ;

  if  not _posto.posto_multiplecaixa and _data.posto_caixas > 0 then
    return lib.res_false(
        format( 'Esse posto só pode trabalhar com uma caixa a cada momento, por favor fechar primeiramente a caixa abertas atualmente!' )
      );
  end if;


  _caixa.caixa_colaborador_id := arg_colaborador_id;
  _caixa.caixa_posto_id := arg_posto_id;
  _caixa.caixa_montanteinicialposto := _data._aloca_montante;
  _caixa.caixa_montanteinicial := arg_caixa_montanteinicial;
  _caixa.caixa_espaco_auth := arg_espaco_auth;
  _caixa.caixa_code := tweeks.__generate_caixa_code( ___branch, arg_colaborador_id, arg_espaco_auth );

  select ( "returning" ).* into _caixa
    from lib.sets_in(_caixa  )
  ;

  _posto.posto_estado := _const.maguita_posto_estado_aberto;
  select ( "returning" ).* into _posto from lib.sets_up( _posto );

  return lib.res_true( jsonb_build_object(
      'caixa', _caixa,
      'posto', _posto
    ));
end
$$;


--
-- TOC entry 832 (class 1255 OID 17079)
-- Name: funct_pos_reg_cliente(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_reg_cliente(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
    /**
      args := {
        arg_colaborador_id:UUID*
        arg_espaco_auth:UUID*

        cliente_id:UUID?
        cliente_estado:ESTADO?

        cliente_titular:NAME*
        cliente_tdocument_id:TDOC?
        cliente_nif: NIF?
        cliente_mail: MAIL?
        cliente_documento: DOC-NUMBER?

      }
     */
    arg_colaborador_id uuid default args->>'arg_colaborador_id';
    arg_espaco_auth uuid default args->>'arg_espaco_auth';
    _client tweeks.cliente;
    _data record;
    ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
    _exists record;
  begin
    _client := jsonb_populate_record( _client, args );

    with __uniques as (
      select
          f.cliente_code as "CODIGO",
          f.cliente_mail as "EMAIL",
          f.cliente_nif as "NIF",
          format( '%s-%s', f.cliente_tdocument_id, f.cliente_documento ) as "DOCUMENTO",
          jsonb_build_object(
            'CODIGO', _client.cliente_code,
            'NIF', _client.cliente_nif,
            'EMAIL', _client.cliente_mail,
            'DOCUMENTO', case
                when true in ( f.cliente_documento is null, f.cliente_tdocument_id is null ) then null
                else format( '%s-%s', _client.cliente_tdocument_id, _client.cliente_documento )
             end
          ) as _math
        from tweeks.cliente f
        where f._branch_uid = ___branch
          and ( _client.cliente_id is null or _client.cliente_id != f.cliente_id )
    ) select lib.duplicates( jsonb_agg( _uf ), _uf._math , true ) as dulicates  into _exists
        from __uniques _uf
        group by _uf._math
  ;

  if _exists.dulicates is not null then
    return lib.res_false( format( '(%s) estão duplicados!', _exists.dulicates ) );
  end if;

    select * into _client
      from tweeks.cliente c
      where c.cliente_id = _client.cliente_id
    ;

    if _client.cliente_id is null then
      _client.cliente_colaborador_id := arg_colaborador_id;
      _client.cliente_espaco_auth := arg_espaco_auth;
    else
      _client.cliente_colaborador_atualizacao := arg_colaborador_id;
      _client.cliente_dataatualizacao := current_timestamp;
    end if;

    select * into _data
      from lib.sets( _client, replacer := args );
      _client := _data."returning"
    ;

    return lib.res_true(jsonb_build_object(
      'cliente', _client,
      'opr', _data.operation
    ));
  end
$$;


--
-- TOC entry 544 (class 1255 OID 17080)
-- Name: funct_pos_reg_conta(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_reg_conta(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função registra um nova conta
    arg = {
      -- obrigatorios
      arg_colaborador_id: ID,
      arg_espaco_auth: ID,

      conta_posto_id: ID,

      -- opcional
      conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM }
      conta_id: ID?
      conta_extension: {} | { reserva_id: UID }
      conta_chave: CHAVE

      conta_currency_id: ID,
      conta_tpaga_id: ID,

      conta_cliente_id:UID
      conta_titular: CLIENTE-NOME
      conta_titularnif: CLIENTE-NIF
      conta_data: DATA,
      conta_tserie_id

      -- requerido
      arg_vendas: [
        {
          venda_id?: UID,
          venda_artigo_id: UID,
          venda_quantidade: QUANT,
          venda_custounitario: COST
          venda_custoquantidade: COST

          + venda_editado
          + venda_isencao
          + venda_montante
          + venda_montanteagregado
          + venda_montantetotal
          + venda_imposto
          + venda_montantesemimposto
          + venda_montantecomimposto
          + venda_impostoadicionar
          + venda_impostoretirar

          + venda_descricao
          + venda_lote
          + venda_validade
          + venda_metadata

          arg_itens: [
              venda_id: UID
              venda_artigo_id: UID,
              venda_quantidade: QUANT,
              venda_custounitario: COST
              venda_custoquantidade: COST
              venda_descricao: DESCRICAO
              venda_lote: LOTE
              venda_validade: VALIDADE
              venda_metadata: {... any extras data}
            + venda_montantetotal
          ]
        }
      ]
    }
   */

  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_conta_id uuid default args->>'conta_id';
  arg_conta_chave character varying not null default args->>'conta_chave';
  arg_vendas jsonb not null default args->>'arg_vendas';

  _conta tweeks.conta;
  _const map.constant;
  _unsets jsonb[];
  _vendas uuid[] default array( select ( e.doc->>'venda_id' )::uuid from jsonb_array_elements( args->'arg_vendas' ) e ( doc ) where e.doc->>'venda_id' is not null);
  _sync jsonb;
  _reg_venda record;
  _change tweeks.conta;
  _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _message text;
  _new jsonb;
  _old jsonb;
begin
  _const := map.constant();
  _conta := tweeks._get_conta( arg_conta_id );
  
  if _conta.conta_id is null and exists(
    select *
      from tweeks.conta ct 
      where ct.conta_chave = arg_conta_chave
        and ct._branch_uid = _branch
  ) then
    return lib.res_false( 'Já existe uma conta com a mesma chave (atualize a pagina e tente novamente)!' );
  end if;
  
  _old := coalesce( to_jsonb( _conta ), jsonb_build_object() );
  _change := jsonb_populate_record( _conta, args );
  _change.conta_data := coalesce( _change.conta_data, current_date );
  _new := to_jsonb( _change );
  
  if _change.conta_tserie_id is null then 
      raise exception '%', format('O tipo de serie é obrigatorio na criação de uma nova conta!');
  end if;

  if _change.conta_id is null then
    _change.conta_colaborador_id := arg_colaborador_id;
    _change.conta_espaco_auth := arg_espaco_auth;
    _change.conta_numero := cluster.next( 'conta.conta_numero/seq',
      sub := _branch::text,
      lpad_char := '0',
      lpad := 5
    );
    _new := to_jsonb( _change );
  else
    _change.conta_colaborador_atualizacao := arg_colaborador_id;
    _new := to_jsonb( _change );
    _change.conta_dataatualizacao := current_timestamp;
  end if;
  
  _message := tweeks.__check_conta_data(
    _change.conta_tserie_id,
    _change.conta_data,
    false
  );
  
  if _message is not  null then
    return lib.res_false( _message );
  end if;
  
  select ( "returning" ).* into _conta
    from lib.sets( _change, replacer := args )  sets
    where _new != _old
  ;
  
  -- Canselar as vendas que não fazem mais parte de conta
  with recursive __venda as (
      select
          ve.venda_id,
          ve.venda_estado
        from tweeks.venda ve
        where ve.venda_conta_id = _conta.conta_id
          and ve.venda_venda_id is null
          and ve.venda_id != all( _vendas )
          and ve.venda_estado in (
            _const.maguita_venda_estado_aberto,
            _const.maguita_venda_estado_fechado
          )
      union all
        select
            ve.venda_id,
            ve.venda_estado
          from __venda vs
            inner join tweeks.venda ve on vs.venda_id = ve.venda_venda_id
          where vs.venda_estado in (
            _const.maguita_venda_estado_aberto,
            _const.maguita_venda_estado_fechado
          )
  ), __disable as(
    update tweeks.venda up
      set venda_estado = _const.maguita_venda_estado_canselado
      from __venda _v
      where up.venda_id = _v.venda_id
      returning *
  ) select array_agg( to_jsonb( d ) ) into _unsets
      from __disable d;


  _reg_venda :=  tweeks.funct_pos_reg_venda(
    jsonb_build_object(
      'arg_vendas', arg_vendas,
      'arg_message_error', true,
      'arg_espaco_auth', arg_espaco_auth,
      'arg_colaborador_id', arg_colaborador_id,
      'arg_conta_id', _conta.conta_id
    )
  );

  _sync := tweeks.funct_pos__sync_conta_amount(
    jsonb_build_object(
      'arg_conta_id', _conta.conta_id,
      'arg_colaborador_id', arg_colaborador_id,
      'arg_espaco_auth', arg_espaco_auth
    )
  );

  return lib.res_true( tweeks.funct_pos_load_conta_data( jsonb_build_object(
    'arg_posto_id', args->'conta_posto_id',
    'arg_espaco_auth', arg_espaco_auth,
    'arg_colaborador_id', arg_colaborador_id,
    'arg_conta_id', _conta.conta_id
  )) || jsonb_build_object(
    'sync', _sync,
    'sets', _reg_venda.data->'vendas',
    'unsets', coalesce( _unsets, array[]::jsonb[])
  ));

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.res_exception( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 890 (class 1255 OID 17082)
-- Name: funct_pos_reg_deposito(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_reg_deposito(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para registar uma nova amortizacao
    args := {
      arg_espaco_auth: ID,
      arg_colaborador_id: ID,

      deposito_montantetroco: TROCO*
      deposito_caixa_id: UID,
      deposito_tpaga_id: ID,
      deposito_currency_id: UID,
      deposito_posto_id: UID,
      deposito_cliente_id: UID,
      deposito_referencia: {conta_id}
      deposito_montantemoeda: MONTANTE,
      deposito_data: DATA,
      deposito_observacao: OBS?
      deposito_documento: DOC?
      deposito_docref: NUMERO DOC?,
      _tgrupo_id
    }
  */
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';

  _deposito tweeks.deposito;
  _posto tweeks.posto;
  _const map.constant;
  _cambio record;
  _caixa tweeks.caixa;
  _raise bool;
  _rec record;

begin

  _raise := args->>'_raise';

  _const := map.constant();
  _deposito := jsonb_populate_record( _deposito, args );


  if _deposito.deposito_posto_id is not null then
    _posto := tweeks._get_posto( _deposito.deposito_posto_id );
  end if;

  if _deposito.deposito_caixa_id is not null then
    _caixa := tweeks._get_caixa( _deposito.deposito_caixa_id );
    if _caixa.caixa_estado != _const.maguita_caixa_estado_ativo and _raise then
      raise exception 'Não pode registar um deposito numa caixa fechado!';
    elseif _caixa.caixa_estado != _const.maguita_caixa_estado_ativo then
      return lib.res_false( 'Não pode registar um deposito numa caixa fechado!' );
    end if;
  end if;
  _deposito.deposito_data := coalesce( _deposito.deposito_data, current_date );
  _deposito.deposito_colaborador_id := arg_colaborador_id;
  _deposito.deposito_espaco_auth := arg_espaco_auth;

  select * into _cambio from tweeks.__load_cambio_day(
    arg_espaco_auth,
    _deposito.deposito_currency_id,
    current_date,
    _const
  );

  if _cambio.cambio_id is null and _raise then
    raise exception '@tweeks.conta.cambio-not-found';
  elseif _cambio.cambio_id is null then
    return lib.res_false( 'Câmbio não foi encontrado!' );
  end if;

  _deposito.deposito_montante := _deposito.deposito_montantemoeda * _cambio.cambio_taxa;

  if coalesce( _deposito.deposito_montantetroco, 0.0 ) >= _deposito.deposito_montante and _raise then
    raise exception 'O montante de troco tem que ser inferior a montante cambiado!';
  elsif coalesce( _deposito.deposito_montantetroco, 0.0 ) >= _deposito.deposito_montante then
    return lib.res_false( 'O montante de troco tem que ser inferior a montante cambiado!' );
  end if;

  if _deposito.deposito_referencia is null or _deposito.deposito_documento is null then
    _rec := tweeks.__sets_generate_documento( arg_espaco_auth, 3 /* Recibo*/ );
    _deposito.deposito_documento := _rec.document;
    _deposito.deposito_serie := to_json( _rec );
    _deposito.deposito_serie_id := _rec.serie_id;
  end if;

--     if _deposito.deposito_referencia is null then
--         _deposito.deposito_documento := tweeks.__sets_generate_documento( arg_espaco_auth, 2 /*Fatura Recibo */  );
--     else
--         _deposito.deposito_documento := tweeks.__sets_generate_documento( arg_espaco_auth, 3 /* Recibo*/ );
--     end if;
--   --_deposito.deposito_documento := tweeks.__generate_deposito_serie( arg_espaco_auth );

  select ( "returning" ).* into _deposito
    from lib.sets( _deposito )
  ;

  return lib.res_true(
    jsonb_build_object(
      'deposito', _deposito
    )
  );
end;
$$;


--
-- TOC entry 859 (class 1255 OID 17083)
-- Name: funct_pos_reg_retalho(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_reg_retalho(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /*
   args := {
      arg_colaborador_id,
      arg_espaco_auth,

      retalho_artigo_composto
      retalho_artigo_base
      retalho_composicao
      retalho_quantidade
   }
   */
    arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
    arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
    
    _artigo_base tweeks.artigo;
    _artigo_composto tweeks.artigo;
    _retalho tweeks.retalho;
    ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
    __stock record;
begin
    _retalho := jsonb_populate_record( _retalho, args );
    _artigo_base := tweeks._get_artigo( _retalho.retalho_artigo_base );
    _artigo_composto := tweeks._get_artigo( _retalho.retalho_artigo_composto );
    
    if _artigo_composto.artigo_artigo_id is null or _artigo_composto.artigo_compostoquantidade is null then
      return lib.res_false( 'O artigo selecionano para retalhar não é um artigo composto!' );
    end if;
    
    __stock := tweeks._get_stock( _retalho.retalho_artigo_composto, arg_espaco_auth );
    
    if __stock.stock_quantidade < _retalho.retalho_quantidade
        and not _artigo_composto.artigo_stocknegativo
    then
      return lib.res_false( 'Quantidade do artigo composto no armazem atual não é suficiente para retalhar!');
    end if;
    
    _retalho.retalho_codigo = tweeks.__generate_retalho_code( ___branch );
    _retalho.retalho_colaborador_id := arg_colaborador_id;
    _retalho.retalho_espaco_auth := arg_espaco_auth;
    
    select ( "returning" ).* into _retalho
      from lib.sets( _retalho );
    
    return lib.res_true(jsonb_build_object(
        'retalho', _retalho
    ));
end;
$$;


--
-- TOC entry 556 (class 1255 OID 17084)
-- Name: funct_pos_reg_venda(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_reg_venda(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para associar mais vendas a conta
    args := {
      arg_colaborador_id: ID,
      arg_conta_id: ID,
      arg_espaco_auth: ID,
      arg_message_error: TRUE|FALSE,
      arg_venda_id: ID
      arg_vendas: [{
          venda_id?: UID,
          venda_artigo_id: UID,
          venda_quantidade: QUANT,
          venda_custounitario: COST
          venda_custoquantidade: COST

          + venda_editado BOOLEAN
          + venda_isencao BOOLEAN
          + venda_montante
          + venda_montanteagregado
          + venda_montantetotal
          + venda_imposto
          + venda_montantesemimposto
          + venda_montantecomimposto
          + venda_impostoadicionar
          + venda_impostoretirar

          + venda_descricao
          + venda_lote
          + venda_validade
          + venda_metadata
          + venda_taxas

          arg_itens: [
              venda_id: UID
              venda_artigo_id: UID,
              venda_quantidade: QUANT,
              venda_custounitario: COST
              venda_custoquantidade: COST
              venda_descricao: DESCRICAO
              venda_lote: LOTE
              venda_validade: VALIDADE
              venda_metadata: {... any extras data}
            + venda_montantetotal
          ]
        }
      ]
    }
   */

  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_conta_id uuid not null default args->>'arg_conta_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_vendas jsonb not null default args->>'arg_vendas';
  arg_message_error boolean default args->>'arg_message_error';

  _const map.constant;
  _conta tweeks.conta;
  _data record;
  _stocks record;
  _simple tweeks.venda;
  __vendas tweeks.venda[];

begin
  _const := map.constant();
  _conta := tweeks._get_conta( arg_conta_id );

  -- Quando a conta não esta aberta
  if _conta.conta_estado != _const.maguita_conta_estado_aberto and arg_message_error then
    raise exception '@conta.estado.not-closed';
  elseif  _conta.conta_estado != _const.maguita_conta_estado_aberto then
    return false ? '@conta.estado.not-closed';
  end if;

  _stocks := tweeks.__check_stock_on_venda( arg_espaco_auth, arg_vendas );

  if not _stocks.stocks  and arg_message_error then
    raise exception '%', _stocks.message;

  elsif not _stocks.stocks  then
    return lib.res_false(
      _stocks.message
    );
  end if;

  with recursive __element as (
    select
        row_number() over () as row,
           ( jsonb_populate_record( null::tweeks.venda, e.doc || jsonb_build_object(
              'venda_proforma', _conta.conta_proforma
          ) )).*,
--         ( e.doc->>'venda_artigo_id' )::uuid  as venda_artigo_id,
--         ( e.doc->>'venda_quantidade' )::double precision as venda_quantidade,
--         ( e.doc->>'venda_custounitario' )::double precision as venda_custounitario,
--         ( e.doc->>'venda_custoquantidade' )::double precision as venda_custoquantidade,
        ( e.doc || jsonb_build_object(
          'venda_proforma', _conta.conta_proforma
        ) )::jsonb  as document,
        coalesce( e.doc->'arg_itens', '[ ]'::jsonb )::jsonb as itens,
        false as _is_extension
      from jsonb_array_elements( arg_vendas ) e ( doc )
    union all
      select
          row,
          ( jsonb_populate_record( null::tweeks.venda, e.doc || jsonb_build_object(
              'venda_montanteagregado', 0,
              'venda_imposto', 0,
              'venda_montantesemimposto', 0,
              'venda_montantecomimposto', 0,
              'venda_imposto', 0,
              'venda_editado', false,
              'venda_taxas', jsonb_build_array(),
              'venda_proforma', _conta.conta_proforma
            
            ))).*,
--           ( e.doc->>'venda_artigo_id' )::uuid  as venda_artigo_id,
--           ( e.doc->>'venda_quantidade' )::double precision as venda_quantidade,
--           ( e.doc->>'venda_custounitario' )::double precision as venda_custounitario,
--           ( e.doc->>'venda_custoquantidade' )::double precision as venda_custoquantidade,
          ( e.doc || jsonb_build_object(
            'venda_proforma', _conta.conta_proforma
          ))::jsonb  as document,
          coalesce( e.doc->'arg_itens', '[]'::jsonb )::jsonb as itens,
          true as _is_extension
        from __element ep
          inner join jsonb_array_elements( ep.itens ) e( doc ) on jsonb_array_length( ep.itens ) > 0
        where jsonb_array_length( ep.itens ) > 0
          and ep.itens is not null
  ), __calcs as (
    select
        e.*,
        e.document as docreplacer,
        ve.venda_id as _venda_id,
        coalesce( ve.venda_dataregistro, now() ) as venda_dataregistro,
        coalesce( ve.venda_colaborador_id, arg_colaborador_id ) as venda_colaborador_id,
        coalesce( ve.venda_conta_id, arg_conta_id ) as venda_conta_id,
        coalesce( ve.venda_espaco_auth, arg_espaco_auth ) as venda_espaco_auth,
        case
          when art.artigo_preparacao then _const.maguita_venda_estadopreparacao_pendente
          else _const.maguita_venda_estadopreparacao_preparado
        end as venda_estadopreparacao
      from __element e
        inner join tweeks.artigo art on e.venda_artigo_id = art.artigo_id
        left join tweeks.venda ve on ve.venda_id = ( e.document->>'venda_id' )::uuid
      where ve.venda_id is null
        or( ve.venda_id is not null and true in (
          ve.venda_quantidade != e.venda_quantidade,
          ve.venda_custounitario != e.venda_custounitario,
          ve.venda_custoquantidade != e.venda_custoquantidade,
          ve.venda_montante != e.venda_montante,
          ve.venda_montanteagregado != e.venda_montanteagregado,
          coalesce( ve.venda_proforma, false ) != coalesce( e.venda_proforma, false ),
          ve.venda_montantetotal != e.venda_montantetotal,
          ve.venda_imposto != e.venda_imposto,
          ve.venda_montantesemimposto != e.venda_montantesemimposto,
          ve.venda_montantecomimposto != e.venda_montantecomimposto,
          ve.venda_impostoadicionar != e.venda_impostoadicionar,
          ve.venda_impostoretirar != e.venda_impostoretirar,
          ve.venda_descricao != e.venda_descricao,
          ve.venda_lote != e.venda_lote,
          ve.venda_validade != e.venda_validade,
          ve.venda_artigo_id != e.venda_artigo_id,
          ve.venda_metadata::text != e.venda_metadata::text
        ))
  ), __sets as (
    select "returning"::tweeks.venda, row, c._is_extension
      from __calcs c
        inner join lib.sets( _simple, replacer := (to_jsonb( c ) - 'venda_estado' - 'venda_id' - 'venda_taxas')
          || c.docreplacer
          ||  jsonb_build_object(
          'venda_colaborador_atualizacao', case
            when c._venda_id is null then null
            else arg_colaborador_id
          end,
          'venda_dataatualizacao', case
            when c._venda_id is null then null
            else current_timestamp
          end
        )) on true
      where not c._is_extension
    union all
      select _s."returning"::tweeks.venda, c.row, true
        from __sets sui
          inner join __calcs c on sui.row = c.row and c._is_extension
          inner join lib.sets( _simple, replacer := ( to_jsonb( c ) - 'venda_estado' - 'venda_id' - 'venda_taxas' )
              || c.docreplacer
              || jsonb_build_object(
            'venda_venda_id', (sui."returning"::tweeks.venda).venda_id,
            'venda_colaborador_atualizacao', case
              when c._venda_id is null then null
              else arg_colaborador_id
              end,
            'venda_dataatualizacao', case
              when c._venda_id is null then null
              else current_timestamp
            end
          )) _s on true
        where not sui._is_extension
  ) select array_agg( "returning" ) into __vendas from __sets;

  return lib.res_true( jsonb_build_object(
    'vendas', __vendas
  ));
end
$$;


--
-- TOC entry 833 (class 1255 OID 17086)
-- Name: funct_pos_reg_vendaimposto(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_reg_vendaimposto(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para aplicar os imposto numa venda
    args := {
      arg_colaborador_id: ID,
      arg_venda_id: ID,
      arg_artigo_id: ID,
      arg_espaco_auth: ID
    }
   */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_venda_id uuid not null default args->>'arg_venda_id';
  arg_artigo_id uuid not null default args->>'arg_artigo_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  _data record;
  _const map.constant;
  _venda tweeks.venda;

  arg_taxa_taxa double precision;
  arg_taxa_percentagem double precision;
  _taxa_agregada record;

  arg_venda_montantesemimposto double precision;
  arg_valor_retirar_bruto double precision;
  arg_valor_retirar_percentagem double precision;
  arg_imposto_multiplicador double precision;

  arg_venda_impostoadicionar double precision default 0.0;
  arg_venda_impostoretirar double precision default 0.0;
  icount int2 default 0;

begin

  _const := map.constant();
  _venda := tweeks._get_venda( arg_venda_id );

  _taxa_agregada := tweeks._get_impostos_taxa( arg_artigo_id, arg_espaco_auth );


  -- Retivar o valor bruto em seguida retivar o valor da percentagem
  arg_valor_retirar_bruto := _taxa_agregada.taxa_retirar;
  arg_valor_retirar_percentagem := rule.taxa_retirar_percentagem_adicionada(
    _venda.venda_montantetotal - arg_valor_retirar_bruto,
    _taxa_agregada.percentagem_retirar
  );

  arg_venda_montantesemimposto := _venda.venda_montantetotal - ( arg_valor_retirar_bruto + arg_valor_retirar_percentagem );

  -- Desativar todos os impostos que não vão mais ser aplicados
  update tweeks.impostovenda
    set impostovenda_estado = _const.impostovenda_estado_fechado,
        impostovenda_colaborador_atualizacao = arg_colaborador_id,
        impostovenda_dataatualizacao = current_timestamp
    where impostovenda_venda_id = _venda.venda_id
      and impostovenda_estado = _const.impostovenda_estado_ativo
  ;

  for _data in
    select
      ip.*,
      (txass::tweeks.taxa).*,
      tap.*
    from tweeks.imposto ip
      inner join tweeks.taplicar tap on ip.imposto_taplicar_id = tap.taplicar_id
      inner join tweeks.taxa txass on ip.imposto_tipoimposto_id = txass.taxa_tipoimposto_id
    where txass.taxa_id = any( _taxa_agregada.taxas )
      and ip.imposto_artigo_id = arg_artigo_id
      and ip.imposto_estado = _const.maguita_imposto_estado_ativo
  loop

    arg_taxa_taxa := 0;
    arg_taxa_percentagem := 0;
    arg_imposto_multiplicador := 1.0;
    arg_venda_impostoadicionar := 0;
    arg_venda_impostoretirar := 0;

    -- Quando a taxa a aplicar for
    if _data.taxa_percentagem is not null and _data.taxa_percentagem > 0.0 then
      arg_taxa_taxa :=  coalesce( arg_venda_montantesemimposto * ( _data.taxa_percentagem / 100.0 ), 0 );
      arg_taxa_percentagem := _data.taxa_percentagem;

    elsif _data.taxa_taxa is not null and _data.taxa_taxa > 0 then
      arg_taxa_taxa := _data.taxa_taxa;
      arg_taxa_percentagem := ( _data.taxa_taxa  * 100.0 ) / arg_venda_montantesemimposto;

    end if;

    -- Se o valor for zero então saltar a taxa
    if arg_taxa_taxa = 0 then continue; end if;

    if _data.taplicar_id = _const.taplicar_adicionar then
      arg_venda_impostoadicionar := arg_venda_impostoadicionar + arg_taxa_taxa;
    else
      arg_venda_impostoretirar := arg_venda_impostoretirar + arg_taxa_taxa;
    end if;

    if _data.taplicar_id = _const.taplicar_retirar then
      arg_imposto_multiplicador := -1.0;
    end if;

    insert into tweeks.impostovenda(
      impostovenda_venda_id,
      impostovenda_tipoimposto_id,
      impostovenda_espaco_auth,
      impostovenda_colaborador_id,
      impostovenda_valor,
      impostovenda_percentagem
    ) values (
      arg_venda_id,
      _data.taxa_tipoimposto_id,
      arg_espaco_auth,
      arg_colaborador_id,
      ( arg_taxa_taxa * arg_imposto_multiplicador ),
      arg_taxa_percentagem
    );
    icount := icount +1;
  end loop;

  update tweeks.venda
    set venda_montantesemimposto = arg_venda_montantesemimposto,
        venda_montantecomimposto = arg_venda_montantesemimposto + arg_venda_impostoadicionar + arg_venda_impostoretirar,
        venda_imposto = arg_venda_impostoadicionar + arg_venda_impostoretirar,
        venda_impostoadicionar = arg_venda_impostoretirar,
        venda_impostoretirar = arg_venda_impostoretirar
    where venda_id = arg_venda_id
    returning * into _venda
  ;

  return true ? jsonb_build_object(
    'venda', _venda
  );
end;
$$;


--
-- TOC entry 894 (class 1255 OID 19759)
-- Name: funct_pos_report_venda(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_pos_report_venda(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_posto_id uuid default args->>'arg_posto_id';
  arg_date_start date default args->>'arg_date_start';
  arg_date_end date default args->>'arg_date_end';
  branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _const map.constant;
begin
  _const := map.constant();
  return query
    with __venda as (
      select
          art.artigo_id,
          art.artigo_nome,
          v.venda_custounitario,
          sum( v.venda_quantidade ) as venda_quantidade,
          sum( v.venda_montantecomimposto ) as venda_montantecomimposto,
          sum( v.venda_montantesemimposto ) as venda_montantesemimposto
        from tweeks.venda v
          inner join tweeks.artigo art on v.venda_artigo_id = art.artigo_id
          inner join tweeks.conta ct on v.venda_conta_id = ct.conta_id
        where v._branch_uid = branch
          and v.venda_estado = _const.maguita_venda_estado_fechado
          and ct.conta_estado = _const.maguita_conta_estado_fechado
          and ct.conta_datafecho::date >= coalesce( arg_date_start, ct.conta_datafecho::date )
          and ct.conta_datafecho::date <= coalesce( arg_date_end, ct.conta_datafecho::date )
          and ct.conta_posto_fecho = arg_posto_id
        group by art.artigo_id,
          v.venda_custounitario
    ) select to_jsonb( v2 )
        from __venda v2
    ;
end;
$$;


--
-- TOC entry 782 (class 1255 OID 17087)
-- Name: funct_reg_acerto(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_acerto(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para efetuar o acerto do stock
    args = {
      arg_espaco_auth: ID
      arg_espaco_id: ID,
      arg_colaborador_id := ID,

      acerto_observacao: OBS
      arg_acerto: [{
        artigo_id:UUID,
        acerto_quantidade: QUANTIDADE
      }]
    }
  */

  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_espaco_id uuid not null default args->>'arg_espaco_id';
  arg_acerto_observacao varchar default args->>'acerto_observacao';

  arg_acerto_corecao double precision;

  _const map.constant;
  _stock record;
  _acerto tweeks.acerto;
  _new tweeks.acerto;

  _acerto_group uuid;
  _data record;
  acertos jsonb default jsonb_build_array();
  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
begin
  _const := map.constant();

  for _data in
    select
        (e.doc->>'artigo_id')::uuid as artigo_id,
        (e.doc->>'acerto_quantidade')::double precision as acerto_quantidade
      from jsonb_array_elements( args->'arg_acerto' ) e( doc )
  loop

    _stock := tweeks._get_stock( _data.artigo_id, arg_espaco_id );
    arg_acerto_corecao := _stock.stock_quantidade - _data.acerto_quantidade;
    _acerto_group := public.uuid_generate_v4();
    _new.acerto_codigo := tweeks.__generate_acerto_code( ___branch );
    _new.acerto_colaborador_id :=    arg_colaborador_id;
    _new.acerto_quantidade :=        _data.acerto_quantidade;
    _new.acerto_quantidadeinicial := _stock.stock_quantidade;
    _new.acerto_correcao :=          arg_acerto_corecao;
    _new.acerto_observacao :=        arg_acerto_observacao;
    _new.acerto_espaco_auth :=       arg_espaco_auth;
    _new.acerto_oprgroup :=          _acerto_group;
    _new.acerto_artigo_id :=         _data.artigo_id;
    _new.acerto_espaco_id :=         arg_espaco_id;

    -- Save acerto
    select ( "returning" ).* into _acerto
      from lib.sets_in( _new )
    ;

    _stock := tweeks._get_stock( _data.artigo_id, arg_espaco_id );
    acertos := acertos || jsonb_build_object(
      'acerto', _acerto,
      'stock', _stock,
      'artigo', tweeks._get_artigo( _stock.stock_artigo_id )
    );
  end loop;

  return  true ? acertos;
end;
$$;


--
-- TOC entry 600 (class 1255 OID 17088)
-- Name: funct_reg_artigo(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_artigo(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare

    /**
      Essa funçao serve para registar os artigos associado aos seus item extras
      {
        ///PARA-QUANDO-FOR-COMPOSTO
            artigo_artigo_id: ID
            artigo_compostoquantidade:DOUBLE
        PARA-QUANDO-FOR-COMPOSTO//

        artigo_classe_id: ID,
        artigo_codigo: CODIGO,
        artigo_nome: NOME,
        artigo_preparacao: TRUE|FALSE,
        artigo_stocknegativo: TRUE|FALSE,
        artigo_foto: FOTO,
        artigo_descricao: DESCRICAO,

        --
        artigo_id: ID

        arg_colaborador_id: ID,
        arg_espaco_auth: ID

        arg_items: [
          @id/item_id,
          @id/item_id,
          @id/item_id
        ],

        arg_links: [
          { espaco_id: ID, precario_custo: CUSTO, precario_quantidade: QUANT_CUSTO, stock_minimo:QUANT }
        ],

        arg_imposto: [ {
            arg_tipoimposto_id: ID,
            arg_taplicar_id: ID,
            arg_imposto_valor: VALOR, # Por equanto envie null
            arg_imposto_percentagem: PERCENTAGEM, # Por enquanto envie null
        }],

        arg_ean_codes: [ { ean_code:*CODE, ean_dateout:DATE|NULL, ean_datein:DATE|NULL } ]
        arg_ean_disable: [ CODES ]
      }
     */

    arg_artigo_id uuid default args->>'artigo_id';
    arg_artigo_compostoid uuid default args->>'artigo_artigo_id';
    arg_artigo_compostoquantidade double precision default args->>'artigo_compostoquantidade';
    arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
    arg_classe_id uuid not null default args->>'artigo_classe_id';
    arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
    arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );

    arg_artigo_codigo varchar not null  default lib.str_normalize( args->>'artigo_codigo' );

    _artigo tweeks.artigo;
    _const map.constant;
    _res_precario lib.result;
    _result lib.result;
    _branch uuid := tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
    _args tweeks.artigo;
begin

    _const := map.constant();
    _args := jsonb_populate_record( _args, args );
    _artigo := tweeks._get_artigo( _args.artigo_id );

    if _args.artigo_classe_id = _const.classe_itemextra then
        return false ? 'Não pode registar um item extra!';
    end if;

    -- Nome não pode ser duplicado
    if (
        select count( * ) > 0
        from tweeks.artigo art
        where lib.str_normalize( public.unaccent( lower ( art.artigo_nome ) ) ) = lib.str_normalize( public.unaccent( lower ( _args.artigo_nome ) ) )
          and art._branch_uid = _branch
          and art.artigo_id::text != coalesce( arg_artigo_id::text, art.artigo_id||'!?' )
    ) then
        return false ? 'Nome do artigo já existe!';
    end if;

    -- Quando o artigo for novo
    if _artigo.artigo_id is null then
      -- Avaliar a composição do artigo
      if arg_artigo_compostoid is not null and ( arg_artigo_compostoquantidade is null or arg_artigo_compostoquantidade = 0 ) then
        return false ? 'Para artigos composto, é necessario expecificar a quantidade do itens a compor';
      end if;

      _args.artigo_colaborador_id := arg_colaborador_id;
      _args.artigo_espaco_auth := arg_espaco_auth;
      _args.artigo_dataregistro := clock_timestamp();
    else
      _args.artigo_colaborador_id := _artigo.artigo_colaborador_id;
      _args.artigo_espaco_auth := _artigo.artigo_espaco_auth;
      _args.artigo_dataregistro := _artigo.artigo_dataregistro;
      _args.artigo_colaborador_atualizacao := arg_colaborador_id;
      _args.artigo_dataatualizacao := clock_timestamp();
    end if;

    -- Garantir que o codigo do artigo não seja duplicado
    if _args.artigo_codigo is not null and (
      select count( * ) > 0
      from tweeks.artigo art
      where lib.str_normalize( lower( art.artigo_codigo ) ) = lib.str_normalize( lower( _args.artigo_codigo ) )
        and art.artigo_id::text != coalesce( arg_artigo_id::text, art.artigo_id||'!?' )
        and art.artigo_espaco_auth = any( arg_espaco_child )
    ) then
      return false ? 'Código do artigo já existe!';
    elseif _args.artigo_codigo is null and _artigo.artigo_codigo is not null then
      _args.artigo_codigo := _artigo.artigo_codigo;
    end if;

    if _args.artigo_codigo is null then
      _args.artigo_codigo := tweeks.__generate_artigo_code( _args.artigo_classe_id );
    end if;

    select ( "returning" ).* into _artigo
      from lib.sets( _args, jsonb_build_object(
        'artigo_artigo_id', _args.artigo_artigo_id,
        'artigo_compostoquantidade', _args.artigo_compostoquantidade
      ))
    ;

    _result := tweeks.funct_reg_dispoe(
      jsonb_build_object(
        'arg_atrigo_id', _artigo.artigo_id,
        'arg_espaco_auth', arg_espaco_auth,
        'arg_colaborador_id', arg_colaborador_id,
        'arg_items', args->'arg_items'
      )
    );

    _res_precario := tweeks.funct_reg_precario(
        jsonb_build_object(
        'arg_espaco_auth', arg_espaco_auth,
        'arg_colaborador_id', arg_colaborador_id,
        'arg_forced', true,
        'arg_precario_referencia', lib.sets_ref( _artigo ),
        'arg_links', args->'arg_links'
      )
    );

    perform tweeks.funct_reg_imposto(
    jsonb_build_object(
        'arg_artigo_id', _artigo.artigo_id,
        'arg_colaborador_id', arg_colaborador_id,
        'arg_espaco_auth', arg_espaco_auth,
        'arg_imposto', args->'arg_imposto'
      )
    );

    perform tweeks.funct_reg_ean( jsonb_build_object(
      'arg_artigo_id', _artigo.artigo_id,
      'arg_espaco_auth', arg_espaco_auth,
      'arg_colaborador_id', arg_colaborador_id,
      'arg_ean_codes', coalesce( args->'arg_ean_codes', jsonb_build_array() ),
      'arg_ean_disable', coalesce( args->'arg_ean_disable', jsonb_build_array() )
    ));

    _result.message := _result.message || _res_precario.message || jsonb_build_object(
        'artigo', _artigo
    );

    return _result;

exception  when others then
    <<_ex>> declare e text; m text; d text; h text; c text;
    begin
        get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
        return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
    end;
end
$$;


--
-- TOC entry 783 (class 1255 OID 17090)
-- Name: funct_reg_cambio(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_cambio(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para registar o valor cambio
    args := {
      arg_branch_uid: UID
      arg_espaco_auth: ID
      arg_colaborador_id: ID,
      arg_currency_id
      arg_cambio_taxa: VALOR_TAXA,
      arg_cambio_data: DATE
    }
  */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_branch_uid uuid not null default args->>'arg_branch_uid';
  arg_currency_id int2 not null default args->>'arg_currency_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_cambio_taxa double precision not null default args->>'arg_cambio_taxa';
  arg_cambio_data date not null default args->>'arg_cambio_data';

  _const map.constant;
  _cambio tweeks.cambio;
  arg_cambio_estado int2;
  _data record;
begin

  if arg_branch_uid is null then arg_branch_uid := tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); end if;
  if arg_branch_uid is null then arg_branch_uid := tweeks.__branch_uid( null, arg_espaco_auth ); end if;
  if arg_branch_uid is null then arg_branch_uid := tweeks.__branch_uid( arg_colaborador_id, null ); end if;

  _const := map.constant();
  arg_cambio_data := current_date;

  select * into _data
    from  tweeks.cambio cb
    where cb.cambio_currency_id = arg_currency_id
        and cb.cambio_estado = _const.cambio_estado_ativo
        and cb.cambio_espaco_auth = arg_espaco_auth
    order by cb.cambio_dataregistro desc
  ;

  raise notice '%', to_jsonb( _data );



  if arg_currency_id = _const.currency_std
    and ( _data.cambio_id is not null or arg_cambio_taxa != 1 )
  then
    return false ? 'Câmbio de STN não pode ser atualizado!';
  end if;

  update tweeks.cambio
    set cambio_estado = _const.cambio_estado_fechado,
        cambio_dataatualizacao = current_timestamp,
        cambio_colaborador_atualizacao = arg_colaborador_id
    where cambio_estado = _const.cambio_estado_ativo
      and cambio_currency_id = arg_currency_id
      and cambio_espaco_auth = arg_espaco_auth
  ;

  insert into tweeks.cambio (
    cambio_colaborador_id,
    cambio_currency_id,
    cambio_taxa,
    cambio_espaco_auth
  ) values (
    arg_colaborador_id,
    arg_currency_id,
    arg_cambio_taxa,
    arg_espaco_auth
  ) returning * into _cambio;

  return true ? jsonb_build_object( 'cambio', _cambio  );

end;
$$;


--
-- TOC entry 784 (class 1255 OID 17091)
-- Name: funct_reg_classe(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_classe(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função cria uma nova classe
    args {
      arg_espaco_auth: ID
      arg_colaborador_id: ID
      arg_espacos:[{
        espaco_id: UID
      }]

      classe_id:UID     --Apenas para quando for editar
      classe_nome: NOME
      classe_foto: FOTO
      classe_classe_id: ID
    }
   */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_classe_nome character varying not null default lib.str_normalize( args->>'classe_nome' );
  arg_classe_id uuid default args->>'classe_id';
  _arg_espacos jsonb[] default array( select e.doc from jsonb_array_elements( args->'arg_espacos' ) e( doc ) );
  arg_espacos_id uuid[] default array( select (e.doc->>'espaco_id')::uuid from jsonb_array_elements( args->'arg_espacos' ) e( doc ) );

  arg_espaco_child uuid[];

  _const map.constant;
  _classe tweeks.classe;
  _link tweeks.link;
  _links jsonb;

begin

  _const := map.constant();
  arg_espaco_child := rule.espaco_get_childrens_static( arg_espaco_auth );

  -- Verificar se existe a instancia da classe
  select * into _classe
    from tweeks.classe cla
    where public.unaccent( lower( lib.str_normalize( cla.classe_nome ) ) ) = public.unaccent( lower( lib.str_normalize( arg_classe_nome ) ))
  ;

  if _classe.classe_id = _const.classe_itemextra then
    return false ? 'Esse nome de categoria esta reservado!';
  end if;

  if arg_classe_id is not null then
    select * into _classe
      from tweeks.classe c
      where c.classe_id = arg_classe_id;
  end if;

  _classe.classe_colaborador_id := arg_colaborador_id;
  _classe.classe_espaco_auth := (args->>'arg_espaco_auth')::uuid;

  -- select * into _classe from tweeks.classe;
  select ( "returning" ).* into _classe
    from lib.sets( _classe, replacer :=  args )
  ;


  update tweeks.link
    set link_estado = _const.maguita_link_estado_fechado,
        link_colaborador_atualizacao = arg_colaborador_id,
        link_dataatualizacao = current_timestamp
    where link_estado = _const.maguita_link_estado_ativo
      and link_tlink_id = _const.maguita_tlink_classe
      and link_referencia @> lib.sets_ref( _classe )
      and link_espaco_destino = any( arg_espaco_child )
--       and link_espaco_destino != all( arg_espacos_id )
  ;

  -- Criar ligação com as classes
  select jsonb_agg( to_jsonb( e ) ) into _links
    from unnest( _arg_espacos ) e( doc )
      inner join tweeks.espaco esp on  e.doc @> lib.sets_ref( esp )
      inner join lib.sets( _row := null::tweeks.link, replacer := e.doc|| jsonb_build_object(
        'link_tlink_id', _const.maguita_tlink_classe,
        'link_espaco_destino', esp.espaco_id,
        'link_espaco_auth', arg_espaco_auth,
        'link_colaborador_id', arg_colaborador_id,
        'link_referencia', lib.sets_ref( _classe ),
        'link_nome', format( 'Ligação da categoria %I com %I', _classe.classe_nome, esp.espaco_nome ),
        'link_metadata', jsonb_build_object()
      ) ) on true
  ;

  return lib.result_true(jsonb_build_object(
    'classe', _classe,
    'links', _links
  ));
end;
$$;


--
-- TOC entry 785 (class 1255 OID 17092)
-- Name: funct_reg_colaborador(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_colaborador(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para cadastra novos colaboradores
    Ao cadastar o colaborador a senha é atribuida automaticamente em um random
    E gerado tambem um token que devera ser enviado pela aplicao ao email do colaborador cadastrado
    O email e o NIF tem que ser unico
    args := {
      arg_colaborador_id: ID,
      arg_espaco_auth: ID,
      arg_espaco : [
        { arg_espaco_id: ID }
      ]
      arg_colaborador_email: EMAIL,
      arg_colaborador_nome: NOME,
      arg_colaborador_apelido: APELIDO,
      arg_colaborador_nif: NIF,
      arg_colaborador_datanascimento: DATA,
      arg_colaborador_ficha: FICHA,
      arg_colaborador_foto: FICHA,
      arg_tsexo_id: ID,
      arg_colaborador_senha: DEFAULT_SENHA_IF_EXIST,
      arg_colaborador_pin: DEFAULT_PIN_IF_SET,
      arg_branch_uid: UUID
      arg_colaborador_tipo
    }

   */
  arg_branch_uid uuid                       := args->>'arg_branch_uid';
  arg_colaborador_id uuid                   := args->>'arg_colaborador_id';
  arg_espaco_auth uuid                      := args->>'arg_espaco_auth';
  arg_colaborador_email character varying   := args->>'arg_colaborador_email';
  arg_colaborador_nome character varying    := args->>'arg_colaborador_nome';
  arg_colaborador_apelido character varying := args->>'arg_colaborador_apelido';
  arg_colaborador_nif character varying     := args->>'arg_colaborador_nif';
  arg_colaborador_datanascimento date       := args->>'arg_colaborador_datanascimento';
  arg_colaborador_ficha jsonb               := args->>'arg_colaborador_ficha';
  arg_colaborador_foto varchar               := args->>'arg_colaborador_foto';
  arg_tsexo_id int2                         := args->>'arg_tsexo_id';
  arg_colaborador_token text;
  arg_menu_list jsonb                       := args->>'arg_menu_list';
  arg_colaborador_pin varchar               := args->>'arg_colaborador_pin';
  arg_colaborador_senha varchar             := args->>'arg_colaborador_senha';
  arg_colaborador_tipo int2             := args->>'arg_colaborador_tipo';


  _const map.constant;
  _colaborador auth.colaborador;
  _res lib.result;

begin
  _const := map.constant();
  -- normalizar os dados do colaborador
  arg_colaborador_email := lower( lib.str_normalize( arg_colaborador_email ) );
  arg_colaborador_nif := lower( lib.str_normalize( arg_colaborador_nif ) );
  arg_colaborador_nome := lib.str_normalize( arg_colaborador_nome );
  arg_colaborador_apelido := lib.str_normalize( arg_colaborador_apelido );

  -- As informacoes do tipo texto tem que estar normalizados
  if arg_colaborador_email is null then
    return lib.result_false( '@auth.colaborador.invalid-mail' );
  end if;

  if arg_colaborador_nome is null then
    return lib.result_false( '@auth.colaborador.invalid-name' );
  end if;

  -- Garantir que nao exista o  NIF
  if (
       select count( * )
       from auth.colaborador co
       where co.colaborador_email =  arg_colaborador_email
     ) > 0 then
    return lib.result_false( '@auth.colaborador.email-exist' );
  end if;

  -- Garantir que o nif seja unico
  if (
       select count( * )
       from auth.colaborador co
       where co.colaborador_nif = arg_colaborador_nif
     ) > 0 then
    return lib.result_false( '@auth.colaborador.nif-exist' );
  end if;

  arg_colaborador_tipo := coalesce( arg_colaborador_tipo, _const.colaborador_tipo_user );
  insert into auth.colaborador(
    colaborador_colaborador_id,
    colaborador_email,
    colaborador_nome,
    colaborador_apelido,
    colaborador_nif,
    colaborador_datanascimento,
    colaborador_foto,
    colaborador_tsexo_id,
    colaborador_espaco_auth,
    colaborador_branch_uid,
    colaborador_tipo
  ) values (
     arg_colaborador_id,
     arg_colaborador_email,
     arg_colaborador_nome,
     arg_colaborador_apelido,
     arg_colaborador_nif,
     arg_colaborador_datanascimento,
     arg_colaborador_foto,
     arg_tsexo_id,
     arg_espaco_auth,
     arg_branch_uid,
     arg_colaborador_tipo
   ) returning * into _colaborador;

  perform auth.funct_reg_acesso(
      jsonb_build_object(
          'arg_colaborador_id', arg_colaborador_id,
          'arg_colaborador_propetario', _colaborador.colaborador_id,
          'arg_menu_list', arg_menu_list,
          '_branch_uid', arg_branch_uid
        )
    );

  perform tweeks.funct_reg_trabalha(
      jsonb_build_object(
          'arg_espaco_auth', arg_espaco_auth,
          'arg_colaborador_id', arg_colaborador_id,
          'arg_colaborador_propetario', _colaborador.colaborador_id,
          'arg_espaco', args->'arg_espaco'
      ));

  _res := auth.funct_change_colaborador_accesso_reativar(
      jsonb_build_object(
          'arg_colaborador_id', arg_colaborador_id,
          'arg_colaborador_reative', _colaborador.colaborador_id,
          'arg_colaborador_senha', arg_colaborador_senha,
          'arg_colaborador_pin', arg_colaborador_pin
        )
    );

  return lib.result_true(
        jsonb_build_object(
            'colaborador', lib.jsonb_values(
            to_jsonb( _colaborador ),
            'colaborador_id',
            'colaborador_tsexo_id',
            'colaborador_email',
            'colaborador_nif',
            'colaborador_nome',
            'colaborador_apelido',
            'colaborador_datanascimento',
            'colaborador_ficha',
            'colaborador_dataultimaatualizacasenha',
            'colaborador_accesso',
            'colaborador_estado',
            'colaborador_dataregisto'
          )
          ) || _res.message
    );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 812 (class 1255 OID 19749)
-- Name: funct_reg_conta_nota_credito(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_conta_nota_credito(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      conta_chave: CHAVE
      arg_colaborador_id: UID
      arg_espaco_auth: UID
      conta_id: UID,
      conta_data: DATE,
      conta_posto_id: UID
      conta_observacao
      itens: [
        { venda_id:ID },
        { venda_id:ID },
        { venda_id:ID }...
      ]
    }
   */
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_conta_id uuid default args->>'conta_id';
  arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  __branch cluster.branch;
  _data record;
  _vendas record;
  _conta tweeks.conta;
  _conta_args tweeks.conta;
  _const map.constant;
  _conta_res lib.res;
  _conta_close_res lib.res;
  itens uuid[] default array( select (e.doc->>'venda_id')::uuid from jsonb_array_elements( args->'itens' ) e ( doc ) );
begin
  _const := map.constant();
  _conta_args := jsonb_populate_record( _conta_args, args );
  _conta_args.conta_posto_fecho := _conta_args.conta_posto_id;
  _conta := tweeks._get_conta( arg_conta_id );

  if _conta.conta_estado != _const.maguita_conta_estado_fechado then
    return  lib.res_false( 'Essa conta não se encontra fechada' );
  end if;


  with conta_origin as (
    select
        ct.*,
        ve.*,
        art.*,
        count( venc.venda_id ) > 0 as venda_ncexists
      from tweeks.conta ct
        inner join tweeks.venda ve on ct.conta_id = ve.venda_conta_id
          and ve._branch_uid = arg_branch_uid
          and ve.venda_estado = _const.maguita_venda_estado_fechado
        left join tweeks.artigo art on ve.venda_artigo_id = art.artigo_id
          and art._branch_uid = arg_branch_uid
        left join tweeks.conta ctnc on ct.conta_id = ctnc.conta_conta_docorigin
          and ctnc.conta_estado = _const.maguita_conta_estado_fechado
          and ctnc._branch_uid = arg_branch_uid
        left join tweeks.venda venc on ctnc.conta_id = ve.venda_conta_id
          and venc.venda_venda_docorign = ve.venda_id
          and venc.venda_estado = _const.maguita_venda_estado_fechado
          and venc._branch_uid = arg_branch_uid
      where ct.conta_id = arg_conta_id
      group by ct.conta_id,
        art.artigo_id,
        ve.venda_id
  ), notacareito_usar as (
    select
        count( * ) filter (
          where not ct.venda_ncexists
            and ct.venda_id = any ( itens )
            and ct.venda_venda_id is null
        ) as notacredito_aplicartotal,

        array_agg( ct.venda_id ) filter (
          where not ct.venda_ncexists
            and ct.venda_id = any ( itens )
            and ct.venda_venda_id is null
        ) as notacredito_aplicar,

        count( * ) filter (
          where ct.venda_id = any ( itens )
            and ct.venda_venda_id is null
        ) as notacredito_usartotal,
       array_agg(
         jsonb_build_object(
           'artigo_id', ct.artigo_id,
           'artigo_codigo', ct.artigo_codigo,
           'artigo_nome', ct.artigo_nome,
           'venda_id', ct.venda_id,
           'venda_quantidade', ct.venda_quantidade,
           'venda_custounitario', ct.venda_custounitario
         )
       ) filter (
         where ct.venda_ncexists
           and ct.venda_id = any ( itens )
           and ct.venda_venda_id is null
       ) as notacredito_exists
      from conta_origin ct
  ) select * into _data
     from notacareito_usar
  ;

  if _data.notacredito_aplicartotal = 0 then
    return lib.res_false( 'Nenhum dos iten selecionado pode-se aplicar nota de credito sobre ele' );
  end if;

  if _data.notacredito_aplicartotal < _data.notacredito_usartotal then
    return lib.res_false( 'Alguns dos itens selecionados já têm notas de creditos aplicado sobre ele',
      jsonb_build_object(
          'notacredito_exists', _data.notacredito_exists
        )
    );
  end if;


  /*
    arg_vendas: [
        {
          venda_id?: UID,
          venda_artigo_id: UID,
          venda_quantidade: QUANT,
          venda_custounitario: COST
          venda_custoquantidade: COST

          + venda_editado
          + venda_isencao
          + venda_montante
          + venda_montanteagregado
          + venda_montantetotal
          + venda_imposto
          + venda_montantesemimposto
          + venda_montantecomimposto
          + venda_impostoadicionar
          + venda_impostoretirar

          + venda_descricao
          + venda_lote
          + venda_validade
          + venda_metadata

          arg_itens: [
              venda_id: UID
              venda_artigo_id: UID,
              venda_quantidade: QUANT,
              venda_custounitario: COST
              venda_custoquantidade: COST
              venda_descricao: DESCRICAO
              venda_lote: LOTE
              venda_validade: VALIDADE
              venda_metadata: {... any extras data}
            + venda_montantetotal
          ]
   */
  with __iten as (
    select
        iten.venda_artigo_id,
        iten.venda_quantidade * -1 as venda_quantidade,
        iten.venda_custounitario,
        iten.venda_custoquantidade,
        iten.venda_descricao,
        iten.venda_lote,
        iten.venda_validade,
        iten.venda_metadata,
        iten.venda_taxas,
        iten.venda_montantetotal * -1 as venda_montantetotal,
        iten.venda_id as venda_venda_docorign,
        iten.venda_venda_id as ___iten_venda_super
      from tweeks.venda iten
        inner join tweeks.artigo at on iten.venda_artigo_id = at.artigo_id
          and at._branch_uid = arg_branch_uid
      where iten.venda_venda_id = any( _data.notacredito_aplicar )
        and iten.venda_estado = _const.maguita_venda_estado_fechado
        and iten._branch_uid = arg_branch_uid
  ), __vendas as (
    select
        ve.venda_id as venda_venda_docorign,
        ve.venda_artigo_id,
        ve.venda_quantidade * -1 as venda_quantidade,
        ve.venda_custounitario,
        ve.venda_custoquantidade,
        ve.venda_editado,
        ve.venda_isencao,
        ve.venda_montante * -1 as venda_montante,
        ve.venda_montanteagregado * -1 as venda_montanteagregado,
        ve.venda_montantetotal * -1 as venda_montantetotal,
        ve.venda_imposto * -1 as venda_imposto,
        ve.venda_montantesemimposto * -1 as venda_montantesemimposto,
        ve.venda_montantecomimposto * -1 as venda_montantecomimposto,
        ve.venda_impostoadicionar * -1 as venda_impostoadicionar,
        ve.venda_impostoretirar * -1 as venda_impostoretirar,
        ve.venda_descricao,
        ve.venda_lote,
        ve.venda_validade,
        ve.venda_metadata,
        ve.venda_taxas,
        coalesce( jsonb_agg( to_jsonb( iten ) ) filter ( where iten.venda_venda_docorign is not null ), jsonb_build_array()) as arg_itens
      from tweeks.venda ve
        left join __iten iten on ve.venda_id = iten.___iten_venda_super

      where ve.venda_id = any( _data.notacredito_aplicar )
        and ve.venda_venda_id is null
      group by ve.venda_id
  ) select
        jsonb_agg( to_jsonb( ve ) ) as arg_vendas
        into _vendas
      from __vendas ve
  ;

  /*
   -- obrigatorios
      arg_colaborador_id: ID,
      arg_espaco_auth: ID,

      conta_posto_id: ID,

      -- opcional
      conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM }
      conta_id: ID?
      conta_extension: {} | { reserva_id: UID }
      conta_chave: CHAVE

      conta_currency_id: ID,
      conta_tpaga_id: ID,

      conta_cliente_id:UID
      conta_titular: CLIENTE-NOME
      conta_titularnif: CLIENTE-NIF
      conta_data: DATA,

      -- requerido
      arg_vendas
   */



  if _conta.conta_cliente_id is null or _conta.conta_cliente_id = _const.maguita_cliente_final and not exists(
      select *
      from tweeks.cliente c
      where c.cliente_id = _const.maguita_cliente_finalnotacredito
  ) then
      select * into __branch from cluster.branch where _branch_uid = arg_branch_uid;
      insert into tweeks.cliente(
          cliente_id,
          cliente_colaborador_id,
          cliente_colaborador_gerente,
          cliente_espaco_auth,
          cliente_titular,
          _branch_uid,
          cliente_code
      ) values (
           _const.maguita_cliente_finalnotacredito,
           _const.colaborador_system_data,
           __branch.branch_main_user,
           __branch.branch_main_workspace,
           'CONTA DE NOTA DE CREDITO',
           __branch._branch_uid,
           'NC100010'
       );
  end if;
  
  _conta_args.conta_cliente_id := _conta.conta_cliente_id;
  _conta_args.conta_data := coalesce( _conta_args.conta_data, current_date );
  if _conta_args.conta_cliente_id is null or _conta_args.conta_cliente_id = _const.maguita_cliente_final then
      _conta_args.conta_cliente_id := _const.maguita_cliente_finalnotacredito;
  end if;
  


  _conta_res := tweeks.funct_pos_reg_conta(
    jsonb_build_object(
      'arg_colaborador_id', arg_colaborador_id,
      'arg_espaco_auth', _conta.conta_espaco_auth,
      'conta_posto_id', _conta_args.conta_posto_id,
      'conta_mesa', _conta_args.conta_mesa,
      'conta_extension', coalesce( _conta_args.conta_extension, jsonb_build_object()),
      'conta_chave', _conta_args.conta_chave,
      'conta_currency_id', null,
      'conta_tpaga_id', null,
      'conta_cliente_id', _conta_args.conta_cliente_id,
      'conta_titular', _conta.conta_titular,
      'conta_titularnif', _conta.conta_titularnif,
      'conta_data', _conta_args.conta_data,
      'arg_vendas', _vendas.arg_vendas,
      'conta_conta_docorigin', _conta.conta_id,
      'conta_observacao', _conta_args.conta_observacao,
      'conta_tserie_id', _const.maguita_tserie_notacredito,
      'conta_espaco_notacredito', arg_espaco_auth
    )
  );
  
  if not _conta_res.result then
    return _conta_res;
  end if;

  /*
    Essa função fecha uma nova conta
      arg = {
        arg_espaco_auth: ID,
        arg_colaborador_id: ID,

        deposito:{
          deposito_cliente_id
          deposito_caixa_id
          deposito_tpaga_id
          deposito_currency_id
          deposito_posto_id
          deposito_montantemoeda
          deposito_montantetroco
          deposito_data
          deposito_docref: DOCUMENTO-REF?
          deposito_observacao: OBSERVACAO?
        }

        conta_id: ID,
        conta_extension: {} | { reserva_id: UID }
        conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM },

        conta_posto_id: ID,
        conta_desconto

        conta_titular: NOME-CLIENTE
        conta_titularnif: VARCHAR,
        conta_data: DATA,
        conta_cliente_id,

        //Relativos a GUIA
        guia_documentoperacao: CODIGO,
        guia_dataopeacao: DATA,
        guia_observacao: DESCRICAO
        guia_metadata: { ... any extras data }

        custos:[{
          custoguia_montante: MONTANTE,
          custoguia_descricao: DESCRICAO PARA O CUSTO
          custoguia_tcusto_id: 1 - DESPESA | 2 - RECEITA
        }]
   */
  
  _conta_close_res := tweeks.funct_pos_change_conta_fechar(
    jsonb_build_object(
      'arg_colaborador_id', arg_colaborador_id,
      'arg_espaco_auth', _conta.conta_espaco_auth,
      'arg_tserie_id', _const.maguita_tserie_notacredito,
      'conta_conta_docorigin', _conta.conta_id,
      'conta_id', _conta_res.data->>'conta_id',
      'conta_extension', jsonb_build_object(),
      'conta_posto_id',  _conta_args.conta_posto_id,
      'conta_posto_fecho',  _conta_args.conta_posto_id,
      'conta_desconto', ( _conta.conta_desconto ),
      'conta_titular', _conta.conta_titular,
      'conta_tserie_id', _const.maguita_tserie_notacredito,
      'conta_titularnif', _conta.conta_titularnif,
      'conta_data', coalesce( _conta_args.conta_data, now()::date),
      'conta_cliente_id', _conta_args.conta_cliente_id,
      'guia_documentoperacao', format('NC-%s',  to_char( clock_timestamp(), 'YYYYMMDDHHMISS-US')),
      'guia_observacao', 'Guia de devolução ao stock ao efeturar uma nota de credito',
      'guia_metadata', coalesce( _conta_res.data, jsonb_build_object() ),
      'custos', jsonb_build_array(),
      'conta_chave', _conta_args.conta_chave,
      'arg_group_id', _conta._tgrupo_id
    )
  );

  return _conta_close_res;

exception  when others then
    <<_ex>> declare e text; m text; d text; h text; c text;
    begin
        get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
        return lib.res_exception( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
    end;
end
$$;


--
-- TOC entry 835 (class 1255 OID 17094)
-- Name: funct_reg_dispoe(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_dispoe(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para efetuar o registro da disposicao
    args = {
      arg_colaborador_id: ID,
      arg_espaco_auth: ID
      arg_atrigo_id: ID,
      arg_items: [
        @+id/item_id,
        @+id/item_id,
        @+id/item_id
      ]
    }
   */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth );
  arg_artigo_id uuid not null default args->>'arg_atrigo_id';
  arg_items jsonb not null default args->'arg_items';

  arg_items_id uuid [] default array( select item_id::uuid from jsonb_array_elements_text( arg_items ) doc ( item_id ) );
  ativated_dispoe tweeks.dispoe[];
  desativated_dispoe tweeks.dispoe[];
  _const map.constant;
begin
  _const := map.constant();



  -- Desativar todos os item atualmente associado ao produto que não faz para da nova disposicao
  with desativateds as (
    update tweeks.dispoe
      set dispoe_estado = _const.dispoe_estado_fechado,
          dispoe_dataatualizacao =   current_timestamp,
          dispoe_colaborador_atualizacao = arg_colaborador_id
      where dispoe_artigo_id = arg_artigo_id
        and dispoe_estado = _const.dispoe_estado_ativo
        and dispoe_artigo_item != all( arg_items_id )
        and dispoe_espaco_auth = any( arg_espaco_child )
      returning *
  ) select array_agg( desa ) into desativated_dispoe
    from desativateds  desa
  ;

  -- Registar os novos itens
  with ativated as (
    insert into tweeks.dispoe (
      dispoe_artigo_id,
      dispoe_artigo_item,
      dispoe_colaborador_id,
      dispoe_espaco_auth
    ) select
        arg_artigo_id,
        it.artigo_id,
        arg_colaborador_id,
        arg_espaco_auth
      from tweeks.artigo it
        left join tweeks.dispoe d on it.artigo_id = d.dispoe_artigo_item
          and d.dispoe_estado = _const.dispoe_estado_ativo
          and d.dispoe_artigo_id = arg_artigo_id
      where it.artigo_id = any ( arg_items_id )
      group by it.artigo_id
      having count( d.dispoe_id ) = 0
      returning *
  ) select array_agg( ins ) into ativated_dispoe
    from ativated ins
  ;

  return true? jsonb_build_object(
    'dispoe_desativated', desativated_dispoe,
    'dispoe_ativated',  ativated_dispoe,
    'dispoe', array (
      select disp
        from tweeks.dispoe disp
        where disp.dispoe_artigo_id = arg_artigo_id
          and disp.dispoe_estado = _const.dispoe_estado_ativo
    )
  );
end;
$$;


--
-- TOC entry 559 (class 1255 OID 17095)
-- Name: funct_reg_ean(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_ean(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**

    Essa função serve para registar varios ean de uma vez
    args := {
      arg_artigo_id: UUID,
      arg_espaco_auth: UUID,
      arg_colaborador_id: UUID,
      arg_ean_codes: [
        { ean_code:CODE, ean_dateout:DATE, ean_datein:DATE }
      ]
      arg_ean_disable: [ CODES ]
    }
   */
  arg_artigo_id uuid not null default args->>'arg_artigo_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_ean_codes jsonb not null default args->'arg_ean_codes';
  arg_ean_disable character varying[] not null default array( select jsonb_array_elements_text(args->'arg_ean_disable') );
  _const map.constant;
  _data record;
  _ean tweeks.ean;
  __eans tweeks.ean[] default array[]::tweeks.ean[];
begin
  _const := map.constant();

  for _data in
    with ___ean as (
      select eandoc.*, ea.ean_id as persitent_ean_id
        from jsonb_array_elements( arg_ean_codes ) e( document )
          left join jsonb_populate_record( null::tweeks.ean, e.document ) eandoc on true
          left join tweeks.ean ea on ea.ean_code = eandoc.ean_code
    ) select *
      from ___ean
  loop
    if _data.persitent_ean_id is not null then
      update tweeks.ean
        set ean_datein = _data.ean_datein,
            ean_dateout = _data.ean_dateout,
            ean_artigo_id = arg_artigo_id
        where ean_id = _data.persitent_ean_id
        returning * into _ean
      ;
      __eans := __eans || _ean;
    else
      insert into tweeks.ean(
        ean_artigo_id,
        ean_espaco_auth,
        ean_colaborador_id,
        ean_code,
        ean_dateout,
        ean_datein
      ) values (
        arg_artigo_id,
        arg_espaco_auth,
        arg_colaborador_id,
        _data.ean_code,
        _data.ean_dateout,
        _data.ean_datein
      ) returning * into _ean;
      __eans := __eans || _ean;
    end if;
  end loop;


  if jsonb_array_length( args->'arg_ean_disable' ) > 0 then
    update tweeks.ean
      set ean_estado = _const.maguita_ean_estado_ativo,
          ena_dateupdate = current_timestamp,
          ean_colaborador_atualizacao = arg_colaborador_id
      where ean_code = any( arg_ean_disable );
  end if;

  return lib.result_true( jsonb_build_object(
      'eans', __eans,
      'disable', array( select e from tweeks.ean e where e.ean_code = any ( arg_ean_disable ))
  ));
end;
$$;


--
-- TOC entry 836 (class 1255 OID 17096)
-- Name: funct_reg_entrada(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_entrada(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa funcao serve para registar as entradas de produto
    args = {
      arg_colaborador_id: *ID,
      arg_espaco_destino: *ID,
      arg_espaco_auth: *ID,



      arg_entradas: [
        artigo_id: *ID,
        entrada_quantidade: *QT,
        entrada_lote: LOTE,
        entrada_validade: LOTE,
        entrada_descricao: DESCRICAO
        entrada_custounitario: PRECO
        entrada_metadata: { ... any extras data }
      ]

      //Relativos a GUIA
      guia_refuid: FORNECEDOR-ID
      guia_documentoperacao: CODIGO,
      guia_dataopeacao: DATA,
      guia_observacao: DESCRICAO
      guia_metadata: { ... any extras data }

      custos:[{
        custoguia_montante: MONTANTE,
        custoguia_descricao: DESCRICAO PARA O CUSTO
        custoguia_tcusto_id: 1 - DESPESA | 2 - RECEITA
      }]
    }
   */

  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_destino uuid not null default args->>'arg_espaco_destino';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_entrada_codigofatura character varying default args->>'arg_entrada_codigofatura';

  arg_entrada_next int ;

  _entreda tweeks.entrada;
  _new tweeks.entrada;
  __entreda tweeks.entrada[] default array[]::tweeks.entrada[];
  _espaco tweeks.espaco;
  _entrada_group uuid;
  _const map.constant;
  _data record;
  _guia tweeks.guia;
  _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
begin

  _const := map.constant();

  _espaco := tweeks._get_espaco( arg_espaco_destino );

  if arg_entrada_codigofatura is null then
    arg_entrada_codigofatura := lib.str_nospace( to_char( arg_entrada_next, '"EN#"000-000' ) );
  end if;

  _entrada_group := public.uuid_generate_v4();

  _guia := jsonb_populate_record( _guia, args );
  _guia.guia_tguia_id := _const.maguita_tguia_entrada;
  _guia.guia_espaco_entrada := arg_espaco_destino;
  _guia.guia_toperacao_id := _const.maguita_toperacao_entrada;
  _guia.guia_refclass := cluster.__format( 'tweeks.fornecedor'::regclass );
  _guia.guia_refs := jsonb_build_object(
      'fornecedor', jsonb_build_object( 'fornecedor_id', _guia.guia_refuid ),
      'destino', jsonb_build_object( 'espaco_id', arg_espaco_destino )
  );

  _guia := tweeks.funct_sets_guia( jsonb_build_object(
    'guia', _guia,
    'custoguia', args->'custos',
    'arg_colaborador_id', arg_colaborador_id,
    'arg_espaco_auth', arg_espaco_auth

  ));

  for _data in
    select
        ( e.doc->>'artigo_id' )::uuid as artigo_id,
        ( e.doc->>'entrada_descricao' ) as entrada_descricao,
        ( e.doc->>'entrada_quantidade' )::double precision as entrada_quantidade,
        ( e.doc->>'entrada_custounitario' )::double precision entrada_custounitario,
        ( e.doc->>'entrada_metadata' )::json entrada_metadata,
        ( e.doc->>'entrada_lote' )::character varying as  entrada_lote,
        ( e.doc->>'entrada_validade' )::date as  entrada_validade
      from jsonb_array_elements( args->'arg_entradas' ) e( doc )
  loop
    _new.entrada_descricao :=       _data.entrada_descricao;
    _new.entrada_artigo_id :=       _data.artigo_id;
    _new.entrada_custounitario :=        _data.entrada_custounitario;
    _new.entrada_quantidade :=      _data.entrada_quantidade;
    _new.entrada_lote :=          _data.entrada_lote;
    _new.entrada_validade :=      _data.entrada_validade;
    _new.entrada_metadata :=      _data.entrada_metadata;

    _new.entrada_espaco_destino :=  arg_espaco_destino;
    _new.entrada_espaco_auth :=     arg_espaco_auth;
    _new.entrada_colaborador_id :=  arg_colaborador_id;
    _new.entrada_guia_id :=         _guia.guia_uid;

    select ( "returning" ).* into _entreda
      from lib.sets_in( _new )
    ;
  end loop;

  return true? jsonb_build_object(
    'guia', _guia,
    'entrada', array(
      select ent
        from tweeks.entrada ent
        where ent.entrada_guia_id = _guia.guia_uid
          and ent.entrada_estado = _const.entrada_estado_ativo
    ),'custoguia', array(
      select cg
        from tweeks.custoguia cg
        where cg.custoguia_guia_uid = _guia.guia_uid
          and cg.custoguia_estado = _const.maguita_custoguia_estado_ativo
    )
  );
end;
$$;


--
-- TOC entry 786 (class 1255 OID 17097)
-- Name: funct_reg_espaco(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_espaco(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $_$
declare
  /**
    Essa função serve para registar os espaços
    args = {
      arg_espaco_auth: ID
      arg_colaborador_id: ID,
      arg_espaco_vender: BOOLEAN,
      arg_espaco_posto_admin: UUID
      arg_espaco_nome: NOME,
      arg_espaco_descricao: NOME,
      arg_espaco_gerarfatura: BOOLEAN,
      arg_espaco_configurar: BOOLEAN,
      arg_branch_uid: UID
    }
   */

  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_vender character varying default args->>'arg_espaco_vender';
  arg_espaco_nome character varying default lib.str_normalize( args->>'arg_espaco_nome' );
  arg_espaco_gerarfatura boolean default lib.str_normalize( args->>'arg_espaco_gerarfatura' );
  arg_espaco_configurar boolean default lib.str_normalize( args->>'arg_espaco_configurar' );
  arg_espaco_descricao character varying default lib.str_normalize( args->>'arg_espaco_descricao' );
  arg_branch_uid uuid default args->>'arg_branch_uid';
  arg_espaco_posto_admin uuid default args->>'arg_espaco_posto_admin';

  _espaco tweeks.espaco;
  _const map.constant;

begin
  _const := map.constant();

  if (
    select count( * ) > 0
      from tweeks.espaco esp
      where lib.str_normalize( lower( esp.espaco_nome ) ) = lib.str_normalize( lower( arg_espaco_nome ) )
  ) then
    return false ? '@espaco.nome.already-exist';
  end if;

  _espaco.espaco_codigo := cluster.next( 'espaco.codigo/seq',
      sub := arg_branch_uid::text,
      lpad := 2,
      lpad_char := '0',
      --language=PostgreSQL
      exist := format( 'select * from tweeks.espaco where espaco_codigo = $1 and coalesce( _branch_uid, espaco_branch_uid ) = (%L)::uuid', arg_branch_uid ),
      exist_limit := 1000
    );

  insert into tweeks.espaco (
    espaco_branch_uid,
    espaco_espaco_id,
    espaco_espaco_auth,
    espaco_colaborador_id,
    espaco_nome,
    espaco_descricao,
    espaco_gerarfatura,
    espaco_configurar,
    espaco_vender,
    espaco_codigo,
    espaco_posto_admin
  ) values (
    arg_branch_uid,
    arg_espaco_auth,
    arg_espaco_auth,
    arg_colaborador_id,
    arg_espaco_nome,
    arg_espaco_descricao,
    arg_espaco_gerarfatura,
    arg_espaco_configurar,
    arg_espaco_vender,
    _espaco.espaco_codigo,
    arg_espaco_posto_admin
  ) returning * into _espaco;

  perform tweeks.funct_reg_cambio(
    jsonb_build_object(
      'arg_espaco_auth', _espaco.espaco_id,
      'arg_branch_uid', arg_branch_uid,
      'arg_colaborador_id', arg_colaborador_id,
      'arg_currency_id', _const.currency_std,
      'arg_cambio_taxa', 1,
      'arg_cambio_data', make_date( 2000, 01, 01 )
  ));

  return true ? jsonb_build_object(
    'espaco', _espaco
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$_$;


--
-- TOC entry 861 (class 1255 OID 17098)
-- Name: funct_reg_fornecedor(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_fornecedor(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para registar um novo fornecedor no sistema
    args := {
      arg_espaco_auth: ID
      arg_colaborador_id: ID,
      arg_fornecedor_nif: ID,
      arg_fornecedor_nome: NOME,
      arg_fornecedor_email: EMAIL,
      arg_fornecedor_contacto: CONTACTO,
      arg_fornecedor_endereco: ENDERECO
    }
  */

  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_fornecedor_nif character varying default lib.str_normalize( lib.str_nospace( args->>'arg_fornecedor_nif') );
  arg_fornecedor_email character varying default lib.str_nospace( lower( args->>'arg_fornecedor_email' ) );
  arg_fornecedor_nome character varying not null default  lib.str_normalize( args->>'arg_fornecedor_nome' );
  arg_fornecedor_contacto character varying not null default lib.str_normalize( lib.str_nospace( args->>'arg_fornecedor_contacto' ) );
  arg_fornecedor_endereco character varying not null default lib.str_nospace( args->>'arg_fornecedor_endereco' );

  _fornecedor tweeks.fornecedor;
  _branch uuid  default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );

begin

  -- Garantir que tanto o email quanto o nif seja unico
  if(
    select count( * ) > 0
      from tweeks.fornecedor fo
      where fo.fornecedor_nif = arg_fornecedor_nif
  ) then
    return false? 'NIF já existe!';
  end if;

  if(
    select count( * ) > 0
      from tweeks.fornecedor fo
      where fo.fornecedor_email = arg_fornecedor_email
  ) then
    return false? 'Email já existe!';
  end if;
  
  _fornecedor.fornecedor_code := tweeks.__generate_fornecedor_code( _branch );

  insert into tweeks.fornecedor (
    fornecedor_colaborador_id,
    fornecedor_espaco_auth,
    fornecedor_nif,
    fornecedor_nome,
    fornecedor_email,
    fornecedor_contacto,
    fornecedor_endereco,
    fornecedor_code
  ) values (
    arg_colaborador_id,
    arg_espaco_auth,
    arg_fornecedor_nif,
    arg_fornecedor_nome,
    arg_fornecedor_email,
    arg_fornecedor_contacto,
    arg_fornecedor_endereco,
    _fornecedor.fornecedor_code
  ) returning * into _fornecedor;

  return true ? jsonb_build_object(
    'fornecedor', _fornecedor
  );
end;
$$;


--
-- TOC entry 828 (class 1255 OID 17099)
-- Name: funct_reg_imposto(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_imposto(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_artigo_id: ID,
      arg_colaborador_id: ID,
      arg_espaco_auth: ID,
      arg_imposto: [
        { arg_tipoimposto_id: ID,
          arg_taplicar_id: ID,
          arg_imposto_valor: VALOR, # Por equanto envie null
          arg_imposto_percentagem: PERCENTAGEM, # Por enquanto envie null
        }
      ]
    }
   */
  arg_artigo_id uuid not null default args->>'arg_artigo_id';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_imposto jsonb not null default args->>'arg_imposto';
  arg_tipoimposto_id uuid[] default array( select ( ele.doc->>'arg_tipoimposto_id')::uuid from jsonb_array_elements( arg_imposto ) ele( doc ) );
  _const map.constant;
begin

  _const := map.constant();

  -- Primeiro desativar as associação dos impostos atual
  update tweeks.imposto
    set imposto_estado = _const.maguita_imposto_estado_fechado,
        imposto_dataregistro = current_timestamp,
        imposto_colaborador_atualizacao = arg_colaborador_id
    where imposto_artigo_id = arg_artigo_id
      and imposto_estado = _const.maguita_imposto_estado_ativo
  ;

  insert into tweeks.imposto(
    imposto_tipoimposto_id,
    imposto_artigo_id,
    imposto_taplicar_id,
    imposto_espaco_auth,
    imposto_colaborador_id,
    imposto_percentagem,
    imposto_valor
  ) select
      ( el.doc->>'arg_tipoimposto_id' )::uuid,
      arg_artigo_id,
      ( el.doc->>'arg_taplicar_id' )::int2,
      arg_espaco_auth,
      arg_colaborador_id,
      ( el.doc->>'arg_imposto_percentagem' )::double precision,
      ( el.doc->>'arg_imposto_valor' )::double precision
    from jsonb_array_elements( arg_imposto ) el( doc )
  ;

  return true ? jsonb_build_object(
    'imposto', array(
      select ip
        from tweeks.imposto ip
        where ip.imposto_artigo_id = arg_artigo_id
          and ip.imposto_estado = _const.maguita_imposto_estado_ativo
    )
  );
end;
$$;


--
-- TOC entry 837 (class 1255 OID 17100)
-- Name: funct_reg_item(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_item(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
    /**
      Essa funçao serve para registar um item
      {
        arg_espaco_auth: ID
        arg_colaborador_id: ID

        artigo_id: ID
        artigo_nome: *NOME
        artigo_descricao: DESCRICAO
        precario_custo: *CUSTO
        precario_quantida: *QUANT
      }
     */

    arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
    arg_espaco_auth uuid not null default args->>'arg_espaco_auth';

    arg_artigo_id uuid default args->>'artigo_id';
    arg_artigo_stocknegativo boolean default args->>'artigo_stocknegativo';
    arg_artigo_nome character varying default args->>'artigo_nome';
    arg_precario_custo double precision default args->>'precario_custo';
    arg_precario_quantidade double precision default args->>'precario_quantidade';

    _result lib.result;
    _const map.constant;
    arg_artigo_codigo varchar;
    _artigo tweeks.artigo;
begin
    _const := map.constant();
    arg_artigo_stocknegativo := coalesce( arg_artigo_stocknegativo, true );
    args := args || jsonb_build_object(
      'artigo_stocknegativo', arg_artigo_stocknegativo
    );

    arg_precario_quantidade := coalesce( arg_precario_quantidade, 1 );
    if (
        select count( * ) > 0
        from tweeks.artigo it
        where lib.str_normalize( lower( it.artigo_nome ) ) = lib.str_normalize( lower( arg_artigo_nome ) )
          and it.artigo_classe_id = _const.classe_itemextra
          and it.artigo_id::text != coalesce( arg_artigo_id::text, it.artigo_id::text||'!?')
    ) then
        return false? 'Nome do item já existe!';
    end if;

    -- Durante o registro
    if arg_artigo_id is null then
        while arg_artigo_codigo is null loop
            arg_artigo_codigo :=  format( 'item#%s', (random() * 999999 )::int );
            if( select count( * ) > 0 from tweeks.artigo where artigo_codigo = arg_artigo_codigo ) then
                arg_artigo_codigo := null;
            end if;
        end loop;

        _artigo := jsonb_populate_record( _artigo, args );
        _artigo.artigo_espaco_auth := arg_espaco_auth;
        _artigo.artigo_colaborador_id := arg_colaborador_id;
        _artigo.artigo_codigo := arg_artigo_codigo;
        _artigo.artigo_stocknegativo := arg_artigo_stocknegativo;
        _artigo.artigo_classe_id := _const.classe_itemextra;

        select ("returning").* into _artigo from lib.sets(_artigo );

    elsif arg_artigo_id is not null then
      _artigo := tweeks._get_artigo( arg_artigo_id );
      _artigo := jsonb_populate_record( _artigo, to_jsonb( _artigo )|| args );
      _artigo.artigo_colaborador_atualizacao := arg_colaborador_id;
      _artigo.artigo_dataatualizacao := now();

      -- Update artigos infos
      select ("returning").* into _artigo
        from lib.sets(_artigo )
        ;
    end if;

    _result := tweeks.funct_reg_precario(
      jsonb_build_object(
        'arg_espaco_auth', arg_espaco_auth,
        'arg_forced', false,
        'arg_colaborador_id', arg_colaborador_id,
        'arg_precario_referencia', jsonb_build_object( 'artigo_id', _artigo.artigo_id ),
        'arg_links', json_build_array( jsonb_build_object(
           'espaco_id', arg_espaco_auth,
           'stock_minimo', null,
           'precario_custo', arg_precario_custo,
           'precario_quantidade', arg_precario_quantidade
         ))
      )
    );

    _result.message := _result.message || jsonb_build_object(
      'artigo', _artigo
    );

    return _result;

exception  when others then
    <<_ex>> declare e text; m text; d text; h text; c text;
    begin
        get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
        return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
    end;
end;
$$;


--
-- TOC entry 560 (class 1255 OID 17101)
-- Name: funct_reg_link_associacao(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_link_associacao(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para
    args := {
      arg_colaborador_id: ID,
      arg_espaco_auth: ID
      arg_link_nome: NOME,
      arg_link_referencia: REF,
      arg_link_referenciareplace: boolean | default true, -- indica se todos os links apara esse referencia atual vão deixar de existir
      arg_links: [
        { arg_espaco_destino: ID  }
      ]
    }
   */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );
  arg_links jsonb not null default  args->'arg_links';
  arg_espacos uuid[] not null default array( select ( el.doc->>'arg_espaco_destino' )::uuid from jsonb_array_elements( arg_links ) el( doc ));
  arg_link_referenciareplace boolean default args->>'arg_link_referenciareplace';

  arg_link_referencia jsonb not null default args->>'arg_link_referencia';
  arg_link_nome character varying not null default args->>'arg_link_nome';

  _const map.constant;
  _link tweeks.link;
  _data record;
  arg_artigo_id uuid default arg_link_referencia->>'artigo_id';
  _artigo tweeks.artigo;
  _classe tweeks.classe;
  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _aux record;
begin
  arg_link_referenciareplace := coalesce( arg_link_referenciareplace, true );
  _const := map.constant();

  if arg_artigo_id is not null then
    _artigo := tweeks._get_artigo( arg_artigo_id );
    _classe := tweeks._get_classe( _artigo.artigo_classe_id );
  end if;

  -- Desativar desacociar todos dos espaços filhos que não estao na lista
  with aux as (
    -- listar todos os links que devem ser mortos
    select *
      from tweeks.link
      where link_referencia @> arg_link_referencia
        and link_estado = _const.maguita_link_estado_ativo
        and link_tlink_id = _const.maguita_tlink_associacao
        and link_espaco_destino != all ( arg_espacos )
        and link_espaco_auth = any( arg_espaco_child )
        and _branch_uid = ___branch
        and arg_link_referenciareplace
  )
  update tweeks.link
    set link_estado = _const.maguita_link_estado_fechado,
        link_dataatualizacao = current_timestamp,
        link_colaborador_atualizacao = arg_colaborador_id
    where link_id in ( select link_id from aux )
      or link_link_associacao in ( select link_id from aux )
  ;

  for _data in
    select
        ( it.doc->>'arg_espaco_destino' )::uuid as arg_espaco_destino,
        ( it.doc->>'arg_link_custo' )::numeric as arg_link_custo,
        ( it.doc->>'arg_link_quantidadecusto' )::numeric arg_link_quantidadecusto
      from jsonb_array_elements( arg_links ) it ( doc )
        left join tweeks.link l on it.doc @> jsonb_build_object( 'arg_espaco_destino', l.link_espaco_destino )
          and l.link_referencia @> arg_link_referencia
          and l.link_estado = _const.maguita_link_estado_ativo
          and l.link_tlink_id = _const.maguita_tlink_associacao
          and l._branch_uid = ___branch
      where l.link_id is null
  loop

    -- Lincar os protudos ao espaço
    insert into tweeks.link (
      link_tlink_id,
      link_referencia,
      link_espaco_auth,
      link_espaco_destino,
      link_colaborador_id,
      link_posicao,
      link_nome,
      link_estado
    ) values (
      _const.maguita_tlink_associacao,
      arg_link_referencia,
      arg_espaco_auth,
      _data.arg_espaco_destino,
      arg_colaborador_id,
      -1,
      arg_link_nome,
      _const.maguita_link_estado_ativo
    ) returning * into _link ;

    if coalesce( _data.arg_link_quantidadecusto, 0 ) = 0 or coalesce( _data.arg_link_custo, 0 ) = 0 then
      _data.arg_link_quantidadecusto := null;
      _data.arg_link_custo := null;
    end if;
    -- Linkar tambem a classe quando for linkar o produto (adicionar o link da classe ao espaco se ainda não houver)
    if _artigo.artigo_id is not null and (
      select count( * ) = 0
        from tweeks.link lk
        where lk.link_espaco_destino = _data.arg_espaco_destino
          and lk.link_referencia @> rule.classe_referencia( _classe.classe_id )
          and lk.link_tlink_id = _const.maguita_tlink_associacao
          and lk.link_estado = _const.maguita_link_estado_ativo
          and lk._branch_uid = ___branch
    ) then
      -- Criar o link para o destino
      perform tweeks.funct_reg_link_associacao( jsonb_build_object(
        'arg_colaborador_id', arg_colaborador_id,
        'arg_espaco_auth', arg_espaco_auth,
        'arg_link_nome', _classe.classe_nome,
        'arg_link_referencia', rule.classe_referencia( _classe.classe_id ),
        'arg_link_referenciareplace', false,
        'arg_links', json_build_array( json_build_object(
          'arg_espaco_destino', _data.arg_espaco_destino
        ))
      ));
    end if;

    -- Quando for artigo linkar também os tipos de imposto ao espaco
    for _aux in
      select *
        from tweeks.imposto ip
          inner join tweeks.tipoimposto tip on ip.imposto_tipoimposto_id = tip.tipoimposto_id
          left join tweeks.link lk on lk.link_referencia @> rule.tipoimposto_referencia( tip.tipoimposto_id )
            and lk.link_estado = _const.maguita_link_estado_ativo
            and lk.link_espaco_destino = _data.arg_espaco_destino
            and lk.link_tlink_id = _const.maguita_tlink_associacao
        where _artigo.artigo_id is not null
          and ip._branch_uid = ___branch
          and lk._branch_uid = ___branch
          and ip.imposto_artigo_id = _artigo.artigo_id
          and ip.imposto_estado = _const.maguita_imposto_estado_ativo
          and lk.link_id is null
    loop
      perform tweeks.funct_reg_link_associacao( jsonb_build_object(
          'arg_colaborador_id', arg_colaborador_id,
          'arg_espaco_auth', arg_espaco_auth,
          'arg_link_nome', _aux.tipoimposto_nome,
          'arg_link_referencia', rule.tipoimposto_referencia( _aux.tipoimposto_id ),
          'arg_link_referenciareplace', false,
          'arg_links', json_build_array( json_build_object(
            'arg_espaco_destino', _data.arg_espaco_destino
          ))
        ));
    end loop;
  end loop;

  return  true ? jsonb_build_object(
    'link', array(
      select l
        from tweeks.link l
        where l.link_referencia @> arg_link_referencia
          and l.link_estado = _const.maguita_link_estado_ativo
          and l.link_tlink_id = _const.maguita_tlink_associacao
          and l._branch_uid = ___branch
    )
  );
end;
$$;


--
-- TOC entry 561 (class 1255 OID 17103)
-- Name: funct_reg_link_tecla(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_link_tecla(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para registar as link
    args := {
      arg_link_id: ID,
      arg_link_associacao: ID,
      arg_tlink_id: ID,
      arg_artigo_id: ID,
      arg_espaco_auth: ID,
      arg_espaco_destino: ID,
      arg_colaborador_id: ID,
      arg_link_posicao: POSICAO,
      arg_link_nome: NOME,
      arg_link_config: JSON,
    }
  */

  arg_link_id uuid default args->>'arg_link_id';
  arg_link_associacao uuid not null default args->>'arg_link_associacao';
  arg_artigo_id uuid default args->>'arg_artigo_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_espaco_destino uuid not null default args->>'arg_espaco_destino';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id' ;

  arg_tlink_id int2 default args->>'arg_tlink_id';
  arg_link_posicao int2 not null default args->>'arg_link_posicao';
  arg_link_nome character varying not null default args->>'arg_link_nome';
  arg_link_config jsonb not null default args->'arg_link_config';

  arg_link_estado int2;

  _const map.constant;
  _link tweeks.link;
  _link_associacao tweeks.link;
  _artigo tweeks.artigo;

begin

  lock table tweeks.link in share mode;
  lock table tweeks.artigo in share mode;

  _const := map.constant();
  _link := tweeks._get_link( arg_link_id );
  _link_associacao := tweeks._get_link( arg_link_associacao );
  _artigo := tweeks._get_artigo( arg_artigo_id );

  -- Garantir que a link estejá livre
  if (
    select count( * ) > 0
      from tweeks.link a
      where a.link_espaco_destino = arg_espaco_destino
        and coalesce( a.link_link_id, -1 ) = coalesce( arg_link_id, -1 )
        and a.link_posicao = arg_link_posicao
        and a.link_estado = _const.acerto_estado_ativo
  ) then
    return false ? '@tweeks.link.position-is-occupied';
  end if;

  -- Garantir que link do produto não entra nenhuma sub-link
  if _link.link_referencia->>'artigo_id' is not null then
    return false ? '@tweeks.link.is-a-article';
  end if;

  if _link.link_estado != _const.link_estado_ativo then
    return false ? '@tweeks.link.is-closed';
  end if;

  if _artigo.artigo_id is not null then
    arg_link_nome := _artigo.artigo_nome;
  end if;

  insert into tweeks.link (
    link_link_id,
    link_link_associacao,
    link_tlink_id,
    link_referencia,
    link_espaco_destino,
    link_espaco_auth,
    link_colaborador_id,
    link_posicao,
    link_nome,
    link_config,
    link_extras
  ) values (
    arg_link_id,
    arg_link_associacao,
    arg_tlink_id,
    jsonb_build_object( 'artigo_id', arg_artigo_id ),
    arg_espaco_destino,
    arg_espaco_auth,
    arg_colaborador_id,
    arg_link_posicao,
    arg_link_nome,
    arg_link_config,
    _link_associacao.link_extras
  ) returning * into _link;

  return true ? jsonb_build_object(
    'link', _link
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 838 (class 1255 OID 17104)
-- Name: funct_reg_mesa(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_mesa(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para cadastrar uma nova mesa
    args := {
      arg_colaborador_id: ID,
      arg_mesa_numero: NUMERO,
      arg_mesa_lotacao: NUMERO,
      arg_mesa_descricao: DESCRICAO,
    }
   */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_mesa_numero varchar not null default lib.str_normalize( args->>'arg_mesa_numero' );
  arg_mesa_descricao varchar default lib.str_normalize( args->>'arg_mesa_descricao' );
  arg_mesa_lotacao int2 default args->>'arg_mesa_lotacao';

  _mesa tweeks.mesa;

begin

  -- Garantir que o numero de mesa seja unico
  if (
    select count( * ) > 0
    from tweeks.mesa m
    where m.mesa_numero =  arg_mesa_numero
  ) then
    return false ? '@mesa.numero.already-exist';
  end if;

  insert into tweeks.mesa (
    mesa_colaborador_id,
    mesa_lotacao,
    mesa_numero,
    mesa_designacao
  ) values (
    arg_colaborador_id,
    arg_mesa_lotacao,
    arg_mesa_numero,
    arg_mesa_descricao
  ) returning * into _mesa;

  return true ? jsonb_build_object(
    'mesa', _mesa
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 562 (class 1255 OID 17105)
-- Name: funct_reg_posto(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_posto(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
    declare
      /**
        Essa função serve para criar uma posto para o colaborador
        args := {
          arg_posto_id: UUID
          arg_espaco_auth: ID,
          arg_espaco_destino: [ID, ID, ID],
          arg_colaborador_id: ID
          arg_posto_multiplecaixa: BOOLEAN
    
          arg_posto_matricula:  MATRICULA (CHAVE TEMPORARIA),
          arg_posto_designacao: DESIGNACAO,
          arg_tposto_id: ID,
          arg_posto_multipleuser: BOOLEAN,
          arg_posto_designcao: ID,
          arg_posto_montanteinicial: MONTANTE_INICIAL,
          posto_authmode: AUTH-MODE,
          posto_caixamode: CAIXA-MODE,
        }
      */
    
      arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
      arg_posto_id uuid default args->>'arg_posto_id';
      arg_espaco_destino uuid[] not null default array( select e.text from jsonb_array_elements_text( args->'arg_espaco_destino') e( text ));
      arg_posto_designacao character varying not null default args->>'arg_posto_designacao';
      arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
      arg_tposto_id int2 not null default args->>'arg_tposto_id';
      arg_posto_multiplecaixa boolean default args->>'arg_posto_multiplecaixa';
      arg_posto_matricula character varying default   args->>'arg_posto_matricula';
      arg_posto_montanteinicial float default         args->>'arg_posto_montanteinicial';
      arg_posto_authmode int2 not null default        args->>'posto_authmode';
      arg_posto_caixamode int2 not null default       args->>'posto_caixamode';
    
      _const map.constant;
      _posto tweeks.posto;
    
    begin
    
      _const := map.constant();
    
      if arg_posto_id is null then
        if (
          select count( * ) > 0
          from tweeks.posto p
          where p.posto_matricula = arg_posto_matricula
        ) then
          return false ? 'Código do posto já existe!';
        end if;
    
        _posto.posto_espaco_auth := arg_espaco_auth;
        _posto.posto_tposto_id := arg_tposto_id;
        _posto.posto_colaborador_id := arg_colaborador_id;
        _posto.posto_designacao := arg_posto_designacao;
        _posto.posto_multiplecaixa := coalesce( arg_posto_multiplecaixa, true );
        _posto.posto_matricula := arg_posto_matricula;
        _posto.posto_chave := tweeks.__generate_posto_chave();
        _posto.posto_authmode := arg_posto_authmode;
        _posto.posto_caixamode := arg_posto_caixamode;
    
        select ( "returning" ).* into _posto from lib.sets_in( _posto );
    
        update tweeks.chave
        set chave_definitiva = _posto.posto_chave
        where chave_temporarai = _posto.posto_matricula
        ;
      else
        select ( "returning" ).* into _posto
        from tweeks.posto p
          inner join lib.sets_up( p, replacer := args||jsonb_build_object(
            'posto_tposto_id', arg_tposto_id,
            'posto_designacao', arg_posto_designacao,
            'posto_multiplecaixa', coalesce( arg_posto_multiplecaixa, true ),
            'posto_authmode', arg_posto_authmode,
            'posto_caixamode', arg_posto_caixamode
          )) up on true
        where p.posto_id = arg_posto_id
        ;
      end if;
    
      -- Desativar os antigos espaços alocados ao posto
      update tweeks.aloca
      set aloca_estado = _const.maguita_aloca_estado_fechado,
          aloca_colaborador_atualizacao = arg_colaborador_id,
          aloca_dataatualizacao = current_timestamp
      where aloca_posto_id = _posto.posto_id
        and aloca_espaco_destino != all( arg_espaco_destino )
      ;
    
      -- Criar nova alocaçoes
      insert into tweeks.aloca(
        aloca_posto_id,
        aloca_espaco_destino,
        aloca_espaco_auth,
        aloca_colaborador_id,
        aloca_montante
      ) select
          _posto.posto_id,
          n.next,
          arg_espaco_auth,
          arg_colaborador_id,
          coalesce( arg_posto_montanteinicial, 0 )
      from unnest( arg_espaco_destino ) n( next )
             left join tweeks.aloca al on n.next = al.aloca_espaco_destino
        and al.aloca_posto_id = _posto.posto_id
        and al.aloca_estado = _const.maguita_aloca_estado_ativo
      where al.aloca_id is null
      ;
    
      return true ? jsonb_build_object(
          'posto', _posto,
          'aloca', array(
              select to_jsonb( a )
              from tweeks.aloca a
              where a.aloca_posto_id = _posto.posto_id
                and a.aloca_estado = _const.maguita_aloca_estado_ativo
            )
        );
    end;
    $$;


--
-- TOC entry 868 (class 1255 OID 17106)
-- Name: funct_reg_precario(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_precario(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para registrar e atualizar os preços dos itens
    args := {
      arg_espaco_auth: ID
      arg_colaborador_id: ID,
      arg_forced: boolean,
      arg_precario_referencia: {
        artigo_id: ID,
      },
      arg_links :[
        {  espaco_id: *ID,
           stock_minimo: QUNT
           precario_custo: CUSTO,
           precario_quantidade: QUANT_CUSTO }
      ]
    }
  */

  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';

  arg_precario_referencia jsonb not null default args->>'arg_precario_referencia';
  arg_forced boolean default args->>'arg_forced';
  arg_artigo_id uuid;

  arg_espacos_destino uuid[] default array ( select ( e.doc->>'espaco_id' )::uuid from jsonb_array_elements( args->'arg_links') e( doc ) );
  arg_espaco_child uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth );

  _const map.constant;
  _artigo tweeks.artigo;
  _branch uuid := tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );

begin
  _const := map.constant();
  arg_forced := coalesce( arg_forced, false );

  arg_artigo_id := arg_precario_referencia->>'artigo_id';


  if not arg_forced and arg_artigo_id is not null then
    _artigo := tweeks._get_artigo( arg_artigo_id );

    -- Alterar o preço apenas quando o artigo não estiver em nenhuma conta aberta
    if (
         select count( * ) > 0
         from tweeks.venda ag
         where ag.venda_artigo_id = arg_artigo_id
           and ag.venda_estado in ( _const.maguita_venda_estado_aberto )
          and ag._branch_uid = _branch
       ) then
      return false ? '@tweeks.artigo.price-can-not-update-open-account';
    end if;
  end if;

  -- Desativar o precario atual
  update tweeks.link
    set link_estado = _const.maguita_link_estado_fechado,
        link_dataatualizacao = now(),
        link_colaborador_atualizacao = arg_colaborador_id
    where link_referencia @> arg_precario_referencia
      and link_estado = _const.maguita_link_estado_ativo
      and link_espaco_destino = any( arg_espaco_child )
      and _branch_uid = _branch
      and link_tlink_id = _const.maguita_tlink_preco   
  ;

   -- Criar os novos precarios
   insert into tweeks.link(
      link_tlink_id,
      link_espaco_destino,
      link_espaco_auth,
      link_colaborador_id,
      link_referencia,
      link_posicao,
      link_nome,
      link_metadata
    ) select
      (map.constant()).maguita_tlink_preco,
      ( lp.doc->>'espaco_id' )::uuid,
      arg_espaco_auth,
      arg_colaborador_id,
      arg_precario_referencia,
      0,
      format( 'Preço de %s para %s', _artigo.artigo_nome, e.espaco_nome ),
      jsonb_build_object(
          'precario_custo', ( lp.doc->>'precario_custo' )::double precision,
          'stock_minimo', ( lp.doc->>'stock_minimo' )::double precision,
          'precario_quantidade', (lp.doc->>'precario_quantidade')::double precision
      )
      from jsonb_array_elements( args->'arg_links' ) lp( doc )
        inner join tweeks.espaco e on (lp.doc->>'espaco_id')::uuid = e.espaco_id
    ;
  
  return lib.result_true(jsonb_build_object(
    'precario', array(
        select to_jsonb( l )
          from tweeks.link l
          where l.link_espaco_destino = any( arg_espacos_destino )
            and (l.link_referencia ->>'artigo_id')::uuid = (arg_precario_referencia->>'artigo_id')::uuid
            and l.link_estado = _const.maguita_link_estado_ativo
            and l.link_tlink_id = _const.maguita_tlink_preco
            and l._branch_uid = _branch
    )
  ));
end;
$$;


--
-- TOC entry 787 (class 1255 OID 17107)
-- Name: funct_reg_stock(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_stock(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_colaborador_id: ID,
      arg_artigo_id: ID,
      arg_espacao_id: ID,
      arg_stock_quantidade: QUANT,
    }
   */

  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_artigo_id uuid not null default args->>'arg_artigo_id';
  arg_espacao_id uuid not null default args->>'arg_espacao_id';
  arg_stock_quantidade double precision default args->>'arg_stock_quantidade';

  _stock tweeks.stock;

begin

  -- Garantir que não existe um estock desse produto para o local já definico
  if (
    select count( * ) > 0
      from tweeks.stock st
      where st.stock_espacao_id = arg_espacao_id
        and st.stock_artigo_id = arg_artigo_id
  ) then
    return false ? 'Stock já existe!';
  end if;

  -- Criar o novo stock
  insert into tweeks.stock(
    stock_artigo_id,
    stock_espacao_id,
    stock_colaborador_id
  )  values (
    arg_artigo_id,
    arg_espacao_id,
    arg_colaborador_id
  ) returning * into _stock;


  -- Atualizar o stock se a quantidade de stock for diferente que zero
  if arg_stock_quantidade then
    perform tweeks.funct_reg_acerto(
      jsonb_build_object(
        'arg_colaborador_id', arg_colaborador_id,
        'arg_artigo_id', arg_artigo_id,
        'arg_espaco_id', arg_espacao_id,
        'arg_acerto_quantidade', arg_stock_quantidade,
        'arg_acerto_observacao', 'Acerto inicial para começar o stock com uma quantidade expeficica dos produto.'
      )
    );
  end if;

  return true ? jsonb_build_object(
    'stock', _stock
  );
end;
$$;


--
-- TOC entry 788 (class 1255 OID 17108)
-- Name: funct_reg_taxa(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_taxa(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_espaco_auth: ID,
      arg_colaborador_id: ID,
      arg_tipoimposto_id: ID,
      arg_taxa_percentagem: ID,
      arg_taxa_taxa: VALOR
    }
   */

  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_tipoimposto_id uuid default args->>'arg_tipoimposto_id';
  arg_taxa_percentagem double precision default args->>'arg_taxa_percentagem';
  arg_taxa_taxa double precision default args->>'arg_taxa_taxa';

  _const map.constant;
  _taxa tweeks.taxa;
  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
begin

  _const := map.constant();

  -- Desativar todas as taxas atual
  update tweeks.taxa
    set taxa_estado = _const.taxa_estado_fechado,
        taxa_dataatualizacao = current_timestamp,
        taxa_colaborador_atualizacao = arg_colaborador_id
    where taxa_espaco_auth = arg_espaco_auth
      and taxa_tipoimposto_id = arg_tipoimposto_id
      and taxa_estado = _const.taxa_estado_ativo
      and _branch_uid = ___branch
  ;

  -- Criar o novo imposto
  insert into tweeks.taxa (
    taxa_tipoimposto_id,
    taxa_colaborador_id,
    taxa_percentagem,
    taxa_taxa,
    taxa_espaco_auth
  ) values (
    arg_tipoimposto_id,
    arg_colaborador_id,
    arg_taxa_percentagem,
    arg_taxa_taxa,
    arg_espaco_auth
  ) returning * into _taxa;

  return true ? jsonb_build_object(
    'taxa', _taxa
  );

end;
$$;


--
-- TOC entry 567 (class 1255 OID 17109)
-- Name: funct_reg_trabalha(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_trabalha(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para registar os locas que um colaborador pode trabalhar
    args := {
      arg_espaco_auth: ID
      arg_colaborador_id: ID,
      arg_colaborador_propetario: ID,
      arg_espaco : [
        { arg_espaco_id: ID }
      ]
    }
  */
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_auth uuid  not null default args->>'arg_espaco_auth';
  arg_espaco_child uuid[ ] default rule.espaco_get_childrens( arg_espaco_auth );
  arg_colaborador_propetario uuid default args->>'arg_colaborador_propetario';
  arg_espaco uuid[ ] not null default array ( select ( el.doc->>'arg_espaco_id' )::uuid from jsonb_array_elements( args->'arg_espaco' ) el ( doc ) );
  _const map.constant;
  __branch_uid uuid;
  _branch  tweeks.branch;
begin
  _const := map.constant();
  _branch := tweeks._get_branch_by_colaborador( arg_colaborador_propetario );


  -- Fechar todos os espaços em que o colaborador não vai mais trabalhar
  update tweeks.trabalha
    set trabalha_estado = _const.maguita_trabalha_estado_fechado,
        trabalha_colaborador_atualizacao = arg_colaborador_id,
        trabalha_dataatualizacao = current_timestamp
    where trabalha_estado = _const.maguita_trabalha_estado_ativo
      and trabalha_colaborador_proprietario = arg_colaborador_propetario
      and trabalha_espaco_auth = any( arg_espaco_child )

  ;

  insert into tweeks.trabalha (
    trabalha_colaborador_id,
    trabalha_colaborador_proprietario,
    trabalha_perfil_id,
    trabalha_espaco_destino,
    trabalha_espaco_auth,
    _branch_uid
  ) select arg_colaborador_id,
      arg_colaborador_propetario,
      null,
      es.arg_espaco_id,
      arg_espaco_auth,
     __branch_uid
    from unnest( arg_espaco ) es ( arg_espaco_id )
  ;

  return true ? jsonb_build_object(
    'trabalha', array(
      select tr
        from tweeks.trabalha tr
        where tr.trabalha_estado = _const.maguita_trabalha_estado_ativo
          and tr.trabalha_colaborador_proprietario = arg_colaborador_propetario
    )
  );
end;
$$;


--
-- TOC entry 840 (class 1255 OID 17110)
-- Name: funct_reg_transacao_movimentacao_posto(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_transacao_movimentacao_posto(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para transacionar o valor de um posto
    args := {
      arg_espaco_auth: ID
      arg_posto_id: ID,
      arg_tmovimento_id: ID,
      arg_colaborador_id: ID,
      arg_transacao_zerar: BOOLEAN,
      arg_transacao_montante: float,

      arg_transacao_documento: NULL,
      arg_transacao_observacao: NULL
    }
   */
  arg_posto_id uuid := args->>'arg_posto_id';
  arg_espaco_auth uuid not null := args->>'arg_espaco_auth';
  arg_tmovimento_id int2 := args->>'arg_tmovimento_id';
  arg_colaborador_id uuid := args->>'arg_colaborador_id';
  arg_transacao_zerar boolean := args->>'arg_transacao_zerar';
  arg_transacao_montante double precision := args->>'arg_transacao_montante';
  arg_transacao_documento varchar := args->>'arg_transacao_documento';
  arg_transacao_observacao varchar := args->>'arg_transacao_observacao';

  _const map.constant;
  _posto tweeks.posto;
  _transacao tweeks.transacao;
  _caixa tweeks.caixa;

begin
  _const := map.constant();
  _posto := tweeks._get_posto( arg_posto_id );

  select * into _caixa
    from tweeks.caixa cx
    where cx.caixa_posto_id = _posto.posto_id
      and cx.caixa_estado = _const.caixa_estado_ativo
  ;

  arg_transacao_zerar := coalesce( arg_transacao_zerar, false );

  -- Quando for para zerar a conta então montate aqui sera de zero
  if arg_transacao_zerar then
    arg_transacao_montante := 0;
  end if;

  -- Quando houver documentos
  if arg_transacao_documento is null and _caixa.caixa_id is not null then
    arg_transacao_documento := lib.str_nospace( to_char( _caixa.caixa_id, '"CX#"000-000' ) );

  elseif arg_transacao_documento is null then
    arg_transacao_documento := lib.str_nospace( to_char( nextval( 'tweeks.seq_transacao_movimento' ), '"MV#"000-000' ) );
  end if;

  -- Garantir que quando for deito o montante a debitar menor igaul ao montante no posto
  if arg_tmovimento_id = _const.tmovimento_debito and arg_transacao_montante > _posto.posto_montante then
    return false ? '@tweeks.transacao.montante-insuficient';
  end if;

  _transacao := rule.transacao_create(
      arg_espaco_auth,
      arg_posto_id,
      _const.toperacao_movimento,
      arg_tmovimento_id,
      arg_colaborador_id,
      arg_transacao_montante,
      arg_transacao_documento,
      null,
      arg_transacao_zerar,
      arg_transacao_observacao
    );

  return true ? jsonb_build_object(
    'transacao', _transacao
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 841 (class 1255 OID 17111)
-- Name: funct_reg_transferencia(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_reg_transferencia(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para registar uma transferencia de stock
    args := {
      arg_espaco_auth: *ID
      arg_colaborador_id: *ID,
      arg_espaco_origem: *ID,
      arg_espaco_destino: *ID,

      arg_transferencia_data: DATA,
      arg_transferencia_documento: DOC,
      arg_transferencia_observacao: OBS,
      arg_transferencias:[ {
        artigo_id: *ID,
        transferencia_quantidade: *QUANT
      }]
    }
  */

  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_espaco_origem uuid not null default args->>'arg_espaco_origem';
  arg_espaco_destino uuid not null default args->>'arg_espaco_destino';


  arg_transferencia_data date default args->>'arg_transferencia_data';
  arg_transferencia_documento character varying default lib.str_normalize( args->>'arg_transferencia_documento' );
  arg_transferencia_observacao character varying default lib.str_nospace( args->>'arg_transferencia_observacao' );
  arg_transferencias jsonb default args->'arg_transferencias';

  _espaco_origem tweeks.espaco;
  _espaco_destino tweeks.espaco;
  _const map.constant;
  _data record;

begin

  _const := map.constant();

  arg_transferencia_documento := coalesce( arg_transferencia_documento, upper( lib.dset_random_name( 2, 9 ) ) );
  _espaco_origem := tweeks._get_espaco( arg_espaco_origem );
  _espaco_destino := tweeks._get_espaco( arg_espaco_destino );

  if _espaco_origem.espaco_estado = _const.maguita_espaco_estado_fechado then
    return false ? '@tranferencia.espaco.origem.estatado-fechado';
  end if;

  if _espaco_destino.espaco_estado = _const.maguita_espaco_estado_fechado then
    return false ? '@tranferencia.espaco.destino.estatado-fechado';
  end if;

  with __transferencia as (
    select
        ( e.doc->>'artigo_id' )::uuid as artigo_id,
        ( e.doc->>'transferencia_quantidade' )::double precision as transferencia_quantidade
      from jsonb_array_elements( arg_transferencias ) e( doc )
  ), __esgotado as (
      select *
        from __transferencia tr
          inner join tweeks.artigo art on tr.artigo_id = art.artigo_id
          inner join tweeks._get_stock( art.artigo_id, arg_espaco_origem ) s on art.artigo_id = s.stock_artigo_id
            and s.stock_espaco_id = arg_espaco_origem
        where s.stock_quantidade < tr.transferencia_quantidade
  ) select
      count( * ) as esgotado_total,
      string_agg( format( '%s disponivel: %s, em falta: %s', artigo_nome, e.stock_quantidade, e.transferencia_quantidade - e.stock_quantidade ), ', ' ) as esgotado_message
      into _data
    from __esgotado e
  ;

--   if _data.esgotado_total > 0 then
--     return lib.result_false( format( 'Quantidade dos artigos disponivel insuficiente para a transferencia.<br/> Artigos: %s', _data.esgotado_message ));
--   end if;

  with  __args as (
    select
        ( e.doc->>'artigo_id' )::uuid as artigo_id,
        ( e.doc->>'transferencia_quantidade' )::double precision as transferencia_quantidade
      from jsonb_array_elements( arg_transferencias ) e( doc )
  ), __transferencia as (
      select a.*
      from __args a
  ), __register as (
    insert into tweeks.transferencia (
        transferencia_espaco_auth,
        transferencia_artigo_id,
        transferencia_espaco_origem,
        transferencia_espaco_destino,
        transferencia_colaborador_id,
        transferencia_quantidade,
        transferencia_data,
        transferencia_documento,
        transferencia_observacao
  ) select
       arg_espaco_auth,
       artigo_id,
       arg_espaco_origem,
       arg_espaco_destino,
       arg_colaborador_id,
       t.transferencia_quantidade,
       arg_transferencia_data,
       arg_transferencia_documento,
       arg_transferencia_observacao
      from __transferencia t
    returning *
  ) select
      array_agg( r ) as transferencias
      into _data
    from __register r
  ;

  return true?jsonb_build_object(
    'transferencia', _data.transferencias
  );

end;
$$;


--
-- TOC entry 789 (class 1255 OID 17112)
-- Name: funct_report_caixa(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_report_caixa(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Relatorio sobre as caixa e posto de venda
    filter := {
      arg_data_registro: { start: DATE, end: DATE }
      arg_posto_id: ID,
      arg_colaborador_vendedor: ID,
      arg_espaco_venda: ID,
      arg_espaco_auth: ID

    }
  */

  arg_data_registro_start date default filter->'arg_data_registro'->>'start';
  arg_data_registro_end date default filter->'arg_data_registro'->>'end';

  arg_posto_id uuid default filter->>'arg_posto_id';
  arg_espaco_venda uuid default filter->>'arg_espaco_venda';
  arg_caixa_estado uuid default filter->>'arg_caixa_estado';
  arg_colaborador_vendedor uuid default filter->>'arg_colaborador_vendedor';

  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );

  _const map.constant;
begin
  _const := map.constant();

  return query
    with report as (
      with caixa_amortizacao as (
        select
            am.amortizacao_caixa_id,
            count( am.amortizacao_id ) as caixa_totalcobrado,
            sum( am.amortizacao_montante ) as caixa_montantefaturado
          from tweeks.amortizacao am
          where am.amortizacao_estado = _const.amortizacao_estado_ativo
            and am.amortizacao_espaco_auth = any( arg_espaco_child )
          group by am.amortizacao_caixa_id

      ), caixa_conta as (
        select
            ct.conta_caixa_fechopagamento,
            count( ct.conta_id ) as caixa_contasaberta
          from tweeks.conta ct
          where ct.conta_estado in ( _const.conta_estado_pago, _const.conta_estado_fechado )
            and ct.conta_espaco_auth = any( arg_espaco_child )
          group by ct.conta_caixa_fechopagamento

      ), caixa_conta_fecho as (
        select ct.conta_caixa_fechopagamento,
            count( ct.conta_id ) as caixa_contafechada
          from tweeks.conta ct
          where ct.conta_estado in ( _const.conta_estado_pago, _const.conta_estado_fechado )
            and ct.conta_espaco_auth = any( arg_espaco_child )
          group by ct.conta_caixa_fechopagamento
      ) select
            cx.*,
            co.*,
            pos.*,
            esp.*,
            lib.str_nospace( to_char( cx.caixa_id, '"CX#"000-000' ) ) as caixa_codigo,

            format( '%s %s', co.colaborador_nome, co.colaborador_apelido ) as colaborador_nomecompleto,
            case when cx.caixa_estado = _const.caixa_estado_fechado then cx.caixa_dataatualizacao end as caixa_datafecho,
            cxa.caixa_totalcobrado as caixa_totalcobrado,
            coalesce( cxa.caixa_montantefaturado, 0 ) as caixa_montantefaturado,
            coalesce( cxc.caixa_contasaberta, 0 ) as caixa_contasaberta,
            coalesce( cxcf.caixa_contafechada, 0 ) as caixa_contafechada,
            case
              when cx.caixa_estado = _const.cambio_estado_ativo then 'Ativo'
              when cx.caixa_estado = _const.cambio_estado_fechado then 'Fechado'
            end as caixa_estadodesc
        from tweeks.caixa cx
          inner join auth.colaborador co on cx.caixa_colaborador_id = co.colaborador_id
          inner join tweeks.posto pos on cx.caixa_posto_id = pos.posto_id
          inner join tweeks.espaco esp on pos.posto_espaco_destino = esp.espaco_id
          left join caixa_amortizacao cxa on cx.caixa_id = cxa.amortizacao_caixa_id
          left join caixa_conta cxc on cx.caixa_id = cxc.conta_caixa_fechopagamento
          left join caixa_conta_fecho cxcf on cx.caixa_id = cxcf.conta_caixa_fechopagamento
        where cx.caixa_dataregistro::date between coalesce( arg_data_registro_start, cx.caixa_dataregistro::date ) and coalesce( arg_data_registro_end, cx.caixa_dataregistro::date )
          and cx.caixa_estado = coalesce( arg_caixa_estado, cx.caixa_estado )
          and pos.posto_id = coalesce( arg_posto_id, pos.posto_id )
          and esp.espaco_id = coalesce( arg_espaco_venda, esp.espaco_id )
          and cx.caixa_colaborador_id = coalesce( arg_colaborador_vendedor, cx.caixa_colaborador_id )
          and cx.caixa_espaco_auth = any( arg_espaco_child )
        order by cx.caixa_estado desc,
          cx.caixa_dataregistro desc
    ) select
          lib.jsonb_values( to_jsonb( r ),
            'caixa_id',
            'caixa_codigo',
            'caixa_montanteinicial',
            'caixa_montantefecho',
            'caixa_quantidadecheque',
            'caixa_observacao',
            'caixa_dataregistro',
            'posto_designacao',
            'espaco_nome',
            'posto_designacao',
            'espaco_descricao',
            'colaborador_nomecompleto',
            'caixa_datafecho',
            'caixa_totalcobrado',
            'caixa_montantefaturado',
            'caixa_contasaberta',
            'caixa_contafechada',
            'caixa_estadodesc',
            'colaborador_nome'
          )
      from report r;
end;
$$;


--
-- TOC entry 568 (class 1255 OID 17113)
-- Name: funct_report_compra_entrada(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_report_compra_entrada(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para processar o relatório de compras (entradas)
    arg_data_operacao :{ start: date, end :date },
    arg_data_registro :{ start: date, end :date },
    arg_espaco_id: ID,
    arg_classe_id: ID,
    arg_fornecedor_id: ID,
    arg_artigo_id: ID,
   */
  arg_data_operacao_start date default filter ->'arg_data_operacao'->>'start';
  arg_data_operacao_end date default filter ->'arg_data_operacao'->>'end';

  arg_data_registro_start date default filter ->'arg_data_registro'->>'start';
  arg_data_registro_end date default filter ->'arg_data_registro'->>'end';

  arg_espaco_id uuid default filter ->>'arg_espaco_id';
  arg_classe_id uuid default filter ->>'arg_classe_id';
  arg_fornecedor_id uuid default filter ->>'arg_fornecedor_id';
  arg_artigo_id uuid default filter ->>'arg_artigo_id';

  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );

begin
  return query
    with report as (

    select
          art.*,
          ent.*,
          fo.*,
          esp.*,
          col.*
        from tweeks.entrada ent
          inner join tweeks.artigo art on ent.entrada_artigo_id = art.artigo_id
          inner join tweeks.fornecedor fo on ent.entrada_fornecedor_id = fo.fornecedor_id
          inner join tweeks.espaco esp on ent.entrada_espaco_destino = esp.espaco_id
          inner join auth.colaborador col on ent.entrada_colaborador_id = col.colaborador_id
        where ent.entrada_data between coalesce( arg_data_operacao_start, ent.entrada_data ) and coalesce( arg_data_operacao_end, ent.entrada_data )
          and ent.entrada_dataregistro between coalesce( arg_data_registro_start, ent.entrada_dataregistro ) and coalesce( arg_data_registro_end, ent.entrada_dataregistro )
          and esp.espaco_id = coalesce( arg_espaco_id, esp.espaco_id )
          and art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id )
          and fo.fornecedor_id = coalesce( arg_fornecedor_id, fo.fornecedor_id )
          and art.artigo_id = coalesce( arg_artigo_id, art.artigo_id )
          and ent.entrada_espaco_auth = any( arg_espaco_child )
    )
    select
      lib.jsonb_values(
        to_jsonb( r ),
          'artigo_id',
          'artigo_codigo',
          'artigo_nome',
          'artigo_custo',
          'artigo_stock',
          'artigo_preparacao',

          'entrada_id',
          'entrada_codigofatura',
          'entrada_data',
          'entrada_quantidade',
          'entrada_montante',
          'entrada_descricao',
          'entrada_estado',
          'entrada_dataregistro',

          'colaborador_nome',
          'colaborador_apelido',

          'fornecedor_id',
          'fornecedor_nif',
          'fornecedor_nome',

          'espaco_nome'
        )
      from report r
  ;
end;
$$;


--
-- TOC entry 842 (class 1255 OID 17114)
-- Name: funct_report_estatistica_posto(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_report_estatistica_posto(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função devolve os relatorio do posto todos
    -- columns
      Data,
      Posta,
      Espaço,
      Caixa,
      Montante, -- Montante geradao
      Pagos,    -- Montante pago
      Contas    -- Total de contas abertas


    filter := {
      arg_data_registro: { start: DATE, end: DATE }
      arg_posto_id: ID,
      arg_colaborador_vendedor: ID,
      arg_espaco_venda: ID,
      arg_periodo_required:  { "key": "dd-mm-yyyy", "label": "dd", "title": "dia dd 'de' Mon 'de' YYYY", "interval": INTERVAL }



    }
  */

  arg_data_registro_start date default filter->'arg_data_registro'->>'start';
  arg_data_registro_end date default filter->'arg_data_registro'->>'end';

  arg_periodo_required_key character varying := filter->'arg_periodo_required'->>'key';
  arg_periodo_required_label character varying := filter->'arg_periodo_required'->>'label';
  arg_periodo_required_title character varying := filter->'arg_periodo_required'->>'title';
  arg_periodo_required_interval interval not null := filter->'arg_periodo_required'->>'interval';


  arg_posto_id uuid default filter->>'arg_posto_id';
  arg_espaco_venda uuid default filter->>'arg_espaco_venda';
  arg_colaborador_vendedor uuid default filter->>'arg_colaborador_vendedor';

  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );

  _data record;
  _const map.constant;

begin

  select min( cx.caixa_dataregistro::date ) as absolut_start, max( cx.caixa_dataregistro::date) as max_date    into _data
    from tweeks.caixa cx
  ;

  if arg_data_registro_start is not null and arg_data_registro_start > _data.absolut_start then
    _data.absolut_start := arg_data_registro_start;
  end if;

  if _data.absolut_start > current_date then
    _data.absolut_start := current_date;
  end if;

  _data.max_date := current_date;
  if arg_data_registro_end is not null and arg_data_registro_end < current_date and arg_data_registro_end >= _data.absolut_start then
    _data.max_date := arg_data_registro_end;
  end if;


  _const := map.constant();
  return query
      with recursive dates( data ) as (
          values ( _data.absolut_start )
        union all
          select d.data + arg_periodo_required_interval
            from dates d
            where d.data + arg_periodo_required_interval <= _data.max_date
      )
      select lib.jsonb_values( to_jsonb( pos ) || to_jsonb( cx )|| to_jsonb( co ) || to_jsonb( pos ),
        'caixa_id',
        'caixa_montanteinicial',
        'caixa_montantefecho',
        'caixa_quantidadecheque',
        'caixa_observacao',
        'caixa_dataregistro',
        'posto_designacao',
        'espaco_nome',
        'posto_designacao',
        'espaco_descricao',
        'colaborador_nome'
      ) || jsonb_build_object(
        'colaborador_nomecompleto', format( '%s %s', co.colaborador_nome, co.colaborador_apelido ),
        'caixa_datafecho', case when cx.caixa_estado = _const.caixa_estado_fechado then cx.caixa_dataatualizacao end,
        'caixa_totalcobrado', cxa.caixa_totalcobrado,
        'caixa_montantepagamento', coalesce( cxa.caixa_montantepagamento, 0 ),
        'caixa_contasaberta', coalesce( cxc.caixa_contasaberta, 0 ),
        'caixa_contafechada', coalesce( cxcf.caixa_contafechada, 0 ),
        'caixa_estado', case
            when cx.caixa_estado = _const.cambio_estado_ativo then 'Ativo'
            when cx.caixa_estado = _const.cambio_estado_fechado then 'Fechado'
          end
      )
      from dates dt
        inner join tweeks.posto post on true
          and post.posto_espaco_destino = any( arg_espaco_child )
        left join tweeks.caixa cx on post.posto_id = cx.caixa_posto_id
          and cx.caixa_espaco_auth = any( arg_espaco_child )
        left join tweeks.amortizacao amort on cx.caixa_id = amort.amortizacao_caixa_id
          and amort.amortizacao_espaco_auth = any( arg_espaco_child )
        left join tweeks.conta ct on cx.caixa_id = ct.conta_caixa_id
          and ct.conta_espaco_auth = any( arg_espaco_child )
        left join tweeks.conta ctclose on cx.caixa_id = ct.conta_caixa_fechopagamento
          and ct.conta_espaco_auth = any( arg_espaco_child )
    ;
end;
$$;


--
-- TOC entry 569 (class 1255 OID 17115)
-- Name: funct_report_estatistica_venda(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_report_estatistica_venda(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Esse relatório gera a estatistica de venda
    filter := {
      arg_periodo_required: { "key": KEY, "label": NAME, "title": TITLE },
      arg_estatistica_tipo: { "key": KEY, "title": TITLE, "class": CLASSE }
      arg_data_operacao: { start: DATE, end: DATE },
      arg_data_registro: { start: DATE, end: DATE },
      arg_artigo_id: ID,
      arg_classe_id: ID,
      arg_show_empty: 1 | 0
      arg_periodos: PERIODO
   */

  arg_periodo_requiere_key character varying not null default filter ->'arg_periodo_required'->>'key';
  arg_periodo_requiere_label character varying not null default filter ->'arg_periodo_required'->>'label';
  arg_periodo_requiere_title character varying not null default filter ->'arg_periodo_required'->>'title';
  arg_periodo_requiere_interval interval not null default filter ->'arg_periodo_required'->>'interval';
  arg_periodo_requiere_increment interval not null default filter ->'arg_periodo_required'->>'increment';
  arg_periodo_requiere_length text not null default filter ->'arg_periodo_required'->>'length';
  arg_periodo_requiere_loop integer not null default filter ->'arg_periodo_required'->>'loop';
  arg_periodo_requiere_type text not null default filter ->'arg_periodo_required'->>'type';

  arg_estatistica_tipo_key character varying not null default filter ->'arg_estatistica_tipo'->>'key';
  arg_estatistica_tipo_title character varying not null default filter ->'arg_estatistica_tipo'->>'title';
  arg_estatistica_tipo_class character varying not null default filter ->'arg_estatistica_tipo'->>'class';

  arg_data_registro_start date default filter ->'arg_data_registro'->>'start';
  arg_data_registro_end date default   filter ->'arg_data_registro'->>'end';

  arg_artigo_id uuid default filter->>'arg_artigo_id';
  arg_posto_id uuid default filter->>'arg_posto_id';
  arg_classe_id uuid default filter->>'arg_classe_id';
  arg_periodos int2 default filter->>'arg_periodos';
  arg_show_empty boolean default filter->>'arg_show_empty';

  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );

  _const map.constant;
begin
  _const := map.constant();

  -- Garantir que a data não ultrapassa o limite de tempo para o periodo
  -- Pirodo Diario 30 dias = 1 mes

  if  arg_estatistica_tipo_class = 'Money' then
    arg_periodo_requiere_loop := 8;
  end if;

  -- Periodo Mensal 365 dias = 12 meses = 1 ano
  if arg_data_registro_end::timestamptz - arg_data_registro_start::timestamptz >= arg_periodo_requiere_interval then
    return;
  end if;


  arg_show_empty := coalesce( arg_show_empty, true );
  arg_periodos := coalesce( arg_periodos, arg_periodo_requiere_loop );

  -- Determinar a data limite inferior
  if arg_data_registro_start is null and arg_data_registro_end is null then
    arg_data_registro_start := current_date - ( arg_periodo_requiere_increment * arg_periodos );
  elseif  arg_data_registro_start is null then
    arg_data_registro_start := arg_data_registro_end - ( arg_periodo_requiere_increment * ( arg_periodos ) );
  end if;

  -- Determinar a data limit superior
  if arg_data_registro_end is null then
    arg_data_registro_end := arg_data_registro_start + ( arg_periodo_requiere_increment * ( arg_periodos ) );
  end if;

  --   raise exception 'start: %, end: %', arg_data_registro_start, arg_data_registro_end;



  return query
    with recursive periode ( date, loop ) as (
      values ( arg_data_registro_start, 1 )
      union all
      select ( p.date + arg_periodo_requiere_increment )::date, p.loop +1
      from periode p
      where p.date < arg_data_registro_end
    ), reporte as (
      select
        to_char( p2.date, arg_periodo_requiere_key ) as key,
        to_char( p2.date, arg_periodo_requiere_label ) as label,
        to_char( p2.date, arg_periodo_requiere_title ) as period_title,
        art.*,
        coalesce( count( distinct ct.conta_id ), 0 ) as conta_quantidade,
        coalesce( count( distinct ve.venda_id ), 0 ) as venda_totalvenda,
        coalesce( sum( ve.venda_quantidade ), 0 ) as venda_quantidade,
        coalesce( sum( ve.venda_montantetotal ), 0 ) as venda_montante
      from periode p2
        left join tweeks.conta ct on to_char( p2.date, arg_periodo_requiere_key ) = to_char( ct.conta_dataregistro, arg_periodo_requiere_key )
          and ct.conta_estado =  _const.conta_estado_pago
          and ct.conta_espaco_auth = any( arg_espaco_child )
        left join tweeks.venda ve on ct.conta_id = ve.venda_conta_id
          and ve.venda_estado =  _const.venda_estado_fechado
          and ve.venda_espaco_auth = any( arg_espaco_child )
        left join tweeks.artigo art on ve.venda_artigo_id = art.artigo_id
          and art.artigo_id = coalesce( arg_artigo_id, art.artigo_id )
          and art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id )
        left join tweeks.caixa cx on ct.conta_caixa_fechopagamento = cx.caixa_id
          and cx.caixa_posto_id = coalesce( arg_posto_id, cx.caixa_posto_id )
          and cx.caixa_espaco_auth = any( arg_espaco_child )
      group by art.artigo_id,
        p2.date
      having arg_show_empty or count( ve.venda_id ) > 0
    )
      select
        jsonb_build_object(
        'header', array(
          select
            jsonb_build_object(
              'key', p.key,
              'label', p.label,
              'class', arg_estatistica_tipo_class,
              'length', arg_periodo_requiere_length,
              'title', format( '%s em %s', arg_estatistica_tipo_title, p.period_title ),
              'sumRow', true
            )
            from reporte p
            group by p.key, p.label, p.period_title
            order by p.key asc
        ) || array [
          jsonb_build_object( 'key', 'sum', 'label', 'SUN', 'class', arg_estatistica_tipo_class, 'title', 'Somatorio', 'sumRow', true, 'length', 'normal' )
        ]
      )
    union all
      select jsonb_build_object(
          'artigo_id', p.artigo_id,
          'artigo_nome', p.artigo_nome,
          'artigo_codigo', p.artigo_codigo,
          'artigo_montantetotalvendido', sum( p.venda_montante ),
          'artigo_quantidadetotalvendida', sum( p.venda_quantidade ),
          'sum', sum( ( to_jsonb( p ) ->> ( arg_estatistica_tipo_key ) ) ::double precision ),
          'avg', avg( ( to_jsonb( p ) ->> ( arg_estatistica_tipo_key ) ) ::double precision )
        ) || jsonb_object_agg( p.key, to_jsonb( p ) ->> ( arg_estatistica_tipo_key ) )
        from reporte p
        where p.artigo_id is not null
        group by
          p.artigo_id,
          p.artigo_codigo,
          p.artigo_nome
  ;
end;
$$;


--
-- TOC entry 570 (class 1255 OID 17117)
-- Name: funct_report_stock_movimentos(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_report_stock_movimentos(filter jsonb DEFAULT NULL::jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Esse relatorio apresenta as movimentações em stock
    filters := {
      arg_data_operacao: {start: date, end: date }
      arg_data_registro: {start: date, end: date }
      arg_tmovimento_id: ID,
      arg_toperacao_stock: ID
      arg_artigo_id: ID
    }
  */

  arg_data_registro_start date default filter->'arg_data_registro'->>'start';
  arg_data_registro_end date default filter->'arg_data_registro'->>'end';
  arg_data_operacao_start date default filter->'arg_data_registro'->>'start';
  arg_data_operacao_end date default filter->'arg_data_registro'->>'end';

  arg_tmovimento_id int2 default filter->>'arg_tmovimento_id';
  arg_toperacao_stock int2 default filter->>'arg_toperacao_stock';
  arg_artigo_id uuid default filter->>'arg_artigo_id';
  arg_classe_id uuid default filter->>'arg_classe_id';

  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );

  arg_columns text[] default array[
      'movimento_id',
      'movimento_data',
      'movimento_documento',
      'movimento_quantidade',
      'movimento_quantidadeinicia',
      'movimento_quantidadefinal',
      'movimento_dataregistro',
      'artigo_nome',
      'artigo_codigo',
      'espaco_nome',
      'colaborador_nome',
      'stock_quantidade',
      'artigo_stock',
      'tmovimento_designacao',
      'toperacao_designacao'
    ];

  _const map.constant;
begin
  _const := map.constant();
  return query
    with report as (
      select
        mv.*,
        tm.*,
        a.*,
        e.*,
        col.*,
        top.*,
        format( '%s %s', col.colaborador_nome, col.colaborador_apelido ) as colaborador_nomecompleto
      from tweeks.movimento mv
        inner join tweeks.stock s on mv.movimento_stock_id = s.stock_id
        inner join tweeks.artigo a on s.stock_artigo_id = a.artigo_id
        inner join tweeks.espaco e on s.stock_espacao_id = e.espaco_id
        inner join auth.colaborador col on mv.movimento_colaborador_id = col.colaborador_id
        inner join tweeks.toperacao top on mv.movimento_toperacao_id = top.toperacao_id
        inner join tweeks.tmovimento tm on mv.movimento_tmovimento_id = tm.tmovimento_id
      where mv.movimento_estado != _const.movimento_estado_canselado
        and tm.tmovimento_id = coalesce( arg_tmovimento_id, tm.tmovimento_id )
        and mv.movimento_toperacao_id = coalesce( arg_toperacao_stock, mv.movimento_toperacao_id )
        and mv.movimento_data between coalesce( arg_data_operacao_start, mv.movimento_data ) and coalesce( arg_data_operacao_end, mv.movimento_data )
        and mv.movimento_dataregistro::date between coalesce( arg_data_registro_start, mv.movimento_dataregistro::date ) and coalesce( arg_data_registro_end, mv.movimento_dataregistro::date )
        and a.artigo_id = coalesce( arg_artigo_id, a.artigo_id )
        and a.artigo_classe_id = coalesce( arg_classe_id, a.artigo_classe_id )
        and mv.movimento_espaco_auth = any( arg_espaco_child )
      order by mv.movimento_dataregistro desc
    )
    select lib.jsonb_values( rp , variadic arg_columns )
    from report rp
  ;
end;
$$;


--
-- TOC entry 845 (class 1255 OID 17118)
-- Name: funct_report_transacao(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_report_transacao(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Essa função serve para devolver dados para relatório de transação
    filter := {
      arg_data_registro: { start: DATE, end: DATE },
      arg_posto_id: ID,
      arg_tmovimento_id: ID,
      arg_toperacao_montante: ID,
      arg_colaborador_id: ID,
      arg_transacao_zerar: ID,
    }
   */
  _const map.constant;
  arg_data_registro_start date default filter->'arg_data_registro'->>'start';
  arg_data_registro_end date default filter->'arg_data_registro'->>'end';

  arg_posto_id uuid default filter->>'arg_posto_id';
  arg_colaborador_id uuid default filter->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );

  arg_tmovimento_id int2 default filter->>'arg_tmovimento_id';
  arg_toperacao_montante int2 default filter->>'arg_toperacao_montante';
  arg_transacao_zerar boolean default filter->>'arg_transacao_zerar';
  arg_documento character varying default filter->>'arg_documento';


begin

  _const := map.constant();

  return query
    with report as (
      select *,
        case
          when trans.transacao_zerar then 'Zerado'
          else 'Lançado'
          end as transacao_zerardesignacao,
        lib.str_normalize( format( '%s %s', col.colaborador_nome, col.colaborador_apelido ) ) as colaborador_nomecompleto,
        case when t.tmovimento_id = _const.tmovimento_credito then trans.transacao_montante end as transacao_montantecredito,
        case when t.tmovimento_id = _const.tmovimento_debito then trans.transacao_montante end as transacao_montantedebito
      from tweeks.transacao trans
             inner join tweeks.posto pos on trans.transacao_posto_id = pos.posto_id
             inner join tweeks.tmovimento t on trans.transacao_tmovimento_id = t.tmovimento_id
             inner join tweeks.toperacao top on trans.transacao_toperacao_id = top.toperacao_id
             inner join auth.colaborador col on trans.transacao_colaborador_id = col.colaborador_id
      where trans.transacao_dataregistro::date between coalesce( arg_data_registro_start,  trans.transacao_dataregistro::date ) and coalesce( arg_data_registro_end,  trans.transacao_dataregistro::date )
        and pos.posto_id = coalesce( arg_posto_id, pos.posto_id )
        and t.tmovimento_id = coalesce( arg_tmovimento_id, t.tmovimento_id )
        and top.toperacao_id = coalesce( arg_toperacao_montante, top.toperacao_id )
        and trans.transacao_zerar = coalesce( arg_transacao_zerar, trans.transacao_zerar )
        and col.colaborador_id = coalesce( arg_colaborador_id, col.colaborador_id )
        and lower( public.unaccent( trans.transacao_documento ) ) like '%'||lower( public.unaccent( coalesce( arg_documento, trans.transacao_documento) ) )||'%'
        and trans.transacao_espaco_auth = any( arg_espaco_child )
      order by trans.transacao_dataregistro asc
    ) select
      lib.jsonb_values( to_jsonb( r ) ,
        'transacao_documento',
        'transacao_zerardesignacao',
        'transacao_montante',
        'transacao_montantecredito',
        'transacao_montantedebito',
        'transacao_montanteinicial',
        'transacao_montantefinal',
        'transacao_observacao',
        'transacao_dataregistro',
        'posto_designacao',
        'tmovimento_designacao',
        'toperacao_designacao',
        'colaborador_nome',
        'colaborador_apelido',
        'colaborador_nomecompleto'
      ) from report r;
end;
$$;


--
-- TOC entry 846 (class 1255 OID 17119)
-- Name: funct_report_venda(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_report_venda(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
    /** Relatorio de vendas
      filter := {
        arg_data_operacao:{ start: DATE, end: DATE },
        arg_data_registro:{ start: DATE, end: DATE },
        arg_artigo_id: ID
        arg_posto_id: ID,
        arg_colaborador_vendedor: ID,
        arg_currency_pagamento: ID,
        arg_colaborador_vendedor: ID,
        arg_tpaga_id: ID,
        arg_classe_id: ID,
        arg _conta_fatura: FATURA,
      }
     */

    arg_data_operacao_start date default filter->'arg_data_operacao'->>'start';
    arg_data_operacao_end date default filter->'arg_data_operacao'->>'end';

    arg_data_registro_start date default filter->'arg_data_registro'->>'start';
    arg_data_registro_end date default filter->'arg_data_registro'->>'end';

    arg_artigo_id uuid default filter->>'arg_artigo_id';
    arg_posto_id uuid default filter->>'arg_posto_id';
    arg_colaborador_vendedor uuid default filter->>'arg_colaborador_vendedor';
    arg_classe_id uuid default filter->>'arg_classe_id';

    arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
    arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );

    arg_currency_pagamento int2 default filter->>'arg_currency_pagamento';
    arg_tpaga_id int2 default filter->>'arg_tpaga_id';
    arg_conta_montante_start double precision default filter->'arg_conta_montante'->>'start';
    arg_conta_montante_end double precision default filter->'arg_conta_montante'->>'end';
    arg_conta_fatura character varying default filter->>'arg_conta_fatura';

    _const map.constant;

begin
    _const := map.constant();

    return query
        with report as (
            select ve.*,
                   art.*,
                   ct.*,
                   col.*,
                   trim( format( '%s %s', col.colaborador_nome, col.colaborador_apelido ) ) as colaborador_nomecompleto,
                   string_agg( it.artigo_nome, ', ' ) as venda_itens
            from tweeks.venda ve
                     inner join tweeks.artigo art on ve.venda_artigo_id = art.artigo_id
                     inner join tweeks.conta ct on ve.venda_conta_id = ct.conta_id
                     inner join tweeks.caixa cx on ct.conta_caixa_fechopagamento = cx.caixa_id
                     inner join auth.colaborador col on coalesce ( ct.conta_colaborador_atualizacao, ct.conta_colaborador_id ) = col.colaborador_id
                     left join tweeks.agrega agg on ve.venda_id = agg.agrega_venda_id
                      and agg.agrega_estado = _const.agrega_estado_fechado
                    left join tweeks.artigo it on agg.agrega_artigo_item = it.artigo_id

            where ct.conta_estado = _const.conta_estado_pago
              and ve.venda_estado = _const.venda_estado_fechado
              and ct.conta_data between coalesce( arg_data_operacao_start, ct.conta_data ) and coalesce( arg_data_operacao_end, ct.conta_data )
              and ct.conta_dataregistro::date between coalesce( arg_data_registro_start, ct.conta_dataregistro::date ) and coalesce( arg_data_registro_end, ct.conta_dataregistro::date )
              and cx.caixa_posto_id = coalesce( arg_posto_id, cx.caixa_posto_id )
              and coalesce( ct.conta_colaborador_atualizacao, ct.conta_colaborador_id ) = coalesce( arg_colaborador_vendedor, ct.conta_colaborador_atualizacao, ct.conta_colaborador_id )
              and ct.conta_currency_id = coalesce( arg_currency_pagamento, ct.conta_currency_id )
              and ct.conta_tpaga_id = coalesce( arg_tpaga_id, ct.conta_tpaga_id )
              and ct.conta_montante between  coalesce( arg_conta_montante_start, ct.conta_montante ) and coalesce( arg_conta_montante_end, ct.conta_montante )
              and art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id )
              and art.artigo_id = coalesce( arg_artigo_id, art.artigo_id )
              and lower( ct.conta_numerofatura ) like '%' ||lower( coalesce( arg_conta_fatura, ct.conta_numerofatura ) ) ||'%'
              and ct.conta_espaco_auth = any( arg_espaco_child )
            group by
                art.artigo_id,
                ct.conta_id,
                ve.venda_id,
                col.colaborador_id
        ) select lib.jsonb_values( r,
            'venda_id',
            'venda_quantidade',
            'venda_montente',
            'venda_montanteagregado',
            'venda_montantetotal',
            'venda_custounitario',
            'venda_imposto',
            'venda_montantecomimposto',

            'artigo_nome',
            'artigo_codigo',

            'conta_numerofatura',
            'conta_titular',
            'conta_montante',
            'conta_data',

            'conta_dataregistro',
            'colaborador_nome',
            'colaborador_nomecompleto',
            'venda_itens'
         )
        from report r
    ;
end;
$$;


--
-- TOC entry 572 (class 1255 OID 17120)
-- Name: funct_report_venda_artigo(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_report_venda_artigo(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Relatorio de vendas
    filter := {
      arg_data_operacao:{ start: DATE, end: DATE },
      arg_data_registro:{ start: DATE, end: DATE },
      arg_artigo_id: ID
      arg_posto_id: ID,
      arg_colaborador_vendedor: ID,
      arg_currency_pagamento: ID,
      arg_colaborador_vendedor: ID,
      arg_tpaga_id: ID,
      arg_classe_id: ID,
      arg _conta_fatura: FATURA,
    }
   */

  arg_data_operacao_start date default filter->'arg_data_operacao'->>'start';
  arg_data_operacao_end date default filter->'arg_data_operacao'->>'end';

  arg_data_registro_start date default filter->'arg_data_registro'->>'start';
  arg_data_registro_end date default filter->'arg_data_registro'->>'end';

  arg_artigo_id uuid default filter->>'arg_artigo_id';
  arg_posto_id uuid default filter->>'arg_posto_id';
  arg_colaborador_vendedor uuid default filter->>'arg_colaborador_vendedor';
  arg_classe_id uuid default filter->>'arg_classe_id';
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );

  arg_currency_pagamento int2 default filter->>'arg_currency_pagamento';
  arg_tpaga_id int2 default filter->>'arg_tpaga_id';
  arg_conta_montante_start double precision default filter->'arg_conta_montante'->>'start';
  arg_conta_montante_end double precision default filter->'arg_conta_montante'->>'end';
  arg_conta_fatura character varying default filter->>'arg_conta_fatura';


  _const map.constant;

begin
  _const := map.constant();

  return query
    with __vendas ( venda_id, venda_conta_id, venda_artigo_id, venda_quantidade, venda_custounitario, venda_montente, venda_dataregistro, venda_modalidade, venda_tmodalidade, venda_gmodalidade  ) as (
      select v.venda_id, v.venda_conta_id, v.venda_artigo_id, v.venda_quantidade, v.venda_custounitario, v.venda_montente, v.venda_dataregistro, 'Venda directa'::text, 1, 1
        from tweeks.venda v
        where v.venda_estado = _const.venda_estado_fechado
    union all
      select ag.agrega_id, ve.venda_conta_id, ag.agrega_artigo_item, ag.agrega_quantidade, ag.agrega_custounitario, ag.agrega_montante, ag.agrega_dataregistro, 'Item Extras'::text, case when ag.agrega_montante > 0 then 2 else  3 end, 2
        from tweeks.agrega ag
          inner join tweeks.venda ve on ag.agrega_venda_id = ve.venda_id
        where ag.agrega_estado = _const.agrega_estado_fechado
          and ve.venda_estado = _const.venda_estado_fechado
    ), report as (
      select art.*,
         _v.venda_custounitario as venda_custounitario,
         sum( _v.venda_quantidade ) as venda_quantidade,
         sum( _v.venda_montente ) as venda_montente,
        _v.venda_modalidade as  venda_modalidade
      from tweeks.artigo art
        inner join __vendas _v on art.artigo_id = _v.venda_artigo_id
        inner join tweeks.conta ct on _v.venda_conta_id = ct.conta_id
        inner join tweeks.caixa cx on ct.conta_caixa_fechopagamento = cx.caixa_id

      where ct.conta_estado = _const.conta_estado_pago
        and ct.conta_data between coalesce( arg_data_operacao_start, ct.conta_data ) and coalesce( arg_data_operacao_end, ct.conta_data )
        and ct.conta_dataregistro::date between coalesce( arg_data_registro_start, ct.conta_dataregistro::date ) and coalesce( arg_data_registro_end, ct.conta_dataregistro::date )
        and cx.caixa_posto_id = coalesce( arg_posto_id, cx.caixa_posto_id )
        and coalesce( ct.conta_colaborador_atualizacao, ct.conta_colaborador_id ) = coalesce( arg_colaborador_vendedor, ct.conta_colaborador_atualizacao, ct.conta_colaborador_id )
        and ct.conta_currency_id = coalesce( arg_currency_pagamento, ct.conta_currency_id )
        and ct.conta_tpaga_id = coalesce( arg_tpaga_id, ct.conta_tpaga_id )
        and ct.conta_montante between  coalesce( arg_conta_montante_start, ct.conta_montante ) and coalesce( arg_conta_montante_end, ct.conta_montante )
        and art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id )
        and art.artigo_id = coalesce( arg_artigo_id, art.artigo_id )
        and lower( ct.conta_numerofatura ) like '%' ||lower( coalesce( arg_conta_fatura, ct.conta_numerofatura ) ) ||'%'
        and ct.conta_espaco_auth = any( arg_espaco_child )
      group by
        art.artigo_id,
        _v.venda_custounitario,
        _v.venda_modalidade,
        _v.venda_tmodalidade,
        _v.venda_gmodalidade
      order by art.artigo_nome asc,
         _v.venda_modalidade
    ) select lib.jsonb_values( r,
        'artigo_codigo',
        'artigo_nome',
        'venda_quantidade',
        'venda_custounitario',
        'venda_montente',
        'venda_modalidade',
        'venda_tmodalidade',
        'venda_gmodalidade'
      )
    from report r
  ;
end;
$$;


--
-- TOC entry 847 (class 1255 OID 17121)
-- Name: funct_report_venda_conta(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_report_venda_conta(filter jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  /** Relatorio de vendas
    filter := {
      arg_data_operacao:{ start: DATE, end: DATE },
      arg_data_registro:{ start: DATE, end: DATE },
      arg_artigo_id: ID
      arg_posto_id: ID,
      arg_colaborador_vendedor: ID,
      arg_currency_pagamento: ID,
      arg_colaborador_vendedor: ID,
      arg_tpaga_id: ID,
      arg_classe_id: ID,
      arg_conta_montante: {start: START, end: END },
      arg_conta_fatura: FATURA
    }
   */

  arg_data_operacao_start date default filter->'arg_data_operacao'->>'start';
  arg_data_operacao_end date default filter->'arg_data_operacao'->>'end';

  arg_data_registro_start date default filter->'arg_data_registro'->>'start';
  arg_data_registro_end date default filter->'arg_data_registro'->>'end';

  arg_artigo_id uuid default filter->>'arg_artigo_id';
  arg_posto_id uuid default filter->>'arg_posto_id';
  arg_colaborador_vendedor uuid default filter->>'arg_colaborador_vendedor';
  arg_classe_id uuid default filter->>'arg_classe_id';
  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';
  arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );

  arg_currency_pagamento int2 default filter->>'arg_currency_pagamento';
  arg_tpaga_id int2 default filter->>'arg_tpaga_id';

  arg_conta_montante_start double precision default filter->'arg_conta_montante'->>'start';
  arg_conta_montante_end double precision default filter->'arg_conta_montante'->>'end';
  arg_conta_fatura character varying default filter->>'arg_conta_fatura';


  _const map.constant;

begin
  _const := map.constant();

  return query
    with report as (
      select
        ct.*,
        cx.*,
        pos.*,
        col.*,
        cu.*,
        tp.*,
        trim( format( '%s %s', col.colaborador_nome, col.colaborador_apelido ) ) as colaborador_nomecompleto,
        sum( ve.venda_montanteagregado ) as venda_montanteagregado,
        sum( ve.venda_montente ) as venda_montente,
        sum( ve.venda_montantetotal ) as venda_montantetotal,
        string_agg( distinct art.artigo_nome, ', ' ) as venta_artigos

      from tweeks.conta ct
        inner join tweeks.caixa cx on ct.conta_caixa_fechopagamento = cx.caixa_id
        inner join tweeks.posto pos on cx.caixa_posto_id = pos.posto_id
        inner join auth.colaborador col on ct.conta_colaborador_id = col.colaborador_id
        left join tweeks.tpaga tp on ct.conta_tpaga_id = tp.tpaga_id
        left join geoinfo.currency cu on ct.conta_currency_id = cu.currency_id
        left join tweeks.venda ve on ct.conta_id = ve.venda_conta_id
          and ve.venda_estado in ( _const.venda_estado_fechado )
        left join tweeks.artigo art on ve.venda_artigo_id = art.artigo_id

      where ct.conta_estado in ( _const.conta_estado_pago, _const.conta_estado_fechado )
        and art.artigo_id = coalesce( arg_artigo_id, art.artigo_id )
        and art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id )
        and ct.conta_data between coalesce( arg_data_operacao_start, ct.conta_data ) and coalesce( arg_data_operacao_end, ct.conta_data )
        and ct.conta_dataregistro::date between coalesce( arg_data_registro_start, ct.conta_dataregistro::date ) and coalesce( arg_data_registro_end, ct.conta_dataregistro::date )
        and cx.caixa_posto_id = coalesce( arg_posto_id, cx.caixa_posto_id )
        and cx.caixa_colaborador_id = coalesce( arg_colaborador_vendedor, cx.caixa_colaborador_id )
        and ct.conta_currency_id = coalesce( arg_currency_pagamento, ct.conta_currency_id )
        and ct.conta_tpaga_id = coalesce( arg_tpaga_id, ct.conta_tpaga_id )
        and ve.venda_montente between coalesce( arg_conta_montante_start, ve.venda_montente ) and coalesce( arg_conta_montante_end, ve.venda_montente )
        and lower( ct.conta_numerofatura ) like '%' || lower( coalesce( arg_conta_fatura, ct.conta_numerofatura ) ) || '%'
        and ct.conta_espaco_auth = any( arg_espaco_child )
      group by
        ct.conta_id,
        cx.caixa_id,
        pos.posto_id,
        col.colaborador_id,
        cu.currency_id,
        tp.tpaga_id
    )
    select jsonb_build_object(
               'header', array(
            select jsonb_build_object(
                       'key', r.currency_code,
                       'label', r.currency_code,
                       'class', 'Money',
                       'key', r.currency_code,
                       'sumRow', true
                     )
            from report r
            group by r.currency_code,
                     r.currency_name
          )
             )
    union all
    select
        lib.jsonb_values(
            to_jsonb( rp ),
            'conta_id',
            'conta_numerofatura',
            'conta_titular',
            'conta_data',
            'conta_montante',
            'conta_montanteamortizado',
            'conta_montantetroco',
            'conta_imprensa',
            'conta_dataregistro',
            'posto_id',
            'posto_designacao',
            'colaborador_nome',
            'caixa_id',
            'currency_code',
            'currency_code',
            'tpaga_designacao',
            'colaborador_nomecompleto',
            'venda_montanteagregado',
            'venda_montente',
            'venda_montantetotal',
            'venta_artigos'
          ) || jsonb_build_object (
            rp.currency_code, rp.conta_montantemoeda
          )
    from report rp
  ;
end;
$$;


--
-- TOC entry 884 (class 1255 OID 19715)
-- Name: funct_sets_autorizacao(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_sets_autorizacao(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /**
    {
      arg_colaborador_id: UID
      arg_espaco_auth: UID
      arg_autorizacao_continue: AUTORIZACAO

      autorizacao_uid: UID
      autorizacao_espaco_uid: UID
      autorizacao_designacao:DESIG
      autorizacao_numero:NUMERO,
      series: [
        {
          serie_id uuid not null,
          serie_tserie_id int2 not null,
          serie_espaco_id uuid not null,
          serie_designacao character varying not null,
          serie_numero character varying not null,
          serie_quantidade int not null,
          serie_numcertificacao,
          serie_numatorizacao
        }
      ]
    }
   */
  _autorizacao tweeks.autorizacao;
  _autorizacao_continue tweeks.autorizacao;
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _res_serie jsonb default jsonb_build_array();
  _next record;
  _data record;

begin
  _autorizacao := jsonb_populate_record( _autorizacao, args );
  _autorizacao_continue := jsonb_populate_record( _autorizacao_continue, args->'_autorizacao_continue' );
  
  if _autorizacao.autorizacao_uid is null then
    _autorizacao.autorizacao_colaborador_uid := arg_colaborador_id;
    _autorizacao.autorizacao_espaco_auth := arg_espaco_auth;
    _autorizacao._branch_uid := arg_branch_uid;
    _autorizacao.autorizacao_dataregistro := now();
    _autorizacao.autorizacao_ano := extract( years from now() );
  else
    _autorizacao.autorizacao_colaborador_atualizacao := arg_colaborador_id;
    _autorizacao.autorizacao_dataatualizacao := now();
  end if;
  
  if _autorizacao_continue.autorizacao_uid is null and exists(
    select *
      from jsonb_array_elements( args->'series' ) e ( doc )
        inner join jsonb_populate_record( null::tweeks.serie, e.doc ) sdoc on true
        inner join tweeks.serie s on sdoc.serie_numero = s.serie_numero
          and s.serie_tserie_id = sdoc.serie_tserie_id
          and s._branch_uid = arg_branch_uid
          and s.serie_espaco_auth = arg_espaco_auth
        inner join tweeks.autorizacao a on s.serie_autorizacao_uid = a.autorizacao_uid
          and a._branch_uid = arg_branch_uid
          and a.autorizacao_ano = _autorizacao.autorizacao_ano
          and a.autorizacao_espaco_auth = arg_espaco_auth
      where a.autorizacao_uid != _autorizacao_continue.autorizacao_uid
  ) then
    return lib.res_false( 'Já existe serie com essa numeração registrada' );
  end if;
  
  select ( "returning" ).* into _autorizacao
    from lib.sets( _autorizacao )
  ;
  
  for _data in (
    select
        e.document || jsonb_build_object(
          'arg_colaborador_id', arg_colaborador_id,
          'arg_espaco_auth', arg_espaco_auth,
          'serie_autorizacao_uid', _autorizacao.autorizacao_uid
        ) as document_serie
      from jsonb_array_elements( args->'series' ) e ( document )
  ) loop
    select * into _next
      from tweeks.funct_sets_serie( _data.document_serie ) e;
  
    _res_serie := _res_serie || jsonb_build_object(
      'serie', _data.document_serie,
      'result', _next
    );
  end loop;
  
  return lib.res_true( jsonb_build_object(
    'autorizacao', _autorizacao,
    'series', _res_serie
  ));
end;
$$;


--
-- TOC entry 888 (class 1255 OID 19721)
-- Name: funct_sets_autorizacao_continue(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_sets_autorizacao_continue(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /**
    {
      arg_colaborador_id: UID
      arg_espaco_auth: UID
      autorizacao_uid: UID
    }
   */
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );

  _autorizacao tweeks.autorizacao;
  _const map.constant;
  _data record;
begin
  _autorizacao := tweeks.__get_autorizacao( ( args->>'autorizacao_uid' )::uuid );
  _const := map.constant();
  with __serie as (
    select
        serie_tserie_id,
        serie_espaco_id,
        serie_designacao,
        serie_numero,
        serie_quantidade,
        serie_numcertificacao,
        serie_numatorizacao,
        case 
          when _autorizacao.autorizacao_ano = extract( years from current_date)::int then serie_sequencia
          else 0
        end serie_sequencia
      from tweeks.serie se
      where se.serie_autorizacao_uid = _autorizacao.autorizacao_uid
        and se.serie_estado = _const.maguita_serie_estado_fechado
        and se.serie_fechoautorizacao
        and se._branch_uid = arg_branch_uid
  ) select
        jsonb_agg( to_jsonb( _s ) ) as series
        into _data
      from __serie _s;

  return tweeks.funct_sets_autorizacao( jsonb_build_object(
    'arg_colaborador_id', arg_colaborador_id,
    'arg_espaco_auth', arg_espaco_auth,
    '_autorizacao_continue', _autorizacao,
    'autorizacao_uid', null,
    'autorizacao_espaco_uid', _autorizacao.autorizacao_espaco_uid,
    'autorizacao_designacao', _autorizacao.autorizacao_designacao,
    'autorizacao_numero', _autorizacao.autorizacao_numero,
    'series', _data.series
  ));
end;
$$;


--
-- TOC entry 848 (class 1255 OID 17122)
-- Name: funct_sets_branch(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_sets_branch(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args: {
       branch_uid?
       arg_colaborador_id : UID,
       arg_espaco_id : UID
       branch_tbranch_id
       branch_name
       branch_path
       branch_user := { ESTRUTURA DE CRIAÇÃO DO COLABORADOR | ESTRUTURA DE ATUALIZACAO DE COLABORADOR  }
       branch_workspace := { ESTRUTURA DE CRIAÇÃO DO ESPACO | ESTRUTURA DE ATUALIZACAO DE ESPACO  }
       branch_licence
       branch_clusters
       branch_grants : { menu: [ MENU-ID-1, MENU-ID-2, MENU-ID-3, MENU-ID-4 ] }
    }
   */
  _result record;
  _branch tweeks.branch;
  OPERATION_INSERT char default 'I';
  OPERATION_UPDATE char default 'U';
  _colaborator lib.result;
  _espaco lib.result;
  _args tweeks.branch;
  _const map.constant;
  _all_space record;
  _arg_menu_list jsonb;

  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_id uuid default args->>'arg_espaco_id';
begin
  _const := map.constant();
  _args := jsonb_populate_record( _args, args );

  if _args.branch_uid is null then
    _args.branch_user := jsonb_build_object( 'creator', _args.branch_user );
    _args.branch_workspace := jsonb_build_object( 'creator', _args.branch_workspace );
  else
    select * into _branch
    from tweeks.branch b
    where b.branch_uid = _args.branch_uid
    ;
    _args.branch_user := _branch.branch_user || jsonb_build_object( 'updater', _args.branch_user );
    _args.branch_workspace := _branch.branch_workspace || jsonb_build_object( 'updater', _args.branch_workspace );
  end if;

  select
    s.*,
    ( s."returning"::tweeks.branch).*
  into _result
  from lib.sets( _args ) s
  ;

  _branch := _result."returning";

  -- Quando um novo branch for criado
  if ( regexp_split_to_array( upper( _result.operation ), '' ) )[1] = OPERATION_INSERT then

    _espaco := tweeks.funct_reg_espaco( (_branch.branch_workspace->'creator')||jsonb_build_object(
        'arg_branch_uid', _branch.branch_uid
      ));

    if not _espaco.result then
      raise exception '%', _espaco;
    end if;

    _branch.branch_main_workspace := ( _espaco.message->'espaco'->>'espaco_id');

    _colaborator := tweeks.funct_reg_colaborador(  ( _branch.branch_user->'creator' )|| jsonb_build_object(
        'arg_branch_uid', _branch.branch_uid,
        'arg_colaborador_tipo', _const.colaborador_tipo_user_master,
        'arg_espaco', jsonb_build_array(
            jsonb_build_object( 'arg_espaco_id', _branch.branch_main_workspace )
          )
      ));

    if not _colaborator.result then
      raise exception '%', _colaborator;
    end if;

    _branch.branch_main_user :=  ( _colaborator.message->'colaborador'->>'colaborador_id');

    with __news_space as (
      select *
        from tweeks.espaco e
          left join tweeks.trabalha tr on e.espaco_id = tr.trabalha_espaco_destino
            and tr.trabalha_estado = _const.transferencia_estado_ativo
            and tr.trabalha_colaborador_proprietario = lib.to_uuid( 2 )
        where tr.trabalha_id is null
          and e.espaco_nivel <= 1
    ) insert into tweeks.trabalha(
      trabalha_espaco_destino,
      trabalha_espaco_auth,
      trabalha_colaborador_proprietario,
      trabalha_colaborador_id
    ) select
        n.espaco_id,
        lib.to_uuid( 1 ),
        lib.to_uuid( 2 ),
        lib.to_uuid( 1 )
      from __news_space n
    ;

    -- Mapear o colaborador e o espaco principal no branch
    select (  "returning" ).* into _branch
    from lib.sets_up( _branch, ref := lib.sets_ref( _branch) )
    ;
  else
    _arg_menu_list := _branch.branch_user->'updater'->'arg_menu_list';

    _colaborator := tweeks.funct_change_colaborador(  ( _branch.branch_user->'updater' )|| jsonb_build_object(
        'arg_colaborador_tipo', _const.colaborador_tipo_user_master,
        'arg_espaco', jsonb_build_array(
            jsonb_build_object( 'arg_espaco_id', _branch.branch_main_workspace )
          )
      ));

    perform auth.funct_reg_acesso(
        jsonb_build_object(
            'arg_colaborador_id', arg_colaborador_id,
            'arg_colaborador_propetario', _branch.branch_main_user,
            'arg_menu_list', _arg_menu_list,
            '_branch_uid', _branch.branch_uid
          )
      );
    _espaco  := tweeks.funct_change_espaco( _branch.branch_workspace->'updater' || jsonb_build_object(
      'xBranch', true
    ));
  end if;

  return lib.res_true( jsonb_build_object(
    'branch', _branch
    ) || coalesce( _colaborator.message, jsonb_build_object() ) || coalesce( _espaco.message, jsonb_build_object() ) );
end
$$;


--
-- TOC entry 573 (class 1255 OID 17123)
-- Name: funct_sets_fornecedor(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_sets_fornecedor(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para registar um novo fornecedor no sistema
    args := {
      arg_espaco_auth: ID
      arg_colaborador_id: ID,

      fornecedor_id: UID | NULL
      fornecedor_nif: ID,
      fornecedor_nome: NOME,
      fornecedor_email: EMAIL,
      fornecedor_contacto: CONTACTO,
      fornecedor_endereco: ENDERECO
    }
  */

  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';
  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';

  __fornecedor tweeks.fornecedor;
  _exists record;
  ___branch uuid  default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );

begin
  __fornecedor := jsonb_populate_record( __fornecedor, args );

  if __fornecedor.fornecedor_id is null then
    __fornecedor.fornecedor_espaco_auth := arg_espaco_auth;
    __fornecedor.fornecedor_colaborador_id := arg_colaborador_id;
    while __fornecedor.fornecedor_code is null loop
        __fornecedor.fornecedor_code := cluster.next( 'fornecedor/seq', lpad := 2, lpad_char := '0', sub :=  ___branch::text );
      if exists(
        select *
          from tweeks.fornecedor f
          where f.fornecedor_code = __fornecedor.fornecedor_code
            and f._branch_uid = ___branch
      ) then
        __fornecedor.fornecedor_code := null;
      end if;
    end loop;
  else
    __fornecedor.fornecedor_colaborador_atualizacao := arg_colaborador_id;
    __fornecedor.fornecedor_dataatualizacao := current_timestamp;
  end if;

  with __uniques as (
    select
        f.fornecedor_code as "CODIGO",
        f.fornecedor_nif as "NIF",
        f.fornecedor_email as "EMAIL",
        jsonb_build_object(
          'CODIGO', __fornecedor.fornecedor_code,
          'NIF', __fornecedor.fornecedor_nif,
          'EMAIL', __fornecedor.fornecedor_email
        ) as _math
      from tweeks.fornecedor f
      where f._branch_uid = ___branch
        and ( __fornecedor.fornecedor_id is null or __fornecedor.fornecedor_id != f.fornecedor_id )
  ) select lib.duplicates( jsonb_agg( _uf ), _uf._math , true ) as dulicates  into _exists
      from __uniques _uf
      group by _uf._math
  ;

  if _exists.dulicates is not null then
    return false ? format( '(%s) estão duplicados!', _exists.dulicates );
  end if;


  select ( "returning" ).* into __fornecedor
    from lib.sets( __fornecedor );

  return true ? jsonb_build_object(
    'fornecedor', __fornecedor
  );
end;
$$;


--
-- TOC entry 255 (class 1259 OID 17124)
-- Name: guia; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.guia (
    guia_uid uuid DEFAULT gen_random_uuid() NOT NULL,
    guia_toperacao_id smallint NOT NULL,
    guia_tguia_id smallint NOT NULL,
    guia_espaco_auth uuid NOT NULL,
    guia_colaborador_id uuid NOT NULL,
    guia_colaborador_atualizacao uuid,
    guia_documentoperacao character varying,
    guia_numero character varying NOT NULL,
    guia_metadata json,
    guia_dataoperacao date DEFAULT CURRENT_DATE NOT NULL,
    guia_observacao character varying,
    guia_refs jsonb,
    guia_refuid uuid,
    guia_refclass character varying,
    guia_estado smallint DEFAULT (map.get('maguita_guia_estado_ativo'::name))::smallint NOT NULL,
    guia_date timestamp with time zone DEFAULT clock_timestamp() NOT NULL,
    guia_dateupdate timestamp with time zone,
    _braunc_uid uuid,
    guia_espaco_saida uuid,
    guia_espaco_entrada uuid,
    _branch_uid uuid
);


--
-- TOC entry 574 (class 1255 OID 17133)
-- Name: funct_sets_guia(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_sets_guia(args jsonb) RETURNS tweeks.guia
    LANGUAGE plpgsql
    AS $$
declare
    /**
      args := {
        guia: tweeks.guia {
          guia_toperacao_id: TOPERACAO,
          guia_espaco_entrada: UID
          guia_espaco_saida: UID
          guia_tguia_id: TGUIA
          guia_numero: NUMERO,
          guia_metadata: { ... any data },
          guia_dataoperacao: DATE,
          guia_observacao: OBS,
          guia_refs: { },
          guia_refuid: UID
          guia_refclass: string( regclass )

        },

        //Relativos a Guia
        custoguia: tweeks.custoguia[
          custoguia_montante: MONTANTE,
          custoguia_descricao: DESCRICAO PARA O CUSTO
          custoguia_tcusto_id: 1 - DESPESA | 2 - RECEITA
        ],
        arg_colaborador_id uuid,
        arg_espaco_auth uuid
      }
     */
    _args tweeks.guia;
    arg_colaborador_id uuid default args->>'arg_colaborador_id';
    arg_espaco_auth uuid default args->>'arg_espaco_auth';
    _iNext tweeks.custoguia;
    _custoguia tweeks.custoguia;
    _const map.constant;
    _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  begin
    _const := map.constant();
    _args := jsonb_populate_record( _args, args->'guia' );

    if _args.guia_uid is null then
      
      _args.guia_numero := tweeks.__generate_guia_code( _branch, _args.guia_toperacao_id );
      _args._braunc_uid := _branch;
      _args.guia_espaco_auth := arg_espaco_auth;
      _args.guia_colaborador_id := arg_colaborador_id;

      select ( "returning" ).* into _args
        from lib.sets_in( _args )
      ;
      for _iNext in
        select cg.*
          from jsonb_array_elements( args->'custoguia' ) e( doc )
            inner join jsonb_populate_record( null::tweeks.custoguia, e.doc ) cg on true
      loop
        _iNext.custoguia_colaborador_id := arg_colaborador_id;
        _iNext.custoguia_espaco_auth := arg_espaco_auth;
        _iNext.custoguia_guia_uid := _args.guia_uid;
        _iNext._branch_uid := _branch;
        select ( "returning" ).* into _custoguia
          from lib.sets_in( _iNext );
      end loop;
    else
      _args._braunc_uid := _branch;
      _args.guia_colaborador_atualizacao := arg_colaborador_id;
      _args.guia_dateupdate := arg_colaborador_id;

      select ( "returning" ).* into _args
        from lib.sets_up( _args )
      ;
      update tweeks.custoguia
        set custoguia_estado = _const.maguita_custoguia_estado_canselado,
            custoguia_dateupdate = clock_timestamp(),
            custoguia_colaborador_atualizacao = arg_colaborador_id
        where custoguia_guia_uid = _args.guia_uid
          and custoguia_estado = _const.maguita_custoguia_estado_ativo
      ;

      for _iNext in
        select cg.*
          from jsonb_array_elements( args->'custoguia' ) e( doc )
            inner join jsonb_populate_record( null::tweeks.custoguia, e.doc ) cg on true
        loop
          _iNext.custoguia_guia_uid := _args.guia_uid;
          _iNext.custoguia_colaborador_id := arg_colaborador_id;
          _iNext.custoguia_dateupdate := clock_timestamp();
          select ( "returning" ).* into _custoguia
          from lib.sets_in( _iNext );
        end loop;
    end if;

    return _args;
  end;
$$;


--
-- TOC entry 849 (class 1255 OID 17134)
-- Name: funct_sets_serie(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_sets_serie(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /**
    args := {
      arg_colaborador_id uuid not null,
      arg_espaco_auth uuid not null,

      serie_id uuid not null,
      serie_tserie_id int2 not null,
      serie_espaco_id uuid not null,
      serie_designacao character varying not null,
      serie_numero character varying not null,
      serie_quantidade int not null,
      serie_numcertificacao,
      serie_numatorizacao
    }
   */

  _serie tweeks.serie;
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );
  _const map.constant;
begin
  _const := map.constant();
  _serie := jsonb_populate_record( _serie, args );

  if _serie.serie_id is null then
    _serie.serie_colaborador_id := arg_colaborador_id;
    _serie.serie_espaco_auth := arg_espaco_auth;

    -- Desativar as serie ativa para o espaçoa
    update tweeks.serie
      set serie_estado = _const.maguita_serie_estado_fechado,
          serie_colaborador_atualizacao = arg_colaborador_id,
          serie_dataatualizacao = current_timestamp
      where serie_tserie_id = _serie.serie_tserie_id
        and serie_espaco_id = _serie.serie_espaco_id
        and _branch_uid = ___branch
        and serie_estado = _const.maguita_serie_estado_ativo
    ;
  else
    _serie.serie_colaborador_atualizacao := arg_colaborador_id;
    _serie.serie_dataatualizacao := current_timestamp;
  end if;


  -- Quando for registrar nova serie
  select ( "returning" ).* into _serie
    from lib.sets( _serie );

  return lib.res_true(jsonb_build_object(
    'serie', _serie
  ));
end;
$$;


--
-- TOC entry 901 (class 1255 OID 19825)
-- Name: funct_sets_unit(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.funct_sets_unit(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$ 
declare
  /**doc
    Sets unit
    args := {
        _espaco_auth
        _user_id
        unit_id? ,
        unit_code,
        unit_name,
        unit_state?
    }
  doc*/
  _espaco_auth uuid not null default args->>'_espaco_auth';
  _user_id uuid not null default args->>'_user_id';
  _branch uuid default tweeks.__branch_uid( _user_id, _espaco_auth );
  _args tweeks.unit;
  _unit tweeks.unit;
begin
  
  _args := jsonb_populate_record( _args, args );
  if _args.unit_id is null then 
    _args.unit_user_id := _user_id;
    _args.unit_espaco_auth := _espaco_auth;
    _args._branch_uid := _branch;
  else
    _args.unit_update := clock_timestamp();
    _args.unit_user_update := _user_id;
  end if;
  
  -- Garantir que o codigo da unidade não se repita
  if _args.unit_id is null and exists(
    select *
      from tweeks.unit u 
      where u._branch_uid = _args._branch_uid
        and lower( trim( u.unit_code ) )  = lower( trim( _args.unit_code ) )
  ) then
    return lib.res_false( 'Já existe uma unidade com o código selecionado!' );
  end if;
  
  select ( "returning").* into _unit
    from lib.sets( _args )
  ;
  
  return lib.res_true( jsonb_build_object(
    'unit', _unit
  ));
end;
$$;


--
-- TOC entry 851 (class 1255 OID 19511)
-- Name: load_clusters(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.load_clusters(args jsonb) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $$
declare
  _const map.constant;
begin
  _const := map.constant();
  return query with
    __cluster as (
      select
          c.cluster_uid,
          c.cluster_identifier,
          c.cluster_type,
          c.cluster_code,
          c.cluster_path,
          c.cluster_domain,
          c.cluster_licenselife,
          c.cluster_license,
          case
            when c.cluster_name is null and c.cluster_type = _const.cluster_tcluster_local then 'Local server'
            else c.cluster_name
          end as cluster_name,
          c.cluster_port,
          c.cluster_api,
          c.cluster_version,
          c.cluster_grants,
          c.cluster_configs,
          c.cluster_sequence,
          c.cluster_namespace,
          tp.*
        from cluster.cluster c
          left join cluster.tperiod tp on c.cluster_tperiod_id = tp.tperiod_id
    ) select to_jsonb( _c )
      from __cluster _c
      order by case
        when _c.cluster_type = _const.cluster_tcluster_local then 1
        when _c.cluster_type = _const.cluster_tcluster_master then 2
        when _c.cluster_type = _const.cluster_tcluster_child then 3
        when _c.cluster_type = _const.cluster_tcluster_remote then 4
      end,
      _c.cluster_name
  ;
end;
$$;


--
-- TOC entry 790 (class 1255 OID 17135)
-- Name: main(regproc, jsonb, text); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.main(function regproc, args jsonb, mode text DEFAULT 'dev'::text) RETURNS SETOF jsonb
    LANGUAGE plpgsql
    AS $_$
declare
  MODE_PROD constant text default 'prod';
  MODE_TEST constant text default 'test';
  MODE_DEV constant text default 'dev';
  MODE_PUB constant text default 'public';
  _statement text;
begin

  --language=PostgreSQL
  _statement := format( $sql$
      select to_jsonb( t )
        from %s ( $1 ) t;
  $sql$, function );

  -- Mode DEV don't try-catch error
  if mode = MODE_DEV then
    return query execute _statement using args;


  -- Mode PROD and TEST try-catch error
  else
    begin
      return query execute _statement using args;

    exception when others then
      <<_ex>>
      declare
        e text; m text; d text; h text; c text;
        _catch lib.res;
      begin
        get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
        _catch :=  lib.res_exception( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c,
        case
          when mode in( MODE_PROD, MODE_PUB ) then format( 'Algo deu mal, tente novamente mais tarde ou proucure pelo suporte! Error Code: (%s)', _ex.e )
          when mode = MODE_TEST then _ex.m
          else _ex.m
          end
        );
        return next to_jsonb( _catch );
      end;
    end;
  end if;
end;
$_$;


--
-- TOC entry 571 (class 1255 OID 17136)
-- Name: sets_lancamento(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.sets_lancamento(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /*
    arg_espaco_auth?:UUID
    arg_colaborador_id?:UUID

    lancamento_id?: UID
    arg_lancamento_incrementevia:BOOLEAN

    lancamento_tlancamento_id: SELECT*
    _tgrupo_id [{ maguita_tgrupo_ccorrente | maguita_tgrupo_cnormal }] default maguita_tgrupo_ccorrente
    lancamento_operacao := CREDITO => 1 | DEBITO => -1;
    lancamento_valor := _deposito.deposito_montantefinal;
    lancamento_cliente_id*
    lancamento_data := DATE;
    lancamento_documento?: DOCUMENTO;
    lancamento_descricao: DESCRICAO
   */
  _const map.constant;
  _lancamento tweeks.lancamento;

  arg_espaco_auth uuid default args->>'arg_espaco_auth';
  arg_colaborador_id uuid default args->>'arg_colaborador_id';
  arg_lancamento_incrementevia uuid default args->>'arg_lancamento_incrementevia';
begin

  _const := map.constant();
  _lancamento := jsonb_populate_record( _lancamento, args );
  _lancamento._tgrupo_id := coalesce( _lancamento._tgrupo_id, _const.maguita_tgrupo_ccorrente );

  if _lancamento.lancamento_id is null then
    _lancamento.lancamento_mode := _const.maguita_lancamento_mode_manual;
    _lancamento.lancamento_espaco_auth := coalesce( _lancamento.lancamento_espaco_auth, arg_espaco_auth );
    _lancamento.lancamento_colaborador_id := coalesce( _lancamento.lancamento_colaborador_id, arg_colaborador_id );
    _lancamento.lancamento_referencia := jsonb_build_object();
    _lancamento._branch_uid := coalesce( _lancamento._branch_uid, tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ) );
  else
    _lancamento.lancamento_colaborador_atualizacao := arg_colaborador_id;
    _lancamento.lancamento_dataatualizacao := now();
    if arg_lancamento_incrementevia then
      _lancamento.lancamento_via := coalesce( _lancamento.lancamento_via, 1)+1;
    end if;
  end if;

  select ( "returning" ).* into _lancamento
    from lib.sets( _lancamento )
  ;

  return lib.res_true(jsonb_build_object(
    '_lancamento', _lancamento
  ));
end;
$$;


--
-- TOC entry 906 (class 1255 OID 19857)
-- Name: sets_parametrizacao(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.sets_parametrizacao(args jsonb) RETURNS lib.res
    LANGUAGE plpgsql
    AS $$
declare
  /**doc
    args := {
      arg_colaborador_id:UID
      arg_espaco_auth: UID,
      parametrizacao_uid?
      parametrizacao_props
      parametrizacao_tags* varchar[],
      parametrizacao_estado?
    }
   doc*/
  _user_id uuid not null default args->>'arg_colaborador_id';
  _espaco_auth uuid not null default args->>'arg_espaco_auth';
  ___branch uuid default tweeks.__branch_uid( _user_id, _espaco_auth );
  _const map.constant;
  _parametrizacao tweeks.parametrizacao;
begin
  _const := map.constant();
  _parametrizacao := jsonb_populate_record( _parametrizacao, args );
  
  if _parametrizacao.parametrizacao_uid is null then
    _parametrizacao.parametrizacao_user_uid := _user_id;
    _parametrizacao.parametrizacao_espaco_auth := _espaco_auth;
    _parametrizacao._branch_uid := ___branch;
  else 
    _parametrizacao.parametrizacao_user_update := _user_id;
    _parametrizacao.parametrizacao_dateupdate := clock_timestamp();
  end if;
  
  select ( "returning" ).* 
    from lib.sets( _parametrizacao )
    into _parametrizacao
  ;
  
  return lib.res_true( jsonb_build_object(
    'parametrizacao', _parametrizacao
  ));
end;
$$;


--
-- TOC entry 850 (class 1255 OID 17137)
-- Name: sets_tipoimposto(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.sets_tipoimposto(args jsonb) RETURNS lib.result
    LANGUAGE plpgsql
    AS $$
declare
  /**
    Essa função serve para registar os tipos de imposto
    args := {
      arg_colaborador_id: ID,
      arg_espaco_auth: ID,
      arg_links :[ { arg_espaco_destino: ID  } ]

      tipoimposto_id
      tipoimposto_nome: NOME,
      tipoimposto_codigo: CODIGO,
      taxa_taxa: VALOR,
      taxa_percentagem: PERCENTAGEM,

    }
   */

  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';
  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';


  arg_tipoimposto_codigo character varying not null default args->>'tipoimposto_codigo';
  arg_taxa_percentagem double precision default args->>'taxa_percentagem';
  arg_taxa_taxa double precision default args->>'taxa_taxa';
  arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth );
  _tipoimposto tweeks.tipoimposto;
begin
  arg_tipoimposto_codigo := lib.str_normalize( upper( public.unaccent( arg_tipoimposto_codigo ) ) );

  _tipoimposto := jsonb_populate_record( _tipoimposto, args );

  if (
    select count( * ) > 0
      from tweeks.tipoimposto tip
      where tip.tipoimposto_espaco_auth = any( arg_espaco_child )
        and tip.tipoimposto_id != coalesce( _tipoimposto.tipoimposto_id, lib.to_uuid( 0 ) )
        and lib.str_normalize( upper( public.unaccent( tip.tipoimposto_codigo ) ) ) = arg_tipoimposto_codigo
  ) then
    return false ? '@tweeks.tipoimposto.codigo-already-exist';
  end if;

  if _tipoimposto.tipoimposto_id is null then
    _tipoimposto.tipoimposto_colaborador_id := arg_colaborador_id;
    _tipoimposto.tipoimposto_espaco_auth := arg_espaco_auth;
  else
    _tipoimposto.tipoimposto_colaborador_atualizacao := arg_colaborador_id;
    _tipoimposto.tipoimposto_dataatuzaliacao := now();
  end if;

  select ( "returning" ).* into _tipoimposto
    from lib.sets( _tipoimposto, args );

  perform tweeks.funct_reg_taxa(
    jsonb_build_object(
      'arg_espaco_auth', arg_espaco_auth,
      'arg_colaborador_id', arg_colaborador_id,
      'arg_tipoimposto_id', _tipoimposto.tipoimposto_id,
      'arg_taxa_percentagem', arg_taxa_percentagem,
      'arg_taxa_taxa', arg_taxa_taxa
    )
  );

  perform tweeks.funct_reg_link_associacao(
    jsonb_build_object(
      'arg_colaborador_id', arg_colaborador_id,
      'arg_espaco_auth', arg_espaco_auth,
      'arg_link_nome', _tipoimposto.tipoimposto_nome,
      'arg_link_referencia', jsonb_build_object( 'tipoimposto_id', _tipoimposto.tipoimposto_id ),
      'arg_links', args->'arg_links'
    )
  );

  return true ? jsonb_build_object(
    'tipoimposto', _tipoimposto
  );

exception  when others then
  <<_ex>> declare e text; m text; d text; h text; c text;
  begin
    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;
    return lib.result_catch( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );
  end;
end;
$$;


--
-- TOC entry 502 (class 1255 OID 19575)
-- Name: viewarg(text); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.viewarg(argname text) RETURNS text
    LANGUAGE sql IMMUTABLE STRICT PARALLEL SAFE
    AS $$
  select jsonb_build_object( 'value', current_setting( format( 'viewargs.%I', argname ), true)::jsonb )->>'value'
$$;


--
-- TOC entry 504 (class 1255 OID 19577)
-- Name: viewargs_object(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.viewargs_object() RETURNS jsonb
    LANGUAGE sql IMMUTABLE PARALLEL SAFE
    AS $$
  select
      jsonb_object_agg(
        substr(e.param, length('viewargs.*'), length( e.param )),
        current_setting( e.param, true )::jsonb
      )
    from jsonb_array_elements_text( current_setting( 'viewargs.*', true )::jsonb )  e( param)
$$;


--
-- TOC entry 501 (class 1255 OID 19574)
-- Name: viewargs_set(text, anyelement); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.viewargs_set(key text, element anyelement) RETURNS TABLE(param text, value jsonb, text text)
    LANGUAGE sql
    AS $$
  select *
    from tweeks.viewargs_sets( jsonb_build_object( key, element ));
$$;


--
-- TOC entry 863 (class 1255 OID 19573)
-- Name: viewargs_sets(jsonb); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.viewargs_sets(jsonb) RETURNS TABLE(param text, value jsonb, text text)
    LANGUAGE plpgsql
    AS $_$
  declare
    _record record;
    _keys jsonb;
  begin

    _keys := coalesce( current_setting( 'viewargs.*', true )::jsonb, jsonb_build_array());
    select coalesce(jsonb_agg( k.param ), jsonb_build_array()) into _keys
      from jsonb_array_elements_text( _keys ) k( param)
      where k.param != all( array( select format('viewargs.%I',  e ) from jsonb_object_keys( $1) e))
    ;
    
    for _record in
      select *
        from jsonb_each( $1 )
    loop
      viewargs_sets.param := format('viewargs.%I', _record.key );
      viewargs_sets.text := _record.value;
      viewargs_sets.value := _record.value;
      _keys := _keys || to_jsonb( viewargs_sets.param );
      perform set_config( viewargs_sets.param, viewargs_sets.text, false );
      return next;
    end loop;

    viewargs_sets.param := 'viewargs.*';
    viewargs_sets.text := to_jsonb( _keys );
    viewargs_sets.value := to_jsonb( _keys );
    perform set_config( viewargs_sets.param, viewargs_sets.text, false );
    return next;
  end;
$_$;


--
-- TOC entry 503 (class 1255 OID 19576)
-- Name: viewargs_show(); Type: FUNCTION; Schema: tweeks; Owner: -
--

CREATE FUNCTION tweeks.viewargs_show(OUT param text, OUT key text, OUT value jsonb, OUT text text) RETURNS SETOF record
    LANGUAGE sql IMMUTABLE PARALLEL SAFE
    AS $$
  select
      e.param,
      substr(e.param, length('viewargs.*'), length( e.param )),
      current_setting( e.param, true )::jsonb,
      jsonb_build_object( 'value', current_setting( e.param, true )::jsonb )->>'value'
    from jsonb_array_elements_text( current_setting( 'viewargs.*', true )::jsonb ) e( param)
$$;


--
-- TOC entry 1927 (class 1255 OID 17138)
-- Name: first(anyelement); Type: AGGREGATE; Schema: lib; Owner: -
--

CREATE AGGREGATE lib.first(anyelement) (
    SFUNC = lib.agg_first,
    STYPE = anyelement
);


--
-- TOC entry 1928 (class 1255 OID 17139)
-- Name: last(anyelement); Type: AGGREGATE; Schema: lib; Owner: -
--

CREATE AGGREGATE lib.last(anyelement) (
    SFUNC = lib.agg_last,
    STYPE = anyelement
);


--
-- TOC entry 2728 (class 2617 OID 17140)
-- Name: -; Type: OPERATOR; Schema: public; Owner: -
--

CREATE OPERATOR public.- (
    FUNCTION = lib.result_remove,
    LEFTARG = lib.result,
    RIGHTARG = text
);


--
-- TOC entry 2729 (class 2617 OID 17141)
-- Name: -; Type: OPERATOR; Schema: public; Owner: -
--

CREATE OPERATOR public.- (
    FUNCTION = lib.result_remove,
    LEFTARG = lib.result,
    RIGHTARG = integer
);


--
-- TOC entry 2730 (class 2617 OID 17142)
-- Name: ?; Type: OPERATOR; Schema: public; Owner: -
--

CREATE OPERATOR public.? (
    FUNCTION = lib.result,
    LEFTARG = boolean,
    RIGHTARG = text
);


--
-- TOC entry 2731 (class 2617 OID 17143)
-- Name: ?; Type: OPERATOR; Schema: public; Owner: -
--

CREATE OPERATOR public.? (
    FUNCTION = lib.result,
    LEFTARG = boolean,
    RIGHTARG = jsonb
);


--
-- TOC entry 2732 (class 2617 OID 17144)
-- Name: ||; Type: OPERATOR; Schema: public; Owner: -
--

CREATE OPERATOR public.|| (
    FUNCTION = lib.result_concat,
    LEFTARG = lib.result,
    RIGHTARG = jsonb
);


--
-- TOC entry 2733 (class 2617 OID 17145)
-- Name: ||; Type: OPERATOR; Schema: public; Owner: -
--

CREATE OPERATOR public.|| (
    FUNCTION = lib.result_concat,
    LEFTARG = lib.result,
    RIGHTARG = lib.result
);


--
-- TOC entry 2734 (class 2617 OID 17146)
-- Name: ||; Type: OPERATOR; Schema: public; Owner: -
--

CREATE OPERATOR public.|| (
    FUNCTION = lib.result_remove,
    LEFTARG = lib.result,
    RIGHTARG = integer
);


--
-- TOC entry 2735 (class 2617 OID 17147)
-- Name: ||; Type: OPERATOR; Schema: public; Owner: -
--

CREATE OPERATOR public.|| (
    FUNCTION = lib.result_remove,
    LEFTARG = lib.result,
    RIGHTARG = text
);


--
-- TOC entry 256 (class 1259 OID 17148)
-- Name: acesso; Type: TABLE; Schema: auth; Owner: -
--

CREATE TABLE auth.acesso (
    acesso_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    acesso_menu_id smallint NOT NULL,
    acesso_colaborador_propetario uuid NOT NULL,
    acesso_colaborador_id uuid NOT NULL,
    acesso_colaborador_atualizacao uuid,
    acesso_estado smallint DEFAULT (map.get('acesso_estado_ativo'::name))::smallint NOT NULL,
    acesso_dataregisto timestamp with time zone DEFAULT now() NOT NULL,
    acesso_dataatualizacao timestamp with time zone,
    _branch_uid uuid
);


--
-- TOC entry 6209 (class 0 OID 0)
-- Dependencies: 256
-- Name: TABLE acesso; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON TABLE auth.acesso IS 'Essa entidade serve para armazenar os acessos dos colaboradores a um dado menu';


--
-- TOC entry 6210 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN acesso.acesso_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.acesso.acesso_id IS 'Identificador do acesso do colaborador';


--
-- TOC entry 6211 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN acesso.acesso_menu_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.acesso.acesso_menu_id IS 'Identificacão do menu a qual o acesso remete';


--
-- TOC entry 6212 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN acesso.acesso_colaborador_propetario; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.acesso.acesso_colaborador_propetario IS 'Indenticação do colaborador a quel é o propetario do refererido acesso';


--
-- TOC entry 6213 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN acesso.acesso_colaborador_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.acesso.acesso_colaborador_id IS 'Identificação do colaborador a qual cadastrou o acesso';


--
-- TOC entry 6214 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN acesso.acesso_colaborador_atualizacao; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.acesso.acesso_colaborador_atualizacao IS 'Identificador do último colaborador atualizando a informação do acesso';


--
-- TOC entry 6215 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN acesso.acesso_estado; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.acesso.acesso_estado IS 'O atual estado do acesso | estado = { 1 - Acesso pemitido, 0 - Acesso revigado }';


--
-- TOC entry 6216 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN acesso.acesso_dataregisto; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.acesso.acesso_dataregisto IS 'A data em que o acesso ao menu foi ao colaborador propetario dado';


--
-- TOC entry 6217 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN acesso.acesso_dataatualizacao; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.acesso.acesso_dataatualizacao IS 'A data em que o menu foi revogado do colaborador!';


--
-- TOC entry 257 (class 1259 OID 17154)
-- Name: autenticacao; Type: TABLE; Schema: auth; Owner: -
--

CREATE TABLE auth.autenticacao (
    autenticacao_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    autenticacao_colaborador_id uuid NOT NULL,
    autenticacao_chave character varying NOT NULL,
    autenticacao_estado smallint DEFAULT (map.get('autenticacao_estado_ativo'::name))::smallint,
    autenticacao_dataregisto timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    autenticacao_dataatualizacao timestamp with time zone
);


--
-- TOC entry 6219 (class 0 OID 0)
-- Dependencies: 257
-- Name: TABLE autenticacao; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON TABLE auth.autenticacao IS 'Essa entidade serve para armazenar as autenticacoes que um colaborador vai passadno';


--
-- TOC entry 6220 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN autenticacao.autenticacao_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.autenticacao.autenticacao_id IS 'Identificador da autenticacao';


--
-- TOC entry 6221 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN autenticacao.autenticacao_colaborador_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.autenticacao.autenticacao_colaborador_id IS 'Identificacao do colaborador que autenticou';


--
-- TOC entry 6222 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN autenticacao.autenticacao_chave; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.autenticacao.autenticacao_chave IS 'Corresponde a chave da autenticação';


--
-- TOC entry 6223 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN autenticacao.autenticacao_estado; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.autenticacao.autenticacao_estado IS 'Corresponde ao estado da autenticação
<ul>
  <li> 1 - Ativo </li>
  <li> 0 - Fechadao </li>
</ul>
  ';


--
-- TOC entry 6224 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN autenticacao.autenticacao_dataregisto; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.autenticacao.autenticacao_dataregisto IS 'Corresponde a data em que a autenticação foi efetuada';


--
-- TOC entry 6225 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN autenticacao.autenticacao_dataatualizacao; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.autenticacao.autenticacao_dataatualizacao IS 'Corresponde a data da última atualização da autenticação ( data de logoff )';


--
-- TOC entry 258 (class 1259 OID 17162)
-- Name: privilegio; Type: TABLE; Schema: auth; Owner: -
--

CREATE TABLE auth.privilegio (
    privilegio_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    previlegio_perfil_id uuid NOT NULL,
    privilegio_menu_id smallint NOT NULL,
    privilegio_colaborador_id uuid NOT NULL,
    privilegio_colaborador_atualizacao uuid,
    privilegio_estado smallint DEFAULT (map.get('privilegio_estado_ativo'::name))::smallint NOT NULL,
    privilegio_dataregisto timestamp with time zone DEFAULT now() NOT NULL,
    privilegio_dataatualuzacao timestamp with time zone
);


--
-- TOC entry 6227 (class 0 OID 0)
-- Dependencies: 258
-- Name: TABLE privilegio; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON TABLE auth.privilegio IS 'Esse entidade mapeia os menus a que um perfil tem previlegio de aceder';


--
-- TOC entry 6228 (class 0 OID 0)
-- Dependencies: 258
-- Name: COLUMN privilegio.privilegio_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.privilegio.privilegio_id IS 'Identificador único do privilegio';


--
-- TOC entry 6229 (class 0 OID 0)
-- Dependencies: 258
-- Name: COLUMN privilegio.previlegio_perfil_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.privilegio.previlegio_perfil_id IS 'Identificador do perfil com o privilégio';


--
-- TOC entry 6230 (class 0 OID 0)
-- Dependencies: 258
-- Name: COLUMN privilegio.privilegio_menu_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.privilegio.privilegio_menu_id IS 'Identificador do menu ao qual o perfil tem o privilégio de aceder';


--
-- TOC entry 6231 (class 0 OID 0)
-- Dependencies: 258
-- Name: COLUMN privilegio.privilegio_colaborador_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.privilegio.privilegio_colaborador_id IS 'Identificador do colaborador responsável pela atribuição do privelégio';


--
-- TOC entry 6232 (class 0 OID 0)
-- Dependencies: 258
-- Name: COLUMN privilegio.privilegio_colaborador_atualizacao; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.privilegio.privilegio_colaborador_atualizacao IS 'Identificador do colaborador responsável pela atualização do privilégio | colaborador que revogou o privelégio do menu ao perfil';


--
-- TOC entry 6233 (class 0 OID 0)
-- Dependencies: 258
-- Name: COLUMN privilegio.privilegio_estado; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.privilegio.privilegio_estado IS 'Corresponde ao estado do privilégio
<ul>
  <li> 1 - Ativo | Siginifica que o perfil ainda possui privelegio ao menu </li>
  <li> 0 - Fechado | Significa que o perfil perdeu o privilégio ao menu </li>
</ul>';


--
-- TOC entry 6234 (class 0 OID 0)
-- Dependencies: 258
-- Name: COLUMN privilegio.privilegio_dataregisto; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.privilegio.privilegio_dataregisto IS 'Corresponde ao instante exato em que o privilégio foi definido no sistema';


--
-- TOC entry 6235 (class 0 OID 0)
-- Dependencies: 258
-- Name: COLUMN privilegio.privilegio_dataatualuzacao; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.privilegio.privilegio_dataatualuzacao IS 'Corresponde ao último instante em que o privilegio foi atualizado no sistema | momento em que foi desativo';


--
-- TOC entry 259 (class 1259 OID 17168)
-- Name: session; Type: TABLE; Schema: auth; Owner: -
--

CREATE TABLE auth.session (
    sid character varying NOT NULL,
    sess json NOT NULL,
    expire timestamp(6) without time zone NOT NULL
);


--
-- TOC entry 260 (class 1259 OID 17173)
-- Name: tsexo; Type: TABLE; Schema: auth; Owner: -
--

CREATE TABLE auth.tsexo (
    tsexo_id smallint NOT NULL,
    tsexo_nome character varying NOT NULL,
    tsexo_codigo character(1) NOT NULL,
    CONSTRAINT ck_tsexo_codigo_valid CHECK (((tsexo_codigo)::text = upper((tsexo_codigo)::text)))
);


--
-- TOC entry 6238 (class 0 OID 0)
-- Dependencies: 260
-- Name: TABLE tsexo; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON TABLE auth.tsexo IS 'Essa entidade serve para armazenar os sexos do colaboradores';


--
-- TOC entry 6239 (class 0 OID 0)
-- Dependencies: 260
-- Name: COLUMN tsexo.tsexo_id; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.tsexo.tsexo_id IS 'Identificador único do sexo do colaborador';


--
-- TOC entry 6240 (class 0 OID 0)
-- Dependencies: 260
-- Name: COLUMN tsexo.tsexo_nome; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.tsexo.tsexo_nome IS 'Corresponde ao nome do sexo';


--
-- TOC entry 6241 (class 0 OID 0)
-- Dependencies: 260
-- Name: COLUMN tsexo.tsexo_codigo; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON COLUMN auth.tsexo.tsexo_codigo IS 'Corresponde ao codigo do sexo do colaboarador';


--
-- TOC entry 357 (class 1259 OID 19550)
-- Name: auth; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.auth (
    auth_uid uuid DEFAULT gen_random_uuid() NOT NULL,
    auth_seq bigint NOT NULL,
    auth_key character varying DEFAULT lib.dset_random_text(128),
    auth_cluster_uid uuid,
    auth_date timestamp with time zone DEFAULT now() NOT NULL,
    auth_status smallint DEFAULT 1 NOT NULL,
    auth_close timestamp with time zone
);


--
-- TOC entry 356 (class 1259 OID 19549)
-- Name: auth_auth_seq_seq; Type: SEQUENCE; Schema: cluster; Owner: -
--

CREATE SEQUENCE cluster.auth_auth_seq_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6243 (class 0 OID 0)
-- Dependencies: 356
-- Name: auth_auth_seq_seq; Type: SEQUENCE OWNED BY; Schema: cluster; Owner: -
--

ALTER SEQUENCE cluster.auth_auth_seq_seq OWNED BY cluster.auth.auth_seq;


--
-- TOC entry 261 (class 1259 OID 17179)
-- Name: break; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.break (
    break_uid uuid DEFAULT gen_random_uuid() NOT NULL,
    break_collector jsonb,
    break_object jsonb,
    break_old jsonb,
    break_regclass character varying,
    break_origin uuid,
    break_receiver uuid,
    break_date timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    break_instant timestamp with time zone DEFAULT clock_timestamp() NOT NULL,
    break_status smallint DEFAULT (map.get('cluster_break_status_pendent'::name))::smallint NOT NULL,
    break_sqlstate text,
    break_message text,
    break_detail text,
    break_hint text,
    break_context text,
    break_ref jsonb,
    break_metadata jsonb,
    break_change jsonb,
    break_current jsonb,
    break_document jsonb
);


--
-- TOC entry 358 (class 1259 OID 19603)
-- Name: classmap; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.classmap (
    classname character varying NOT NULL,
    classnameref character varying NOT NULL,
    status integer DEFAULT 1 NOT NULL
);


--
-- TOC entry 262 (class 1259 OID 17188)
-- Name: collector_collector_sequence_seq; Type: SEQUENCE; Schema: cluster; Owner: -
--

CREATE SEQUENCE cluster.collector_collector_sequence_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6245 (class 0 OID 0)
-- Dependencies: 262
-- Name: collector_collector_sequence_seq; Type: SEQUENCE OWNED BY; Schema: cluster; Owner: -
--

ALTER SEQUENCE cluster.collector_collector_sequence_seq OWNED BY cluster.collector.collector_sequence;


--
-- TOC entry 263 (class 1259 OID 17189)
-- Name: filter; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.filter (
    filter_id integer NOT NULL,
    filter_regclass character varying,
    filter_regproc character varying NOT NULL,
    filter_sequence integer NOT NULL,
    filter_name character varying,
    filter_describe text
);


--
-- TOC entry 264 (class 1259 OID 17194)
-- Name: filter_filter_id_seq; Type: SEQUENCE; Schema: cluster; Owner: -
--

CREATE SEQUENCE cluster.filter_filter_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6248 (class 0 OID 0)
-- Dependencies: 264
-- Name: filter_filter_id_seq; Type: SEQUENCE OWNED BY; Schema: cluster; Owner: -
--

ALTER SEQUENCE cluster.filter_filter_id_seq OWNED BY cluster.filter.filter_id;


--
-- TOC entry 265 (class 1259 OID 17195)
-- Name: filter_filter_sequence_seq; Type: SEQUENCE; Schema: cluster; Owner: -
--

CREATE SEQUENCE cluster.filter_filter_sequence_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6250 (class 0 OID 0)
-- Dependencies: 265
-- Name: filter_filter_sequence_seq; Type: SEQUENCE OWNED BY; Schema: cluster; Owner: -
--

ALTER SEQUENCE cluster.filter_filter_sequence_seq OWNED BY cluster.filter.filter_sequence;


--
-- TOC entry 266 (class 1259 OID 17196)
-- Name: ignore; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.ignore (
    origin character varying NOT NULL,
    object uuid NOT NULL,
    collector uuid NOT NULL,
    transaction uuid NOT NULL
);


--
-- TOC entry 267 (class 1259 OID 17201)
-- Name: object_object_seq_seq; Type: SEQUENCE; Schema: cluster; Owner: -
--

CREATE SEQUENCE cluster.object_object_seq_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6253 (class 0 OID 0)
-- Dependencies: 267
-- Name: object_object_seq_seq; Type: SEQUENCE OWNED BY; Schema: cluster; Owner: -
--

ALTER SEQUENCE cluster.object_object_seq_seq OWNED BY cluster.object.object_seq;


--
-- TOC entry 268 (class 1259 OID 17202)
-- Name: object_object_sseq_seq; Type: SEQUENCE; Schema: cluster; Owner: -
--

CREATE SEQUENCE cluster.object_object_sseq_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6255 (class 0 OID 0)
-- Dependencies: 268
-- Name: object_object_sseq_seq; Type: SEQUENCE OWNED BY; Schema: cluster; Owner: -
--

ALTER SEQUENCE cluster.object_object_sseq_seq OWNED BY cluster.object.object_sseq;


--
-- TOC entry 360 (class 1259 OID 19615)
-- Name: pull; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.pull (
    pull_uid uuid DEFAULT gen_random_uuid() NOT NULL,
    pull_server jsonb NOT NULL,
    pull_objects jsonb NOT NULL,
    pull_ignores jsonb,
    pull_result jsonb,
    pull_total bigint,
    pull_limit bigint,
    pull_revcode character varying,
    pull_rejected integer,
    pull_sequence bigint NOT NULL,
    pull_instant timestamp with time zone DEFAULT clock_timestamp(),
    pull_status smallint DEFAULT 2,
    pull_pulled jsonb,
    pull_finalize timestamp without time zone
);


--
-- TOC entry 359 (class 1259 OID 19614)
-- Name: pull_pull_sequence_seq; Type: SEQUENCE; Schema: cluster; Owner: -
--

CREATE SEQUENCE cluster.pull_pull_sequence_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6257 (class 0 OID 0)
-- Dependencies: 359
-- Name: pull_pull_sequence_seq; Type: SEQUENCE OWNED BY; Schema: cluster; Owner: -
--

ALTER SEQUENCE cluster.pull_pull_sequence_seq OWNED BY cluster.pull.pull_sequence;


--
-- TOC entry 269 (class 1259 OID 17203)
-- Name: sequence; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.sequence (
    name character varying NOT NULL,
    sub character varying NOT NULL,
    sequence bigint DEFAULT 0 NOT NULL,
    steep integer NOT NULL,
    lpad integer DEFAULT 0 NOT NULL,
    lpad_char character(1) DEFAULT ''::bpchar NOT NULL,
    zerobase boolean DEFAULT false NOT NULL
);


--
-- TOC entry 270 (class 1259 OID 17212)
-- Name: share; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.share (
    share_regclass character varying NOT NULL,
    share_insert boolean DEFAULT true NOT NULL,
    share_update boolean DEFAULT true NOT NULL,
    share_checker regprocedure,
    share_triggers name[],
    share_pks name[],
    share_pksfrom character varying,
    CONSTRAINT ck_share_as_primary_key CHECK ((COALESCE(array_length(share_pks, 1), 0) > 0))
);


--
-- TOC entry 271 (class 1259 OID 17220)
-- Name: tperiod; Type: TABLE; Schema: cluster; Owner: -
--

CREATE TABLE cluster.tperiod (
    tperiod_id smallint NOT NULL,
    tperiod_desc character varying,
    tperiod_label character varying,
    tperiod_code character varying
);


--
-- TOC entry 272 (class 1259 OID 17225)
-- Name: altspelling; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.altspelling (
    altspelling_id smallint NOT NULL,
    altspelling_country_id smallint NOT NULL,
    altspelling_altspelling character varying NOT NULL
);


--
-- TOC entry 273 (class 1259 OID 17230)
-- Name: country; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.country (
    country_id smallint NOT NULL,
    country_region_id smallint,
    country_subregion_id smallint,
    country_demonym_id smallint,
    country_name character varying NOT NULL,
    country_iso2 character varying NOT NULL,
    country_iso3 character varying NOT NULL,
    country_capital character varying,
    country_population integer NOT NULL,
    country_latitude numeric,
    country_longitude numeric,
    country_area numeric,
    country_gini numeric,
    country_nativename character varying NOT NULL,
    country_numericcode character varying,
    country_flag character varying NOT NULL,
    country_cioc character varying
);


--
-- TOC entry 274 (class 1259 OID 17235)
-- Name: countryborder; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.countryborder (
    countryborder_id smallint NOT NULL,
    countryborder_country_id smallint NOT NULL,
    countryborder_country_broder smallint NOT NULL
);


--
-- TOC entry 275 (class 1259 OID 17238)
-- Name: countrycallcode; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.countrycallcode (
    countrycallcode_id smallint NOT NULL,
    countrycallcode_country_id smallint NOT NULL,
    countrycallcode_callcode smallint NOT NULL
);


--
-- TOC entry 276 (class 1259 OID 17241)
-- Name: countrycurrency; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.countrycurrency (
    countrycurrency_id smallint NOT NULL,
    countrycurrency_country_id smallint NOT NULL,
    countrycurrency_currency_id smallint NOT NULL
);


--
-- TOC entry 277 (class 1259 OID 17244)
-- Name: countrylanguage; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.countrylanguage (
    countrylanguage_id smallint NOT NULL,
    countrylanguage_country_id smallint NOT NULL,
    countrylanguage_language_id smallint NOT NULL
);


--
-- TOC entry 278 (class 1259 OID 17247)
-- Name: countryregionalbloc; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.countryregionalbloc (
    countryregionalbloc_id smallint NOT NULL,
    countryregionalbloc_country_id smallint NOT NULL,
    countryregionalbloc_regionalbloc_id smallint NOT NULL
);


--
-- TOC entry 279 (class 1259 OID 17250)
-- Name: countrytimezone; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.countrytimezone (
    countrytimezone_id smallint NOT NULL,
    countrytimezone_country_id smallint NOT NULL,
    countrytimezone_timezone_id smallint NOT NULL
);


--
-- TOC entry 280 (class 1259 OID 17253)
-- Name: countrytopleveldomain; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.countrytopleveldomain (
    countrytopleveldomain_id smallint NOT NULL,
    countrytopleveldomain_country_id smallint NOT NULL,
    countrytopleveldomain_domain_id smallint NOT NULL
);


--
-- TOC entry 281 (class 1259 OID 17256)
-- Name: countrytranslation; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.countrytranslation (
    countrytranslation_id smallint NOT NULL,
    countrytranslation_country_id smallint NOT NULL,
    countrytranslation_language_id smallint NOT NULL,
    countrytranslation_translation character varying NOT NULL
);


--
-- TOC entry 282 (class 1259 OID 17261)
-- Name: currency; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.currency (
    currency_id smallint NOT NULL,
    currency_code character varying,
    currency_name character varying,
    currency_symbol character varying
);


--
-- TOC entry 283 (class 1259 OID 17266)
-- Name: demonym; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.demonym (
    demonym_id smallint NOT NULL,
    demonym_name character varying NOT NULL
);


--
-- TOC entry 284 (class 1259 OID 17271)
-- Name: domain; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.domain (
    domain_id smallint NOT NULL,
    domain_name character varying NOT NULL
);


--
-- TOC entry 285 (class 1259 OID 17276)
-- Name: language; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.language (
    language_id smallint NOT NULL,
    language_iso2 character varying,
    language_iso3 character varying NOT NULL,
    language_name character varying NOT NULL,
    language_nativename character varying NOT NULL
);


--
-- TOC entry 286 (class 1259 OID 17281)
-- Name: region; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.region (
    region_id smallint NOT NULL,
    region_name character varying NOT NULL
);


--
-- TOC entry 287 (class 1259 OID 17286)
-- Name: regionalbloc; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.regionalbloc (
    regionalbloc_id smallint NOT NULL,
    regionalbloc_acronym character varying NOT NULL,
    regionalbloc_name character varying NOT NULL
);


--
-- TOC entry 288 (class 1259 OID 17291)
-- Name: regionalblocname; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.regionalblocname (
    regionalblocname_id smallint NOT NULL,
    regionalblocname_regionalbloc_id smallint NOT NULL,
    regionalblocname_name character varying NOT NULL
);


--
-- TOC entry 289 (class 1259 OID 17296)
-- Name: regionalblocother; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.regionalblocother (
    regionalblocother_id smallint NOT NULL,
    regionalblocother_regionalbloc_id smallint NOT NULL,
    regionalblocother_otheracronym character varying NOT NULL
);


--
-- TOC entry 290 (class 1259 OID 17301)
-- Name: seq_altspelling; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_altspelling
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6279 (class 0 OID 0)
-- Dependencies: 290
-- Name: seq_altspelling; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_altspelling OWNED BY geoinfo.altspelling.altspelling_id;


--
-- TOC entry 291 (class 1259 OID 17302)
-- Name: seq_country; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_country
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6281 (class 0 OID 0)
-- Dependencies: 291
-- Name: seq_country; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_country OWNED BY geoinfo.country.country_id;


--
-- TOC entry 292 (class 1259 OID 17303)
-- Name: seq_countryborder; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_countryborder
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6283 (class 0 OID 0)
-- Dependencies: 292
-- Name: seq_countryborder; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_countryborder OWNED BY geoinfo.countryborder.countryborder_id;


--
-- TOC entry 293 (class 1259 OID 17304)
-- Name: seq_countrycallcode; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_countrycallcode
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6285 (class 0 OID 0)
-- Dependencies: 293
-- Name: seq_countrycallcode; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_countrycallcode OWNED BY geoinfo.countrycallcode.countrycallcode_id;


--
-- TOC entry 294 (class 1259 OID 17305)
-- Name: seq_countrycurrency; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_countrycurrency
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6287 (class 0 OID 0)
-- Dependencies: 294
-- Name: seq_countrycurrency; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_countrycurrency OWNED BY geoinfo.countrycurrency.countrycurrency_id;


--
-- TOC entry 295 (class 1259 OID 17306)
-- Name: seq_countrylanguage; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_countrylanguage
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6289 (class 0 OID 0)
-- Dependencies: 295
-- Name: seq_countrylanguage; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_countrylanguage OWNED BY geoinfo.countrylanguage.countrylanguage_id;


--
-- TOC entry 296 (class 1259 OID 17307)
-- Name: seq_countryregionalbloc; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_countryregionalbloc
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6291 (class 0 OID 0)
-- Dependencies: 296
-- Name: seq_countryregionalbloc; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_countryregionalbloc OWNED BY geoinfo.countryregionalbloc.countryregionalbloc_id;


--
-- TOC entry 297 (class 1259 OID 17308)
-- Name: seq_countrytimezone; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_countrytimezone
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6293 (class 0 OID 0)
-- Dependencies: 297
-- Name: seq_countrytimezone; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_countrytimezone OWNED BY geoinfo.countrytimezone.countrytimezone_id;


--
-- TOC entry 298 (class 1259 OID 17309)
-- Name: seq_countrytopleveldomain; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_countrytopleveldomain
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6295 (class 0 OID 0)
-- Dependencies: 298
-- Name: seq_countrytopleveldomain; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_countrytopleveldomain OWNED BY geoinfo.countrytopleveldomain.countrytopleveldomain_id;


--
-- TOC entry 299 (class 1259 OID 17310)
-- Name: seq_countrytranslation; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_countrytranslation
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6297 (class 0 OID 0)
-- Dependencies: 299
-- Name: seq_countrytranslation; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_countrytranslation OWNED BY geoinfo.countrytranslation.countrytranslation_id;


--
-- TOC entry 300 (class 1259 OID 17311)
-- Name: seq_currency; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_currency
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6299 (class 0 OID 0)
-- Dependencies: 300
-- Name: seq_currency; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_currency OWNED BY geoinfo.currency.currency_id;


--
-- TOC entry 301 (class 1259 OID 17312)
-- Name: seq_dataset; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_dataset
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6301 (class 0 OID 0)
-- Dependencies: 301
-- Name: seq_dataset; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_dataset OWNED BY geoinfo.dataset.dataset_id;


--
-- TOC entry 302 (class 1259 OID 17313)
-- Name: seq_demonym; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_demonym
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6303 (class 0 OID 0)
-- Dependencies: 302
-- Name: seq_demonym; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_demonym OWNED BY geoinfo.demonym.demonym_id;


--
-- TOC entry 303 (class 1259 OID 17314)
-- Name: seq_domain; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_domain
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6305 (class 0 OID 0)
-- Dependencies: 303
-- Name: seq_domain; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_domain OWNED BY geoinfo.domain.domain_id;


--
-- TOC entry 304 (class 1259 OID 17315)
-- Name: seq_language; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_language
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6307 (class 0 OID 0)
-- Dependencies: 304
-- Name: seq_language; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_language OWNED BY geoinfo.language.language_id;


--
-- TOC entry 305 (class 1259 OID 17316)
-- Name: seq_region; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_region
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6309 (class 0 OID 0)
-- Dependencies: 305
-- Name: seq_region; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_region OWNED BY geoinfo.region.region_id;


--
-- TOC entry 306 (class 1259 OID 17317)
-- Name: seq_regionalbloc; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_regionalbloc
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6311 (class 0 OID 0)
-- Dependencies: 306
-- Name: seq_regionalbloc; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_regionalbloc OWNED BY geoinfo.regionalbloc.regionalbloc_id;


--
-- TOC entry 307 (class 1259 OID 17318)
-- Name: seq_regionalblocname; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_regionalblocname
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6313 (class 0 OID 0)
-- Dependencies: 307
-- Name: seq_regionalblocname; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_regionalblocname OWNED BY geoinfo.regionalblocname.regionalblocname_id;


--
-- TOC entry 308 (class 1259 OID 17319)
-- Name: seq_regionalblocother; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_regionalblocother
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6315 (class 0 OID 0)
-- Dependencies: 308
-- Name: seq_regionalblocother; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_regionalblocother OWNED BY geoinfo.regionalblocother.regionalblocother_id;


--
-- TOC entry 309 (class 1259 OID 17320)
-- Name: subregion; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.subregion (
    subregion_id smallint NOT NULL,
    subregion_name character varying NOT NULL
);


--
-- TOC entry 310 (class 1259 OID 17325)
-- Name: seq_subregion; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_subregion
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6318 (class 0 OID 0)
-- Dependencies: 310
-- Name: seq_subregion; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_subregion OWNED BY geoinfo.subregion.subregion_id;


--
-- TOC entry 311 (class 1259 OID 17326)
-- Name: timezone; Type: TABLE; Schema: geoinfo; Owner: -
--

CREATE TABLE geoinfo.timezone (
    timezone_id smallint NOT NULL,
    timezone_timezone character varying NOT NULL
);


--
-- TOC entry 312 (class 1259 OID 17331)
-- Name: seq_timezone; Type: SEQUENCE; Schema: geoinfo; Owner: -
--

CREATE SEQUENCE geoinfo.seq_timezone
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6321 (class 0 OID 0)
-- Dependencies: 312
-- Name: seq_timezone; Type: SEQUENCE OWNED BY; Schema: geoinfo; Owner: -
--

ALTER SEQUENCE geoinfo.seq_timezone OWNED BY geoinfo.timezone.timezone_id;


--
-- TOC entry 364 (class 1259 OID 19674)
-- Name: domsync; Type: TABLE; Schema: libdom; Owner: -
--

CREATE TABLE libdom.domsync (
    classname character varying NOT NULL,
    columnname character varying NOT NULL,
    domain character varying NOT NULL,
    comment text,
    CONSTRAINT domsync_classname_check CHECK (((classname)::regclass IS NOT NULL))
);


--
-- TOC entry 313 (class 1259 OID 17332)
-- Name: constvalue; Type: TABLE; Schema: map; Owner: -
--

CREATE TABLE map.constvalue (
    constvalue_name name NOT NULL,
    constvalue_type regtype NOT NULL,
    constvalue_value text NOT NULL,
    constvalue_editable boolean DEFAULT false NOT NULL,
    constvalue_descrision character varying,
    constvalue_comment character varying
);


--
-- TOC entry 6323 (class 0 OID 0)
-- Dependencies: 313
-- Name: TABLE constvalue; Type: COMMENT; Schema: map; Owner: -
--

COMMENT ON TABLE map.constvalue IS 'Essa entidade serve para armazenar os valores das constantes';


--
-- TOC entry 6324 (class 0 OID 0)
-- Dependencies: 313
-- Name: COLUMN constvalue.constvalue_name; Type: COMMENT; Schema: map; Owner: -
--

COMMENT ON COLUMN map.constvalue.constvalue_name IS 'Corresponde ao nome da constante';


--
-- TOC entry 6325 (class 0 OID 0)
-- Dependencies: 313
-- Name: COLUMN constvalue.constvalue_type; Type: COMMENT; Schema: map; Owner: -
--

COMMENT ON COLUMN map.constvalue.constvalue_type IS 'Corresponde ao tipo da constante';


--
-- TOC entry 6326 (class 0 OID 0)
-- Dependencies: 313
-- Name: COLUMN constvalue.constvalue_value; Type: COMMENT; Schema: map; Owner: -
--

COMMENT ON COLUMN map.constvalue.constvalue_value IS 'Corresponde ao valor da constante';


--
-- TOC entry 6327 (class 0 OID 0)
-- Dependencies: 313
-- Name: COLUMN constvalue.constvalue_editable; Type: COMMENT; Schema: map; Owner: -
--

COMMENT ON COLUMN map.constvalue.constvalue_editable IS 'Esse atributo indica se a constante pode ser editavel';


--
-- TOC entry 6328 (class 0 OID 0)
-- Dependencies: 313
-- Name: COLUMN constvalue.constvalue_descrision; Type: COMMENT; Schema: map; Owner: -
--

COMMENT ON COLUMN map.constvalue.constvalue_descrision IS 'Corresponde a descrição da constante';


--
-- TOC entry 6329 (class 0 OID 0)
-- Dependencies: 313
-- Name: COLUMN constvalue.constvalue_comment; Type: COMMENT; Schema: map; Owner: -
--

COMMENT ON COLUMN map.constvalue.constvalue_comment IS 'Commentario para a constante';


--
-- TOC entry 352 (class 1259 OID 19466)
-- Name: raw; Type: TABLE; Schema: patch; Owner: -
--

CREATE TABLE patch.raw (
    raw_uid uuid DEFAULT gen_random_uuid() NOT NULL,
    raw_text text NOT NULL,
    raw_match text NOT NULL
);


--
-- TOC entry 354 (class 1259 OID 19475)
-- Name: revision; Type: TABLE; Schema: patch; Owner: -
--

CREATE TABLE patch.revision (
    file character varying,
    identifier character varying,
    ref character varying GENERATED ALWAYS AS (patch.ref(file, identifier)) STORED NOT NULL,
    _raw_uid uuid NOT NULL,
    force smallint DEFAULT 0 NOT NULL,
    flags text[] DEFAULT ARRAY[]::text[] NOT NULL,
    configs jsonb DEFAULT jsonb_build_object() NOT NULL,
    status smallint DEFAULT 2 NOT NULL,
    connection character varying,
    seq integer NOT NULL,
    version integer DEFAULT 0 NOT NULL,
    date timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL
);


--
-- TOC entry 353 (class 1259 OID 19474)
-- Name: revision_seq_seq; Type: SEQUENCE; Schema: patch; Owner: -
--

CREATE SEQUENCE patch.revision_seq_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6331 (class 0 OID 0)
-- Dependencies: 353
-- Name: revision_seq_seq; Type: SEQUENCE OWNED BY; Schema: patch; Owner: -
--

ALTER SEQUENCE patch.revision_seq_seq OWNED BY patch.revision.seq;


--
-- TOC entry 375 (class 1259 OID 19919)
-- Name: agg; Type: TABLE; Schema: report; Owner: -
--

CREATE TABLE report.agg (
    key text NOT NULL,
    priority integer,
    function text,
    types text[],
    format text,
    label text,
    name text,
    rename text,
    description text,
    simple text,
    expression text,
    over text
);


--
-- TOC entry 369 (class 1259 OID 19779)
-- Name: filter; Type: TABLE; Schema: report; Owner: -
--

CREATE TABLE report.filter (
    filter_uid uuid DEFAULT gen_random_uuid() NOT NULL,
    filter_parametrized_uid uuid NOT NULL,
    filter_name character varying NOT NULL,
    filter_props jsonb DEFAULT jsonb_build_object() NOT NULL,
    filter_require boolean DEFAULT false NOT NULL,
    filter_column character varying NOT NULL,
    filter_type character varying NOT NULL,
    filter_opr character varying NOT NULL,
    filter_basevalue character varying,
    filter_valuemode integer DEFAULT (libdom.get('report_filter_filter_valuemode_raw'::name))::smallint NOT NULL,
    filter_increment character varying,
    filter_grants character varying[] NOT NULL,
    filter_state smallint DEFAULT (libdom.get('report_filter_state_active'::name))::smallint NOT NULL,
    filter_date timestamp with time zone DEFAULT clock_timestamp() NOT NULL,
    filter_update timestamp with time zone,
    filter_user_id character varying NOT NULL,
    filter_user_update character varying,
    filter_espaco_auth character varying NOT NULL,
    _branch_uid character varying NOT NULL
);


--
-- TOC entry 6332 (class 0 OID 0)
-- Dependencies: 369
-- Name: COLUMN filter.filter_state; Type: COMMENT; Schema: report; Owner: -
--

COMMENT ON COLUMN report.filter.filter_state IS ' <html><style>
table, th, td {
  border:1px solid black;
}
</style><body><div><ul></ul>
<table><tr><th>lable</th><th>value</th><th>domain</th><th>name</th></tr><tr><td>Ativo</td> <td>1</td> <td>report.filter.filter_state</td> <td>report_filter_state_active</td> </tr>
<tr><td>Fechado</td> <td>0</td> <td>report.filter.filter_state</td> <td>report_filter_state_fechado</td> </tr></table></div></body></html> ';


--
-- TOC entry 377 (class 1259 OID 19933)
-- Name: mask; Type: TABLE; Schema: report; Owner: -
--

CREATE TABLE report.mask (
    type text[] DEFAULT ARRAY[]::text[] NOT NULL,
    mask text NOT NULL,
    name text,
    description character varying,
    representation text,
    function text,
    priority smallint
);


--
-- TOC entry 368 (class 1259 OID 19766)
-- Name: parametrized; Type: TABLE; Schema: report; Owner: -
--

CREATE TABLE report.parametrized (
    parametrized_uid uuid DEFAULT gen_random_uuid() NOT NULL,
    parametrized_name character varying NOT NULL,
    parametrized_source character varying NOT NULL,
    parametrized_columns jsonb DEFAULT jsonb_build_array() NOT NULL,
    parametrized_groups jsonb DEFAULT jsonb_build_array() NOT NULL,
    parametrized_props jsonb DEFAULT jsonb_build_object() NOT NULL,
    parametrized_grants character varying[] NOT NULL,
    parametrized_state smallint DEFAULT (libdom.get('report_filter_state_active'::name))::smallint NOT NULL,
    parametrized_date timestamp with time zone DEFAULT clock_timestamp() NOT NULL,
    parametrized_update timestamp with time zone,
    parametrized_user_id character varying NOT NULL,
    parametrized_espaco_auth character varying NOT NULL,
    parametrized_user_update character varying,
    _branch_uid character varying NOT NULL
);


--
-- TOC entry 6333 (class 0 OID 0)
-- Dependencies: 368
-- Name: COLUMN parametrized.parametrized_state; Type: COMMENT; Schema: report; Owner: -
--

COMMENT ON COLUMN report.parametrized.parametrized_state IS ' <html><style>
table, th, td {
  border:1px solid black;
}
</style><body><div><ul></ul>
<table><tr><th>lable</th><th>value</th><th>domain</th><th>name</th></tr></table></div></body></html> ';


--
-- TOC entry 372 (class 1259 OID 19883)
-- Name: report; Type: TABLE; Schema: report; Owner: -
--

CREATE TABLE report.report (
    report_name character varying,
    report_source character varying NOT NULL,
    report_columns text[],
    report_priority integer,
    report_active boolean DEFAULT true NOT NULL
);


--
-- TOC entry 376 (class 1259 OID 19926)
-- Name: talias; Type: TABLE; Schema: report; Owner: -
--

CREATE TABLE report.talias (
    type text NOT NULL,
    alias text[]
);


--
-- TOC entry 373 (class 1259 OID 19896)
-- Name: template; Type: TABLE; Schema: report; Owner: -
--

CREATE TABLE report.template (
    type character varying,
    name character varying,
    configs jsonb
);


--
-- TOC entry 378 (class 1259 OID 19943)
-- Name: var; Type: TABLE; Schema: report; Owner: -
--

CREATE TABLE report.var (
    var_key text NOT NULL,
    var_description text,
    var_type text,
    var_expression text
);


--
-- TOC entry 374 (class 1259 OID 19906)
-- Name: vcolumn; Type: TABLE; Schema: report; Owner: -
--

CREATE TABLE report.vcolumn (
    source character varying NOT NULL,
    name character varying NOT NULL,
    "position" smallint,
    show boolean DEFAULT false,
    init boolean DEFAULT false,
    format character varying,
    filter jsonb DEFAULT jsonb_build_array(),
    agg jsonb DEFAULT jsonb_build_array(),
    noagg boolean DEFAULT false,
    gen jsonb DEFAULT jsonb_build_array(),
    rename character varying,
    type character varying
);


--
-- TOC entry 314 (class 1259 OID 17381)
-- Name: entrada; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.entrada (
    entrada_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    entrada_artigo_id uuid NOT NULL,
    entrada_espaco_destino uuid NOT NULL,
    entrada_espaco_auth uuid NOT NULL,
    entrada_colaborador_id uuid NOT NULL,
    entrada_colaborador_atualizacao uuid,
    entrada_custounitario double precision,
    entrada_quantidade double precision NOT NULL,
    entrada_quantidadeinicial double precision DEFAULT 0 NOT NULL,
    entrada_quantidadefinal double precision DEFAULT 0,
    entrada_descricao character varying,
    entrada_estado smallint DEFAULT (map.get('entrada_estado_ativo'::name))::smallint NOT NULL,
    entrada_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    entrada_dataatualizacao timestamp with time zone,
    entrada_guia_id uuid NOT NULL,
    _branch_uid uuid,
    entrada_lote character varying,
    entrada_validade date,
    entrada_metadata json
);


--
-- TOC entry 6334 (class 0 OID 0)
-- Dependencies: 314
-- Name: TABLE entrada; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.entrada IS 'Entrada - Registra todas as entradas (compras) feito sobre um artigo para um determinado stock';


--
-- TOC entry 6335 (class 0 OID 0)
-- Dependencies: 314
-- Name: COLUMN entrada.entrada_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.entrada.entrada_id IS 'Identificador único da entrada';


--
-- TOC entry 6336 (class 0 OID 0)
-- Dependencies: 314
-- Name: COLUMN entrada.entrada_artigo_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.entrada.entrada_artigo_id IS 'Identificador do artigo o qual está se entregado';


--
-- TOC entry 6337 (class 0 OID 0)
-- Dependencies: 314
-- Name: COLUMN entrada.entrada_espaco_auth; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.entrada.entrada_espaco_auth IS 'Identificador do espaço a qual o artigo entrou';


--
-- TOC entry 6338 (class 0 OID 0)
-- Dependencies: 314
-- Name: COLUMN entrada.entrada_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.entrada.entrada_colaborador_id IS 'Identificador do colaborador responsavel pela entrega do artigo';


--
-- TOC entry 6339 (class 0 OID 0)
-- Dependencies: 314
-- Name: COLUMN entrada.entrada_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.entrada.entrada_colaborador_atualizacao IS 'Identificador do colaborador responsável pela atualização da entrega';


--
-- TOC entry 6340 (class 0 OID 0)
-- Dependencies: 314
-- Name: COLUMN entrada.entrada_custounitario; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.entrada.entrada_custounitario IS 'Corresponde ao montante do custo da entrada (montante de custo da compra)';


--
-- TOC entry 6341 (class 0 OID 0)
-- Dependencies: 314
-- Name: COLUMN entrada.entrada_quantidade; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.entrada.entrada_quantidade IS 'Corresponde a quantidade do artigo entrado em stock';


--
-- TOC entry 6342 (class 0 OID 0)
-- Dependencies: 314
-- Name: COLUMN entrada.entrada_quantidadeinicial; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.entrada.entrada_quantidadeinicial IS 'Corresponde a quantidade de artigo inicialmente no stock antes da entrada';


--
-- TOC entry 6343 (class 0 OID 0)
-- Dependencies: 314
-- Name: COLUMN entrada.entrada_quantidadefinal; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.entrada.entrada_quantidadefinal IS 'Corresponde a quantidade de artigo disponivél no stock depois da entrada';


--
-- TOC entry 6344 (class 0 OID 0)
-- Dependencies: 314
-- Name: COLUMN entrada.entrada_descricao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.entrada.entrada_descricao IS 'Corresponde a observação da entrada';


--
-- TOC entry 6345 (class 0 OID 0)
-- Dependencies: 314
-- Name: COLUMN entrada.entrada_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.entrada.entrada_estado IS 'Corresponde ao estado da entrada
<ul>
  <li> 1  - Ativo </li>
  <li> -1 - Anulado </li>
</ul>';


--
-- TOC entry 6346 (class 0 OID 0)
-- Dependencies: 314
-- Name: COLUMN entrada.entrada_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.entrada.entrada_dataregistro IS 'Corresponde ao isntante em que a entrada foi registrada';


--
-- TOC entry 6347 (class 0 OID 0)
-- Dependencies: 314
-- Name: COLUMN entrada.entrada_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.entrada.entrada_dataatualizacao IS 'Corresponde ao instante em que a entrada foi atualizada';


--
-- TOC entry 379 (class 1259 OID 19955)
-- Name: vreport_balanco; Type: VIEW; Schema: report; Owner: -
--

CREATE VIEW report.vreport_balanco AS
 WITH _const(maguita_conta_estado_fechado, maguita_venda_estado_fechado) AS (
         SELECT (map.get('maguita_conta_estado_fechado'::name))::smallint AS get,
            (map.get('maguita_venda_estado_fechado'::name))::smallint AS get
        ), __lancamento AS (
         SELECT l.ordem,
            l.ordem_grupo,
            l.cd,
            l.credito,
            l.debito,
            l.valor,
            l.entrada,
            l.saldo,
            l.resumo,
            l.acomulacao,
            l.regula_acumulacao,
            l.regula_montante,
            l.regula,
            l.regula_id,
            l.regula_refid,
            l.cliente_id,
            l.tgrupo_id,
            l.lancamento_id,
            l.lancamento_refid,
            l.lancamento_ref,
            l.lancamento_class,
            l.lancamento_doc,
            l.lancamento_data,
            l.lancamento_time,
            l.lancamento_sequencia
           FROM tweeks.__lancamento_regularizacao() l(ordem, ordem_grupo, cd, credito, debito, valor, entrada, saldo, resumo, acomulacao, regula_acumulacao, regula_montante, regula, regula_id, regula_refid, cliente_id, tgrupo_id, lancamento_id, lancamento_refid, lancamento_ref, lancamento_class, lancamento_doc, lancamento_data, lancamento_time, lancamento_sequencia)
        ), __receitas AS (
         SELECT art.artigo_id,
            art.artigo_nome,
            art.artigo_codigo,
            cla.classe_id,
            cla.classe_nome,
            es.espaco_id,
            es.espaco_nome,
            ve.venda_montantecomimposto,
            ve.venda_quantidade,
            l.regula_montante AS conta_montanteefetivo,
            (l.regula_montante / ct.conta_montante) AS conta_percentageefetiva,
            ((l.regula_montante / ct.conta_montante) * ve.venda_montantecomimposto) AS venda_montanteefetivo,
            ct.conta_data,
            ct._branch_uid
           FROM _const,
            (((((tweeks.conta ct
             JOIN tweeks.venda ve ON (((ct.conta_id = ve.venda_conta_id) AND (ve.venda_venda_id IS NULL))))
             JOIN tweeks.espaco es ON ((ct.conta_espaco_auth = es.espaco_id)))
             JOIN tweeks.artigo art ON ((ve.venda_artigo_id = art.artigo_id)))
             JOIN tweeks.classe cla ON ((art.artigo_classe_id = cla.classe_id)))
             JOIN __lancamento l ON ((ct.conta_id = l.lancamento_refid)))
          WHERE ((ct.conta_estado = _const.maguita_conta_estado_fechado) AND (ve.venda_estado = _const.maguita_venda_estado_fechado))
        ), ___despesas AS (
         SELECT art.artigo_id,
            art.artigo_nome,
            art.artigo_codigo,
            cla.classe_id,
            cla.classe_nome,
            es.espaco_id,
            es.espaco_nome,
            g.guia_date AS entrada_data,
            g.guia_documentoperacao AS entrada_codigofatura,
            en.entrada_quantidade,
            en.entrada_custounitario AS quantidade_custounidade,
            (en.entrada_custounitario * en.entrada_quantidade) AS entrada_montanteefetivo,
            (0.0)::double precision AS entrada_montanteprevisto,
            en._branch_uid
           FROM ((((tweeks.entrada en
             JOIN tweeks.guia g ON ((en.entrada_guia_id = g.guia_uid)))
             JOIN tweeks.espaco es ON ((en.entrada_espaco_destino = es.espaco_id)))
             JOIN tweeks.artigo art ON ((en.entrada_artigo_id = art.artigo_id)))
             JOIN tweeks.classe cla ON ((art.artigo_classe_id = cla.classe_id)))
        ), __union AS (
         SELECT COALESCE(__rec.artigo_id, _desps.artigo_id) AS artigo_id,
            COALESCE(__rec.artigo_nome, _desps.artigo_nome) AS artigo_nome,
            COALESCE(__rec.artigo_codigo, _desps.artigo_codigo) AS artigo_codigo,
            COALESCE(__rec.classe_id, _desps.classe_id) AS classe_id,
            COALESCE(__rec.classe_nome, _desps.classe_nome) AS classe_nome,
            COALESCE(__rec.espaco_id, _desps.espaco_id) AS espaco_id,
            COALESCE(__rec.espaco_nome, _desps.espaco_nome) AS espaco_nome,
            COALESCE(__rec._branch_uid, _desps._branch_uid) AS _branch_uid,
            COALESCE((__rec.conta_data)::timestamp with time zone, _desps.entrada_data) AS data,
            COALESCE(_desps.entrada_quantidade, (0.0)::double precision) AS despesa_quantidade,
            COALESCE(_desps.entrada_montanteefetivo, (0.0)::double precision) AS despesa_montanteefetivo,
            COALESCE(_desps.entrada_montanteprevisto, (0.0)::double precision) AS despesa_montanteprevisto,
            COALESCE(__rec.venda_quantidade, (0.0)::double precision) AS receita_quantidade,
            COALESCE(__rec.venda_montanteefetivo, (0.0)::double precision) AS receita_montanteefetivo,
            COALESCE((__rec.venda_montantecomimposto - __rec.venda_montanteefetivo), (0.0)::double precision) AS receita_montanteprevisto
           FROM (__receitas __rec
             FULL JOIN ___despesas _desps ON (((__rec.conta_data = _desps.entrada_data) AND (__rec.artigo_id = _desps.artigo_id) AND (__rec.classe_id = _desps.classe_id) AND (__rec.espaco_id = _desps.espaco_id))))
        ), __resultado AS (
         SELECT _un.artigo_id,
            _un.artigo_nome AS "ARTIGO",
            _un.artigo_codigo AS "CÓDIGO",
            _un.classe_id,
            _un.espaco_id,
            _un.espaco_nome AS "ARMAZÉM",
            _un._branch_uid,
            _un.classe_nome AS "CATEGORIA",
            _un.data AS "DATA",
            sum(_un.despesa_quantidade) AS "QT. ENTRADA",
            sum(_un.receita_montanteefetivo) AS "$ RECEITA EFET.",
            sum(_un.receita_montanteprevisto) AS "$ RECEITA PREV.",
            sum((_un.receita_montanteefetivo + _un.receita_montanteprevisto)) AS "$ RECEITA ESTI.",
            sum(_un.receita_quantidade) AS "QT. SAÍDA",
            sum(_un.despesa_montanteefetivo) AS "$ DESPESA EFET.",
            sum(_un.despesa_montanteprevisto) AS "$ DESPESA PREV.",
            sum((_un.despesa_montanteefetivo + _un.despesa_montanteprevisto)) AS "$ DESPESA ESTI.",
            sum((_un.receita_montanteprevisto - _un.despesa_montanteprevisto)) AS "$ REST. PREV.",
            sum((_un.receita_montanteefetivo - _un.despesa_montanteefetivo)) AS "$ REST. EFET.",
            sum(((_un.receita_montanteefetivo + _un.receita_montanteprevisto) - (_un.despesa_montanteefetivo + _un.despesa_montanteprevisto))) AS "$ REST. ESTI.",
            sum((_un.despesa_quantidade - _un.receita_quantidade)) AS "REST. QT."
           FROM __union _un
          GROUP BY _un.artigo_id, _un.espaco_id, _un.espaco_nome, _un.artigo_nome, _un.artigo_codigo, _un.classe_id, _un.classe_nome, _un._branch_uid, _un.data
        )
 SELECT __resultado.artigo_id,
    __resultado."ARTIGO",
    __resultado."CÓDIGO",
    __resultado.classe_id,
    __resultado.espaco_id,
    __resultado."ARMAZÉM",
    __resultado._branch_uid,
    __resultado."CATEGORIA",
    __resultado."DATA",
    __resultado."QT. ENTRADA",
    __resultado."$ RECEITA EFET.",
    __resultado."$ RECEITA PREV.",
    __resultado."$ RECEITA ESTI.",
    __resultado."QT. SAÍDA",
    __resultado."$ DESPESA EFET.",
    __resultado."$ DESPESA PREV.",
    __resultado."$ DESPESA ESTI.",
    __resultado."$ REST. PREV.",
    __resultado."$ REST. EFET.",
    __resultado."$ REST. ESTI.",
    __resultado."REST. QT."
   FROM __resultado
  ORDER BY __resultado."CATEGORIA", __resultado."ARTIGO", __resultado."DATA";


--
-- TOC entry 315 (class 1259 OID 17396)
-- Name: cliente; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.cliente (
    cliente_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    cliente_colaborador_id uuid NOT NULL,
    cliente_colaborador_gerente uuid,
    cliente_colaborador_atualizacao uuid,
    cliente_espaco_auth uuid NOT NULL,
    cliente_tdocument_id smallint,
    cliente_titular character varying NOT NULL,
    cliente_nif character varying,
    cliente_documento character varying,
    cliente_mail character varying,
    cliente_contactos jsonb DEFAULT jsonb_build_array() NOT NULL,
    cliente_estado smallint DEFAULT (map.get('maguita_cliente_estado_ativo'::name))::smallint NOT NULL,
    cliente_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    cliente_dataatualizacao timestamp with time zone,
    _branch_uid uuid,
    cliente_code character varying NOT NULL,
    cliente_metadata jsonb DEFAULT jsonb_build_object() NOT NULL
);


--
-- TOC entry 316 (class 1259 OID 17406)
-- Name: deposito; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.deposito (
    deposito_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    deposito_caixa_id uuid,
    deposito_tpaga_id smallint NOT NULL,
    deposito_currency_id smallint NOT NULL,
    deposito_espaco_auth uuid NOT NULL,
    deposito_colaborador_id uuid NOT NULL,
    deposito_colaborador_atualizacao uuid,
    deposito_referencia jsonb,
    deposito_documento character varying NOT NULL,
    deposito_data date NOT NULL,
    deposito_montante double precision NOT NULL,
    deposito_montantemoeda double precision,
    deposito_taxacambio double precision,
    deposito_estado smallint DEFAULT (map.get('maguita_deposito_estado_ativo'::name))::smallint NOT NULL,
    deposito_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    deposito_dataatualizacao timestamp with time zone,
    deposito_posto_id uuid,
    deposito_cliente_id uuid NOT NULL,
    deposito_montantetroco double precision DEFAULT 0.0 NOT NULL,
    deposito_montantefinal double precision GENERATED ALWAYS AS ((deposito_montante - deposito_montantetroco)) STORED,
    deposito_docref character varying,
    deposito_observacao character varying,
    _tgrupo_id smallint NOT NULL,
    deposito_serie_id uuid,
    _branch_uid uuid,
    deposito_serie json,
    CONSTRAINT ck_desposito_montantetroco CHECK ((deposito_montantetroco < deposito_montante))
);


--
-- TOC entry 6350 (class 0 OID 0)
-- Dependencies: 316
-- Name: TABLE deposito; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.deposito IS 'Essa entidade serve para registar as amortizações feitas nas contas';


--
-- TOC entry 6351 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_id IS 'Identificador de amortização';


--
-- TOC entry 6352 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_caixa_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_caixa_id IS 'Identificador da caixa que a amortização foi feita';


--
-- TOC entry 6353 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_tpaga_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_tpaga_id IS 'Identificador da forma usada para efetuar a amortizcao';


--
-- TOC entry 6354 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_currency_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_currency_id IS 'Identificador da moeda usada para a amortização';


--
-- TOC entry 6355 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_colaborador_id IS 'Identificador do colaborador responsavél pela amortização';


--
-- TOC entry 6356 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_colaborador_atualizacao IS 'Identificador do colaborador responsável pela atualização da amortização';


--
-- TOC entry 6357 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_referencia; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_referencia IS 'Corresponde a referencia interna/externa no qual o deposito se associa (conta_id)';


--
-- TOC entry 6358 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_documento; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_documento IS 'O documento da amortização';


--
-- TOC entry 6359 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_data; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_data IS 'A data em que a amortização foi feita';


--
-- TOC entry 6360 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_montante; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_montante IS 'O montante amortizado';


--
-- TOC entry 6361 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_montantemoeda; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_montantemoeda IS 'O montante em moeda em moeda da amortizacao';


--
-- TOC entry 6362 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_taxacambio; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_taxacambio IS 'A taxa de cambio usado no momento da operação';


--
-- TOC entry 6363 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_estado IS 'Corresponde ao estado de amortização
<ul>
  <li> 1 - Ativo </li>
</ul>';


--
-- TOC entry 6364 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_dataregistro IS 'O instante em que a amortização foi registrada no sistema';


--
-- TOC entry 6365 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_dataatualizacao IS 'O isntante em que a atualização foi atalizada pela últma vez';


--
-- TOC entry 6366 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_docref; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_docref IS 'Corresponde ao numero de documento usado externamente para o deposito';


--
-- TOC entry 6367 (class 0 OID 0)
-- Dependencies: 316
-- Name: COLUMN deposito.deposito_observacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.deposito.deposito_observacao IS 'Corresponde a observação do deposito';


--
-- TOC entry 317 (class 1259 OID 17417)
-- Name: tpaga; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.tpaga (
    tpaga_id smallint NOT NULL,
    tpaga_designacao character varying NOT NULL,
    CONSTRAINT ck_tpaga_designacao_normalized CHECK (lib.str_is_normalized((tpaga_designacao)::text))
);


--
-- TOC entry 6369 (class 0 OID 0)
-- Dependencies: 317
-- Name: TABLE tpaga; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.tpaga IS '#Tipo Pagamento - Essa entidade serve para registar as diferentes formas que o pagamento pode ser feito';


--
-- TOC entry 6370 (class 0 OID 0)
-- Dependencies: 317
-- Name: COLUMN tpaga.tpaga_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tpaga.tpaga_id IS 'Identificador único do tipo de pagamento';


--
-- TOC entry 6371 (class 0 OID 0)
-- Dependencies: 317
-- Name: COLUMN tpaga.tpaga_designacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tpaga.tpaga_designacao IS 'Corresponde a designação do tipo de pagamento';


--
-- TOC entry 380 (class 1259 OID 19962)
-- Name: vreport_caixa; Type: VIEW; Schema: report; Owner: -
--

CREATE VIEW report.vreport_caixa AS
 WITH _const(maguita_caixa_estado_fechado, maguita_caixa_estado_ativo) AS (
         SELECT (map.get('maguita_caixa_estado_fechado'::name))::smallint AS get,
            (map.get('maguita_caixa_estado_ativo'::name))::smallint AS get
        ), __report_caixa AS (
         SELECT cx.caixa_id,
            cx.caixa_code AS "CAIXA",
            cx.caixa_montantefecho AS "$ CAP. FEC.",
            cx.caixa_montantefechoposto AS "$ CAP. FEC. POS",
            cx.caixa_montanteinicial AS "$ CAP. INI.",
            cx.caixa_montanteinicialposto AS "$ CAP. INI. POS",
            cx.caixa_quantidadecheque AS "CHEQUES",
            cx.caixa_quantidadechequeposto AS "CHEQUES POS",
            cx.caixa_observacao AS "OBSERVAÇÃO",
            cx.caixa_dataregistro AS "ABERTURA",
                CASE
                    WHEN (coclose.colaborador_id IS NOT NULL) THEN cx.caixa_dataatualizacao
                    ELSE NULL::timestamp with time zone
                END AS "FECHO",
                CASE
                    WHEN (cx.caixa_estado = _const.maguita_caixa_estado_fechado) THEN 'FECHADO'::text
                    WHEN (cx.caixa_estado = _const.maguita_caixa_estado_ativo) THEN 'ABERTA'::text
                    ELSE NULL::text
                END AS "ESTADO CAIXA",
            pos.posto_designacao AS "POSTO",
            e.espaco_nome AS "ARMAZÉM",
            owner.colaborador_id AS colaborador_owner,
            owner.colaborador_nome AS "PROPRIETARIO",
            coclose.colaborador_id AS colaborador_close,
            coclose.colaborador_nome AS "ENCERADOR",
            opr.colaborador_id AS colaborador_operador,
            opr.colaborador_nome AS "OPERADOR",
            COALESCE(ct.conta_titularnif, cli.cliente_titular) AS "TITULAR",
            COALESCE(ct.conta_titularnif, cli.cliente_nif) AS "NIF",
            de.deposito_documento AS "P. RECIBO",
            tp.tpaga_designacao AS "P. MODALIDADE",
            de.deposito_docref AS "P. DOCUMENTO",
            cur.currency_code AS "P. MOEDA",
            de.deposito_montantemoeda AS "P. $RECEBIDO",
            de.deposito_taxacambio AS "P. $CÂMBIO",
            de.deposito_montante AS "P. $REC. x $CÂM.",
            de.deposito_montantetroco AS "P. $TROCO",
            de.deposito_montantefinal AS "P. $M. FINAL",
            de.deposito_data AS "P. DATA",
            de.deposito_dataregistro AS "ENTRADA",
            cli.cliente_id,
            pos.posto_id,
            e.espaco_id,
            de.deposito_id,
            cur.currency_id,
            cx.caixa_estado,
            tp.tpaga_id,
            cx._branch_uid
           FROM (((((((((((_const
             JOIN tweeks.caixa cx ON (true))
             JOIN tweeks.posto pos ON ((cx.caixa_posto_id = pos.posto_id)))
             JOIN tweeks.espaco e ON ((pos.posto_espaco_auth = e.espaco_id)))
             JOIN auth.colaborador owner ON ((cx.caixa_colaborador_id = owner.colaborador_id)))
             LEFT JOIN auth.colaborador coclose ON (((cx.caixa_colaborador_atualizacao = coclose.colaborador_id) AND (cx.caixa_estado = _const.maguita_caixa_estado_fechado))))
             LEFT JOIN tweeks.deposito de ON ((cx.caixa_id = de.deposito_caixa_id)))
             LEFT JOIN tweeks.cliente cli ON ((cli.cliente_id = de.deposito_cliente_id)))
             LEFT JOIN tweeks.conta ct ON (((cli.cliente_id = ct.conta_cliente_id) AND (ct.conta_id = ((de.deposito_referencia ->> 'conta_id'::text))::uuid) AND ((ct.conta_numerofatura)::text = (de.deposito_documento)::text))))
             LEFT JOIN auth.colaborador opr ON ((de.deposito_colaborador_id = opr.colaborador_id)))
             LEFT JOIN geoinfo.currency cur ON ((de.deposito_currency_id = cur.currency_id)))
             LEFT JOIN tweeks.tpaga tp ON ((de.deposito_tpaga_id = tp.tpaga_id)))
        )
 SELECT __report_caixa.caixa_id,
    __report_caixa."CAIXA",
    __report_caixa."$ CAP. FEC.",
    __report_caixa."$ CAP. FEC. POS",
    __report_caixa."$ CAP. INI.",
    __report_caixa."$ CAP. INI. POS",
    __report_caixa."CHEQUES",
    __report_caixa."CHEQUES POS",
    __report_caixa."OBSERVAÇÃO",
    __report_caixa."ABERTURA",
    __report_caixa."FECHO",
    __report_caixa."ESTADO CAIXA",
    __report_caixa."POSTO",
    __report_caixa."ARMAZÉM",
    __report_caixa.colaborador_owner,
    __report_caixa."PROPRIETARIO",
    __report_caixa.colaborador_close,
    __report_caixa."ENCERADOR",
    __report_caixa.colaborador_operador,
    __report_caixa."OPERADOR",
    __report_caixa."TITULAR",
    __report_caixa."NIF",
    __report_caixa."P. RECIBO",
    __report_caixa."P. MODALIDADE",
    __report_caixa."P. DOCUMENTO",
    __report_caixa."P. MOEDA",
    __report_caixa."P. $RECEBIDO",
    __report_caixa."P. $CÂMBIO",
    __report_caixa."P. $REC. x $CÂM.",
    __report_caixa."P. $TROCO",
    __report_caixa."P. $M. FINAL",
    __report_caixa."P. DATA",
    __report_caixa."ENTRADA",
    __report_caixa.cliente_id,
    __report_caixa.posto_id,
    __report_caixa.espaco_id,
    __report_caixa.deposito_id,
    __report_caixa.currency_id,
    __report_caixa.caixa_estado,
    __report_caixa.tpaga_id,
    __report_caixa._branch_uid
   FROM __report_caixa;


--
-- TOC entry 318 (class 1259 OID 17428)
-- Name: lancamento; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.lancamento (
    lancamento_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    lancamento_cliente_id uuid NOT NULL,
    lancamento_tlancamento_id smallint NOT NULL,
    lancamento_colaborador_id uuid NOT NULL,
    _tgrupo_id smallint NOT NULL,
    lancamento_colaborador_atualizacao uuid,
    lancamento_espaco_auth uuid NOT NULL,
    lancamento_sequencia bigint NOT NULL,
    lancamento_referencia jsonb NOT NULL,
    lancamento_regclass character varying,
    lancamento_refid uuid,
    lancamento_documento character varying,
    lancamento_data date DEFAULT CURRENT_DATE NOT NULL,
    lancamento_descricao character varying NOT NULL,
    lancamento_valor double precision,
    lancamento_operacao smallint NOT NULL,
    lancamento_montante double precision GENERATED ALWAYS AS ((lancamento_valor * (lancamento_operacao)::double precision)) STORED,
    lancamento_credito double precision GENERATED ALWAYS AS (
CASE
    WHEN (lancamento_operacao = 1) THEN lancamento_valor
    ELSE (0)::double precision
END) STORED NOT NULL,
    lancamento_debito double precision GENERATED ALWAYS AS (
CASE
    WHEN (lancamento_operacao = '-1'::integer) THEN lancamento_valor
    ELSE (0)::double precision
END) STORED NOT NULL,
    lancamento_estado smallint DEFAULT (map.get('maguita_transacao_estado_ativo'::name))::smallint NOT NULL,
    lancamento_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    lancamento_dataatualizacao timestamp with time zone,
    _branch_uid uuid,
    lancamento_via smallint DEFAULT 1 NOT NULL,
    lancamento_mode smallint DEFAULT (map.get('maguita_lancamento_mode_automatic'::name))::smallint NOT NULL,
    CONSTRAINT ck_lancamento_operacao CHECK ((lancamento_operacao = ANY (ARRAY['-1'::integer, 1])))
);


--
-- TOC entry 319 (class 1259 OID 17443)
-- Name: tgrupo; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.tgrupo (
    tgrupo_id smallint NOT NULL,
    tgrupo_desc character varying NOT NULL
);


--
-- TOC entry 320 (class 1259 OID 17448)
-- Name: tlancamento; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.tlancamento (
    tlancamento_id smallint NOT NULL,
    tlancamento_desc character varying NOT NULL,
    tlancamento_operacao smallint NOT NULL
);


--
-- TOC entry 381 (class 1259 OID 19969)
-- Name: vreport_conta; Type: VIEW; Schema: report; Owner: -
--

CREATE VIEW report.vreport_conta AS
 WITH _const(maguita_lancamento_mode_manual, maguita_lancamento_mode_automatic, ___conta_regclass, ___deposito_regclass) AS (
         SELECT (map.get('maguita_lancamento_mode_manual'::name))::smallint AS get,
            (map.get('maguita_lancamento_mode_automatic'::name))::smallint AS get,
            cluster.__format('tweeks.conta'::regclass) AS ___conta_regclass,
            cluster.__format('tweeks.deposito'::regclass) AS ___deposito_regclass
        ), _lancamento AS (
         SELECT __lancamento_regularizacao.ordem,
            __lancamento_regularizacao.ordem_grupo,
            __lancamento_regularizacao.cd,
            __lancamento_regularizacao.credito,
            __lancamento_regularizacao.debito,
            __lancamento_regularizacao.valor,
            __lancamento_regularizacao.entrada,
            __lancamento_regularizacao.saldo,
            __lancamento_regularizacao.resumo,
            __lancamento_regularizacao.acomulacao,
            __lancamento_regularizacao.regula_acumulacao,
            __lancamento_regularizacao.regula_montante,
            __lancamento_regularizacao.regula,
            __lancamento_regularizacao.regula_id,
            __lancamento_regularizacao.regula_refid,
            __lancamento_regularizacao.cliente_id,
            __lancamento_regularizacao.tgrupo_id,
            __lancamento_regularizacao.lancamento_id,
            __lancamento_regularizacao.lancamento_refid,
            __lancamento_regularizacao.lancamento_ref,
            __lancamento_regularizacao.lancamento_class,
            __lancamento_regularizacao.lancamento_doc,
            __lancamento_regularizacao.lancamento_data,
            __lancamento_regularizacao.lancamento_time,
            __lancamento_regularizacao.lancamento_sequencia
           FROM tweeks.__lancamento_regularizacao() __lancamento_regularizacao(ordem, ordem_grupo, cd, credito, debito, valor, entrada, saldo, resumo, acomulacao, regula_acumulacao, regula_montante, regula, regula_id, regula_refid, cliente_id, tgrupo_id, lancamento_id, lancamento_refid, lancamento_ref, lancamento_class, lancamento_doc, lancamento_data, lancamento_time, lancamento_sequencia)
        ), __conta_report AS (
         SELECT l.lancamento_sequencia AS "SEQUÊNCIA",
            cli.cliente_titular AS "CLIENTE",
            cli.cliente_nif AS "NIF",
            l.lancamento_doc AS "DOCUMENTO",
            l.credito AS "$ CREDITO",
            l.debito AS "$ DEBITO",
            l.valor AS "$ MONTANTE",
            l.entrada AS "$ RESULTADO",
            l.regula_montante AS "$ REGULARIZADO",
            tlanc.tlancamento_desc AS "TIPO",
            tg.tgrupo_desc AS "CONTA",
                CASE
                    WHEN (lanc.lancamento_operacao = 1) THEN 'CREDITO'::text
                    WHEN (lanc.lancamento_operacao = '-1'::integer) THEN 'DEBITO'::text
                    ELSE NULL::text
                END AS "OPERAÇÃO",
                CASE
                    WHEN (lanc.lancamento_mode = _const.maguita_lancamento_mode_manual) THEN 'MANUAL'::text
                    WHEN (lanc.lancamento_mode = _const.maguita_lancamento_mode_automatic) THEN 'AUTOMATICO'::text
                    ELSE NULL::text
                END AS "MODO",
            col.colaborador_nome AS "COLABORADOR",
            l.lancamento_data AS "DATA",
            l.lancamento_time AS "REGISTRO",
            lanc.lancamento_descricao AS "OBSERVAÇÃO",
            lanc.lancamento_id,
            cli.cliente_id,
                CASE
                    WHEN ((lanc.lancamento_regclass)::text = (_const.___conta_regclass)::text) THEN lanc.lancamento_refid
                    ELSE NULL::uuid
                END AS _conta_id,
                CASE
                    WHEN ((lanc.lancamento_regclass)::text = (_const.___deposito_regclass)::text) THEN lanc.lancamento_refid
                    ELSE NULL::uuid
                END AS _deposito_id,
            tg.tgrupo_id,
            tlanc.tlancamento_id,
            col.colaborador_id,
            lanc.lancamento_mode,
            lanc._branch_uid,
            lanc.lancamento_operacao
           FROM ((((((_const
             JOIN _lancamento l ON (true))
             JOIN tweeks.lancamento lanc ON ((l.lancamento_id = lanc.lancamento_id)))
             JOIN tweeks.tlancamento tlanc ON ((lanc.lancamento_tlancamento_id = tlanc.tlancamento_id)))
             JOIN tweeks.cliente cli ON ((l.cliente_id = cli.cliente_id)))
             JOIN tweeks.tgrupo tg ON ((lanc._tgrupo_id = tg.tgrupo_id)))
             JOIN auth.colaborador col ON ((lanc.lancamento_colaborador_id = col.colaborador_id)))
          ORDER BY l.lancamento_sequencia
        )
 SELECT __conta_report."SEQUÊNCIA",
    __conta_report."CLIENTE",
    __conta_report."NIF",
    __conta_report."DOCUMENTO",
    __conta_report."$ CREDITO",
    __conta_report."$ DEBITO",
    __conta_report."$ MONTANTE",
    __conta_report."$ RESULTADO",
    __conta_report."$ REGULARIZADO",
    __conta_report."TIPO",
    __conta_report."CONTA",
    __conta_report."OPERAÇÃO",
    __conta_report."MODO",
    __conta_report."COLABORADOR",
    __conta_report."DATA",
    __conta_report."REGISTRO",
    __conta_report."OBSERVAÇÃO",
    __conta_report.lancamento_id,
    __conta_report.cliente_id,
    __conta_report._conta_id,
    __conta_report._deposito_id,
    __conta_report.tgrupo_id,
    __conta_report.tlancamento_id,
    __conta_report.colaborador_id,
    __conta_report.lancamento_mode,
    __conta_report._branch_uid,
    __conta_report.lancamento_operacao
   FROM __conta_report;


--
-- TOC entry 321 (class 1259 OID 17458)
-- Name: tserie; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.tserie (
    tserie_id smallint NOT NULL,
    tserie_desc character varying NOT NULL,
    tserie_code character varying,
    tserie_seqlimit smallint DEFAULT 6 NOT NULL,
    tserie_numlimit smallint DEFAULT 7 NOT NULL
);


--
-- TOC entry 382 (class 1259 OID 19976)
-- Name: vreport_fatura; Type: VIEW; Schema: report; Owner: -
--

CREATE VIEW report.vreport_fatura AS
 WITH _const(maguita_conta_estado_fechado, maguita_conta_estado_aberto, maguita_conta_estado_anulado) AS (
         SELECT (map.get('maguita_conta_estado_fechado'::name))::smallint AS get,
            (map.get('maguita_conta_estado_aberto'::name))::smallint AS get,
            (map.get('maguita_conta_estado_anulado'::name))::smallint AS get
        )
 SELECT ct.conta_id,
    ct.conta_data AS "DATA",
    (ct.conta_dataregistro)::date AS "REGISTO",
    ct.conta_datafecho AS "FECHO",
    ct.conta_numerofatura AS "FATURA",
        CASE
            WHEN ct.conta_proforma THEN 'SIM'::text
            ELSE 'NÃO'::text
        END AS "PROFOMA",
    ct.conta_proforma,
        CASE
            WHEN (ct.conta_estado = _const.maguita_conta_estado_fechado) THEN 'FECHADO'::text
            WHEN (ct.conta_estado = _const.maguita_conta_estado_aberto) THEN 'ABERTO'::text
            ELSE NULL::text
        END AS "ESTADO",
    ct.conta_numero AS "Nº CONTA",
    ct.conta_imprensa AS "INPRESSÕES",
    ct.conta_proformavencimento AS "PROF. VENCIMENTO",
    ct.conta_estado,
    tc.tgrupo_id,
    ct._branch_uid,
    tc.tgrupo_desc AS "TIPO CONTA",
    ct.conta_montante AS "$ MONTANTE",
    ct.conta_desconto AS "$ DESCONTO",
    (ct.conta_montante - ct.conta_desconto) AS "$ PAGAR",
    c.cliente_id,
    c.cliente_titular AS "CLIENTE",
    c.cliente_nif AS "NIF",
    p.posto_id,
    p.posto_designacao AS "POSTO",
    e.espaco_id,
    e.espaco_nome AS "ARMAZÉM",
    e.espaco_codigo AS "CÓDIGO AR.",
    col_vend.colaborador_nome AS "VENDEDOR",
    col_open.colaborador_nome AS "ABERTURA",
    s.serie_numero AS "Nº SERIE",
    s.serie_designacao AS "SERIE",
    ts.tserie_desc AS "TIPO SERIE",
    col_open.colaborador_id AS colaborador_abertura,
    col_vend.colaborador_id AS colaborador_vendor,
    ts.tserie_id,
    s.serie_id
   FROM _const,
    ((((((((tweeks.conta ct
     JOIN tweeks.tgrupo tc ON ((ct._tgrupo_id = tc.tgrupo_id)))
     JOIN tweeks.posto p ON ((ct.conta_posto_fecho = p.posto_id)))
     JOIN tweeks.espaco e ON ((p.posto_espaco_auth = e.espaco_id)))
     JOIN auth.colaborador col_open ON ((ct.conta_colaborador_id = col_open.colaborador_id)))
     LEFT JOIN auth.colaborador col_vend ON ((ct.conta_colaborador_fecho = col_vend.colaborador_id)))
     LEFT JOIN tweeks.serie s ON ((ct.conta_serie_id = s.serie_id)))
     LEFT JOIN tweeks.cliente c ON ((ct.conta_cliente_id = c.cliente_id)))
     LEFT JOIN tweeks.tserie ts ON ((s.serie_tserie_id = ts.tserie_id)))
  WHERE (ct.conta_estado <> _const.maguita_conta_estado_anulado);


--
-- TOC entry 322 (class 1259 OID 17470)
-- Name: fluxo; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.fluxo (
    fluxo_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    fluxo_toperacao_id smallint NOT NULL,
    fluxo_artigo_in uuid,
    fluxo_artigo_out uuid,
    fluxo_espaco_in uuid,
    fluxo_espaco_out uuid,
    fluxo_espaco_auth uuid NOT NULL,
    fluxo_colaborador_id uuid,
    fluxo_colaborador_atualizacao uuid,
    fluxo_sequencia bigint NOT NULL,
    fluxo_quantidadein double precision,
    fluxo_quantidadeout double precision,
    fluxo_quantidadefinal double precision,
    fluxo_checkpoint smallint DEFAULT 1 NOT NULL,
    fluxo_data date,
    fluxo_documento character varying,
    fluxo_observacao character varying,
    fluxo_referencia jsonb,
    fluxo_regclass character varying,
    fluxo_refuid uuid,
    fluxo_estado smallint DEFAULT (map.get('maguita_fluxo_estado_ativo'::name))::smallint NOT NULL,
    fluxo_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    fluxo_dataatualizacao timestamp with time zone,
    _branch_uid uuid,
    CONSTRAINT ck_fluxo_checkpointo CHECK ((fluxo_checkpoint = ANY (ARRAY[1, 0]))),
    CONSTRAINT ck_fluxo_has_artigo CHECK (((true = (fluxo_artigo_in IS NOT NULL)) OR (true = (fluxo_artigo_out IS NOT NULL)))),
    CONSTRAINT ck_fluxo_has_espaco CHECK (((true = (fluxo_espaco_in IS NOT NULL)) OR (true = (fluxo_espaco_out IS NOT NULL)))),
    CONSTRAINT ck_fluxo_has_quantidade CHECK (((true = (fluxo_quantidadein IS NOT NULL)) OR (true = (fluxo_quantidadeout IS NOT NULL)) OR (true = (fluxo_quantidadefinal IS NOT NULL))))
);


--
-- TOC entry 323 (class 1259 OID 17483)
-- Name: toperacao; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.toperacao (
    toperacao_id smallint NOT NULL,
    toperacao_designacao character varying,
    toperacao_classe smallint DEFAULT 1 NOT NULL,
    toperacao_code character varying
);


--
-- TOC entry 6378 (class 0 OID 0)
-- Dependencies: 323
-- Name: TABLE toperacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.toperacao IS 'Essa entidade serve para armazenar os tipos de movimentos que pode ocorrer em um stock';


--
-- TOC entry 6379 (class 0 OID 0)
-- Dependencies: 323
-- Name: COLUMN toperacao.toperacao_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.toperacao.toperacao_id IS 'Identificador único do tipo de movimento';


--
-- TOC entry 6380 (class 0 OID 0)
-- Dependencies: 323
-- Name: COLUMN toperacao.toperacao_designacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.toperacao.toperacao_designacao IS 'Designação do tipo de movimento';


--
-- TOC entry 383 (class 1259 OID 19983)
-- Name: vreport_fluxo; Type: VIEW; Schema: report; Owner: -
--

CREATE VIEW report.vreport_fluxo AS
 SELECT top.toperacao_designacao AS "OPERAÇÃO",
        CASE
            WHEN (ain.artigo_id IS NULL) THEN (aou.artigo_nome)::text
            WHEN (aou.artigo_id IS NULL) THEN (ain.artigo_nome)::text
            WHEN (ain.artigo_id = aou.artigo_id) THEN (ain.artigo_nome)::text
            ELSE format('%s ==> %s'::text, aou.artigo_nome, ain.artigo_nome)
        END AS "ARTIGO",
        CASE
            WHEN (ein.espaco_id IS NULL) THEN (eou.espaco_nome)::text
            WHEN (eou.espaco_id IS NULL) THEN (ein.espaco_nome)::text
            WHEN (ein.espaco_id = eou.espaco_id) THEN (ein.espaco_nome)::text
            ELSE format('%s ==> %s'::text, eou.espaco_nome, ein.espaco_nome)
        END AS "ARMAZÉM",
        CASE
            WHEN (ain.artigo_id IS NULL) THEN (f.fluxo_quantidadeout)::text
            WHEN (aou.artigo_id IS NULL) THEN (f.fluxo_quantidadein)::text
            WHEN (ain.artigo_id = aou.artigo_id) THEN (f.fluxo_quantidadein)::text
            ELSE format('%s ==> %s'::text, f.fluxo_quantidadeout, f.fluxo_quantidadein)
        END AS "QT",
    f.fluxo_documento AS "DOCUMENTO",
    COALESCE(f.fluxo_data, (f.fluxo_dataregistro)::date) AS "DATA",
    c.colaborador_nome AS "COLABORADOR",
    f.fluxo_sequencia AS "SEQUENCIA",
    ain.artigo_nome AS "ART. ENTRADA",
    aou.artigo_nome AS "ART. SAÍDA",
    eou.espaco_nome AS "ARM. ORIGEM",
    ein.espaco_nome AS "ARM. DESTINO",
    COALESCE(f.fluxo_quantidadein, (0)::double precision) AS "QT+",
    COALESCE(f.fluxo_quantidadeout, (0)::double precision) AS "QT-",
    f.fluxo_dataregistro AS "REGISTO",
    f.fluxo_observacao AS "OBSERVAÇÃO",
        CASE
            WHEN (ain.artigo_id IS NULL) THEN ARRAY[aou.artigo_id]
            WHEN (aou.artigo_id IS NULL) THEN ARRAY[ain.artigo_id]
            WHEN (ain.artigo_id = aou.artigo_id) THEN ARRAY[ain.artigo_id]
            ELSE ARRAY[ain.artigo_id, aou.artigo_id]
        END AS __artigo_id,
        CASE
            WHEN (ein.espaco_id IS NULL) THEN ARRAY[eou.espaco_id]
            WHEN (eou.espaco_id IS NULL) THEN ARRAY[ein.espaco_id]
            WHEN (ein.espaco_id = eou.espaco_id) THEN ARRAY[ein.espaco_id]
            ELSE ARRAY[ein.espaco_id, eou.espaco_id]
        END AS __espaco_id,
        CASE
            WHEN (clain.classe_id IS NULL) THEN ARRAY[claout.classe_id]
            WHEN (claout.classe_id IS NULL) THEN ARRAY[clain.classe_id]
            WHEN (clain.classe_id = claout.classe_id) THEN ARRAY[clain.classe_id]
            ELSE ARRAY[clain.classe_id, claout.classe_id]
        END AS __classe_id,
    f.fluxo_referencia,
    f.fluxo_id,
    top.toperacao_id,
    ain.artigo_id AS __artigo_in,
    aou.artigo_id AS __artigo_out,
    ein.espaco_id AS __espaco_in,
    eou.espaco_id AS __espaco_out,
    clain.classe_id AS __classe_in,
    claout.classe_id AS __classe_out,
    c.colaborador_id,
    f._branch_uid
   FROM ((((((((tweeks.fluxo f
     JOIN tweeks.toperacao top ON ((f.fluxo_toperacao_id = top.toperacao_id)))
     LEFT JOIN tweeks.artigo ain ON ((f.fluxo_artigo_in = ain.artigo_id)))
     LEFT JOIN tweeks.classe clain ON ((ain.artigo_classe_id = clain.classe_id)))
     LEFT JOIN tweeks.artigo aou ON ((f.fluxo_artigo_out = aou.artigo_id)))
     LEFT JOIN tweeks.classe claout ON ((aou.artigo_classe_id = claout.classe_id)))
     LEFT JOIN tweeks.espaco ein ON ((f.fluxo_espaco_in = ein.espaco_id)))
     LEFT JOIN tweeks.espaco eou ON ((f.fluxo_espaco_out = eou.espaco_id)))
     LEFT JOIN auth.colaborador c ON ((f.fluxo_colaborador_id = c.colaborador_id)));


--
-- TOC entry 336 (class 1259 OID 17575)
-- Name: fornecedor; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.fornecedor (
    fornecedor_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    fornecedor_espaco_auth uuid NOT NULL,
    fornecedor_colaborador_id uuid NOT NULL,
    fornecedor_colaborador_atualizacao uuid,
    fornecedor_nif character varying,
    fornecedor_nome character varying,
    fornecedor_email character varying,
    fornecedor_contacto character varying,
    fornecedor_endereco character varying,
    fornecedor_estado smallint DEFAULT (map.get('maguita_fornecedor_estado_ativo'::name))::smallint NOT NULL,
    fornecedor_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    fornecedor_dataatualizacao timestamp with time zone,
    _branch_uid uuid,
    fornecedor_code character varying,
    CONSTRAINT ck_fornecedor_contacto CHECK ((lower(lib.str_nospace((fornecedor_contacto)::text)) = (fornecedor_contacto)::text)),
    CONSTRAINT ck_fornecedor_email_normalized CHECK ((lower(lib.str_nospace((fornecedor_email)::text)) = (fornecedor_email)::text)),
    CONSTRAINT ck_fornecedor_endereco_normalized CHECK (lib.str_is_normalized((fornecedor_endereco)::text)),
    CONSTRAINT ck_fornecedor_nome_normalized CHECK (lib.str_is_normalized((fornecedor_nome)::text))
);


--
-- TOC entry 6382 (class 0 OID 0)
-- Dependencies: 336
-- Name: TABLE fornecedor; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.fornecedor IS '#Fornecedor - Essa entidade armazena os fornecedores dos produtos em contacto';


--
-- TOC entry 6383 (class 0 OID 0)
-- Dependencies: 336
-- Name: COLUMN fornecedor.fornecedor_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.fornecedor.fornecedor_id IS 'Identificador único do fornecedor';


--
-- TOC entry 6384 (class 0 OID 0)
-- Dependencies: 336
-- Name: COLUMN fornecedor.fornecedor_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.fornecedor.fornecedor_colaborador_id IS 'Identificador do colaborador responsável pelo registro';


--
-- TOC entry 6385 (class 0 OID 0)
-- Dependencies: 336
-- Name: COLUMN fornecedor.fornecedor_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.fornecedor.fornecedor_colaborador_atualizacao IS 'Identificador do colaborador responsável pela última atualização';


--
-- TOC entry 6386 (class 0 OID 0)
-- Dependencies: 336
-- Name: COLUMN fornecedor.fornecedor_nif; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.fornecedor.fornecedor_nif IS 'NIF único do fornecedor';


--
-- TOC entry 6387 (class 0 OID 0)
-- Dependencies: 336
-- Name: COLUMN fornecedor.fornecedor_nome; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.fornecedor.fornecedor_nome IS 'O nome do fornecedor';


--
-- TOC entry 6388 (class 0 OID 0)
-- Dependencies: 336
-- Name: COLUMN fornecedor.fornecedor_email; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.fornecedor.fornecedor_email IS 'Email único do fornecedor';


--
-- TOC entry 6389 (class 0 OID 0)
-- Dependencies: 336
-- Name: COLUMN fornecedor.fornecedor_contacto; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.fornecedor.fornecedor_contacto IS 'Corresponde ao contacto do fornecedor';


--
-- TOC entry 6390 (class 0 OID 0)
-- Dependencies: 336
-- Name: COLUMN fornecedor.fornecedor_endereco; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.fornecedor.fornecedor_endereco IS 'Corresponde ao endereço do fornecedor';


--
-- TOC entry 6391 (class 0 OID 0)
-- Dependencies: 336
-- Name: COLUMN fornecedor.fornecedor_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.fornecedor.fornecedor_estado IS 'Estado do fornecedor no sistema
<ul>
  <li> 1 - Ativo </li>
  <li> 0 - Fechado </li>
</ul>
';


--
-- TOC entry 6392 (class 0 OID 0)
-- Dependencies: 336
-- Name: COLUMN fornecedor.fornecedor_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.fornecedor.fornecedor_dataregistro IS 'Corresponde ao instante em que o fornecedor foi registrado no sistema';


--
-- TOC entry 6393 (class 0 OID 0)
-- Dependencies: 336
-- Name: COLUMN fornecedor.fornecedor_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.fornecedor.fornecedor_dataatualizacao IS 'Corresponde ao instante em que o fornecedor foi atualizado pela última no sistema';


--
-- TOC entry 384 (class 1259 OID 19989)
-- Name: vreport_guiaentrada; Type: VIEW; Schema: report; Owner: -
--

CREATE VIEW report.vreport_guiaentrada AS
 SELECT em.entrada_lote AS "LOTE",
    em.entrada_quantidade AS "QT",
    em.entrada_descricao AS "DESCRICAO",
    em.entrada_quantidadeinicial AS "QT ANTES",
    em.entrada_validade AS "VALIDADE",
    em.entrada_custounitario AS "$ UNIT",
    (em.entrada_quantidade * em.entrada_custounitario) AS "$ TOTAL",
    g.guia_date AS "DATA",
    g.guia_documentoperacao AS "DOCUMENTO",
    g.guia_numero AS "NUMERO",
    g.guia_observacao AS "OBS",
    f.fornecedor_nome AS "FORNECEDOR",
    f.fornecedor_nif AS "F. NIF",
    f.fornecedor_code AS "CÓD. FOR.",
    e.espaco_nome AS "ARMAZEM",
    e.espaco_codigo AS "CÓD. ARM.",
    a.artigo_nome AS "ARTIGO",
    a.artigo_codigo AS "CÓD. ART.",
    cla.classe_nome AS "CATEGORIA",
    cla.classe_codigo AS "CÓD. CAT.",
    em.entrada_id,
    g.guia_uid,
    f.fornecedor_id,
    e.espaco_id,
    a.artigo_id,
    cla.classe_id,
    em._branch_uid
   FROM (((((tweeks.entrada em
     JOIN tweeks.guia g ON ((em.entrada_guia_id = g.guia_uid)))
     JOIN tweeks.artigo a ON ((em.entrada_artigo_id = a.artigo_id)))
     JOIN tweeks.classe cla ON ((a.artigo_classe_id = cla.classe_id)))
     LEFT JOIN tweeks.fornecedor f ON ((f.fornecedor_id = (((g.guia_refs -> 'fornecedor'::text) ->> 'fornecedor_id'::text))::uuid)))
     LEFT JOIN tweeks.espaco e ON ((e.espaco_id = (((g.guia_refs -> 'destino'::text) ->> 'espaco_id'::text))::uuid)));


--
-- TOC entry 385 (class 1259 OID 19996)
-- Name: vreport_guiasaida; Type: VIEW; Schema: report; Owner: -
--

CREATE VIEW report.vreport_guiasaida AS
SELECT
    NULL::uuid AS venda_id,
    NULL::character varying AS "SERIE",
    NULL::character varying AS "ARTIGO",
    NULL::character varying AS "CATEGORIA",
    NULL::character varying AS "CÓD. CAT.",
    NULL::character varying AS "ARMAZÉM",
    NULL::character varying AS "POSTO",
    NULL::character varying AS "NIF",
    NULL::character varying AS "CLIENTE",
    NULL::double precision AS "$ PREÇO",
    NULL::double precision AS "QT",
    NULL::double precision AS "$ MONT.",
    NULL::double precision AS "$ EXTRAS",
    NULL::double precision AS "$ MONT+EXT",
    NULL::double precision AS "$ IMPOSTO",
    NULL::double precision AS "$ SUBTOTAL",
    NULL::double precision AS "$ TOTAL",
    NULL::double precision AS "$ MONTANTE FINAL",
    NULL::boolean AS venda_isencao,
    NULL::text AS "IMPOSTOS",
    NULL::text AS "TAXAS",
    NULL::uuid[] AS _tipoimposto_ids,
    NULL::uuid AS artigo_id,
    NULL::date AS "DATA",
    NULL::smallint AS _tgrupo_id,
    NULL::uuid AS conta_cliente_id,
    NULL::uuid AS posto_id,
    NULL::uuid AS espaco_id,
    NULL::text AS "COLABORADOR",
    NULL::uuid AS colaborador_fecho,
    NULL::uuid AS classe_id,
    NULL::character varying AS "CÓD ARTIGO",
    NULL::uuid AS _branch_uid;


--
-- TOC entry 324 (class 1259 OID 17494)
-- Name: tipoimposto; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.tipoimposto (
    tipoimposto_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    tipoimposto_espaco_auth uuid NOT NULL,
    tipoimposto_colaborador_id uuid NOT NULL,
    tipoimposto_colaborador_atualizacao uuid,
    tipoimposto_nome character varying NOT NULL,
    tipoimposto_codigo character varying NOT NULL,
    tipoimposto_estado smallint DEFAULT (map.get('tipoimposto_estado_ativo'::name))::smallint NOT NULL,
    tipoimposto_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    tipoimposto_dataatuzaliacao timestamp with time zone,
    tipoimposto_percentagem double precision,
    tipoimposto_valor double precision,
    _branch_uid uuid
);


--
-- TOC entry 6395 (class 0 OID 0)
-- Dependencies: 324
-- Name: TABLE tipoimposto; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.tipoimposto IS 'Essa entidade serve para armazenar os impostos que devem ser aplicado aos artigos';


--
-- TOC entry 6396 (class 0 OID 0)
-- Dependencies: 324
-- Name: COLUMN tipoimposto.tipoimposto_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tipoimposto.tipoimposto_id IS 'Identificador único do artigo';


--
-- TOC entry 6397 (class 0 OID 0)
-- Dependencies: 324
-- Name: COLUMN tipoimposto.tipoimposto_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tipoimposto.tipoimposto_colaborador_id IS 'Identificador do colaborador responsável pelo registro do imposto';


--
-- TOC entry 6398 (class 0 OID 0)
-- Dependencies: 324
-- Name: COLUMN tipoimposto.tipoimposto_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tipoimposto.tipoimposto_colaborador_atualizacao IS 'Identificador do último colaborador responsável pela atualização do imposto';


--
-- TOC entry 6399 (class 0 OID 0)
-- Dependencies: 324
-- Name: COLUMN tipoimposto.tipoimposto_nome; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tipoimposto.tipoimposto_nome IS 'Corresponde ao nome do imposto';


--
-- TOC entry 6400 (class 0 OID 0)
-- Dependencies: 324
-- Name: COLUMN tipoimposto.tipoimposto_codigo; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tipoimposto.tipoimposto_codigo IS 'Corresponde ao código do imposto';


--
-- TOC entry 6401 (class 0 OID 0)
-- Dependencies: 324
-- Name: COLUMN tipoimposto.tipoimposto_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tipoimposto.tipoimposto_estado IS 'Corresponde ao estado do imposto
<ul>
  <li> 1 - Ativo </li>
  <li> 0 - Fechado </li>
</ul>';


--
-- TOC entry 6402 (class 0 OID 0)
-- Dependencies: 324
-- Name: COLUMN tipoimposto.tipoimposto_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tipoimposto.tipoimposto_dataregistro IS 'Corresponde ao instante em que o impoto foi registrado';


--
-- TOC entry 6403 (class 0 OID 0)
-- Dependencies: 324
-- Name: COLUMN tipoimposto.tipoimposto_dataatuzaliacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tipoimposto.tipoimposto_dataatuzaliacao IS 'Corresponde ao último instante em que o imposto foi atualizado';


--
-- TOC entry 386 (class 1259 OID 20003)
-- Name: vreport_imposto; Type: VIEW; Schema: report; Owner: -
--

CREATE VIEW report.vreport_imposto AS
 WITH __imposto_report AS (
         SELECT tip.tipoimposto_id,
            tip.tipoimposto_codigo AS "CODIGO",
            tip.tipoimposto_nome AS "IMPOSTO",
            art.artigo_codigo AS "CÓD. ART.",
            art.artigo_nome AS "ARTIGO",
            cla.classe_nome AS "CATEGORIA",
            cla.classe_codigo AS "CÓD. CATEGORIA",
            ct.conta_titular AS "CLIENTE",
            ct.conta_titularnif AS "NIF",
            ct.conta_numerofatura AS "FATURA",
                CASE
                    WHEN (tx.taxa_percentagem IS NOT NULL) THEN format('%s %s'::text, tx.taxa_percentagem, '%')
                    ELSE format('%s %s'::text, tx.taxa_taxa, 'STN')
                END AS "TAXA",
            ve.venda_impostoadicionar AS "+$ IMPOSTO",
            ve.venda_impostoretirar AS "-$ IMPOSTO",
            ve.venda_imposto AS "$ IMPOSTO",
                CASE
                    WHEN ve.venda_isencao THEN 'SIM'::text
                    ELSE 'NÃO'::text
                END AS "ISENÇÃO",
            ve.venda_montantesemimposto AS "$ SUBTOTAL",
            ve.venda_montantecomimposto AS "$ TOTAL",
            s.serie_id,
            s.serie_numero AS "NUM. SERIE",
            s.serie_designacao AS "SERIE",
            s.serie_numatorizacao AS "CERT. SERIE",
            ts.tserie_desc AS "TIPO SERIE",
            col.colaborador_nome AS "COLABORADOR",
            ct.conta_datafecho AS "DATA",
            (ct.conta_datafecho)::date AS _date,
            ve.venda_isencao,
            ve._branch_uid,
            col.colaborador_id,
            ts.tserie_id,
            art.artigo_id,
            ve.venda_id,
            cla.classe_id
           FROM ((((((((tweeks.tipoimposto tip
             JOIN tweeks.taxa tx ON ((tip.tipoimposto_id = tx.taxa_tipoimposto_id)))
             JOIN tweeks.venda ve ON ((tx.taxa_id = ANY (ve.venda_taxas))))
             JOIN tweeks.artigo art ON ((ve.venda_artigo_id = art.artigo_id)))
             JOIN tweeks.classe cla ON ((art.artigo_classe_id = cla.classe_id)))
             JOIN tweeks.conta ct ON ((ve.venda_conta_id = ct.conta_id)))
             JOIN auth.colaborador col ON ((ct.conta_colaborador_fecho = col.colaborador_id)))
             JOIN tweeks.serie s ON ((((ct.conta_serie ->> 'serie_id'::text))::uuid = s.serie_id)))
             JOIN tweeks.tserie ts ON ((s.serie_tserie_id = ts.tserie_id)))
        )
 SELECT __imposto_report.tipoimposto_id,
    __imposto_report."CODIGO",
    __imposto_report."IMPOSTO",
    __imposto_report."CÓD. ART.",
    __imposto_report."ARTIGO",
    __imposto_report."CATEGORIA",
    __imposto_report."CÓD. CATEGORIA",
    __imposto_report."CLIENTE",
    __imposto_report."NIF",
    __imposto_report."FATURA",
    __imposto_report."TAXA",
    __imposto_report."+$ IMPOSTO",
    __imposto_report."-$ IMPOSTO",
    __imposto_report."$ IMPOSTO",
    __imposto_report."ISENÇÃO",
    __imposto_report."$ SUBTOTAL",
    __imposto_report."$ TOTAL",
    __imposto_report.serie_id,
    __imposto_report."NUM. SERIE",
    __imposto_report."SERIE",
    __imposto_report."CERT. SERIE",
    __imposto_report."TIPO SERIE",
    __imposto_report."COLABORADOR",
    __imposto_report."DATA",
    __imposto_report._date,
    __imposto_report.venda_isencao,
    __imposto_report._branch_uid,
    __imposto_report.colaborador_id,
    __imposto_report.tserie_id,
    __imposto_report.artigo_id,
    __imposto_report.venda_id,
    __imposto_report.classe_id
   FROM __imposto_report;


--
-- TOC entry 387 (class 1259 OID 20010)
-- Name: vreport_notacredito; Type: VIEW; Schema: report; Owner: -
--

CREATE VIEW report.vreport_notacredito AS
SELECT
    NULL::uuid AS venda_id,
    NULL::character varying AS "DOCUMENTO",
    NULL::character varying AS "JUSTIFICATIVA",
    NULL::character varying AS "DOC. ORIGEM",
    NULL::character varying AS "ARTIGO",
    NULL::character varying AS "CATEGORIA",
    NULL::character varying AS "CÓD. CAT.",
    NULL::character varying AS "ARMAZÉM",
    NULL::character varying AS "POSTO",
    NULL::character varying AS "NIF",
    NULL::character varying AS "CLIENTE",
    NULL::double precision AS "$ PREÇO",
    NULL::double precision AS "QT",
    NULL::double precision AS "$ MONT.",
    NULL::double precision AS "$ EXTRAS",
    NULL::double precision AS "$ MONT+EXT",
    NULL::double precision AS "$ IMPOSTO",
    NULL::double precision AS "$ SUBTOTAL",
    NULL::double precision AS "$ TOTAL",
    NULL::double precision AS "$ MONTANTE FINAL",
    NULL::boolean AS venda_isencao,
    NULL::text AS "ISEN.",
    NULL::text AS "IMPOSTOS",
    NULL::text AS "TAXAS",
    NULL::uuid[] AS _tipoimposto_ids,
    NULL::uuid AS artigo_id,
    NULL::date AS "DATA",
    NULL::smallint AS tserie_id,
    NULL::character varying AS "SERIE",
    NULL::smallint AS _tgrupo_id,
    NULL::uuid AS conta_cliente_id,
    NULL::uuid AS posto_id,
    NULL::uuid AS espaco_id,
    NULL::text AS "COLABORADOR",
    NULL::uuid AS _branch_uid,
    NULL::uuid AS colaborador_fecho,
    NULL::uuid AS classe_id,
    NULL::uuid AS deposito_id,
    NULL::uuid AS _caixa_id,
    NULL::character varying AS "CAIXA",
    NULL::character varying AS "CÓD ARTIGO";


--
-- TOC entry 388 (class 1259 OID 20017)
-- Name: vreport_venda; Type: VIEW; Schema: report; Owner: -
--

CREATE VIEW report.vreport_venda AS
SELECT
    NULL::uuid AS venda_id,
    NULL::character varying AS "FATURA",
    NULL::character varying AS "ARTIGO",
    NULL::character varying AS "CATEGORIA",
    NULL::character varying AS "CÓD. CAT.",
    NULL::character varying AS "ARMAZÉM",
    NULL::character varying AS "POSTO",
    NULL::character varying AS "NIF",
    NULL::character varying AS "CLIENTE",
    NULL::double precision AS "$ PREÇO",
    NULL::double precision AS "QT",
    NULL::double precision AS "$ MONT.",
    NULL::double precision AS "$ EXTRAS",
    NULL::double precision AS "$ MONT+EXT",
    NULL::double precision AS "$ IMPOSTO",
    NULL::double precision AS "$ SUBTOTAL",
    NULL::double precision AS "$ TOTAL",
    NULL::double precision AS "$ MONTANTE FINAL",
    NULL::boolean AS venda_isencao,
    NULL::text AS "ISEN.",
    NULL::text AS "IMPOSTOS",
    NULL::text AS "TAXAS",
    NULL::uuid[] AS _tipoimposto_ids,
    NULL::uuid AS artigo_id,
    NULL::date AS "DATA",
    NULL::smallint AS tserie_id,
    NULL::character varying AS "SERIE",
    NULL::smallint AS _tgrupo_id,
    NULL::uuid AS conta_cliente_id,
    NULL::uuid AS posto_id,
    NULL::uuid AS espaco_id,
    NULL::text AS "COLABORADOR",
    NULL::uuid AS _branch_uid,
    NULL::uuid AS colaborador_fecho,
    NULL::uuid AS classe_id,
    NULL::uuid AS deposito_id,
    NULL::uuid AS _caixa_id,
    NULL::character varying AS "CAIXA",
    NULL::character varying AS "CÓD ARTIGO";


--
-- TOC entry 389 (class 1259 OID 20024)
-- Name: vreport_venda_artigo; Type: VIEW; Schema: report; Owner: -
--

CREATE VIEW report.vreport_venda_artigo AS
SELECT
    NULL::character varying AS "ARTIGO",
    NULL::character varying AS "CATEGORIA",
    NULL::character varying AS "CÓD. CAT.",
    NULL::character varying AS "ARMAZÉM",
    NULL::character varying AS "POSTO",
    NULL::double precision AS "QT",
    NULL::double precision AS "$ MONT.",
    NULL::double precision AS "$ EXTRAS",
    NULL::double precision AS "$ MONT+EXT",
    NULL::double precision AS "$ IMPOSTO",
    NULL::double precision AS "$ SUBTOTAL",
    NULL::double precision AS "$ TOTAL",
    NULL::text AS "IMPOSTOS",
    NULL::text AS "TAXAS",
    NULL::uuid[] AS _tipoimposto_ids,
    NULL::uuid AS artigo_id,
    NULL::smallint AS tserie_id,
    NULL::character varying AS "SERIE",
    NULL::uuid AS posto_id,
    NULL::uuid AS espaco_id,
    NULL::text AS "COLABORADOR",
    NULL::character varying AS "CAIXA",
    NULL::uuid AS _caixa_id,
    NULL::character varying AS "CÓD ARTIGO",
    NULL::uuid AS _branch_uid;


--
-- TOC entry 325 (class 1259 OID 17511)
-- Name: version; Type: TABLE; Schema: sys; Owner: -
--

CREATE TABLE sys.version (
    number integer
);


--
-- TOC entry 390 (class 1259 OID 20031)
-- Name: _temp_forece_table; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks._temp_forece_table (
    name text,
    "time" timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL
);


--
-- TOC entry 326 (class 1259 OID 17514)
-- Name: _vserie; Type: VIEW; Schema: tweeks; Owner: -
--

CREATE VIEW tweeks._vserie AS
 SELECT NULL::uuid AS serie_id,
    NULL::integer AS serie_sequencia,
    NULL::smallint AS serie_tserie_id,
    NULL::uuid AS serie_espaco_id,
    NULL::uuid AS serie_espaco_auth,
    NULL::uuid AS serie_espaco_branch,
    NULL::uuid AS serie_colaborador_id,
    NULL::uuid AS serie_colaborador_atualizacao,
    NULL::character varying AS serie_designacao,
    NULL::character varying AS serie_numero,
    NULL::integer AS serie_quantidade,
    NULL::smallint AS serie_estado,
    NULL::timestamp with time zone AS serie_dataregistro,
    NULL::timestamp with time zone AS serie_dataatualizacao,
    NULL::smallint AS _serie_estado;


--
-- TOC entry 327 (class 1259 OID 17518)
-- Name: acerto; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.acerto (
    acerto_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    acerto_espaco_auth uuid NOT NULL,
    acerto_colaborador_id uuid NOT NULL,
    acerto_colaborador_atualizacao uuid,
    acerto_quantidade double precision NOT NULL,
    acerto_correcao double precision NOT NULL,
    acerto_quantidadeinicial double precision NOT NULL,
    acerto_observacao character varying,
    acerto_estado smallint DEFAULT (map.get('acerto_estado_ativo'::name))::smallint NOT NULL,
    acerto_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    acerto_dataatualizacao timestamp with time zone,
    acerto_oprgroup uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    acerto_artigo_id uuid,
    acerto_espaco_id uuid NOT NULL,
    _branch_uid uuid,
    acerto_codigo character varying
);


--
-- TOC entry 6406 (class 0 OID 0)
-- Dependencies: 327
-- Name: TABLE acerto; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.acerto IS 'Essa entidade serve para registar os acertos feitos no stock dos produtos';


--
-- TOC entry 6407 (class 0 OID 0)
-- Dependencies: 327
-- Name: COLUMN acerto.acerto_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.acerto.acerto_id IS 'Identificador único do acerto';


--
-- TOC entry 6408 (class 0 OID 0)
-- Dependencies: 327
-- Name: COLUMN acerto.acerto_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.acerto.acerto_colaborador_id IS 'Identificador do colaborador responsavel pelo registro do acerto';


--
-- TOC entry 6409 (class 0 OID 0)
-- Dependencies: 327
-- Name: COLUMN acerto.acerto_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.acerto.acerto_colaborador_atualizacao IS 'Identificador do colaborador que atualizou o acerto pela últma vez';


--
-- TOC entry 6410 (class 0 OID 0)
-- Dependencies: 327
-- Name: COLUMN acerto.acerto_quantidade; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.acerto.acerto_quantidade IS 'A quantidade do acerto (quantidade do produto declarado presente no stock)';


--
-- TOC entry 6411 (class 0 OID 0)
-- Dependencies: 327
-- Name: COLUMN acerto.acerto_correcao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.acerto.acerto_correcao IS 'A diferença da quantidade declarada em relação a quantidade inicial (quantidade - inicial)';


--
-- TOC entry 6412 (class 0 OID 0)
-- Dependencies: 327
-- Name: COLUMN acerto.acerto_quantidadeinicial; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.acerto.acerto_quantidadeinicial IS 'Quantidade de produto que estava no stock antes do acerto';


--
-- TOC entry 6413 (class 0 OID 0)
-- Dependencies: 327
-- Name: COLUMN acerto.acerto_observacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.acerto.acerto_observacao IS 'Observação deixada no stock';


--
-- TOC entry 6414 (class 0 OID 0)
-- Dependencies: 327
-- Name: COLUMN acerto.acerto_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.acerto.acerto_estado IS 'Corresponde ao estado de acerto
<ul>
  <li> 1 - Ativo </li>
  <li> -1 - Anulado </li>
</ul>';


--
-- TOC entry 6415 (class 0 OID 0)
-- Dependencies: 327
-- Name: COLUMN acerto.acerto_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.acerto.acerto_dataregistro IS 'Corresponde a data em que o acerto foi registrado no sistema';


--
-- TOC entry 6416 (class 0 OID 0)
-- Dependencies: 327
-- Name: COLUMN acerto.acerto_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.acerto.acerto_dataatualizacao IS 'Corresponde a data em que o acerto foi atualizado pela sua última vez';


--
-- TOC entry 328 (class 1259 OID 17527)
-- Name: aloca; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.aloca (
    aloca_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    aloca_posto_id uuid NOT NULL,
    aloca_espaco_destino uuid NOT NULL,
    aloca_espaco_auth uuid NOT NULL,
    aloca_colaborador_id uuid NOT NULL,
    aloca_colaborador_atualizacao uuid,
    aloca_montante double precision DEFAULT 0 NOT NULL,
    aloca_estado smallint DEFAULT (map.get('maguita_aloca_estado_ativo'::name))::smallint NOT NULL,
    aloca_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    aloca_dataatualizacao timestamp with time zone,
    _branch_uid uuid
);


--
-- TOC entry 355 (class 1259 OID 19544)
-- Name: branch; Type: VIEW; Schema: tweeks; Owner: -
--

CREATE VIEW tweeks.branch AS
 SELECT branch.branch_uid,
    branch.branch_tbranch_id,
    branch.branch_name,
    branch.branch_path,
    branch.branch_user,
    branch.branch_workspace,
    branch.branch_licence,
    branch.branch_grants,
    branch.branch_main_user,
    branch.branch_main_workspace,
    branch.branch_clusters,
    branch.branch_date,
    branch.branch_update,
    branch.branch_state,
    branch._branch_uid
   FROM cluster.branch;


--
-- TOC entry 329 (class 1259 OID 17534)
-- Name: branchmap; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.branchmap (
    class text NOT NULL,
    map_usr text,
    map_spc text,
    map_sch text,
    map_tbl text,
    map_brc text
);


--
-- TOC entry 330 (class 1259 OID 17539)
-- Name: cambio; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.cambio (
    cambio_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    cambio_currency_id smallint NOT NULL,
    cambio_espaco_auth uuid NOT NULL,
    cambio_colaborador_id uuid NOT NULL,
    cambio_colaborador_atualizacao uuid,
    cambio_taxa double precision,
    cambio_data date DEFAULT CURRENT_DATE NOT NULL,
    cambio_estado smallint DEFAULT (map.get('cambio_estado_ativo'::name))::smallint NOT NULL,
    cambio_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    cambio_dataatualizacao timestamp with time zone,
    _branch_uid uuid
);


--
-- TOC entry 6420 (class 0 OID 0)
-- Dependencies: 330
-- Name: TABLE cambio; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.cambio IS 'Essa entidade serve para armazenar os cambios registrados';


--
-- TOC entry 6421 (class 0 OID 0)
-- Dependencies: 330
-- Name: COLUMN cambio.cambio_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.cambio.cambio_id IS 'Identificador único do cambio';


--
-- TOC entry 6422 (class 0 OID 0)
-- Dependencies: 330
-- Name: COLUMN cambio.cambio_currency_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.cambio.cambio_currency_id IS 'Identificador da moeda do cambio';


--
-- TOC entry 6423 (class 0 OID 0)
-- Dependencies: 330
-- Name: COLUMN cambio.cambio_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.cambio.cambio_colaborador_id IS 'Identificador do colaborador responsável pelo registro do cambio';


--
-- TOC entry 6424 (class 0 OID 0)
-- Dependencies: 330
-- Name: COLUMN cambio.cambio_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.cambio.cambio_colaborador_atualizacao IS 'Identificador do colaborador responsável pela atualização do cambio';


--
-- TOC entry 6425 (class 0 OID 0)
-- Dependencies: 330
-- Name: COLUMN cambio.cambio_taxa; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.cambio.cambio_taxa IS 'O valor do cambio (a taxa do cambio)';


--
-- TOC entry 6426 (class 0 OID 0)
-- Dependencies: 330
-- Name: COLUMN cambio.cambio_data; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.cambio.cambio_data IS 'A data na qual o cambio pertence (o cambio pode ser registrado com atrazo)';


--
-- TOC entry 6427 (class 0 OID 0)
-- Dependencies: 330
-- Name: COLUMN cambio.cambio_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.cambio.cambio_estado IS 'Corresponde ao estado do cambio
<ul>
  <li> 1 - Ativo </li>
  <li> 0 - Fechado </li>
</ul>';


--
-- TOC entry 6428 (class 0 OID 0)
-- Dependencies: 330
-- Name: COLUMN cambio.cambio_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.cambio.cambio_dataregistro IS 'O instante em que o cambio foi registrado';


--
-- TOC entry 6429 (class 0 OID 0)
-- Dependencies: 330
-- Name: COLUMN cambio.cambio_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.cambio.cambio_dataatualizacao IS 'O instante em que o cambio foi atualizado (fechado)';


--
-- TOC entry 331 (class 1259 OID 17546)
-- Name: chave; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.chave (
    chave_temporarai character varying NOT NULL,
    chave_definitiva character varying,
    chave_descricao character varying,
    chave_date timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL
);


--
-- TOC entry 366 (class 1259 OID 19725)
-- Name: codigoimposto; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.codigoimposto (
    codigoimposto_codigo character varying NOT NULL,
    codigoimposto_descricao character varying
);


--
-- TOC entry 332 (class 1259 OID 17552)
-- Name: custoguia; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.custoguia (
    custoguia_uid uuid DEFAULT gen_random_uuid() NOT NULL,
    custoguia_guia_uid uuid NOT NULL,
    custoguia_colaborador_id uuid NOT NULL,
    custoguia_espaco_auth uuid NOT NULL,
    custoguia_colaborador_atualizacao uuid,
    custoguia_descricao character varying NOT NULL,
    custoguia_montante double precision NOT NULL,
    custoguia_tcusto_id smallint NOT NULL,
    custoguia_estado smallint DEFAULT (map.get('maguita_custoguia_estado_ativo'::name))::smallint NOT NULL,
    custoguia_date timestamp with time zone DEFAULT clock_timestamp() NOT NULL,
    custoguia_dateupdate timestamp with time zone,
    _branch_uid uuid
);


--
-- TOC entry 333 (class 1259 OID 17560)
-- Name: dispoe; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.dispoe (
    dispoe_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    dispoe_artigo_id uuid NOT NULL,
    dispoe_artigo_item uuid NOT NULL,
    dispoe_espaco_auth uuid NOT NULL,
    dispoe_colaborador_id uuid NOT NULL,
    dispoe_colaborador_atualizacao uuid,
    dispoe_estado smallint DEFAULT (map.get('dispoe_estado_ativo'::name))::smallint NOT NULL,
    dispoe_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    dispoe_dataatualizacao timestamp with time zone,
    _branch_uid uuid
);


--
-- TOC entry 6433 (class 0 OID 0)
-- Dependencies: 333
-- Name: TABLE dispoe; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.dispoe IS 'Dispoe - Essa entidade serve para mapear os artigos (item extras) que fazem parte do artigo de venda';


--
-- TOC entry 6434 (class 0 OID 0)
-- Dependencies: 333
-- Name: COLUMN dispoe.dispoe_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.dispoe.dispoe_id IS 'Identificador único do dispoe';


--
-- TOC entry 6435 (class 0 OID 0)
-- Dependencies: 333
-- Name: COLUMN dispoe.dispoe_artigo_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.dispoe.dispoe_artigo_id IS 'Identificador do artigo de venda';


--
-- TOC entry 6436 (class 0 OID 0)
-- Dependencies: 333
-- Name: COLUMN dispoe.dispoe_artigo_item; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.dispoe.dispoe_artigo_item IS 'Identificador do artigo (item extra) associado ao artigo de venda';


--
-- TOC entry 6437 (class 0 OID 0)
-- Dependencies: 333
-- Name: COLUMN dispoe.dispoe_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.dispoe.dispoe_colaborador_id IS 'Identificador do colaborador responsável pelo registro do dispor';


--
-- TOC entry 6438 (class 0 OID 0)
-- Dependencies: 333
-- Name: COLUMN dispoe.dispoe_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.dispoe.dispoe_colaborador_atualizacao IS 'Identificador do último colaborador a atualiazar o dispoe (colaborador que desagregou o artigo item extra ao artigo)';


--
-- TOC entry 6439 (class 0 OID 0)
-- Dependencies: 333
-- Name: COLUMN dispoe.dispoe_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.dispoe.dispoe_estado IS 'Estado do dispor
<ul>
  <li> 1 - Ativo </li>
  <li> 0 - Fechado </li>
</ul>';


--
-- TOC entry 6440 (class 0 OID 0)
-- Dependencies: 333
-- Name: COLUMN dispoe.dispoe_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.dispoe.dispoe_dataregistro IS 'Corresponde ao isntante em que o dispoe foi registrado';


--
-- TOC entry 6441 (class 0 OID 0)
-- Dependencies: 333
-- Name: COLUMN dispoe.dispoe_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.dispoe.dispoe_dataatualizacao IS 'Corresponde ao instante em que o item foi atualizado pela última vez';


--
-- TOC entry 334 (class 1259 OID 17566)
-- Name: ean; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.ean (
    ean_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    ean_artigo_id uuid NOT NULL,
    ean_espaco_auth uuid NOT NULL,
    ean_colaborador_id uuid NOT NULL,
    ean_colaborador_atualizacao uuid,
    ean_code character varying NOT NULL,
    ean_dateout date,
    ean_datein date,
    ean_estado smallint DEFAULT (map.get('maguita_ean_estado_ativo'::name))::smallint NOT NULL,
    ean_date timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    ena_dateupdate timestamp with time zone,
    _branch_uid uuid
);


--
-- TOC entry 335 (class 1259 OID 17574)
-- Name: fluxo_fluxo_sequencia_seq; Type: SEQUENCE; Schema: tweeks; Owner: -
--

CREATE SEQUENCE tweeks.fluxo_fluxo_sequencia_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6444 (class 0 OID 0)
-- Dependencies: 335
-- Name: fluxo_fluxo_sequencia_seq; Type: SEQUENCE OWNED BY; Schema: tweeks; Owner: -
--

ALTER SEQUENCE tweeks.fluxo_fluxo_sequencia_seq OWNED BY tweeks.fluxo.fluxo_sequencia;


--
-- TOC entry 337 (class 1259 OID 17587)
-- Name: imposto; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.imposto (
    imposto_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    imposto_tipoimposto_id uuid NOT NULL,
    imposto_artigo_id uuid NOT NULL,
    imposto_taplicar_id smallint NOT NULL,
    imposto_espaco_auth uuid NOT NULL,
    imposto_colaborador_id uuid NOT NULL,
    imposto_colaborador_atualizacao uuid,
    imposto_percentagem double precision,
    imposto_valor double precision,
    imposto_estado smallint DEFAULT (map.get('maguita_imposto_estado_ativo'::name))::smallint NOT NULL,
    imposto_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    imposto_dataatualizacao smallint,
    _branch_uid uuid
);


--
-- TOC entry 338 (class 1259 OID 17593)
-- Name: impostovenda; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.impostovenda (
    impostovenda_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    impostovenda_venda_id uuid NOT NULL,
    impostovenda_tipoimposto_id uuid NOT NULL,
    impostovenda_espaco_auth uuid NOT NULL,
    impostovenda_colaborador_id uuid NOT NULL,
    impostovenda_colaborador_atualizacao uuid,
    impostovenda_valor double precision,
    impostovenda_percentagem double precision,
    impostovenda_estado smallint DEFAULT (map.get('impostovenda_estado_ativo'::name))::smallint NOT NULL,
    impostovenda_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    impostovenda_dataatualizacao timestamp with time zone,
    _branch_uid uuid
);


--
-- TOC entry 339 (class 1259 OID 17599)
-- Name: lancamento_lancamento_sequencia_seq; Type: SEQUENCE; Schema: tweeks; Owner: -
--

CREATE SEQUENCE tweeks.lancamento_lancamento_sequencia_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6448 (class 0 OID 0)
-- Dependencies: 339
-- Name: lancamento_lancamento_sequencia_seq; Type: SEQUENCE OWNED BY; Schema: tweeks; Owner: -
--

ALTER SEQUENCE tweeks.lancamento_lancamento_sequencia_seq OWNED BY tweeks.lancamento.lancamento_sequencia;


--
-- TOC entry 371 (class 1259 OID 19845)
-- Name: parametrizacao; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.parametrizacao (
    parametrizacao_uid uuid DEFAULT gen_random_uuid() NOT NULL,
    parametrizacao_props jsonb DEFAULT jsonb_build_object() NOT NULL,
    parametrizacao_tags character varying[] DEFAULT ARRAY[]::text[] NOT NULL,
    parametrizacao_estado smallint DEFAULT (map.get('maguita_parametrizacao_estado_ativo'::name))::smallint NOT NULL,
    parametrizacao_user_uid uuid NOT NULL,
    parametrizacao_user_update uuid,
    parametrizacao_espaco_auth uuid NOT NULL,
    parametrizacao_date timestamp with time zone DEFAULT clock_timestamp() NOT NULL,
    parametrizacao_dateupdate timestamp with time zone,
    _branch_uid uuid NOT NULL
);


--
-- TOC entry 340 (class 1259 OID 17600)
-- Name: repcolumn; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.repcolumn (
    source character varying NOT NULL,
    name character varying NOT NULL,
    show boolean DEFAULT false NOT NULL,
    init boolean DEFAULT false NOT NULL,
    format character varying,
    filter jsonb DEFAULT jsonb_build_array() NOT NULL,
    agg jsonb DEFAULT jsonb_build_array() NOT NULL,
    gen jsonb DEFAULT jsonb_build_array() NOT NULL,
    rename character varying,
    "position" smallint,
    type character varying NOT NULL
);


--
-- TOC entry 341 (class 1259 OID 17610)
-- Name: retalho; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.retalho (
    retalho_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    retalho_artigo_composto uuid NOT NULL,
    retalho_artigo_base uuid NOT NULL,
    retalho_colaborador_id uuid NOT NULL,
    retalho_espaco_auth uuid NOT NULL,
    retalho_composicao double precision NOT NULL,
    retalho_quantidade double precision NOT NULL,
    retalho_total double precision GENERATED ALWAYS AS ((retalho_composicao * retalho_quantidade)) STORED NOT NULL,
    retalho_estado smallint DEFAULT (map.get('maguita_retalho_estado_ativo'::name))::smallint NOT NULL,
    retalho_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    retalho_dataatualizacao timestamp with time zone,
    _branch_uid uuid,
    retalho_codigo character varying
);


--
-- TOC entry 342 (class 1259 OID 17619)
-- Name: seq_classe_code; Type: SEQUENCE; Schema: tweeks; Owner: -
--

CREATE SEQUENCE tweeks.seq_classe_code
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 343 (class 1259 OID 17620)
-- Name: seq_cliente_code; Type: SEQUENCE; Schema: tweeks; Owner: -
--

CREATE SEQUENCE tweeks.seq_cliente_code
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 344 (class 1259 OID 17621)
-- Name: serie_serie_sequencia_seq; Type: SEQUENCE; Schema: tweeks; Owner: -
--

CREATE SEQUENCE tweeks.serie_serie_sequencia_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 6454 (class 0 OID 0)
-- Dependencies: 344
-- Name: serie_serie_sequencia_seq; Type: SEQUENCE OWNED BY; Schema: tweeks; Owner: -
--

ALTER SEQUENCE tweeks.serie_serie_sequencia_seq OWNED BY tweeks.serie.serie_sequencia;


--
-- TOC entry 367 (class 1259 OID 19754)
-- Name: stock; Type: VIEW; Schema: tweeks; Owner: -
--

CREATE VIEW tweeks.stock AS
 SELECT __fluxo_scan.fluxo_espaco_id AS espaco_id,
    __fluxo_scan.fluxo_artigo_id AS artigo_id,
    NULL::uuid AS fluxo_espaco_in,
    NULL::uuid AS fluxo_artigo_in,
    NULL::bigint AS entrada_quantidade,
    NULL::bigint AS entradas,
    NULL::uuid AS fluxo_artigo_out,
    NULL::uuid AS fluxo_espaco_out,
    NULL::bigint AS saida_quantidade,
    NULL::bigint AS saidas,
    __fluxo_scan.fluxo_resultado AS stock_quantidade
   FROM tweeks.__fluxo_scan(NULL::uuid, NULL::uuid, true, NULL::uuid) __fluxo_scan(fluxo_artigo_id, fluxo_espaco_id, fluxo_preview, fluxo_resultado, fluxo_checkmarks, fluxo_check, fluxo_order, fluxo_end, fluxo_resume, fluxo_credito, fluxo_debito, fluxo_calc, fluxo_quantidade, fluxo_id, fluxo_date, fluxo_sequencia);


--
-- TOC entry 345 (class 1259 OID 17625)
-- Name: taplicar; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.taplicar (
    taplicar_id smallint NOT NULL,
    taplicar_descricao character varying NOT NULL
);


--
-- TOC entry 346 (class 1259 OID 17630)
-- Name: tbranch; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.tbranch (
    tbranch_id smallint NOT NULL,
    tbranch_name character varying NOT NULL,
    tbranch_configs jsonb DEFAULT jsonb_build_object()
);


--
-- TOC entry 347 (class 1259 OID 17636)
-- Name: tdocuemto; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.tdocuemto (
    tdocumento_id smallint NOT NULL,
    tdocumento_nome character varying NOT NULL
);


--
-- TOC entry 348 (class 1259 OID 17641)
-- Name: tlink; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.tlink (
    tlink_id smallint NOT NULL,
    tlink_designacao character varying
);


--
-- TOC entry 6459 (class 0 OID 0)
-- Dependencies: 348
-- Name: TABLE tlink; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.tlink IS 'Essa entidade serve para registar os tipos de links';


--
-- TOC entry 6460 (class 0 OID 0)
-- Dependencies: 348
-- Name: COLUMN tlink.tlink_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tlink.tlink_id IS 'Identificador do tipo de link';


--
-- TOC entry 6461 (class 0 OID 0)
-- Dependencies: 348
-- Name: COLUMN tlink.tlink_designacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.tlink.tlink_designacao IS 'Corresponde a designação dos tipos de link';


--
-- TOC entry 349 (class 1259 OID 17646)
-- Name: tposto; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.tposto (
    tposto_id smallint NOT NULL,
    tposto_designacao character varying
);


--
-- TOC entry 350 (class 1259 OID 17651)
-- Name: trabalha; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.trabalha (
    trabalha_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    trabalha_perfil_id uuid,
    trabalha_espaco_destino uuid NOT NULL,
    trabalha_espaco_auth uuid NOT NULL,
    trabalha_colaborador_proprietario uuid NOT NULL,
    trabalha_colaborador_id uuid NOT NULL,
    trabalha_colaborador_atualizacao uuid,
    trabalha_estado smallint DEFAULT (map.get('maguita_trabalha_estado_ativo'::name))::smallint NOT NULL,
    trabalha_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    trabalha_dataatualizacao timestamp with time zone,
    trabalha_posicao smallint,
    _branch_uid uuid
);


--
-- TOC entry 6464 (class 0 OID 0)
-- Dependencies: 350
-- Name: TABLE trabalha; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.trabalha IS 'Essa entidade serve para indicar os perfil com qual um colaborador trabalha, e tambem em qual departamento ou setor o colaborador trabalha';


--
-- TOC entry 6465 (class 0 OID 0)
-- Dependencies: 350
-- Name: COLUMN trabalha.trabalha_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.trabalha.trabalha_id IS 'Identificador único da instancia trabalha';


--
-- TOC entry 6466 (class 0 OID 0)
-- Dependencies: 350
-- Name: COLUMN trabalha.trabalha_perfil_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.trabalha.trabalha_perfil_id IS 'Identificador do perfil com qual o colaborador esta a trabalhar';


--
-- TOC entry 6467 (class 0 OID 0)
-- Dependencies: 350
-- Name: COLUMN trabalha.trabalha_espaco_auth; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.trabalha.trabalha_espaco_auth IS 'Identificaodor do local onde o colaborador trabalha (departamento, setor, direção, local, agencia, ...)';


--
-- TOC entry 6468 (class 0 OID 0)
-- Dependencies: 350
-- Name: COLUMN trabalha.trabalha_colaborador_proprietario; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.trabalha.trabalha_colaborador_proprietario IS 'Identificador do colaborador proprietario ao trabalho (colaborador com direito de trabalhar)';


--
-- TOC entry 6469 (class 0 OID 0)
-- Dependencies: 350
-- Name: COLUMN trabalha.trabalha_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.trabalha.trabalha_colaborador_id IS 'Identificador do colaborador responsável pelo registro do trabalha';


--
-- TOC entry 6470 (class 0 OID 0)
-- Dependencies: 350
-- Name: COLUMN trabalha.trabalha_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.trabalha.trabalha_colaborador_atualizacao IS 'Identificador do último colaborador responsável pela atualização do trabalha';


--
-- TOC entry 6471 (class 0 OID 0)
-- Dependencies: 350
-- Name: COLUMN trabalha.trabalha_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.trabalha.trabalha_estado IS 'Corresponde ao estado do trabalha do colaborador
<ul>
  <li> 1 - Ativo | O colaborador atualmente trabalha nesse local </li>
  <li> 0 - Desativo | O colaborador deixou de trabalhar com o perfil</li>
</ul>
';


--
-- TOC entry 6472 (class 0 OID 0)
-- Dependencies: 350
-- Name: COLUMN trabalha.trabalha_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.trabalha.trabalha_dataregistro IS 'Corresponde a data em que foi atribuido ao colaborador o direito de trabalhar com o perfil';


--
-- TOC entry 6473 (class 0 OID 0)
-- Dependencies: 350
-- Name: COLUMN trabalha.trabalha_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.trabalha.trabalha_dataatualizacao IS 'Corresponde ao último instante';


--
-- TOC entry 351 (class 1259 OID 17657)
-- Name: transferencia; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.transferencia (
    transferencia_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    transferencia_espaco_auth uuid,
    transferencia_colaborador_id uuid NOT NULL,
    transferencia_colaborador_atualizacao uuid,
    transferencia_quantidade double precision NOT NULL,
    transferencia_data date,
    transferencia_documento character varying NOT NULL,
    transferencia_observacao character varying,
    transferencia_estado smallint DEFAULT (map.get('transferencia_estado_ativo'::name))::smallint NOT NULL,
    transferencia_dataregistro timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    transferencia_dataatualizacao timestamp with time zone,
    transferencia_espaco_origem uuid,
    transferencia_espaco_destino uuid,
    transferencia_artigo_id uuid,
    _branch_uid uuid,
    transferencia_lote character varying,
    transferencia_validade date,
    transferencia_metadata json,
    transferencia_descricao character varying
);


--
-- TOC entry 6475 (class 0 OID 0)
-- Dependencies: 351
-- Name: TABLE transferencia; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON TABLE tweeks.transferencia IS 'Essa entidade serve para armazenar as transferência dos artigos entre os stock ';


--
-- TOC entry 6476 (class 0 OID 0)
-- Dependencies: 351
-- Name: COLUMN transferencia.transferencia_colaborador_id; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transferencia.transferencia_colaborador_id IS 'Identificador do colaborador responsável pelo registro de transferência do artigo entre os stocks';


--
-- TOC entry 6477 (class 0 OID 0)
-- Dependencies: 351
-- Name: COLUMN transferencia.transferencia_colaborador_atualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transferencia.transferencia_colaborador_atualizacao IS 'Identificador do colaborador responsável pela última atualização da transferencia.';


--
-- TOC entry 6478 (class 0 OID 0)
-- Dependencies: 351
-- Name: COLUMN transferencia.transferencia_quantidade; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transferencia.transferencia_quantidade IS 'Corresponde a quantidade do artigo tranferido';


--
-- TOC entry 6479 (class 0 OID 0)
-- Dependencies: 351
-- Name: COLUMN transferencia.transferencia_data; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transferencia.transferencia_data IS 'Corresponde a data efetiva da transferencia dos produtos';


--
-- TOC entry 6480 (class 0 OID 0)
-- Dependencies: 351
-- Name: COLUMN transferencia.transferencia_documento; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transferencia.transferencia_documento IS 'Corresponde ao documento da transferência';


--
-- TOC entry 6481 (class 0 OID 0)
-- Dependencies: 351
-- Name: COLUMN transferencia.transferencia_observacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transferencia.transferencia_observacao IS 'Corresponde a observação para a transferencia';


--
-- TOC entry 6482 (class 0 OID 0)
-- Dependencies: 351
-- Name: COLUMN transferencia.transferencia_estado; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transferencia.transferencia_estado IS 'Corresponde ao estado da transferencia';


--
-- TOC entry 6483 (class 0 OID 0)
-- Dependencies: 351
-- Name: COLUMN transferencia.transferencia_dataregistro; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transferencia.transferencia_dataregistro IS 'Corresponde ao isntante em que a tranferência foi registrada no sistema';


--
-- TOC entry 6484 (class 0 OID 0)
-- Dependencies: 351
-- Name: COLUMN transferencia.transferencia_dataatualizacao; Type: COMMENT; Schema: tweeks; Owner: -
--

COMMENT ON COLUMN tweeks.transferencia.transferencia_dataatualizacao IS 'Corresponde a data em que a transferência foi atualizada pela última vez no sistema';


--
-- TOC entry 370 (class 1259 OID 19803)
-- Name: unit; Type: TABLE; Schema: tweeks; Owner: -
--

CREATE TABLE tweeks.unit (
    unit_id uuid DEFAULT gen_random_uuid() NOT NULL,
    unit_code character varying NOT NULL,
    unit_name character varying NOT NULL,
    unit_state smallint DEFAULT (map.get('maguita_unit_state_active'::name))::smallint NOT NULL,
    unit_date timestamp with time zone DEFAULT clock_timestamp() NOT NULL,
    unit_update timestamp with time zone,
    unit_espaco_auth uuid NOT NULL,
    unit_user_id uuid NOT NULL,
    unit_user_update uuid,
    _branch_uid uuid NOT NULL
);


--
-- TOC entry 4531 (class 2604 OID 19554)
-- Name: auth auth_seq; Type: DEFAULT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.auth ALTER COLUMN auth_seq SET DEFAULT nextval('cluster.auth_auth_seq_seq'::regclass);


--
-- TOC entry 4281 (class 2604 OID 17665)
-- Name: collector collector_sequence; Type: DEFAULT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.collector ALTER COLUMN collector_sequence SET DEFAULT nextval('cluster.collector_collector_sequence_seq'::regclass);


--
-- TOC entry 4409 (class 2604 OID 17666)
-- Name: filter filter_id; Type: DEFAULT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.filter ALTER COLUMN filter_id SET DEFAULT nextval('cluster.filter_filter_id_seq'::regclass);


--
-- TOC entry 4410 (class 2604 OID 17667)
-- Name: filter filter_sequence; Type: DEFAULT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.filter ALTER COLUMN filter_sequence SET DEFAULT nextval('cluster.filter_filter_sequence_seq'::regclass);


--
-- TOC entry 4290 (class 2604 OID 17668)
-- Name: object object_seq; Type: DEFAULT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.object ALTER COLUMN object_seq SET DEFAULT nextval('cluster.object_object_seq_seq'::regclass);


--
-- TOC entry 4291 (class 2604 OID 17669)
-- Name: object object_sseq; Type: DEFAULT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.object ALTER COLUMN object_sseq SET DEFAULT nextval('cluster.object_object_sseq_seq'::regclass);


--
-- TOC entry 4537 (class 2604 OID 19619)
-- Name: pull pull_sequence; Type: DEFAULT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.pull ALTER COLUMN pull_sequence SET DEFAULT nextval('cluster.pull_pull_sequence_seq'::regclass);


--
-- TOC entry 4417 (class 2604 OID 17670)
-- Name: altspelling altspelling_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.altspelling ALTER COLUMN altspelling_id SET DEFAULT nextval('geoinfo.seq_altspelling'::regclass);


--
-- TOC entry 4418 (class 2604 OID 17671)
-- Name: country country_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.country ALTER COLUMN country_id SET DEFAULT nextval('geoinfo.seq_country'::regclass);


--
-- TOC entry 4419 (class 2604 OID 17672)
-- Name: countryborder countryborder_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countryborder ALTER COLUMN countryborder_id SET DEFAULT nextval('geoinfo.seq_countryborder'::regclass);


--
-- TOC entry 4420 (class 2604 OID 17673)
-- Name: countrycallcode countrycallcode_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrycallcode ALTER COLUMN countrycallcode_id SET DEFAULT nextval('geoinfo.seq_countrycallcode'::regclass);


--
-- TOC entry 4421 (class 2604 OID 17674)
-- Name: countrycurrency countrycurrency_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrycurrency ALTER COLUMN countrycurrency_id SET DEFAULT nextval('geoinfo.seq_countrycurrency'::regclass);


--
-- TOC entry 4422 (class 2604 OID 17675)
-- Name: countrylanguage countrylanguage_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrylanguage ALTER COLUMN countrylanguage_id SET DEFAULT nextval('geoinfo.seq_countrylanguage'::regclass);


--
-- TOC entry 4423 (class 2604 OID 17676)
-- Name: countryregionalbloc countryregionalbloc_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countryregionalbloc ALTER COLUMN countryregionalbloc_id SET DEFAULT nextval('geoinfo.seq_countryregionalbloc'::regclass);


--
-- TOC entry 4424 (class 2604 OID 17677)
-- Name: countrytimezone countrytimezone_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytimezone ALTER COLUMN countrytimezone_id SET DEFAULT nextval('geoinfo.seq_countrytimezone'::regclass);


--
-- TOC entry 4425 (class 2604 OID 17678)
-- Name: countrytopleveldomain countrytopleveldomain_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytopleveldomain ALTER COLUMN countrytopleveldomain_id SET DEFAULT nextval('geoinfo.seq_countrytopleveldomain'::regclass);


--
-- TOC entry 4426 (class 2604 OID 17679)
-- Name: countrytranslation countrytranslation_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytranslation ALTER COLUMN countrytranslation_id SET DEFAULT nextval('geoinfo.seq_countrytranslation'::regclass);


--
-- TOC entry 4427 (class 2604 OID 17680)
-- Name: currency currency_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.currency ALTER COLUMN currency_id SET DEFAULT nextval('geoinfo.seq_currency'::regclass);


--
-- TOC entry 4311 (class 2604 OID 17681)
-- Name: dataset dataset_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.dataset ALTER COLUMN dataset_id SET DEFAULT nextval('geoinfo.seq_dataset'::regclass);


--
-- TOC entry 4428 (class 2604 OID 17682)
-- Name: demonym demonym_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.demonym ALTER COLUMN demonym_id SET DEFAULT nextval('geoinfo.seq_demonym'::regclass);


--
-- TOC entry 4429 (class 2604 OID 17683)
-- Name: domain domain_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.domain ALTER COLUMN domain_id SET DEFAULT nextval('geoinfo.seq_domain'::regclass);


--
-- TOC entry 4430 (class 2604 OID 17684)
-- Name: language language_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.language ALTER COLUMN language_id SET DEFAULT nextval('geoinfo.seq_language'::regclass);


--
-- TOC entry 4431 (class 2604 OID 17685)
-- Name: region region_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.region ALTER COLUMN region_id SET DEFAULT nextval('geoinfo.seq_region'::regclass);


--
-- TOC entry 4432 (class 2604 OID 17686)
-- Name: regionalbloc regionalbloc_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.regionalbloc ALTER COLUMN regionalbloc_id SET DEFAULT nextval('geoinfo.seq_regionalbloc'::regclass);


--
-- TOC entry 4433 (class 2604 OID 17687)
-- Name: regionalblocname regionalblocname_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.regionalblocname ALTER COLUMN regionalblocname_id SET DEFAULT nextval('geoinfo.seq_regionalblocname'::regclass);


--
-- TOC entry 4434 (class 2604 OID 17688)
-- Name: regionalblocother regionalblocother_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.regionalblocother ALTER COLUMN regionalblocother_id SET DEFAULT nextval('geoinfo.seq_regionalblocother'::regclass);


--
-- TOC entry 4435 (class 2604 OID 17689)
-- Name: subregion subregion_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.subregion ALTER COLUMN subregion_id SET DEFAULT nextval('geoinfo.seq_subregion'::regclass);


--
-- TOC entry 4436 (class 2604 OID 17690)
-- Name: timezone timezone_id; Type: DEFAULT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.timezone ALTER COLUMN timezone_id SET DEFAULT nextval('geoinfo.seq_timezone'::regclass);


--
-- TOC entry 4527 (class 2604 OID 19483)
-- Name: revision seq; Type: DEFAULT; Schema: patch; Owner: -
--

ALTER TABLE ONLY patch.revision ALTER COLUMN seq SET DEFAULT nextval('patch.revision_seq_seq'::regclass);


--
-- TOC entry 4466 (class 2604 OID 17691)
-- Name: fluxo fluxo_sequencia; Type: DEFAULT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fluxo ALTER COLUMN fluxo_sequencia SET DEFAULT nextval('tweeks.fluxo_fluxo_sequencia_seq'::regclass);


--
-- TOC entry 4454 (class 2604 OID 17692)
-- Name: lancamento lancamento_sequencia; Type: DEFAULT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.lancamento ALTER COLUMN lancamento_sequencia SET DEFAULT nextval('tweeks.lancamento_lancamento_sequencia_seq'::regclass);


--
-- TOC entry 5404 (class 0 OID 17148)
-- Dependencies: 256
-- Data for Name: acesso; Type: TABLE DATA; Schema: auth; Owner: -
--

COPY auth.acesso (acesso_id, acesso_menu_id, acesso_colaborador_propetario, acesso_colaborador_id, acesso_colaborador_atualizacao, acesso_estado, acesso_dataregisto, acesso_dataatualizacao, _branch_uid) FROM stdin;
65d0afa3-ad3e-4a4d-99e7-abd5571be938	89	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
671ce36d-263a-49a4-8351-900a82cbf4be	87	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
11fc414a-7007-4bc5-8c95-7e932482156b	90	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
bc7e0bd3-ffa7-4a62-ada3-9ddfa1859ac4	98	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
1b779756-d2dc-40db-a722-77487a8381a8	93	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
7aaeae52-2623-4367-8001-c87c8888341a	94	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
b28213d7-7097-431b-9a64-dcb36e4ae5b2	88	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
41d545e3-f34c-410e-a3ae-d6e19c305874	69	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
c50c348c-2cf9-4a0c-93ad-39960dc35da5	70	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
1d1a0ee6-2022-4dd9-afd0-083c30b3af1f	74	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
e5a6e3d8-cea3-4c21-b4f4-fadc101970a1	71	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
3d4b68bc-c9b1-4e19-9f42-ad115adcc485	75	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
c0588062-5d0c-416c-be1c-7ed6c2575ab1	77	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
8552fd27-ad58-4c4f-aab3-441643d3a95a	95	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
e3834776-9943-4df0-8333-fc3278da6d78	100	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
b2165ac7-1a0c-44b3-a52f-f3c03b9ee65d	113	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
039ec14c-c824-4aa7-af1f-299d783d2fd9	114	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
4dc334e8-5ef3-4ea4-bf9e-66be9c9a8644	102	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
97cfcb1e-f807-4142-8bf6-8cf9e64a7040	104	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
796f92a7-4a2f-454e-be8d-df38ec9ba3f9	106	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
cc8761f3-3bf8-474d-9446-f5b0e9d8de30	107	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
936a46d5-8897-4999-a2bf-60838ce6c8f2	108	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
fc5406e5-e17a-4b2c-a54c-6b8b94ec277a	109	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
1c190c2d-fd87-4170-9992-c0e126147a66	110	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
c4c59270-2a45-45ad-8bf4-c43249c63a17	111	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
390e6063-9fa0-4da4-a6b0-88cb55b34c6f	112	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.11521+00	\N	\N
\.


--
-- TOC entry 5405 (class 0 OID 17154)
-- Dependencies: 257
-- Data for Name: autenticacao; Type: TABLE DATA; Schema: auth; Owner: -
--

COPY auth.autenticacao (autenticacao_id, autenticacao_colaborador_id, autenticacao_chave, autenticacao_estado, autenticacao_dataregisto, autenticacao_dataatualizacao) FROM stdin;
\.


--
-- TOC entry 5379 (class 0 OID 16433)
-- Dependencies: 231
-- Data for Name: colaborador; Type: TABLE DATA; Schema: auth; Owner: -
--

COPY auth.colaborador (colaborador_id, colaborador_tsexo_id, colaborador_colaborador_id, colaborador_colaborador_atualizacao, colaborador_espaco_auth, colaborador_nome, colaborador_apelido, colaborador_email, colaborador_nif, colaborador_datanascimento, colaborador_senha, colaborador_pin, colaborador_pinmodo, colaborador_senhamodo, colaborador_accesso, colaborador_tipo, colaborador_foto, colaborador_token, colaborador_tokenlimit, colaborador_dataultimaatualizacasenha, colaborador_dataultimologin, colaborador_ficha, colaborador_estado, colaborador_dataregisto, colaborador_dataatualizacao, colaborador_branch_uid) FROM stdin;
00000000-0000-0000-0000-000000000001	\N	00000000-0000-0000-0000-000000000001	\N	\N	Database	System	root@maguita	\N	\N	\N	\N	\N	\N	0	0	\N	\N	\N	\N	\N	\N	1	2023-09-29 11:51:29.980735+00	\N	\N
00000000-0000-0000-0000-000000000002	\N	00000000-0000-0000-0000-000000000001	\N	00000000-0000-0000-0000-000000000001	Support	System	admin@maguita	\N	\N	169137ea3035455575570ab8865c9ac6	\N	\N	\N	1	2	\N	\N	\N	\N	\N	\N	1	2023-09-29 11:51:29.980735+00	\N	\N
\.


--
-- TOC entry 5392 (class 0 OID 16822)
-- Dependencies: 244
-- Data for Name: menu; Type: TABLE DATA; Schema: auth; Owner: -
--

COPY auth.menu (menu_id, menu_menu_id, menu_codigo, menu_raiz, menu_nivel, menu_icon, menu_nome, menu_link, menu_estado, menu_children, menu_maxnode, menu_directchildern, menu_position) FROM stdin;
89	71	maguita.pos.remover	71	1	\N	Remover artigos depois de confirmar conta	\N	1	0	0	0	0
104	71	maguita.pos.alterar_preco	71	1	\N	Alterar preço de artigo no carrinho	\N	1	0	0	0	0
107	\N	maguita.entrada.artigos		0	<svg x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;"\n\t\t\t\t\t\t\txml:space="preserve">\n\t\t\t\t\t\t\t<g>\n\t\t\t\t\t\t\t\t<g>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td="M472,313v139c0,11.028-8.972,20-20,20H60c-11.028,0-20-8.972-20-20V313H0v139c0,33.084,26.916,60,60,60h392 c33.084,0,60-26.916,60-60V313H472z" />\n\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t<g>\n\t\t\t\t\t\t\t\t<g>\n\t\t\t\t\t\t\t\t\t<polygon\n\t\t\t\t\t\t\t\t\t\tpoints="352,235.716 276,311.716 276,0 236,0 236,311.716 160,235.716 131.716,264 256,388.284 380.284,264" />\n\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t</svg>	Guia de Entrada	../includes/guiaEntrada.html	1	0	0	0	3
87	71	maguita.pos.adicionar	71	1	\N	Adicionar artigos depois de confirmar conta	\N	1	0	0	0	0
90	71	maguita.pos.vendas	71	1	\N	Vendas	\N	1	0	0	0	0
98	71	maquita.pos.anularconta	71	1	\N	Anular conta	\N	1	0	0	0	0
93	71	maguita.pos.imprimir.conta	71	1	\N	Impressão de conta	\N	1	0	0	0	0
94	71	maguita.pos.pagamentoDireto	71	1	\N	Pagamento direto	\N	1	0	0	0	0
88	71	maguita.pos.diminuirQuantidade	71	1	\N	Diminuir quantidade de artigos depois de confirmado	\N	1	0	0	0	0
69	\N	maguita.definicao		0	\t\t<svg enable-background="new 0 0 512 512" viewBox="0 0 512 512">\n                  <path\n                    d="m272.066 512h-32.133c-25.989 0-47.134-21.144-47.134-47.133v-10.871c-11.049-3.53-21.784-7.986-32.097-13.323l-7.704 7.704c-18.659 18.682-48.548 18.134-66.665-.007l-22.711-22.71c-18.149-18.129-18.671-48.008.006-66.665l7.698-7.698c-5.337-10.313-9.792-21.046-13.323-32.097h-10.87c-25.988 0-47.133-21.144-47.133-47.133v-32.134c0-25.989 21.145-47.133 47.134-47.133h10.87c3.531-11.05 7.986-21.784 13.323-32.097l-7.704-7.703c-18.666-18.646-18.151-48.528.006-66.665l22.713-22.712c18.159-18.184 48.041-18.638 66.664.006l7.697 7.697c10.313-5.336 21.048-9.792 32.097-13.323v-10.87c0-25.989 21.144-47.133 47.134-47.133h32.133c25.989 0 47.133 21.144 47.133 47.133v10.871c11.049 3.53 21.784 7.986 32.097 13.323l7.704-7.704c18.659-18.682 48.548-18.134 66.665.007l22.711 22.71c18.149 18.129 18.671 48.008-.006 66.665l-7.698 7.698c5.337 10.313 9.792 21.046 13.323 32.097h10.87c25.989 0 47.134 21.144 47.134 47.133v32.134c0 25.989-21.145 47.133-47.134 47.133h-10.87c-3.531 11.05-7.986 21.784-13.323 32.097l7.704 7.704c18.666 18.646 18.151 48.528-.006 66.665l-22.713 22.712c-18.159 18.184-48.041 18.638-66.664-.006l-7.697-7.697c-10.313 5.336-21.048 9.792-32.097 13.323v10.871c0 25.987-21.144 47.131-47.134 47.131zm-106.349-102.83c14.327 8.473 29.747 14.874 45.831 19.025 6.624 1.709 11.252 7.683 11.252 14.524v22.148c0 9.447 7.687 17.133 17.134 17.133h32.133c9.447 0 17.134-7.686 17.134-17.133v-22.148c0-6.841 4.628-12.815 11.252-14.524 16.084-4.151 31.504-10.552 45.831-19.025 5.895-3.486 13.4-2.538 18.243 2.305l15.688 15.689c6.764 6.772 17.626 6.615 24.224.007l22.727-22.726c6.582-6.574 6.802-17.438.006-24.225l-15.695-15.695c-4.842-4.842-5.79-12.348-2.305-18.242 8.473-14.326 14.873-29.746 19.024-45.831 1.71-6.624 7.684-11.251 14.524-11.251h22.147c9.447 0 17.134-7.686 17.134-17.133v-32.134c0-9.447-7.687-17.133-17.134-17.133h-22.147c-6.841 0-12.814-4.628-14.524-11.251-4.151-16.085-10.552-31.505-19.024-45.831-3.485-5.894-2.537-13.4 2.305-18.242l15.689-15.689c6.782-6.774 6.605-17.634.006-24.225l-22.725-22.725c-6.587-6.596-17.451-6.789-24.225-.006l-15.694 15.695c-4.842 4.843-12.35 5.791-18.243 2.305-14.327-8.473-29.747-14.874-45.831-19.025-6.624-1.709-11.252-7.683-11.252-14.524v-22.15c0-9.447-7.687-17.133-17.134-17.133h-32.133c-9.447 0-17.134 7.686-17.134 17.133v22.148c0 6.841-4.628 12.815-11.252 14.524-16.084 4.151-31.504 10.552-45.831 19.025-5.896 3.485-13.401 2.537-18.243-2.305l-15.688-15.689c-6.764-6.772-17.627-6.615-24.224-.007l-22.727 22.726c-6.582 6.574-6.802 17.437-.006 24.225l15.695 15.695c4.842 4.842 5.79 12.348 2.305 18.242-8.473 14.326-14.873 29.746-19.024 45.831-1.71 6.624-7.684 11.251-14.524 11.251h-22.148c-9.447.001-17.134 7.687-17.134 17.134v32.134c0 9.447 7.687 17.133 17.134 17.133h22.147c6.841 0 12.814 4.628 14.524 11.251 4.151 16.085 10.552 31.505 19.024 45.831 3.485 5.894 2.537 13.4-2.305 18.242l-15.689 15.689c-6.782 6.774-6.605 17.634-.006 24.225l22.725 22.725c6.587 6.596 17.451 6.789 24.225.006l15.694-15.695c3.568-3.567 10.991-6.594 18.244-2.304z" />\n                  <path\n                    d="m256 367.4c-61.427 0-111.4-49.974-111.4-111.4s49.973-111.4 111.4-111.4 111.4 49.974 111.4 111.4-49.973 111.4-111.4 111.4zm0-192.8c-44.885 0-81.4 36.516-81.4 81.4s36.516 81.4 81.4 81.4 81.4-36.516 81.4-81.4-36.515-81.4-81.4-81.4z" />\n                </svg>	Definições	../includes/settings.html	1	0	0	0	4
106	\N	maguita.transferencia.artigos		0	<svg x="0px" y="0px" viewBox="0 0 477.859 477.859"\n\t\t\t\t\t\t\tstyle="enable-background:new 0 0 477.859 477.859;" xml:space="preserve">\n\t\t\t\t\t\t\t<g>\n\t\t\t\t\t\t\t\t<g>\n\t\t\t\t\t\t\t\t\t<path d="M472.863,175.662L353.396,56.195c-6.666-6.664-17.472-6.662-24.136,0.004c-3.199,3.2-4.996,7.538-4.997,12.063v51.2\n\t\t\t\t\t\tH204.796c-9.426,0-17.067,7.641-17.067,17.067c0,9.426,7.641,17.067,17.067,17.067H341.33c9.426,0,17.067-7.641,17.067-17.067\n\t\t\t\t\t\tV109.46l78.268,78.268l-78.268,78.268v-27.068c0-9.426-7.641-17.067-17.067-17.067H153.596v-51.2\n\t\t\t\t\t\tc-0.002-9.426-7.645-17.065-17.07-17.063c-4.524,0.001-8.863,1.798-12.063,4.997L4.997,278.062\n\t\t\t\t\t\tc-6.663,6.665-6.663,17.468,0,24.132l119.467,119.467c3.2,3.201,7.54,5,12.066,5.001c2.243,0.007,4.466-0.434,6.536-1.297\n\t\t\t\t\t\tc6.376-2.644,10.532-8.867,10.53-15.77v-51.2h119.467c9.426,0,17.067-7.641,17.067-17.067s-7.641-17.067-17.067-17.067H136.53\n\t\t\t\t\t\tc-9.426,0-17.067,7.641-17.067,17.067v27.068l-78.268-78.268l78.268-78.268v27.068c0,9.426,7.641,17.067,17.067,17.067h187.733\n\t\t\t\t\t\tv51.2c0.002,9.426,7.645,17.065,17.07,17.063c4.524-0.001,8.863-1.798,12.063-4.997l119.467-119.467\n\t\t\t\t\t\tC479.525,193.129,479.525,182.326,472.863,175.662z" />\n\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t</svg>	Transferência de Artigos	../includes/transferArticles.html	1	0	0	0	3
108	\N	maguita.saida.artigos		0	<?xml version="1.0" ?><!DOCTYPE svg  PUBLIC '-//W3C//DTD SVG 1.1//EN'  'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'><svg enable-background="new 0 0 32 32"  id="Слой_1" version="1.1" viewBox="0 0 32 32"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Share"><path clip-rule="evenodd" d="M8.624,21.336h2.015c1.402-7.953,8.329-14,16.684-14   c0.35,0,0.683,0.003,1.019,0.006l-3.664,3.663c-0.391,0.391-0.391,1.023,0,1.414c0.195,0.195,0.451,0.293,0.707,0.293   c0.256,0,0.512-0.098,0.707-0.293L32,6.356l-5.907-6.063c-0.391-0.391-1.023-0.391-1.414,0c-0.391,0.391-0.391,1.023,0,1.414   l3.631,3.631c-0.318-0.001-0.62-0.003-0.945-0.003C17.895,5.336,10.066,12.271,8.624,21.336z" fill="#121313" fill-rule="evenodd"/><path clip-rule="evenodd" d="M29,15c-0.552,0-1,0.448-1,1v14H2V10h9c0.552,0,1-0.448,1-1   c0-0.552-0.448-1-1-1h-0.03H2c-1.104,0-2,0.896-2,2v20c0,1.104,0.896,2,2,2h26c1.104,0,2-0.896,2-2V16C30,15.448,29.552,15,29,15z" fill="#121313" fill-rule="evenodd"/></g><g/><g/><g/><g/><g/><g/></svg>	Guia de Saída	../includes/guiaSaida.html	1	0	0	0	3
109	\N	maguita.clientes		0	<?xml version="1.0" encoding="iso-8859-1"?>\n<!-- Generator: Adobe Illustrator 22.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">\n<g id="Layer_1">\n\t<path d="M19.38,19.265C13.464,20.481,9,25.729,9,32v17h32V32c0-6.271-4.464-11.519-10.38-12.735C33.261,17.464,35,14.431,35,11\n\t\tc0-5.514-4.486-10-10-10S15,5.486,15,11C15,14.431,16.739,17.464,19.38,19.265z M28,21c6.065,0,11,4.935,11,11v15H11V32\n\t\tc0-6.065,4.935-11,11-11H28z M25,3c4.411,0,8,3.589,8,8s-3.589,8-8,8s-8-3.589-8-8S20.589,3,25,3z"/>\n</g>\n<g>\n</g>\n</svg>	Clientes	../includes/customers.html	1	0	0	0	3
116	71	maguita.pos.report	71	1	\N	Relatório	\N	1	0	0	0	0
117	71	maguita.pos.conta	71	1	\N	..........	\N	1	0	0	0	0
111	\N	maguita.fatura		0	<?xml version="1.0" encoding="iso-8859-1"?>\n<!-- Generator: Adobe Illustrator 22.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 100.25 100.25" style="enable-background:new 0 0 100.25 100.25;" xml:space="preserve">\n<path d="M79.567,29.924l-18.26-18.479C61.025,11.16,60.641,11,60.24,11H20.5c-0.828,0-1.5,0.672-1.5,1.5v75\n\tc0,0.828,0.672,1.5,1.5,1.5h58c0.828,0,1.5-0.672,1.5-1.5V30.979C80,30.585,79.845,30.206,79.567,29.924z M62,16.415L74.929,29.5H62\n\tV16.415z M22,86V14h37v17c0,0.828,0.672,1.5,1.5,1.5H77V86H22z"/>\n</svg>	Fatura	../includes/fatura.html	1	0	0	0	3
112	\N	maguita.fornecedores		0	<?xml version="1.0" ?><svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><title/><g id="User"><path d="M41.2452,33.0349a16,16,0,1,0-18.49,0A26.0412,26.0412,0,0,0,4,58a2,2,0,0,0,2,2H58a2,2,0,0,0,2-2A26.0412,26.0412,0,0,0,41.2452,33.0349ZM20,20A12,12,0,1,1,32,32,12.0137,12.0137,0,0,1,20,20ZM8.09,56A22.0293,22.0293,0,0,1,30,36h4A22.0293,22.0293,0,0,1,55.91,56Z"/></g></svg>	Fornecedores	../includes/providers.html	1	0	0	0	3
70	\N	maguita.relatorio		0	\t<svg x="0px" y="0px" viewBox="0 0 512.001 512.001" style="enable-background:new 0 0 512.001 512.001;" xml:space="preserve">\n                  <g>\n                    <g>\n                      <path d="M506.35,80.699c-7.57-7.589-19.834-7.609-27.43-0.052L331.662,227.31l-42.557-42.557c-7.577-7.57-19.846-7.577-27.423,0\n                      L89.076,357.36c-7.577,7.57-7.577,19.853,0,27.423c3.782,3.788,8.747,5.682,13.712,5.682c4.958,0,9.93-1.894,13.711-5.682\n                      l158.895-158.888l42.531,42.524c7.57,7.57,19.808,7.577,27.397,0.032l160.97-160.323\n                      C513.881,100.571,513.907,88.288,506.35,80.699z" />\n                    </g>\n                  </g>\n                  <g>\n                    <g>\n                      <path d="M491.96,449.94H38.788V42.667c0-10.712-8.682-19.394-19.394-19.394S0,31.955,0,42.667v426.667\n                      c0,10.712,8.682,19.394,19.394,19.394H491.96c10.712,0,19.394-8.682,19.394-19.394C511.354,458.622,502.672,449.94,491.96,449.94z\n                      " />\n                    </g>\n                  </g>\n                  <g>\n                    <g>\n                      <path d="M492.606,74.344H347.152c-10.712,0-19.394,8.682-19.394,19.394s8.682,19.394,19.394,19.394h126.061v126.067\n                      c0,10.705,8.682,19.394,19.394,19.394S512,249.904,512,239.192V93.738C512,83.026,503.318,74.344,492.606,74.344z" />\n                    </g>\n                  </g>\n                </svg>	Relatórios	../includes/report.html	1	0	0	0	3
74	\N	maguita.artigo		0	<svg enable-background="new 0 0 511.414 511.414" viewBox="0 0 511.414 511.414"><path d="m497.695 108.838c0-6.488-3.919-12.334-9.92-14.8l-225.988-92.838c-3.896-1.6-8.264-1.6-12.16 0l-225.988 92.838c-6.001 2.465-9.92 8.312-9.92 14.8v293.738c0 6.488 3.918 12.334 9.92 14.8l225.988 92.838c3.854 1.583 8.186 1.617 12.14-.001.193-.064-8.363 3.445 226.008-92.837 6.002-2.465 9.92-8.312 9.92-14.8zm-241.988 76.886-83.268-34.207 179.951-78.501 88.837 36.495zm-209.988-51.67 71.841 29.513v83.264c0 8.836 7.164 16 16 16s16-7.164 16-16v-70.118l90.147 37.033v257.797l-193.988-79.692zm209.988-100.757 55.466 22.786-179.951 78.501-61.035-25.074zm16 180.449 193.988-79.692v257.797l-193.988 79.692z"/></svg>	Artigos	../includes/artigos.html	1	0	0	0	2
71	\N	maguita.pos		0		Pos	\N	1	0	0	0	1
75	\N	maguita.colaboradores		0	<svg viewBox="0 0 512 512"><path d="m471.386719 325.011719c-16.96875-14.910157-37.546875-27.792969-61.167969-38.289063-10.097656-4.484375-21.914062.0625-26.398438 10.15625-4.484374 10.09375.0625 21.910156 10.15625 26.398438 19.917969 8.851562 37.082032 19.542968 51.007813 31.78125 17.167969 15.085937 27.015625 36.929687 27.015625 59.941406v37c0 11.027344-8.972656 20-20 20h-392c-11.027344 0-20-8.972656-20-20v-37c0-23.011719 9.847656-44.855469 27.015625-59.941406 20.207031-17.757813 79.082031-59.058594 188.984375-59.058594 81.605469 0 148-66.394531 148-148s-66.394531-148-148-148-148 66.394531-148 148c0 47.707031 22.695312 90.207031 57.851562 117.289062-64.328124 14.140626-104.34375 41.359376-125.238281 59.722657-25.808593 22.675781-40.613281 55.472656-40.613281 89.988281v37c0 33.085938 26.914062 60 60 60h392c33.085938 0 60-26.914062 60-60v-37c0-34.515625-14.804688-67.3125-40.613281-89.988281zm-323.386719-177.011719c0-59.550781 48.449219-108 108-108s108 48.449219 108 108-48.449219 108-108 108-108-48.449219-108-108zm0 0"/></svg>	Colaboradores	../includes/colabs.html	1	0	0	0	5
77	71	maguita.pos.contacorrente	71	1	\N	Conta corrente	\N	1	0	0	0	0
95	71	maguita.pos.criar.proforma	71	1	\N	Criar proforma	\N	1	0	0	0	0
100	71	maguita.pos.retalho	71	1	\N	Retalho de artigos	\N	1	0	0	0	0
113	\N	maguita.utentes		0	<?xml version="1.0" encoding="iso-8859-1"?>\n<!-- Generator: Adobe Illustrator 22.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">\n<g id="Layer_1">\n\t<path d="M19.38,19.265C13.464,20.481,9,25.729,9,32v17h32V32c0-6.271-4.464-11.519-10.38-12.735C33.261,17.464,35,14.431,35,11\n\t\tc0-5.514-4.486-10-10-10S15,5.486,15,11C15,14.431,16.739,17.464,19.38,19.265z M28,21c6.065,0,11,4.935,11,11v15H11V32\n\t\tc0-6.065,4.935-11,11-11H28z M25,3c4.411,0,8,3.589,8,8s-3.589,8-8,8s-8-3.589-8-8S20.589,3,25,3z"/>\n</g>\n<g>\n</g>\n</svg>	Utentes	../includes/utentes.html	1	0	0	0	3
114	\N	maguita.calendar		0	<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar2-check" viewBox="0 0 16 16"> <path d="M10.854 8.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708 0z"/> <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H2z"/> <path d="M2.5 4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V4z"/> </svg>	Agenda	../includes/calendar.html	1	0	0	0	3
102	\N	maguita.contacorrente	103	0	<svg  enable-background="new 0 0 512 512" viewBox="0 0 512 512"><g><path d="m436.812 75.188c-48.485-48.486-112.699-75.188-180.812-75.188s-132.327 26.702-180.812 75.188c-48.486 48.485-75.188 112.699-75.188 180.812s26.702 132.327 75.188 180.812c48.485 48.486 112.699 75.188 180.812 75.188s132.327-26.702 180.812-75.188c48.486-48.485 75.188-112.699 75.188-180.812s-26.702-132.327-75.188-180.812zm-180.812 406.812c-124.617 0-226-101.383-226-226s101.383-226 226-226 226 101.383 226 226-101.383 226-226 226z"/><path d="m256 61c-107.523 0-195 87.477-195 195s87.477 195 195 195 195-87.477 195-195-87.477-195-195-195zm0 360c-90.981 0-165-74.019-165-165s74.019-165 165-165 165 74.019 165 165-74.019 165-165 165z"/><path d="m301 210.848c0 8.284 6.716 15 15 15s15-6.716 15-15c0-16.612-8.592-32.584-23.574-43.82-10.233-7.675-22.824-12.802-36.426-14.983v-16.198c0-8.284-6.716-15-15-15s-15 6.716-15 15v16.198c-13.603 2.181-26.194 7.308-36.426 14.983-14.982 11.236-23.574 27.208-23.574 43.82s8.592 32.583 23.574 43.82c10.233 7.675 22.824 12.802 36.426 14.983v59.409c-17.28-4.223-30-15.437-30-28.212 0-8.284-6.716-15-15-15s-15 6.716-15 15c0 16.612 8.592 32.583 23.574 43.82 10.233 7.675 22.824 12.802 36.426 14.983v16.349c0 8.284 6.716 15 15 15s15-6.716 15-15v-16.349c13.603-2.181 26.194-7.308 36.426-14.983 14.982-11.236 23.574-27.208 23.574-43.82s-8.592-32.584-23.574-43.82c-10.233-7.675-22.824-12.802-36.426-14.983v-59.409c17.28 4.224 30 15.437 30 28.212zm-90 0c0-12.775 12.72-23.989 30-28.212v56.423c-17.28-4.222-30-15.436-30-28.211zm90 90c0 12.775-12.72 23.989-30 28.212v-56.423c17.28 4.223 30 15.436 30 28.211z"/></g></svg>	Conta corrente	../includes/accurent.html	1	0	0	0	0
110	\N	maguita.proforma		0	<?xml version="1.0" encoding="iso-8859-1"?>\n<!-- Generator: Adobe Illustrator 22.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 100.25 100.25" style="enable-background:new 0 0 100.25 100.25;" xml:space="preserve">\n<path d="M79.567,29.924l-18.26-18.479C61.025,11.16,60.641,11,60.24,11H20.5c-0.828,0-1.5,0.672-1.5,1.5v75\n\tc0,0.828,0.672,1.5,1.5,1.5h58c0.828,0,1.5-0.672,1.5-1.5V30.979C80,30.585,79.845,30.206,79.567,29.924z M62,16.415L74.929,29.5H62\n\tV16.415z M22,86V14h37v17c0,0.828,0.672,1.5,1.5,1.5H77V86H22z"/>\n</svg>	Fatura Proforma	../includes/faturaProforma.html	1	0	0	0	3
115	\N	maguita.nota.credito		0	<?xml version="1.0" encoding="iso-8859-1"?>\n    <!-- Generator: Adobe Illustrator 22.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n    viewBox="0 0 100.25 100.25" style="enable-background:new 0 0 100.25 100.25;" xml:space="preserve">\n    <path d="M79.567,29.924l-18.26-18.479C61.025,11.16,60.641,11,60.24,11H20.5c-0.828,0-1.5,0.672-1.5,1.5v75\n    c0,0.828,0.672,1.5,1.5,1.5h58c0.828,0,1.5-0.672,1.5-1.5V30.979C80,30.585,79.845,30.206,79.567,29.924z M62,16.415L74.929,29.5H62\n    V16.415z M22,86V14h37v17c0,0.828,0.672,1.5,1.5,1.5H77V86H22z"/>\n    </svg>	Nota Credito	../includes/notaCredito.html	1	0	0	0	3
\.


--
-- TOC entry 5380 (class 0 OID 16450)
-- Dependencies: 232
-- Data for Name: perfil; Type: TABLE DATA; Schema: auth; Owner: -
--

COPY auth.perfil (perfil_id, perfil_perfil_id, perfil_colaborador_id, perfil_colaborador_atualizacao, perfil_nome, perfil_codigo, perfil_estado, perfil_dataregisto, perfil_dataatualizacao) FROM stdin;
\.


--
-- TOC entry 5406 (class 0 OID 17162)
-- Dependencies: 258
-- Data for Name: privilegio; Type: TABLE DATA; Schema: auth; Owner: -
--

COPY auth.privilegio (privilegio_id, previlegio_perfil_id, privilegio_menu_id, privilegio_colaborador_id, privilegio_colaborador_atualizacao, privilegio_estado, privilegio_dataregisto, privilegio_dataatualuzacao) FROM stdin;
\.


--
-- TOC entry 5407 (class 0 OID 17168)
-- Dependencies: 259
-- Data for Name: session; Type: TABLE DATA; Schema: auth; Owner: -
--

COPY auth.session (sid, sess, expire) FROM stdin;
\.


--
-- TOC entry 5408 (class 0 OID 17173)
-- Dependencies: 260
-- Data for Name: tsexo; Type: TABLE DATA; Schema: auth; Owner: -
--

COPY auth.tsexo (tsexo_id, tsexo_nome, tsexo_codigo) FROM stdin;
1	Masculino	M
2	Feminino	F
\.


--
-- TOC entry 5503 (class 0 OID 19550)
-- Dependencies: 357
-- Data for Name: auth; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.auth (auth_uid, auth_seq, auth_key, auth_cluster_uid, auth_date, auth_status, auth_close) FROM stdin;
\.


--
-- TOC entry 5393 (class 0 OID 16844)
-- Dependencies: 245
-- Data for Name: branch; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.branch (branch_uid, branch_tbranch_id, branch_name, branch_path, branch_user, branch_workspace, branch_licence, branch_grants, branch_main_user, branch_main_workspace, branch_clusters, branch_date, branch_update, branch_state) FROM stdin;
\.


--
-- TOC entry 5409 (class 0 OID 17179)
-- Dependencies: 261
-- Data for Name: break; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.break (break_uid, break_collector, break_object, break_old, break_regclass, break_origin, break_receiver, break_date, break_instant, break_status, break_sqlstate, break_message, break_detail, break_hint, break_context, break_ref, break_metadata, break_change, break_current, break_document) FROM stdin;
\.


--
-- TOC entry 5504 (class 0 OID 19603)
-- Dependencies: 358
-- Data for Name: classmap; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.classmap (classname, classnameref, status) FROM stdin;
tweeks.branch	cluster.branch	1
\.


--
-- TOC entry 5385 (class 0 OID 16551)
-- Dependencies: 237
-- Data for Name: cluster; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.cluster (cluster_uid, cluster_identifier, cluster_type, cluster_path, cluster_name, cluster_domain, cluster_port, cluster_api, cluster_pid, cluster_version, cluster_sequence, cluster_objectver, cluster_grants, cluster_configs, cluster_tree, cluster_private, cluster_key, cluster_machineid, cluster_license, cluster_licenselife, cluster_code, cluster_verbose, cluster_tperiod_id, cluster_namespace, cluster_remote) FROM stdin;
00000000-0000-0000-0000-000000000000	EMXG-5H5SF-562	1	\N	\N	\N	\N	\N	\N	0	0	0	{}	{}	2	\N	\N	\N	\N	\N	827	f	\N	\N	f
\.


--
-- TOC entry 5381 (class 0 OID 16491)
-- Dependencies: 233
-- Data for Name: collector; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.collector (collector_transuid, collector_uid, collector_share_regclass, collector_cluster_origin, collector_sequence, collector_order, collector_minseq, collector_maxseq, collector_ref, collector_metadata, collector_old, collector_date, collector_version, collector_pid, collector_operation, collector_remoteold, collector_originold, collector_changes, collector_metaapply, collector_changevalue, collector_usechage) FROM stdin;
\.


--
-- TOC entry 5411 (class 0 OID 17189)
-- Dependencies: 263
-- Data for Name: filter; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.filter (filter_id, filter_regclass, filter_regproc, filter_sequence, filter_name, filter_describe) FROM stdin;
4	\N	tweeks.__cluster_filter_branch	1	tweeks.__cluster_filter_branch	Branch validator
\.


--
-- TOC entry 5414 (class 0 OID 17196)
-- Dependencies: 266
-- Data for Name: ignore; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.ignore (origin, object, collector, transaction) FROM stdin;
\.


--
-- TOC entry 5383 (class 0 OID 16521)
-- Dependencies: 235
-- Data for Name: object; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.object (object_transuid, object_uid, object_share_regclass, object_cluster_origin, object_cluster_receiver, object_collector_uid, object_ref, object_seq, object_sseq, object_originver, object_originsver, object_origincver, object_originsseq, object_originrev, object_date, object_instant, object_receiver, object_sync, object_status, object_outdate) FROM stdin;
\.


--
-- TOC entry 5506 (class 0 OID 19615)
-- Dependencies: 360
-- Data for Name: pull; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.pull (pull_uid, pull_server, pull_objects, pull_ignores, pull_result, pull_total, pull_limit, pull_revcode, pull_rejected, pull_sequence, pull_instant, pull_status, pull_pulled, pull_finalize) FROM stdin;
\.


--
-- TOC entry 5386 (class 0 OID 16578)
-- Dependencies: 238
-- Data for Name: resource; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.resource (resource_identifier, resource_cluster, resource_name, resource_subpath, resource_extension, resource_reference, resource_url, resource_metadata, resource_version, resource_date, resource_update) FROM stdin;
opevor-zqdqqjjs-8824	njyv-f3600-843	banana.png	maguita/artigos	\N	njyv-f3600-843/maguita/artigos/opevor-zqdqqjjs-8824-banana.png	njyv-f3600-843/maguita/artigos/opevor-zqdqqjjs-8824/banana.png	{}	1	2021-10-24 15:00:35.354217+00	\N
lxnsnm-hzgoxe1u-5842	njyv-f3600-843	tatakae-package.json	simple-test/image	\N	njyv-f3600-843/simple-test/image/lxnsnm-hzgoxe1u-5842-tatakae-package.json	njyv-f3600-843/simple-test/image/lxnsnm-hzgoxe1u-5842/tatakae-package.json	{"_branch_uid": "e99f4d1d-53e8-4652-83b1-c754b75406cf"}	1	2021-10-24 21:58:27.068602+00	\N
thifxc-8617boz4-0888	njyv-f3600-843	tatakae-package.json	simple-test/image	\N	njyv-f3600-843/simple-test/image/thifxc-8617boz4-0888-tatakae-package.json	njyv-f3600-843/simple-test/image/thifxc-8617boz4-0888/tatakae-package.json	{"_branch_uid": "e99f4d1d-53e8-4652-83b1-c754b75406cf"}	1	2021-10-24 22:02:03.549651+00	\N
lwemca-uzbhoj5i-1548	njyv-f3600-843	tatakae-package.json	simple-test/image	\N	njyv-f3600-843/simple-test/image/lwemca-uzbhoj5i-1548-tatakae-package.json	njyv-f3600-843/simple-test/image/lwemca-uzbhoj5i-1548/tatakae-package.json	{"_branch_uid": "e99f4d1d-53e8-4652-83b1-c754b75406cf"}	1	2021-10-24 22:03:31.581593+00	\N
xdgcrn-3r5sesq9-3170	njyv-f3600-843	tatakae-package.json	simple-test/image	\N	njyv-f3600-843/simple-test/image/xdgcrn-3r5sesq9-3170-tatakae-package.json	njyv-f3600-843/simple-test/image/xdgcrn-3r5sesq9-3170/tatakae-package.json	{"_branch_uid": "e99f4d1d-53e8-4652-83b1-c754b75406cf"}	1	2021-10-24 22:05:34.649825+00	\N
pbjodg-au5i8eub-3587	njyv-f3600-843	tatakae-package.json	simple-test/image	\N	njyv-f3600-843/simple-test/image/pbjodg-au5i8eub-3587-tatakae-package.json	njyv-f3600-843/simple-test/image/pbjodg-au5i8eub-3587/tatakae-package.json	{"_branch_uid": "e99f4d1d-53e8-4652-83b1-c754b75406cf"}	1	2021-10-24 22:14:12.307343+00	\N
qesiet-6qsgervg-4945	njyv-f3600-843	tatakae-package.json	simple-test/image	\N	njyv-f3600-843/simple-test/image/qesiet-6qsgervg-4945-tatakae-package.json	njyv-f3600-843/simple-test/image/qesiet-6qsgervg-4945/tatakae-package.json	{"_branch_uid": "e99f4d1d-53e8-4652-83b1-c754b75406cf"}	1	2021-10-24 22:14:57.610241+00	\N
oeybhe-0os7zvtm-9042	njyv-f3600-843	tatakae-package.json	simple-test/image	\N	njyv-f3600-843/simple-test/image/oeybhe-0os7zvtm-9042-tatakae-package.json	njyv-f3600-843/simple-test/image/oeybhe-0os7zvtm-9042/tatakae-package.json	{"_branch_uid": "e99f4d1d-53e8-4652-83b1-c754b75406cf"}	1	2021-10-24 22:16:06.960191+00	\N
avijrh-ot8deows-4690	njyv-f3600-843	tatakae-package.json	simple-test/image	\N	njyv-f3600-843/simple-test/image/avijrh-ot8deows-4690-tatakae-package.json	njyv-f3600-843/simple-test/image/avijrh-ot8deows-4690/tatakae-package.json	{"_branch_uid": "e99f4d1d-53e8-4652-83b1-c754b75406cf"}	1	2021-10-24 22:16:51.119685+00	\N
ynncnc-jb5ndjgo-2027	njyv-f3600-843	tatakae-package.json	simple-test/image	\N	njyv-f3600-843/simple-test/image/ynncnc-jb5ndjgo-2027-tatakae-package.json	njyv-f3600-843/simple-test/image/ynncnc-jb5ndjgo-2027/tatakae-package.json	{"_branch_uid": "e99f4d1d-53e8-4652-83b1-c754b75406cf"}	1	2021-10-24 22:17:16.363696+00	\N
zwqojv-bdvv0sfu-2934	njyv-f3600-843	tatakae-package.json	simple-test/image	\N	njyv-f3600-843/simple-test/image/zwqojv-bdvv0sfu-2934-tatakae-package.json	njyv-f3600-843/simple-test/image/zwqojv-bdvv0sfu-2934/tatakae-package.json	{"_branch_uid": "e99f4d1d-53e8-4652-83b1-c754b75406cf"}	1	2021-10-24 22:22:31.890016+00	\N
vmnciv-mxxg6h4v-1176	njyv-f3600-843	tatakae-package.json	simple-test/image	\N	njyv-f3600-843/simple-test/image/vmnciv-mxxg6h4v-1176-tatakae-package.json	njyv-f3600-843/simple-test/image/vmnciv-mxxg6h4v-1176/tatakae-package.json	{"_branch_uid": "e99f4d1d-53e8-4652-83b1-c754b75406cf"}	1	2021-10-24 22:23:58.751467+00	\N
CKLUME-X8Y2XVEQ-4953	NJYV-F3600-843	sjshds.sosjds.+3	sds/sdsds	\N	NJYV-F3600-843/sds/sdsds/CKLUME-X8Y2XVEQ-4953-sjshds.sosjds.+3	NJYV-F3600-843/sds/sdsds/CKLUME-X8Y2XVEQ-4953/sjshds.sosjds.+3	{}	1	2021-10-25 10:57:44.749479+00	\N
BGUJVA-NJCWG6XS-7488	NJYV-F3600-843	sjshds.sosjds.+3___	sds/sdsds	\N	NJYV-F3600-843/sds/sdsds/BGUJVA-NJCWG6XS-7488-sjshds.sosjds.+3___	NJYV-F3600-843/sds/sdsds/BGUJVA-NJCWG6XS-7488/sjshds.sosjds.+3___	{}	1	2021-10-25 10:58:24.799173+00	\N
YEHPOT-QZJLU3ME-8247	KRIC-7718N-461	caharamba.jpg	cloud/data/files	\N	KRIC-7718N-461/cloud/data/files/YEHPOT-QZJLU3ME-8247-caharamba.jpg	KRIC-7718N-461/cloud/data/files/YEHPOT-QZJLU3ME-8247/caharamba.jpg	{"_branch_uid": "f1ec0c66-3048-45c9-9b51-22f05881f77e"}	1	2021-11-01 23:19:35.757849+00	\N
XJUWRD-K12EOSGC-1402	CWTT-9UWK4-097	bock.png	cloud/data/files	\N	CWTT-9UWK4-097/cloud/data/files/XJUWRD-K12EOSGC-1402-bock.png	CWTT-9UWK4-097/cloud/data/files/XJUWRD-K12EOSGC-1402/bock.png	{"_branch_uid": "f1ec0c66-3048-45c9-9b51-22f05881f77e"}	1	2021-11-07 13:12:30.801041+00	\N
LYFVKU-0KPNKFZ3-1987	CWTT-9UWK4-097	bebidas.png	cloud/data/files	\N	CWTT-9UWK4-097/cloud/data/files/LYFVKU-0KPNKFZ3-1987-bebidas.png	CWTT-9UWK4-097/cloud/data/files/LYFVKU-0KPNKFZ3-1987/bebidas.png	{"_branch_uid": "f1ec0c66-3048-45c9-9b51-22f05881f77e"}	1	2021-11-01 13:37:45.443148+00	\N
BOWJRN-O8S2TIUN-0356	CWTT-9UWK4-097	luma_enterprise.png	cloud/data/files	\N	CWTT-9UWK4-097/cloud/data/files/BOWJRN-O8S2TIUN-0356-luma_enterprise.png	CWTT-9UWK4-097/cloud/data/files/BOWJRN-O8S2TIUN-0356/luma_enterprise.png	{"_branch_uid": "f1ec0c66-3048-45c9-9b51-22f05881f77e"}	1	2021-11-07 13:07:40.141149+00	\N
WLYUEW-RH5NDZPY-7206	CWTT-9UWK4-097	luma_enterprise.png	cloud/data/files	\N	CWTT-9UWK4-097/cloud/data/files/WLYUEW-RH5NDZPY-7206-luma_enterprise.png	CWTT-9UWK4-097/cloud/data/files/WLYUEW-RH5NDZPY-7206/luma_enterprise.png	{"_branch_uid": "f1ec0c66-3048-45c9-9b51-22f05881f77e"}	1	2021-11-01 13:46:09.876034+00	\N
ZWXGHG-YHXP1CMF-6784	CWTT-9UWK4-097	pizza.png	cloud/data/files	\N	CWTT-9UWK4-097/cloud/data/files/ZWXGHG-YHXP1CMF-6784-pizza.png	CWTT-9UWK4-097/cloud/data/files/ZWXGHG-YHXP1CMF-6784/pizza.png	{"_branch_uid": "f1ec0c66-3048-45c9-9b51-22f05881f77e"}	1	2021-11-07 13:10:33.160019+00	\N
RNFEAJ-SYL4YCA8-1442	HYHM-N1HMO-725	pngegg.png	cloud/data/files	\N	HYHM-N1HMO-725/cloud/data/files/RNFEAJ-SYL4YCA8-1442-pngegg.png	HYHM-N1HMO-725/cloud/data/files/RNFEAJ-SYL4YCA8-1442/pngegg.png	{"_branch_uid": "f1ec0c66-3048-45c9-9b51-22f05881f77e"}	1	2021-12-07 13:22:58.064018+00	\N
UGWPSF-R3RO8LRQ-3612	CWTT-9UWK4-097	filetes_de_pescada.png	cloud/data/files	\N	CWTT-9UWK4-097/cloud/data/files/UGWPSF-R3RO8LRQ-3612-filetes_de_pescada.png	CWTT-9UWK4-097/cloud/data/files/UGWPSF-R3RO8LRQ-3612/filetes_de_pescada.png	{"_branch_uid": "f1ec0c66-3048-45c9-9b51-22f05881f77e"}	1	2021-11-02 15:30:15.644082+00	\N
KXPQIH-NTQ5P0DE-5438	CWTT-9UWK4-097	queijo.png	cloud/data/files	\N	CWTT-9UWK4-097/cloud/data/files/KXPQIH-NTQ5P0DE-5438-queijo.png	CWTT-9UWK4-097/cloud/data/files/KXPQIH-NTQ5P0DE-5438/queijo.png	{"_branch_uid": "f1ec0c66-3048-45c9-9b51-22f05881f77e"}	1	2021-12-07 13:45:36.253133+00	\N
AYDLHK-HRSYZBJ5-3374	CWTT-9UWK4-097	med.png	cloud/data/files	\N	CWTT-9UWK4-097/cloud/data/files/AYDLHK-HRSYZBJ5-3374-med.png	CWTT-9UWK4-097/cloud/data/files/AYDLHK-HRSYZBJ5-3374/med.png	{"_branch_uid": "f1ec0c66-3048-45c9-9b51-22f05881f77e"}	1	2021-12-08 07:55:26.378385+00	\N
XQZYGM-IKY2RCRO-5671	CWTT-9UWK4-097	barcelona.jpeg	cloud/data/files	\N	CWTT-9UWK4-097/cloud/data/files/XQZYGM-IKY2RCRO-5671-barcelona.jpeg	CWTT-9UWK4-097/cloud/data/files/XQZYGM-IKY2RCRO-5671/barcelona.jpeg	{"_branch_uid": "f1ec0c66-3048-45c9-9b51-22f05881f77e"}	1	2021-12-09 11:32:25.599647+00	\N
PYXNKQ-RMGWXQJZ-5388	NMDO-5VDLJ-186	fundo.png	cloud/data/files	\N	NMDO-5VDLJ-186/cloud/data/files/PYXNKQ-RMGWXQJZ-5388-fundo.png	NMDO-5VDLJ-186/cloud/data/files/PYXNKQ-RMGWXQJZ-5388/fundo.png	{"_branch_uid": "9904ff3a-876c-425a-9bb3-677962503e42"}	1	2022-01-03 14:39:47.639577+00	\N
IKJBWV-XAQ0PW0D-3251	GWNF-8TVUO-666	ero_sennin.jpg	cloud/data/files	\N	GWNF-8TVUO-666/cloud/data/files/IKJBWV-XAQ0PW0D-3251-ero_sennin.jpg	GWNF-8TVUO-666/cloud/data/files/IKJBWV-XAQ0PW0D-3251/ero_sennin.jpg	{"_branch_uid": "9904ff3a-876c-425a-9bb3-677962503e42"}	1	2022-01-06 21:01:05.320394+00	\N
INUJNX-TBUY21TJ-2277	GWNF-8TVUO-666	maxresdefault.jpg	cloud/data/files	\N	GWNF-8TVUO-666/cloud/data/files/INUJNX-TBUY21TJ-2277-maxresdefault.jpg	GWNF-8TVUO-666/cloud/data/files/INUJNX-TBUY21TJ-2277/maxresdefault.jpg	{"_branch_uid": "9904ff3a-876c-425a-9bb3-677962503e42"}	1	2022-01-06 21:02:47.799976+00	\N
LBBKEH-MNP9PQ8H-6131	GWNF-8TVUO-666	nego.png	cloud/data/files	\N	GWNF-8TVUO-666/cloud/data/files/LBBKEH-MNP9PQ8H-6131-nego.png	GWNF-8TVUO-666/cloud/data/files/LBBKEH-MNP9PQ8H-6131/nego.png	{"_branch_uid": "9904ff3a-876c-425a-9bb3-677962503e42"}	1	2022-01-06 21:04:51.542411+00	\N
QNHMBL-G07XFB0F-2188	GWNF-8TVUO-666	maxresdefault.jpg	cloud/data/files	\N	GWNF-8TVUO-666/cloud/data/files/QNHMBL-G07XFB0F-2188-maxresdefault.jpg	GWNF-8TVUO-666/cloud/data/files/QNHMBL-G07XFB0F-2188/maxresdefault.jpg	{"_branch_uid": "9904ff3a-876c-425a-9bb3-677962503e42"}	1	2022-01-06 21:06:59.699231+00	\N
GVRGXG-VU14875Q-7911	GWNF-8TVUO-666	ero_sennin.jpg	cloud/data/files	\N	GWNF-8TVUO-666/cloud/data/files/GVRGXG-VU14875Q-7911-ero_sennin.jpg	GWNF-8TVUO-666/cloud/data/files/GVRGXG-VU14875Q-7911/ero_sennin.jpg	{"_branch_uid": "9904ff3a-876c-425a-9bb3-677962503e42"}	1	2022-01-07 14:01:04.962437+00	\N
RBGLMB-PGRRRP7T-4438	GWNF-8TVUO-666	cabeçalho.png	cloud/data/files	\N	GWNF-8TVUO-666/cloud/data/files/RBGLMB-PGRRRP7T-4438-cabeçalho.png	GWNF-8TVUO-666/cloud/data/files/RBGLMB-PGRRRP7T-4438/cabeçalho.png	{"_branch_uid": "9904ff3a-876c-425a-9bb3-677962503e42"}	1	2022-01-07 14:01:05.263171+00	\N
MVWMSR-IHKNYT48-8383	GWNF-8TVUO-666	ero_sennin.jpg	cloud/data/files	\N	GWNF-8TVUO-666/cloud/data/files/MVWMSR-IHKNYT48-8383-ero_sennin.jpg	GWNF-8TVUO-666/cloud/data/files/MVWMSR-IHKNYT48-8383/ero_sennin.jpg	{"_branch_uid": "9904ff3a-876c-425a-9bb3-677962503e42"}	1	2022-01-08 13:49:07.365436+00	\N
IGIVFI-5CLTI36O-2265	GWNF-8TVUO-666	cabeçalho.png	cloud/data/files	\N	GWNF-8TVUO-666/cloud/data/files/IGIVFI-5CLTI36O-2265-cabeçalho.png	GWNF-8TVUO-666/cloud/data/files/IGIVFI-5CLTI36O-2265/cabeçalho.png	{"_branch_uid": "9904ff3a-876c-425a-9bb3-677962503e42"}	1	2022-01-08 13:49:07.721734+00	\N
JMCKWB-M0QBP67Q-3181	GWNF-8TVUO-666	ero_sennin.jpg	cloud/data/files	\N	GWNF-8TVUO-666/cloud/data/files/JMCKWB-M0QBP67Q-3181-ero_sennin.jpg	GWNF-8TVUO-666/cloud/data/files/JMCKWB-M0QBP67Q-3181/ero_sennin.jpg	{"_branch_uid": "9904ff3a-876c-425a-9bb3-677962503e42"}	1	2022-01-08 14:07:54.448269+00	\N
NOFEVY-H3CYW593-8395	GWNF-8TVUO-666	cabeçalho.png	cloud/data/files	\N	GWNF-8TVUO-666/cloud/data/files/NOFEVY-H3CYW593-8395-cabeçalho.png	GWNF-8TVUO-666/cloud/data/files/NOFEVY-H3CYW593-8395/cabeçalho.png	{"_branch_uid": "9904ff3a-876c-425a-9bb3-677962503e42"}	1	2022-01-08 14:07:55.066003+00	\N
YTTGDR-OI4JJPH1-3200	GWNF-8TVUO-666	ero_sennin.jpg	cloud/data/files	\N	GWNF-8TVUO-666/cloud/data/files/YTTGDR-OI4JJPH1-3200-ero_sennin.jpg	GWNF-8TVUO-666/cloud/data/files/YTTGDR-OI4JJPH1-3200/ero_sennin.jpg	{"_branch_uid": "9904ff3a-876c-425a-9bb3-677962503e42"}	1	2022-01-08 19:06:51.142839+00	\N
OJRWHH-44FAP202-4245	GWNF-8TVUO-666	cabeçalho.png	cloud/data/files	\N	GWNF-8TVUO-666/cloud/data/files/OJRWHH-44FAP202-4245-cabeçalho.png	GWNF-8TVUO-666/cloud/data/files/OJRWHH-44FAP202-4245/cabeçalho.png	{"_branch_uid": "9904ff3a-876c-425a-9bb3-677962503e42"}	1	2022-01-08 19:06:51.848975+00	\N
EMYRYU-FC5ZXZDD-4977	QBJS-8UJT6-449	frango.png	cloud/data/files	\N	QBJS-8UJT6-449/cloud/data/files/EMYRYU-FC5ZXZDD-4977-frango.png	QBJS-8UJT6-449/cloud/data/files/EMYRYU-FC5ZXZDD-4977/frango.png	{"_branch_uid": "852fecc1-5147-4022-bdee-a9296a6d18ff"}	1	2022-01-09 18:29:36.418524+00	\N
XAJVFV-QDCUMUTU-8685	QBJS-8UJT6-449	atum.png	cloud/data/files	\N	QBJS-8UJT6-449/cloud/data/files/XAJVFV-QDCUMUTU-8685-atum.png	QBJS-8UJT6-449/cloud/data/files/XAJVFV-QDCUMUTU-8685/atum.png	{"_branch_uid": "852fecc1-5147-4022-bdee-a9296a6d18ff"}	1	2022-01-09 18:30:36.973748+00	\N
KFTTLI-TUBO6NN5-8356	NRDW-3EGCD-719	uncompressed.jpg	cloud/data/files	\N	NRDW-3EGCD-719/cloud/data/files/KFTTLI-TUBO6NN5-8356-uncompressed.jpg	NRDW-3EGCD-719/cloud/data/files/KFTTLI-TUBO6NN5-8356/uncompressed.jpg	{"_branch_uid": "852fecc1-5147-4022-bdee-a9296a6d18ff"}	1	2022-01-09 18:33:21.390489+00	\N
LVZVSG-OGS5HA8O-0137	NRDW-3EGCD-719	banana.jpg	cloud/data/files	\N	NRDW-3EGCD-719/cloud/data/files/LVZVSG-OGS5HA8O-0137-banana.jpg	NRDW-3EGCD-719/cloud/data/files/LVZVSG-OGS5HA8O-0137/banana.jpg	{"_branch_uid": "852fecc1-5147-4022-bdee-a9296a6d18ff"}	1	2022-01-09 18:34:26.927866+00	\N
KWFJSV-VZR48RK6-5811	QBJS-8UJT6-449	cherne.png	cloud/data/files	\N	QBJS-8UJT6-449/cloud/data/files/KWFJSV-VZR48RK6-5811-cherne.png	QBJS-8UJT6-449/cloud/data/files/KWFJSV-VZR48RK6-5811/cherne.png	{"_branch_uid": "852fecc1-5147-4022-bdee-a9296a6d18ff"}	1	2022-01-09 18:37:35.551224+00	\N
SGMKEK-Z4332K1L-5817	QBJS-8UJT6-449	banana.png	cloud/data/files	\N	QBJS-8UJT6-449/cloud/data/files/SGMKEK-Z4332K1L-5817-banana.png	QBJS-8UJT6-449/cloud/data/files/SGMKEK-Z4332K1L-5817/banana.png	{"_branch_uid": "852fecc1-5147-4022-bdee-a9296a6d18ff"}	1	2022-01-09 18:46:46.560416+00	\N
XRSSDY-Q7O8FK5A-7661	QBJS-8UJT6-449	arroz.png	cloud/data/files	\N	QBJS-8UJT6-449/cloud/data/files/XRSSDY-Q7O8FK5A-7661-arroz.png	QBJS-8UJT6-449/cloud/data/files/XRSSDY-Q7O8FK5A-7661/arroz.png	{"_branch_uid": "852fecc1-5147-4022-bdee-a9296a6d18ff"}	1	2022-01-09 18:45:03.201666+00	\N
UTZUEQ-LE3ZJ0K8-9425	QBJS-8UJT6-449	batata.png	cloud/data/files	\N	QBJS-8UJT6-449/cloud/data/files/UTZUEQ-LE3ZJ0K8-9425-batata.png	QBJS-8UJT6-449/cloud/data/files/UTZUEQ-LE3ZJ0K8-9425/batata.png	{"_branch_uid": "852fecc1-5147-4022-bdee-a9296a6d18ff"}	1	2022-01-09 18:45:58.825926+00	\N
PYNBFU-KUR6NTH8-3386	NRDW-3EGCD-719	caharamba.jpg	cloud/data/files	\N	NRDW-3EGCD-719/cloud/data/files/PYNBFU-KUR6NTH8-3386-caharamba.jpg	NRDW-3EGCD-719/cloud/data/files/PYNBFU-KUR6NTH8-3386/caharamba.jpg	{"_branch_uid": "852fecc1-5147-4022-bdee-a9296a6d18ff"}	1	2022-01-09 18:48:43.038947+00	\N
JQUDVT-43H6LRR3-4181	NRDW-3EGCD-719	matabala.jpg	cloud/data/files	\N	NRDW-3EGCD-719/cloud/data/files/JQUDVT-43H6LRR3-4181-matabala.jpg	NRDW-3EGCD-719/cloud/data/files/JQUDVT-43H6LRR3-4181/matabala.jpg	{"_branch_uid": "852fecc1-5147-4022-bdee-a9296a6d18ff"}	1	2022-01-09 18:52:06.225891+00	\N
HSEPWW-C50HI04D-8611	NRDW-3EGCD-719	fruta.jpg	cloud/data/files	\N	NRDW-3EGCD-719/cloud/data/files/HSEPWW-C50HI04D-8611-fruta.jpg	NRDW-3EGCD-719/cloud/data/files/HSEPWW-C50HI04D-8611/fruta.jpg	{"_branch_uid": "852fecc1-5147-4022-bdee-a9296a6d18ff"}	1	2022-01-09 18:53:16.945209+00	\N
UPLRST-VOBBG92V-7725	VHHF-SIZRO-387	frango.png	cloud/data/files	\N	VHHF-SIZRO-387/cloud/data/files/UPLRST-VOBBG92V-7725-frango.png	VHHF-SIZRO-387/cloud/data/files/UPLRST-VOBBG92V-7725/frango.png	{"_branch_uid": "b937423e-728a-44b0-8f6c-75b0025ea854"}	1	2022-01-11 15:48:56.274979+00	\N
KZHIXT-E0F36K2Y-8888	VHHF-SIZRO-387	arroz.png	cloud/data/files	\N	VHHF-SIZRO-387/cloud/data/files/KZHIXT-E0F36K2Y-8888-arroz.png	VHHF-SIZRO-387/cloud/data/files/KZHIXT-E0F36K2Y-8888/arroz.png	{"_branch_uid": "b937423e-728a-44b0-8f6c-75b0025ea854"}	1	2022-01-11 15:52:22.149556+00	\N
KMRUNU-PMBGD2CT-6774	VHHF-SIZRO-387	fundo.png	cloud/data/files	\N	VHHF-SIZRO-387/cloud/data/files/KMRUNU-PMBGD2CT-6774-fundo.png	VHHF-SIZRO-387/cloud/data/files/KMRUNU-PMBGD2CT-6774/fundo.png	{"_branch_uid": "b937423e-728a-44b0-8f6c-75b0025ea854"}	1	2022-01-11 15:58:07.081899+00	\N
HVOITI-EOCMLELC-0673	VHHF-SIZRO-387	paracetamol.png	cloud/data/files	\N	VHHF-SIZRO-387/cloud/data/files/HVOITI-EOCMLELC-0673-paracetamol.png	VHHF-SIZRO-387/cloud/data/files/HVOITI-EOCMLELC-0673/paracetamol.png	{"_branch_uid": "b937423e-728a-44b0-8f6c-75b0025ea854"}	1	2022-01-12 16:38:03.419975+00	\N
CGDNNU-8HRF6864-5435	SMLR-5DRTQ-263	logo.png	cloud/data/files	\N	SMLR-5DRTQ-263/cloud/data/files/CGDNNU-8HRF6864-5435-logo.png	SMLR-5DRTQ-263/cloud/data/files/CGDNNU-8HRF6864-5435/logo.png	{"_branch_uid": "4ec28576-0fd6-436e-b2e3-d1ac7c2e1d49"}	1	2022-02-21 16:43:01.419573+00	\N
\.


--
-- TOC entry 5417 (class 0 OID 17203)
-- Dependencies: 269
-- Data for Name: sequence; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.sequence (name, sub, sequence, steep, lpad, lpad_char, zerobase) FROM stdin;
\.


--
-- TOC entry 5418 (class 0 OID 17212)
-- Dependencies: 270
-- Data for Name: share; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.share (share_regclass, share_insert, share_update, share_checker, share_triggers, share_pks, share_pksfrom) FROM stdin;
auth.colaborador	t	t	\N	{cluster_version_add_change_after_insert_on_auth_colaborador_111,cluster_version_commit_change_insert_on_auth_colaborador_598187,cluster_version_add_change_after_update_on_auth_colaborador_456,cluster_version_commit_change_update_on_auth_colaborador_676820}	{colaborador_id}	\N
auth.perfil	t	t	\N	{cluster_version_add_change_after_insert_on_auth_perfil_921824,cluster_version_commit_change_insert_on_auth_perfil_158915,cluster_version_add_change_after_update_on_auth_perfil_388675,cluster_version_commit_change_update_on_auth_perfil_266693}	{perfil_id}	\N
tweeks.espaco	t	t	\N	{cluster_version_add_change_after_insert_on_tweeks_espaco_297678,cluster_version_commit_change_insert_on_tweeks_espaco_656816,cluster_version_add_change_after_update_on_tweeks_espaco_177136,cluster_version_commit_change_update_on_tweeks_espaco_329179}	{espaco_id}	\N
auth.acesso	t	t	\N	{cluster_version_add_change_after_insert_on_auth_acesso_680140,cluster_version_commit_change_insert_on_auth_acesso_724429,cluster_version_add_change_after_update_on_auth_acesso_499335,cluster_version_commit_change_update_on_auth_acesso_149765}	{acesso_id}	\N
auth.privilegio	t	t	\N	{cluster_version_add_change_after_insert_on_auth_privilegio_4414,cluster_version_commit_change_insert_on_auth_privilegio_651705,cluster_version_add_change_after_update_on_auth_privilegio_7057,cluster_version_commit_change_update_on_auth_privilegio_656203}	{privilegio_id}	\N
tweeks.trabalha	t	t	\N	{cluster_version_add_change_after_insert_on_tweeks_trabalha_7237,cluster_version_commit_change_insert_on_tweeks_trabalha_885890,cluster_version_add_change_after_update_on_tweeks_trabalha_4074,cluster_version_commit_change_update_on_tweeks_trabalha_819866}	{trabalha_id}	\N
cluster.branch	t	t	\N	{cluster_version_add_change_after_insert_on_cluster_branch_86599,cluster_version_commit_change_insert_on_cluster_branch_953907,cluster_version_add_change_after_update_on_cluster_branch_37843,cluster_version_commit_change_update_on_cluster_branch_185443}	{branch_uid}	\N
tweeks.branch	t	t	\N	{cluster_version_add_change_after_insert_on_tweeks_branch_239553,cluster_version_commit_change_insert_on_tweeks_branch_417147,cluster_version_add_change_after_update_on_tweeks_branch_143768,cluster_version_commit_change_update_on_tweeks_branch_763687}	{branch_uid}	cluster.branch
\.


--
-- TOC entry 5419 (class 0 OID 17220)
-- Dependencies: 271
-- Data for Name: tperiod; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.tperiod (tperiod_id, tperiod_desc, tperiod_label, tperiod_code) FROM stdin;
4	Anual	Ano	year
3	Mensal	Mês	month
2	Semanal	Semana	week
1	Diario	Dia	day
\.


--
-- TOC entry 5384 (class 0 OID 16545)
-- Dependencies: 236
-- Data for Name: users; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.users (user_default, user_replication) FROM stdin;
maguita_dps	maguita_dps_clone
\.


--
-- TOC entry 5382 (class 0 OID 16506)
-- Dependencies: 234
-- Data for Name: version; Type: TABLE DATA; Schema: cluster; Owner: -
--

COPY cluster.version (version_uid, version_share_regclass, version_cluster_id, version_number) FROM stdin;
3f4fab41-ce46-45c4-acda-a3364fb1cd64	auth.acesso	00000000-0000-0000-0000-000000000000	0
\.


--
-- TOC entry 5420 (class 0 OID 17225)
-- Dependencies: 272
-- Data for Name: altspelling; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.altspelling (altspelling_id, altspelling_country_id, altspelling_altspelling) FROM stdin;
1	196	AD
2	196	Principality of Andorra
3	196	Principat d'Andorra
4	154	AE
5	154	UAE
6	142	AF
7	142	Afġānistān
8	62	AG
9	61	AI
10	195	AL
11	195	Shqipëri
12	195	Shqipëria
13	195	Shqipnia
14	151	AM
15	151	Hayastan
16	151	Republic of Armenia
17	151	Հայաստանի Հանրապետություն
18	21	AO
19	21	República de Angola
20	21	ʁɛpublika de an'ɡɔla
21	103	AR
22	103	Argentine Republic
23	103	República Argentina
24	238	Amelika Sāmoa
25	238	Amerika Sāmoa
26	238	AS
27	238	Sāmoa Amelika
28	212	AT
29	212	Oesterreich
30	212	Osterreich
31	212	Österreich
32	221	AU
33	63	AW
34	179	Aaland
35	179	Ahvenanmaa
36	179	Aland
37	179	AX
38	152	AZ
39	152	Azərbaycan Respublikası
40	152	Republic of Azerbaijan
41	197	BA
42	197	Bosnia-Herzegovina
43	197	Босна и Херцеговина
44	65	BB
45	143	BD
46	143	Gônôprôjatôntri Bangladesh
47	143	People's Republic of Bangladesh
48	213	BE
49	213	Belgie
50	213	België
51	213	Belgien
52	213	Belgique
53	213	Kingdom of Belgium
54	213	Königreich Belgien
55	213	Koninkrijk België
56	213	Royaume de Belgique
57	45	BF
58	169	BG
59	169	Republic of Bulgaria
60	169	Република България
61	153	BH
62	153	Kingdom of Bahrain
63	153	Mamlakat al-Baḥrayn
64	1	BI
65	1	Republic of Burundi
66	1	Republika y'Uburundi
67	1	République du Burundi
68	44	BJ
69	44	Republic of Benin
70	44	République du Bénin
71	81	BL
72	81	Collectivité de Saint-Barthélemy
73	81	Collectivity of Saint Barthélemy
74	81	St. Barthelemy
75	99	BM
76	99	Somers Isles
77	99	The Bermudas
78	99	The Islands of Bermuda
79	131	BN
80	131	Nation of Brunei
81	131	the Abode of Peace
82	104	BO
83	104	Buliwya
84	104	Buliwya Mamallaqta
85	104	Estado Plurinacional de Bolivia
86	104	Plurinational State of Bolivia
87	104	Tetã Volívia
88	104	Wuliwya
89	104	Wuliwya Suyu
90	70	Boneiru
91	70	BQ
92	105	BR
93	105	Brasil
94	105	Federative Republic of Brazil
95	105	República Federativa do Brasil
96	64	BS
97	64	Commonwealth of the Bahamas
98	144	BT
99	144	Kingdom of Bhutan
100	250	Bouvet-øya
101	250	Bouvetøya
102	250	BV
103	40	BW
104	40	Lefatshe la Botswana
105	40	Republic of Botswana
106	168	Belorussiya
107	168	Bielaruś
108	168	BY
109	168	Republic of Belarus
110	168	Respublika Belarus’
111	168	Белоруссия
112	168	Республика Беларусь
113	89	BZ
114	100	CA
115	223	CC
116	223	Keeling Islands
117	223	Territory of the Cocos (Keeling) Islands
118	26	CD
119	26	Congo-Kinshasa
120	26	DRC
121	26	DR Congo
122	23	Central African Republic
123	23	CF
124	23	République centrafricaine
125	25	CG
126	25	Congo-Brazzaville
127	220	CH
128	220	Schweiz
129	220	Suisse
130	220	Svizra
131	220	Svizzera
132	220	Swiss Confederation
133	51	CI
134	51	Ivory Coast
135	51	Republic of Côte d'Ivoire
136	51	République de Côte d'Ivoire
137	239	CK
138	239	Kūki 'Āirani
139	106	CL
140	106	República de Chile
141	106	Republic of Chile
142	22	CM
143	22	Republic of Cameroon
144	22	République du Cameroun
145	123	CN
146	123	People's Republic of China
147	123	Zhongguo
148	123	Zhōngguó
149	123	Zhonghua
150	123	Zhōnghuá Rénmín Gònghéguó
151	123	中华人民共和国
152	107	CO
153	107	República de Colombia
154	107	Republic of Colombia
155	90	CR
156	90	República de Costa Rica
157	90	Republic of Costa Rica
158	67	CU
159	67	República de Cuba
160	67	Republic of Cuba
161	46	CV
162	46	República de Cabo Verde
163	46	Republic of Cabo Verde
164	71	Country of Curaçao
165	71	Curacao
166	71	CW
167	71	Kòrsou
168	71	Land Curaçao
169	71	Pais Kòrsou
170	222	CX
171	222	Territory of Christmas Island
172	199	CY
173	199	Kıbrıs
174	199	Kıbrıs Cumhuriyeti
175	199	Kýpros
176	199	Republic of Cyprus
177	199	Κυπριακή Δημοκρατία
178	170	Česká republika
179	170	Česko
180	170	CZ
181	216	Bundesrepublik Deutschland
182	216	DE
183	216	Federal Republic of Germany
184	3	DJ
185	3	Gabuuti
186	3	Gabuutih Ummuuno
187	3	Jabuuti
188	3	Jamhuuriyadda Jabuuti
189	3	Republic of Djibouti
190	3	République de Djibouti
191	183	Danmark
192	183	DK
193	183	Kingdom of Denmark
194	183	Kongeriget Danmark
195	68	Commonwealth of Dominica
196	68	DM
197	68	Dominique
198	68	Wai‘tu kubuli
199	69	DO
200	31	Algérie
201	31	DZ
202	31	Dzayer
203	108	EC
204	108	República del Ecuador
205	108	Republic of Ecuador
206	184	EE
207	184	Eesti
208	184	Eesti Vabariik
209	184	Republic of Estonia
210	32	Arab Republic of Egypt
211	32	EG
212	35	EH
213	35	Taneẓroft Tutrimt
214	4	Dawlat Iritriyá
215	4	ER
216	4	Iritriyā
217	4	State of Eritrea
218	4	ʾErtrā
219	4	ሃገረ ኤርትራ
220	210	ES
221	210	Kingdom of Spain
222	210	Reino de España
223	5	ET
224	5	Federal Democratic Republic of Ethiopia
225	5	ʾĪtyōṗṗyā
226	5	የኢትዮጵያ ፌዴራላዊ ዲሞክራሲያዊ ሪፐብሊክ
227	186	FI
228	186	Republic of Finland
229	186	Republiken Finland
230	186	Suomen tasavalta
231	186	Suomi
232	226	Fijī Gaṇarājya
233	226	FJ
234	226	Matanitu ko Viti
235	226	Republic of Fiji
236	226	Viti
237	109	FK
238	109	Islas Malvinas
239	235	Federated States of Micronesia
240	235	FM
241	185	Færøerne
242	185	FO
243	185	Føroyar
244	215	FR
245	215	French Republic
246	215	République française
247	28	GA
248	28	Gabonese Republic
249	28	République Gabonaise
250	180	GB
251	180	Great Britain
252	180	UK
253	74	GD
254	155	GE
255	155	Sakartvelo
256	117	GF
257	117	Guiana
258	117	Guyane
259	181	Bailiwick of Guernsey
260	181	Bailliage de Guernesey
261	181	GG
262	48	GH
263	200	GI
264	102	GL
265	102	Grønland
266	47	GM
267	47	Republic of the Gambia
268	50	GN
269	50	Republic of Guinea
270	50	République de Guinée
271	75	GP
272	75	Gwadloup
273	27	GQ
274	27	República da Guiné Equatorial
275	27	República de Guinea Ecuatorial
276	27	Republic of Equatorial Guinea
277	27	République de Guinée équatoriale
278	201	Elláda
279	201	GR
280	201	Hellenic Republic
281	201	Ελληνική Δημοκρατία
282	113	GS
283	113	South Georgia and the South Sandwich Islands
284	91	GT
285	232	GU
286	232	Guåhån
287	49	GW
288	49	República da Guiné-Bissau
289	49	Republic of Guinea-Bissau
290	110	Co-operative Republic of Guyana
291	110	GY
292	124	HK
293	124	香港
294	249	HM
295	92	HN
296	92	República de Honduras
297	92	Republic of Honduras
298	198	HR
299	198	Hrvatska
300	198	Republic of Croatia
301	198	Republika Hrvatska
302	76	HT
303	76	Repiblik Ayiti
304	76	Republic of Haiti
305	76	République d'Haïti
306	171	HU
307	136	ID
308	136	Republic of Indonesia
309	136	Republik Indonesia
310	188	Éire
311	188	IE
312	188	Poblacht na hÉireann
313	188	Republic of Ireland
314	157	IL
315	157	Medīnat Yisrā'el
316	157	State of Israel
317	191	Ellan Vannin
318	191	IM
319	191	Mann
320	191	Mannin
321	145	Bhārat
322	145	Bharat Ganrajya
323	145	IN
324	145	Republic of India
325	8	IO
326	156	IQ
327	156	Jumhūriyyat al-‘Irāq
328	156	Republic of Iraq
329	146	IR
330	146	Islamic Republic of Iran
331	146	Jomhuri-ye Eslāmi-ye Irān
332	187	IS
333	187	Island
334	187	Lýðveldið Ísland
335	187	Republic of Iceland
336	202	IT
337	202	Italian Republic
338	202	Repubblica italiana
339	182	Bailiwick of Jersey
340	182	Bailliage dé Jèrri
341	182	Bailliage de Jersey
342	182	JE
343	77	JM
344	158	al-Mamlakah al-Urdunīyah al-Hāshimīyah
345	158	Hashemite Kingdom of Jordan
346	158	JO
347	126	JP
348	126	Nihon
349	126	Nippon
350	9	Jamhuri ya Kenya
351	9	KE
352	9	Republic of Kenya
353	119	KG
354	119	Kyrgyz Republic
355	119	Kyrgyz Respublikasy
356	119	Киргизия
357	119	Кыргыз Республикасы
358	133	KH
359	133	Kingdom of Cambodia
360	233	KI
361	233	Republic of Kiribati
362	233	Ribaberiki Kiribati
363	2	al-Ittiḥād al-Qumurī
364	2	KM
365	2	Udzima wa Komori
366	2	Union des Comores
367	2	Union of the Comoros
368	78	Federation of Saint Christopher and Nevis
369	78	KN
370	128	조선민주주의인민공화국
371	128	Chosŏn Minjujuŭi Inmin Konghwaguk
372	128	Democratic People's Republic of Korea
373	128	KP
374	129	KR
375	129	Republic of Korea
376	159	Dawlat al-Kuwait
377	159	KW
378	159	State of Kuwait
379	66	KY
380	118	KZ
381	118	Qazaqstan
382	118	Qazaqstan Respublïkası
383	118	Republic of Kazakhstan
384	118	Respublika Kazakhstan
385	118	Казахстан
386	118	Қазақстан Республикасы
387	118	Республика Казахстан
388	137	LA
389	137	Lao
390	137	Lao People's Democratic Republic
391	137	Laos
392	137	Sathalanalat Paxathipatai Paxaxon Lao
393	160	Al-Jumhūrīyah Al-Libnānīyah
394	160	LB
395	160	Lebanese Republic
396	82	LC
397	217	Fürstentum Liechtenstein
398	217	LI
399	217	Principality of Liechtenstein
400	150	Democratic Socialist Republic of Sri Lanka
401	150	ilaṅkai
402	150	LK
403	52	LR
404	52	Republic of Liberia
405	39	Kingdom of Lesotho
406	39	LS
407	39	Muso oa Lesotho
408	190	Lietuvos Respublika
409	190	LT
410	190	Republic of Lithuania
411	218	Grand-Duché de Luxembourg
412	218	Grand Duchy of Luxembourg
413	218	Großherzogtum Luxemburg
414	218	Groussherzogtum Lëtzebuerg
415	218	LU
416	189	Latvijas Republika
417	189	LV
418	189	Republic of Latvia
419	33	Dawlat Libya
420	33	LY
421	33	State of Libya
422	34	Al-Mamlakah al-Maġribiyah
423	34	Kingdom of Morocco
424	34	MA
425	219	MC
426	219	Principality of Monaco
427	219	Principauté de Monaco
428	173	MD
429	173	Republica Moldova
430	173	Republic of Moldova
431	205	Crna Gora
432	205	ME
433	83	Collectivité de Saint-Martin
434	83	Collectivity of Saint Martin
435	83	MF
436	10	MG
437	10	Repoblikan'i Madagasikara
438	10	Republic of Madagascar
439	10	République de Madagascar
440	234	Aolepān Aorōkin M̧ajeļ
441	234	MH
442	234	Republic of the Marshall Islands
443	203	MK
444	203	Republic of Macedonia
445	203	Република Македонија
446	53	ML
447	53	Republic of Mali
448	53	République du Mali
449	132	Burma
450	132	MM
451	132	Pyidaunzu Thanmăda Myăma Nainngandaw
452	132	Republic of the Union of Myanmar
453	127	MN
454	125	Macao Special Administrative Region of the People's Republic of China
455	125	MO
456	125	Região Administrativa Especial de Macau da República Popular da China
457	125	中華人民共和國澳門特別行政區
458	125	澳门
459	231	Commonwealth of the Northern Mariana Islands
460	231	MP
461	231	Sankattan Siha Na Islas Mariånas
462	73	MQ
463	54	al-Jumhūriyyah al-ʾIslāmiyyah al-Mūrītāniyyah
464	54	Islamic Republic of Mauritania
465	54	MR
466	79	MS
467	204	MT
468	204	Repubblika ta' Malta
469	204	Republic of Malta
470	12	MU
471	12	Republic of Mauritius
472	12	République de Maurice
473	147	Dhivehi Raajjeyge Jumhooriyya
474	147	Maldive Islands
475	147	MV
476	147	Republic of the Maldives
477	11	MW
478	11	Republic of Malawi
479	93	Estados Unidos Mexicanos
480	93	Mexicanos
481	93	MX
482	93	United Mexican States
483	138	MY
484	13	MZ
485	13	República de Moçambique
486	13	Republic of Mozambique
487	41	NA
488	41	Namibië
489	41	Republic of Namibia
490	227	NC
491	56	NE
492	56	Nijar
493	56	Republic of Niger
494	56	République du Niger
495	225	NF
496	225	Teratri of Norf'k Ailen
497	225	Territory of Norfolk Island
498	55	Federal Republic of Nigeria
499	55	Naíjíríà
500	55	NG
501	55	Nijeriya
502	94	NI
503	94	República de Nicaragua
504	94	Republic of Nicaragua
505	214	Holland
506	214	Nederland
507	214	NL
508	192	Kingdom of Norway
509	192	Kongeriket Noreg
510	192	Kongeriket Norge
511	192	NO
512	192	Noreg
513	192	Norge
514	148	Federal Democratic Republic of Nepal
515	148	Loktāntrik Ganatantra Nepāl
516	148	NP
517	236	Naoero
518	236	NR
519	236	Pleasant Island
520	236	Republic of Nauru
521	236	Ripublik Naoero
522	241	NU
523	224	Aotearoa
524	224	NZ
525	161	OM
526	161	Salṭanat ʻUmān
527	161	Sultanate of Oman
528	95	PA
529	95	República de Panamá
530	95	Republic of Panama
531	112	PE
532	112	República del Perú
533	112	Republic of Peru
534	240	French Polynesia
535	240	PF
536	240	Polynésie française
537	240	Pōrīnetia Farāni
538	229	Independen Stet bilong Papua Niugini
539	229	Independent State of Papua New Guinea
540	229	PG
541	135	PH
542	135	Republic of the Philippines
543	135	Repúblika ng Pilipinas
544	149	Islamic Republic of Pakistan
545	149	Islāmī Jumhūriya'eh Pākistān
546	149	Pākistān
547	149	PK
548	174	PL
549	174	Republic of Poland
550	174	Rzeczpospolita Polska
551	101	Collectivité territoriale de Saint-Pierre-et-Miquelon
552	101	PM
553	242	Pitcairn Henderson Ducie and Oeno Islands
554	242	PN
555	80	Commonwealth of Puerto Rico
556	80	Estado Libre Asociado de Puerto Rico
557	80	PR
558	162	Dawlat Filasṭin
559	162	PS
560	162	State of Palestine
561	206	Portuguesa
562	206	Portuguese Republic
563	206	PT
564	206	República Portuguesa
565	237	Beluu er a Belau
566	237	PW
567	237	Republic of Palau
568	111	PY
569	111	República del Paraguay
570	111	Republic of Paraguay
571	111	Tetã Paraguái
572	163	Dawlat Qaṭar
573	163	QA
574	163	State of Qatar
575	7	RE
576	7	Reunion
577	175	RO
578	175	România
579	175	Roumania
580	175	Rumania
581	208	Republic of Serbia
582	208	Republika Srbija
583	208	RS
584	208	Srbija
585	208	Република Србија
586	176	Rossiya
587	176	Rossiyskaya Federatsiya
588	176	RU
589	176	Russian Federation
590	176	Российская Федерация
591	14	Republic of Rwanda
592	14	République du Rwanda
593	14	Repubulika y'u Rwanda
594	14	RW
595	164	Al-Mamlakah al-‘Arabiyyah as-Su‘ūdiyyah
596	164	Kingdom of Saudi Arabia
597	164	SA
598	230	SB
599	15	Repiblik Sesel
600	15	Republic of Seychelles
601	15	République des Seychelles
602	15	SC
603	36	Jumhūrīyat as-Sūdān
604	36	Republic of the Sudan
605	36	SD
606	194	Kingdom of Sweden
607	194	Konungariket Sverige
608	194	SE
609	139	Republik Singapura
610	139	SG
611	139	Singapura
612	139	新加坡共和国
613	57	SH
614	209	Republic of Slovenia
615	209	Republika Slovenija
616	209	SI
617	193	SJ
618	193	Svalbard and Jan Mayen Islands
619	177	SK
620	177	Slovak Republic
621	177	Slovenská republika
622	59	Republic of Sierra Leone
623	59	SL
624	207	Repubblica di San Marino
625	207	Republic of San Marino
626	207	SM
627	58	Republic of Senegal
628	58	République du Sénégal
629	58	SN
630	16	aṣ-Ṣūmāl
631	16	Federal Republic of Somalia
632	16	Jamhuuriyadda Federaalka Soomaaliya
633	16	Jumhūriyyat aṣ-Ṣūmāl al-Fiderāliyya
634	16	SO
635	114	Republic of Suriname
636	114	Republiek Suriname
637	114	Sarnam
638	114	SR
639	114	Sranangron
640	30	SS
641	29	Democratic Republic of São Tomé and Príncipe
642	29	República Democrática de São Tomé e Príncipe
643	29	ST
644	96	República de El Salvador
645	96	Republic of El Salvador
646	96	SV
647	72	SX
648	165	Al-Jumhūrīyah Al-ʻArabīyah As-Sūrīyah
649	165	SY
650	165	Syrian Arab Republic
651	43	Kingdom of Swaziland
652	43	Ngwane
653	43	Swatini
654	43	SZ
655	43	Umbuso waseSwatini
656	43	weSwatini
657	86	TC
658	24	Republic of Chad
659	24	République du Tchad
660	24	Tchad
661	24	TD
662	38	TF
663	60	République Togolaise
664	60	TG
665	60	Togolese
666	60	Togolese Republic
667	140	Kingdom of Thailand
668	140	Prathet
669	140	Ratcha Anachak Thai
670	140	TH
671	140	Thai
672	140	ราชอาณาจักรไทย
673	120	Çumhuriyi Toçikiston
674	120	Republic of Tajikistan
675	120	TJ
676	120	Toçikiston
677	120	Ҷумҳурии Тоҷикистон
678	244	TK
679	134	Democratic Republic of Timor-Leste
680	134	East Timor
681	134	República Democrática de Timor-Leste
682	134	Repúblika Demokrátika Timór-Leste
683	134	TL
684	121	TM
685	37	al-Jumhūriyyah at-Tūnisiyyah
686	37	Republic of Tunisia
687	37	TN
688	245	TO
689	166	Republic of Turkey
690	166	TR
691	166	Turkiye
692	166	Türkiye Cumhuriyeti
693	85	Republic of Trinidad and Tobago
694	85	TT
695	246	TV
696	130	Republic of China
697	130	Táiwān
698	130	TW
699	130	Zhōnghuá Mínguó
700	130	中華民國
701	17	Jamhuri ya Muungano wa Tanzania
702	17	TZ
703	17	United Republic of Tanzania
704	178	UA
705	178	Ukrayina
706	18	Jamhuri ya Uganda
707	18	Republic of Uganda
708	18	UG
709	97	UM
710	98	United States of America
711	98	US
712	98	USA
713	115	Oriental Republic of Uruguay
714	115	República Oriental del Uruguay
715	115	UY
716	122	O‘zbekiston Respublikasi
717	122	Republic of Uzbekistan
718	122	UZ
719	122	Ўзбекистон Республикаси
720	211	Sancta Sedes
721	211	The Vatican
722	211	Vatican
723	84	VC
724	116	Bolivarian Republic of Venezuela
725	116	República Bolivariana de Venezuela
726	116	VE
727	87	VG
728	88	American Virgin Islands
729	88	USVI
730	88	U.S. Virgin Islands
731	88	VI
732	141	Cộng hòa Xã hội chủ nghĩa Việt Nam
733	141	Socialist Republic of Vietnam
734	141	VN
735	228	Republic of Vanuatu
736	228	République de Vanuatu
737	228	Ripablik blong Vanuatu
738	228	VU
739	247	Territoire des îles Wallis et Futuna
740	247	Territory of the Wallis and Futuna Islands
741	247	WF
742	243	Independent State of Samoa
743	243	Malo Saʻoloto Tutoʻatasi o Sāmoa
744	243	WS
745	172	XK
746	172	Република Косово
747	167	al-Jumhūriyyah al-Yamaniyyah
748	167	YE
749	167	Yemeni Republic
750	6	Département de Mayotte
751	6	Department of Mayotte
752	6	YT
753	42	Republic of South Africa
754	42	RSA
755	42	Suid-Afrika
756	42	ZA
757	19	Republic of Zambia
758	19	ZM
759	20	Republic of Zimbabwe
760	20	ZW
\.


--
-- TOC entry 5421 (class 0 OID 17230)
-- Dependencies: 273
-- Data for Name: country; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.country (country_id, country_region_id, country_subregion_id, country_demonym_id, country_name, country_iso2, country_iso3, country_capital, country_population, country_latitude, country_longitude, country_area, country_gini, country_nativename, country_numericcode, country_flag, country_cioc) FROM stdin;
1	1	5	35	Burundi	BI	BDI	Bujumbura	10114505	-3.5	30.0	27834.0	33.3	Burundi	108	https://restcountries.eu/data/bdi.svg	BDI
2	1	5	49	Comoros	KM	COM	Moroni	806153	-12.16666666	44.25	1862.0	64.3	Komori	174	https://restcountries.eu/data/com.svg	COM
3	1	5	58	Djibouti	DJ	DJI	Djibouti	900000	11.5	43.0	23200.0	40.0	Djibouti	262	https://restcountries.eu/data/dji.svg	DJI
4	1	5	66	Eritrea	ER	ERI	Asmara	5352000	15.0	39.0	117600.0	\N	ኤርትራ	232	https://restcountries.eu/data/eri.svg	ERI
5	1	5	68	Ethiopia	ET	ETH	Addis Ababa	92206005	8.0	38.0	1104300.0	29.8	ኢትዮጵያ	231	https://restcountries.eu/data/eth.svg	ETH
6	1	5	74	Mayotte	YT	MYT	Mamoudzou	226915	-12.83333333	45.16666666	\N	\N	Mayotte	175	https://restcountries.eu/data/myt.svg	\N
7	1	5	74	Réunion	RE	REU	Saint-Denis	840974	-21.15	55.5	\N	\N	La Réunion	638	https://restcountries.eu/data/reu.svg	\N
8	1	5	97	British Indian Ocean Territory	IO	IOT	Diego Garcia	3000	-6.0	71.5	60.0	\N	British Indian Ocean Territory	086	https://restcountries.eu/data/iot.svg	\N
9	1	5	109	Kenya	KE	KEN	Nairobi	47251000	1.0	38.0	580367.0	47.7	Kenya	404	https://restcountries.eu/data/ken.svg	KEN
10	1	5	123	Madagascar	MG	MDG	Antananarivo	22434363	-20.0	47.0	587041.0	44.1	Madagasikara	450	https://restcountries.eu/data/mdg.svg	MAD
11	1	5	124	Malawi	MW	MWI	Lilongwe	16832910	-13.5	34.0	118484.0	39.0	Malawi	454	https://restcountries.eu/data/mwi.svg	MAW
12	1	5	132	Mauritius	MU	MUS	Port Louis	1262879	-20.28333333	57.55	2040.0	\N	Maurice	480	https://restcountries.eu/data/mus.svg	MRI
13	1	5	143	Mozambique	MZ	MOZ	Maputo	26423700	-18.25	35.0	801590.0	45.7	Moçambique	508	https://restcountries.eu/data/moz.svg	MOZ
14	1	5	172	Rwanda	RW	RWA	Kigali	11553188	-2.0	30.0	26338.0	50.8	Rwanda	646	https://restcountries.eu/data/rwa.svg	RWA
15	1	5	186	Seychelles	SC	SYC	Victoria	91400	-4.58333333	55.66666666	452.0	65.8	Seychelles	690	https://restcountries.eu/data/syc.svg	SEY
16	1	5	192	Somalia	SO	SOM	Mogadishu	11079000	10.0	49.0	637657.0	\N	Soomaaliya	706	https://restcountries.eu/data/som.svg	SOM
17	1	5	207	Tanzania, United Republic of	TZ	TZA	Dodoma	55155000	-6.0	35.0	945087.0	37.6	Tanzania	834	https://restcountries.eu/data/tza.svg	TAN
18	1	5	218	Uganda	UG	UGA	Kampala	33860700	1.0	32.0	241550.0	44.3	Uganda	800	https://restcountries.eu/data/uga.svg	UGA
19	1	5	227	Zambia	ZM	ZMB	Lusaka	15933883	-15.0	30.0	752612.0	54.6	Zambia	894	https://restcountries.eu/data/zmb.svg	ZAM
20	1	5	228	Zimbabwe	ZW	ZWE	Harare	14240168	-20.0	30.0	390757.0	\N	Zimbabwe	716	https://restcountries.eu/data/zwe.svg	ZIM
21	1	10	8	Angola	AO	AGO	Luanda	25868000	-12.5	18.5	1246700.0	58.6	Angola	024	https://restcountries.eu/data/ago.svg	ANG
22	1	10	37	Cameroon	CM	CMR	Yaoundé	22709892	6.0	12.0	475442.0	38.9	Cameroon	120	https://restcountries.eu/data/cmr.svg	CMR
23	1	10	41	Central African Republic	CF	CAF	Bangui	4998000	7.0	21.0	622984.0	56.3	Ködörösêse tî Bêafrîka	140	https://restcountries.eu/data/caf.svg	CAF
24	1	10	42	Chad	TD	TCD	N'Djamena	14497000	15.0	19.0	1284000.0	39.8	Tchad	148	https://restcountries.eu/data/tcd.svg	CHA
25	1	10	50	Congo	CG	COG	Brazzaville	4741000	-1.0	15.0	342000.0	47.3	République du Congo	178	https://restcountries.eu/data/cog.svg	CGO
26	1	10	50	Congo (Democratic Republic of the)	CD	COD	Kinshasa	85026000	0.0	25.0	2344858.0	\N	République démocratique du Congo	180	https://restcountries.eu/data/cod.svg	COD
27	1	10	65	Equatorial Guinea	GQ	GNQ	Malabo	1222442	2.0	10.0	28051.0	\N	Guinea Ecuatorial	226	https://restcountries.eu/data/gnq.svg	GEQ
28	1	10	76	Gabon	GA	GAB	Libreville	1802278	-1.0	11.75	267668.0	41.5	Gabon	266	https://restcountries.eu/data/gab.svg	GAB
29	1	10	182	Sao Tome and Principe	ST	STP	São Tomé	187356	1.0	7.0	964.0	50.8	São Tomé e Príncipe	678	https://restcountries.eu/data/stp.svg	STP
30	1	10	196	South Sudan	SS	SSD	Juba	12131000	7.0	30.0	619745.0	45.5	South Sudan	728	https://restcountries.eu/data/ssd.svg	\N
31	1	11	4	Algeria	DZ	DZA	Algiers	40400000	28.0	3.0	2381741.0	35.3	الجزائر	012	https://restcountries.eu/data/dza.svg	ALG
32	1	11	63	Egypt	EG	EGY	Cairo	91290000	27.0	30.0	1002450.0	30.8	مصر‎	818	https://restcountries.eu/data/egy.svg	EGY
33	1	11	118	Libya	LY	LBY	Tripoli	6385000	25.0	17.0	1759540.0	\N	‏ليبيا	434	https://restcountries.eu/data/lby.svg	LBA
34	1	11	140	Morocco	MA	MAR	Rabat	33337529	32.0	-5.0	446550.0	40.9	المغرب	504	https://restcountries.eu/data/mar.svg	MAR
35	1	11	173	Western Sahara	EH	ESH	El Aaiún	510713	24.5	-13.0	266000.0	\N	الصحراء الغربية	732	https://restcountries.eu/data/esh.svg	\N
36	1	11	199	Sudan	SD	SDN	Khartoum	39598700	15.0	30.0	1886068.0	35.3	السودان	729	https://restcountries.eu/data/sdn.svg	SUD
37	1	11	213	Tunisia	TN	TUN	Tunis	11154400	34.0	9.0	163610.0	41.4	تونس	788	https://restcountries.eu/data/tun.svg	TUN
38	1	17	74	French Southern Territories	TF	ATF	Port-aux-Français	140	-49.25	69.167	7747.0	\N	Territoire des Terres australes et antarctiques françaises	260	https://restcountries.eu/data/atf.svg	\N
39	1	17	141	Lesotho	LS	LSO	Maseru	1894194	-29.5	28.5	30355.0	52.5	Lesotho	426	https://restcountries.eu/data/lso.svg	LES
40	1	17	142	Botswana	BW	BWA	Gaborone	2141206	-22.0	24.0	582000.0	61.0	Botswana	072	https://restcountries.eu/data/bwa.svg	BOT
41	1	17	144	Namibia	NA	NAM	Windhoek	2324388	-22.0	17.0	825615.0	63.9	Namibia	516	https://restcountries.eu/data/nam.svg	NAM
42	1	17	193	South Africa	ZA	ZAF	Pretoria	55653654	-29.0	24.0	1221037.0	63.1	South Africa	710	https://restcountries.eu/data/zaf.svg	RSA
43	1	17	201	Swaziland	SZ	SWZ	Lobamba	1132657	-26.5	31.5	17364.0	51.5	Swaziland	748	https://restcountries.eu/data/swz.svg	SWZ
44	1	20	24	Benin	BJ	BEN	Porto-Novo	10653654	9.5	2.25	112622.0	38.6	Bénin	204	https://restcountries.eu/data/ben.svg	BEN
45	1	20	33	Burkina Faso	BF	BFA	Ouagadougou	19034397	13.0	-2.0	272967.0	39.8	Burkina Faso	854	https://restcountries.eu/data/bfa.svg	BUR
46	1	20	39	Cabo Verde	CV	CPV	Praia	531239	16.0	-24.0	4033.0	50.5	Cabo Verde	132	https://restcountries.eu/data/cpv.svg	CPV
47	1	20	77	Gambia	GM	GMB	Banjul	1882450	13.46666666	-16.56666666	11295.0	\N	Gambia	270	https://restcountries.eu/data/gmb.svg	GAM
48	1	20	80	Ghana	GH	GHA	Accra	27670174	8.0	-2.0	238533.0	42.8	Ghana	288	https://restcountries.eu/data/gha.svg	GHA
49	1	20	88	Guinea-Bissau	GW	GNB	Bissau	1547777	12.0	-15.0	36125.0	35.5	Guiné-Bissau	624	https://restcountries.eu/data/gnb.svg	GBS
50	1	20	89	Guinea	GN	GIN	Conakry	12947000	11.0	-10.0	245857.0	39.4	Guinée	324	https://restcountries.eu/data/gin.svg	GUI
51	1	20	104	Côte d'Ivoire	CI	CIV	Yamoussoukro	22671331	8.0	-5.0	322463.0	41.5	Côte d'Ivoire	384	https://restcountries.eu/data/civ.svg	CIV
52	1	20	117	Liberia	LR	LBR	Monrovia	4615000	6.5	-9.5	111369.0	38.2	Liberia	430	https://restcountries.eu/data/lbr.svg	LBR
53	1	20	127	Mali	ML	MLI	Bamako	18135000	17.0	-4.0	1240192.0	33.0	Mali	466	https://restcountries.eu/data/mli.svg	MLI
54	1	20	131	Mauritania	MR	MRT	Nouakchott	3718678	20.0	-12.0	1030700.0	40.5	موريتانيا	478	https://restcountries.eu/data/mrt.svg	MTN
55	1	20	150	Nigeria	NG	NGA	Abuja	186988000	10.0	8.0	923768.0	48.8	Nigeria	566	https://restcountries.eu/data/nga.svg	NGR
56	1	20	151	Niger	NE	NER	Niamey	20715000	16.0	8.0	1267000.0	34.6	Niger	562	https://restcountries.eu/data/ner.svg	NIG
57	1	20	175	Saint Helena, Ascension and Tristan da Cunha	SH	SHN	Jamestown	4255	-15.95	-5.7	\N	\N	Saint Helena	654	https://restcountries.eu/data/shn.svg	\N
58	1	20	184	Senegal	SN	SEN	Dakar	14799859	14.0	-14.0	196722.0	39.2	Sénégal	686	https://restcountries.eu/data/sen.svg	SEN
59	1	20	187	Sierra Leone	SL	SLE	Freetown	7075641	8.5	-11.5	71740.0	42.5	Sierra Leone	694	https://restcountries.eu/data/sle.svg	SLE
60	1	20	209	Togo	TG	TGO	Lomé	7143000	8.0	1.16666666	56785.0	34.4	Togo	768	https://restcountries.eu/data/tgo.svg	TOG
61	2	2	9	Anguilla	AI	AIA	The Valley	13452	18.25	-63.16666666	91.0	\N	Anguilla	660	https://restcountries.eu/data/aia.svg	\N
62	2	2	10	Antigua and Barbuda	AG	ATG	Saint John's	86295	17.05	-61.8	442.0	\N	Antigua and Barbuda	028	https://restcountries.eu/data/atg.svg	ANT
63	2	2	13	Aruba	AW	ABW	Oranjestad	107394	12.5	-69.96666666	180.0	\N	Aruba	533	https://restcountries.eu/data/abw.svg	ARU
64	2	2	17	Bahamas	BS	BHS	Nassau	378040	24.25	-76.0	13943.0	\N	Bahamas	044	https://restcountries.eu/data/bhs.svg	BAH
65	2	2	20	Barbados	BB	BRB	Bridgetown	285000	13.16666666	-59.53333333	430.0	\N	Barbados	052	https://restcountries.eu/data/brb.svg	BAR
66	2	2	40	Cayman Islands	KY	CYM	George Town	58238	19.5	-80.5	264.0	\N	Cayman Islands	136	https://restcountries.eu/data/cym.svg	CAY
67	2	2	54	Cuba	CU	CUB	Havana	11239004	21.5	-80.0	109884.0	\N	Cuba	192	https://restcountries.eu/data/cub.svg	CUB
68	2	2	59	Dominica	DM	DMA	Roseau	71293	15.41666666	-61.33333333	751.0	\N	Dominica	212	https://restcountries.eu/data/dma.svg	DMA
69	2	2	59	Dominican Republic	DO	DOM	Santo Domingo	10075045	19.0	-70.66666666	48671.0	47.2	República Dominicana	214	https://restcountries.eu/data/dom.svg	DOM
70	2	2	60	Bonaire, Sint Eustatius and Saba	BQ	BES	Kralendijk	17408	12.15	-68.266667	294.0	\N	Bonaire	535	https://restcountries.eu/data/bes.svg	\N
71	2	2	60	Curaçao	CW	CUW	Willemstad	154843	12.116667	-68.933333	444.0	\N	Curaçao	531	https://restcountries.eu/data/cuw.svg	\N
72	2	2	60	Sint Maarten (Dutch part)	SX	SXM	Philipsburg	38247	18.033333	-63.05	34.0	\N	Sint Maarten	534	https://restcountries.eu/data/sxm.svg	\N
73	2	2	74	Martinique	MQ	MTQ	Fort-de-France	378243	14.666667	-61.0	\N	\N	Martinique	474	https://restcountries.eu/data/mtq.svg	\N
74	2	2	84	Grenada	GD	GRD	St. George's	103328	12.11666666	-61.66666666	344.0	\N	Grenada	308	https://restcountries.eu/data/grd.svg	GRN
75	2	2	85	Guadeloupe	GP	GLP	Basse-Terre	400132	16.25	-61.583333	\N	\N	Guadeloupe	312	https://restcountries.eu/data/glp.svg	\N
76	2	2	91	Haiti	HT	HTI	Port-au-Prince	11078033	19.0	-72.41666666	27750.0	59.2	Haïti	332	https://restcountries.eu/data/hti.svg	HAI
77	2	2	105	Jamaica	JM	JAM	Kingston	2723246	18.25	-77.5	10991.0	45.5	Jamaica	388	https://restcountries.eu/data/jam.svg	JAM
78	2	2	111	Saint Kitts and Nevis	KN	KNA	Basseterre	46204	17.33333333	-62.75	261.0	\N	Saint Kitts and Nevis	659	https://restcountries.eu/data/kna.svg	SKN
79	2	2	139	Montserrat	MS	MSR	Plymouth	4922	16.75	-62.2	102.0	\N	Montserrat	500	https://restcountries.eu/data/msr.svg	\N
80	2	2	168	Puerto Rico	PR	PRI	San Juan	3474182	18.25	-66.5	8870.0	\N	Puerto Rico	630	https://restcountries.eu/data/pri.svg	PUR
81	2	2	174	Saint Barthélemy	BL	BLM	Gustavia	9417	18.5	-63.41666666	21.0	\N	Saint-Barthélemy	652	https://restcountries.eu/data/blm.svg	\N
82	2	2	176	Saint Lucia	LC	LCA	Castries	186000	13.88333333	-60.96666666	616.0	42.6	Saint Lucia	662	https://restcountries.eu/data/lca.svg	LCA
83	2	2	177	Saint Martin (French part)	MF	MAF	Marigot	36979	18.08333333	-63.95	53.0	\N	Saint-Martin	663	https://restcountries.eu/data/maf.svg	\N
84	2	2	178	Saint Vincent and the Grenadines	VC	VCT	Kingstown	109991	13.25	-61.2	389.0	\N	Saint Vincent and the Grenadines	670	https://restcountries.eu/data/vct.svg	VIN
85	2	2	212	Trinidad and Tobago	TT	TTO	Port of Spain	1349667	11.0	-61.0	5130.0	40.3	Trinidad and Tobago	780	https://restcountries.eu/data/tto.svg	TTO
86	2	2	216	Turks and Caicos Islands	TC	TCA	Cockburn Town	31458	21.75	-71.58333333	948.0	\N	Turks and Caicos Islands	796	https://restcountries.eu/data/tca.svg	\N
87	2	2	224	Virgin Islands (British)	VG	VGB	Road Town	28514	18.431383	-64.62305	151.0	\N	British Virgin Islands	092	https://restcountries.eu/data/vgb.svg	IVB
88	2	2	224	Virgin Islands (U.S.)	VI	VIR	Charlotte Amalie	114743	18.34	-64.93	346.36	\N	Virgin Islands of the United States	850	https://restcountries.eu/data/vir.svg	ISV
89	2	3	23	Belize	BZ	BLZ	Belmopan	370300	17.25	-88.75	22966.0	53.1	Belize	084	https://restcountries.eu/data/blz.svg	BIZ
90	2	3	52	Costa Rica	CR	CRI	San José	4890379	10.0	-84.0	51100.0	50.7	Costa Rica	188	https://restcountries.eu/data/cri.svg	CRC
91	2	3	87	Guatemala	GT	GTM	Guatemala City	16176133	15.5	-90.25	108889.0	55.9	Guatemala	320	https://restcountries.eu/data/gtm.svg	GUA
92	2	3	93	Honduras	HN	HND	Tegucigalpa	8576532	15.0	-86.5	112492.0	57.0	Honduras	340	https://restcountries.eu/data/hnd.svg	HON
93	2	3	133	Mexico	MX	MEX	Mexico City	122273473	23.0	-102.0	1964375.0	47.0	México	484	https://restcountries.eu/data/mex.svg	MEX
94	2	3	149	Nicaragua	NI	NIC	Managua	6262703	13.0	-85.0	130373.0	40.5	Nicaragua	558	https://restcountries.eu/data/nic.svg	NCA
95	2	3	161	Panama	PA	PAN	Panama City	3814672	9.0	-80.0	75417.0	51.9	Panamá	591	https://restcountries.eu/data/pan.svg	PAN
96	2	3	179	El Salvador	SV	SLV	San Salvador	6520675	13.83333333	-88.91666666	21041.0	48.3	El Salvador	222	https://restcountries.eu/data/slv.svg	ESA
97	2	12	5	United States Minor Outlying Islands	UM	UMI	\N	300	\N	\N	\N	\N	United States Minor Outlying Islands	581	https://restcountries.eu/data/umi.svg	\N
98	2	12	5	United States of America	US	USA	Washington, D.C.	323947000	38.0	-97.0	9629091.0	48.0	United States	840	https://restcountries.eu/data/usa.svg	USA
99	2	12	25	Bermuda	BM	BMU	Hamilton	61954	32.33333333	-64.75	54.0	\N	Bermuda	060	https://restcountries.eu/data/bmu.svg	BER
100	2	12	38	Canada	CA	CAN	Ottawa	36155487	60.0	-95.0	9984670.0	32.6	Canada	124	https://restcountries.eu/data/can.svg	CAN
101	2	12	74	Saint Pierre and Miquelon	PM	SPM	Saint-Pierre	6069	46.83333333	-56.33333333	242.0	\N	Saint-Pierre-et-Miquelon	666	https://restcountries.eu/data/spm.svg	\N
102	2	12	83	Greenland	GL	GRL	Nuuk	55847	72.0	-40.0	2166086.0	\N	Kalaallit Nunaat	304	https://restcountries.eu/data/grl.svg	\N
103	2	15	11	Argentina	AR	ARG	Buenos Aires	43590400	-34.0	-64.0	2780400.0	44.5	Argentina	032	https://restcountries.eu/data/arg.svg	ARG
104	2	15	27	Bolivia (Plurinational State of)	BO	BOL	Sucre	10985059	-17.0	-65.0	1098581.0	56.3	Bolivia	068	https://restcountries.eu/data/bol.svg	BOL
105	2	15	29	Brazil	BR	BRA	Brasília	206135893	-10.0	-55.0	8515767.0	54.7	Brasil	076	https://restcountries.eu/data/bra.svg	BRA
106	2	15	44	Chile	CL	CHL	Santiago	18191900	-30.0	-71.0	756102.0	52.1	Chile	152	https://restcountries.eu/data/chl.svg	CHI
107	2	15	48	Colombia	CO	COL	Bogotá	48759958	4.0	-72.0	1141748.0	55.9	Colombia	170	https://restcountries.eu/data/col.svg	COL
108	2	15	62	Ecuador	EC	ECU	Quito	16545799	-2.0	-77.5	276841.0	49.3	Ecuador	218	https://restcountries.eu/data/ecu.svg	ECU
109	2	15	69	Falkland Islands (Malvinas)	FK	FLK	Stanley	2563	-51.75	-59.0	12173.0	\N	Falkland Islands	238	https://restcountries.eu/data/flk.svg	\N
110	2	15	90	Guyana	GY	GUY	Georgetown	746900	5.0	-59.0	214969.0	44.5	Guyana	328	https://restcountries.eu/data/guy.svg	GUY
111	2	15	163	Paraguay	PY	PRY	Asunción	6854536	-23.0	-58.0	406752.0	52.4	Paraguay	600	https://restcountries.eu/data/pry.svg	PAR
112	2	15	164	Peru	PE	PER	Lima	31488700	-10.0	-76.0	1285216.0	48.1	Perú	604	https://restcountries.eu/data/per.svg	PER
113	2	15	194	South Georgia and the South Sandwich Islands	GS	SGS	King Edward Point	30	-54.5	-37.0	\N	\N	South Georgia	239	https://restcountries.eu/data/sgs.svg	\N
114	2	15	200	Suriname	SR	SUR	Paramaribo	541638	4.0	-56.0	163820.0	52.9	Suriname	740	https://restcountries.eu/data/sur.svg	SUR
115	2	15	220	Uruguay	UY	URY	Montevideo	3480222	-33.0	-56.0	181034.0	39.7	Uruguay	858	https://restcountries.eu/data/ury.svg	URU
116	2	15	222	Venezuela (Bolivarian Republic of)	VE	VEN	Caracas	31028700	8.0	-66.0	916445.0	44.8	Venezuela	862	https://restcountries.eu/data/ven.svg	VEN
117	2	15	\N	French Guiana	GF	GUF	Cayenne	254541	4.0	-53.0	\N	\N	Guyane française	254	https://restcountries.eu/data/guf.svg	\N
118	3	4	108	Kazakhstan	KZ	KAZ	Astana	17753200	48.0	68.0	2724900.0	29.0	Қазақстан	398	https://restcountries.eu/data/kaz.svg	KAZ
119	3	4	110	Kyrgyzstan	KG	KGZ	Bishkek	6047800	41.0	75.0	199951.0	36.2	Кыргызстан	417	https://restcountries.eu/data/kgz.svg	KGZ
120	3	4	205	Tajikistan	TJ	TJK	Dushanbe	8593600	39.0	71.0	143100.0	30.8	Тоҷикистон	762	https://restcountries.eu/data/tjk.svg	TJK
121	3	4	215	Turkmenistan	TM	TKM	Ashgabat	4751120	40.0	60.0	488100.0	40.8	Türkmenistan	795	https://restcountries.eu/data/tkm.svg	TKM
122	3	4	221	Uzbekistan	UZ	UZB	Tashkent	31576400	41.0	64.0	447400.0	36.7	O‘zbekiston	860	https://restcountries.eu/data/uzb.svg	UZB
123	3	6	45	China	CN	CHN	Beijing	1377422166	35.0	105.0	9640011.0	47.0	中国	156	https://restcountries.eu/data/chn.svg	CHN
124	3	6	45	Hong Kong	HK	HKG	City of Victoria	7324300	22.25	114.16666666	1104.0	53.3	香港	344	https://restcountries.eu/data/hkg.svg	HKG
125	3	6	45	Macao	MO	MAC	\N	649100	22.16666666	113.55	30.0	\N	澳門	446	https://restcountries.eu/data/mac.svg	\N
126	3	6	106	Japan	JP	JPN	Tokyo	126960000	36.0	138.0	377930.0	38.1	日本	392	https://restcountries.eu/data/jpn.svg	JPN
127	3	6	137	Mongolia	MN	MNG	Ulan Bator	3093100	46.0	105.0	1564110.0	36.5	Монгол улс	496	https://restcountries.eu/data/mng.svg	MGL
128	3	6	155	Korea (Democratic People's Republic of)	KP	PRK	Pyongyang	25281000	40.0	127.0	120538.0	\N	북한	408	https://restcountries.eu/data/prk.svg	PRK
129	3	6	195	Korea (Republic of)	KR	KOR	Seoul	50801405	37.0	127.5	100210.0	31.3	대한민국	410	https://restcountries.eu/data/kor.svg	KOR
130	3	6	206	Taiwan	TW	TWN	Taipei	23503349	23.5	121.0	36193.0	\N	臺灣	158	https://restcountries.eu/data/twn.svg	TPE
131	3	16	31	Brunei Darussalam	BN	BRN	Bandar Seri Begawan	411900	4.5	114.66666666	5765.0	\N	Negara Brunei Darussalam	096	https://restcountries.eu/data/brn.svg	BRU
132	3	16	34	Myanmar	MM	MMR	Naypyidaw	51419420	22.0	98.0	676578.0	\N	Myanma	104	https://restcountries.eu/data/mmr.svg	MYA
133	3	16	36	Cambodia	KH	KHM	Phnom Penh	15626444	13.0	105.0	181035.0	37.9	Kâmpŭchéa	116	https://restcountries.eu/data/khm.svg	CAM
134	3	16	61	Timor-Leste	TL	TLS	Dili	1167242	-8.83333333	125.91666666	14874.0	31.9	Timor-Leste	626	https://restcountries.eu/data/tls.svg	TLS
135	3	16	72	Philippines	PH	PHL	Manila	103279800	13.0	122.0	342353.0	43.0	Pilipinas	608	https://restcountries.eu/data/phl.svg	PHI
136	3	16	98	Indonesia	ID	IDN	Jakarta	258705000	-5.0	120.0	1904569.0	34.0	Indonesia	360	https://restcountries.eu/data/idn.svg	INA
137	3	16	114	Lao People's Democratic Republic	LA	LAO	Vientiane	6492400	18.0	105.0	236800.0	36.7	ສປປລາວ	418	https://restcountries.eu/data/lao.svg	LAO
138	3	16	125	Malaysia	MY	MYS	Kuala Lumpur	31405416	2.5	112.5	330803.0	46.2	Malaysia	458	https://restcountries.eu/data/mys.svg	MAS
139	3	16	188	Singapore	SG	SGP	Singapore	5535000	1.36666666	103.8	710.0	48.1	Singapore	702	https://restcountries.eu/data/sgp.svg	SIN
140	3	16	208	Thailand	TH	THA	Bangkok	65327652	15.0	100.0	513120.0	40.0	ประเทศไทย	764	https://restcountries.eu/data/tha.svg	THA
141	3	16	223	Viet Nam	VN	VNM	Hanoi	92700000	16.16666666	107.83333333	331212.0	35.6	Việt Nam	704	https://restcountries.eu/data/vnm.svg	VIE
142	3	18	1	Afghanistan	AF	AFG	Kabul	27657145	33.0	65.0	652230.0	27.8	افغانستان	004	https://restcountries.eu/data/afg.svg	AFG
143	3	18	19	Bangladesh	BD	BGD	Dhaka	161006790	24.0	90.0	147570.0	32.1	Bangladesh	050	https://restcountries.eu/data/bgd.svg	BAN
144	3	18	26	Bhutan	BT	BTN	Thimphu	775620	27.5	90.5	38394.0	38.1	ʼbrug-yul	064	https://restcountries.eu/data/btn.svg	BHU
145	3	18	97	India	IN	IND	New Delhi	1295210000	20.0	77.0	3287590.0	33.4	भारत	356	https://restcountries.eu/data/ind.svg	IND
146	3	18	99	Iran (Islamic Republic of)	IR	IRN	Tehran	79369900	32.0	53.0	1648195.0	38.3	ایران	364	https://restcountries.eu/data/irn.svg	IRI
147	3	18	126	Maldives	MV	MDV	Malé	344023	3.25	73.0	300.0	37.4	Maldives	462	https://restcountries.eu/data/mdv.svg	MDV
148	3	18	146	Nepal	NP	NPL	Kathmandu	28431500	28.0	84.0	147181.0	32.8	नेपाल	524	https://restcountries.eu/data/npl.svg	NEP
149	3	18	158	Pakistan	PK	PAK	Islamabad	194125062	30.0	70.0	881912.0	30.0	Pakistan	586	https://restcountries.eu/data/pak.svg	PAK
150	3	18	198	Sri Lanka	LK	LKA	Colombo	20966000	7.0	81.0	65610.0	40.3	śrī laṃkāva	144	https://restcountries.eu/data/lka.svg	SRI
151	3	21	12	Armenia	AM	ARM	Yerevan	2994400	40.0	45.0	29743.0	30.9	Հայաստան	051	https://restcountries.eu/data/arm.svg	ARM
152	3	21	16	Azerbaijan	AZ	AZE	Baku	9730500	40.5	47.5	86600.0	33.7	Azərbaycan	031	https://restcountries.eu/data/aze.svg	AZE
153	3	21	18	Bahrain	BH	BHR	Manama	1404900	26.0	50.55	765.0	\N	‏البحرين	048	https://restcountries.eu/data/bhr.svg	BRN
206	4	19	167	Portugal	PT	PRT	Lisbon	10374822	39.5	-8.0	92090.0	38.5	Portugal	620	https://restcountries.eu/data/prt.svg	POR
154	3	21	64	United Arab Emirates	AE	ARE	Abu Dhabi	9856000	24.0	54.0	83600.0	\N	دولة الإمارات العربية المتحدة	784	https://restcountries.eu/data/are.svg	UAE
155	3	21	78	Georgia	GE	GEO	Tbilisi	3720400	42.0	43.5	69700.0	41.3	საქართველო	268	https://restcountries.eu/data/geo.svg	GEO
156	3	21	100	Iraq	IQ	IRQ	Baghdad	37883543	33.0	44.0	438317.0	30.9	العراق	368	https://restcountries.eu/data/irq.svg	IRQ
157	3	21	102	Israel	IL	ISR	Jerusalem	8527400	31.5	34.75	20770.0	39.2	יִשְׂרָאֵל	376	https://restcountries.eu/data/isr.svg	ISR
158	3	21	107	Jordan	JO	JOR	Amman	9531712	31.0	36.0	89342.0	35.4	الأردن	400	https://restcountries.eu/data/jor.svg	JOR
159	3	21	113	Kuwait	KW	KWT	Kuwait City	4183658	29.5	45.75	17818.0	\N	الكويت	414	https://restcountries.eu/data/kwt.svg	KUW
160	3	21	116	Lebanon	LB	LBN	Beirut	5988000	33.83333333	35.83333333	10452.0	\N	لبنان	422	https://restcountries.eu/data/lbn.svg	LIB
161	3	21	157	Oman	OM	OMN	Muscat	4420133	21.0	57.0	309500.0	\N	عمان	512	https://restcountries.eu/data/omn.svg	OMA
162	3	21	160	Palestine, State of	PS	PSE	Ramallah	4682467	31.9	35.2	\N	35.5	فلسطين	275	https://restcountries.eu/data/pse.svg	PLE
163	3	21	169	Qatar	QA	QAT	Doha	2587564	25.5	51.25	11586.0	41.1	قطر	634	https://restcountries.eu/data/qat.svg	QAT
164	3	21	183	Saudi Arabia	SA	SAU	Riyadh	32248200	25.0	45.0	2149690.0	\N	العربية السعودية	682	https://restcountries.eu/data/sau.svg	KSA
165	3	21	204	Syrian Arab Republic	SY	SYR	Damascus	18564000	35.0	38.0	185180.0	35.8	سوريا	760	https://restcountries.eu/data/syr.svg	SYR
166	3	21	214	Turkey	TR	TUR	Ankara	78741053	39.0	35.0	783562.0	39.0	Türkiye	792	https://restcountries.eu/data/tur.svg	TUR
167	3	21	226	Yemen	YE	YEM	Sana'a	27478000	15.0	48.0	527968.0	37.7	اليَمَن	887	https://restcountries.eu/data/yem.svg	YEM
168	4	7	21	Belarus	BY	BLR	Minsk	9498700	53.0	28.0	207600.0	26.5	Белару́сь	112	https://restcountries.eu/data/blr.svg	BLR
169	4	7	32	Bulgaria	BG	BGR	Sofia	7153784	43.0	25.0	110879.0	28.2	България	100	https://restcountries.eu/data/bgr.svg	BUL
170	4	7	56	Czech Republic	CZ	CZE	Prague	10558524	49.75	15.5	78865.0	26.0	Česká republika	203	https://restcountries.eu/data/cze.svg	CZE
171	4	7	94	Hungary	HU	HUN	Budapest	9823000	47.0	20.0	93028.0	31.2	Magyarország	348	https://restcountries.eu/data/hun.svg	HUN
172	4	7	112	Republic of Kosovo	XK	KOS	Pristina	1733842	42.666667	21.166667	10908.0	\N	Republika e Kosovës	\N	https://restcountries.eu/data/kos.svg	\N
173	4	7	135	Moldova (Republic of)	MD	MDA	Chișinău	3553100	47.0	29.0	33846.0	33.0	Moldova	498	https://restcountries.eu/data/mda.svg	MDA
174	4	7	166	Poland	PL	POL	Warsaw	38437239	52.0	20.0	312679.0	34.1	Polska	616	https://restcountries.eu/data/pol.svg	POL
175	4	7	170	Romania	RO	ROU	Bucharest	19861408	46.0	25.0	238391.0	30.0	România	642	https://restcountries.eu/data/rou.svg	ROU
176	4	7	171	Russian Federation	RU	RUS	Moscow	146599183	60.0	100.0	17124442	40.1	Россия	643	https://restcountries.eu/data/rus.svg	RUS
177	4	7	189	Slovakia	SK	SVK	Bratislava	5426252	48.66666666	19.5	49037.0	26.0	Slovensko	703	https://restcountries.eu/data/svk.svg	SVK
178	4	7	219	Ukraine	UA	UKR	Kiev	42692393	49.0	32.0	603700.0	26.4	Україна	804	https://restcountries.eu/data/ukr.svg	UKR
179	4	13	2	Åland Islands	AX	ALA	Mariehamn	28875	60.116667	19.9	1580.0	\N	Åland	248	https://restcountries.eu/data/ala.svg	\N
180	4	13	30	United Kingdom of Great Britain and Northern Ireland	GB	GBR	London	65110000	54.0	-2.0	242900.0	34.0	United Kingdom	826	https://restcountries.eu/data/gbr.svg	GBR
181	4	13	43	Guernsey	GG	GGY	St. Peter Port	62999	49.46666666	-2.58333333	78.0	\N	Guernsey	831	https://restcountries.eu/data/ggy.svg	\N
182	4	13	43	Jersey	JE	JEY	Saint Helier	100800	49.25	-2.16666666	116.0	\N	Jersey	832	https://restcountries.eu/data/jey.svg	\N
183	4	13	57	Denmark	DK	DNK	Copenhagen	5717014	56.0	10.0	43094.0	24.0	Danmark	208	https://restcountries.eu/data/dnk.svg	DEN
184	4	13	67	Estonia	EE	EST	Tallinn	1315944	59.0	26.0	45227.0	36.0	Eesti	233	https://restcountries.eu/data/est.svg	EST
185	4	13	70	Faroe Islands	FO	FRO	Tórshavn	49376	62.0	-7.0	1393.0	\N	Føroyar	234	https://restcountries.eu/data/fro.svg	\N
186	4	13	73	Finland	FI	FIN	Helsinki	5491817	64.0	26.0	338424.0	26.9	Suomi	246	https://restcountries.eu/data/fin.svg	FIN
187	4	13	95	Iceland	IS	ISL	Reykjavík	334300	65.0	-18.0	103000.0	\N	Ísland	352	https://restcountries.eu/data/isl.svg	ISL
188	4	13	101	Ireland	IE	IRL	Dublin	6378000	53.0	-8.0	70273.0	34.3	Éire	372	https://restcountries.eu/data/irl.svg	IRL
189	4	13	115	Latvia	LV	LVA	Riga	1961600	57.0	25.0	64559.0	36.6	Latvija	428	https://restcountries.eu/data/lva.svg	LAT
190	4	13	120	Lithuania	LT	LTU	Vilnius	2872294	56.0	24.0	65300.0	37.6	Lietuva	440	https://restcountries.eu/data/ltu.svg	LTU
191	4	13	129	Isle of Man	IM	IMN	Douglas	84497	54.25	-4.5	572.0	\N	Isle of Man	833	https://restcountries.eu/data/imn.svg	\N
192	4	13	156	Norway	NO	NOR	Oslo	5223256	62.0	10.0	323802.0	25.8	Norge	578	https://restcountries.eu/data/nor.svg	NOR
193	4	13	156	Svalbard and Jan Mayen	SJ	SJM	Longyearbyen	2562	78.0	20.0	\N	\N	Svalbard og Jan Mayen	744	https://restcountries.eu/data/sjm.svg	\N
194	4	13	202	Sweden	SE	SWE	Stockholm	9894888	62.0	15.0	450295.0	25.0	Sverige	752	https://restcountries.eu/data/swe.svg	SWE
195	4	19	3	Albania	AL	ALB	Tirana	2886026	41.0	20.0	28748.0	34.5	Shqipëria	008	https://restcountries.eu/data/alb.svg	ALB
196	4	19	7	Andorra	AD	AND	Andorra la Vella	78014	42.5	1.5	468.0	\N	Andorra	020	https://restcountries.eu/data/and.svg	AND
197	4	19	28	Bosnia and Herzegovina	BA	BIH	Sarajevo	3531159	44.0	18.0	51209.0	36.2	Bosna i Hercegovina	070	https://restcountries.eu/data/bih.svg	BIH
198	4	19	53	Croatia	HR	HRV	Zagreb	4190669	45.16666666	15.5	56594.0	33.7	Hrvatska	191	https://restcountries.eu/data/hrv.svg	CRO
199	4	19	55	Cyprus	CY	CYP	Nicosia	847000	35.0	33.0	9251.0	\N	Κύπρος	196	https://restcountries.eu/data/cyp.svg	CYP
200	4	19	81	Gibraltar	GI	GIB	Gibraltar	33140	36.13333333	-5.35	6.0	\N	Gibraltar	292	https://restcountries.eu/data/gib.svg	\N
201	4	19	82	Greece	GR	GRC	Athens	10858018	39.0	22.0	131990.0	34.3	Ελλάδα	300	https://restcountries.eu/data/grc.svg	GRE
202	4	19	103	Italy	IT	ITA	Rome	60665551	42.83333333	12.83333333	301336.0	36.0	Italia	380	https://restcountries.eu/data/ita.svg	ITA
203	4	19	122	Macedonia (the former Yugoslav Republic of)	MK	MKD	Skopje	2058539	41.83333333	22.0	25713.0	43.2	Македонија	807	https://restcountries.eu/data/mkd.svg	MKD
204	4	19	128	Malta	MT	MLT	Valletta	425384	35.83333333	14.58333333	316.0	\N	Malta	470	https://restcountries.eu/data/mlt.svg	MLT
205	4	19	138	Montenegro	ME	MNE	Podgorica	621810	42.5	19.3	13812.0	30.0	Црна Гора	499	https://restcountries.eu/data/mne.svg	MNE
207	4	19	180	San Marino	SM	SMR	City of San Marino	33005	43.76666666	12.41666666	61.0	\N	San Marino	674	https://restcountries.eu/data/smr.svg	SMR
208	4	19	185	Serbia	RS	SRB	Belgrade	7076372	44.0	21.0	88361.0	27.8	Србија	688	https://restcountries.eu/data/srb.svg	SRB
209	4	19	190	Slovenia	SI	SVN	Ljubljana	2064188	46.11666666	14.81666666	20273.0	31.2	Slovenija	705	https://restcountries.eu/data/svn.svg	SLO
210	4	19	197	Spain	ES	ESP	Madrid	46438422	40.0	-4.0	505992.0	34.7	España	724	https://restcountries.eu/data/esp.svg	ESP
211	4	19	\N	Holy See	VA	VAT	Rome	451	41.9	12.45	0.44	\N	Sancta Sedes	336	https://restcountries.eu/data/vat.svg	\N
212	4	22	15	Austria	AT	AUT	Vienna	8725931	47.33333333	13.33333333	83871.0	26.0	Österreich	040	https://restcountries.eu/data/aut.svg	AUT
213	4	22	22	Belgium	BE	BEL	Brussels	11319511	50.83333333	4.0	30528.0	33.0	België	056	https://restcountries.eu/data/bel.svg	BEL
214	4	22	60	Netherlands	NL	NLD	Amsterdam	17019800	52.5	5.75	41850.0	30.9	Nederland	528	https://restcountries.eu/data/nld.svg	NED
215	4	22	74	France	FR	FRA	Paris	66710000	46.0	2.0	640679.0	32.7	France	250	https://restcountries.eu/data/fra.svg	FRA
216	4	22	79	Germany	DE	DEU	Berlin	81770900	51.0	9.0	357114.0	28.3	Deutschland	276	https://restcountries.eu/data/deu.svg	GER
217	4	22	119	Liechtenstein	LI	LIE	Vaduz	37623	47.26666666	9.53333333	160.0	\N	Liechtenstein	438	https://restcountries.eu/data/lie.svg	LIE
218	4	22	121	Luxembourg	LU	LUX	Luxembourg	576200	49.75	6.16666666	2586.0	30.8	Luxembourg	442	https://restcountries.eu/data/lux.svg	LUX
219	4	22	136	Monaco	MC	MCO	Monaco	38400	43.73333333	7.4	2.02	\N	Monaco	492	https://restcountries.eu/data/mco.svg	MON
220	4	22	203	Switzerland	CH	CHE	Bern	8341600	47.0	8.0	41284.0	33.7	Schweiz	756	https://restcountries.eu/data/che.svg	SUI
221	5	1	14	Australia	AU	AUS	Canberra	24117360	-27.0	133.0	7692024.0	30.5	Australia	036	https://restcountries.eu/data/aus.svg	AUS
222	5	1	46	Christmas Island	CX	CXR	Flying Fish Cove	2072	-10.5	105.66666666	135.0	\N	Christmas Island	162	https://restcountries.eu/data/cxr.svg	\N
223	5	1	47	Cocos (Keeling) Islands	CC	CCK	West Island	550	-12.5	96.83333333	14.0	\N	Cocos (Keeling) Islands	166	https://restcountries.eu/data/cck.svg	\N
224	5	1	148	New Zealand	NZ	NZL	Wellington	4697854	-41.0	174.0	270467.0	36.2	New Zealand	554	https://restcountries.eu/data/nzl.svg	NZL
225	5	1	154	Norfolk Island	NF	NFK	Kingston	2302	-29.03333333	167.95	36.0	\N	Norfolk Island	574	https://restcountries.eu/data/nfk.svg	\N
226	5	8	71	Fiji	FJ	FJI	Suva	867000	-18.0	175.0	18272.0	42.8	Fiji	242	https://restcountries.eu/data/fji.svg	FIJ
227	5	8	147	New Caledonia	NC	NCL	Nouméa	268767	-21.5	165.5	18575.0	\N	Nouvelle-Calédonie	540	https://restcountries.eu/data/ncl.svg	\N
228	5	8	153	Vanuatu	VU	VUT	Port Vila	277500	-16.0	167.0	12189.0	\N	Vanuatu	548	https://restcountries.eu/data/vut.svg	VAN
229	5	8	162	Papua New Guinea	PG	PNG	Port Moresby	8083700	-6.0	147.0	462840.0	50.9	Papua Niugini	598	https://restcountries.eu/data/png.svg	PNG
230	5	8	191	Solomon Islands	SB	SLB	Honiara	642000	-8.0	159.0	28896.0	\N	Solomon Islands	090	https://restcountries.eu/data/slb.svg	SOL
231	5	9	5	Northern Mariana Islands	MP	MNP	Saipan	56940	15.2	145.75	464.0	\N	Northern Mariana Islands	580	https://restcountries.eu/data/mnp.svg	\N
232	5	9	86	Guam	GU	GUM	Hagåtña	184200	13.46666666	144.78333333	549.0	\N	Guam	316	https://restcountries.eu/data/gum.svg	GUM
233	5	9	96	Kiribati	KI	KIR	South Tarawa	113400	1.41666666	173.0	811.0	\N	Kiribati	296	https://restcountries.eu/data/kir.svg	KIR
234	5	9	130	Marshall Islands	MH	MHL	Majuro	54880	9.0	168.0	181.0	\N	M̧ajeļ	584	https://restcountries.eu/data/mhl.svg	MHL
235	5	9	134	Micronesia (Federated States of)	FM	FSM	Palikir	102800	6.91666666	158.25	702.0	\N	Micronesia	583	https://restcountries.eu/data/fsm.svg	FSM
236	5	9	145	Nauru	NR	NRU	Yaren	10084	-0.53333333	166.91666666	21.0	\N	Nauru	520	https://restcountries.eu/data/nru.svg	NRU
237	5	9	159	Palau	PW	PLW	Ngerulmud	17950	7.5	134.5	459.0	\N	Palau	585	https://restcountries.eu/data/plw.svg	PLW
238	5	14	6	American Samoa	AS	ASM	Pago Pago	57100	-14.33333333	-170.0	199.0	\N	American Samoa	016	https://restcountries.eu/data/asm.svg	ASA
239	5	14	51	Cook Islands	CK	COK	Avarua	18100	-21.23333333	-159.76666666	236.0	\N	Cook Islands	184	https://restcountries.eu/data/cok.svg	COK
240	5	14	75	French Polynesia	PF	PYF	Papeetē	271800	-15.0	-140.0	4167.0	\N	Polynésie française	258	https://restcountries.eu/data/pyf.svg	\N
241	5	14	152	Niue	NU	NIU	Alofi	1470	-19.03333333	-169.86666666	260.0	\N	Niuē	570	https://restcountries.eu/data/niu.svg	\N
242	5	14	165	Pitcairn	PN	PCN	Adamstown	56	-25.06666666	-130.1	47.0	\N	Pitcairn Islands	612	https://restcountries.eu/data/pcn.svg	\N
243	5	14	181	Samoa	WS	WSM	Apia	194899	-13.58333333	-172.33333333	2842.0	\N	Samoa	882	https://restcountries.eu/data/wsm.svg	SAM
244	5	14	210	Tokelau	TK	TKL	Fakaofo	1411	-9.0	-172.0	12.0	\N	Tokelau	772	https://restcountries.eu/data/tkl.svg	\N
245	5	14	211	Tonga	TO	TON	Nuku'alofa	103252	-20.0	-175.0	747.0	\N	Tonga	776	https://restcountries.eu/data/ton.svg	TGA
246	5	14	217	Tuvalu	TV	TUV	Funafuti	10640	-8.0	178.0	26.0	\N	Tuvalu	798	https://restcountries.eu/data/tuv.svg	TUV
247	5	14	225	Wallis and Futuna	WF	WLF	Mata-Utu	11750	-13.3	-176.2	142.0	\N	Wallis et Futuna	876	https://restcountries.eu/data/wlf.svg	\N
248	6	\N	\N	Antarctica	AQ	ATA	\N	1000	-74.65	4.48	14000000	\N	Antarctica	010	https://restcountries.eu/data/ata.svg	\N
249	\N	\N	92	Heard Island and McDonald Islands	HM	HMD	\N	0	-53.1	72.51666666	412.0	\N	Heard Island and McDonald Islands	334	https://restcountries.eu/data/hmd.svg	\N
250	\N	\N	\N	Bouvet Island	BV	BVT	\N	0	-54.43333333	3.4	49.0	\N	Bouvetøya	074	https://restcountries.eu/data/bvt.svg	\N
\.


--
-- TOC entry 5422 (class 0 OID 17235)
-- Dependencies: 274
-- Data for Name: countryborder; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.countryborder (countryborder_id, countryborder_country_id, countryborder_country_broder) FROM stdin;
1	1	14
2	1	17
3	1	26
4	3	4
5	3	5
6	3	16
7	4	3
8	4	5
9	4	36
10	5	3
11	5	4
12	5	9
13	5	16
14	5	30
15	5	36
16	9	5
17	9	16
18	9	17
19	9	18
20	9	30
21	11	13
22	11	17
23	11	19
24	13	11
25	13	17
26	13	19
27	13	20
28	13	42
29	13	43
30	14	1
31	14	17
32	14	18
33	14	26
34	16	3
35	16	5
36	16	9
37	17	1
38	17	9
39	17	11
40	17	13
41	17	14
42	17	18
43	17	19
44	17	26
45	18	9
46	18	14
47	18	17
48	18	26
49	18	30
50	19	11
51	19	13
52	19	17
53	19	20
54	19	21
55	19	26
56	19	40
57	19	41
58	20	13
59	20	19
60	20	40
61	20	42
62	21	19
63	21	25
64	21	26
65	21	41
66	22	23
67	22	24
68	22	25
69	22	27
70	22	28
71	22	55
72	23	22
73	23	24
74	23	25
75	23	26
76	23	30
77	23	36
78	24	22
79	24	23
80	24	30
81	24	33
82	24	55
83	24	56
84	25	21
85	25	22
86	25	23
87	25	26
88	25	28
89	26	1
90	26	14
91	26	17
92	26	18
93	26	19
94	26	21
95	26	23
96	26	25
97	26	30
98	27	22
99	27	28
100	28	22
101	28	25
102	28	27
103	30	5
104	30	9
105	30	18
106	30	23
107	30	26
108	30	36
109	31	33
110	31	34
111	31	35
112	31	37
113	31	53
114	31	54
115	31	56
116	32	33
117	32	36
118	32	157
119	33	24
120	33	31
121	33	32
122	33	36
123	33	37
124	33	56
125	34	31
126	34	35
127	34	210
128	35	31
129	35	34
130	35	54
131	36	4
132	36	5
133	36	23
134	36	24
135	36	30
136	36	32
137	36	33
138	37	31
139	37	33
140	39	42
141	40	19
142	40	20
143	40	41
144	40	42
145	41	19
146	41	21
147	41	40
148	41	42
149	42	13
150	42	20
151	42	39
152	42	40
153	42	41
154	42	43
155	43	13
156	43	42
157	44	45
158	44	55
159	44	56
160	44	60
161	45	44
162	45	48
163	45	51
164	45	53
165	45	56
166	45	60
167	47	58
168	48	45
169	48	51
170	48	60
171	49	50
172	49	58
173	50	49
174	50	51
175	50	52
176	50	53
177	50	58
178	50	59
179	51	45
180	51	48
181	51	50
182	51	52
183	51	53
184	52	50
185	52	51
186	52	59
187	53	31
188	53	45
189	53	50
190	53	51
191	53	54
192	53	56
193	53	58
194	54	31
195	54	35
196	54	53
197	54	58
198	55	22
199	55	24
200	55	44
201	55	56
202	56	24
203	56	31
204	56	33
205	56	44
206	56	45
207	56	53
208	56	55
209	58	47
210	58	49
211	58	50
212	58	53
213	58	54
214	59	50
215	59	52
216	60	44
217	60	45
218	60	48
219	69	76
220	72	83
221	76	69
222	83	72
223	83	214
224	89	91
225	89	93
226	90	94
227	90	95
228	91	89
229	91	92
230	91	93
231	91	96
232	92	91
233	92	94
234	92	96
235	93	89
236	93	91
237	93	98
238	94	90
239	94	92
240	95	90
241	95	107
242	96	91
243	96	92
244	98	93
245	98	100
246	100	98
247	103	104
248	103	105
249	103	106
250	103	111
251	103	115
252	104	103
253	104	105
254	104	106
255	104	111
256	104	112
257	105	103
258	105	104
259	105	107
260	105	110
261	105	111
262	105	112
263	105	114
264	105	115
265	105	116
266	105	117
267	106	103
268	106	104
269	106	112
270	107	95
271	107	105
272	107	108
273	107	112
274	107	116
275	108	107
276	108	112
277	110	105
278	110	114
279	110	116
280	111	103
281	111	104
282	111	105
283	112	104
284	112	105
285	112	106
286	112	107
287	112	108
288	114	105
289	114	110
290	114	117
291	114	215
292	115	103
293	115	105
294	116	105
295	116	107
296	116	110
297	117	105
298	117	114
299	118	119
300	118	121
301	118	122
302	118	123
303	118	176
304	119	118
305	119	120
306	119	122
307	119	123
308	120	119
309	120	122
310	120	123
311	120	142
312	121	118
313	121	122
314	121	142
315	121	146
316	122	118
317	122	119
318	122	120
319	122	121
320	122	142
321	123	118
322	123	119
323	123	120
324	123	124
325	123	125
326	123	127
327	123	128
328	123	132
329	123	137
330	123	141
331	123	142
332	123	144
333	123	145
334	123	149
335	123	176
336	124	123
337	125	123
338	127	123
339	127	176
340	128	123
341	128	129
342	128	176
343	129	128
344	131	138
345	132	123
346	132	137
347	132	140
348	132	143
349	132	145
350	133	137
351	133	140
352	133	141
353	134	136
354	136	134
355	136	138
356	136	229
357	137	123
358	137	132
359	137	133
360	137	140
361	137	141
362	138	131
363	138	136
364	138	140
365	140	132
366	140	133
367	140	137
368	140	138
369	141	123
370	141	133
371	141	137
372	142	120
373	142	121
374	142	122
375	142	123
376	142	146
377	142	149
378	143	132
379	143	145
380	144	123
381	144	145
382	145	123
383	145	132
384	145	142
385	145	143
386	145	144
387	145	148
388	145	149
389	145	150
390	146	121
391	146	142
392	146	149
393	146	151
394	146	152
395	146	156
396	146	166
397	148	123
398	148	145
399	149	123
400	149	142
401	149	145
402	149	146
403	150	145
404	151	146
405	151	152
406	151	155
407	151	166
408	152	146
409	152	151
410	152	155
411	152	166
412	152	176
413	154	161
414	154	164
415	155	151
416	155	152
417	155	166
418	155	176
419	156	146
420	156	158
421	156	159
422	156	164
423	156	165
424	156	166
425	157	32
426	157	158
427	157	160
428	157	165
429	158	156
430	158	157
431	158	164
432	158	165
433	159	146
434	159	164
435	160	157
436	160	165
437	161	154
438	161	164
439	161	167
440	162	32
441	162	157
442	162	158
443	163	164
444	164	154
445	164	156
446	164	158
447	164	159
448	164	161
449	164	163
450	164	167
451	165	156
452	165	157
453	165	158
454	165	160
455	165	166
456	166	146
457	166	151
458	166	152
459	166	155
460	166	156
461	166	165
462	166	169
463	166	201
464	167	161
465	167	164
466	168	174
467	168	176
468	168	178
469	168	189
470	168	190
471	169	166
472	169	175
473	169	201
474	169	203
475	169	208
476	170	174
477	170	177
478	170	212
479	170	216
480	171	175
481	171	177
482	171	178
483	171	198
484	171	208
485	171	209
486	171	212
487	172	195
488	172	203
489	172	205
490	172	208
491	173	175
492	173	178
493	174	168
494	174	170
495	174	176
496	174	177
497	174	178
498	174	190
499	174	216
500	175	169
501	175	171
502	175	173
503	175	178
504	175	208
505	176	118
506	176	123
507	176	127
508	176	128
509	176	152
510	176	155
511	176	168
512	176	174
513	176	178
514	176	184
515	176	186
516	176	189
517	176	190
518	176	192
519	177	170
520	177	171
521	177	174
522	177	178
523	177	212
524	178	168
525	178	171
526	178	173
527	178	174
528	178	175
529	178	176
530	178	177
531	180	188
532	183	216
533	184	176
534	184	189
535	186	176
536	186	192
537	186	194
538	188	180
539	189	168
540	189	176
541	189	184
542	189	190
543	190	168
544	190	174
545	190	176
546	190	189
547	192	176
548	192	186
549	192	194
550	194	186
551	194	192
552	195	172
553	195	201
554	195	203
555	195	205
556	196	210
557	196	215
558	197	198
559	197	205
560	197	208
561	198	171
562	198	197
563	198	205
564	198	208
565	198	209
566	199	180
567	200	210
568	201	166
569	201	169
570	201	195
571	201	203
572	202	207
573	202	209
574	202	211
575	202	212
576	202	215
577	202	220
578	203	169
579	203	172
580	203	195
581	203	201
582	203	208
583	205	172
584	205	195
585	205	197
586	205	198
587	205	208
588	206	210
589	207	202
590	208	169
591	208	171
592	208	172
593	208	175
594	208	197
595	208	198
596	208	203
597	208	205
598	209	171
599	209	198
600	209	202
601	209	212
602	210	34
603	210	196
604	210	200
605	210	206
606	210	215
607	211	202
608	212	170
609	212	171
610	212	177
611	212	202
612	212	209
613	212	216
614	212	217
615	212	220
616	213	214
617	213	215
618	213	216
619	213	218
620	214	213
621	214	216
622	215	196
623	215	202
624	215	210
625	215	213
626	215	216
627	215	218
628	215	219
629	215	220
630	216	170
631	216	174
632	216	183
633	216	212
634	216	213
635	216	214
636	216	215
637	216	218
638	216	220
639	217	212
640	217	220
641	218	213
642	218	215
643	218	216
644	219	215
645	220	202
646	220	212
647	220	215
648	220	216
649	220	217
650	229	136
\.


--
-- TOC entry 5423 (class 0 OID 17238)
-- Dependencies: 275
-- Data for Name: countrycallcode; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.countrycallcode (countrycallcode_id, countrycallcode_country_id, countrycallcode_callcode) FROM stdin;
1	1	257
2	2	269
3	3	253
4	4	291
5	5	251
6	6	262
7	7	262
8	8	246
9	9	254
10	10	261
11	11	265
12	12	230
13	13	258
14	14	250
15	15	248
16	16	252
17	17	255
18	18	256
19	19	260
20	20	263
21	21	244
22	22	237
23	23	236
24	24	235
25	25	242
26	26	243
27	27	240
28	28	241
29	29	239
30	30	211
31	31	213
32	32	20
33	33	218
34	34	212
35	35	212
36	36	249
37	37	216
38	39	266
39	40	267
40	41	264
41	42	27
42	43	268
43	44	229
44	45	226
45	46	238
46	47	220
47	48	233
48	49	245
49	50	224
50	51	225
51	52	231
52	53	223
53	54	222
54	55	234
55	56	227
56	57	290
57	58	221
58	59	232
59	60	228
60	61	1264
61	62	1268
62	63	297
63	64	1242
64	65	1246
65	66	1345
66	67	53
67	68	1767
68	69	1829
69	69	1849
70	69	1809
71	70	5997
72	71	599
73	72	1721
74	73	596
75	74	1473
76	75	590
77	76	509
78	77	1876
79	78	1869
80	79	1664
81	80	1787
82	80	1939
83	81	590
84	82	1758
85	83	590
86	84	1784
87	85	1868
88	86	1649
89	87	1284
90	88	1340
91	89	501
92	90	506
93	91	502
94	92	504
95	93	52
96	94	505
97	95	507
98	96	503
99	98	1
100	99	1441
101	100	1
102	101	508
103	102	299
104	103	54
105	104	591
106	105	55
107	106	56
108	107	57
109	108	593
110	109	500
111	110	592
112	111	595
113	112	51
114	113	500
115	114	597
116	115	598
117	116	58
118	117	594
119	118	76
120	118	77
121	119	996
122	120	992
123	121	993
124	122	998
125	123	86
126	124	852
127	125	853
128	126	81
129	127	976
130	128	850
131	129	82
132	130	886
133	131	673
134	132	95
135	133	855
136	134	670
137	135	63
138	136	62
139	137	856
140	138	60
141	139	65
142	140	66
143	141	84
144	142	93
145	143	880
146	144	975
147	145	91
148	146	98
149	147	960
150	148	977
151	149	92
152	150	94
153	151	374
154	152	994
155	153	973
156	154	971
157	155	995
158	156	964
159	157	972
160	158	962
161	159	965
162	160	961
163	161	968
164	162	970
165	163	974
166	164	966
167	165	963
168	166	90
169	167	967
170	168	375
171	169	359
172	170	420
173	171	36
174	172	383
175	173	373
176	174	48
177	175	40
178	176	7
179	177	421
180	178	380
181	179	358
182	180	44
183	181	44
184	182	44
185	183	45
186	184	372
187	185	298
188	186	358
189	187	354
190	188	353
191	189	371
192	190	370
193	191	44
194	192	47
195	193	4779
196	194	46
197	195	355
198	196	376
199	197	387
200	198	385
201	199	357
202	200	350
203	201	30
204	202	39
205	203	389
206	204	356
207	205	382
208	206	351
209	207	378
210	208	381
211	209	386
212	210	34
213	211	379
214	212	43
215	213	32
216	214	31
217	215	33
218	216	49
219	217	423
220	218	352
221	219	377
222	220	41
223	221	61
224	222	61
225	223	61
226	224	64
227	225	672
228	226	679
229	227	687
230	228	678
231	229	675
232	230	677
233	231	1670
234	232	1671
235	233	686
236	234	692
237	235	691
238	236	674
239	237	680
240	238	1684
241	239	682
242	240	689
243	241	683
244	242	64
245	243	685
246	244	690
247	245	676
248	246	688
249	247	681
250	248	672
\.


--
-- TOC entry 5424 (class 0 OID 17241)
-- Dependencies: 276
-- Data for Name: countrycurrency; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.countrycurrency (countrycurrency_id, countrycurrency_country_id, countrycurrency_currency_id) FROM stdin;
1	1	16
2	2	77
3	3	39
4	4	44
5	5	45
6	6	46
7	7	46
8	8	157
9	9	74
10	10	91
11	11	99
12	12	97
13	13	102
14	14	129
15	15	132
16	16	138
17	17	153
18	18	155
19	19	172
20	20	23
21	20	32
22	20	46
23	20	49
24	20	66
25	20	73
26	20	157
27	20	171
28	21	6
29	22	165
30	23	165
31	24	165
32	25	165
33	26	28
34	27	165
35	28	165
36	29	141
37	30	140
38	31	42
39	32	43
40	33	88
41	34	89
42	35	42
43	35	89
44	36	133
45	37	147
46	38	46
47	39	87
48	39	170
49	40	23
50	41	103
51	41	170
52	42	170
53	43	143
54	44	167
55	45	167
56	46	37
57	47	53
58	48	51
59	49	167
60	50	54
61	51	167
62	52	86
63	53	167
64	54	96
65	55	104
66	56	167
67	57	136
68	58	167
69	59	137
70	60	167
71	61	166
72	62	166
73	63	9
74	64	21
75	65	12
76	66	81
77	67	35
78	67	36
79	68	166
80	69	41
81	70	157
82	71	5
83	72	5
84	73	46
85	74	166
86	75	46
87	76	60
88	77	71
89	78	166
90	79	166
91	80	157
92	81	46
93	82	166
94	83	46
95	84	166
96	85	150
97	86	157
98	87	157
99	88	157
100	89	26
101	90	34
102	91	55
103	92	58
104	93	100
105	94	105
106	95	118
107	95	157
108	96	157
109	97	158
110	98	157
111	99	17
112	100	27
113	101	46
114	102	40
115	103	7
116	104	19
117	105	20
118	106	31
119	107	33
120	108	157
121	109	48
122	110	56
123	111	124
124	112	119
125	113	49
126	114	139
127	115	159
128	116	161
129	117	46
130	119	75
131	120	145
132	121	146
133	123	32
134	124	57
135	125	95
136	126	73
137	127	94
138	128	78
139	129	79
140	130	152
141	131	18
142	131	135
143	132	93
144	133	76
145	133	157
146	134	157
147	135	121
148	136	62
149	137	83
150	138	101
151	139	18
152	139	135
153	140	144
154	141	162
155	142	2
156	143	13
157	144	22
158	144	66
159	145	66
160	146	68
161	147	98
162	148	115
163	149	122
164	150	85
165	153	15
166	154	1
167	155	50
168	156	67
169	157	63
170	158	72
171	159	80
172	160	84
173	161	117
174	162	64
175	163	125
176	164	130
177	165	142
178	167	169
179	168	24
180	168	25
181	169	14
182	170	38
183	171	61
184	172	46
185	173	90
186	174	123
187	175	126
188	176	128
189	177	46
190	178	154
191	179	46
192	180	49
193	181	49
194	181	109
195	182	49
196	182	70
197	183	40
198	184	46
199	185	40
200	185	108
201	186	46
202	187	69
203	188	46
204	189	46
205	190	46
206	191	49
207	191	65
208	192	106
209	193	106
210	194	134
211	195	3
212	196	46
213	198	59
214	199	46
215	200	52
216	201	46
217	202	46
218	203	92
219	204	46
220	205	46
221	206	46
222	207	46
223	208	127
224	209	46
225	210	46
226	211	46
227	212	46
228	213	46
229	214	46
230	215	46
231	216	46
232	217	29
233	218	46
234	219	46
235	220	29
236	221	8
237	222	8
238	223	8
239	224	116
240	225	8
241	226	47
242	227	168
243	228	163
244	229	120
245	230	131
246	231	157
247	232	157
248	233	8
249	233	110
250	234	157
251	235	157
252	236	8
253	237	107
254	237	157
255	238	156
256	239	30
257	239	116
258	240	168
259	241	111
260	241	116
261	242	116
262	243	164
263	244	116
264	245	148
265	246	8
266	246	151
267	247	168
268	248	8
269	248	49
270	249	8
271	250	106
\.


--
-- TOC entry 5425 (class 0 OID 17244)
-- Dependencies: 277
-- Data for Name: countrylanguage; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.countrylanguage (countrylanguage_id, countrylanguage_country_id, countrylanguage_language_id) FROM stdin;
1	1	27
2	1	78
3	2	3
4	2	27
5	3	3
6	3	27
7	4	3
8	4	19
9	4	98
10	5	2
11	6	27
12	7	27
13	8	19
14	9	19
15	9	94
16	10	27
17	10	56
18	11	19
19	11	72
20	12	19
21	13	76
22	14	19
23	14	27
24	14	81
25	15	19
26	15	27
27	16	3
28	16	88
29	17	19
30	17	94
31	18	19
32	18	94
33	19	19
34	20	19
35	20	66
36	20	87
37	21	76
38	22	19
39	22	27
40	23	27
41	23	82
42	24	3
43	24	27
44	25	27
45	25	51
46	26	27
47	26	42
48	26	51
49	26	54
50	26	94
51	27	20
52	27	27
53	28	27
54	29	76
55	30	19
56	31	3
57	32	3
58	33	3
59	34	3
60	35	20
61	36	3
62	36	19
63	37	3
64	38	27
65	39	19
66	39	92
67	40	19
68	40	100
69	41	1
70	41	19
71	42	1
72	42	19
73	42	71
74	42	91
75	42	92
76	42	100
77	42	103
78	42	107
79	42	109
80	42	111
81	43	19
82	43	91
83	44	27
84	45	23
85	45	27
86	46	76
87	47	19
88	48	19
89	49	76
90	50	23
91	50	27
92	51	27
93	52	19
94	53	27
95	54	3
96	55	19
97	56	27
98	57	19
99	58	27
100	59	19
101	60	27
102	61	19
103	62	19
104	63	68
105	63	73
106	64	19
107	65	19
108	66	19
109	67	20
110	68	19
111	69	20
112	70	68
113	71	19
114	71	68
115	71	73
116	72	19
117	72	68
118	73	27
119	74	19
120	75	27
121	76	27
122	76	34
123	77	19
124	78	19
125	79	19
126	80	19
127	80	20
128	81	27
129	82	19
130	83	19
131	83	27
132	83	68
133	84	19
134	85	19
135	86	19
136	87	19
137	88	19
138	89	19
139	89	20
140	90	20
141	91	20
142	92	20
143	93	20
144	94	20
145	95	20
146	96	20
147	97	19
148	98	19
149	99	19
150	100	19
151	100	27
152	101	27
153	102	44
154	103	20
155	103	29
156	104	4
157	104	20
158	104	77
159	105	76
160	106	20
161	107	20
162	108	20
163	109	19
164	110	19
165	111	20
166	111	29
167	112	20
168	113	19
169	114	68
170	115	20
171	116	20
172	117	27
173	118	43
174	118	80
175	119	48
176	119	80
177	120	80
178	120	96
179	121	80
180	121	99
181	122	80
182	122	106
183	123	110
184	124	19
185	124	110
186	125	76
187	125	110
188	126	40
189	127	60
190	128	46
191	129	46
192	130	110
193	131	61
194	132	63
195	133	45
196	134	76
197	135	19
198	136	37
199	137	52
200	138	112
201	139	19
202	139	61
203	139	95
204	139	110
205	140	97
206	141	108
207	142	75
208	142	99
209	142	106
210	143	9
211	144	17
212	145	19
213	145	32
214	146	22
215	147	16
216	148	67
217	149	19
218	149	105
219	150	83
220	150	95
221	151	36
222	151	80
223	152	5
224	153	3
225	154	3
226	155	41
227	156	3
228	156	47
229	157	3
230	157	31
231	158	3
232	159	3
233	160	3
234	160	27
235	161	3
236	162	3
237	163	3
238	164	3
239	165	3
240	166	102
241	167	3
242	168	6
243	168	80
244	169	7
245	170	13
246	170	84
247	171	35
248	172	89
249	172	90
250	173	79
251	174	74
252	175	79
253	176	80
254	177	84
255	178	104
256	179	93
257	180	19
258	181	19
259	181	27
260	182	19
261	182	27
262	183	14
263	184	21
264	185	26
265	186	24
266	186	93
267	187	38
268	188	19
269	188	28
270	189	55
271	190	53
272	191	19
273	191	30
274	192	65
275	192	69
276	192	70
277	193	70
278	194	93
279	195	89
280	196	11
281	197	10
282	197	33
283	197	90
284	198	33
285	199	18
286	199	36
287	199	102
288	200	19
289	201	18
290	202	39
291	203	59
292	204	19
293	204	62
294	205	10
295	205	33
296	205	89
297	205	90
298	206	76
299	207	39
300	208	90
301	209	85
302	210	20
303	211	15
304	211	27
305	211	39
306	211	49
307	212	15
308	213	15
309	213	27
310	213	68
311	214	68
312	215	27
313	216	15
314	217	15
315	218	15
316	218	27
317	218	50
318	219	27
319	220	15
320	220	27
321	220	39
322	221	19
323	222	19
324	223	19
325	224	19
326	224	58
327	225	19
328	226	19
329	226	25
330	226	32
331	226	105
332	227	27
333	228	8
334	228	19
335	228	27
336	229	19
337	230	19
338	231	12
339	231	19
340	232	12
341	232	19
342	232	20
343	233	19
344	234	19
345	234	57
346	235	19
347	236	19
348	236	64
349	237	19
350	238	19
351	238	86
352	239	19
353	240	27
354	241	19
355	242	19
356	243	19
357	243	86
358	244	19
359	245	19
360	245	101
361	246	19
362	247	27
363	248	19
364	248	80
365	249	19
366	250	65
367	250	69
368	250	70
\.


--
-- TOC entry 5426 (class 0 OID 17247)
-- Dependencies: 278
-- Data for Name: countryregionalbloc; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.countryregionalbloc (countryregionalbloc_id, countryregionalbloc_country_id, countryregionalbloc_regionalbloc_id) FROM stdin;
1	1	4
2	2	4
3	2	6
4	3	4
5	3	6
6	4	4
7	5	4
8	6	4
9	7	4
10	8	4
11	9	4
12	10	4
13	11	4
14	12	4
15	13	4
16	14	4
17	15	4
18	16	4
19	16	6
20	17	4
21	18	4
22	19	4
23	20	4
24	21	4
25	22	4
26	23	4
27	24	4
28	25	4
29	26	4
30	27	4
31	28	4
32	29	4
33	30	4
34	31	4
35	31	6
36	32	4
37	32	6
38	33	4
39	33	6
40	34	4
41	34	6
42	35	4
43	36	4
44	36	6
45	37	4
46	37	6
47	38	4
48	39	4
49	40	4
50	41	4
51	42	4
52	43	4
53	44	4
54	45	4
55	46	4
56	47	4
57	48	4
58	49	4
59	50	4
60	51	4
61	52	4
62	53	4
63	54	4
64	54	6
65	55	4
66	56	4
67	57	4
68	58	4
69	59	4
70	60	4
71	62	1
72	64	1
73	65	1
74	69	1
75	69	9
76	74	1
77	76	1
78	77	1
79	78	1
80	79	1
81	82	1
82	84	1
83	85	1
84	89	1
85	89	9
86	90	9
87	91	9
88	92	9
89	93	5
90	93	11
91	94	9
92	95	9
93	96	9
94	98	11
95	100	11
96	103	13
97	104	13
98	105	13
99	106	5
100	106	13
101	107	5
102	107	13
103	108	13
104	109	13
105	110	1
106	110	13
107	111	13
108	112	5
109	112	13
110	113	13
111	114	1
112	114	13
113	115	13
114	116	13
115	117	8
116	117	13
117	118	3
118	119	3
119	131	7
120	132	7
121	133	7
122	135	7
123	136	7
124	137	7
125	138	7
126	139	7
127	140	7
128	141	7
129	142	10
130	143	10
131	144	10
132	145	10
133	147	10
134	148	10
135	149	10
136	150	10
137	151	3
138	153	6
139	154	6
140	156	6
141	158	6
142	159	6
143	160	6
144	161	6
145	162	6
146	163	6
147	164	6
148	165	6
149	167	6
150	168	3
151	169	8
152	170	8
153	171	8
154	172	2
155	173	2
156	174	8
157	175	8
158	176	3
159	177	8
160	179	8
161	180	8
162	183	8
163	184	8
164	185	8
165	186	8
166	187	12
167	188	8
168	189	8
169	190	8
170	191	8
171	192	12
172	194	8
173	195	2
174	197	2
175	198	8
176	199	8
177	200	8
178	201	8
179	202	8
180	203	2
181	204	8
182	205	2
183	206	8
184	208	2
185	209	8
186	210	8
187	212	8
188	213	8
189	214	8
190	215	8
191	216	8
192	217	12
193	218	8
194	220	12
\.


--
-- TOC entry 5427 (class 0 OID 17250)
-- Dependencies: 279
-- Data for Name: countrytimezone; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.countrytimezone (countrytimezone_id, countrytimezone_country_id, countrytimezone_timezone_id) FROM stdin;
1	1	32
2	2	2
3	3	2
4	4	2
5	5	2
6	6	2
7	7	12
8	8	33
9	9	2
10	10	2
11	11	32
12	12	12
13	13	32
14	14	32
15	15	12
16	16	2
17	17	2
18	18	2
19	19	32
20	20	32
21	21	10
22	22	10
23	23	10
24	24	10
25	25	10
26	26	10
27	26	32
28	27	10
29	28	10
30	29	7
31	30	2
32	31	10
33	32	32
34	33	10
35	34	7
36	35	13
37	36	2
38	37	10
39	38	35
40	39	32
41	40	32
42	41	10
43	42	32
44	43	32
45	44	10
46	45	7
47	46	39
48	47	13
49	48	7
50	49	7
51	50	7
52	51	7
53	52	7
54	53	7
55	54	7
56	55	10
57	56	10
58	57	13
59	58	7
60	59	7
61	60	7
62	61	27
63	62	27
64	63	27
65	64	31
66	65	27
67	66	31
68	67	31
69	68	27
70	69	27
71	70	27
72	71	27
73	72	27
74	73	27
75	74	27
76	75	27
77	76	31
78	77	31
79	78	27
80	79	27
81	80	27
82	81	27
83	82	27
84	83	27
85	84	27
86	85	27
87	86	27
88	87	27
89	88	27
90	89	38
91	90	38
92	91	38
93	92	38
94	93	6
95	93	23
96	93	38
97	94	38
98	95	31
99	96	38
100	97	11
101	97	14
102	97	29
103	98	6
104	98	11
105	98	14
106	98	19
107	98	23
108	98	27
109	98	29
110	98	30
111	98	31
112	98	38
113	98	41
114	99	27
115	100	6
116	100	17
117	100	23
118	100	27
119	100	31
120	100	38
121	101	3
122	102	3
123	102	13
124	102	27
125	102	39
126	103	3
127	104	27
128	105	3
129	105	22
130	105	27
131	105	31
132	106	27
133	106	38
134	107	31
135	108	31
136	108	38
137	109	27
138	110	27
139	111	27
140	112	31
141	113	22
142	114	3
143	115	3
144	116	27
145	117	3
146	118	33
147	118	35
148	119	33
149	120	35
150	121	35
151	122	35
152	123	20
153	124	20
154	125	20
155	126	8
156	127	20
157	127	21
158	128	8
159	129	8
160	130	20
161	131	20
162	132	9
163	133	21
164	134	8
165	135	20
166	136	8
167	136	20
168	136	21
169	137	21
170	138	20
171	139	20
172	140	21
173	141	21
174	142	26
175	143	33
176	144	33
177	145	5
178	146	34
179	147	35
180	148	1
181	149	35
182	150	5
183	151	12
184	152	12
185	153	2
186	154	18
187	155	31
188	156	2
189	157	32
190	158	2
191	159	2
192	160	32
193	161	12
194	162	32
195	163	2
196	164	2
197	165	32
198	166	2
199	167	2
200	168	2
201	169	32
202	170	10
203	171	10
204	172	10
205	173	32
206	174	10
207	175	32
208	176	2
209	176	8
210	176	12
211	176	14
212	176	19
213	176	20
214	176	21
215	176	33
216	176	37
217	177	10
218	178	32
219	179	32
220	180	3
221	180	6
222	180	7
223	180	10
224	180	22
225	180	27
226	180	31
227	180	32
228	180	33
229	181	13
230	182	10
231	183	3
232	183	7
233	183	10
234	183	27
235	183	39
236	184	32
237	185	13
238	186	32
239	187	7
240	188	7
241	189	32
242	190	32
243	191	13
244	192	10
245	193	10
246	194	10
247	195	10
248	196	10
249	197	10
250	198	10
251	199	32
252	200	10
253	201	32
254	202	10
255	203	10
256	204	10
257	205	10
258	206	7
259	206	39
260	207	10
261	208	10
262	209	10
263	210	7
264	210	10
265	211	10
266	212	10
267	213	10
268	214	10
269	214	27
270	215	2
271	215	3
272	215	6
273	215	10
274	215	11
275	215	12
276	215	14
277	215	24
278	215	27
279	215	35
280	215	37
281	215	41
282	216	10
283	217	10
284	218	10
285	219	10
286	220	10
287	221	4
288	221	9
289	221	16
290	221	19
291	221	20
292	221	21
293	221	25
294	221	35
295	222	21
296	223	9
297	224	11
298	224	14
299	224	15
300	224	29
301	224	40
302	225	4
303	226	14
304	227	37
305	228	37
306	229	19
307	230	37
308	231	19
309	232	19
310	233	14
311	233	28
312	233	40
313	234	14
314	235	19
315	235	36
316	236	14
317	237	8
318	238	29
319	239	11
320	240	11
321	240	24
322	240	41
323	241	29
324	242	6
325	243	40
326	244	40
327	245	40
328	246	14
329	247	14
330	248	2
331	248	3
332	248	14
333	248	19
334	248	20
335	248	21
336	248	33
337	248	35
338	249	35
339	250	10
\.


--
-- TOC entry 5428 (class 0 OID 17253)
-- Dependencies: 280
-- Data for Name: countrytopleveldomain; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.countrytopleveldomain (countrytopleveldomain_id, countrytopleveldomain_country_id, countrytopleveldomain_domain_id) FROM stdin;
1	1	211
2	2	124
3	3	11
4	4	81
5	5	106
6	6	234
7	7	108
8	8	186
9	9	22
10	10	6
11	11	99
12	12	112
13	13	170
14	14	232
15	15	175
16	16	183
17	17	203
18	18	48
19	19	207
20	20	237
21	21	87
22	22	78
23	23	236
24	24	205
25	25	233
26	26	133
27	27	33
28	28	154
29	29	98
30	30	144
31	31	20
32	32	90
33	33	125
34	34	49
35	35	172
36	36	231
37	37	199
38	38	32
39	39	156
40	40	63
41	41	202
42	42	136
43	43	122
44	44	198
45	45	223
46	46	42
47	47	215
48	48	2
49	49	243
50	50	36
51	51	39
52	52	174
53	53	70
54	54	167
55	55	225
56	56	189
57	57	153
58	58	163
59	59	130
60	60	30
61	61	72
62	62	66
63	63	181
64	64	135
65	65	192
66	66	190
67	67	159
68	68	74
69	69	18
70	70	16
71	70	188
72	71	171
73	72	212
74	73	68
75	74	139
76	75	19
77	76	96
78	77	114
79	78	239
80	79	117
81	80	245
82	81	118
83	82	111
84	83	19
85	83	51
86	83	56
87	84	91
88	85	59
89	86	102
90	87	69
91	88	197
92	89	244
93	90	217
94	91	248
95	92	110
96	93	116
97	94	82
98	95	46
99	96	141
100	97	54
101	98	54
102	99	229
103	100	60
104	101	219
105	102	86
106	103	113
107	104	228
108	105	155
109	106	222
110	107	94
111	108	184
112	109	187
113	110	31
114	111	5
115	112	43
116	113	143
117	114	100
118	115	53
119	116	242
120	117	165
121	118	8
122	118	213
123	119	76
124	120	35
125	121	27
126	122	1
127	123	218
128	124	227
129	125	119
130	126	157
131	127	93
132	128	151
133	129	61
134	130	214
135	131	75
136	132	200
137	133	142
138	134	77
139	135	241
140	136	50
141	137	129
142	138	95
143	139	147
144	140	235
145	141	164
146	142	71
147	143	62
148	144	150
149	145	148
150	146	247
151	147	137
152	148	47
153	149	246
154	150	120
155	151	195
156	152	107
157	153	161
158	154	101
159	155	109
160	156	206
161	157	149
162	158	28
163	159	12
164	160	179
165	161	220
166	162	128
167	163	65
168	164	34
169	165	201
170	166	40
171	167	185
172	168	240
173	169	132
174	170	23
175	171	9
176	173	52
177	174	180
178	175	29
179	176	80
180	177	64
181	178	21
182	179	38
183	180	182
184	181	158
185	182	37
186	183	115
187	184	173
188	185	209
189	186	10
190	187	15
191	188	58
192	189	25
193	190	145
194	191	216
195	192	57
196	193	121
197	194	193
198	195	176
199	196	230
200	197	169
201	198	146
202	199	134
203	200	168
204	201	208
205	202	89
206	203	160
207	204	177
208	205	79
209	206	3
210	207	194
211	208	105
212	209	226
213	210	83
214	211	88
215	212	162
216	213	140
217	214	16
218	215	51
219	216	7
220	217	84
221	218	210
222	219	103
223	220	26
224	221	249
225	222	92
226	223	204
227	224	127
228	225	196
229	226	13
230	227	41
231	228	138
232	229	238
233	230	55
234	231	67
235	232	73
236	233	191
237	234	221
238	235	85
239	236	166
240	237	45
241	238	44
242	239	123
243	240	131
244	241	24
245	242	178
246	243	17
247	244	14
248	245	104
249	246	126
250	247	152
251	248	97
252	249	4
253	249	97
254	250	224
\.


--
-- TOC entry 5429 (class 0 OID 17256)
-- Dependencies: 281
-- Data for Name: countrytranslation; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.countrytranslation (countrytranslation_id, countrytranslation_country_id, countrytranslation_language_id, countrytranslation_translation) FROM stdin;
1	1	15	Burundi
2	1	20	Burundi
3	1	22	بوروندی
4	1	27	Burundi
5	1	33	Burundi
6	1	39	Burundi
7	1	40	ブルンジ
8	1	68	Burundi
9	1	76	Burúndi
10	2	15	Union der Komoren
11	2	20	Comoras
12	2	22	کومور
13	2	27	Comores
14	2	33	Komori
15	2	39	Comore
16	2	40	コモロ
17	2	68	Comoren
18	2	76	Comores
19	3	15	Dschibuti
20	3	20	Yibuti
21	3	22	جیبوتی
22	3	27	Djibouti
23	3	33	Džibuti
24	3	39	Gibuti
25	3	40	ジブチ
26	3	68	Djibouti
27	3	76	Djibuti
28	4	15	Eritrea
29	4	20	Eritrea
30	4	22	اریتره
31	4	27	Érythrée
32	4	33	Eritreja
33	4	39	Eritrea
34	4	40	エリトリア
35	4	68	Eritrea
36	4	76	Eritreia
37	5	15	Äthiopien
38	5	20	Etiopía
39	5	22	اتیوپی
40	5	27	Éthiopie
41	5	33	Etiopija
42	5	39	Etiopia
43	5	40	エチオピア
44	5	68	Ethiopië
45	5	76	Etiópia
46	6	15	Mayotte
47	6	20	Mayotte
48	6	22	مایوت
49	6	27	Mayotte
50	6	33	Mayotte
51	6	39	Mayotte
52	6	40	マヨット
53	6	68	Mayotte
54	6	76	Mayotte
55	7	15	Réunion
56	7	20	Reunión
57	7	22	رئونیون
58	7	27	Réunion
59	7	33	Réunion
60	7	39	Riunione
61	7	40	レユニオン
62	7	68	Réunion
63	7	76	Reunião
64	8	15	Britisches Territorium im Indischen Ozean
65	8	20	Territorio Británico del Océano Índico
66	8	22	قلمرو بریتانیا در اقیانوس هند
67	8	27	Territoire britannique de l'océan Indien
68	8	33	Britanski Indijskooceanski teritorij
69	8	39	Territorio britannico dell'oceano indiano
70	8	40	イギリス領インド洋地域
71	8	68	Britse Gebieden in de Indische Oceaan
72	8	76	Território Britânico do Oceano Índico
73	9	15	Kenia
74	9	20	Kenia
75	9	22	کنیا
76	9	27	Kenya
77	9	33	Kenija
78	9	39	Kenya
79	9	40	ケニア
80	9	68	Kenia
81	9	76	Quénia
82	10	15	Madagaskar
83	10	20	Madagascar
84	10	22	ماداگاسکار
85	10	27	Madagascar
86	10	33	Madagaskar
87	10	39	Madagascar
88	10	40	マダガスカル
89	10	68	Madagaskar
90	10	76	Madagáscar
91	11	15	Malawi
92	11	20	Malawi
93	11	22	مالاوی
94	11	27	Malawi
95	11	33	Malavi
96	11	39	Malawi
97	11	40	マラウイ
98	11	68	Malawi
99	11	76	Malávi
100	12	15	Mauritius
101	12	20	Mauricio
102	12	22	موریس
103	12	27	Île Maurice
104	12	33	Mauricijus
105	12	39	Mauritius
106	12	40	モーリシャス
107	12	68	Mauritius
108	12	76	Maurícia
109	13	15	Mosambik
110	13	20	Mozambique
111	13	22	موزامبیک
112	13	27	Mozambique
113	13	33	Mozambik
114	13	39	Mozambico
115	13	40	モザンビーク
116	13	68	Mozambique
117	13	76	Moçambique
118	14	15	Ruanda
119	14	20	Ruanda
120	14	22	رواندا
121	14	27	Rwanda
122	14	33	Ruanda
123	14	39	Ruanda
124	14	40	ルワンダ
125	14	68	Rwanda
126	14	76	Ruanda
127	15	15	Seychellen
128	15	20	Seychelles
129	15	22	سیشل
130	15	27	Seychelles
131	15	33	Sejšeli
132	15	39	Seychelles
133	15	40	セーシェル
134	15	68	Seychellen
135	15	76	Seicheles
136	16	15	Somalia
137	16	20	Somalia
138	16	22	سومالی
139	16	27	Somalie
140	16	33	Somalija
141	16	39	Somalia
142	16	40	ソマリア
143	16	68	Somalië
144	16	76	Somália
145	17	15	Tansania
146	17	20	Tanzania
147	17	22	تانزانیا
148	17	27	Tanzanie
149	17	33	Tanzanija
150	17	39	Tanzania
151	17	40	タンザニア
152	17	68	Tanzania
153	17	76	Tanzânia
154	18	15	Uganda
155	18	20	Uganda
156	18	22	اوگاندا
157	18	27	Uganda
158	18	33	Uganda
159	18	39	Uganda
160	18	40	ウガンダ
161	18	68	Oeganda
162	18	76	Uganda
163	19	15	Sambia
164	19	20	Zambia
165	19	22	زامبیا
166	19	27	Zambie
167	19	33	Zambija
168	19	39	Zambia
169	19	40	ザンビア
170	19	68	Zambia
171	19	76	Zâmbia
172	20	15	Simbabwe
173	20	20	Zimbabue
174	20	22	زیمباوه
175	20	27	Zimbabwe
176	20	33	Zimbabve
177	20	39	Zimbabwe
178	20	40	ジンバブエ
179	20	68	Zimbabwe
180	20	76	Zimbabué
181	21	15	Angola
182	21	20	Angola
183	21	22	آنگولا
184	21	27	Angola
185	21	33	Angola
186	21	39	Angola
187	21	40	アンゴラ
188	21	68	Angola
189	21	76	Angola
190	22	15	Kamerun
191	22	20	Camerún
192	22	22	کامرون
193	22	27	Cameroun
194	22	33	Kamerun
195	22	39	Camerun
196	22	40	カメルーン
197	22	68	Kameroen
198	22	76	Camarões
199	23	15	Zentralafrikanische Republik
200	23	20	República Centroafricana
201	23	22	جمهوری آفریقای مرکزی
202	23	27	République centrafricaine
203	23	33	Srednjoafrička Republika
204	23	39	Repubblica Centrafricana
205	23	40	中央アフリカ共和国
206	23	68	Centraal-Afrikaanse Republiek
207	23	76	República Centro-Africana
208	24	15	Tschad
209	24	20	Chad
210	24	22	چاد
211	24	27	Tchad
212	24	33	Čad
213	24	39	Ciad
214	24	40	チャド
215	24	68	Tsjaad
216	24	76	Chade
217	25	15	Kongo
218	25	20	Congo
219	25	22	کنگو
220	25	27	Congo
221	25	33	Kongo
222	25	39	Congo
223	25	40	コンゴ共和国
224	25	68	Congo [Republiek]
225	25	76	Congo
226	26	15	Kongo (Dem. Rep.)
227	26	20	Congo (Rep. Dem.)
228	26	22	جمهوری کنگو
229	26	27	Congo (Rép. dém.)
230	26	33	Kongo, Demokratska Republika
231	26	39	Congo (Rep. Dem.)
232	26	40	コンゴ民主共和国
233	26	68	Congo [DRC]
234	26	76	RD Congo
235	27	15	Äquatorial-Guinea
236	27	20	Guinea Ecuatorial
237	27	22	گینه استوایی
238	27	27	Guinée-Équatoriale
239	27	33	Ekvatorijalna Gvineja
240	27	39	Guinea Equatoriale
241	27	40	赤道ギニア
242	27	68	Equatoriaal-Guinea
243	27	76	Guiné Equatorial
244	28	15	Gabun
245	28	20	Gabón
246	28	22	گابن
247	28	27	Gabon
248	28	33	Gabon
249	28	39	Gabon
250	28	40	ガボン
251	28	68	Gabon
252	28	76	Gabão
253	29	15	São Tomé und Príncipe
254	29	20	Santo Tomé y Príncipe
255	29	22	کواترو دو فرویرو
256	29	27	Sao Tomé-et-Principe
257	29	33	Sveti Toma i Princip
258	29	39	São Tomé e Príncipe
259	29	40	サントメ・プリンシペ
260	29	68	Sao Tomé en Principe
261	29	76	São Tomé e Príncipe
262	30	15	Südsudan
263	30	20	Sudán del Sur
264	30	22	سودان جنوبی
265	30	27	Soudan du Sud
266	30	33	Južni Sudan
267	30	39	Sudan del sud
268	30	40	南スーダン
269	30	68	Zuid-Soedan
270	30	76	Sudão do Sul
271	31	15	Algerien
272	31	20	Argelia
273	31	22	الجزایر
274	31	27	Algérie
275	31	33	Alžir
276	31	39	Algeria
277	31	40	アルジェリア
278	31	68	Algerije
279	31	76	Argélia
280	32	15	Ägypten
281	32	20	Egipto
282	32	22	مصر
283	32	27	Égypte
284	32	33	Egipat
285	32	39	Egitto
286	32	40	エジプト
287	32	68	Egypte
288	32	76	Egipto
289	33	15	Libyen
290	33	20	Libia
291	33	22	لیبی
292	33	27	Libye
293	33	33	Libija
294	33	39	Libia
295	33	40	リビア
296	33	68	Libië
297	33	76	Líbia
298	34	15	Marokko
299	34	20	Marruecos
300	34	22	مراکش
301	34	27	Maroc
302	34	33	Maroko
303	34	39	Marocco
304	34	40	モロッコ
305	34	68	Marokko
306	34	76	Marrocos
307	35	15	Westsahara
308	35	20	Sahara Occidental
309	35	22	جمهوری دموکراتیک عربی صحرا
310	35	27	Sahara Occidental
311	35	33	Zapadna Sahara
312	35	39	Sahara Occidentale
313	35	40	西サハラ
314	35	68	Westelijke Sahara
315	35	76	Saara Ocidental
316	36	15	Sudan
317	36	20	Sudán
318	36	22	سودان
319	36	27	Soudan
320	36	33	Sudan
321	36	39	Sudan
322	36	40	スーダン
323	36	68	Soedan
324	36	76	Sudão
325	37	15	Tunesien
326	37	20	Túnez
327	37	22	تونس
328	37	27	Tunisie
329	37	33	Tunis
330	37	39	Tunisia
331	37	40	チュニジア
332	37	68	Tunesië
333	37	76	Tunísia
334	38	15	Französische Süd- und Antarktisgebiete
335	38	20	Tierras Australes y Antárticas Francesas
336	38	22	سرزمین‌های جنوبی و جنوبگانی فرانسه
337	38	27	Terres australes et antarctiques françaises
338	38	33	Francuski južni i antarktički teritoriji
339	38	39	Territori Francesi del Sud
340	38	40	フランス領南方・南極地域
341	38	68	Franse Gebieden in de zuidelijke Indische Oceaan
342	38	76	Terras Austrais e Antárticas Francesas
343	39	15	Lesotho
344	39	20	Lesotho
345	39	22	لسوتو
346	39	27	Lesotho
347	39	33	Lesoto
348	39	39	Lesotho
349	39	40	レソト
350	39	68	Lesotho
351	39	76	Lesoto
352	40	15	Botswana
353	40	20	Botswana
354	40	22	بوتسوانا
355	40	27	Botswana
356	40	33	Bocvana
357	40	39	Botswana
358	40	40	ボツワナ
359	40	68	Botswana
360	40	76	Botsuana
361	41	15	Namibia
362	41	20	Namibia
363	41	22	نامیبیا
364	41	27	Namibie
365	41	33	Namibija
366	41	39	Namibia
367	41	40	ナミビア
368	41	68	Namibië
369	41	76	Namíbia
370	42	15	Republik Südafrika
371	42	20	República de Sudáfrica
372	42	22	آفریقای جنوبی
373	42	27	Afrique du Sud
374	42	33	Južnoafrička Republika
375	42	39	Sud Africa
376	42	40	南アフリカ
377	42	68	Zuid-Afrika
378	42	76	República Sul-Africana
379	43	15	Swasiland
380	43	20	Suazilandia
381	43	22	سوازیلند
382	43	27	Swaziland
383	43	33	Svazi
384	43	39	Swaziland
385	43	40	スワジランド
386	43	68	Swaziland
387	43	76	Suazilândia
388	44	15	Benin
389	44	20	Benín
390	44	22	بنین
391	44	27	Bénin
392	44	33	Benin
393	44	39	Benin
394	44	40	ベナン
395	44	68	Benin
396	44	76	Benim
397	45	15	Burkina Faso
398	45	20	Burkina Faso
399	45	22	بورکینافاسو
400	45	27	Burkina Faso
401	45	33	Burkina Faso
402	45	39	Burkina Faso
403	45	40	ブルキナファソ
404	45	68	Burkina Faso
405	45	76	Burquina Faso
406	46	15	Kap Verde
407	46	20	Cabo Verde
408	46	22	کیپ ورد
409	46	27	Cap Vert
410	46	33	Zelenortska Republika
411	46	39	Capo Verde
412	46	40	カーボベルデ
413	46	68	Kaapverdië
414	46	76	Cabo Verde
415	47	15	Gambia
416	47	20	Gambia
417	47	22	گامبیا
418	47	27	Gambie
419	47	33	Gambija
420	47	39	Gambia
421	47	40	ガンビア
422	47	68	Gambia
423	47	76	Gâmbia
424	48	15	Ghana
425	48	20	Ghana
426	48	22	غنا
427	48	27	Ghana
428	48	33	Gana
429	48	39	Ghana
430	48	40	ガーナ
431	48	68	Ghana
432	48	76	Gana
433	49	15	Guinea-Bissau
434	49	20	Guinea-Bisáu
435	49	22	گینه بیسائو
436	49	27	Guinée-Bissau
437	49	33	Gvineja Bisau
438	49	39	Guinea-Bissau
439	49	40	ギニアビサウ
440	49	68	Guinee-Bissau
441	49	76	Guiné-Bissau
442	50	15	Guinea
443	50	20	Guinea
444	50	22	گینه
445	50	27	Guinée
446	50	33	Gvineja
447	50	39	Guinea
448	50	40	ギニア
449	50	68	Guinee
450	50	76	Guiné
451	51	15	Elfenbeinküste
452	51	20	Costa de Marfil
453	51	22	ساحل عاج
454	51	27	Côte d'Ivoire
455	51	33	Obala Bjelokosti
456	51	39	Costa D'Avorio
457	51	40	コートジボワール
458	51	68	Ivoorkust
459	51	76	Costa do Marfim
460	52	15	Liberia
461	52	20	Liberia
462	52	22	لیبریا
463	52	27	Liberia
464	52	33	Liberija
465	52	39	Liberia
466	52	40	リベリア
467	52	68	Liberia
468	52	76	Libéria
469	53	15	Mali
470	53	20	Mali
471	53	22	مالی
472	53	27	Mali
473	53	33	Mali
474	53	39	Mali
475	53	40	マリ
476	53	68	Mali
477	53	76	Mali
478	54	15	Mauretanien
479	54	20	Mauritania
480	54	22	موریتانی
481	54	27	Mauritanie
482	54	33	Mauritanija
483	54	39	Mauritania
484	54	40	モーリタニア
485	54	68	Mauritanië
486	54	76	Mauritânia
487	55	15	Nigeria
488	55	20	Nigeria
489	55	22	نیجریه
490	55	27	Nigéria
491	55	33	Nigerija
492	55	39	Nigeria
493	55	40	ナイジェリア
494	55	68	Nigeria
495	55	76	Nigéria
496	56	15	Niger
497	56	20	Níger
498	56	22	نیجر
499	56	27	Niger
500	56	33	Niger
501	56	39	Niger
502	56	40	ニジェール
503	56	68	Niger
504	56	76	Níger
505	57	15	Sankt Helena
506	57	20	Santa Helena
507	57	22	سنت هلنا، اسنشن و تریستان دا کونا
508	57	27	Sainte-Hélène
509	57	33	Sveta Helena
510	57	39	Sant'Elena
511	57	40	セントヘレナ・アセンションおよびトリスタンダクーニャ
512	57	68	Sint-Helena
513	57	76	Santa Helena
514	58	15	Senegal
515	58	20	Senegal
516	58	22	سنگال
517	58	27	Sénégal
518	58	33	Senegal
519	58	39	Senegal
520	58	40	セネガル
521	58	68	Senegal
522	58	76	Senegal
523	59	15	Sierra Leone
524	59	20	Sierra Leone
525	59	22	سیرالئون
526	59	27	Sierra Leone
527	59	33	Sijera Leone
528	59	39	Sierra Leone
529	59	40	シエラレオネ
530	59	68	Sierra Leone
531	59	76	Serra Leoa
532	60	15	Togo
533	60	20	Togo
534	60	22	توگو
535	60	27	Togo
536	60	33	Togo
537	60	39	Togo
538	60	40	トーゴ
539	60	68	Togo
540	60	76	Togo
541	61	15	Anguilla
542	61	20	Anguilla
543	61	22	آنگویلا
544	61	27	Anguilla
545	61	33	Angvila
546	61	39	Anguilla
547	61	40	アンギラ
548	61	68	Anguilla
549	61	76	Anguila
550	62	15	Antigua und Barbuda
551	62	20	Antigua y Barbuda
552	62	22	آنتیگوا و باربودا
553	62	27	Antigua-et-Barbuda
554	62	33	Antigva i Barbuda
555	62	39	Antigua e Barbuda
556	62	40	アンティグア・バーブーダ
557	62	68	Antigua en Barbuda
558	62	76	Antígua e Barbuda
559	63	15	Aruba
560	63	20	Aruba
561	63	22	آروبا
562	63	27	Aruba
563	63	33	Aruba
564	63	39	Aruba
565	63	40	アルバ
566	63	68	Aruba
567	63	76	Aruba
568	64	15	Bahamas
569	64	20	Bahamas
570	64	22	باهاما
571	64	27	Bahamas
572	64	33	Bahami
573	64	39	Bahamas
574	64	40	バハマ
575	64	68	Bahama’s
576	64	76	Baamas
577	65	15	Barbados
578	65	20	Barbados
579	65	22	باربادوس
580	65	27	Barbade
581	65	33	Barbados
582	65	39	Barbados
583	65	40	バルバドス
584	65	68	Barbados
585	65	76	Barbados
586	66	15	Kaimaninseln
587	66	20	Islas Caimán
588	66	22	جزایر کیمن
589	66	27	Îles Caïmans
590	66	33	Kajmanski otoci
591	66	39	Isole Cayman
592	66	40	ケイマン諸島
593	66	68	Caymaneilanden
594	66	76	Ilhas Caimão
595	67	15	Kuba
596	67	20	Cuba
597	67	22	کوبا
598	67	27	Cuba
599	67	33	Kuba
600	67	39	Cuba
601	67	40	キューバ
602	67	68	Cuba
603	67	76	Cuba
604	68	15	Dominica
605	68	20	Dominica
606	68	22	دومینیکا
607	68	27	Dominique
608	68	33	Dominika
609	68	39	Dominica
610	68	40	ドミニカ国
611	68	68	Dominica
612	68	76	Dominica
613	69	15	Dominikanische Republik
614	69	20	República Dominicana
615	69	22	جمهوری دومینیکن
616	69	27	République dominicaine
617	69	33	Dominikanska Republika
618	69	39	Repubblica Dominicana
619	69	40	ドミニカ共和国
620	69	68	Dominicaanse Republiek
621	69	76	República Dominicana
622	70	15	Bonaire, Sint Eustatius und Saba
623	70	22	بونیر
624	70	27	Bonaire, Saint-Eustache et Saba
625	70	39	Bonaire, Saint-Eustache e Saba
626	70	76	Bonaire
627	71	15	Curaçao
628	71	22	کوراسائو
629	71	27	Curaçao
630	71	39	Curaçao
631	71	68	Curaçao
632	71	76	Curaçao
633	72	15	Sint Maarten (niederl. Teil)
634	72	22	سینت مارتن
635	72	27	Saint Martin (partie néerlandaise)
636	72	39	Saint Martin (parte olandese)
637	72	68	Sint Maarten
638	72	76	São Martinho
639	73	15	Martinique
640	73	20	Martinica
641	73	22	مونتسرات
642	73	27	Martinique
643	73	33	Martinique
644	73	39	Martinica
645	73	40	マルティニーク
646	73	68	Martinique
647	73	76	Martinica
648	74	15	Grenada
649	74	20	Grenada
650	74	22	گرنادا
651	74	27	Grenade
652	74	33	Grenada
653	74	39	Grenada
654	74	40	グレナダ
655	74	68	Grenada
656	74	76	Granada
657	75	15	Guadeloupe
658	75	20	Guadalupe
659	75	22	جزیره گوادلوپ
660	75	27	Guadeloupe
661	75	33	Gvadalupa
662	75	39	Guadeloupa
663	75	40	グアドループ
664	75	68	Guadeloupe
665	75	76	Guadalupe
666	76	15	Haiti
667	76	20	Haiti
668	76	22	هائیتی
669	76	27	Haïti
670	76	33	Haiti
671	76	39	Haiti
672	76	40	ハイチ
673	76	68	Haïti
674	76	76	Haiti
675	77	15	Jamaika
676	77	20	Jamaica
677	77	22	جامائیکا
678	77	27	Jamaïque
679	77	33	Jamajka
680	77	39	Giamaica
681	77	40	ジャマイカ
682	77	68	Jamaica
683	77	76	Jamaica
684	78	15	St. Kitts und Nevis
685	78	20	San Cristóbal y Nieves
686	78	22	سنت کیتس و نویس
687	78	27	Saint-Christophe-et-Niévès
688	78	33	Sveti Kristof i Nevis
689	78	39	Saint Kitts e Nevis
690	78	40	セントクリストファー・ネイビス
691	78	68	Saint Kitts en Nevis
692	78	76	São Cristóvão e Neves
693	79	15	Montserrat
694	79	20	Montserrat
695	79	22	مایوت
696	79	27	Montserrat
697	79	33	Montserrat
698	79	39	Montserrat
699	79	40	モントセラト
700	79	68	Montserrat
701	79	76	Monserrate
702	80	15	Puerto Rico
703	80	20	Puerto Rico
704	80	22	پورتو ریکو
705	80	27	Porto Rico
706	80	33	Portoriko
707	80	39	Porto Rico
708	80	40	プエルトリコ
709	80	68	Puerto Rico
710	80	76	Porto Rico
711	81	15	Saint-Barthélemy
712	81	20	San Bartolomé
713	81	22	سن-بارتلمی
714	81	27	Saint-Barthélemy
715	81	33	Saint Barthélemy
716	81	39	Antille Francesi
717	81	40	サン・バルテルミー
718	81	68	Saint Barthélemy
719	81	76	São Bartolomeu
720	82	15	Saint Lucia
721	82	20	Santa Lucía
722	82	22	سنت لوسیا
723	82	27	Saint-Lucie
724	82	33	Sveta Lucija
725	82	39	Santa Lucia
726	82	40	セントルシア
727	82	68	Saint Lucia
728	82	76	Santa Lúcia
729	83	15	Saint Martin
730	83	20	Saint Martin
731	83	22	سینت مارتن
732	83	27	Saint-Martin
733	83	33	Sveti Martin
734	83	39	Saint Martin
735	83	40	サン・マルタン（フランス領）
736	83	68	Saint-Martin
737	83	76	Ilha São Martinho
738	84	15	Saint Vincent und die Grenadinen
739	84	20	San Vicente y Granadinas
740	84	22	سنت وینسنت و گرنادین‌ها
741	84	27	Saint-Vincent-et-les-Grenadines
742	84	33	Sveti Vincent i Grenadini
743	84	39	Saint Vincent e Grenadine
744	84	40	セントビンセントおよびグレナディーン諸島
745	84	68	Saint Vincent en de Grenadines
746	84	76	São Vicente e Granadinas
747	85	15	Trinidad und Tobago
748	85	20	Trinidad y Tobago
749	85	22	ترینیداد و توباگو
750	85	27	Trinité et Tobago
751	85	33	Trinidad i Tobago
752	85	39	Trinidad e Tobago
753	85	40	トリニダード・トバゴ
754	85	68	Trinidad en Tobago
755	85	76	Trindade e Tobago
756	86	15	Turks- und Caicosinseln
757	86	20	Islas Turks y Caicos
758	86	22	جزایر تورکس و کایکوس
759	86	27	Îles Turques-et-Caïques
760	86	33	Otoci Turks i Caicos
761	86	39	Isole Turks e Caicos
762	86	40	タークス・カイコス諸島
763	86	68	Turks- en Caicoseilanden
764	86	76	Ilhas Turcas e Caicos
765	87	15	Britische Jungferninseln
766	87	20	Islas Vírgenes del Reino Unido
767	87	22	جزایر ویرجین بریتانیا
768	87	27	Îles Vierges britanniques
769	87	33	Britanski Djevičanski Otoci
770	87	39	Isole Vergini Britanniche
771	87	40	イギリス領ヴァージン諸島
772	87	68	Britse Maagdeneilanden
773	87	76	Ilhas Virgens Britânicas
774	88	15	Amerikanische Jungferninseln
775	88	20	Islas Vírgenes de los Estados Unidos
776	88	22	جزایر ویرجین آمریکا
777	88	27	Îles Vierges des États-Unis
778	88	39	Isole Vergini americane
779	88	40	アメリカ領ヴァージン諸島
780	88	68	Verenigde Staten Maagdeneilanden
781	88	76	Ilhas Virgens Americanas
782	89	15	Belize
783	89	20	Belice
784	89	22	بلیز
785	89	27	Belize
786	89	33	Belize
787	89	39	Belize
788	89	40	ベリーズ
789	89	68	Belize
790	89	76	Belize
791	90	15	Costa Rica
792	90	20	Costa Rica
793	90	22	کاستاریکا
794	90	27	Costa Rica
795	90	33	Kostarika
796	90	39	Costa Rica
797	90	40	コスタリカ
798	90	68	Costa Rica
799	90	76	Costa Rica
800	91	15	Guatemala
801	91	20	Guatemala
802	91	22	گواتمالا
803	91	27	Guatemala
804	91	33	Gvatemala
805	91	39	Guatemala
806	91	40	グアテマラ
807	91	68	Guatemala
808	91	76	Guatemala
809	92	15	Honduras
810	92	20	Honduras
811	92	22	هندوراس
812	92	27	Honduras
813	92	33	Honduras
814	92	39	Honduras
815	92	40	ホンジュラス
816	92	68	Honduras
817	92	76	Honduras
818	93	15	Mexiko
819	93	20	México
820	93	22	مکزیک
821	93	27	Mexique
822	93	33	Meksiko
823	93	39	Messico
824	93	40	メキシコ
825	93	68	Mexico
826	93	76	México
827	94	15	Nicaragua
828	94	20	Nicaragua
829	94	22	نیکاراگوئه
830	94	27	Nicaragua
831	94	33	Nikaragva
832	94	39	Nicaragua
833	94	40	ニカラグア
834	94	68	Nicaragua
835	94	76	Nicarágua
836	95	15	Panama
837	95	20	Panamá
838	95	22	پاناما
839	95	27	Panama
840	95	33	Panama
841	95	39	Panama
842	95	40	パナマ
843	95	68	Panama
844	95	76	Panamá
845	96	15	El Salvador
846	96	20	El Salvador
847	96	22	السالوادور
848	96	27	Salvador
849	96	33	Salvador
850	96	39	El Salvador
851	96	40	エルサルバドル
852	96	68	El Salvador
853	96	76	El Salvador
854	97	15	Kleinere Inselbesitzungen der Vereinigten Staaten
855	97	20	Islas Ultramarinas Menores de Estados Unidos
856	97	22	جزایر کوچک حاشیه‌ای ایالات متحده آمریکا
857	97	27	Îles mineures éloignées des États-Unis
858	97	33	Mali udaljeni otoci SAD-a
859	97	39	Isole minori esterne degli Stati Uniti d'America
860	97	40	合衆国領有小離島
861	97	68	Kleine afgelegen eilanden van de Verenigde Staten
862	97	76	Ilhas Menores Distantes dos Estados Unidos
863	98	15	Vereinigte Staaten von Amerika
864	98	20	Estados Unidos
865	98	22	ایالات متحده آمریکا
866	98	27	États-Unis
867	98	33	Sjedinjene Američke Države
868	98	39	Stati Uniti D'America
869	98	40	アメリカ合衆国
870	98	68	Verenigde Staten
871	98	76	Estados Unidos
872	99	15	Bermuda
873	99	20	Bermudas
874	99	22	برمودا
875	99	27	Bermudes
876	99	33	Bermudi
877	99	39	Bermuda
878	99	40	バミューダ
879	99	68	Bermuda
880	99	76	Bermudas
881	100	15	Kanada
882	100	20	Canadá
883	100	22	کانادا
884	100	27	Canada
885	100	33	Kanada
886	100	39	Canada
887	100	40	カナダ
888	100	68	Canada
889	100	76	Canadá
890	101	15	Saint-Pierre und Miquelon
891	101	20	San Pedro y Miquelón
892	101	22	سن پیر و میکلن
893	101	27	Saint-Pierre-et-Miquelon
894	101	33	Sveti Petar i Mikelon
895	101	39	Saint-Pierre e Miquelon
896	101	40	サンピエール島・ミクロン島
897	101	68	Saint Pierre en Miquelon
898	101	76	São Pedro e Miquelon
899	102	15	Grönland
900	102	20	Groenlandia
901	102	22	گرینلند
902	102	27	Groenland
903	102	33	Grenland
904	102	39	Groenlandia
905	102	40	グリーンランド
906	102	68	Groenland
907	102	76	Gronelândia
908	103	15	Argentinien
909	103	20	Argentina
910	103	22	آرژانتین
911	103	27	Argentine
912	103	33	Argentina
913	103	39	Argentina
914	103	40	アルゼンチン
915	103	68	Argentinië
916	103	76	Argentina
917	104	15	Bolivien
918	104	20	Bolivia
919	104	22	بولیوی
920	104	27	Bolivie
921	104	33	Bolivija
922	104	39	Bolivia
923	104	40	ボリビア多民族国
924	104	68	Bolivia
925	104	76	Bolívia
926	105	15	Brasilien
927	105	20	Brasil
928	105	22	برزیل
929	105	27	Brésil
930	105	33	Brazil
931	105	39	Brasile
932	105	40	ブラジル
933	105	68	Brazilië
934	105	76	Brasil
935	106	15	Chile
936	106	20	Chile
937	106	22	شیلی
938	106	27	Chili
939	106	33	Čile
940	106	39	Cile
941	106	40	チリ
942	106	68	Chili
943	106	76	Chile
944	107	15	Kolumbien
945	107	20	Colombia
946	107	22	کلمبیا
947	107	27	Colombie
948	107	33	Kolumbija
949	107	39	Colombia
950	107	40	コロンビア
951	107	68	Colombia
952	107	76	Colômbia
953	108	15	Ecuador
954	108	20	Ecuador
955	108	22	اکوادور
956	108	27	Équateur
957	108	33	Ekvador
958	108	39	Ecuador
959	108	40	エクアドル
960	108	68	Ecuador
961	108	76	Equador
962	109	15	Falklandinseln
963	109	20	Islas Malvinas
964	109	22	جزایر فالکلند
965	109	27	Îles Malouines
966	109	33	Falklandski Otoci
967	109	39	Isole Falkland o Isole Malvine
968	109	40	フォークランド（マルビナス）諸島
969	109	68	Falklandeilanden [Islas Malvinas]
970	109	76	Ilhas Falkland
971	110	15	Guyana
972	110	20	Guyana
973	110	22	گویان
974	110	27	Guyane
975	110	33	Gvajana
976	110	39	Guyana
977	110	40	ガイアナ
978	110	68	Guyana
979	110	76	Guiana
980	111	15	Paraguay
981	111	20	Paraguay
982	111	22	پاراگوئه
983	111	27	Paraguay
984	111	33	Paragvaj
985	111	39	Paraguay
986	111	40	パラグアイ
987	111	68	Paraguay
988	111	76	Paraguai
989	112	15	Peru
990	112	20	Perú
991	112	22	پرو
992	112	27	Pérou
993	112	33	Peru
994	112	39	Perù
995	112	40	ペルー
996	112	68	Peru
997	112	76	Peru
998	113	15	Südgeorgien und die Südlichen Sandwichinseln
999	113	20	Islas Georgias del Sur y Sandwich del Sur
1000	113	22	جزایر جورجیای جنوبی و ساندویچ جنوبی
1001	113	27	Géorgie du Sud-et-les Îles Sandwich du Sud
1002	113	33	Južna Georgija i otočje Južni Sandwich
1003	113	39	Georgia del Sud e Isole Sandwich Meridionali
1004	113	40	サウスジョージア・サウスサンドウィッチ諸島
1005	113	68	Zuid-Georgia en Zuidelijke Sandwicheilanden
1006	113	76	Ilhas Geórgia do Sul e Sanduíche do Sul
1007	114	15	Suriname
1008	114	20	Surinam
1009	114	22	سورینام
1010	114	27	Surinam
1011	114	33	Surinam
1012	114	39	Suriname
1013	114	40	スリナム
1014	114	68	Suriname
1015	114	76	Suriname
1016	115	15	Uruguay
1017	115	20	Uruguay
1018	115	22	اروگوئه
1019	115	27	Uruguay
1020	115	33	Urugvaj
1021	115	39	Uruguay
1022	115	40	ウルグアイ
1023	115	68	Uruguay
1024	115	76	Uruguai
1025	116	15	Venezuela
1026	116	20	Venezuela
1027	116	22	ونزوئلا
1028	116	27	Venezuela
1029	116	33	Venezuela
1030	116	39	Venezuela
1031	116	40	ベネズエラ・ボリバル共和国
1032	116	68	Venezuela
1033	116	76	Venezuela
1034	117	15	Französisch Guyana
1035	117	20	Guayana Francesa
1036	117	22	گویان فرانسه
1037	117	27	Guayane
1038	117	33	Francuska Gvajana
1039	117	39	Guyana francese
1040	117	40	フランス領ギアナ
1041	117	68	Frans-Guyana
1042	117	76	Guiana Francesa
1043	118	15	Kasachstan
1044	118	20	Kazajistán
1045	118	22	قزاقستان
1046	118	27	Kazakhstan
1047	118	33	Kazahstan
1048	118	39	Kazakistan
1049	118	40	カザフスタン
1050	118	68	Kazachstan
1051	118	76	Cazaquistão
1052	119	15	Kirgisistan
1053	119	20	Kirguizistán
1054	119	22	قرقیزستان
1055	119	27	Kirghizistan
1056	119	33	Kirgistan
1057	119	39	Kirghizistan
1058	119	40	キルギス
1059	119	68	Kirgizië
1060	119	76	Quirguizistão
1061	120	15	Tadschikistan
1062	120	20	Tayikistán
1063	120	22	تاجیکستان
1064	120	27	Tadjikistan
1065	120	33	Tađikistan
1066	120	39	Tagikistan
1067	120	40	タジキスタン
1068	120	68	Tadzjikistan
1069	120	76	Tajiquistão
1070	121	15	Turkmenistan
1071	121	20	Turkmenistán
1072	121	22	ترکمنستان
1073	121	27	Turkménistan
1074	121	33	Turkmenistan
1075	121	39	Turkmenistan
1076	121	40	トルクメニスタン
1077	121	68	Turkmenistan
1078	121	76	Turquemenistão
1079	122	15	Usbekistan
1080	122	20	Uzbekistán
1081	122	22	ازبکستان
1082	122	27	Ouzbékistan
1083	122	33	Uzbekistan
1084	122	39	Uzbekistan
1085	122	40	ウズベキスタン
1086	122	68	Oezbekistan
1087	122	76	Usbequistão
1088	123	15	China
1089	123	20	China
1090	123	22	چین
1091	123	27	Chine
1092	123	33	Kina
1093	123	39	Cina
1094	123	40	中国
1095	123	68	China
1096	123	76	China
1097	124	15	Hong Kong
1098	124	20	Hong Kong
1099	124	22	هنگ‌کنگ
1100	124	27	Hong Kong
1101	124	33	Hong Kong
1102	124	39	Hong Kong
1103	124	40	香港
1104	124	68	Hongkong
1105	124	76	Hong Kong
1106	125	15	Macao
1107	125	20	Macao
1108	125	22	مکائو
1109	125	27	Macao
1110	125	33	Makao
1111	125	39	Macao
1112	125	40	マカオ
1113	125	68	Macao
1114	125	76	Macau
1115	126	15	Japan
1116	126	20	Japón
1117	126	22	ژاپن
1118	126	27	Japon
1119	126	33	Japan
1120	126	39	Giappone
1121	126	40	日本
1122	126	68	Japan
1123	126	76	Japão
1124	127	15	Mongolei
1125	127	20	Mongolia
1126	127	22	مغولستان
1127	127	27	Mongolie
1128	127	33	Mongolija
1129	127	39	Mongolia
1130	127	40	モンゴル
1131	127	68	Mongolië
1132	127	76	Mongólia
1133	128	15	Nordkorea
1134	128	20	Corea del Norte
1135	128	22	کره جنوبی
1136	128	27	Corée du Nord
1137	128	33	Sjeverna Koreja
1138	128	39	Corea del Nord
1139	128	40	朝鮮民主主義人民共和国
1140	128	68	Noord-Korea
1141	128	76	Coreia do Norte
1142	129	15	Südkorea
1143	129	20	Corea del Sur
1144	129	22	کره شمالی
1145	129	27	Corée du Sud
1146	129	33	Južna Koreja
1147	129	39	Corea del Sud
1148	129	40	大韓民国
1149	129	68	Zuid-Korea
1150	129	76	Coreia do Sul
1151	130	15	Taiwan
1152	130	20	Taiwán
1153	130	22	تایوان
1154	130	27	Taïwan
1155	130	33	Tajvan
1156	130	39	Taiwan
1157	130	40	台湾（中華民国）
1158	130	68	Taiwan
1159	130	76	Taiwan
1160	131	15	Brunei
1161	131	20	Brunei
1162	131	22	برونئی
1163	131	27	Brunei
1164	131	33	Brunej
1165	131	39	Brunei
1166	131	40	ブルネイ・ダルサラーム
1167	131	68	Brunei
1168	131	76	Brunei
1169	132	15	Myanmar
1170	132	20	Myanmar
1171	132	22	میانمار
1172	132	27	Myanmar
1173	132	33	Mijanmar
1174	132	39	Birmania
1175	132	40	ミャンマー
1176	132	68	Myanmar
1177	132	76	Myanmar
1178	133	15	Kambodscha
1179	133	20	Camboya
1180	133	22	کامبوج
1181	133	27	Cambodge
1182	133	33	Kambodža
1183	133	39	Cambogia
1184	133	40	カンボジア
1185	133	68	Cambodja
1186	133	76	Camboja
1187	134	15	Timor-Leste
1188	134	20	Timor Oriental
1189	134	22	تیمور شرقی
1190	134	27	Timor oriental
1191	134	33	Istočni Timor
1192	134	39	Timor Est
1193	134	40	東ティモール
1194	134	68	Oost-Timor
1195	134	76	Timor Leste
1196	135	15	Philippinen
1197	135	20	Filipinas
1198	135	22	جزایر الندفیلیپین
1199	135	27	Philippines
1200	135	33	Filipini
1201	135	39	Filippine
1202	135	40	フィリピン
1203	135	68	Filipijnen
1204	135	76	Filipinas
1205	136	15	Indonesien
1206	136	20	Indonesia
1207	136	22	اندونزی
1208	136	27	Indonésie
1209	136	33	Indonezija
1210	136	39	Indonesia
1211	136	40	インドネシア
1212	136	68	Indonesië
1213	136	76	Indonésia
1214	137	15	Laos
1215	137	20	Laos
1216	137	22	لائوس
1217	137	27	Laos
1218	137	33	Laos
1219	137	39	Laos
1220	137	40	ラオス人民民主共和国
1221	137	68	Laos
1222	137	76	Laos
1223	138	15	Malaysia
1224	138	20	Malasia
1225	138	22	مالزی
1226	138	27	Malaisie
1227	138	33	Malezija
1228	138	39	Malesia
1229	138	40	マレーシア
1230	138	68	Maleisië
1231	138	76	Malásia
1232	139	15	Singapur
1233	139	20	Singapur
1234	139	22	سنگاپور
1235	139	27	Singapour
1236	139	33	Singapur
1237	139	39	Singapore
1238	139	40	シンガポール
1239	139	68	Singapore
1240	139	76	Singapura
1241	140	15	Thailand
1242	140	20	Tailandia
1243	140	22	تایلند
1244	140	27	Thaïlande
1245	140	33	Tajland
1246	140	39	Tailandia
1247	140	40	タイ
1248	140	68	Thailand
1249	140	76	Tailândia
1250	141	15	Vietnam
1251	141	20	Vietnam
1252	141	22	ویتنام
1253	141	27	Viêt Nam
1254	141	33	Vijetnam
1255	141	39	Vietnam
1256	141	40	ベトナム
1257	141	68	Vietnam
1258	141	76	Vietname
1259	142	15	Afghanistan
1260	142	20	Afganistán
1261	142	22	افغانستان
1262	142	27	Afghanistan
1263	142	33	Afganistan
1264	142	39	Afghanistan
1265	142	40	アフガニスタン
1266	142	68	Afghanistan
1267	142	76	Afeganistão
1268	143	15	Bangladesch
1269	143	20	Bangladesh
1270	143	22	بنگلادش
1271	143	27	Bangladesh
1272	143	33	Bangladeš
1273	143	39	Bangladesh
1274	143	40	バングラデシュ
1275	143	68	Bangladesh
1276	143	76	Bangladeche
1277	144	15	Bhutan
1278	144	20	Bután
1279	144	22	بوتان
1280	144	27	Bhoutan
1281	144	33	Butan
1282	144	39	Bhutan
1283	144	40	ブータン
1284	144	68	Bhutan
1285	144	76	Butão
1286	145	15	Indien
1287	145	20	India
1288	145	22	هند
1289	145	27	Inde
1290	145	33	Indija
1291	145	39	India
1292	145	40	インド
1293	145	68	India
1294	145	76	Índia
1295	146	15	Iran
1296	146	20	Iran
1297	146	22	ایران
1298	146	27	Iran
1299	146	33	Iran
1300	146	40	イラン・イスラム共和国
1301	146	68	Iran
1302	146	76	Irão
1303	147	15	Malediven
1304	147	20	Maldivas
1305	147	22	مالدیو
1306	147	27	Maldives
1307	147	33	Maldivi
1308	147	39	Maldive
1309	147	40	モルディブ
1310	147	68	Maldiven
1311	147	76	Maldivas
1312	148	15	Népal
1313	148	20	Nepal
1314	148	22	نپال
1315	148	27	Népal
1316	148	33	Nepal
1317	148	39	Nepal
1318	148	40	ネパール
1319	148	68	Nepal
1320	148	76	Nepal
1321	149	15	Pakistan
1322	149	20	Pakistán
1323	149	22	پاکستان
1324	149	27	Pakistan
1325	149	33	Pakistan
1326	149	39	Pakistan
1327	149	40	パキスタン
1328	149	68	Pakistan
1329	149	76	Paquistão
1330	150	15	Sri Lanka
1331	150	20	Sri Lanka
1332	150	22	سری‌لانکا
1333	150	27	Sri Lanka
1334	150	33	Šri Lanka
1335	150	39	Sri Lanka
1336	150	40	スリランカ
1337	150	68	Sri Lanka
1338	150	76	Sri Lanka
1339	151	15	Armenien
1340	151	20	Armenia
1341	151	22	ارمنستان
1342	151	27	Arménie
1343	151	33	Armenija
1344	151	39	Armenia
1345	151	40	アルメニア
1346	151	68	Armenië
1347	151	76	Arménia
1348	152	15	Aserbaidschan
1349	152	20	Azerbaiyán
1350	152	22	آذربایجان
1351	152	27	Azerbaïdjan
1352	152	33	Azerbajdžan
1353	152	39	Azerbaijan
1354	152	40	アゼルバイジャン
1355	152	68	Azerbeidzjan
1356	152	76	Azerbaijão
1357	153	15	Bahrain
1358	153	20	Bahrein
1359	153	22	بحرین
1360	153	27	Bahreïn
1361	153	33	Bahrein
1362	153	39	Bahrein
1363	153	40	バーレーン
1364	153	68	Bahrein
1365	153	76	Barém
1366	154	15	Vereinigte Arabische Emirate
1367	154	20	Emiratos Árabes Unidos
1368	154	22	امارات متحده عربی
1369	154	27	Émirats arabes unis
1370	154	33	Ujedinjeni Arapski Emirati
1371	154	39	Emirati Arabi Uniti
1372	154	40	アラブ首長国連邦
1373	154	68	Verenigde Arabische Emiraten
1374	154	76	Emirados árabes Unidos
1375	155	15	Georgien
1376	155	20	Georgia
1377	155	22	گرجستان
1378	155	27	Géorgie
1379	155	33	Gruzija
1380	155	39	Georgia
1381	155	40	グルジア
1382	155	68	Georgië
1383	155	76	Geórgia
1384	156	15	Irak
1385	156	20	Irak
1386	156	22	عراق
1387	156	27	Irak
1388	156	33	Irak
1389	156	39	Iraq
1390	156	40	イラク
1391	156	68	Irak
1392	156	76	Iraque
1393	157	15	Israel
1394	157	20	Israel
1395	157	22	اسرائیل
1396	157	27	Israël
1397	157	33	Izrael
1398	157	39	Israele
1399	157	40	イスラエル
1400	157	68	Israël
1401	157	76	Israel
1402	158	15	Jordanien
1403	158	20	Jordania
1404	158	22	اردن
1405	158	27	Jordanie
1406	158	33	Jordan
1407	158	39	Giordania
1408	158	40	ヨルダン
1409	158	68	Jordanië
1410	158	76	Jordânia
1411	159	15	Kuwait
1412	159	20	Kuwait
1413	159	22	کویت
1414	159	27	Koweït
1415	159	33	Kuvajt
1416	159	39	Kuwait
1417	159	40	クウェート
1418	159	68	Koeweit
1419	159	76	Kuwait
1420	160	15	Libanon
1421	160	20	Líbano
1422	160	22	لبنان
1423	160	27	Liban
1424	160	33	Libanon
1425	160	39	Libano
1426	160	40	レバノン
1427	160	68	Libanon
1428	160	76	Líbano
1429	161	15	Oman
1430	161	20	Omán
1431	161	22	عمان
1432	161	27	Oman
1433	161	33	Oman
1434	161	39	oman
1435	161	40	オマーン
1436	161	68	Oman
1437	161	76	Omã
1438	162	15	Palästina
1439	162	20	Palestina
1440	162	22	فلسطین
1441	162	27	Palestine
1442	162	33	Palestina
1443	162	39	Palestina
1444	162	40	パレスチナ
1445	162	68	Palestijnse gebieden
1446	162	76	Palestina
1447	163	15	Katar
1448	163	20	Catar
1449	163	22	قطر
1450	163	27	Qatar
1451	163	33	Katar
1452	163	39	Qatar
1453	163	40	カタール
1454	163	68	Qatar
1455	163	76	Catar
1456	164	15	Saudi-Arabien
1457	164	20	Arabia Saudí
1458	164	22	عربستان سعودی
1459	164	27	Arabie Saoudite
1460	164	33	Saudijska Arabija
1461	164	39	Arabia Saudita
1462	164	40	サウジアラビア
1463	164	68	Saoedi-Arabië
1464	164	76	Arábia Saudita
1465	165	15	Syrien
1466	165	20	Siria
1467	165	22	سوریه
1468	165	27	Syrie
1469	165	33	Sirija
1470	165	39	Siria
1471	165	40	シリア・アラブ共和国
1472	165	68	Syrië
1473	165	76	Síria
1474	166	15	Türkei
1475	166	20	Turquía
1476	166	22	ترکیه
1477	166	27	Turquie
1478	166	33	Turska
1479	166	39	Turchia
1480	166	40	トルコ
1481	166	68	Turkije
1482	166	76	Turquia
1483	167	15	Jemen
1484	167	20	Yemen
1485	167	22	یمن
1486	167	27	Yémen
1487	167	33	Jemen
1488	167	39	Yemen
1489	167	40	イエメン
1490	167	68	Jemen
1491	167	76	Iémen
1492	168	15	Weißrussland
1493	168	20	Bielorrusia
1494	168	22	بلاروس
1495	168	27	Biélorussie
1496	168	33	Bjelorusija
1497	168	39	Bielorussia
1498	168	40	ベラルーシ
1499	168	68	Wit-Rusland
1500	168	76	Bielorrússia
1501	169	15	Bulgarien
1502	169	20	Bulgaria
1503	169	22	بلغارستان
1504	169	27	Bulgarie
1505	169	33	Bugarska
1506	169	39	Bulgaria
1507	169	40	ブルガリア
1508	169	68	Bulgarije
1509	169	76	Bulgária
1510	170	15	Tschechische Republik
1511	170	20	República Checa
1512	170	22	جمهوری چک
1513	170	27	République tchèque
1514	170	33	Češka
1515	170	39	Repubblica Ceca
1516	170	40	チェコ
1517	170	68	Tsjechië
1518	170	76	República Checa
1519	171	15	Ungarn
1520	171	20	Hungría
1521	171	22	مجارستان
1522	171	27	Hongrie
1523	171	33	Mađarska
1524	171	39	Ungheria
1525	171	40	ハンガリー
1526	171	68	Hongarije
1527	171	76	Hungria
1528	172	20	Kosovo
1529	172	22	کوزوو
1530	172	33	Kosovo
1531	172	76	Kosovo
1532	173	15	Moldawie
1533	173	20	Moldavia
1534	173	22	مولداوی
1535	173	27	Moldavie
1536	173	33	Moldova
1537	173	39	Moldavia
1538	173	40	モルドバ共和国
1539	173	68	Moldavië
1540	173	76	Moldávia
1541	174	15	Polen
1542	174	20	Polonia
1543	174	22	لهستان
1544	174	27	Pologne
1545	174	33	Poljska
1546	174	39	Polonia
1547	174	40	ポーランド
1548	174	68	Polen
1549	174	76	Polónia
1550	175	15	Rumänien
1551	175	20	Rumania
1552	175	22	رومانی
1553	175	27	Roumanie
1554	175	33	Rumunjska
1555	175	39	Romania
1556	175	40	ルーマニア
1557	175	68	Roemenië
1558	175	76	Roménia
1559	176	15	Russland
1560	176	20	Rusia
1561	176	22	روسیه
1562	176	27	Russie
1563	176	33	Rusija
1564	176	39	Russia
1565	176	40	ロシア連邦
1566	176	68	Rusland
1567	176	76	Rússia
1568	177	15	Slowakei
1569	177	20	República Eslovaca
1570	177	22	اسلواکی
1571	177	27	Slovaquie
1572	177	33	Slovačka
1573	177	39	Slovacchia
1574	177	40	スロバキア
1575	177	68	Slowakije
1576	177	76	Eslováquia
1577	178	15	Ukraine
1578	178	20	Ucrania
1579	178	22	وکراین
1580	178	27	Ukraine
1581	178	33	Ukrajina
1582	178	39	Ucraina
1583	178	40	ウクライナ
1584	178	68	Oekraïne
1585	178	76	Ucrânia
1586	179	15	Åland
1587	179	20	Alandia
1588	179	22	جزایر الند
1589	179	27	Åland
1590	179	33	Ålandski otoci
1591	179	39	Isole Aland
1592	179	40	オーランド諸島
1593	179	68	Ålandeilanden
1594	179	76	Ilhas de Aland
1595	180	15	Vereinigtes Königreich
1596	180	20	Reino Unido
1597	180	22	بریتانیای کبیر و ایرلند شمالی
1598	180	27	Royaume-Uni
1599	180	33	Ujedinjeno Kraljevstvo
1600	180	39	Regno Unito
1601	180	40	イギリス
1602	180	68	Verenigd Koninkrijk
1603	180	76	Reino Unido
1604	181	15	Guernsey
1605	181	20	Guernsey
1606	181	22	گرنزی
1607	181	27	Guernesey
1608	181	33	Guernsey
1609	181	39	Guernsey
1610	181	40	ガーンジー
1611	181	68	Guernsey
1612	181	76	Guernsey
1613	182	15	Jersey
1614	182	20	Jersey
1615	182	22	جرزی
1616	182	27	Jersey
1617	182	33	Jersey
1618	182	39	Isola di Jersey
1619	182	40	ジャージー
1620	182	68	Jersey
1621	182	76	Jersey
1622	183	15	Dänemark
1623	183	20	Dinamarca
1624	183	22	دانمارک
1625	183	27	Danemark
1626	183	33	Danska
1627	183	39	Danimarca
1628	183	40	デンマーク
1629	183	68	Denemarken
1630	183	76	Dinamarca
1631	184	15	Estland
1632	184	20	Estonia
1633	184	22	استونی
1634	184	27	Estonie
1635	184	33	Estonija
1636	184	39	Estonia
1637	184	40	エストニア
1638	184	68	Estland
1639	184	76	Estónia
1640	185	15	Färöer-Inseln
1641	185	20	Islas Faroe
1642	185	22	جزایر فارو
1643	185	27	Îles Féroé
1644	185	33	Farski Otoci
1645	185	39	Isole Far Oer
1646	185	40	フェロー諸島
1647	185	68	Faeröer
1648	185	76	Ilhas Faroé
1649	186	15	Finnland
1650	186	20	Finlandia
1651	186	22	فنلاند
1652	186	27	Finlande
1653	186	33	Finska
1654	186	39	Finlandia
1655	186	40	フィンランド
1656	186	68	Finland
1657	186	76	Finlândia
1658	187	15	Island
1659	187	20	Islandia
1660	187	22	ایسلند
1661	187	27	Islande
1662	187	33	Island
1663	187	39	Islanda
1664	187	40	アイスランド
1665	187	68	IJsland
1666	187	76	Islândia
1667	188	15	Irland
1668	188	20	Irlanda
1669	188	22	ایرلند
1670	188	27	Irlande
1671	188	33	Irska
1672	188	39	Irlanda
1673	188	40	アイルランド
1674	188	68	Ierland
1675	188	76	Irlanda
1676	189	15	Lettland
1677	189	20	Letonia
1678	189	22	لتونی
1679	189	27	Lettonie
1680	189	33	Latvija
1681	189	39	Lettonia
1682	189	40	ラトビア
1683	189	68	Letland
1684	189	76	Letónia
1685	190	15	Litauen
1686	190	20	Lituania
1687	190	22	لیتوانی
1688	190	27	Lituanie
1689	190	33	Litva
1690	190	39	Lituania
1691	190	40	リトアニア
1692	190	68	Litouwen
1693	190	76	Lituânia
1694	191	15	Insel Man
1695	191	20	Isla de Man
1696	191	22	جزیره من
1697	191	27	Île de Man
1698	191	33	Otok Man
1699	191	39	Isola di Man
1700	191	40	マン島
1701	191	68	Isle of Man
1702	191	76	Ilha de Man
1703	192	15	Norwegen
1704	192	20	Noruega
1705	192	22	نروژ
1706	192	27	Norvège
1707	192	33	Norveška
1708	192	39	Norvegia
1709	192	40	ノルウェー
1710	192	68	Noorwegen
1711	192	76	Noruega
1712	193	15	Svalbard und Jan Mayen
1713	193	20	Islas Svalbard y Jan Mayen
1714	193	22	سوالبارد و یان ماین
1715	193	27	Svalbard et Jan Mayen
1716	193	33	Svalbard i Jan Mayen
1717	193	39	Svalbard e Jan Mayen
1718	193	40	スヴァールバル諸島およびヤンマイエン島
1719	193	68	Svalbard en Jan Mayen
1720	193	76	Svalbard
1721	194	15	Schweden
1722	194	20	Suecia
1723	194	22	سوئد
1724	194	27	Suède
1725	194	33	Švedska
1726	194	39	Svezia
1727	194	40	スウェーデン
1728	194	68	Zweden
1729	194	76	Suécia
1730	195	15	Albanien
1731	195	20	Albania
1732	195	22	آلبانی
1733	195	27	Albanie
1734	195	33	Albanija
1735	195	39	Albania
1736	195	40	アルバニア
1737	195	68	Albanië
1738	195	76	Albânia
1739	196	15	Andorra
1740	196	20	Andorra
1741	196	22	آندورا
1742	196	27	Andorre
1743	196	33	Andora
1744	196	39	Andorra
1745	196	40	アンドラ
1746	196	68	Andorra
1747	196	76	Andorra
1748	197	15	Bosnien und Herzegowina
1749	197	20	Bosnia y Herzegovina
1750	197	22	بوسنی و هرزگوین
1751	197	27	Bosnie-Herzégovine
1752	197	33	Bosna i Hercegovina
1753	197	39	Bosnia ed Erzegovina
1754	197	40	ボスニア・ヘルツェゴビナ
1755	197	68	Bosnië en Herzegovina
1756	197	76	Bósnia e Herzegovina
1757	198	15	Kroatien
1758	198	20	Croacia
1759	198	22	کرواسی
1760	198	27	Croatie
1761	198	33	Hrvatska
1762	198	39	Croazia
1763	198	40	クロアチア
1764	198	68	Kroatië
1765	198	76	Croácia
1766	199	15	Zypern
1767	199	20	Chipre
1768	199	22	قبرس
1769	199	27	Chypre
1770	199	33	Cipar
1771	199	39	Cipro
1772	199	40	キプロス
1773	199	68	Cyprus
1774	199	76	Chipre
1775	200	15	Gibraltar
1776	200	20	Gibraltar
1777	200	22	جبل‌طارق
1778	200	27	Gibraltar
1779	200	33	Gibraltar
1780	200	39	Gibilterra
1781	200	40	ジブラルタル
1782	200	68	Gibraltar
1783	200	76	Gibraltar
1784	201	15	Griechenland
1785	201	20	Grecia
1786	201	22	یونان
1787	201	27	Grèce
1788	201	33	Grčka
1789	201	39	Grecia
1790	201	40	ギリシャ
1791	201	68	Griekenland
1792	201	76	Grécia
1793	202	15	Italien
1794	202	20	Italia
1795	202	22	ایتالیا
1796	202	27	Italie
1797	202	33	Italija
1798	202	39	Italia
1799	202	40	イタリア
1800	202	68	Italië
1801	202	76	Itália
1802	203	15	Mazedonien
1803	203	20	Macedonia
1804	203	27	Macédoine
1805	203	33	Makedonija
1806	203	39	Macedonia
1807	203	40	マケドニア旧ユーゴスラビア共和国
1808	203	68	Macedonië
1809	203	76	Macedónia
1810	204	15	Malta
1811	204	20	Malta
1812	204	22	مالت
1813	204	27	Malte
1814	204	33	Malta
1815	204	39	Malta
1816	204	40	マルタ
1817	204	68	Malta
1818	204	76	Malta
1819	205	15	Montenegro
1820	205	20	Montenegro
1821	205	22	مونته‌نگرو
1822	205	27	Monténégro
1823	205	33	Crna Gora
1824	205	39	Montenegro
1825	205	40	モンテネグロ
1826	205	68	Montenegro
1827	205	76	Montenegro
1828	206	15	Portugal
1829	206	20	Portugal
1830	206	22	پرتغال
1831	206	27	Portugal
1832	206	33	Portugal
1833	206	39	Portogallo
1834	206	40	ポルトガル
1835	206	68	Portugal
1836	206	76	Portugal
1837	207	15	San Marino
1838	207	20	San Marino
1839	207	22	سان مارینو
1840	207	27	Saint-Marin
1841	207	33	San Marino
1842	207	39	San Marino
1843	207	40	サンマリノ
1844	207	68	San Marino
1845	207	76	São Marinho
1846	208	15	Serbien
1847	208	20	Serbia
1848	208	22	صربستان
1849	208	27	Serbie
1850	208	33	Srbija
1851	208	39	Serbia
1852	208	40	セルビア
1853	208	68	Servië
1854	208	76	Sérvia
1855	209	15	Slowenien
1856	209	20	Eslovenia
1857	209	22	اسلوونی
1858	209	27	Slovénie
1859	209	33	Slovenija
1860	209	39	Slovenia
1861	209	40	スロベニア
1862	209	68	Slovenië
1863	209	76	Eslovénia
1864	210	15	Spanien
1865	210	20	España
1866	210	22	اسپانیا
1867	210	27	Espagne
1868	210	33	Španjolska
1869	210	39	Spagna
1870	210	40	スペイン
1871	210	68	Spanje
1872	210	76	Espanha
1873	211	15	Heiliger Stuhl
1874	211	20	Santa Sede
1875	211	22	سریر مقدس
1876	211	27	voir Saint
1877	211	33	Sveta Stolica
1878	211	39	Santa Sede
1879	211	40	聖座
1880	211	68	Heilige Stoel
1881	211	76	Vaticano
1882	212	15	Österreich
1883	212	20	Austria
1884	212	22	اتریش
1885	212	27	Autriche
1886	212	33	Austrija
1887	212	39	Austria
1888	212	40	オーストリア
1889	212	68	Oostenrijk
1890	212	76	áustria
1891	213	15	Belgien
1892	213	20	Bélgica
1893	213	22	بلژیک
1894	213	27	Belgique
1895	213	33	Belgija
1896	213	39	Belgio
1897	213	40	ベルギー
1898	213	68	België
1899	213	76	Bélgica
1900	214	15	Niederlande
1901	214	20	Países Bajos
1902	214	22	پادشاهی هلند
1903	214	27	Pays-Bas
1904	214	33	Nizozemska
1905	214	39	Paesi Bassi
1906	214	40	オランダ
1907	214	68	Nederland
1908	214	76	Países Baixos
1909	215	15	Frankreich
1910	215	20	Francia
1911	215	22	فرانسه
1912	215	27	France
1913	215	33	Francuska
1914	215	39	Francia
1915	215	40	フランス
1916	215	68	Frankrijk
1917	215	76	França
1918	216	15	Deutschland
1919	216	20	Alemania
1920	216	22	آلمان
1921	216	27	Allemagne
1922	216	33	Njemačka
1923	216	39	Germania
1924	216	40	ドイツ
1925	216	68	Duitsland
1926	216	76	Alemanha
1927	217	15	Liechtenstein
1928	217	20	Liechtenstein
1929	217	22	لیختن‌اشتاین
1930	217	27	Liechtenstein
1931	217	33	Lihtenštajn
1932	217	39	Liechtenstein
1933	217	40	リヒテンシュタイン
1934	217	68	Liechtenstein
1935	217	76	Listenstaine
1936	218	15	Luxemburg
1937	218	20	Luxemburgo
1938	218	22	لوکزامبورگ
1939	218	27	Luxembourg
1940	218	33	Luksemburg
1941	218	39	Lussemburgo
1942	218	40	ルクセンブルク
1943	218	68	Luxemburg
1944	218	76	Luxemburgo
1945	219	15	Monaco
1946	219	20	Mónaco
1947	219	22	موناکو
1948	219	27	Monaco
1949	219	33	Monako
1950	219	39	Principato di Monaco
1951	219	40	モナコ
1952	219	68	Monaco
1953	219	76	Mónaco
1954	220	15	Schweiz
1955	220	20	Suiza
1956	220	22	سوئیس
1957	220	27	Suisse
1958	220	33	Švicarska
1959	220	39	Svizzera
1960	220	40	スイス
1961	220	68	Zwitserland
1962	220	76	Suíça
1963	221	15	Australien
1964	221	20	Australia
1965	221	22	استرالیا
1966	221	27	Australie
1967	221	33	Australija
1968	221	39	Australia
1969	221	40	オーストラリア
1970	221	68	Australië
1971	221	76	Austrália
1972	222	15	Weihnachtsinsel
1973	222	20	Isla de Navidad
1974	222	22	جزیره کریسمس
1975	222	27	Île Christmas
1976	222	33	Božićni otok
1977	222	39	Isola di Natale
1978	222	40	クリスマス島
1979	222	68	Christmaseiland
1980	222	76	Ilha do Natal
1981	223	15	Kokosinseln
1982	223	20	Islas Cocos o Islas Keeling
1983	223	22	جزایر کوکوس
1984	223	27	Îles Cocos
1985	223	33	Kokosovi Otoci
1986	223	39	Isole Cocos e Keeling
1987	223	40	ココス（キーリング）諸島
1988	223	68	Cocoseilanden
1989	223	76	Ilhas dos Cocos
1990	224	15	Neuseeland
1991	224	20	Nueva Zelanda
1992	224	22	نیوزیلند
1993	224	27	Nouvelle-Zélande
1994	224	33	Novi Zeland
1995	224	39	Nuova Zelanda
1996	224	40	ニュージーランド
1997	224	68	Nieuw-Zeeland
1998	224	76	Nova Zelândia
1999	225	15	Norfolkinsel
2000	225	20	Isla de Norfolk
2001	225	22	جزیره نورفک
2002	225	27	Île de Norfolk
2003	225	33	Otok Norfolk
2004	225	39	Isola Norfolk
2005	225	40	ノーフォーク島
2006	225	68	Norfolkeiland
2007	225	76	Ilha Norfolk
2008	226	15	Fidschi
2009	226	20	Fiyi
2010	226	22	فیجی
2011	226	27	Fidji
2012	226	33	Fiđi
2013	226	39	Figi
2014	226	40	フィジー
2015	226	68	Fiji
2016	226	76	Fiji
2017	227	15	Neukaledonien
2018	227	20	Nueva Caledonia
2019	227	22	کالدونیای جدید
2020	227	27	Nouvelle-Calédonie
2021	227	33	Nova Kaledonija
2022	227	39	Nuova Caledonia
2023	227	40	ニューカレドニア
2024	227	68	Nieuw-Caledonië
2025	227	76	Nova Caledónia
2026	228	15	Vanuatu
2027	228	20	Vanuatu
2028	228	22	وانواتو
2029	228	27	Vanuatu
2030	228	33	Vanuatu
2031	228	39	Vanuatu
2032	228	40	バヌアツ
2033	228	68	Vanuatu
2034	228	76	Vanuatu
2035	229	15	Papua-Neuguinea
2036	229	20	Papúa Nueva Guinea
2037	229	22	پاپوآ گینه نو
2038	229	27	Papouasie-Nouvelle-Guinée
2039	229	33	Papua Nova Gvineja
2040	229	39	Papua Nuova Guinea
2041	229	40	パプアニューギニア
2042	229	68	Papoea-Nieuw-Guinea
2043	229	76	Papua Nova Guiné
2044	230	15	Salomonen
2045	230	20	Islas Salomón
2046	230	22	جزایر سلیمان
2047	230	27	Îles Salomon
2048	230	33	Solomonski Otoci
2049	230	39	Isole Salomone
2050	230	40	ソロモン諸島
2051	230	68	Salomonseilanden
2052	230	76	Ilhas Salomão
2053	231	15	Nördliche Marianen
2054	231	20	Islas Marianas del Norte
2055	231	22	جزایر ماریانای شمالی
2056	231	27	Îles Mariannes du Nord
2057	231	33	Sjevernomarijanski otoci
2058	231	39	Isole Marianne Settentrionali
2059	231	40	北マリアナ諸島
2060	231	68	Noordelijke Marianeneilanden
2061	231	76	Ilhas Marianas
2062	232	15	Guam
2063	232	20	Guam
2064	232	22	گوام
2065	232	27	Guam
2066	232	33	Guam
2067	232	39	Guam
2068	232	40	グアム
2069	232	68	Guam
2070	232	76	Guame
2071	233	15	Kiribati
2072	233	20	Kiribati
2073	233	22	کیریباتی
2074	233	27	Kiribati
2075	233	33	Kiribati
2076	233	39	Kiribati
2077	233	40	キリバス
2078	233	68	Kiribati
2079	233	76	Quiribáti
2080	234	15	Marshallinseln
2081	234	20	Islas Marshall
2082	234	22	جزایر مارشال
2083	234	27	Îles Marshall
2084	234	33	Maršalovi Otoci
2085	234	39	Isole Marshall
2086	234	40	マーシャル諸島
2087	234	68	Marshalleilanden
2088	234	76	Ilhas Marshall
2089	235	15	Mikronesien
2090	235	20	Micronesia
2091	235	22	ایالات فدرال میکرونزی
2092	235	27	Micronésie
2093	235	33	Mikronezija
2094	235	39	Micronesia
2095	235	40	ミクロネシア連邦
2096	235	68	Micronesië
2097	235	76	Micronésia
2098	236	15	Nauru
2099	236	20	Nauru
2100	236	22	نائورو
2101	236	27	Nauru
2102	236	33	Nauru
2103	236	39	Nauru
2104	236	40	ナウル
2105	236	68	Nauru
2106	236	76	Nauru
2107	237	15	Palau
2108	237	20	Palau
2109	237	22	پالائو
2110	237	27	Palaos
2111	237	33	Palau
2112	237	39	Palau
2113	237	40	パラオ
2114	237	68	Palau
2115	237	76	Palau
2116	238	15	Amerikanisch-Samoa
2117	238	20	Samoa Americana
2118	238	22	ساموآی آمریکا
2119	238	27	Samoa américaines
2120	238	33	Američka Samoa
2121	238	39	Samoa Americane
2122	238	40	アメリカ領サモア
2123	238	68	Amerikaans Samoa
2124	238	76	Samoa Americana
2125	239	15	Cookinseln
2126	239	20	Islas Cook
2127	239	22	جزایر کوک
2128	239	27	Îles Cook
2129	239	33	Cookovo Otočje
2130	239	39	Isole Cook
2131	239	40	クック諸島
2132	239	68	Cookeilanden
2133	239	76	Ilhas Cook
2134	240	15	Französisch-Polynesien
2135	240	20	Polinesia Francesa
2136	240	22	پلی‌نزی فرانسه
2137	240	27	Polynésie française
2138	240	33	Francuska Polinezija
2139	240	39	Polinesia Francese
2140	240	40	フランス領ポリネシア
2141	240	68	Frans-Polynesië
2142	240	76	Polinésia Francesa
2143	241	15	Niue
2144	241	20	Niue
2145	241	22	نیووی
2146	241	27	Niue
2147	241	33	Niue
2148	241	39	Niue
2149	241	40	ニウエ
2150	241	68	Niue
2151	241	76	Niue
2152	242	15	Pitcairn
2153	242	20	Islas Pitcairn
2154	242	22	پیتکرن
2155	242	27	Îles Pitcairn
2156	242	33	Pitcairnovo otočje
2157	242	39	Isole Pitcairn
2158	242	40	ピトケアン
2159	242	68	Pitcairneilanden
2160	242	76	Ilhas Picárnia
2161	243	15	Samoa
2162	243	20	Samoa
2163	243	22	ساموآ
2164	243	27	Samoa
2165	243	33	Samoa
2166	243	39	Samoa
2167	243	40	サモア
2168	243	68	Samoa
2169	243	76	Samoa
2170	244	15	Tokelau
2171	244	20	Islas Tokelau
2172	244	22	توکلائو
2173	244	27	Tokelau
2174	244	33	Tokelau
2175	244	39	Isole Tokelau
2176	244	40	トケラウ
2177	244	68	Tokelau
2178	244	76	Toquelau
2179	245	15	Tonga
2180	245	20	Tonga
2181	245	22	تونگا
2182	245	27	Tonga
2183	245	33	Tonga
2184	245	39	Tonga
2185	245	40	トンガ
2186	245	68	Tonga
2187	245	76	Tonga
2188	246	15	Tuvalu
2189	246	20	Tuvalu
2190	246	22	تووالو
2191	246	27	Tuvalu
2192	246	33	Tuvalu
2193	246	39	Tuvalu
2194	246	40	ツバル
2195	246	68	Tuvalu
2196	246	76	Tuvalu
2197	247	15	Wallis und Futuna
2198	247	20	Wallis y Futuna
2199	247	22	والیس و فوتونا
2200	247	27	Wallis-et-Futuna
2201	247	33	Wallis i Fortuna
2202	247	39	Wallis e Futuna
2203	247	40	ウォリス・フツナ
2204	247	68	Wallis en Futuna
2205	247	76	Wallis e Futuna
2206	248	15	Antarktika
2207	248	20	Antártida
2208	248	22	جنوبگان
2209	248	27	Antarctique
2210	248	33	Antarktika
2211	248	39	Antartide
2212	248	40	南極大陸
2213	248	68	Antarctica
2214	248	76	Antárctida
2215	249	15	Heard und die McDonaldinseln
2216	249	20	Islas Heard y McDonald
2217	249	22	جزیره هرد و جزایر مک‌دونالد
2218	249	27	Îles Heard-et-MacDonald
2219	249	33	Otok Heard i otočje McDonald
2220	249	39	Isole Heard e McDonald
2221	249	40	ハード島とマクドナルド諸島
2222	249	68	Heard- en McDonaldeilanden
2223	249	76	Ilha Heard e Ilhas McDonald
2224	250	15	Bouvetinsel
2225	250	20	Isla Bouvet
2226	250	22	جزیره بووه
2227	250	27	Île Bouvet
2228	250	33	Otok Bouvet
2229	250	39	Isola Bouvet
2230	250	40	ブーベ島
2231	250	68	Bouveteiland
2232	250	76	Ilha Bouvet
\.


--
-- TOC entry 5430 (class 0 OID 17261)
-- Dependencies: 282
-- Data for Name: currency; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.currency (currency_id, currency_code, currency_name, currency_symbol) FROM stdin;
1	AED	United Arab Emirates dirham	د.إ
2	AFN	Afghan afghani	؋
3	ALL	Albanian lek	L
4	AMD	Armenian dram	\N
5	ANG	Netherlands Antillean guilder	ƒ
6	AOA	Angolan kwanza	Kz
7	ARS	Argentine peso	$
8	AUD	Australian dollar	$
9	AWG	Aruban florin	ƒ
10	AZN	Azerbaijani manat	\N
11	BAM	Bosnia and Herzegovina convertible mark	\N
12	BBD	Barbadian dollar	$
13	BDT	Bangladeshi taka	৳
14	BGN	Bulgarian lev	лв
15	BHD	Bahraini dinar	.د.ب
16	BIF	Burundian franc	Fr
17	BMD	Bermudian dollar	$
18	BND	Brunei dollar	$
19	BOB	Bolivian boliviano	Bs.
20	BRL	Brazilian real	R$
21	BSD	Bahamian dollar	$
22	BTN	Bhutanese ngultrum	Nu.
23	BWP	Botswana pula	P
24	BYN	New Belarusian ruble	Br
25	BYR	Old Belarusian ruble	Br
26	BZD	Belize dollar	$
27	CAD	Canadian dollar	$
28	CDF	Congolese franc	Fr
29	CHF	Swiss franc	Fr
30	CKD	Cook Islands dollar	$
31	CLP	Chilean peso	$
32	CNY	Chinese yuan	¥
33	COP	Colombian peso	$
34	CRC	Costa Rican colón	₡
35	CUC	Cuban convertible peso	$
36	CUP	Cuban peso	$
37	CVE	Cape Verdean escudo	Esc
38	CZK	Czech koruna	Kč
39	DJF	Djiboutian franc	Fr
40	DKK	Danish krone	kr
41	DOP	Dominican peso	$
42	DZD	Algerian dinar	د.ج
43	EGP	Egyptian pound	£
44	ERN	Eritrean nakfa	Nfk
45	ETB	Ethiopian birr	Br
46	EUR	Euro	€
47	FJD	Fijian dollar	$
48	FKP	Falkland Islands pound	£
49	GBP	British pound	£
50	GEL	Georgian Lari	ლ
51	GHS	Ghanaian cedi	₵
52	GIP	Gibraltar pound	£
53	GMD	Gambian dalasi	D
54	GNF	Guinean franc	Fr
55	GTQ	Guatemalan quetzal	Q
56	GYD	Guyanese dollar	$
57	HKD	Hong Kong dollar	$
58	HNL	Honduran lempira	L
59	HRK	Croatian kuna	kn
60	HTG	Haitian gourde	G
61	HUF	Hungarian forint	Ft
62	IDR	Indonesian rupiah	Rp
63	ILS	Israeli new shekel	₪
64	ILS	Israeli new sheqel	₪
65	IMP[G]	Manx pound	£
66	INR	Indian rupee	₹
67	IQD	Iraqi dinar	ع.د
68	IRR	Iranian rial	﷼
69	ISK	Icelandic króna	kr
70	JEP[G]	Jersey pound	£
71	JMD	Jamaican dollar	$
72	JOD	Jordanian dinar	د.ا
73	JPY	Japanese yen	¥
74	KES	Kenyan shilling	Sh
75	KGS	Kyrgyzstani som	с
76	KHR	Cambodian riel	៛
77	KMF	Comorian franc	Fr
78	KPW	North Korean won	₩
79	KRW	South Korean won	₩
80	KWD	Kuwaiti dinar	د.ك
81	KYD	Cayman Islands dollar	$
82	KZT	Kazakhstani tenge	\N
83	LAK	Lao kip	₭
84	LBP	Lebanese pound	ل.ل
85	LKR	Sri Lankan rupee	Rs
86	LRD	Liberian dollar	$
87	LSL	Lesotho loti	L
88	LYD	Libyan dinar	ل.د
89	MAD	Moroccan dirham	د.م.
90	MDL	Moldovan leu	L
91	MGA	Malagasy ariary	Ar
92	MKD	Macedonian denar	ден
93	MMK	Burmese kyat	Ks
94	MNT	Mongolian tögrög	₮
95	MOP	Macanese pataca	P
96	MRO	Mauritanian ouguiya	UM
97	MUR	Mauritian rupee	₨
98	MVR	Maldivian rufiyaa	.ރ
99	MWK	Malawian kwacha	MK
100	MXN	Mexican peso	$
101	MYR	Malaysian ringgit	RM
102	MZN	Mozambican metical	MT
103	NAD	Namibian dollar	$
104	NGN	Nigerian naira	₦
105	NIO	Nicaraguan córdoba	C$
106	NOK	Norwegian krone	kr
107	(none)	[E]	$
108	(none)	Faroese króna	kr
109	(none)	Guernsey pound	£
110	(none)	Kiribati dollar	$
111	(none)	Niue dollar	$
112	(none)	\N	$
113	(none)	\N	£
114	(none)	\N	\N
115	NPR	Nepalese rupee	₨
116	NZD	New Zealand dollar	$
117	OMR	Omani rial	ر.ع.
118	PAB	Panamanian balboa	B/.
119	PEN	Peruvian sol	S/.
120	PGK	Papua New Guinean kina	K
121	PHP	Philippine peso	₱
122	PKR	Pakistani rupee	₨
123	PLN	Polish złoty	zł
124	PYG	Paraguayan guaraní	₲
125	QAR	Qatari riyal	ر.ق
126	RON	Romanian leu	lei
127	RSD	Serbian dinar	дин.
128	RUB	Russian ruble	₽
129	RWF	Rwandan franc	Fr
130	SAR	Saudi riyal	ر.س
131	SBD	Solomon Islands dollar	$
132	SCR	Seychellois rupee	₨
133	SDG	Sudanese pound	ج.س.
134	SEK	Swedish krona	kr
135	SGD	Singapore dollar	$
136	SHP	Saint Helena pound	£
137	SLL	Sierra Leonean leone	Le
138	SOS	Somali shilling	Sh
139	SRD	Surinamese dollar	$
140	SSP	South Sudanese pound	£
142	SYP	Syrian pound	£
143	SZL	Swazi lilangeni	L
144	THB	Thai baht	฿
145	TJS	Tajikistani somoni	ЅМ
146	TMT	Turkmenistan manat	m
147	TND	Tunisian dinar	د.ت
148	TOP	Tongan paʻanga	T$
149	TRY	Turkish lira	\N
150	TTD	Trinidad and Tobago dollar	$
151	TVD[G]	Tuvaluan dollar	$
152	TWD	New Taiwan dollar	$
153	TZS	Tanzanian shilling	Sh
154	UAH	Ukrainian hryvnia	₴
155	UGX	Ugandan shilling	Sh
156	USD	United State Dollar	$
157	USD	United States dollar	$
158	USD	United States Dollar	$
159	UYU	Uruguayan peso	$
160	UZS	Uzbekistani so'm	\N
161	VEF	Venezuelan bolívar	Bs F
162	VND	Vietnamese đồng	₫
163	VUV	Vanuatu vatu	Vt
164	WST	Samoan tālā	T
165	XAF	Central African CFA franc	Fr
166	XCD	East Caribbean dollar	$
167	XOF	West African CFA franc	Fr
168	XPF	CFP franc	Fr
169	YER	Yemeni rial	﷼
170	ZAR	South African rand	R
171	ZAR	South African rand	Rs
172	ZMW	Zambian kwacha	ZK
173	\N	[D]	$
174	\N	Pitcairn Islands dollar	$
141	STN	São Tomé and Príncipe dobra	Db
\.


--
-- TOC entry 5387 (class 0 OID 16611)
-- Dependencies: 239
-- Data for Name: dataset; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.dataset (dataset_id, dataset_link, dataset_version, dataset_use, dataset_registerdate, dataset_updatedate, dataset_data) FROM stdin;
1	https://restcountries.eu/rest/v2/all	v2	t	2018-09-15 12:18:28.243751+01	\N	[{"area": 652230.0, "cioc": "AFG", "flag": "https://restcountries.eu/data/afg.svg", "gini": 27.8, "name": "Afghanistan", "latlng": [33.0, 65.0], "region": "Asia", "borders": ["IRN", "PAK", "TKM", "UZB", "TJK", "CHN"], "capital": "Kabul", "demonym": "Afghan", "languages": [{"name": "Pashto", "iso639_1": "ps", "iso639_2": "pus", "nativeName": "پښتو"}, {"name": "Uzbek", "iso639_1": "uz", "iso639_2": "uzb", "nativeName": "Oʻzbek"}, {"name": "Turkmen", "iso639_1": "tk", "iso639_2": "tuk", "nativeName": "Türkmen"}], "subregion": "Southern Asia", "timezones": ["UTC+04:30"], "alpha2Code": "AF", "alpha3Code": "AFG", "currencies": [{"code": "AFN", "name": "Afghan afghani", "symbol": "؋"}], "nativeName": "افغانستان", "population": 27657145, "numericCode": "004", "altSpellings": ["AF", "Afġānistān"], "callingCodes": ["93"], "translations": {"br": "Afeganistão", "de": "Afghanistan", "es": "Afganistán", "fa": "افغانستان", "fr": "Afghanistan", "hr": "Afganistan", "it": "Afghanistan", "ja": "アフガニスタン", "nl": "Afghanistan", "pt": "Afeganistão"}, "regionalBlocs": [{"name": "South Asian Association for Regional Cooperation", "acronym": "SAARC", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".af"]}, {"area": 1580.0, "cioc": "", "flag": "https://restcountries.eu/data/ala.svg", "gini": null, "name": "Åland Islands", "latlng": [60.116667, 19.9], "region": "Europe", "borders": [], "capital": "Mariehamn", "demonym": "Ålandish", "languages": [{"name": "Swedish", "iso639_1": "sv", "iso639_2": "swe", "nativeName": "svenska"}], "subregion": "Northern Europe", "timezones": ["UTC+02:00"], "alpha2Code": "AX", "alpha3Code": "ALA", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Åland", "population": 28875, "numericCode": "248", "altSpellings": ["AX", "Aaland", "Aland", "Ahvenanmaa"], "callingCodes": ["358"], "translations": {"br": "Ilhas de Aland", "de": "Åland", "es": "Alandia", "fa": "جزایر الند", "fr": "Åland", "hr": "Ålandski otoci", "it": "Isole Aland", "ja": "オーランド諸島", "nl": "Ålandeilanden", "pt": "Ilhas de Aland"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".ax"]}, {"area": 28748.0, "cioc": "ALB", "flag": "https://restcountries.eu/data/alb.svg", "gini": 34.5, "name": "Albania", "latlng": [41.0, 20.0], "region": "Europe", "borders": ["MNE", "GRC", "MKD", "KOS"], "capital": "Tirana", "demonym": "Albanian", "languages": [{"name": "Albanian", "iso639_1": "sq", "iso639_2": "sqi", "nativeName": "Shqip"}], "subregion": "Southern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "AL", "alpha3Code": "ALB", "currencies": [{"code": "ALL", "name": "Albanian lek", "symbol": "L"}], "nativeName": "Shqipëria", "population": 2886026, "numericCode": "008", "altSpellings": ["AL", "Shqipëri", "Shqipëria", "Shqipnia"], "callingCodes": ["355"], "translations": {"br": "Albânia", "de": "Albanien", "es": "Albania", "fa": "آلبانی", "fr": "Albanie", "hr": "Albanija", "it": "Albania", "ja": "アルバニア", "nl": "Albanië", "pt": "Albânia"}, "regionalBlocs": [{"name": "Central European Free Trade Agreement", "acronym": "CEFTA", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".al"]}, {"area": 2381741.0, "cioc": "ALG", "flag": "https://restcountries.eu/data/dza.svg", "gini": 35.3, "name": "Algeria", "latlng": [28.0, 3.0], "region": "Africa", "borders": ["TUN", "LBY", "NER", "ESH", "MRT", "MLI", "MAR"], "capital": "Algiers", "demonym": "Algerian", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Northern Africa", "timezones": ["UTC+01:00"], "alpha2Code": "DZ", "alpha3Code": "DZA", "currencies": [{"code": "DZD", "name": "Algerian dinar", "symbol": "د.ج"}], "nativeName": "الجزائر", "population": 40400000, "numericCode": "012", "altSpellings": ["DZ", "Dzayer", "Algérie"], "callingCodes": ["213"], "translations": {"br": "Argélia", "de": "Algerien", "es": "Argelia", "fa": "الجزایر", "fr": "Algérie", "hr": "Alžir", "it": "Algeria", "ja": "アルジェリア", "nl": "Algerije", "pt": "Argélia"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}, {"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".dz"]}, {"area": 199.0, "cioc": "ASA", "flag": "https://restcountries.eu/data/asm.svg", "gini": null, "name": "American Samoa", "latlng": [-14.33333333, -170.0], "region": "Oceania", "borders": [], "capital": "Pago Pago", "demonym": "American Samoan", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Samoan", "iso639_1": "sm", "iso639_2": "smo", "nativeName": "gagana fa'a Samoa"}], "subregion": "Polynesia", "timezones": ["UTC-11:00"], "alpha2Code": "AS", "alpha3Code": "ASM", "currencies": [{"code": "USD", "name": "United State Dollar", "symbol": "$"}], "nativeName": "American Samoa", "population": 57100, "numericCode": "016", "altSpellings": ["AS", "Amerika Sāmoa", "Amelika Sāmoa", "Sāmoa Amelika"], "callingCodes": ["1684"], "translations": {"br": "Samoa Americana", "de": "Amerikanisch-Samoa", "es": "Samoa Americana", "fa": "ساموآی آمریکا", "fr": "Samoa américaines", "hr": "Američka Samoa", "it": "Samoa Americane", "ja": "アメリカ領サモア", "nl": "Amerikaans Samoa", "pt": "Samoa Americana"}, "regionalBlocs": [], "topLevelDomain": [".as"]}, {"area": 468.0, "cioc": "AND", "flag": "https://restcountries.eu/data/and.svg", "gini": null, "name": "Andorra", "latlng": [42.5, 1.5], "region": "Europe", "borders": ["FRA", "ESP"], "capital": "Andorra la Vella", "demonym": "Andorran", "languages": [{"name": "Catalan", "iso639_1": "ca", "iso639_2": "cat", "nativeName": "català"}], "subregion": "Southern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "AD", "alpha3Code": "AND", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Andorra", "population": 78014, "numericCode": "020", "altSpellings": ["AD", "Principality of Andorra", "Principat d'Andorra"], "callingCodes": ["376"], "translations": {"br": "Andorra", "de": "Andorra", "es": "Andorra", "fa": "آندورا", "fr": "Andorre", "hr": "Andora", "it": "Andorra", "ja": "アンドラ", "nl": "Andorra", "pt": "Andorra"}, "regionalBlocs": [], "topLevelDomain": [".ad"]}, {"area": 1246700.0, "cioc": "ANG", "flag": "https://restcountries.eu/data/ago.svg", "gini": 58.6, "name": "Angola", "latlng": [-12.5, 18.5], "region": "Africa", "borders": ["COG", "COD", "ZMB", "NAM"], "capital": "Luanda", "demonym": "Angolan", "languages": [{"name": "Portuguese", "iso639_1": "pt", "iso639_2": "por", "nativeName": "Português"}], "subregion": "Middle Africa", "timezones": ["UTC+01:00"], "alpha2Code": "AO", "alpha3Code": "AGO", "currencies": [{"code": "AOA", "name": "Angolan kwanza", "symbol": "Kz"}], "nativeName": "Angola", "population": 25868000, "numericCode": "024", "altSpellings": ["AO", "República de Angola", "ʁɛpublika de an'ɡɔla"], "callingCodes": ["244"], "translations": {"br": "Angola", "de": "Angola", "es": "Angola", "fa": "آنگولا", "fr": "Angola", "hr": "Angola", "it": "Angola", "ja": "アンゴラ", "nl": "Angola", "pt": "Angola"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".ao"]}, {"area": 91.0, "cioc": "", "flag": "https://restcountries.eu/data/aia.svg", "gini": null, "name": "Anguilla", "latlng": [18.25, -63.16666666], "region": "Americas", "borders": [], "capital": "The Valley", "demonym": "Anguillian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "AI", "alpha3Code": "AIA", "currencies": [{"code": "XCD", "name": "East Caribbean dollar", "symbol": "$"}], "nativeName": "Anguilla", "population": 13452, "numericCode": "660", "altSpellings": ["AI"], "callingCodes": ["1264"], "translations": {"br": "Anguila", "de": "Anguilla", "es": "Anguilla", "fa": "آنگویلا", "fr": "Anguilla", "hr": "Angvila", "it": "Anguilla", "ja": "アンギラ", "nl": "Anguilla", "pt": "Anguila"}, "regionalBlocs": [], "topLevelDomain": [".ai"]}, {"area": 14000000, "cioc": "", "flag": "https://restcountries.eu/data/ata.svg", "gini": null, "name": "Antarctica", "latlng": [-74.65, 4.48], "region": "Polar", "borders": [], "capital": "", "demonym": "", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Russian", "iso639_1": "ru", "iso639_2": "rus", "nativeName": "Русский"}], "subregion": "", "timezones": ["UTC-03:00", "UTC+03:00", "UTC+05:00", "UTC+06:00", "UTC+07:00", "UTC+08:00", "UTC+10:00", "UTC+12:00"], "alpha2Code": "AQ", "alpha3Code": "ATA", "currencies": [{"code": "AUD", "name": "Australian dollar", "symbol": "$"}, {"code": "GBP", "name": "British pound", "symbol": "£"}], "nativeName": "Antarctica", "population": 1000, "numericCode": "010", "altSpellings": [], "callingCodes": ["672"], "translations": {"br": "Antártida", "de": "Antarktika", "es": "Antártida", "fa": "جنوبگان", "fr": "Antarctique", "hr": "Antarktika", "it": "Antartide", "ja": "南極大陸", "nl": "Antarctica", "pt": "Antárctida"}, "regionalBlocs": [], "topLevelDomain": [".aq"]}, {"area": 442.0, "cioc": "ANT", "flag": "https://restcountries.eu/data/atg.svg", "gini": null, "name": "Antigua and Barbuda", "latlng": [17.05, -61.8], "region": "Americas", "borders": [], "capital": "Saint John's", "demonym": "Antiguan, Barbudan", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "AG", "alpha3Code": "ATG", "currencies": [{"code": "XCD", "name": "East Caribbean dollar", "symbol": "$"}], "nativeName": "Antigua and Barbuda", "population": 86295, "numericCode": "028", "altSpellings": ["AG"], "callingCodes": ["1268"], "translations": {"br": "Antígua e Barbuda", "de": "Antigua und Barbuda", "es": "Antigua y Barbuda", "fa": "آنتیگوا و باربودا", "fr": "Antigua-et-Barbuda", "hr": "Antigva i Barbuda", "it": "Antigua e Barbuda", "ja": "アンティグア・バーブーダ", "nl": "Antigua en Barbuda", "pt": "Antígua e Barbuda"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}], "topLevelDomain": [".ag"]}, {"area": 2780400.0, "cioc": "ARG", "flag": "https://restcountries.eu/data/arg.svg", "gini": 44.5, "name": "Argentina", "latlng": [-34.0, -64.0], "region": "Americas", "borders": ["BOL", "BRA", "CHL", "PRY", "URY"], "capital": "Buenos Aires", "demonym": "Argentinean", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}, {"name": "Guaraní", "iso639_1": "gn", "iso639_2": "grn", "nativeName": "Avañe'ẽ"}], "subregion": "South America", "timezones": ["UTC-03:00"], "alpha2Code": "AR", "alpha3Code": "ARG", "currencies": [{"code": "ARS", "name": "Argentine peso", "symbol": "$"}], "nativeName": "Argentina", "population": 43590400, "numericCode": "032", "altSpellings": ["AR", "Argentine Republic", "República Argentina"], "callingCodes": ["54"], "translations": {"br": "Argentina", "de": "Argentinien", "es": "Argentina", "fa": "آرژانتین", "fr": "Argentine", "hr": "Argentina", "it": "Argentina", "ja": "アルゼンチン", "nl": "Argentinië", "pt": "Argentina"}, "regionalBlocs": [{"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}], "topLevelDomain": [".ar"]}, {"area": 29743.0, "cioc": "ARM", "flag": "https://restcountries.eu/data/arm.svg", "gini": 30.9, "name": "Armenia", "latlng": [40.0, 45.0], "region": "Asia", "borders": ["AZE", "GEO", "IRN", "TUR"], "capital": "Yerevan", "demonym": "Armenian", "languages": [{"name": "Armenian", "iso639_1": "hy", "iso639_2": "hye", "nativeName": "Հայերեն"}, {"name": "Russian", "iso639_1": "ru", "iso639_2": "rus", "nativeName": "Русский"}], "subregion": "Western Asia", "timezones": ["UTC+04:00"], "alpha2Code": "AM", "alpha3Code": "ARM", "currencies": [{"code": "AMD", "name": "Armenian dram", "symbol": null}], "nativeName": "Հայաստան", "population": 2994400, "numericCode": "051", "altSpellings": ["AM", "Hayastan", "Republic of Armenia", "Հայաստանի Հանրապետություն"], "callingCodes": ["374"], "translations": {"br": "Armênia", "de": "Armenien", "es": "Armenia", "fa": "ارمنستان", "fr": "Arménie", "hr": "Armenija", "it": "Armenia", "ja": "アルメニア", "nl": "Armenië", "pt": "Arménia"}, "regionalBlocs": [{"name": "Eurasian Economic Union", "acronym": "EEU", "otherNames": [], "otherAcronyms": ["EAEU"]}], "topLevelDomain": [".am"]}, {"area": 180.0, "cioc": "ARU", "flag": "https://restcountries.eu/data/abw.svg", "gini": null, "name": "Aruba", "latlng": [12.5, -69.96666666], "region": "Americas", "borders": [], "capital": "Oranjestad", "demonym": "Aruban", "languages": [{"name": "Dutch", "iso639_1": "nl", "iso639_2": "nld", "nativeName": "Nederlands"}, {"name": "(Eastern) Punjabi", "iso639_1": "pa", "iso639_2": "pan", "nativeName": "ਪੰਜਾਬੀ"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "AW", "alpha3Code": "ABW", "currencies": [{"code": "AWG", "name": "Aruban florin", "symbol": "ƒ"}], "nativeName": "Aruba", "population": 107394, "numericCode": "533", "altSpellings": ["AW"], "callingCodes": ["297"], "translations": {"br": "Aruba", "de": "Aruba", "es": "Aruba", "fa": "آروبا", "fr": "Aruba", "hr": "Aruba", "it": "Aruba", "ja": "アルバ", "nl": "Aruba", "pt": "Aruba"}, "regionalBlocs": [], "topLevelDomain": [".aw"]}, {"area": 7692024.0, "cioc": "AUS", "flag": "https://restcountries.eu/data/aus.svg", "gini": 30.5, "name": "Australia", "latlng": [-27.0, 133.0], "region": "Oceania", "borders": [], "capital": "Canberra", "demonym": "Australian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Australia and New Zealand", "timezones": ["UTC+05:00", "UTC+06:30", "UTC+07:00", "UTC+08:00", "UTC+09:30", "UTC+10:00", "UTC+10:30", "UTC+11:30"], "alpha2Code": "AU", "alpha3Code": "AUS", "currencies": [{"code": "AUD", "name": "Australian dollar", "symbol": "$"}], "nativeName": "Australia", "population": 24117360, "numericCode": "036", "altSpellings": ["AU"], "callingCodes": ["61"], "translations": {"br": "Austrália", "de": "Australien", "es": "Australia", "fa": "استرالیا", "fr": "Australie", "hr": "Australija", "it": "Australia", "ja": "オーストラリア", "nl": "Australië", "pt": "Austrália"}, "regionalBlocs": [], "topLevelDomain": [".au"]}, {"area": 83871.0, "cioc": "AUT", "flag": "https://restcountries.eu/data/aut.svg", "gini": 26.0, "name": "Austria", "latlng": [47.33333333, 13.33333333], "region": "Europe", "borders": ["CZE", "DEU", "HUN", "ITA", "LIE", "SVK", "SVN", "CHE"], "capital": "Vienna", "demonym": "Austrian", "languages": [{"name": "German", "iso639_1": "de", "iso639_2": "deu", "nativeName": "Deutsch"}], "subregion": "Western Europe", "timezones": ["UTC+01:00"], "alpha2Code": "AT", "alpha3Code": "AUT", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Österreich", "population": 8725931, "numericCode": "040", "altSpellings": ["AT", "Österreich", "Osterreich", "Oesterreich"], "callingCodes": ["43"], "translations": {"br": "áustria", "de": "Österreich", "es": "Austria", "fa": "اتریش", "fr": "Autriche", "hr": "Austrija", "it": "Austria", "ja": "オーストリア", "nl": "Oostenrijk", "pt": "áustria"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".at"]}, {"area": 86600.0, "cioc": "AZE", "flag": "https://restcountries.eu/data/aze.svg", "gini": 33.7, "name": "Azerbaijan", "latlng": [40.5, 47.5], "region": "Asia", "borders": ["ARM", "GEO", "IRN", "RUS", "TUR"], "capital": "Baku", "demonym": "Azerbaijani", "languages": [{"name": "Azerbaijani", "iso639_1": "az", "iso639_2": "aze", "nativeName": "azərbaycan dili"}], "subregion": "Western Asia", "timezones": ["UTC+04:00"], "alpha2Code": "AZ", "alpha3Code": "AZE", "currencies": [{"code": "AZN", "name": "Azerbaijani manat", "symbol": null}], "nativeName": "Azərbaycan", "population": 9730500, "numericCode": "031", "altSpellings": ["AZ", "Republic of Azerbaijan", "Azərbaycan Respublikası"], "callingCodes": ["994"], "translations": {"br": "Azerbaijão", "de": "Aserbaidschan", "es": "Azerbaiyán", "fa": "آذربایجان", "fr": "Azerbaïdjan", "hr": "Azerbajdžan", "it": "Azerbaijan", "ja": "アゼルバイジャン", "nl": "Azerbeidzjan", "pt": "Azerbaijão"}, "regionalBlocs": [], "topLevelDomain": [".az"]}, {"area": 13943.0, "cioc": "BAH", "flag": "https://restcountries.eu/data/bhs.svg", "gini": null, "name": "Bahamas", "latlng": [24.25, -76.0], "region": "Americas", "borders": [], "capital": "Nassau", "demonym": "Bahamian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-05:00"], "alpha2Code": "BS", "alpha3Code": "BHS", "currencies": [{"code": "BSD", "name": "Bahamian dollar", "symbol": "$"}], "nativeName": "Bahamas", "population": 378040, "numericCode": "044", "altSpellings": ["BS", "Commonwealth of the Bahamas"], "callingCodes": ["1242"], "translations": {"br": "Bahamas", "de": "Bahamas", "es": "Bahamas", "fa": "باهاما", "fr": "Bahamas", "hr": "Bahami", "it": "Bahamas", "ja": "バハマ", "nl": "Bahama’s", "pt": "Baamas"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}], "topLevelDomain": [".bs"]}, {"area": 765.0, "cioc": "BRN", "flag": "https://restcountries.eu/data/bhr.svg", "gini": null, "name": "Bahrain", "latlng": [26.0, 50.55], "region": "Asia", "borders": [], "capital": "Manama", "demonym": "Bahraini", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Western Asia", "timezones": ["UTC+03:00"], "alpha2Code": "BH", "alpha3Code": "BHR", "currencies": [{"code": "BHD", "name": "Bahraini dinar", "symbol": ".د.ب"}], "nativeName": "‏البحرين", "population": 1404900, "numericCode": "048", "altSpellings": ["BH", "Kingdom of Bahrain", "Mamlakat al-Baḥrayn"], "callingCodes": ["973"], "translations": {"br": "Bahrein", "de": "Bahrain", "es": "Bahrein", "fa": "بحرین", "fr": "Bahreïn", "hr": "Bahrein", "it": "Bahrein", "ja": "バーレーン", "nl": "Bahrein", "pt": "Barém"}, "regionalBlocs": [{"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".bh"]}, {"area": 147570.0, "cioc": "BAN", "flag": "https://restcountries.eu/data/bgd.svg", "gini": 32.1, "name": "Bangladesh", "latlng": [24.0, 90.0], "region": "Asia", "borders": ["MMR", "IND"], "capital": "Dhaka", "demonym": "Bangladeshi", "languages": [{"name": "Bengali", "iso639_1": "bn", "iso639_2": "ben", "nativeName": "বাংলা"}], "subregion": "Southern Asia", "timezones": ["UTC+06:00"], "alpha2Code": "BD", "alpha3Code": "BGD", "currencies": [{"code": "BDT", "name": "Bangladeshi taka", "symbol": "৳"}], "nativeName": "Bangladesh", "population": 161006790, "numericCode": "050", "altSpellings": ["BD", "People's Republic of Bangladesh", "Gônôprôjatôntri Bangladesh"], "callingCodes": ["880"], "translations": {"br": "Bangladesh", "de": "Bangladesch", "es": "Bangladesh", "fa": "بنگلادش", "fr": "Bangladesh", "hr": "Bangladeš", "it": "Bangladesh", "ja": "バングラデシュ", "nl": "Bangladesh", "pt": "Bangladeche"}, "regionalBlocs": [{"name": "South Asian Association for Regional Cooperation", "acronym": "SAARC", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".bd"]}, {"area": 430.0, "cioc": "BAR", "flag": "https://restcountries.eu/data/brb.svg", "gini": null, "name": "Barbados", "latlng": [13.16666666, -59.53333333], "region": "Americas", "borders": [], "capital": "Bridgetown", "demonym": "Barbadian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "BB", "alpha3Code": "BRB", "currencies": [{"code": "BBD", "name": "Barbadian dollar", "symbol": "$"}], "nativeName": "Barbados", "population": 285000, "numericCode": "052", "altSpellings": ["BB"], "callingCodes": ["1246"], "translations": {"br": "Barbados", "de": "Barbados", "es": "Barbados", "fa": "باربادوس", "fr": "Barbade", "hr": "Barbados", "it": "Barbados", "ja": "バルバドス", "nl": "Barbados", "pt": "Barbados"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}], "topLevelDomain": [".bb"]}, {"area": 207600.0, "cioc": "BLR", "flag": "https://restcountries.eu/data/blr.svg", "gini": 26.5, "name": "Belarus", "latlng": [53.0, 28.0], "region": "Europe", "borders": ["LVA", "LTU", "POL", "RUS", "UKR"], "capital": "Minsk", "demonym": "Belarusian", "languages": [{"name": "Belarusian", "iso639_1": "be", "iso639_2": "bel", "nativeName": "беларуская мова"}, {"name": "Russian", "iso639_1": "ru", "iso639_2": "rus", "nativeName": "Русский"}], "subregion": "Eastern Europe", "timezones": ["UTC+03:00"], "alpha2Code": "BY", "alpha3Code": "BLR", "currencies": [{"code": "BYN", "name": "New Belarusian ruble", "symbol": "Br"}, {"code": "BYR", "name": "Old Belarusian ruble", "symbol": "Br"}], "nativeName": "Белару́сь", "population": 9498700, "numericCode": "112", "altSpellings": ["BY", "Bielaruś", "Republic of Belarus", "Белоруссия", "Республика Беларусь", "Belorussiya", "Respublika Belarus’"], "callingCodes": ["375"], "translations": {"br": "Bielorrússia", "de": "Weißrussland", "es": "Bielorrusia", "fa": "بلاروس", "fr": "Biélorussie", "hr": "Bjelorusija", "it": "Bielorussia", "ja": "ベラルーシ", "nl": "Wit-Rusland", "pt": "Bielorrússia"}, "regionalBlocs": [{"name": "Eurasian Economic Union", "acronym": "EEU", "otherNames": [], "otherAcronyms": ["EAEU"]}], "topLevelDomain": [".by"]}, {"area": 30528.0, "cioc": "BEL", "flag": "https://restcountries.eu/data/bel.svg", "gini": 33.0, "name": "Belgium", "latlng": [50.83333333, 4.0], "region": "Europe", "borders": ["FRA", "DEU", "LUX", "NLD"], "capital": "Brussels", "demonym": "Belgian", "languages": [{"name": "Dutch", "iso639_1": "nl", "iso639_2": "nld", "nativeName": "Nederlands"}, {"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "German", "iso639_1": "de", "iso639_2": "deu", "nativeName": "Deutsch"}], "subregion": "Western Europe", "timezones": ["UTC+01:00"], "alpha2Code": "BE", "alpha3Code": "BEL", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "België", "population": 11319511, "numericCode": "056", "altSpellings": ["BE", "België", "Belgie", "Belgien", "Belgique", "Kingdom of Belgium", "Koninkrijk België", "Royaume de Belgique", "Königreich Belgien"], "callingCodes": ["32"], "translations": {"br": "Bélgica", "de": "Belgien", "es": "Bélgica", "fa": "بلژیک", "fr": "Belgique", "hr": "Belgija", "it": "Belgio", "ja": "ベルギー", "nl": "België", "pt": "Bélgica"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".be"]}, {"area": 22966.0, "cioc": "BIZ", "flag": "https://restcountries.eu/data/blz.svg", "gini": 53.1, "name": "Belize", "latlng": [17.25, -88.75], "region": "Americas", "borders": ["GTM", "MEX"], "capital": "Belmopan", "demonym": "Belizean", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "Central America", "timezones": ["UTC-06:00"], "alpha2Code": "BZ", "alpha3Code": "BLZ", "currencies": [{"code": "BZD", "name": "Belize dollar", "symbol": "$"}], "nativeName": "Belize", "population": 370300, "numericCode": "084", "altSpellings": ["BZ"], "callingCodes": ["501"], "translations": {"br": "Belize", "de": "Belize", "es": "Belice", "fa": "بلیز", "fr": "Belize", "hr": "Belize", "it": "Belize", "ja": "ベリーズ", "nl": "Belize", "pt": "Belize"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}, {"name": "Central American Integration System", "acronym": "CAIS", "otherNames": ["Sistema de la Integración Centroamericana,"], "otherAcronyms": ["SICA"]}], "topLevelDomain": [".bz"]}, {"area": 112622.0, "cioc": "BEN", "flag": "https://restcountries.eu/data/ben.svg", "gini": 38.6, "name": "Benin", "latlng": [9.5, 2.25], "region": "Africa", "borders": ["BFA", "NER", "NGA", "TGO"], "capital": "Porto-Novo", "demonym": "Beninese", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Western Africa", "timezones": ["UTC+01:00"], "alpha2Code": "BJ", "alpha3Code": "BEN", "currencies": [{"code": "XOF", "name": "West African CFA franc", "symbol": "Fr"}], "nativeName": "Bénin", "population": 10653654, "numericCode": "204", "altSpellings": ["BJ", "Republic of Benin", "République du Bénin"], "callingCodes": ["229"], "translations": {"br": "Benin", "de": "Benin", "es": "Benín", "fa": "بنین", "fr": "Bénin", "hr": "Benin", "it": "Benin", "ja": "ベナン", "nl": "Benin", "pt": "Benim"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".bj"]}, {"area": 54.0, "cioc": "BER", "flag": "https://restcountries.eu/data/bmu.svg", "gini": null, "name": "Bermuda", "latlng": [32.33333333, -64.75], "region": "Americas", "borders": [], "capital": "Hamilton", "demonym": "Bermudian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Northern America", "timezones": ["UTC-04:00"], "alpha2Code": "BM", "alpha3Code": "BMU", "currencies": [{"code": "BMD", "name": "Bermudian dollar", "symbol": "$"}], "nativeName": "Bermuda", "population": 61954, "numericCode": "060", "altSpellings": ["BM", "The Islands of Bermuda", "The Bermudas", "Somers Isles"], "callingCodes": ["1441"], "translations": {"br": "Bermudas", "de": "Bermuda", "es": "Bermudas", "fa": "برمودا", "fr": "Bermudes", "hr": "Bermudi", "it": "Bermuda", "ja": "バミューダ", "nl": "Bermuda", "pt": "Bermudas"}, "regionalBlocs": [], "topLevelDomain": [".bm"]}, {"area": 38394.0, "cioc": "BHU", "flag": "https://restcountries.eu/data/btn.svg", "gini": 38.1, "name": "Bhutan", "latlng": [27.5, 90.5], "region": "Asia", "borders": ["CHN", "IND"], "capital": "Thimphu", "demonym": "Bhutanese", "languages": [{"name": "Dzongkha", "iso639_1": "dz", "iso639_2": "dzo", "nativeName": "རྫོང་ཁ"}], "subregion": "Southern Asia", "timezones": ["UTC+06:00"], "alpha2Code": "BT", "alpha3Code": "BTN", "currencies": [{"code": "BTN", "name": "Bhutanese ngultrum", "symbol": "Nu."}, {"code": "INR", "name": "Indian rupee", "symbol": "₹"}], "nativeName": "ʼbrug-yul", "population": 775620, "numericCode": "064", "altSpellings": ["BT", "Kingdom of Bhutan"], "callingCodes": ["975"], "translations": {"br": "Butão", "de": "Bhutan", "es": "Bután", "fa": "بوتان", "fr": "Bhoutan", "hr": "Butan", "it": "Bhutan", "ja": "ブータン", "nl": "Bhutan", "pt": "Butão"}, "regionalBlocs": [{"name": "South Asian Association for Regional Cooperation", "acronym": "SAARC", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".bt"]}, {"area": 1098581.0, "cioc": "BOL", "flag": "https://restcountries.eu/data/bol.svg", "gini": 56.3, "name": "Bolivia (Plurinational State of)", "latlng": [-17.0, -65.0], "region": "Americas", "borders": ["ARG", "BRA", "CHL", "PRY", "PER"], "capital": "Sucre", "demonym": "Bolivian", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}, {"name": "Aymara", "iso639_1": "ay", "iso639_2": "aym", "nativeName": "aymar aru"}, {"name": "Quechua", "iso639_1": "qu", "iso639_2": "que", "nativeName": "Runa Simi"}], "subregion": "South America", "timezones": ["UTC-04:00"], "alpha2Code": "BO", "alpha3Code": "BOL", "currencies": [{"code": "BOB", "name": "Bolivian boliviano", "symbol": "Bs."}], "nativeName": "Bolivia", "population": 10985059, "numericCode": "068", "altSpellings": ["BO", "Buliwya", "Wuliwya", "Plurinational State of Bolivia", "Estado Plurinacional de Bolivia", "Buliwya Mamallaqta", "Wuliwya Suyu", "Tetã Volívia"], "callingCodes": ["591"], "translations": {"br": "Bolívia", "de": "Bolivien", "es": "Bolivia", "fa": "بولیوی", "fr": "Bolivie", "hr": "Bolivija", "it": "Bolivia", "ja": "ボリビア多民族国", "nl": "Bolivia", "pt": "Bolívia"}, "regionalBlocs": [{"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}], "topLevelDomain": [".bo"]}, {"area": 294.0, "cioc": null, "flag": "https://restcountries.eu/data/bes.svg", "gini": null, "name": "Bonaire, Sint Eustatius and Saba", "latlng": [12.15, -68.266667], "region": "Americas", "borders": [], "capital": "Kralendijk", "demonym": "Dutch", "languages": [{"name": "Dutch", "iso639_1": "nl", "iso639_2": "nld", "nativeName": "Nederlands"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "BQ", "alpha3Code": "BES", "currencies": [{"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "Bonaire", "population": 17408, "numericCode": "535", "altSpellings": ["BQ", "Boneiru"], "callingCodes": ["5997"], "translations": {"br": "Bonaire", "de": "Bonaire, Sint Eustatius und Saba", "es": null, "fa": "بونیر", "fr": "Bonaire, Saint-Eustache et Saba", "hr": null, "it": "Bonaire, Saint-Eustache e Saba", "ja": null, "nl": null, "pt": "Bonaire"}, "regionalBlocs": [], "topLevelDomain": [".an", ".nl"]}, {"area": 51209.0, "cioc": "BIH", "flag": "https://restcountries.eu/data/bih.svg", "gini": 36.2, "name": "Bosnia and Herzegovina", "latlng": [44.0, 18.0], "region": "Europe", "borders": ["HRV", "MNE", "SRB"], "capital": "Sarajevo", "demonym": "Bosnian, Herzegovinian", "languages": [{"name": "Bosnian", "iso639_1": "bs", "iso639_2": "bos", "nativeName": "bosanski jezik"}, {"name": "Croatian", "iso639_1": "hr", "iso639_2": "hrv", "nativeName": "hrvatski jezik"}, {"name": "Serbian", "iso639_1": "sr", "iso639_2": "srp", "nativeName": "српски језик"}], "subregion": "Southern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "BA", "alpha3Code": "BIH", "currencies": [{"code": "BAM", "name": "Bosnia and Herzegovina convertible mark", "symbol": null}], "nativeName": "Bosna i Hercegovina", "population": 3531159, "numericCode": "070", "altSpellings": ["BA", "Bosnia-Herzegovina", "Босна и Херцеговина"], "callingCodes": ["387"], "translations": {"br": "Bósnia e Herzegovina", "de": "Bosnien und Herzegowina", "es": "Bosnia y Herzegovina", "fa": "بوسنی و هرزگوین", "fr": "Bosnie-Herzégovine", "hr": "Bosna i Hercegovina", "it": "Bosnia ed Erzegovina", "ja": "ボスニア・ヘルツェゴビナ", "nl": "Bosnië en Herzegovina", "pt": "Bósnia e Herzegovina"}, "regionalBlocs": [{"name": "Central European Free Trade Agreement", "acronym": "CEFTA", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".ba"]}, {"area": 582000.0, "cioc": "BOT", "flag": "https://restcountries.eu/data/bwa.svg", "gini": 61.0, "name": "Botswana", "latlng": [-22.0, 24.0], "region": "Africa", "borders": ["NAM", "ZAF", "ZMB", "ZWE"], "capital": "Gaborone", "demonym": "Motswana", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Tswana", "iso639_1": "tn", "iso639_2": "tsn", "nativeName": "Setswana"}], "subregion": "Southern Africa", "timezones": ["UTC+02:00"], "alpha2Code": "BW", "alpha3Code": "BWA", "currencies": [{"code": "BWP", "name": "Botswana pula", "symbol": "P"}], "nativeName": "Botswana", "population": 2141206, "numericCode": "072", "altSpellings": ["BW", "Republic of Botswana", "Lefatshe la Botswana"], "callingCodes": ["267"], "translations": {"br": "Botsuana", "de": "Botswana", "es": "Botswana", "fa": "بوتسوانا", "fr": "Botswana", "hr": "Bocvana", "it": "Botswana", "ja": "ボツワナ", "nl": "Botswana", "pt": "Botsuana"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".bw"]}, {"area": 49.0, "cioc": "", "flag": "https://restcountries.eu/data/bvt.svg", "gini": null, "name": "Bouvet Island", "latlng": [-54.43333333, 3.4], "region": "", "borders": [], "capital": "", "demonym": "", "languages": [{"name": "Norwegian", "iso639_1": "no", "iso639_2": "nor", "nativeName": "Norsk"}, {"name": "Norwegian Bokmål", "iso639_1": "nb", "iso639_2": "nob", "nativeName": "Norsk bokmål"}, {"name": "Norwegian Nynorsk", "iso639_1": "nn", "iso639_2": "nno", "nativeName": "Norsk nynorsk"}], "subregion": "", "timezones": ["UTC+01:00"], "alpha2Code": "BV", "alpha3Code": "BVT", "currencies": [{"code": "NOK", "name": "Norwegian krone", "symbol": "kr"}], "nativeName": "Bouvetøya", "population": 0, "numericCode": "074", "altSpellings": ["BV", "Bouvetøya", "Bouvet-øya"], "callingCodes": [""], "translations": {"br": "Ilha Bouvet", "de": "Bouvetinsel", "es": "Isla Bouvet", "fa": "جزیره بووه", "fr": "Île Bouvet", "hr": "Otok Bouvet", "it": "Isola Bouvet", "ja": "ブーベ島", "nl": "Bouveteiland", "pt": "Ilha Bouvet"}, "regionalBlocs": [], "topLevelDomain": [".bv"]}, {"area": 8515767.0, "cioc": "BRA", "flag": "https://restcountries.eu/data/bra.svg", "gini": 54.7, "name": "Brazil", "latlng": [-10.0, -55.0], "region": "Americas", "borders": ["ARG", "BOL", "COL", "GUF", "GUY", "PRY", "PER", "SUR", "URY", "VEN"], "capital": "Brasília", "demonym": "Brazilian", "languages": [{"name": "Portuguese", "iso639_1": "pt", "iso639_2": "por", "nativeName": "Português"}], "subregion": "South America", "timezones": ["UTC-05:00", "UTC-04:00", "UTC-03:00", "UTC-02:00"], "alpha2Code": "BR", "alpha3Code": "BRA", "currencies": [{"code": "BRL", "name": "Brazilian real", "symbol": "R$"}], "nativeName": "Brasil", "population": 206135893, "numericCode": "076", "altSpellings": ["BR", "Brasil", "Federative Republic of Brazil", "República Federativa do Brasil"], "callingCodes": ["55"], "translations": {"br": "Brasil", "de": "Brasilien", "es": "Brasil", "fa": "برزیل", "fr": "Brésil", "hr": "Brazil", "it": "Brasile", "ja": "ブラジル", "nl": "Brazilië", "pt": "Brasil"}, "regionalBlocs": [{"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}], "topLevelDomain": [".br"]}, {"area": 60.0, "cioc": "", "flag": "https://restcountries.eu/data/iot.svg", "gini": null, "name": "British Indian Ocean Territory", "latlng": [-6.0, 71.5], "region": "Africa", "borders": [], "capital": "Diego Garcia", "demonym": "Indian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Eastern Africa", "timezones": ["UTC+06:00"], "alpha2Code": "IO", "alpha3Code": "IOT", "currencies": [{"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "British Indian Ocean Territory", "population": 3000, "numericCode": "086", "altSpellings": ["IO"], "callingCodes": ["246"], "translations": {"br": "Território Britânico do Oceano íÍdico", "de": "Britisches Territorium im Indischen Ozean", "es": "Territorio Británico del Océano Índico", "fa": "قلمرو بریتانیا در اقیانوس هند", "fr": "Territoire britannique de l'océan Indien", "hr": "Britanski Indijskooceanski teritorij", "it": "Territorio britannico dell'oceano indiano", "ja": "イギリス領インド洋地域", "nl": "Britse Gebieden in de Indische Oceaan", "pt": "Território Britânico do Oceano Índico"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".io"]}, {"area": null, "cioc": "", "flag": "https://restcountries.eu/data/umi.svg", "gini": null, "name": "United States Minor Outlying Islands", "latlng": [], "region": "Americas", "borders": [], "capital": "", "demonym": "American", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Northern America", "timezones": ["UTC-11:00", "UTC-10:00", "UTC+12:00"], "alpha2Code": "UM", "alpha3Code": "UMI", "currencies": [{"code": "USD", "name": "United States Dollar", "symbol": "$"}], "nativeName": "United States Minor Outlying Islands", "population": 300, "numericCode": "581", "altSpellings": ["UM"], "callingCodes": [""], "translations": {"br": "Ilhas Menores Distantes dos Estados Unidos", "de": "Kleinere Inselbesitzungen der Vereinigten Staaten", "es": "Islas Ultramarinas Menores de Estados Unidos", "fa": "جزایر کوچک حاشیه‌ای ایالات متحده آمریکا", "fr": "Îles mineures éloignées des États-Unis", "hr": "Mali udaljeni otoci SAD-a", "it": "Isole minori esterne degli Stati Uniti d'America", "ja": "合衆国領有小離島", "nl": "Kleine afgelegen eilanden van de Verenigde Staten", "pt": "Ilhas Menores Distantes dos Estados Unidos"}, "regionalBlocs": [], "topLevelDomain": [".us"]}, {"area": 151.0, "cioc": "IVB", "flag": "https://restcountries.eu/data/vgb.svg", "gini": null, "name": "Virgin Islands (British)", "latlng": [18.431383, -64.62305], "region": "Americas", "borders": [], "capital": "Road Town", "demonym": "Virgin Islander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "VG", "alpha3Code": "VGB", "currencies": [{"code": null, "name": "[D]", "symbol": "$"}, {"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "British Virgin Islands", "population": 28514, "numericCode": "092", "altSpellings": ["VG"], "callingCodes": ["1284"], "translations": {"br": "Ilhas Virgens Britânicas", "de": "Britische Jungferninseln", "es": "Islas Vírgenes del Reino Unido", "fa": "جزایر ویرجین بریتانیا", "fr": "Îles Vierges britanniques", "hr": "Britanski Djevičanski Otoci", "it": "Isole Vergini Britanniche", "ja": "イギリス領ヴァージン諸島", "nl": "Britse Maagdeneilanden", "pt": "Ilhas Virgens Britânicas"}, "regionalBlocs": [], "topLevelDomain": [".vg"]}, {"area": 346.36, "cioc": "ISV", "flag": "https://restcountries.eu/data/vir.svg", "gini": null, "name": "Virgin Islands (U.S.)", "latlng": [18.34, -64.93], "region": "Americas", "borders": [], "capital": "Charlotte Amalie", "demonym": "Virgin Islander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "VI", "alpha3Code": "VIR", "currencies": [{"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "Virgin Islands of the United States", "population": 114743, "numericCode": "850", "altSpellings": ["VI", "USVI", "American Virgin Islands", "U.S. Virgin Islands"], "callingCodes": ["1 340"], "translations": {"br": "Ilhas Virgens Americanas", "de": "Amerikanische Jungferninseln", "es": "Islas Vírgenes de los Estados Unidos", "fa": "جزایر ویرجین آمریکا", "fr": "Îles Vierges des États-Unis", "hr": null, "it": "Isole Vergini americane", "ja": "アメリカ領ヴァージン諸島", "nl": "Verenigde Staten Maagdeneilanden", "pt": "Ilhas Virgens Americanas"}, "regionalBlocs": [], "topLevelDomain": [".vi"]}, {"area": 5765.0, "cioc": "BRU", "flag": "https://restcountries.eu/data/brn.svg", "gini": null, "name": "Brunei Darussalam", "latlng": [4.5, 114.66666666], "region": "Asia", "borders": ["MYS"], "capital": "Bandar Seri Begawan", "demonym": "Bruneian", "languages": [{"name": "Malay", "iso639_1": "ms", "iso639_2": "msa", "nativeName": "bahasa Melayu"}], "subregion": "South-Eastern Asia", "timezones": ["UTC+08:00"], "alpha2Code": "BN", "alpha3Code": "BRN", "currencies": [{"code": "BND", "name": "Brunei dollar", "symbol": "$"}, {"code": "SGD", "name": "Singapore dollar", "symbol": "$"}], "nativeName": "Negara Brunei Darussalam", "population": 411900, "numericCode": "096", "altSpellings": ["BN", "Nation of Brunei", " the Abode of Peace"], "callingCodes": ["673"], "translations": {"br": "Brunei", "de": "Brunei", "es": "Brunei", "fa": "برونئی", "fr": "Brunei", "hr": "Brunej", "it": "Brunei", "ja": "ブルネイ・ダルサラーム", "nl": "Brunei", "pt": "Brunei"}, "regionalBlocs": [{"name": "Association of Southeast Asian Nations", "acronym": "ASEAN", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".bn"]}, {"area": 110879.0, "cioc": "BUL", "flag": "https://restcountries.eu/data/bgr.svg", "gini": 28.2, "name": "Bulgaria", "latlng": [43.0, 25.0], "region": "Europe", "borders": ["GRC", "MKD", "ROU", "SRB", "TUR"], "capital": "Sofia", "demonym": "Bulgarian", "languages": [{"name": "Bulgarian", "iso639_1": "bg", "iso639_2": "bul", "nativeName": "български език"}], "subregion": "Eastern Europe", "timezones": ["UTC+02:00"], "alpha2Code": "BG", "alpha3Code": "BGR", "currencies": [{"code": "BGN", "name": "Bulgarian lev", "symbol": "лв"}], "nativeName": "България", "population": 7153784, "numericCode": "100", "altSpellings": ["BG", "Republic of Bulgaria", "Република България"], "callingCodes": ["359"], "translations": {"br": "Bulgária", "de": "Bulgarien", "es": "Bulgaria", "fa": "بلغارستان", "fr": "Bulgarie", "hr": "Bugarska", "it": "Bulgaria", "ja": "ブルガリア", "nl": "Bulgarije", "pt": "Bulgária"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".bg"]}, {"area": 272967.0, "cioc": "BUR", "flag": "https://restcountries.eu/data/bfa.svg", "gini": 39.8, "name": "Burkina Faso", "latlng": [13.0, -2.0], "region": "Africa", "borders": ["BEN", "CIV", "GHA", "MLI", "NER", "TGO"], "capital": "Ouagadougou", "demonym": "Burkinabe", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "Fula", "iso639_1": "ff", "iso639_2": "ful", "nativeName": "Fulfulde"}], "subregion": "Western Africa", "timezones": ["UTC"], "alpha2Code": "BF", "alpha3Code": "BFA", "currencies": [{"code": "XOF", "name": "West African CFA franc", "symbol": "Fr"}], "nativeName": "Burkina Faso", "population": 19034397, "numericCode": "854", "altSpellings": ["BF"], "callingCodes": ["226"], "translations": {"br": "Burkina Faso", "de": "Burkina Faso", "es": "Burkina Faso", "fa": "بورکینافاسو", "fr": "Burkina Faso", "hr": "Burkina Faso", "it": "Burkina Faso", "ja": "ブルキナファソ", "nl": "Burkina Faso", "pt": "Burquina Faso"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".bf"]}, {"area": 27834.0, "cioc": "BDI", "flag": "https://restcountries.eu/data/bdi.svg", "gini": 33.3, "name": "Burundi", "latlng": [-3.5, 30.0], "region": "Africa", "borders": ["COD", "RWA", "TZA"], "capital": "Bujumbura", "demonym": "Burundian", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "Kirundi", "iso639_1": "rn", "iso639_2": "run", "nativeName": "Ikirundi"}], "subregion": "Eastern Africa", "timezones": ["UTC+02:00"], "alpha2Code": "BI", "alpha3Code": "BDI", "currencies": [{"code": "BIF", "name": "Burundian franc", "symbol": "Fr"}], "nativeName": "Burundi", "population": 10114505, "numericCode": "108", "altSpellings": ["BI", "Republic of Burundi", "Republika y'Uburundi", "République du Burundi"], "callingCodes": ["257"], "translations": {"br": "Burundi", "de": "Burundi", "es": "Burundi", "fa": "بوروندی", "fr": "Burundi", "hr": "Burundi", "it": "Burundi", "ja": "ブルンジ", "nl": "Burundi", "pt": "Burúndi"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".bi"]}, {"area": 181035.0, "cioc": "CAM", "flag": "https://restcountries.eu/data/khm.svg", "gini": 37.9, "name": "Cambodia", "latlng": [13.0, 105.0], "region": "Asia", "borders": ["LAO", "THA", "VNM"], "capital": "Phnom Penh", "demonym": "Cambodian", "languages": [{"name": "Khmer", "iso639_1": "km", "iso639_2": "khm", "nativeName": "ខ្មែរ"}], "subregion": "South-Eastern Asia", "timezones": ["UTC+07:00"], "alpha2Code": "KH", "alpha3Code": "KHM", "currencies": [{"code": "KHR", "name": "Cambodian riel", "symbol": "៛"}, {"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "Kâmpŭchéa", "population": 15626444, "numericCode": "116", "altSpellings": ["KH", "Kingdom of Cambodia"], "callingCodes": ["855"], "translations": {"br": "Camboja", "de": "Kambodscha", "es": "Camboya", "fa": "کامبوج", "fr": "Cambodge", "hr": "Kambodža", "it": "Cambogia", "ja": "カンボジア", "nl": "Cambodja", "pt": "Camboja"}, "regionalBlocs": [{"name": "Association of Southeast Asian Nations", "acronym": "ASEAN", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".kh"]}, {"area": 475442.0, "cioc": "CMR", "flag": "https://restcountries.eu/data/cmr.svg", "gini": 38.9, "name": "Cameroon", "latlng": [6.0, 12.0], "region": "Africa", "borders": ["CAF", "TCD", "COG", "GNQ", "GAB", "NGA"], "capital": "Yaoundé", "demonym": "Cameroonian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Middle Africa", "timezones": ["UTC+01:00"], "alpha2Code": "CM", "alpha3Code": "CMR", "currencies": [{"code": "XAF", "name": "Central African CFA franc", "symbol": "Fr"}], "nativeName": "Cameroon", "population": 22709892, "numericCode": "120", "altSpellings": ["CM", "Republic of Cameroon", "République du Cameroun"], "callingCodes": ["237"], "translations": {"br": "Camarões", "de": "Kamerun", "es": "Camerún", "fa": "کامرون", "fr": "Cameroun", "hr": "Kamerun", "it": "Camerun", "ja": "カメルーン", "nl": "Kameroen", "pt": "Camarões"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".cm"]}, {"area": 9984670.0, "cioc": "CAN", "flag": "https://restcountries.eu/data/can.svg", "gini": 32.6, "name": "Canada", "latlng": [60.0, -95.0], "region": "Americas", "borders": ["USA"], "capital": "Ottawa", "demonym": "Canadian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Northern America", "timezones": ["UTC-08:00", "UTC-07:00", "UTC-06:00", "UTC-05:00", "UTC-04:00", "UTC-03:30"], "alpha2Code": "CA", "alpha3Code": "CAN", "currencies": [{"code": "CAD", "name": "Canadian dollar", "symbol": "$"}], "nativeName": "Canada", "population": 36155487, "numericCode": "124", "altSpellings": ["CA"], "callingCodes": ["1"], "translations": {"br": "Canadá", "de": "Kanada", "es": "Canadá", "fa": "کانادا", "fr": "Canada", "hr": "Kanada", "it": "Canada", "ja": "カナダ", "nl": "Canada", "pt": "Canadá"}, "regionalBlocs": [{"name": "North American Free Trade Agreement", "acronym": "NAFTA", "otherNames": ["Tratado de Libre Comercio de América del Norte", "Accord de Libre-échange Nord-Américain"], "otherAcronyms": []}], "topLevelDomain": [".ca"]}, {"area": 4033.0, "cioc": "CPV", "flag": "https://restcountries.eu/data/cpv.svg", "gini": 50.5, "name": "Cabo Verde", "latlng": [16.0, -24.0], "region": "Africa", "borders": [], "capital": "Praia", "demonym": "Cape Verdian", "languages": [{"name": "Portuguese", "iso639_1": "pt", "iso639_2": "por", "nativeName": "Português"}], "subregion": "Western Africa", "timezones": ["UTC-01:00"], "alpha2Code": "CV", "alpha3Code": "CPV", "currencies": [{"code": "CVE", "name": "Cape Verdean escudo", "symbol": "Esc"}], "nativeName": "Cabo Verde", "population": 531239, "numericCode": "132", "altSpellings": ["CV", "Republic of Cabo Verde", "República de Cabo Verde"], "callingCodes": ["238"], "translations": {"br": "Cabo Verde", "de": "Kap Verde", "es": "Cabo Verde", "fa": "کیپ ورد", "fr": "Cap Vert", "hr": "Zelenortska Republika", "it": "Capo Verde", "ja": "カーボベルデ", "nl": "Kaapverdië", "pt": "Cabo Verde"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".cv"]}, {"area": 264.0, "cioc": "CAY", "flag": "https://restcountries.eu/data/cym.svg", "gini": null, "name": "Cayman Islands", "latlng": [19.5, -80.5], "region": "Americas", "borders": [], "capital": "George Town", "demonym": "Caymanian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-05:00"], "alpha2Code": "KY", "alpha3Code": "CYM", "currencies": [{"code": "KYD", "name": "Cayman Islands dollar", "symbol": "$"}], "nativeName": "Cayman Islands", "population": 58238, "numericCode": "136", "altSpellings": ["KY"], "callingCodes": ["1345"], "translations": {"br": "Ilhas Cayman", "de": "Kaimaninseln", "es": "Islas Caimán", "fa": "جزایر کیمن", "fr": "Îles Caïmans", "hr": "Kajmanski otoci", "it": "Isole Cayman", "ja": "ケイマン諸島", "nl": "Caymaneilanden", "pt": "Ilhas Caimão"}, "regionalBlocs": [], "topLevelDomain": [".ky"]}, {"area": 622984.0, "cioc": "CAF", "flag": "https://restcountries.eu/data/caf.svg", "gini": 56.3, "name": "Central African Republic", "latlng": [7.0, 21.0], "region": "Africa", "borders": ["CMR", "TCD", "COD", "COG", "SSD", "SDN"], "capital": "Bangui", "demonym": "Central African", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "Sango", "iso639_1": "sg", "iso639_2": "sag", "nativeName": "yângâ tî sängö"}], "subregion": "Middle Africa", "timezones": ["UTC+01:00"], "alpha2Code": "CF", "alpha3Code": "CAF", "currencies": [{"code": "XAF", "name": "Central African CFA franc", "symbol": "Fr"}], "nativeName": "Ködörösêse tî Bêafrîka", "population": 4998000, "numericCode": "140", "altSpellings": ["CF", "Central African Republic", "République centrafricaine"], "callingCodes": ["236"], "translations": {"br": "República Centro-Africana", "de": "Zentralafrikanische Republik", "es": "República Centroafricana", "fa": "جمهوری آفریقای مرکزی", "fr": "République centrafricaine", "hr": "Srednjoafrička Republika", "it": "Repubblica Centrafricana", "ja": "中央アフリカ共和国", "nl": "Centraal-Afrikaanse Republiek", "pt": "República Centro-Africana"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".cf"]}, {"area": 1284000.0, "cioc": "CHA", "flag": "https://restcountries.eu/data/tcd.svg", "gini": 39.8, "name": "Chad", "latlng": [15.0, 19.0], "region": "Africa", "borders": ["CMR", "CAF", "LBY", "NER", "NGA", "SSD"], "capital": "N'Djamena", "demonym": "Chadian", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Middle Africa", "timezones": ["UTC+01:00"], "alpha2Code": "TD", "alpha3Code": "TCD", "currencies": [{"code": "XAF", "name": "Central African CFA franc", "symbol": "Fr"}], "nativeName": "Tchad", "population": 14497000, "numericCode": "148", "altSpellings": ["TD", "Tchad", "Republic of Chad", "République du Tchad"], "callingCodes": ["235"], "translations": {"br": "Chade", "de": "Tschad", "es": "Chad", "fa": "چاد", "fr": "Tchad", "hr": "Čad", "it": "Ciad", "ja": "チャド", "nl": "Tsjaad", "pt": "Chade"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".td"]}, {"area": 756102.0, "cioc": "CHI", "flag": "https://restcountries.eu/data/chl.svg", "gini": 52.1, "name": "Chile", "latlng": [-30.0, -71.0], "region": "Americas", "borders": ["ARG", "BOL", "PER"], "capital": "Santiago", "demonym": "Chilean", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "South America", "timezones": ["UTC-06:00", "UTC-04:00"], "alpha2Code": "CL", "alpha3Code": "CHL", "currencies": [{"code": "CLP", "name": "Chilean peso", "symbol": "$"}], "nativeName": "Chile", "population": 18191900, "numericCode": "152", "altSpellings": ["CL", "Republic of Chile", "República de Chile"], "callingCodes": ["56"], "translations": {"br": "Chile", "de": "Chile", "es": "Chile", "fa": "شیلی", "fr": "Chili", "hr": "Čile", "it": "Cile", "ja": "チリ", "nl": "Chili", "pt": "Chile"}, "regionalBlocs": [{"name": "Pacific Alliance", "acronym": "PA", "otherNames": ["Alianza del Pacífico"], "otherAcronyms": []}, {"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}], "topLevelDomain": [".cl"]}, {"area": 9640011.0, "cioc": "CHN", "flag": "https://restcountries.eu/data/chn.svg", "gini": 47.0, "name": "China", "latlng": [35.0, 105.0], "region": "Asia", "borders": ["AFG", "BTN", "MMR", "HKG", "IND", "KAZ", "PRK", "KGZ", "LAO", "MAC", "MNG", "PAK", "RUS", "TJK", "VNM"], "capital": "Beijing", "demonym": "Chinese", "languages": [{"name": "Chinese", "iso639_1": "zh", "iso639_2": "zho", "nativeName": "中文 (Zhōngwén)"}], "subregion": "Eastern Asia", "timezones": ["UTC+08:00"], "alpha2Code": "CN", "alpha3Code": "CHN", "currencies": [{"code": "CNY", "name": "Chinese yuan", "symbol": "¥"}], "nativeName": "中国", "population": 1377422166, "numericCode": "156", "altSpellings": ["CN", "Zhōngguó", "Zhongguo", "Zhonghua", "People's Republic of China", "中华人民共和国", "Zhōnghuá Rénmín Gònghéguó"], "callingCodes": ["86"], "translations": {"br": "China", "de": "China", "es": "China", "fa": "چین", "fr": "Chine", "hr": "Kina", "it": "Cina", "ja": "中国", "nl": "China", "pt": "China"}, "regionalBlocs": [], "topLevelDomain": [".cn"]}, {"area": 135.0, "cioc": "", "flag": "https://restcountries.eu/data/cxr.svg", "gini": null, "name": "Christmas Island", "latlng": [-10.5, 105.66666666], "region": "Oceania", "borders": [], "capital": "Flying Fish Cove", "demonym": "Christmas Island", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Australia and New Zealand", "timezones": ["UTC+07:00"], "alpha2Code": "CX", "alpha3Code": "CXR", "currencies": [{"code": "AUD", "name": "Australian dollar", "symbol": "$"}], "nativeName": "Christmas Island", "population": 2072, "numericCode": "162", "altSpellings": ["CX", "Territory of Christmas Island"], "callingCodes": ["61"], "translations": {"br": "Ilha Christmas", "de": "Weihnachtsinsel", "es": "Isla de Navidad", "fa": "جزیره کریسمس", "fr": "Île Christmas", "hr": "Božićni otok", "it": "Isola di Natale", "ja": "クリスマス島", "nl": "Christmaseiland", "pt": "Ilha do Natal"}, "regionalBlocs": [], "topLevelDomain": [".cx"]}, {"area": 14.0, "cioc": "", "flag": "https://restcountries.eu/data/cck.svg", "gini": null, "name": "Cocos (Keeling) Islands", "latlng": [-12.5, 96.83333333], "region": "Oceania", "borders": [], "capital": "West Island", "demonym": "Cocos Islander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Australia and New Zealand", "timezones": ["UTC+06:30"], "alpha2Code": "CC", "alpha3Code": "CCK", "currencies": [{"code": "AUD", "name": "Australian dollar", "symbol": "$"}], "nativeName": "Cocos (Keeling) Islands", "population": 550, "numericCode": "166", "altSpellings": ["CC", "Territory of the Cocos (Keeling) Islands", "Keeling Islands"], "callingCodes": ["61"], "translations": {"br": "Ilhas Cocos", "de": "Kokosinseln", "es": "Islas Cocos o Islas Keeling", "fa": "جزایر کوکوس", "fr": "Îles Cocos", "hr": "Kokosovi Otoci", "it": "Isole Cocos e Keeling", "ja": "ココス（キーリング）諸島", "nl": "Cocoseilanden", "pt": "Ilhas dos Cocos"}, "regionalBlocs": [], "topLevelDomain": [".cc"]}, {"area": 1141748.0, "cioc": "COL", "flag": "https://restcountries.eu/data/col.svg", "gini": 55.9, "name": "Colombia", "latlng": [4.0, -72.0], "region": "Americas", "borders": ["BRA", "ECU", "PAN", "PER", "VEN"], "capital": "Bogotá", "demonym": "Colombian", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "South America", "timezones": ["UTC-05:00"], "alpha2Code": "CO", "alpha3Code": "COL", "currencies": [{"code": "COP", "name": "Colombian peso", "symbol": "$"}], "nativeName": "Colombia", "population": 48759958, "numericCode": "170", "altSpellings": ["CO", "Republic of Colombia", "República de Colombia"], "callingCodes": ["57"], "translations": {"br": "Colômbia", "de": "Kolumbien", "es": "Colombia", "fa": "کلمبیا", "fr": "Colombie", "hr": "Kolumbija", "it": "Colombia", "ja": "コロンビア", "nl": "Colombia", "pt": "Colômbia"}, "regionalBlocs": [{"name": "Pacific Alliance", "acronym": "PA", "otherNames": ["Alianza del Pacífico"], "otherAcronyms": []}, {"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}], "topLevelDomain": [".co"]}, {"area": 1862.0, "cioc": "COM", "flag": "https://restcountries.eu/data/com.svg", "gini": 64.3, "name": "Comoros", "latlng": [-12.16666666, 44.25], "region": "Africa", "borders": [], "capital": "Moroni", "demonym": "Comoran", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}, {"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Eastern Africa", "timezones": ["UTC+03:00"], "alpha2Code": "KM", "alpha3Code": "COM", "currencies": [{"code": "KMF", "name": "Comorian franc", "symbol": "Fr"}], "nativeName": "Komori", "population": 806153, "numericCode": "174", "altSpellings": ["KM", "Union of the Comoros", "Union des Comores", "Udzima wa Komori", "al-Ittiḥād al-Qumurī"], "callingCodes": ["269"], "translations": {"br": "Comores", "de": "Union der Komoren", "es": "Comoras", "fa": "کومور", "fr": "Comores", "hr": "Komori", "it": "Comore", "ja": "コモロ", "nl": "Comoren", "pt": "Comores"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}, {"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".km"]}, {"area": 342000.0, "cioc": "CGO", "flag": "https://restcountries.eu/data/cog.svg", "gini": 47.3, "name": "Congo", "latlng": [-1.0, 15.0], "region": "Africa", "borders": ["AGO", "CMR", "CAF", "COD", "GAB"], "capital": "Brazzaville", "demonym": "Congolese", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "Lingala", "iso639_1": "ln", "iso639_2": "lin", "nativeName": "Lingála"}], "subregion": "Middle Africa", "timezones": ["UTC+01:00"], "alpha2Code": "CG", "alpha3Code": "COG", "currencies": [{"code": "XAF", "name": "Central African CFA franc", "symbol": "Fr"}], "nativeName": "République du Congo", "population": 4741000, "numericCode": "178", "altSpellings": ["CG", "Congo-Brazzaville"], "callingCodes": ["242"], "translations": {"br": "Congo", "de": "Kongo", "es": "Congo", "fa": "کنگو", "fr": "Congo", "hr": "Kongo", "it": "Congo", "ja": "コンゴ共和国", "nl": "Congo [Republiek]", "pt": "Congo"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".cg"]}, {"area": 2344858.0, "cioc": "COD", "flag": "https://restcountries.eu/data/cod.svg", "gini": null, "name": "Congo (Democratic Republic of the)", "latlng": [0.0, 25.0], "region": "Africa", "borders": ["AGO", "BDI", "CAF", "COG", "RWA", "SSD", "TZA", "UGA", "ZMB"], "capital": "Kinshasa", "demonym": "Congolese", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "Lingala", "iso639_1": "ln", "iso639_2": "lin", "nativeName": "Lingála"}, {"name": "Kongo", "iso639_1": "kg", "iso639_2": "kon", "nativeName": "Kikongo"}, {"name": "Swahili", "iso639_1": "sw", "iso639_2": "swa", "nativeName": "Kiswahili"}, {"name": "Luba-Katanga", "iso639_1": "lu", "iso639_2": "lub", "nativeName": "Tshiluba"}], "subregion": "Middle Africa", "timezones": ["UTC+01:00", "UTC+02:00"], "alpha2Code": "CD", "alpha3Code": "COD", "currencies": [{"code": "CDF", "name": "Congolese franc", "symbol": "Fr"}], "nativeName": "République démocratique du Congo", "population": 85026000, "numericCode": "180", "altSpellings": ["CD", "DR Congo", "Congo-Kinshasa", "DRC"], "callingCodes": ["243"], "translations": {"br": "RD Congo", "de": "Kongo (Dem. Rep.)", "es": "Congo (Rep. Dem.)", "fa": "جمهوری کنگو", "fr": "Congo (Rép. dém.)", "hr": "Kongo, Demokratska Republika", "it": "Congo (Rep. Dem.)", "ja": "コンゴ民主共和国", "nl": "Congo [DRC]", "pt": "RD Congo"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".cd"]}, {"area": 236.0, "cioc": "COK", "flag": "https://restcountries.eu/data/cok.svg", "gini": null, "name": "Cook Islands", "latlng": [-21.23333333, -159.76666666], "region": "Oceania", "borders": [], "capital": "Avarua", "demonym": "Cook Islander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Polynesia", "timezones": ["UTC-10:00"], "alpha2Code": "CK", "alpha3Code": "COK", "currencies": [{"code": "NZD", "name": "New Zealand dollar", "symbol": "$"}, {"code": "CKD", "name": "Cook Islands dollar", "symbol": "$"}], "nativeName": "Cook Islands", "population": 18100, "numericCode": "184", "altSpellings": ["CK", "Kūki 'Āirani"], "callingCodes": ["682"], "translations": {"br": "Ilhas Cook", "de": "Cookinseln", "es": "Islas Cook", "fa": "جزایر کوک", "fr": "Îles Cook", "hr": "Cookovo Otočje", "it": "Isole Cook", "ja": "クック諸島", "nl": "Cookeilanden", "pt": "Ilhas Cook"}, "regionalBlocs": [], "topLevelDomain": [".ck"]}, {"area": 51100.0, "cioc": "CRC", "flag": "https://restcountries.eu/data/cri.svg", "gini": 50.7, "name": "Costa Rica", "latlng": [10.0, -84.0], "region": "Americas", "borders": ["NIC", "PAN"], "capital": "San José", "demonym": "Costa Rican", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "Central America", "timezones": ["UTC-06:00"], "alpha2Code": "CR", "alpha3Code": "CRI", "currencies": [{"code": "CRC", "name": "Costa Rican colón", "symbol": "₡"}], "nativeName": "Costa Rica", "population": 4890379, "numericCode": "188", "altSpellings": ["CR", "Republic of Costa Rica", "República de Costa Rica"], "callingCodes": ["506"], "translations": {"br": "Costa Rica", "de": "Costa Rica", "es": "Costa Rica", "fa": "کاستاریکا", "fr": "Costa Rica", "hr": "Kostarika", "it": "Costa Rica", "ja": "コスタリカ", "nl": "Costa Rica", "pt": "Costa Rica"}, "regionalBlocs": [{"name": "Central American Integration System", "acronym": "CAIS", "otherNames": ["Sistema de la Integración Centroamericana,"], "otherAcronyms": ["SICA"]}], "topLevelDomain": [".cr"]}, {"area": 56594.0, "cioc": "CRO", "flag": "https://restcountries.eu/data/hrv.svg", "gini": 33.7, "name": "Croatia", "latlng": [45.16666666, 15.5], "region": "Europe", "borders": ["BIH", "HUN", "MNE", "SRB", "SVN"], "capital": "Zagreb", "demonym": "Croatian", "languages": [{"name": "Croatian", "iso639_1": "hr", "iso639_2": "hrv", "nativeName": "hrvatski jezik"}], "subregion": "Southern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "HR", "alpha3Code": "HRV", "currencies": [{"code": "HRK", "name": "Croatian kuna", "symbol": "kn"}], "nativeName": "Hrvatska", "population": 4190669, "numericCode": "191", "altSpellings": ["HR", "Hrvatska", "Republic of Croatia", "Republika Hrvatska"], "callingCodes": ["385"], "translations": {"br": "Croácia", "de": "Kroatien", "es": "Croacia", "fa": "کرواسی", "fr": "Croatie", "hr": "Hrvatska", "it": "Croazia", "ja": "クロアチア", "nl": "Kroatië", "pt": "Croácia"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".hr"]}, {"area": 109884.0, "cioc": "CUB", "flag": "https://restcountries.eu/data/cub.svg", "gini": null, "name": "Cuba", "latlng": [21.5, -80.0], "region": "Americas", "borders": [], "capital": "Havana", "demonym": "Cuban", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "Caribbean", "timezones": ["UTC-05:00"], "alpha2Code": "CU", "alpha3Code": "CUB", "currencies": [{"code": "CUC", "name": "Cuban convertible peso", "symbol": "$"}, {"code": "CUP", "name": "Cuban peso", "symbol": "$"}], "nativeName": "Cuba", "population": 11239004, "numericCode": "192", "altSpellings": ["CU", "Republic of Cuba", "República de Cuba"], "callingCodes": ["53"], "translations": {"br": "Cuba", "de": "Kuba", "es": "Cuba", "fa": "کوبا", "fr": "Cuba", "hr": "Kuba", "it": "Cuba", "ja": "キューバ", "nl": "Cuba", "pt": "Cuba"}, "regionalBlocs": [], "topLevelDomain": [".cu"]}, {"area": 444.0, "cioc": "", "flag": "https://restcountries.eu/data/cuw.svg", "gini": null, "name": "Curaçao", "latlng": [12.116667, -68.933333], "region": "Americas", "borders": [], "capital": "Willemstad", "demonym": "Dutch", "languages": [{"name": "Dutch", "iso639_1": "nl", "iso639_2": "nld", "nativeName": "Nederlands"}, {"name": "(Eastern) Punjabi", "iso639_1": "pa", "iso639_2": "pan", "nativeName": "ਪੰਜਾਬੀ"}, {"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "CW", "alpha3Code": "CUW", "currencies": [{"code": "ANG", "name": "Netherlands Antillean guilder", "symbol": "ƒ"}], "nativeName": "Curaçao", "population": 154843, "numericCode": "531", "altSpellings": ["CW", "Curacao", "Kòrsou", "Country of Curaçao", "Land Curaçao", "Pais Kòrsou"], "callingCodes": ["599"], "translations": {"br": "Curaçao", "de": "Curaçao", "es": null, "fa": "کوراسائو", "fr": "Curaçao", "hr": null, "it": "Curaçao", "ja": null, "nl": "Curaçao", "pt": "Curaçao"}, "regionalBlocs": [], "topLevelDomain": [".cw"]}, {"area": 9251.0, "cioc": "CYP", "flag": "https://restcountries.eu/data/cyp.svg", "gini": null, "name": "Cyprus", "latlng": [35.0, 33.0], "region": "Europe", "borders": ["GBR"], "capital": "Nicosia", "demonym": "Cypriot", "languages": [{"name": "Greek (modern)", "iso639_1": "el", "iso639_2": "ell", "nativeName": "ελληνικά"}, {"name": "Turkish", "iso639_1": "tr", "iso639_2": "tur", "nativeName": "Türkçe"}, {"name": "Armenian", "iso639_1": "hy", "iso639_2": "hye", "nativeName": "Հայերեն"}], "subregion": "Southern Europe", "timezones": ["UTC+02:00"], "alpha2Code": "CY", "alpha3Code": "CYP", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Κύπρος", "population": 847000, "numericCode": "196", "altSpellings": ["CY", "Kýpros", "Kıbrıs", "Republic of Cyprus", "Κυπριακή Δημοκρατία", "Kıbrıs Cumhuriyeti"], "callingCodes": ["357"], "translations": {"br": "Chipre", "de": "Zypern", "es": "Chipre", "fa": "قبرس", "fr": "Chypre", "hr": "Cipar", "it": "Cipro", "ja": "キプロス", "nl": "Cyprus", "pt": "Chipre"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".cy"]}, {"area": 78865.0, "cioc": "CZE", "flag": "https://restcountries.eu/data/cze.svg", "gini": 26.0, "name": "Czech Republic", "latlng": [49.75, 15.5], "region": "Europe", "borders": ["AUT", "DEU", "POL", "SVK"], "capital": "Prague", "demonym": "Czech", "languages": [{"name": "Czech", "iso639_1": "cs", "iso639_2": "ces", "nativeName": "čeština"}, {"name": "Slovak", "iso639_1": "sk", "iso639_2": "slk", "nativeName": "slovenčina"}], "subregion": "Eastern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "CZ", "alpha3Code": "CZE", "currencies": [{"code": "CZK", "name": "Czech koruna", "symbol": "Kč"}], "nativeName": "Česká republika", "population": 10558524, "numericCode": "203", "altSpellings": ["CZ", "Česká republika", "Česko"], "callingCodes": ["420"], "translations": {"br": "República Tcheca", "de": "Tschechische Republik", "es": "República Checa", "fa": "جمهوری چک", "fr": "République tchèque", "hr": "Češka", "it": "Repubblica Ceca", "ja": "チェコ", "nl": "Tsjechië", "pt": "República Checa"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".cz"]}, {"area": 43094.0, "cioc": "DEN", "flag": "https://restcountries.eu/data/dnk.svg", "gini": 24.0, "name": "Denmark", "latlng": [56.0, 10.0], "region": "Europe", "borders": ["DEU"], "capital": "Copenhagen", "demonym": "Danish", "languages": [{"name": "Danish", "iso639_1": "da", "iso639_2": "dan", "nativeName": "dansk"}], "subregion": "Northern Europe", "timezones": ["UTC-04:00", "UTC-03:00", "UTC-01:00", "UTC", "UTC+01:00"], "alpha2Code": "DK", "alpha3Code": "DNK", "currencies": [{"code": "DKK", "name": "Danish krone", "symbol": "kr"}], "nativeName": "Danmark", "population": 5717014, "numericCode": "208", "altSpellings": ["DK", "Danmark", "Kingdom of Denmark", "Kongeriget Danmark"], "callingCodes": ["45"], "translations": {"br": "Dinamarca", "de": "Dänemark", "es": "Dinamarca", "fa": "دانمارک", "fr": "Danemark", "hr": "Danska", "it": "Danimarca", "ja": "デンマーク", "nl": "Denemarken", "pt": "Dinamarca"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".dk"]}, {"area": 23200.0, "cioc": "DJI", "flag": "https://restcountries.eu/data/dji.svg", "gini": 40.0, "name": "Djibouti", "latlng": [11.5, 43.0], "region": "Africa", "borders": ["ERI", "ETH", "SOM"], "capital": "Djibouti", "demonym": "Djibouti", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Eastern Africa", "timezones": ["UTC+03:00"], "alpha2Code": "DJ", "alpha3Code": "DJI", "currencies": [{"code": "DJF", "name": "Djiboutian franc", "symbol": "Fr"}], "nativeName": "Djibouti", "population": 900000, "numericCode": "262", "altSpellings": ["DJ", "Jabuuti", "Gabuuti", "Republic of Djibouti", "République de Djibouti", "Gabuutih Ummuuno", "Jamhuuriyadda Jabuuti"], "callingCodes": ["253"], "translations": {"br": "Djibuti", "de": "Dschibuti", "es": "Yibuti", "fa": "جیبوتی", "fr": "Djibouti", "hr": "Džibuti", "it": "Gibuti", "ja": "ジブチ", "nl": "Djibouti", "pt": "Djibuti"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}, {"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".dj"]}, {"area": 751.0, "cioc": "DMA", "flag": "https://restcountries.eu/data/dma.svg", "gini": null, "name": "Dominica", "latlng": [15.41666666, -61.33333333], "region": "Americas", "borders": [], "capital": "Roseau", "demonym": "Dominican", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "DM", "alpha3Code": "DMA", "currencies": [{"code": "XCD", "name": "East Caribbean dollar", "symbol": "$"}], "nativeName": "Dominica", "population": 71293, "numericCode": "212", "altSpellings": ["DM", "Dominique", "Wai‘tu kubuli", "Commonwealth of Dominica"], "callingCodes": ["1767"], "translations": {"br": "Dominica", "de": "Dominica", "es": "Dominica", "fa": "دومینیکا", "fr": "Dominique", "hr": "Dominika", "it": "Dominica", "ja": "ドミニカ国", "nl": "Dominica", "pt": "Dominica"}, "regionalBlocs": [], "topLevelDomain": [".dm"]}, {"area": 48671.0, "cioc": "DOM", "flag": "https://restcountries.eu/data/dom.svg", "gini": 47.2, "name": "Dominican Republic", "latlng": [19.0, -70.66666666], "region": "Americas", "borders": ["HTI"], "capital": "Santo Domingo", "demonym": "Dominican", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "DO", "alpha3Code": "DOM", "currencies": [{"code": "DOP", "name": "Dominican peso", "symbol": "$"}], "nativeName": "República Dominicana", "population": 10075045, "numericCode": "214", "altSpellings": ["DO"], "callingCodes": ["1809", "1829", "1849"], "translations": {"br": "República Dominicana", "de": "Dominikanische Republik", "es": "República Dominicana", "fa": "جمهوری دومینیکن", "fr": "République dominicaine", "hr": "Dominikanska Republika", "it": "Repubblica Dominicana", "ja": "ドミニカ共和国", "nl": "Dominicaanse Republiek", "pt": "República Dominicana"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}, {"name": "Central American Integration System", "acronym": "CAIS", "otherNames": ["Sistema de la Integración Centroamericana,"], "otherAcronyms": ["SICA"]}], "topLevelDomain": [".do"]}, {"area": 276841.0, "cioc": "ECU", "flag": "https://restcountries.eu/data/ecu.svg", "gini": 49.3, "name": "Ecuador", "latlng": [-2.0, -77.5], "region": "Americas", "borders": ["COL", "PER"], "capital": "Quito", "demonym": "Ecuadorean", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "South America", "timezones": ["UTC-06:00", "UTC-05:00"], "alpha2Code": "EC", "alpha3Code": "ECU", "currencies": [{"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "Ecuador", "population": 16545799, "numericCode": "218", "altSpellings": ["EC", "Republic of Ecuador", "República del Ecuador"], "callingCodes": ["593"], "translations": {"br": "Equador", "de": "Ecuador", "es": "Ecuador", "fa": "اکوادور", "fr": "Équateur", "hr": "Ekvador", "it": "Ecuador", "ja": "エクアドル", "nl": "Ecuador", "pt": "Equador"}, "regionalBlocs": [{"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}], "topLevelDomain": [".ec"]}, {"area": 1002450.0, "cioc": "EGY", "flag": "https://restcountries.eu/data/egy.svg", "gini": 30.8, "name": "Egypt", "latlng": [27.0, 30.0], "region": "Africa", "borders": ["ISR", "LBY", "SDN"], "capital": "Cairo", "demonym": "Egyptian", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Northern Africa", "timezones": ["UTC+02:00"], "alpha2Code": "EG", "alpha3Code": "EGY", "currencies": [{"code": "EGP", "name": "Egyptian pound", "symbol": "£"}], "nativeName": "مصر‎", "population": 91290000, "numericCode": "818", "altSpellings": ["EG", "Arab Republic of Egypt"], "callingCodes": ["20"], "translations": {"br": "Egito", "de": "Ägypten", "es": "Egipto", "fa": "مصر", "fr": "Égypte", "hr": "Egipat", "it": "Egitto", "ja": "エジプト", "nl": "Egypte", "pt": "Egipto"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}, {"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".eg"]}, {"area": 21041.0, "cioc": "ESA", "flag": "https://restcountries.eu/data/slv.svg", "gini": 48.3, "name": "El Salvador", "latlng": [13.83333333, -88.91666666], "region": "Americas", "borders": ["GTM", "HND"], "capital": "San Salvador", "demonym": "Salvadoran", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "Central America", "timezones": ["UTC-06:00"], "alpha2Code": "SV", "alpha3Code": "SLV", "currencies": [{"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "El Salvador", "population": 6520675, "numericCode": "222", "altSpellings": ["SV", "Republic of El Salvador", "República de El Salvador"], "callingCodes": ["503"], "translations": {"br": "El Salvador", "de": "El Salvador", "es": "El Salvador", "fa": "السالوادور", "fr": "Salvador", "hr": "Salvador", "it": "El Salvador", "ja": "エルサルバドル", "nl": "El Salvador", "pt": "El Salvador"}, "regionalBlocs": [{"name": "Central American Integration System", "acronym": "CAIS", "otherNames": ["Sistema de la Integración Centroamericana,"], "otherAcronyms": ["SICA"]}], "topLevelDomain": [".sv"]}, {"area": 28051.0, "cioc": "GEQ", "flag": "https://restcountries.eu/data/gnq.svg", "gini": null, "name": "Equatorial Guinea", "latlng": [2.0, 10.0], "region": "Africa", "borders": ["CMR", "GAB"], "capital": "Malabo", "demonym": "Equatorial Guinean", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}, {"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Middle Africa", "timezones": ["UTC+01:00"], "alpha2Code": "GQ", "alpha3Code": "GNQ", "currencies": [{"code": "XAF", "name": "Central African CFA franc", "symbol": "Fr"}], "nativeName": "Guinea Ecuatorial", "population": 1222442, "numericCode": "226", "altSpellings": ["GQ", "Republic of Equatorial Guinea", "República de Guinea Ecuatorial", "République de Guinée équatoriale", "República da Guiné Equatorial"], "callingCodes": ["240"], "translations": {"br": "Guiné Equatorial", "de": "Äquatorial-Guinea", "es": "Guinea Ecuatorial", "fa": "گینه استوایی", "fr": "Guinée-Équatoriale", "hr": "Ekvatorijalna Gvineja", "it": "Guinea Equatoriale", "ja": "赤道ギニア", "nl": "Equatoriaal-Guinea", "pt": "Guiné Equatorial"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".gq"]}, {"area": 117600.0, "cioc": "ERI", "flag": "https://restcountries.eu/data/eri.svg", "gini": null, "name": "Eritrea", "latlng": [15.0, 39.0], "region": "Africa", "borders": ["DJI", "ETH", "SDN"], "capital": "Asmara", "demonym": "Eritrean", "languages": [{"name": "Tigrinya", "iso639_1": "ti", "iso639_2": "tir", "nativeName": "ትግርኛ"}, {"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}, {"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Eastern Africa", "timezones": ["UTC+03:00"], "alpha2Code": "ER", "alpha3Code": "ERI", "currencies": [{"code": "ERN", "name": "Eritrean nakfa", "symbol": "Nfk"}], "nativeName": "ኤርትራ", "population": 5352000, "numericCode": "232", "altSpellings": ["ER", "State of Eritrea", "ሃገረ ኤርትራ", "Dawlat Iritriyá", "ʾErtrā", "Iritriyā", ""], "callingCodes": ["291"], "translations": {"br": "Eritreia", "de": "Eritrea", "es": "Eritrea", "fa": "اریتره", "fr": "Érythrée", "hr": "Eritreja", "it": "Eritrea", "ja": "エリトリア", "nl": "Eritrea", "pt": "Eritreia"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".er"]}, {"area": 45227.0, "cioc": "EST", "flag": "https://restcountries.eu/data/est.svg", "gini": 36.0, "name": "Estonia", "latlng": [59.0, 26.0], "region": "Europe", "borders": ["LVA", "RUS"], "capital": "Tallinn", "demonym": "Estonian", "languages": [{"name": "Estonian", "iso639_1": "et", "iso639_2": "est", "nativeName": "eesti"}], "subregion": "Northern Europe", "timezones": ["UTC+02:00"], "alpha2Code": "EE", "alpha3Code": "EST", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Eesti", "population": 1315944, "numericCode": "233", "altSpellings": ["EE", "Eesti", "Republic of Estonia", "Eesti Vabariik"], "callingCodes": ["372"], "translations": {"br": "Estônia", "de": "Estland", "es": "Estonia", "fa": "استونی", "fr": "Estonie", "hr": "Estonija", "it": "Estonia", "ja": "エストニア", "nl": "Estland", "pt": "Estónia"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".ee"]}, {"area": 1104300.0, "cioc": "ETH", "flag": "https://restcountries.eu/data/eth.svg", "gini": 29.8, "name": "Ethiopia", "latlng": [8.0, 38.0], "region": "Africa", "borders": ["DJI", "ERI", "KEN", "SOM", "SSD", "SDN"], "capital": "Addis Ababa", "demonym": "Ethiopian", "languages": [{"name": "Amharic", "iso639_1": "am", "iso639_2": "amh", "nativeName": "አማርኛ"}], "subregion": "Eastern Africa", "timezones": ["UTC+03:00"], "alpha2Code": "ET", "alpha3Code": "ETH", "currencies": [{"code": "ETB", "name": "Ethiopian birr", "symbol": "Br"}], "nativeName": "ኢትዮጵያ", "population": 92206005, "numericCode": "231", "altSpellings": ["ET", "ʾĪtyōṗṗyā", "Federal Democratic Republic of Ethiopia", "የኢትዮጵያ ፌዴራላዊ ዲሞክራሲያዊ ሪፐብሊክ"], "callingCodes": ["251"], "translations": {"br": "Etiópia", "de": "Äthiopien", "es": "Etiopía", "fa": "اتیوپی", "fr": "Éthiopie", "hr": "Etiopija", "it": "Etiopia", "ja": "エチオピア", "nl": "Ethiopië", "pt": "Etiópia"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".et"]}, {"area": 12173.0, "cioc": "", "flag": "https://restcountries.eu/data/flk.svg", "gini": null, "name": "Falkland Islands (Malvinas)", "latlng": [-51.75, -59.0], "region": "Americas", "borders": [], "capital": "Stanley", "demonym": "Falkland Islander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "South America", "timezones": ["UTC-04:00"], "alpha2Code": "FK", "alpha3Code": "FLK", "currencies": [{"code": "FKP", "name": "Falkland Islands pound", "symbol": "£"}], "nativeName": "Falkland Islands", "population": 2563, "numericCode": "238", "altSpellings": ["FK", "Islas Malvinas"], "callingCodes": ["500"], "translations": {"br": "Ilhas Malvinas", "de": "Falklandinseln", "es": "Islas Malvinas", "fa": "جزایر فالکلند", "fr": "Îles Malouines", "hr": "Falklandski Otoci", "it": "Isole Falkland o Isole Malvine", "ja": "フォークランド（マルビナス）諸島", "nl": "Falklandeilanden [Islas Malvinas]", "pt": "Ilhas Falkland"}, "regionalBlocs": [{"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}], "topLevelDomain": [".fk"]}, {"area": 1393.0, "cioc": "", "flag": "https://restcountries.eu/data/fro.svg", "gini": null, "name": "Faroe Islands", "latlng": [62.0, -7.0], "region": "Europe", "borders": [], "capital": "Tórshavn", "demonym": "Faroese", "languages": [{"name": "Faroese", "iso639_1": "fo", "iso639_2": "fao", "nativeName": "føroyskt"}], "subregion": "Northern Europe", "timezones": ["UTC+00:00"], "alpha2Code": "FO", "alpha3Code": "FRO", "currencies": [{"code": "DKK", "name": "Danish krone", "symbol": "kr"}, {"code": "(none)", "name": "Faroese króna", "symbol": "kr"}], "nativeName": "Føroyar", "population": 49376, "numericCode": "234", "altSpellings": ["FO", "Føroyar", "Færøerne"], "callingCodes": ["298"], "translations": {"br": "Ilhas Faroé", "de": "Färöer-Inseln", "es": "Islas Faroe", "fa": "جزایر فارو", "fr": "Îles Féroé", "hr": "Farski Otoci", "it": "Isole Far Oer", "ja": "フェロー諸島", "nl": "Faeröer", "pt": "Ilhas Faroé"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".fo"]}, {"area": 18272.0, "cioc": "FIJ", "flag": "https://restcountries.eu/data/fji.svg", "gini": 42.8, "name": "Fiji", "latlng": [-18.0, 175.0], "region": "Oceania", "borders": [], "capital": "Suva", "demonym": "Fijian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Fijian", "iso639_1": "fj", "iso639_2": "fij", "nativeName": "vosa Vakaviti"}, {"name": "Hindi", "iso639_1": "hi", "iso639_2": "hin", "nativeName": "हिन्दी"}, {"name": "Urdu", "iso639_1": "ur", "iso639_2": "urd", "nativeName": "اردو"}], "subregion": "Melanesia", "timezones": ["UTC+12:00"], "alpha2Code": "FJ", "alpha3Code": "FJI", "currencies": [{"code": "FJD", "name": "Fijian dollar", "symbol": "$"}], "nativeName": "Fiji", "population": 867000, "numericCode": "242", "altSpellings": ["FJ", "Viti", "Republic of Fiji", "Matanitu ko Viti", "Fijī Gaṇarājya"], "callingCodes": ["679"], "translations": {"br": "Fiji", "de": "Fidschi", "es": "Fiyi", "fa": "فیجی", "fr": "Fidji", "hr": "Fiđi", "it": "Figi", "ja": "フィジー", "nl": "Fiji", "pt": "Fiji"}, "regionalBlocs": [], "topLevelDomain": [".fj"]}, {"area": 338424.0, "cioc": "FIN", "flag": "https://restcountries.eu/data/fin.svg", "gini": 26.9, "name": "Finland", "latlng": [64.0, 26.0], "region": "Europe", "borders": ["NOR", "SWE", "RUS"], "capital": "Helsinki", "demonym": "Finnish", "languages": [{"name": "Finnish", "iso639_1": "fi", "iso639_2": "fin", "nativeName": "suomi"}, {"name": "Swedish", "iso639_1": "sv", "iso639_2": "swe", "nativeName": "svenska"}], "subregion": "Northern Europe", "timezones": ["UTC+02:00"], "alpha2Code": "FI", "alpha3Code": "FIN", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Suomi", "population": 5491817, "numericCode": "246", "altSpellings": ["FI", "Suomi", "Republic of Finland", "Suomen tasavalta", "Republiken Finland"], "callingCodes": ["358"], "translations": {"br": "Finlândia", "de": "Finnland", "es": "Finlandia", "fa": "فنلاند", "fr": "Finlande", "hr": "Finska", "it": "Finlandia", "ja": "フィンランド", "nl": "Finland", "pt": "Finlândia"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".fi"]}, {"area": 640679.0, "cioc": "FRA", "flag": "https://restcountries.eu/data/fra.svg", "gini": 32.7, "name": "France", "latlng": [46.0, 2.0], "region": "Europe", "borders": ["AND", "BEL", "DEU", "ITA", "LUX", "MCO", "ESP", "CHE"], "capital": "Paris", "demonym": "French", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Western Europe", "timezones": ["UTC-10:00", "UTC-09:30", "UTC-09:00", "UTC-08:00", "UTC-04:00", "UTC-03:00", "UTC+01:00", "UTC+03:00", "UTC+04:00", "UTC+05:00", "UTC+11:00", "UTC+12:00"], "alpha2Code": "FR", "alpha3Code": "FRA", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "France", "population": 66710000, "numericCode": "250", "altSpellings": ["FR", "French Republic", "République française"], "callingCodes": ["33"], "translations": {"br": "França", "de": "Frankreich", "es": "Francia", "fa": "فرانسه", "fr": "France", "hr": "Francuska", "it": "Francia", "ja": "フランス", "nl": "Frankrijk", "pt": "França"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".fr"]}, {"area": null, "cioc": "", "flag": "https://restcountries.eu/data/guf.svg", "gini": null, "name": "French Guiana", "latlng": [4.0, -53.0], "region": "Americas", "borders": ["BRA", "SUR"], "capital": "Cayenne", "demonym": "", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "South America", "timezones": ["UTC-03:00"], "alpha2Code": "GF", "alpha3Code": "GUF", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Guyane française", "population": 254541, "numericCode": "254", "altSpellings": ["GF", "Guiana", "Guyane"], "callingCodes": ["594"], "translations": {"br": "Guiana Francesa", "de": "Französisch Guyana", "es": "Guayana Francesa", "fa": "گویان فرانسه", "fr": "Guayane", "hr": "Francuska Gvajana", "it": "Guyana francese", "ja": "フランス領ギアナ", "nl": "Frans-Guyana", "pt": "Guiana Francesa"}, "regionalBlocs": [{"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}, {"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".gf"]}, {"area": 4167.0, "cioc": "", "flag": "https://restcountries.eu/data/pyf.svg", "gini": null, "name": "French Polynesia", "latlng": [-15.0, -140.0], "region": "Oceania", "borders": [], "capital": "Papeetē", "demonym": "French Polynesian", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Polynesia", "timezones": ["UTC-10:00", "UTC-09:30", "UTC-09:00"], "alpha2Code": "PF", "alpha3Code": "PYF", "currencies": [{"code": "XPF", "name": "CFP franc", "symbol": "Fr"}], "nativeName": "Polynésie française", "population": 271800, "numericCode": "258", "altSpellings": ["PF", "Polynésie française", "French Polynesia", "Pōrīnetia Farāni"], "callingCodes": ["689"], "translations": {"br": "Polinésia Francesa", "de": "Französisch-Polynesien", "es": "Polinesia Francesa", "fa": "پلی‌نزی فرانسه", "fr": "Polynésie française", "hr": "Francuska Polinezija", "it": "Polinesia Francese", "ja": "フランス領ポリネシア", "nl": "Frans-Polynesië", "pt": "Polinésia Francesa"}, "regionalBlocs": [], "topLevelDomain": [".pf"]}, {"area": 7747.0, "cioc": "", "flag": "https://restcountries.eu/data/atf.svg", "gini": null, "name": "French Southern Territories", "latlng": [-49.25, 69.167], "region": "Africa", "borders": [], "capital": "Port-aux-Français", "demonym": "French", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Southern Africa", "timezones": ["UTC+05:00"], "alpha2Code": "TF", "alpha3Code": "ATF", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Territoire des Terres australes et antarctiques françaises", "population": 140, "numericCode": "260", "altSpellings": ["TF"], "callingCodes": [""], "translations": {"br": "Terras Austrais e Antárticas Francesas", "de": "Französische Süd- und Antarktisgebiete", "es": "Tierras Australes y Antárticas Francesas", "fa": "سرزمین‌های جنوبی و جنوبگانی فرانسه", "fr": "Terres australes et antarctiques françaises", "hr": "Francuski južni i antarktički teritoriji", "it": "Territori Francesi del Sud", "ja": "フランス領南方・南極地域", "nl": "Franse Gebieden in de zuidelijke Indische Oceaan", "pt": "Terras Austrais e Antárticas Francesas"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".tf"]}, {"area": 267668.0, "cioc": "GAB", "flag": "https://restcountries.eu/data/gab.svg", "gini": 41.5, "name": "Gabon", "latlng": [-1.0, 11.75], "region": "Africa", "borders": ["CMR", "COG", "GNQ"], "capital": "Libreville", "demonym": "Gabonese", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Middle Africa", "timezones": ["UTC+01:00"], "alpha2Code": "GA", "alpha3Code": "GAB", "currencies": [{"code": "XAF", "name": "Central African CFA franc", "symbol": "Fr"}], "nativeName": "Gabon", "population": 1802278, "numericCode": "266", "altSpellings": ["GA", "Gabonese Republic", "République Gabonaise"], "callingCodes": ["241"], "translations": {"br": "Gabão", "de": "Gabun", "es": "Gabón", "fa": "گابن", "fr": "Gabon", "hr": "Gabon", "it": "Gabon", "ja": "ガボン", "nl": "Gabon", "pt": "Gabão"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".ga"]}, {"area": 11295.0, "cioc": "GAM", "flag": "https://restcountries.eu/data/gmb.svg", "gini": null, "name": "Gambia", "latlng": [13.46666666, -16.56666666], "region": "Africa", "borders": ["SEN"], "capital": "Banjul", "demonym": "Gambian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Western Africa", "timezones": ["UTC+00:00"], "alpha2Code": "GM", "alpha3Code": "GMB", "currencies": [{"code": "GMD", "name": "Gambian dalasi", "symbol": "D"}], "nativeName": "Gambia", "population": 1882450, "numericCode": "270", "altSpellings": ["GM", "Republic of the Gambia"], "callingCodes": ["220"], "translations": {"br": "Gâmbia", "de": "Gambia", "es": "Gambia", "fa": "گامبیا", "fr": "Gambie", "hr": "Gambija", "it": "Gambia", "ja": "ガンビア", "nl": "Gambia", "pt": "Gâmbia"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".gm"]}, {"area": 69700.0, "cioc": "GEO", "flag": "https://restcountries.eu/data/geo.svg", "gini": 41.3, "name": "Georgia", "latlng": [42.0, 43.5], "region": "Asia", "borders": ["ARM", "AZE", "RUS", "TUR"], "capital": "Tbilisi", "demonym": "Georgian", "languages": [{"name": "Georgian", "iso639_1": "ka", "iso639_2": "kat", "nativeName": "ქართული"}], "subregion": "Western Asia", "timezones": ["UTC-05:00"], "alpha2Code": "GE", "alpha3Code": "GEO", "currencies": [{"code": "GEL", "name": "Georgian Lari", "symbol": "ლ"}], "nativeName": "საქართველო", "population": 3720400, "numericCode": "268", "altSpellings": ["GE", "Sakartvelo"], "callingCodes": ["995"], "translations": {"br": "Geórgia", "de": "Georgien", "es": "Georgia", "fa": "گرجستان", "fr": "Géorgie", "hr": "Gruzija", "it": "Georgia", "ja": "グルジア", "nl": "Georgië", "pt": "Geórgia"}, "regionalBlocs": [], "topLevelDomain": [".ge"]}, {"area": 357114.0, "cioc": "GER", "flag": "https://restcountries.eu/data/deu.svg", "gini": 28.3, "name": "Germany", "latlng": [51.0, 9.0], "region": "Europe", "borders": ["AUT", "BEL", "CZE", "DNK", "FRA", "LUX", "NLD", "POL", "CHE"], "capital": "Berlin", "demonym": "German", "languages": [{"name": "German", "iso639_1": "de", "iso639_2": "deu", "nativeName": "Deutsch"}], "subregion": "Western Europe", "timezones": ["UTC+01:00"], "alpha2Code": "DE", "alpha3Code": "DEU", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Deutschland", "population": 81770900, "numericCode": "276", "altSpellings": ["DE", "Federal Republic of Germany", "Bundesrepublik Deutschland"], "callingCodes": ["49"], "translations": {"br": "Alemanha", "de": "Deutschland", "es": "Alemania", "fa": "آلمان", "fr": "Allemagne", "hr": "Njemačka", "it": "Germania", "ja": "ドイツ", "nl": "Duitsland", "pt": "Alemanha"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".de"]}, {"area": 238533.0, "cioc": "GHA", "flag": "https://restcountries.eu/data/gha.svg", "gini": 42.8, "name": "Ghana", "latlng": [8.0, -2.0], "region": "Africa", "borders": ["BFA", "CIV", "TGO"], "capital": "Accra", "demonym": "Ghanaian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Western Africa", "timezones": ["UTC"], "alpha2Code": "GH", "alpha3Code": "GHA", "currencies": [{"code": "GHS", "name": "Ghanaian cedi", "symbol": "₵"}], "nativeName": "Ghana", "population": 27670174, "numericCode": "288", "altSpellings": ["GH"], "callingCodes": ["233"], "translations": {"br": "Gana", "de": "Ghana", "es": "Ghana", "fa": "غنا", "fr": "Ghana", "hr": "Gana", "it": "Ghana", "ja": "ガーナ", "nl": "Ghana", "pt": "Gana"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".gh"]}, {"area": 6.0, "cioc": "", "flag": "https://restcountries.eu/data/gib.svg", "gini": null, "name": "Gibraltar", "latlng": [36.13333333, -5.35], "region": "Europe", "borders": ["ESP"], "capital": "Gibraltar", "demonym": "Gibraltar", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Southern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "GI", "alpha3Code": "GIB", "currencies": [{"code": "GIP", "name": "Gibraltar pound", "symbol": "£"}], "nativeName": "Gibraltar", "population": 33140, "numericCode": "292", "altSpellings": ["GI"], "callingCodes": ["350"], "translations": {"br": "Gibraltar", "de": "Gibraltar", "es": "Gibraltar", "fa": "جبل‌طارق", "fr": "Gibraltar", "hr": "Gibraltar", "it": "Gibilterra", "ja": "ジブラルタル", "nl": "Gibraltar", "pt": "Gibraltar"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".gi"]}, {"area": 131990.0, "cioc": "GRE", "flag": "https://restcountries.eu/data/grc.svg", "gini": 34.3, "name": "Greece", "latlng": [39.0, 22.0], "region": "Europe", "borders": ["ALB", "BGR", "TUR", "MKD"], "capital": "Athens", "demonym": "Greek", "languages": [{"name": "Greek (modern)", "iso639_1": "el", "iso639_2": "ell", "nativeName": "ελληνικά"}], "subregion": "Southern Europe", "timezones": ["UTC+02:00"], "alpha2Code": "GR", "alpha3Code": "GRC", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Ελλάδα", "population": 10858018, "numericCode": "300", "altSpellings": ["GR", "Elláda", "Hellenic Republic", "Ελληνική Δημοκρατία"], "callingCodes": ["30"], "translations": {"br": "Grécia", "de": "Griechenland", "es": "Grecia", "fa": "یونان", "fr": "Grèce", "hr": "Grčka", "it": "Grecia", "ja": "ギリシャ", "nl": "Griekenland", "pt": "Grécia"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".gr"]}, {"area": 2166086.0, "cioc": "", "flag": "https://restcountries.eu/data/grl.svg", "gini": null, "name": "Greenland", "latlng": [72.0, -40.0], "region": "Americas", "borders": [], "capital": "Nuuk", "demonym": "Greenlandic", "languages": [{"name": "Kalaallisut", "iso639_1": "kl", "iso639_2": "kal", "nativeName": "kalaallisut"}], "subregion": "Northern America", "timezones": ["UTC-04:00", "UTC-03:00", "UTC-01:00", "UTC+00:00"], "alpha2Code": "GL", "alpha3Code": "GRL", "currencies": [{"code": "DKK", "name": "Danish krone", "symbol": "kr"}], "nativeName": "Kalaallit Nunaat", "population": 55847, "numericCode": "304", "altSpellings": ["GL", "Grønland"], "callingCodes": ["299"], "translations": {"br": "Groelândia", "de": "Grönland", "es": "Groenlandia", "fa": "گرینلند", "fr": "Groenland", "hr": "Grenland", "it": "Groenlandia", "ja": "グリーンランド", "nl": "Groenland", "pt": "Gronelândia"}, "regionalBlocs": [], "topLevelDomain": [".gl"]}, {"area": 344.0, "cioc": "GRN", "flag": "https://restcountries.eu/data/grd.svg", "gini": null, "name": "Grenada", "latlng": [12.11666666, -61.66666666], "region": "Americas", "borders": [], "capital": "St. George's", "demonym": "Grenadian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "GD", "alpha3Code": "GRD", "currencies": [{"code": "XCD", "name": "East Caribbean dollar", "symbol": "$"}], "nativeName": "Grenada", "population": 103328, "numericCode": "308", "altSpellings": ["GD"], "callingCodes": ["1473"], "translations": {"br": "Granada", "de": "Grenada", "es": "Grenada", "fa": "گرنادا", "fr": "Grenade", "hr": "Grenada", "it": "Grenada", "ja": "グレナダ", "nl": "Grenada", "pt": "Granada"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}], "topLevelDomain": [".gd"]}, {"area": null, "cioc": "", "flag": "https://restcountries.eu/data/glp.svg", "gini": null, "name": "Guadeloupe", "latlng": [16.25, -61.583333], "region": "Americas", "borders": [], "capital": "Basse-Terre", "demonym": "Guadeloupian", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "GP", "alpha3Code": "GLP", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Guadeloupe", "population": 400132, "numericCode": "312", "altSpellings": ["GP", "Gwadloup"], "callingCodes": ["590"], "translations": {"br": "Guadalupe", "de": "Guadeloupe", "es": "Guadalupe", "fa": "جزیره گوادلوپ", "fr": "Guadeloupe", "hr": "Gvadalupa", "it": "Guadeloupa", "ja": "グアドループ", "nl": "Guadeloupe", "pt": "Guadalupe"}, "regionalBlocs": [], "topLevelDomain": [".gp"]}, {"area": 549.0, "cioc": "GUM", "flag": "https://restcountries.eu/data/gum.svg", "gini": null, "name": "Guam", "latlng": [13.46666666, 144.78333333], "region": "Oceania", "borders": [], "capital": "Hagåtña", "demonym": "Guamanian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Chamorro", "iso639_1": "ch", "iso639_2": "cha", "nativeName": "Chamoru"}, {"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "Micronesia", "timezones": ["UTC+10:00"], "alpha2Code": "GU", "alpha3Code": "GUM", "currencies": [{"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "Guam", "population": 184200, "numericCode": "316", "altSpellings": ["GU", "Guåhån"], "callingCodes": ["1671"], "translations": {"br": "Guam", "de": "Guam", "es": "Guam", "fa": "گوام", "fr": "Guam", "hr": "Guam", "it": "Guam", "ja": "グアム", "nl": "Guam", "pt": "Guame"}, "regionalBlocs": [], "topLevelDomain": [".gu"]}, {"area": 108889.0, "cioc": "GUA", "flag": "https://restcountries.eu/data/gtm.svg", "gini": 55.9, "name": "Guatemala", "latlng": [15.5, -90.25], "region": "Americas", "borders": ["BLZ", "SLV", "HND", "MEX"], "capital": "Guatemala City", "demonym": "Guatemalan", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "Central America", "timezones": ["UTC-06:00"], "alpha2Code": "GT", "alpha3Code": "GTM", "currencies": [{"code": "GTQ", "name": "Guatemalan quetzal", "symbol": "Q"}], "nativeName": "Guatemala", "population": 16176133, "numericCode": "320", "altSpellings": ["GT"], "callingCodes": ["502"], "translations": {"br": "Guatemala", "de": "Guatemala", "es": "Guatemala", "fa": "گواتمالا", "fr": "Guatemala", "hr": "Gvatemala", "it": "Guatemala", "ja": "グアテマラ", "nl": "Guatemala", "pt": "Guatemala"}, "regionalBlocs": [{"name": "Central American Integration System", "acronym": "CAIS", "otherNames": ["Sistema de la Integración Centroamericana,"], "otherAcronyms": ["SICA"]}], "topLevelDomain": [".gt"]}, {"area": 78.0, "cioc": "", "flag": "https://restcountries.eu/data/ggy.svg", "gini": null, "name": "Guernsey", "latlng": [49.46666666, -2.58333333], "region": "Europe", "borders": [], "capital": "St. Peter Port", "demonym": "Channel Islander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Northern Europe", "timezones": ["UTC+00:00"], "alpha2Code": "GG", "alpha3Code": "GGY", "currencies": [{"code": "GBP", "name": "British pound", "symbol": "£"}, {"code": "(none)", "name": "Guernsey pound", "symbol": "£"}], "nativeName": "Guernsey", "population": 62999, "numericCode": "831", "altSpellings": ["GG", "Bailiwick of Guernsey", "Bailliage de Guernesey"], "callingCodes": ["44"], "translations": {"br": "Guernsey", "de": "Guernsey", "es": "Guernsey", "fa": "گرنزی", "fr": "Guernesey", "hr": "Guernsey", "it": "Guernsey", "ja": "ガーンジー", "nl": "Guernsey", "pt": "Guernsey"}, "regionalBlocs": [], "topLevelDomain": [".gg"]}, {"area": 245857.0, "cioc": "GUI", "flag": "https://restcountries.eu/data/gin.svg", "gini": 39.4, "name": "Guinea", "latlng": [11.0, -10.0], "region": "Africa", "borders": ["CIV", "GNB", "LBR", "MLI", "SEN", "SLE"], "capital": "Conakry", "demonym": "Guinean", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "Fula", "iso639_1": "ff", "iso639_2": "ful", "nativeName": "Fulfulde"}], "subregion": "Western Africa", "timezones": ["UTC"], "alpha2Code": "GN", "alpha3Code": "GIN", "currencies": [{"code": "GNF", "name": "Guinean franc", "symbol": "Fr"}], "nativeName": "Guinée", "population": 12947000, "numericCode": "324", "altSpellings": ["GN", "Republic of Guinea", "République de Guinée"], "callingCodes": ["224"], "translations": {"br": "Guiné", "de": "Guinea", "es": "Guinea", "fa": "گینه", "fr": "Guinée", "hr": "Gvineja", "it": "Guinea", "ja": "ギニア", "nl": "Guinee", "pt": "Guiné"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".gn"]}, {"area": 36125.0, "cioc": "GBS", "flag": "https://restcountries.eu/data/gnb.svg", "gini": 35.5, "name": "Guinea-Bissau", "latlng": [12.0, -15.0], "region": "Africa", "borders": ["GIN", "SEN"], "capital": "Bissau", "demonym": "Guinea-Bissauan", "languages": [{"name": "Portuguese", "iso639_1": "pt", "iso639_2": "por", "nativeName": "Português"}], "subregion": "Western Africa", "timezones": ["UTC"], "alpha2Code": "GW", "alpha3Code": "GNB", "currencies": [{"code": "XOF", "name": "West African CFA franc", "symbol": "Fr"}], "nativeName": "Guiné-Bissau", "population": 1547777, "numericCode": "624", "altSpellings": ["GW", "Republic of Guinea-Bissau", "República da Guiné-Bissau"], "callingCodes": ["245"], "translations": {"br": "Guiné-Bissau", "de": "Guinea-Bissau", "es": "Guinea-Bisáu", "fa": "گینه بیسائو", "fr": "Guinée-Bissau", "hr": "Gvineja Bisau", "it": "Guinea-Bissau", "ja": "ギニアビサウ", "nl": "Guinee-Bissau", "pt": "Guiné-Bissau"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".gw"]}, {"area": 214969.0, "cioc": "GUY", "flag": "https://restcountries.eu/data/guy.svg", "gini": 44.5, "name": "Guyana", "latlng": [5.0, -59.0], "region": "Americas", "borders": ["BRA", "SUR", "VEN"], "capital": "Georgetown", "demonym": "Guyanese", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "South America", "timezones": ["UTC-04:00"], "alpha2Code": "GY", "alpha3Code": "GUY", "currencies": [{"code": "GYD", "name": "Guyanese dollar", "symbol": "$"}], "nativeName": "Guyana", "population": 746900, "numericCode": "328", "altSpellings": ["GY", "Co-operative Republic of Guyana"], "callingCodes": ["592"], "translations": {"br": "Guiana", "de": "Guyana", "es": "Guyana", "fa": "گویان", "fr": "Guyane", "hr": "Gvajana", "it": "Guyana", "ja": "ガイアナ", "nl": "Guyana", "pt": "Guiana"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}, {"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}], "topLevelDomain": [".gy"]}, {"area": 27750.0, "cioc": "HAI", "flag": "https://restcountries.eu/data/hti.svg", "gini": 59.2, "name": "Haiti", "latlng": [19.0, -72.41666666], "region": "Americas", "borders": ["DOM"], "capital": "Port-au-Prince", "demonym": "Haitian", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "Haitian", "iso639_1": "ht", "iso639_2": "hat", "nativeName": "Kreyòl ayisyen"}], "subregion": "Caribbean", "timezones": ["UTC-05:00"], "alpha2Code": "HT", "alpha3Code": "HTI", "currencies": [{"code": "HTG", "name": "Haitian gourde", "symbol": "G"}], "nativeName": "Haïti", "population": 11078033, "numericCode": "332", "altSpellings": ["HT", "Republic of Haiti", "République d'Haïti", "Repiblik Ayiti"], "callingCodes": ["509"], "translations": {"br": "Haiti", "de": "Haiti", "es": "Haiti", "fa": "هائیتی", "fr": "Haïti", "hr": "Haiti", "it": "Haiti", "ja": "ハイチ", "nl": "Haïti", "pt": "Haiti"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}], "topLevelDomain": [".ht"]}, {"area": 412.0, "cioc": "", "flag": "https://restcountries.eu/data/hmd.svg", "gini": null, "name": "Heard Island and McDonald Islands", "latlng": [-53.1, 72.51666666], "region": "", "borders": [], "capital": "", "demonym": "Heard and McDonald Islander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "", "timezones": ["UTC+05:00"], "alpha2Code": "HM", "alpha3Code": "HMD", "currencies": [{"code": "AUD", "name": "Australian dollar", "symbol": "$"}], "nativeName": "Heard Island and McDonald Islands", "population": 0, "numericCode": "334", "altSpellings": ["HM"], "callingCodes": [""], "translations": {"br": "Ilha Heard e Ilhas McDonald", "de": "Heard und die McDonaldinseln", "es": "Islas Heard y McDonald", "fa": "جزیره هرد و جزایر مک‌دونالد", "fr": "Îles Heard-et-MacDonald", "hr": "Otok Heard i otočje McDonald", "it": "Isole Heard e McDonald", "ja": "ハード島とマクドナルド諸島", "nl": "Heard- en McDonaldeilanden", "pt": "Ilha Heard e Ilhas McDonald"}, "regionalBlocs": [], "topLevelDomain": [".hm", ".aq"]}, {"area": 0.44, "cioc": "", "flag": "https://restcountries.eu/data/vat.svg", "gini": null, "name": "Holy See", "latlng": [41.9, 12.45], "region": "Europe", "borders": ["ITA"], "capital": "Rome", "demonym": "", "languages": [{"name": "Latin", "iso639_1": "la", "iso639_2": "lat", "nativeName": "latine"}, {"name": "Italian", "iso639_1": "it", "iso639_2": "ita", "nativeName": "Italiano"}, {"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "German", "iso639_1": "de", "iso639_2": "deu", "nativeName": "Deutsch"}], "subregion": "Southern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "VA", "alpha3Code": "VAT", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Sancta Sedes", "population": 451, "numericCode": "336", "altSpellings": ["Sancta Sedes", "Vatican", "The Vatican"], "callingCodes": ["379"], "translations": {"br": "Vaticano", "de": "Heiliger Stuhl", "es": "Santa Sede", "fa": "سریر مقدس", "fr": "voir Saint", "hr": "Sveta Stolica", "it": "Santa Sede", "ja": "聖座", "nl": "Heilige Stoel", "pt": "Vaticano"}, "regionalBlocs": [], "topLevelDomain": [".va"]}, {"area": 112492.0, "cioc": "HON", "flag": "https://restcountries.eu/data/hnd.svg", "gini": 57.0, "name": "Honduras", "latlng": [15.0, -86.5], "region": "Americas", "borders": ["GTM", "SLV", "NIC"], "capital": "Tegucigalpa", "demonym": "Honduran", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "Central America", "timezones": ["UTC-06:00"], "alpha2Code": "HN", "alpha3Code": "HND", "currencies": [{"code": "HNL", "name": "Honduran lempira", "symbol": "L"}], "nativeName": "Honduras", "population": 8576532, "numericCode": "340", "altSpellings": ["HN", "Republic of Honduras", "República de Honduras"], "callingCodes": ["504"], "translations": {"br": "Honduras", "de": "Honduras", "es": "Honduras", "fa": "هندوراس", "fr": "Honduras", "hr": "Honduras", "it": "Honduras", "ja": "ホンジュラス", "nl": "Honduras", "pt": "Honduras"}, "regionalBlocs": [{"name": "Central American Integration System", "acronym": "CAIS", "otherNames": ["Sistema de la Integración Centroamericana,"], "otherAcronyms": ["SICA"]}], "topLevelDomain": [".hn"]}, {"area": 1104.0, "cioc": "HKG", "flag": "https://restcountries.eu/data/hkg.svg", "gini": 53.3, "name": "Hong Kong", "latlng": [22.25, 114.16666666], "region": "Asia", "borders": ["CHN"], "capital": "City of Victoria", "demonym": "Chinese", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Chinese", "iso639_1": "zh", "iso639_2": "zho", "nativeName": "中文 (Zhōngwén)"}], "subregion": "Eastern Asia", "timezones": ["UTC+08:00"], "alpha2Code": "HK", "alpha3Code": "HKG", "currencies": [{"code": "HKD", "name": "Hong Kong dollar", "symbol": "$"}], "nativeName": "香港", "population": 7324300, "numericCode": "344", "altSpellings": ["HK", "香港"], "callingCodes": ["852"], "translations": {"br": "Hong Kong", "de": "Hong Kong", "es": "Hong Kong", "fa": "هنگ‌کنگ", "fr": "Hong Kong", "hr": "Hong Kong", "it": "Hong Kong", "ja": "香港", "nl": "Hongkong", "pt": "Hong Kong"}, "regionalBlocs": [], "topLevelDomain": [".hk"]}, {"area": 93028.0, "cioc": "HUN", "flag": "https://restcountries.eu/data/hun.svg", "gini": 31.2, "name": "Hungary", "latlng": [47.0, 20.0], "region": "Europe", "borders": ["AUT", "HRV", "ROU", "SRB", "SVK", "SVN", "UKR"], "capital": "Budapest", "demonym": "Hungarian", "languages": [{"name": "Hungarian", "iso639_1": "hu", "iso639_2": "hun", "nativeName": "magyar"}], "subregion": "Eastern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "HU", "alpha3Code": "HUN", "currencies": [{"code": "HUF", "name": "Hungarian forint", "symbol": "Ft"}], "nativeName": "Magyarország", "population": 9823000, "numericCode": "348", "altSpellings": ["HU"], "callingCodes": ["36"], "translations": {"br": "Hungria", "de": "Ungarn", "es": "Hungría", "fa": "مجارستان", "fr": "Hongrie", "hr": "Mađarska", "it": "Ungheria", "ja": "ハンガリー", "nl": "Hongarije", "pt": "Hungria"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".hu"]}, {"area": 103000.0, "cioc": "ISL", "flag": "https://restcountries.eu/data/isl.svg", "gini": null, "name": "Iceland", "latlng": [65.0, -18.0], "region": "Europe", "borders": [], "capital": "Reykjavík", "demonym": "Icelander", "languages": [{"name": "Icelandic", "iso639_1": "is", "iso639_2": "isl", "nativeName": "Íslenska"}], "subregion": "Northern Europe", "timezones": ["UTC"], "alpha2Code": "IS", "alpha3Code": "ISL", "currencies": [{"code": "ISK", "name": "Icelandic króna", "symbol": "kr"}], "nativeName": "Ísland", "population": 334300, "numericCode": "352", "altSpellings": ["IS", "Island", "Republic of Iceland", "Lýðveldið Ísland"], "callingCodes": ["354"], "translations": {"br": "Islândia", "de": "Island", "es": "Islandia", "fa": "ایسلند", "fr": "Islande", "hr": "Island", "it": "Islanda", "ja": "アイスランド", "nl": "IJsland", "pt": "Islândia"}, "regionalBlocs": [{"name": "European Free Trade Association", "acronym": "EFTA", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".is"]}, {"area": 3287590.0, "cioc": "IND", "flag": "https://restcountries.eu/data/ind.svg", "gini": 33.4, "name": "India", "latlng": [20.0, 77.0], "region": "Asia", "borders": ["AFG", "BGD", "BTN", "MMR", "CHN", "NPL", "PAK", "LKA"], "capital": "New Delhi", "demonym": "Indian", "languages": [{"name": "Hindi", "iso639_1": "hi", "iso639_2": "hin", "nativeName": "हिन्दी"}, {"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Southern Asia", "timezones": ["UTC+05:30"], "alpha2Code": "IN", "alpha3Code": "IND", "currencies": [{"code": "INR", "name": "Indian rupee", "symbol": "₹"}], "nativeName": "भारत", "population": 1295210000, "numericCode": "356", "altSpellings": ["IN", "Bhārat", "Republic of India", "Bharat Ganrajya"], "callingCodes": ["91"], "translations": {"br": "Índia", "de": "Indien", "es": "India", "fa": "هند", "fr": "Inde", "hr": "Indija", "it": "India", "ja": "インド", "nl": "India", "pt": "Índia"}, "regionalBlocs": [{"name": "South Asian Association for Regional Cooperation", "acronym": "SAARC", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".in"]}, {"area": 1904569.0, "cioc": "INA", "flag": "https://restcountries.eu/data/idn.svg", "gini": 34.0, "name": "Indonesia", "latlng": [-5.0, 120.0], "region": "Asia", "borders": ["TLS", "MYS", "PNG"], "capital": "Jakarta", "demonym": "Indonesian", "languages": [{"name": "Indonesian", "iso639_1": "id", "iso639_2": "ind", "nativeName": "Bahasa Indonesia"}], "subregion": "South-Eastern Asia", "timezones": ["UTC+07:00", "UTC+08:00", "UTC+09:00"], "alpha2Code": "ID", "alpha3Code": "IDN", "currencies": [{"code": "IDR", "name": "Indonesian rupiah", "symbol": "Rp"}], "nativeName": "Indonesia", "population": 258705000, "numericCode": "360", "altSpellings": ["ID", "Republic of Indonesia", "Republik Indonesia"], "callingCodes": ["62"], "translations": {"br": "Indonésia", "de": "Indonesien", "es": "Indonesia", "fa": "اندونزی", "fr": "Indonésie", "hr": "Indonezija", "it": "Indonesia", "ja": "インドネシア", "nl": "Indonesië", "pt": "Indonésia"}, "regionalBlocs": [{"name": "Association of Southeast Asian Nations", "acronym": "ASEAN", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".id"]}, {"area": 322463.0, "cioc": "CIV", "flag": "https://restcountries.eu/data/civ.svg", "gini": 41.5, "name": "Côte d'Ivoire", "latlng": [8.0, -5.0], "region": "Africa", "borders": ["BFA", "GHA", "GIN", "LBR", "MLI"], "capital": "Yamoussoukro", "demonym": "Ivorian", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Western Africa", "timezones": ["UTC"], "alpha2Code": "CI", "alpha3Code": "CIV", "currencies": [{"code": "XOF", "name": "West African CFA franc", "symbol": "Fr"}], "nativeName": "Côte d'Ivoire", "population": 22671331, "numericCode": "384", "altSpellings": ["CI", "Ivory Coast", "Republic of Côte d'Ivoire", "République de Côte d'Ivoire"], "callingCodes": ["225"], "translations": {"br": "Costa do Marfim", "de": "Elfenbeinküste", "es": "Costa de Marfil", "fa": "ساحل عاج", "fr": "Côte d'Ivoire", "hr": "Obala Bjelokosti", "it": "Costa D'Avorio", "ja": "コートジボワール", "nl": "Ivoorkust", "pt": "Costa do Marfim"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".ci"]}, {"area": 1648195.0, "cioc": "IRI", "flag": "https://restcountries.eu/data/irn.svg", "gini": 38.3, "name": "Iran (Islamic Republic of)", "latlng": [32.0, 53.0], "region": "Asia", "borders": ["AFG", "ARM", "AZE", "IRQ", "PAK", "TUR", "TKM"], "capital": "Tehran", "demonym": "Iranian", "languages": [{"name": "Persian (Farsi)", "iso639_1": "fa", "iso639_2": "fas", "nativeName": "فارسی"}], "subregion": "Southern Asia", "timezones": ["UTC+03:30"], "alpha2Code": "IR", "alpha3Code": "IRN", "currencies": [{"code": "IRR", "name": "Iranian rial", "symbol": "﷼"}], "nativeName": "ایران", "population": 79369900, "numericCode": "364", "altSpellings": ["IR", "Islamic Republic of Iran", "Jomhuri-ye Eslāmi-ye Irān"], "callingCodes": ["98"], "translations": {"br": "Irã", "de": "Iran", "es": "Iran", "fa": "ایران", "fr": "Iran", "hr": "Iran", "it": null, "ja": "イラン・イスラム共和国", "nl": "Iran", "pt": "Irão"}, "regionalBlocs": [], "topLevelDomain": [".ir"]}, {"area": 438317.0, "cioc": "IRQ", "flag": "https://restcountries.eu/data/irq.svg", "gini": 30.9, "name": "Iraq", "latlng": [33.0, 44.0], "region": "Asia", "borders": ["IRN", "JOR", "KWT", "SAU", "SYR", "TUR"], "capital": "Baghdad", "demonym": "Iraqi", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}, {"name": "Kurdish", "iso639_1": "ku", "iso639_2": "kur", "nativeName": "Kurdî"}], "subregion": "Western Asia", "timezones": ["UTC+03:00"], "alpha2Code": "IQ", "alpha3Code": "IRQ", "currencies": [{"code": "IQD", "name": "Iraqi dinar", "symbol": "ع.د"}], "nativeName": "العراق", "population": 37883543, "numericCode": "368", "altSpellings": ["IQ", "Republic of Iraq", "Jumhūriyyat al-‘Irāq"], "callingCodes": ["964"], "translations": {"br": "Iraque", "de": "Irak", "es": "Irak", "fa": "عراق", "fr": "Irak", "hr": "Irak", "it": "Iraq", "ja": "イラク", "nl": "Irak", "pt": "Iraque"}, "regionalBlocs": [{"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".iq"]}, {"area": 70273.0, "cioc": "IRL", "flag": "https://restcountries.eu/data/irl.svg", "gini": 34.3, "name": "Ireland", "latlng": [53.0, -8.0], "region": "Europe", "borders": ["GBR"], "capital": "Dublin", "demonym": "Irish", "languages": [{"name": "Irish", "iso639_1": "ga", "iso639_2": "gle", "nativeName": "Gaeilge"}, {"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Northern Europe", "timezones": ["UTC"], "alpha2Code": "IE", "alpha3Code": "IRL", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Éire", "population": 6378000, "numericCode": "372", "altSpellings": ["IE", "Éire", "Republic of Ireland", "Poblacht na hÉireann"], "callingCodes": ["353"], "translations": {"br": "Irlanda", "de": "Irland", "es": "Irlanda", "fa": "ایرلند", "fr": "Irlande", "hr": "Irska", "it": "Irlanda", "ja": "アイルランド", "nl": "Ierland", "pt": "Irlanda"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".ie"]}, {"area": 572.0, "cioc": "", "flag": "https://restcountries.eu/data/imn.svg", "gini": null, "name": "Isle of Man", "latlng": [54.25, -4.5], "region": "Europe", "borders": [], "capital": "Douglas", "demonym": "Manx", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Manx", "iso639_1": "gv", "iso639_2": "glv", "nativeName": "Gaelg"}], "subregion": "Northern Europe", "timezones": ["UTC+00:00"], "alpha2Code": "IM", "alpha3Code": "IMN", "currencies": [{"code": "GBP", "name": "British pound", "symbol": "£"}, {"code": "IMP[G]", "name": "Manx pound", "symbol": "£"}], "nativeName": "Isle of Man", "population": 84497, "numericCode": "833", "altSpellings": ["IM", "Ellan Vannin", "Mann", "Mannin"], "callingCodes": ["44"], "translations": {"br": "Ilha de Man", "de": "Insel Man", "es": "Isla de Man", "fa": "جزیره من", "fr": "Île de Man", "hr": "Otok Man", "it": "Isola di Man", "ja": "マン島", "nl": "Isle of Man", "pt": "Ilha de Man"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".im"]}, {"area": 20770.0, "cioc": "ISR", "flag": "https://restcountries.eu/data/isr.svg", "gini": 39.2, "name": "Israel", "latlng": [31.5, 34.75], "region": "Asia", "borders": ["EGY", "JOR", "LBN", "SYR"], "capital": "Jerusalem", "demonym": "Israeli", "languages": [{"name": "Hebrew (modern)", "iso639_1": "he", "iso639_2": "heb", "nativeName": "עברית"}, {"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Western Asia", "timezones": ["UTC+02:00"], "alpha2Code": "IL", "alpha3Code": "ISR", "currencies": [{"code": "ILS", "name": "Israeli new shekel", "symbol": "₪"}], "nativeName": "יִשְׂרָאֵל", "population": 8527400, "numericCode": "376", "altSpellings": ["IL", "State of Israel", "Medīnat Yisrā'el"], "callingCodes": ["972"], "translations": {"br": "Israel", "de": "Israel", "es": "Israel", "fa": "اسرائیل", "fr": "Israël", "hr": "Izrael", "it": "Israele", "ja": "イスラエル", "nl": "Israël", "pt": "Israel"}, "regionalBlocs": [], "topLevelDomain": [".il"]}, {"area": 301336.0, "cioc": "ITA", "flag": "https://restcountries.eu/data/ita.svg", "gini": 36.0, "name": "Italy", "latlng": [42.83333333, 12.83333333], "region": "Europe", "borders": ["AUT", "FRA", "SMR", "SVN", "CHE", "VAT"], "capital": "Rome", "demonym": "Italian", "languages": [{"name": "Italian", "iso639_1": "it", "iso639_2": "ita", "nativeName": "Italiano"}], "subregion": "Southern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "IT", "alpha3Code": "ITA", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Italia", "population": 60665551, "numericCode": "380", "altSpellings": ["IT", "Italian Republic", "Repubblica italiana"], "callingCodes": ["39"], "translations": {"br": "Itália", "de": "Italien", "es": "Italia", "fa": "ایتالیا", "fr": "Italie", "hr": "Italija", "it": "Italia", "ja": "イタリア", "nl": "Italië", "pt": "Itália"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".it"]}, {"area": 10991.0, "cioc": "JAM", "flag": "https://restcountries.eu/data/jam.svg", "gini": 45.5, "name": "Jamaica", "latlng": [18.25, -77.5], "region": "Americas", "borders": [], "capital": "Kingston", "demonym": "Jamaican", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-05:00"], "alpha2Code": "JM", "alpha3Code": "JAM", "currencies": [{"code": "JMD", "name": "Jamaican dollar", "symbol": "$"}], "nativeName": "Jamaica", "population": 2723246, "numericCode": "388", "altSpellings": ["JM"], "callingCodes": ["1876"], "translations": {"br": "Jamaica", "de": "Jamaika", "es": "Jamaica", "fa": "جامائیکا", "fr": "Jamaïque", "hr": "Jamajka", "it": "Giamaica", "ja": "ジャマイカ", "nl": "Jamaica", "pt": "Jamaica"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}], "topLevelDomain": [".jm"]}, {"area": 377930.0, "cioc": "JPN", "flag": "https://restcountries.eu/data/jpn.svg", "gini": 38.1, "name": "Japan", "latlng": [36.0, 138.0], "region": "Asia", "borders": [], "capital": "Tokyo", "demonym": "Japanese", "languages": [{"name": "Japanese", "iso639_1": "ja", "iso639_2": "jpn", "nativeName": "日本語 (にほんご)"}], "subregion": "Eastern Asia", "timezones": ["UTC+09:00"], "alpha2Code": "JP", "alpha3Code": "JPN", "currencies": [{"code": "JPY", "name": "Japanese yen", "symbol": "¥"}], "nativeName": "日本", "population": 126960000, "numericCode": "392", "altSpellings": ["JP", "Nippon", "Nihon"], "callingCodes": ["81"], "translations": {"br": "Japão", "de": "Japan", "es": "Japón", "fa": "ژاپن", "fr": "Japon", "hr": "Japan", "it": "Giappone", "ja": "日本", "nl": "Japan", "pt": "Japão"}, "regionalBlocs": [], "topLevelDomain": [".jp"]}, {"area": 116.0, "cioc": "", "flag": "https://restcountries.eu/data/jey.svg", "gini": null, "name": "Jersey", "latlng": [49.25, -2.16666666], "region": "Europe", "borders": [], "capital": "Saint Helier", "demonym": "Channel Islander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Northern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "JE", "alpha3Code": "JEY", "currencies": [{"code": "GBP", "name": "British pound", "symbol": "£"}, {"code": "JEP[G]", "name": "Jersey pound", "symbol": "£"}], "nativeName": "Jersey", "population": 100800, "numericCode": "832", "altSpellings": ["JE", "Bailiwick of Jersey", "Bailliage de Jersey", "Bailliage dé Jèrri"], "callingCodes": ["44"], "translations": {"br": "Jersey", "de": "Jersey", "es": "Jersey", "fa": "جرزی", "fr": "Jersey", "hr": "Jersey", "it": "Isola di Jersey", "ja": "ジャージー", "nl": "Jersey", "pt": "Jersey"}, "regionalBlocs": [], "topLevelDomain": [".je"]}, {"area": 89342.0, "cioc": "JOR", "flag": "https://restcountries.eu/data/jor.svg", "gini": 35.4, "name": "Jordan", "latlng": [31.0, 36.0], "region": "Asia", "borders": ["IRQ", "ISR", "SAU", "SYR"], "capital": "Amman", "demonym": "Jordanian", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Western Asia", "timezones": ["UTC+03:00"], "alpha2Code": "JO", "alpha3Code": "JOR", "currencies": [{"code": "JOD", "name": "Jordanian dinar", "symbol": "د.ا"}], "nativeName": "الأردن", "population": 9531712, "numericCode": "400", "altSpellings": ["JO", "Hashemite Kingdom of Jordan", "al-Mamlakah al-Urdunīyah al-Hāshimīyah"], "callingCodes": ["962"], "translations": {"br": "Jordânia", "de": "Jordanien", "es": "Jordania", "fa": "اردن", "fr": "Jordanie", "hr": "Jordan", "it": "Giordania", "ja": "ヨルダン", "nl": "Jordanië", "pt": "Jordânia"}, "regionalBlocs": [{"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".jo"]}, {"area": 2724900.0, "cioc": "KAZ", "flag": "https://restcountries.eu/data/kaz.svg", "gini": 29.0, "name": "Kazakhstan", "latlng": [48.0, 68.0], "region": "Asia", "borders": ["CHN", "KGZ", "RUS", "TKM", "UZB"], "capital": "Astana", "demonym": "Kazakhstani", "languages": [{"name": "Kazakh", "iso639_1": "kk", "iso639_2": "kaz", "nativeName": "қазақ тілі"}, {"name": "Russian", "iso639_1": "ru", "iso639_2": "rus", "nativeName": "Русский"}], "subregion": "Central Asia", "timezones": ["UTC+05:00", "UTC+06:00"], "alpha2Code": "KZ", "alpha3Code": "KAZ", "currencies": [{"code": "KZT", "name": "Kazakhstani tenge", "symbol": null}], "nativeName": "Қазақстан", "population": 17753200, "numericCode": "398", "altSpellings": ["KZ", "Qazaqstan", "Казахстан", "Republic of Kazakhstan", "Қазақстан Республикасы", "Qazaqstan Respublïkası", "Республика Казахстан", "Respublika Kazakhstan"], "callingCodes": ["76", "77"], "translations": {"br": "Cazaquistão", "de": "Kasachstan", "es": "Kazajistán", "fa": "قزاقستان", "fr": "Kazakhstan", "hr": "Kazahstan", "it": "Kazakistan", "ja": "カザフスタン", "nl": "Kazachstan", "pt": "Cazaquistão"}, "regionalBlocs": [{"name": "Eurasian Economic Union", "acronym": "EEU", "otherNames": [], "otherAcronyms": ["EAEU"]}], "topLevelDomain": [".kz", ".қаз"]}, {"area": 580367.0, "cioc": "KEN", "flag": "https://restcountries.eu/data/ken.svg", "gini": 47.7, "name": "Kenya", "latlng": [1.0, 38.0], "region": "Africa", "borders": ["ETH", "SOM", "SSD", "TZA", "UGA"], "capital": "Nairobi", "demonym": "Kenyan", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Swahili", "iso639_1": "sw", "iso639_2": "swa", "nativeName": "Kiswahili"}], "subregion": "Eastern Africa", "timezones": ["UTC+03:00"], "alpha2Code": "KE", "alpha3Code": "KEN", "currencies": [{"code": "KES", "name": "Kenyan shilling", "symbol": "Sh"}], "nativeName": "Kenya", "population": 47251000, "numericCode": "404", "altSpellings": ["KE", "Republic of Kenya", "Jamhuri ya Kenya"], "callingCodes": ["254"], "translations": {"br": "Quênia", "de": "Kenia", "es": "Kenia", "fa": "کنیا", "fr": "Kenya", "hr": "Kenija", "it": "Kenya", "ja": "ケニア", "nl": "Kenia", "pt": "Quénia"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".ke"]}, {"area": 811.0, "cioc": "KIR", "flag": "https://restcountries.eu/data/kir.svg", "gini": null, "name": "Kiribati", "latlng": [1.41666666, 173.0], "region": "Oceania", "borders": [], "capital": "South Tarawa", "demonym": "I-Kiribati", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Micronesia", "timezones": ["UTC+12:00", "UTC+13:00", "UTC+14:00"], "alpha2Code": "KI", "alpha3Code": "KIR", "currencies": [{"code": "AUD", "name": "Australian dollar", "symbol": "$"}, {"code": "(none)", "name": "Kiribati dollar", "symbol": "$"}], "nativeName": "Kiribati", "population": 113400, "numericCode": "296", "altSpellings": ["KI", "Republic of Kiribati", "Ribaberiki Kiribati"], "callingCodes": ["686"], "translations": {"br": "Kiribati", "de": "Kiribati", "es": "Kiribati", "fa": "کیریباتی", "fr": "Kiribati", "hr": "Kiribati", "it": "Kiribati", "ja": "キリバス", "nl": "Kiribati", "pt": "Quiribáti"}, "regionalBlocs": [], "topLevelDomain": [".ki"]}, {"area": 17818.0, "cioc": "KUW", "flag": "https://restcountries.eu/data/kwt.svg", "gini": null, "name": "Kuwait", "latlng": [29.5, 45.75], "region": "Asia", "borders": ["IRN", "SAU"], "capital": "Kuwait City", "demonym": "Kuwaiti", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Western Asia", "timezones": ["UTC+03:00"], "alpha2Code": "KW", "alpha3Code": "KWT", "currencies": [{"code": "KWD", "name": "Kuwaiti dinar", "symbol": "د.ك"}], "nativeName": "الكويت", "population": 4183658, "numericCode": "414", "altSpellings": ["KW", "State of Kuwait", "Dawlat al-Kuwait"], "callingCodes": ["965"], "translations": {"br": "Kuwait", "de": "Kuwait", "es": "Kuwait", "fa": "کویت", "fr": "Koweït", "hr": "Kuvajt", "it": "Kuwait", "ja": "クウェート", "nl": "Koeweit", "pt": "Kuwait"}, "regionalBlocs": [{"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".kw"]}, {"area": 199951.0, "cioc": "KGZ", "flag": "https://restcountries.eu/data/kgz.svg", "gini": 36.2, "name": "Kyrgyzstan", "latlng": [41.0, 75.0], "region": "Asia", "borders": ["CHN", "KAZ", "TJK", "UZB"], "capital": "Bishkek", "demonym": "Kirghiz", "languages": [{"name": "Kyrgyz", "iso639_1": "ky", "iso639_2": "kir", "nativeName": "Кыргызча"}, {"name": "Russian", "iso639_1": "ru", "iso639_2": "rus", "nativeName": "Русский"}], "subregion": "Central Asia", "timezones": ["UTC+06:00"], "alpha2Code": "KG", "alpha3Code": "KGZ", "currencies": [{"code": "KGS", "name": "Kyrgyzstani som", "symbol": "с"}], "nativeName": "Кыргызстан", "population": 6047800, "numericCode": "417", "altSpellings": ["KG", "Киргизия", "Kyrgyz Republic", "Кыргыз Республикасы", "Kyrgyz Respublikasy"], "callingCodes": ["996"], "translations": {"br": "Quirguistão", "de": "Kirgisistan", "es": "Kirguizistán", "fa": "قرقیزستان", "fr": "Kirghizistan", "hr": "Kirgistan", "it": "Kirghizistan", "ja": "キルギス", "nl": "Kirgizië", "pt": "Quirguizistão"}, "regionalBlocs": [{"name": "Eurasian Economic Union", "acronym": "EEU", "otherNames": [], "otherAcronyms": ["EAEU"]}], "topLevelDomain": [".kg"]}, {"area": 236800.0, "cioc": "LAO", "flag": "https://restcountries.eu/data/lao.svg", "gini": 36.7, "name": "Lao People's Democratic Republic", "latlng": [18.0, 105.0], "region": "Asia", "borders": ["MMR", "KHM", "CHN", "THA", "VNM"], "capital": "Vientiane", "demonym": "Laotian", "languages": [{"name": "Lao", "iso639_1": "lo", "iso639_2": "lao", "nativeName": "ພາສາລາວ"}], "subregion": "South-Eastern Asia", "timezones": ["UTC+07:00"], "alpha2Code": "LA", "alpha3Code": "LAO", "currencies": [{"code": "LAK", "name": "Lao kip", "symbol": "₭"}], "nativeName": "ສປປລາວ", "population": 6492400, "numericCode": "418", "altSpellings": ["LA", "Lao", "Laos", "Lao People's Democratic Republic", "Sathalanalat Paxathipatai Paxaxon Lao"], "callingCodes": ["856"], "translations": {"br": "Laos", "de": "Laos", "es": "Laos", "fa": "لائوس", "fr": "Laos", "hr": "Laos", "it": "Laos", "ja": "ラオス人民民主共和国", "nl": "Laos", "pt": "Laos"}, "regionalBlocs": [{"name": "Association of Southeast Asian Nations", "acronym": "ASEAN", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".la"]}, {"area": 64559.0, "cioc": "LAT", "flag": "https://restcountries.eu/data/lva.svg", "gini": 36.6, "name": "Latvia", "latlng": [57.0, 25.0], "region": "Europe", "borders": ["BLR", "EST", "LTU", "RUS"], "capital": "Riga", "demonym": "Latvian", "languages": [{"name": "Latvian", "iso639_1": "lv", "iso639_2": "lav", "nativeName": "latviešu valoda"}], "subregion": "Northern Europe", "timezones": ["UTC+02:00"], "alpha2Code": "LV", "alpha3Code": "LVA", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Latvija", "population": 1961600, "numericCode": "428", "altSpellings": ["LV", "Republic of Latvia", "Latvijas Republika"], "callingCodes": ["371"], "translations": {"br": "Letônia", "de": "Lettland", "es": "Letonia", "fa": "لتونی", "fr": "Lettonie", "hr": "Latvija", "it": "Lettonia", "ja": "ラトビア", "nl": "Letland", "pt": "Letónia"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".lv"]}, {"area": 10452.0, "cioc": "LIB", "flag": "https://restcountries.eu/data/lbn.svg", "gini": null, "name": "Lebanon", "latlng": [33.83333333, 35.83333333], "region": "Asia", "borders": ["ISR", "SYR"], "capital": "Beirut", "demonym": "Lebanese", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}, {"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Western Asia", "timezones": ["UTC+02:00"], "alpha2Code": "LB", "alpha3Code": "LBN", "currencies": [{"code": "LBP", "name": "Lebanese pound", "symbol": "ل.ل"}], "nativeName": "لبنان", "population": 5988000, "numericCode": "422", "altSpellings": ["LB", "Lebanese Republic", "Al-Jumhūrīyah Al-Libnānīyah"], "callingCodes": ["961"], "translations": {"br": "Líbano", "de": "Libanon", "es": "Líbano", "fa": "لبنان", "fr": "Liban", "hr": "Libanon", "it": "Libano", "ja": "レバノン", "nl": "Libanon", "pt": "Líbano"}, "regionalBlocs": [{"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".lb"]}, {"area": 30355.0, "cioc": "LES", "flag": "https://restcountries.eu/data/lso.svg", "gini": 52.5, "name": "Lesotho", "latlng": [-29.5, 28.5], "region": "Africa", "borders": ["ZAF"], "capital": "Maseru", "demonym": "Mosotho", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Southern Sotho", "iso639_1": "st", "iso639_2": "sot", "nativeName": "Sesotho"}], "subregion": "Southern Africa", "timezones": ["UTC+02:00"], "alpha2Code": "LS", "alpha3Code": "LSO", "currencies": [{"code": "LSL", "name": "Lesotho loti", "symbol": "L"}, {"code": "ZAR", "name": "South African rand", "symbol": "R"}], "nativeName": "Lesotho", "population": 1894194, "numericCode": "426", "altSpellings": ["LS", "Kingdom of Lesotho", "Muso oa Lesotho"], "callingCodes": ["266"], "translations": {"br": "Lesoto", "de": "Lesotho", "es": "Lesotho", "fa": "لسوتو", "fr": "Lesotho", "hr": "Lesoto", "it": "Lesotho", "ja": "レソト", "nl": "Lesotho", "pt": "Lesoto"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".ls"]}, {"area": 111369.0, "cioc": "LBR", "flag": "https://restcountries.eu/data/lbr.svg", "gini": 38.2, "name": "Liberia", "latlng": [6.5, -9.5], "region": "Africa", "borders": ["GIN", "CIV", "SLE"], "capital": "Monrovia", "demonym": "Liberian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Western Africa", "timezones": ["UTC"], "alpha2Code": "LR", "alpha3Code": "LBR", "currencies": [{"code": "LRD", "name": "Liberian dollar", "symbol": "$"}], "nativeName": "Liberia", "population": 4615000, "numericCode": "430", "altSpellings": ["LR", "Republic of Liberia"], "callingCodes": ["231"], "translations": {"br": "Libéria", "de": "Liberia", "es": "Liberia", "fa": "لیبریا", "fr": "Liberia", "hr": "Liberija", "it": "Liberia", "ja": "リベリア", "nl": "Liberia", "pt": "Libéria"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".lr"]}, {"area": 1759540.0, "cioc": "LBA", "flag": "https://restcountries.eu/data/lby.svg", "gini": null, "name": "Libya", "latlng": [25.0, 17.0], "region": "Africa", "borders": ["DZA", "TCD", "EGY", "NER", "SDN", "TUN"], "capital": "Tripoli", "demonym": "Libyan", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Northern Africa", "timezones": ["UTC+01:00"], "alpha2Code": "LY", "alpha3Code": "LBY", "currencies": [{"code": "LYD", "name": "Libyan dinar", "symbol": "ل.د"}], "nativeName": "‏ليبيا", "population": 6385000, "numericCode": "434", "altSpellings": ["LY", "State of Libya", "Dawlat Libya"], "callingCodes": ["218"], "translations": {"br": "Líbia", "de": "Libyen", "es": "Libia", "fa": "لیبی", "fr": "Libye", "hr": "Libija", "it": "Libia", "ja": "リビア", "nl": "Libië", "pt": "Líbia"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}, {"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".ly"]}, {"area": 160.0, "cioc": "LIE", "flag": "https://restcountries.eu/data/lie.svg", "gini": null, "name": "Liechtenstein", "latlng": [47.26666666, 9.53333333], "region": "Europe", "borders": ["AUT", "CHE"], "capital": "Vaduz", "demonym": "Liechtensteiner", "languages": [{"name": "German", "iso639_1": "de", "iso639_2": "deu", "nativeName": "Deutsch"}], "subregion": "Western Europe", "timezones": ["UTC+01:00"], "alpha2Code": "LI", "alpha3Code": "LIE", "currencies": [{"code": "CHF", "name": "Swiss franc", "symbol": "Fr"}], "nativeName": "Liechtenstein", "population": 37623, "numericCode": "438", "altSpellings": ["LI", "Principality of Liechtenstein", "Fürstentum Liechtenstein"], "callingCodes": ["423"], "translations": {"br": "Liechtenstein", "de": "Liechtenstein", "es": "Liechtenstein", "fa": "لیختن‌اشتاین", "fr": "Liechtenstein", "hr": "Lihtenštajn", "it": "Liechtenstein", "ja": "リヒテンシュタイン", "nl": "Liechtenstein", "pt": "Listenstaine"}, "regionalBlocs": [{"name": "European Free Trade Association", "acronym": "EFTA", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".li"]}, {"area": 65300.0, "cioc": "LTU", "flag": "https://restcountries.eu/data/ltu.svg", "gini": 37.6, "name": "Lithuania", "latlng": [56.0, 24.0], "region": "Europe", "borders": ["BLR", "LVA", "POL", "RUS"], "capital": "Vilnius", "demonym": "Lithuanian", "languages": [{"name": "Lithuanian", "iso639_1": "lt", "iso639_2": "lit", "nativeName": "lietuvių kalba"}], "subregion": "Northern Europe", "timezones": ["UTC+02:00"], "alpha2Code": "LT", "alpha3Code": "LTU", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Lietuva", "population": 2872294, "numericCode": "440", "altSpellings": ["LT", "Republic of Lithuania", "Lietuvos Respublika"], "callingCodes": ["370"], "translations": {"br": "Lituânia", "de": "Litauen", "es": "Lituania", "fa": "لیتوانی", "fr": "Lituanie", "hr": "Litva", "it": "Lituania", "ja": "リトアニア", "nl": "Litouwen", "pt": "Lituânia"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".lt"]}, {"area": 2586.0, "cioc": "LUX", "flag": "https://restcountries.eu/data/lux.svg", "gini": 30.8, "name": "Luxembourg", "latlng": [49.75, 6.16666666], "region": "Europe", "borders": ["BEL", "FRA", "DEU"], "capital": "Luxembourg", "demonym": "Luxembourger", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "German", "iso639_1": "de", "iso639_2": "deu", "nativeName": "Deutsch"}, {"name": "Luxembourgish", "iso639_1": "lb", "iso639_2": "ltz", "nativeName": "Lëtzebuergesch"}], "subregion": "Western Europe", "timezones": ["UTC+01:00"], "alpha2Code": "LU", "alpha3Code": "LUX", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Luxembourg", "population": 576200, "numericCode": "442", "altSpellings": ["LU", "Grand Duchy of Luxembourg", "Grand-Duché de Luxembourg", "Großherzogtum Luxemburg", "Groussherzogtum Lëtzebuerg"], "callingCodes": ["352"], "translations": {"br": "Luxemburgo", "de": "Luxemburg", "es": "Luxemburgo", "fa": "لوکزامبورگ", "fr": "Luxembourg", "hr": "Luksemburg", "it": "Lussemburgo", "ja": "ルクセンブルク", "nl": "Luxemburg", "pt": "Luxemburgo"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".lu"]}, {"area": 30.0, "cioc": "", "flag": "https://restcountries.eu/data/mac.svg", "gini": null, "name": "Macao", "latlng": [22.16666666, 113.55], "region": "Asia", "borders": ["CHN"], "capital": "", "demonym": "Chinese", "languages": [{"name": "Chinese", "iso639_1": "zh", "iso639_2": "zho", "nativeName": "中文 (Zhōngwén)"}, {"name": "Portuguese", "iso639_1": "pt", "iso639_2": "por", "nativeName": "Português"}], "subregion": "Eastern Asia", "timezones": ["UTC+08:00"], "alpha2Code": "MO", "alpha3Code": "MAC", "currencies": [{"code": "MOP", "name": "Macanese pataca", "symbol": "P"}], "nativeName": "澳門", "population": 649100, "numericCode": "446", "altSpellings": ["MO", "澳门", "Macao Special Administrative Region of the People's Republic of China", "中華人民共和國澳門特別行政區", "Região Administrativa Especial de Macau da República Popular da China"], "callingCodes": ["853"], "translations": {"br": "Macau", "de": "Macao", "es": "Macao", "fa": "مکائو", "fr": "Macao", "hr": "Makao", "it": "Macao", "ja": "マカオ", "nl": "Macao", "pt": "Macau"}, "regionalBlocs": [], "topLevelDomain": [".mo"]}, {"area": 25713.0, "cioc": "MKD", "flag": "https://restcountries.eu/data/mkd.svg", "gini": 43.2, "name": "Macedonia (the former Yugoslav Republic of)", "latlng": [41.83333333, 22.0], "region": "Europe", "borders": ["ALB", "BGR", "GRC", "KOS", "SRB"], "capital": "Skopje", "demonym": "Macedonian", "languages": [{"name": "Macedonian", "iso639_1": "mk", "iso639_2": "mkd", "nativeName": "македонски јазик"}], "subregion": "Southern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "MK", "alpha3Code": "MKD", "currencies": [{"code": "MKD", "name": "Macedonian denar", "symbol": "ден"}], "nativeName": "Македонија", "population": 2058539, "numericCode": "807", "altSpellings": ["MK", "Republic of Macedonia", "Република Македонија"], "callingCodes": ["389"], "translations": {"br": "Macedônia", "de": "Mazedonien", "es": "Macedonia", "fa": "", "fr": "Macédoine", "hr": "Makedonija", "it": "Macedonia", "ja": "マケドニア旧ユーゴスラビア共和国", "nl": "Macedonië", "pt": "Macedónia"}, "regionalBlocs": [{"name": "Central European Free Trade Agreement", "acronym": "CEFTA", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".mk"]}, {"area": 587041.0, "cioc": "MAD", "flag": "https://restcountries.eu/data/mdg.svg", "gini": 44.1, "name": "Madagascar", "latlng": [-20.0, 47.0], "region": "Africa", "borders": [], "capital": "Antananarivo", "demonym": "Malagasy", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "Malagasy", "iso639_1": "mg", "iso639_2": "mlg", "nativeName": "fiteny malagasy"}], "subregion": "Eastern Africa", "timezones": ["UTC+03:00"], "alpha2Code": "MG", "alpha3Code": "MDG", "currencies": [{"code": "MGA", "name": "Malagasy ariary", "symbol": "Ar"}], "nativeName": "Madagasikara", "population": 22434363, "numericCode": "450", "altSpellings": ["MG", "Republic of Madagascar", "Repoblikan'i Madagasikara", "République de Madagascar"], "callingCodes": ["261"], "translations": {"br": "Madagascar", "de": "Madagaskar", "es": "Madagascar", "fa": "ماداگاسکار", "fr": "Madagascar", "hr": "Madagaskar", "it": "Madagascar", "ja": "マダガスカル", "nl": "Madagaskar", "pt": "Madagáscar"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".mg"]}, {"area": 118484.0, "cioc": "MAW", "flag": "https://restcountries.eu/data/mwi.svg", "gini": 39.0, "name": "Malawi", "latlng": [-13.5, 34.0], "region": "Africa", "borders": ["MOZ", "TZA", "ZMB"], "capital": "Lilongwe", "demonym": "Malawian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Chichewa", "iso639_1": "ny", "iso639_2": "nya", "nativeName": "chiCheŵa"}], "subregion": "Eastern Africa", "timezones": ["UTC+02:00"], "alpha2Code": "MW", "alpha3Code": "MWI", "currencies": [{"code": "MWK", "name": "Malawian kwacha", "symbol": "MK"}], "nativeName": "Malawi", "population": 16832910, "numericCode": "454", "altSpellings": ["MW", "Republic of Malawi"], "callingCodes": ["265"], "translations": {"br": "Malawi", "de": "Malawi", "es": "Malawi", "fa": "مالاوی", "fr": "Malawi", "hr": "Malavi", "it": "Malawi", "ja": "マラウイ", "nl": "Malawi", "pt": "Malávi"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".mw"]}, {"area": 330803.0, "cioc": "MAS", "flag": "https://restcountries.eu/data/mys.svg", "gini": 46.2, "name": "Malaysia", "latlng": [2.5, 112.5], "region": "Asia", "borders": ["BRN", "IDN", "THA"], "capital": "Kuala Lumpur", "demonym": "Malaysian", "languages": [{"name": "Malaysian", "iso639_1": null, "iso639_2": "zsm", "nativeName": "بهاس مليسيا"}], "subregion": "South-Eastern Asia", "timezones": ["UTC+08:00"], "alpha2Code": "MY", "alpha3Code": "MYS", "currencies": [{"code": "MYR", "name": "Malaysian ringgit", "symbol": "RM"}], "nativeName": "Malaysia", "population": 31405416, "numericCode": "458", "altSpellings": ["MY"], "callingCodes": ["60"], "translations": {"br": "Malásia", "de": "Malaysia", "es": "Malasia", "fa": "مالزی", "fr": "Malaisie", "hr": "Malezija", "it": "Malesia", "ja": "マレーシア", "nl": "Maleisië", "pt": "Malásia"}, "regionalBlocs": [{"name": "Association of Southeast Asian Nations", "acronym": "ASEAN", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".my"]}, {"area": 300.0, "cioc": "MDV", "flag": "https://restcountries.eu/data/mdv.svg", "gini": 37.4, "name": "Maldives", "latlng": [3.25, 73.0], "region": "Asia", "borders": [], "capital": "Malé", "demonym": "Maldivan", "languages": [{"name": "Divehi", "iso639_1": "dv", "iso639_2": "div", "nativeName": "ދިވެހި"}], "subregion": "Southern Asia", "timezones": ["UTC+05:00"], "alpha2Code": "MV", "alpha3Code": "MDV", "currencies": [{"code": "MVR", "name": "Maldivian rufiyaa", "symbol": ".ރ"}], "nativeName": "Maldives", "population": 344023, "numericCode": "462", "altSpellings": ["MV", "Maldive Islands", "Republic of the Maldives", "Dhivehi Raajjeyge Jumhooriyya"], "callingCodes": ["960"], "translations": {"br": "Maldivas", "de": "Malediven", "es": "Maldivas", "fa": "مالدیو", "fr": "Maldives", "hr": "Maldivi", "it": "Maldive", "ja": "モルディブ", "nl": "Maldiven", "pt": "Maldivas"}, "regionalBlocs": [{"name": "South Asian Association for Regional Cooperation", "acronym": "SAARC", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".mv"]}, {"area": 1240192.0, "cioc": "MLI", "flag": "https://restcountries.eu/data/mli.svg", "gini": 33.0, "name": "Mali", "latlng": [17.0, -4.0], "region": "Africa", "borders": ["DZA", "BFA", "GIN", "CIV", "MRT", "NER", "SEN"], "capital": "Bamako", "demonym": "Malian", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Western Africa", "timezones": ["UTC"], "alpha2Code": "ML", "alpha3Code": "MLI", "currencies": [{"code": "XOF", "name": "West African CFA franc", "symbol": "Fr"}], "nativeName": "Mali", "population": 18135000, "numericCode": "466", "altSpellings": ["ML", "Republic of Mali", "République du Mali"], "callingCodes": ["223"], "translations": {"br": "Mali", "de": "Mali", "es": "Mali", "fa": "مالی", "fr": "Mali", "hr": "Mali", "it": "Mali", "ja": "マリ", "nl": "Mali", "pt": "Mali"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".ml"]}, {"area": 316.0, "cioc": "MLT", "flag": "https://restcountries.eu/data/mlt.svg", "gini": null, "name": "Malta", "latlng": [35.83333333, 14.58333333], "region": "Europe", "borders": [], "capital": "Valletta", "demonym": "Maltese", "languages": [{"name": "Maltese", "iso639_1": "mt", "iso639_2": "mlt", "nativeName": "Malti"}, {"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Southern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "MT", "alpha3Code": "MLT", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Malta", "population": 425384, "numericCode": "470", "altSpellings": ["MT", "Republic of Malta", "Repubblika ta' Malta"], "callingCodes": ["356"], "translations": {"br": "Malta", "de": "Malta", "es": "Malta", "fa": "مالت", "fr": "Malte", "hr": "Malta", "it": "Malta", "ja": "マルタ", "nl": "Malta", "pt": "Malta"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".mt"]}, {"area": 181.0, "cioc": "MHL", "flag": "https://restcountries.eu/data/mhl.svg", "gini": null, "name": "Marshall Islands", "latlng": [9.0, 168.0], "region": "Oceania", "borders": [], "capital": "Majuro", "demonym": "Marshallese", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Marshallese", "iso639_1": "mh", "iso639_2": "mah", "nativeName": "Kajin M̧ajeļ"}], "subregion": "Micronesia", "timezones": ["UTC+12:00"], "alpha2Code": "MH", "alpha3Code": "MHL", "currencies": [{"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "M̧ajeļ", "population": 54880, "numericCode": "584", "altSpellings": ["MH", "Republic of the Marshall Islands", "Aolepān Aorōkin M̧ajeļ"], "callingCodes": ["692"], "translations": {"br": "Ilhas Marshall", "de": "Marshallinseln", "es": "Islas Marshall", "fa": "جزایر مارشال", "fr": "Îles Marshall", "hr": "Maršalovi Otoci", "it": "Isole Marshall", "ja": "マーシャル諸島", "nl": "Marshalleilanden", "pt": "Ilhas Marshall"}, "regionalBlocs": [], "topLevelDomain": [".mh"]}, {"area": null, "cioc": "", "flag": "https://restcountries.eu/data/mtq.svg", "gini": null, "name": "Martinique", "latlng": [14.666667, -61.0], "region": "Americas", "borders": [], "capital": "Fort-de-France", "demonym": "French", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "MQ", "alpha3Code": "MTQ", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Martinique", "population": 378243, "numericCode": "474", "altSpellings": ["MQ"], "callingCodes": ["596"], "translations": {"br": "Martinica", "de": "Martinique", "es": "Martinica", "fa": "مونتسرات", "fr": "Martinique", "hr": "Martinique", "it": "Martinica", "ja": "マルティニーク", "nl": "Martinique", "pt": "Martinica"}, "regionalBlocs": [], "topLevelDomain": [".mq"]}, {"area": 1030700.0, "cioc": "MTN", "flag": "https://restcountries.eu/data/mrt.svg", "gini": 40.5, "name": "Mauritania", "latlng": [20.0, -12.0], "region": "Africa", "borders": ["DZA", "MLI", "SEN", "ESH"], "capital": "Nouakchott", "demonym": "Mauritanian", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Western Africa", "timezones": ["UTC"], "alpha2Code": "MR", "alpha3Code": "MRT", "currencies": [{"code": "MRO", "name": "Mauritanian ouguiya", "symbol": "UM"}], "nativeName": "موريتانيا", "population": 3718678, "numericCode": "478", "altSpellings": ["MR", "Islamic Republic of Mauritania", "al-Jumhūriyyah al-ʾIslāmiyyah al-Mūrītāniyyah"], "callingCodes": ["222"], "translations": {"br": "Mauritânia", "de": "Mauretanien", "es": "Mauritania", "fa": "موریتانی", "fr": "Mauritanie", "hr": "Mauritanija", "it": "Mauritania", "ja": "モーリタニア", "nl": "Mauritanië", "pt": "Mauritânia"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}, {"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".mr"]}, {"area": 2040.0, "cioc": "MRI", "flag": "https://restcountries.eu/data/mus.svg", "gini": null, "name": "Mauritius", "latlng": [-20.28333333, 57.55], "region": "Africa", "borders": [], "capital": "Port Louis", "demonym": "Mauritian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Eastern Africa", "timezones": ["UTC+04:00"], "alpha2Code": "MU", "alpha3Code": "MUS", "currencies": [{"code": "MUR", "name": "Mauritian rupee", "symbol": "₨"}], "nativeName": "Maurice", "population": 1262879, "numericCode": "480", "altSpellings": ["MU", "Republic of Mauritius", "République de Maurice"], "callingCodes": ["230"], "translations": {"br": "Maurício", "de": "Mauritius", "es": "Mauricio", "fa": "موریس", "fr": "Île Maurice", "hr": "Mauricijus", "it": "Mauritius", "ja": "モーリシャス", "nl": "Mauritius", "pt": "Maurícia"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".mu"]}, {"area": null, "cioc": "", "flag": "https://restcountries.eu/data/myt.svg", "gini": null, "name": "Mayotte", "latlng": [-12.83333333, 45.16666666], "region": "Africa", "borders": [], "capital": "Mamoudzou", "demonym": "French", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Eastern Africa", "timezones": ["UTC+03:00"], "alpha2Code": "YT", "alpha3Code": "MYT", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Mayotte", "population": 226915, "numericCode": "175", "altSpellings": ["YT", "Department of Mayotte", "Département de Mayotte"], "callingCodes": ["262"], "translations": {"br": "Mayotte", "de": "Mayotte", "es": "Mayotte", "fa": "مایوت", "fr": "Mayotte", "hr": "Mayotte", "it": "Mayotte", "ja": "マヨット", "nl": "Mayotte", "pt": "Mayotte"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".yt"]}, {"area": 1964375.0, "cioc": "MEX", "flag": "https://restcountries.eu/data/mex.svg", "gini": 47.0, "name": "Mexico", "latlng": [23.0, -102.0], "region": "Americas", "borders": ["BLZ", "GTM", "USA"], "capital": "Mexico City", "demonym": "Mexican", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "Central America", "timezones": ["UTC-08:00", "UTC-07:00", "UTC-06:00"], "alpha2Code": "MX", "alpha3Code": "MEX", "currencies": [{"code": "MXN", "name": "Mexican peso", "symbol": "$"}], "nativeName": "México", "population": 122273473, "numericCode": "484", "altSpellings": ["MX", "Mexicanos", "United Mexican States", "Estados Unidos Mexicanos"], "callingCodes": ["52"], "translations": {"br": "México", "de": "Mexiko", "es": "México", "fa": "مکزیک", "fr": "Mexique", "hr": "Meksiko", "it": "Messico", "ja": "メキシコ", "nl": "Mexico", "pt": "México"}, "regionalBlocs": [{"name": "Pacific Alliance", "acronym": "PA", "otherNames": ["Alianza del Pacífico"], "otherAcronyms": []}, {"name": "North American Free Trade Agreement", "acronym": "NAFTA", "otherNames": ["Tratado de Libre Comercio de América del Norte", "Accord de Libre-échange Nord-Américain"], "otherAcronyms": []}], "topLevelDomain": [".mx"]}, {"area": 702.0, "cioc": "FSM", "flag": "https://restcountries.eu/data/fsm.svg", "gini": null, "name": "Micronesia (Federated States of)", "latlng": [6.91666666, 158.25], "region": "Oceania", "borders": [], "capital": "Palikir", "demonym": "Micronesian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Micronesia", "timezones": ["UTC+10:00", "UTC+11"], "alpha2Code": "FM", "alpha3Code": "FSM", "currencies": [{"code": null, "name": "[D]", "symbol": "$"}, {"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "Micronesia", "population": 102800, "numericCode": "583", "altSpellings": ["FM", "Federated States of Micronesia"], "callingCodes": ["691"], "translations": {"br": "Micronésia", "de": "Mikronesien", "es": "Micronesia", "fa": "ایالات فدرال میکرونزی", "fr": "Micronésie", "hr": "Mikronezija", "it": "Micronesia", "ja": "ミクロネシア連邦", "nl": "Micronesië", "pt": "Micronésia"}, "regionalBlocs": [], "topLevelDomain": [".fm"]}, {"area": 33846.0, "cioc": "MDA", "flag": "https://restcountries.eu/data/mda.svg", "gini": 33.0, "name": "Moldova (Republic of)", "latlng": [47.0, 29.0], "region": "Europe", "borders": ["ROU", "UKR"], "capital": "Chișinău", "demonym": "Moldovan", "languages": [{"name": "Romanian", "iso639_1": "ro", "iso639_2": "ron", "nativeName": "Română"}], "subregion": "Eastern Europe", "timezones": ["UTC+02:00"], "alpha2Code": "MD", "alpha3Code": "MDA", "currencies": [{"code": "MDL", "name": "Moldovan leu", "symbol": "L"}], "nativeName": "Moldova", "population": 3553100, "numericCode": "498", "altSpellings": ["MD", "Republic of Moldova", "Republica Moldova"], "callingCodes": ["373"], "translations": {"br": "Moldávia", "de": "Moldawie", "es": "Moldavia", "fa": "مولداوی", "fr": "Moldavie", "hr": "Moldova", "it": "Moldavia", "ja": "モルドバ共和国", "nl": "Moldavië", "pt": "Moldávia"}, "regionalBlocs": [{"name": "Central European Free Trade Agreement", "acronym": "CEFTA", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".md"]}, {"area": 2.02, "cioc": "MON", "flag": "https://restcountries.eu/data/mco.svg", "gini": null, "name": "Monaco", "latlng": [43.73333333, 7.4], "region": "Europe", "borders": ["FRA"], "capital": "Monaco", "demonym": "Monegasque", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Western Europe", "timezones": ["UTC+01:00"], "alpha2Code": "MC", "alpha3Code": "MCO", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Monaco", "population": 38400, "numericCode": "492", "altSpellings": ["MC", "Principality of Monaco", "Principauté de Monaco"], "callingCodes": ["377"], "translations": {"br": "Mônaco", "de": "Monaco", "es": "Mónaco", "fa": "موناکو", "fr": "Monaco", "hr": "Monako", "it": "Principato di Monaco", "ja": "モナコ", "nl": "Monaco", "pt": "Mónaco"}, "regionalBlocs": [], "topLevelDomain": [".mc"]}, {"area": 1564110.0, "cioc": "MGL", "flag": "https://restcountries.eu/data/mng.svg", "gini": 36.5, "name": "Mongolia", "latlng": [46.0, 105.0], "region": "Asia", "borders": ["CHN", "RUS"], "capital": "Ulan Bator", "demonym": "Mongolian", "languages": [{"name": "Mongolian", "iso639_1": "mn", "iso639_2": "mon", "nativeName": "Монгол хэл"}], "subregion": "Eastern Asia", "timezones": ["UTC+07:00", "UTC+08:00"], "alpha2Code": "MN", "alpha3Code": "MNG", "currencies": [{"code": "MNT", "name": "Mongolian tögrög", "symbol": "₮"}], "nativeName": "Монгол улс", "population": 3093100, "numericCode": "496", "altSpellings": ["MN"], "callingCodes": ["976"], "translations": {"br": "Mongólia", "de": "Mongolei", "es": "Mongolia", "fa": "مغولستان", "fr": "Mongolie", "hr": "Mongolija", "it": "Mongolia", "ja": "モンゴル", "nl": "Mongolië", "pt": "Mongólia"}, "regionalBlocs": [], "topLevelDomain": [".mn"]}, {"area": 13812.0, "cioc": "MNE", "flag": "https://restcountries.eu/data/mne.svg", "gini": 30.0, "name": "Montenegro", "latlng": [42.5, 19.3], "region": "Europe", "borders": ["ALB", "BIH", "HRV", "KOS", "SRB"], "capital": "Podgorica", "demonym": "Montenegrin", "languages": [{"name": "Serbian", "iso639_1": "sr", "iso639_2": "srp", "nativeName": "српски језик"}, {"name": "Bosnian", "iso639_1": "bs", "iso639_2": "bos", "nativeName": "bosanski jezik"}, {"name": "Albanian", "iso639_1": "sq", "iso639_2": "sqi", "nativeName": "Shqip"}, {"name": "Croatian", "iso639_1": "hr", "iso639_2": "hrv", "nativeName": "hrvatski jezik"}], "subregion": "Southern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "ME", "alpha3Code": "MNE", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Црна Гора", "population": 621810, "numericCode": "499", "altSpellings": ["ME", "Crna Gora"], "callingCodes": ["382"], "translations": {"br": "Montenegro", "de": "Montenegro", "es": "Montenegro", "fa": "مونته‌نگرو", "fr": "Monténégro", "hr": "Crna Gora", "it": "Montenegro", "ja": "モンテネグロ", "nl": "Montenegro", "pt": "Montenegro"}, "regionalBlocs": [{"name": "Central European Free Trade Agreement", "acronym": "CEFTA", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".me"]}, {"area": 102.0, "cioc": "", "flag": "https://restcountries.eu/data/msr.svg", "gini": null, "name": "Montserrat", "latlng": [16.75, -62.2], "region": "Americas", "borders": [], "capital": "Plymouth", "demonym": "Montserratian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "MS", "alpha3Code": "MSR", "currencies": [{"code": "XCD", "name": "East Caribbean dollar", "symbol": "$"}], "nativeName": "Montserrat", "population": 4922, "numericCode": "500", "altSpellings": ["MS"], "callingCodes": ["1664"], "translations": {"br": "Montserrat", "de": "Montserrat", "es": "Montserrat", "fa": "مایوت", "fr": "Montserrat", "hr": "Montserrat", "it": "Montserrat", "ja": "モントセラト", "nl": "Montserrat", "pt": "Monserrate"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}], "topLevelDomain": [".ms"]}, {"area": 446550.0, "cioc": "MAR", "flag": "https://restcountries.eu/data/mar.svg", "gini": 40.9, "name": "Morocco", "latlng": [32.0, -5.0], "region": "Africa", "borders": ["DZA", "ESH", "ESP"], "capital": "Rabat", "demonym": "Moroccan", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Northern Africa", "timezones": ["UTC"], "alpha2Code": "MA", "alpha3Code": "MAR", "currencies": [{"code": "MAD", "name": "Moroccan dirham", "symbol": "د.م."}], "nativeName": "المغرب", "population": 33337529, "numericCode": "504", "altSpellings": ["MA", "Kingdom of Morocco", "Al-Mamlakah al-Maġribiyah"], "callingCodes": ["212"], "translations": {"br": "Marrocos", "de": "Marokko", "es": "Marruecos", "fa": "مراکش", "fr": "Maroc", "hr": "Maroko", "it": "Marocco", "ja": "モロッコ", "nl": "Marokko", "pt": "Marrocos"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}, {"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".ma"]}, {"area": 801590.0, "cioc": "MOZ", "flag": "https://restcountries.eu/data/moz.svg", "gini": 45.7, "name": "Mozambique", "latlng": [-18.25, 35.0], "region": "Africa", "borders": ["MWI", "ZAF", "SWZ", "TZA", "ZMB", "ZWE"], "capital": "Maputo", "demonym": "Mozambican", "languages": [{"name": "Portuguese", "iso639_1": "pt", "iso639_2": "por", "nativeName": "Português"}], "subregion": "Eastern Africa", "timezones": ["UTC+02:00"], "alpha2Code": "MZ", "alpha3Code": "MOZ", "currencies": [{"code": "MZN", "name": "Mozambican metical", "symbol": "MT"}], "nativeName": "Moçambique", "population": 26423700, "numericCode": "508", "altSpellings": ["MZ", "Republic of Mozambique", "República de Moçambique"], "callingCodes": ["258"], "translations": {"br": "Moçambique", "de": "Mosambik", "es": "Mozambique", "fa": "موزامبیک", "fr": "Mozambique", "hr": "Mozambik", "it": "Mozambico", "ja": "モザンビーク", "nl": "Mozambique", "pt": "Moçambique"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".mz"]}, {"area": 676578.0, "cioc": "MYA", "flag": "https://restcountries.eu/data/mmr.svg", "gini": null, "name": "Myanmar", "latlng": [22.0, 98.0], "region": "Asia", "borders": ["BGD", "CHN", "IND", "LAO", "THA"], "capital": "Naypyidaw", "demonym": "Burmese", "languages": [{"name": "Burmese", "iso639_1": "my", "iso639_2": "mya", "nativeName": "ဗမာစာ"}], "subregion": "South-Eastern Asia", "timezones": ["UTC+06:30"], "alpha2Code": "MM", "alpha3Code": "MMR", "currencies": [{"code": "MMK", "name": "Burmese kyat", "symbol": "Ks"}], "nativeName": "Myanma", "population": 51419420, "numericCode": "104", "altSpellings": ["MM", "Burma", "Republic of the Union of Myanmar", "Pyidaunzu Thanmăda Myăma Nainngandaw"], "callingCodes": ["95"], "translations": {"br": "Myanmar", "de": "Myanmar", "es": "Myanmar", "fa": "میانمار", "fr": "Myanmar", "hr": "Mijanmar", "it": "Birmania", "ja": "ミャンマー", "nl": "Myanmar", "pt": "Myanmar"}, "regionalBlocs": [{"name": "Association of Southeast Asian Nations", "acronym": "ASEAN", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".mm"]}, {"area": 825615.0, "cioc": "NAM", "flag": "https://restcountries.eu/data/nam.svg", "gini": 63.9, "name": "Namibia", "latlng": [-22.0, 17.0], "region": "Africa", "borders": ["AGO", "BWA", "ZAF", "ZMB"], "capital": "Windhoek", "demonym": "Namibian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Afrikaans", "iso639_1": "af", "iso639_2": "afr", "nativeName": "Afrikaans"}], "subregion": "Southern Africa", "timezones": ["UTC+01:00"], "alpha2Code": "NA", "alpha3Code": "NAM", "currencies": [{"code": "NAD", "name": "Namibian dollar", "symbol": "$"}, {"code": "ZAR", "name": "South African rand", "symbol": "R"}], "nativeName": "Namibia", "population": 2324388, "numericCode": "516", "altSpellings": ["NA", "Namibië", "Republic of Namibia"], "callingCodes": ["264"], "translations": {"br": "Namíbia", "de": "Namibia", "es": "Namibia", "fa": "نامیبیا", "fr": "Namibie", "hr": "Namibija", "it": "Namibia", "ja": "ナミビア", "nl": "Namibië", "pt": "Namíbia"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".na"]}, {"area": 21.0, "cioc": "NRU", "flag": "https://restcountries.eu/data/nru.svg", "gini": null, "name": "Nauru", "latlng": [-0.53333333, 166.91666666], "region": "Oceania", "borders": [], "capital": "Yaren", "demonym": "Nauruan", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Nauruan", "iso639_1": "na", "iso639_2": "nau", "nativeName": "Dorerin Naoero"}], "subregion": "Micronesia", "timezones": ["UTC+12:00"], "alpha2Code": "NR", "alpha3Code": "NRU", "currencies": [{"code": "AUD", "name": "Australian dollar", "symbol": "$"}, {"code": "(none)", "name": null, "symbol": "$"}], "nativeName": "Nauru", "population": 10084, "numericCode": "520", "altSpellings": ["NR", "Naoero", "Pleasant Island", "Republic of Nauru", "Ripublik Naoero"], "callingCodes": ["674"], "translations": {"br": "Nauru", "de": "Nauru", "es": "Nauru", "fa": "نائورو", "fr": "Nauru", "hr": "Nauru", "it": "Nauru", "ja": "ナウル", "nl": "Nauru", "pt": "Nauru"}, "regionalBlocs": [], "topLevelDomain": [".nr"]}, {"area": 147181.0, "cioc": "NEP", "flag": "https://restcountries.eu/data/npl.svg", "gini": 32.8, "name": "Nepal", "latlng": [28.0, 84.0], "region": "Asia", "borders": ["CHN", "IND"], "capital": "Kathmandu", "demonym": "Nepalese", "languages": [{"name": "Nepali", "iso639_1": "ne", "iso639_2": "nep", "nativeName": "नेपाली"}], "subregion": "Southern Asia", "timezones": ["UTC+05:45"], "alpha2Code": "NP", "alpha3Code": "NPL", "currencies": [{"code": "NPR", "name": "Nepalese rupee", "symbol": "₨"}], "nativeName": "नेपाल", "population": 28431500, "numericCode": "524", "altSpellings": ["NP", "Federal Democratic Republic of Nepal", "Loktāntrik Ganatantra Nepāl"], "callingCodes": ["977"], "translations": {"br": "Nepal", "de": "Népal", "es": "Nepal", "fa": "نپال", "fr": "Népal", "hr": "Nepal", "it": "Nepal", "ja": "ネパール", "nl": "Nepal", "pt": "Nepal"}, "regionalBlocs": [{"name": "South Asian Association for Regional Cooperation", "acronym": "SAARC", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".np"]}, {"area": 41850.0, "cioc": "NED", "flag": "https://restcountries.eu/data/nld.svg", "gini": 30.9, "name": "Netherlands", "latlng": [52.5, 5.75], "region": "Europe", "borders": ["BEL", "DEU"], "capital": "Amsterdam", "demonym": "Dutch", "languages": [{"name": "Dutch", "iso639_1": "nl", "iso639_2": "nld", "nativeName": "Nederlands"}], "subregion": "Western Europe", "timezones": ["UTC-04:00", "UTC+01:00"], "alpha2Code": "NL", "alpha3Code": "NLD", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Nederland", "population": 17019800, "numericCode": "528", "altSpellings": ["NL", "Holland", "Nederland"], "callingCodes": ["31"], "translations": {"br": "Holanda", "de": "Niederlande", "es": "Países Bajos", "fa": "پادشاهی هلند", "fr": "Pays-Bas", "hr": "Nizozemska", "it": "Paesi Bassi", "ja": "オランダ", "nl": "Nederland", "pt": "Países Baixos"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".nl"]}, {"area": 18575.0, "cioc": "", "flag": "https://restcountries.eu/data/ncl.svg", "gini": null, "name": "New Caledonia", "latlng": [-21.5, 165.5], "region": "Oceania", "borders": [], "capital": "Nouméa", "demonym": "New Caledonian", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Melanesia", "timezones": ["UTC+11:00"], "alpha2Code": "NC", "alpha3Code": "NCL", "currencies": [{"code": "XPF", "name": "CFP franc", "symbol": "Fr"}], "nativeName": "Nouvelle-Calédonie", "population": 268767, "numericCode": "540", "altSpellings": ["NC"], "callingCodes": ["687"], "translations": {"br": "Nova Caledônia", "de": "Neukaledonien", "es": "Nueva Caledonia", "fa": "کالدونیای جدید", "fr": "Nouvelle-Calédonie", "hr": "Nova Kaledonija", "it": "Nuova Caledonia", "ja": "ニューカレドニア", "nl": "Nieuw-Caledonië", "pt": "Nova Caledónia"}, "regionalBlocs": [], "topLevelDomain": [".nc"]}, {"area": 270467.0, "cioc": "NZL", "flag": "https://restcountries.eu/data/nzl.svg", "gini": 36.2, "name": "New Zealand", "latlng": [-41.0, 174.0], "region": "Oceania", "borders": [], "capital": "Wellington", "demonym": "New Zealander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Māori", "iso639_1": "mi", "iso639_2": "mri", "nativeName": "te reo Māori"}], "subregion": "Australia and New Zealand", "timezones": ["UTC-11:00", "UTC-10:00", "UTC+12:00", "UTC+12:45", "UTC+13:00"], "alpha2Code": "NZ", "alpha3Code": "NZL", "currencies": [{"code": "NZD", "name": "New Zealand dollar", "symbol": "$"}], "nativeName": "New Zealand", "population": 4697854, "numericCode": "554", "altSpellings": ["NZ", "Aotearoa"], "callingCodes": ["64"], "translations": {"br": "Nova Zelândia", "de": "Neuseeland", "es": "Nueva Zelanda", "fa": "نیوزیلند", "fr": "Nouvelle-Zélande", "hr": "Novi Zeland", "it": "Nuova Zelanda", "ja": "ニュージーランド", "nl": "Nieuw-Zeeland", "pt": "Nova Zelândia"}, "regionalBlocs": [], "topLevelDomain": [".nz"]}, {"area": 130373.0, "cioc": "NCA", "flag": "https://restcountries.eu/data/nic.svg", "gini": 40.5, "name": "Nicaragua", "latlng": [13.0, -85.0], "region": "Americas", "borders": ["CRI", "HND"], "capital": "Managua", "demonym": "Nicaraguan", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "Central America", "timezones": ["UTC-06:00"], "alpha2Code": "NI", "alpha3Code": "NIC", "currencies": [{"code": "NIO", "name": "Nicaraguan córdoba", "symbol": "C$"}], "nativeName": "Nicaragua", "population": 6262703, "numericCode": "558", "altSpellings": ["NI", "Republic of Nicaragua", "República de Nicaragua"], "callingCodes": ["505"], "translations": {"br": "Nicarágua", "de": "Nicaragua", "es": "Nicaragua", "fa": "نیکاراگوئه", "fr": "Nicaragua", "hr": "Nikaragva", "it": "Nicaragua", "ja": "ニカラグア", "nl": "Nicaragua", "pt": "Nicarágua"}, "regionalBlocs": [{"name": "Central American Integration System", "acronym": "CAIS", "otherNames": ["Sistema de la Integración Centroamericana,"], "otherAcronyms": ["SICA"]}], "topLevelDomain": [".ni"]}, {"area": 1267000.0, "cioc": "NIG", "flag": "https://restcountries.eu/data/ner.svg", "gini": 34.6, "name": "Niger", "latlng": [16.0, 8.0], "region": "Africa", "borders": ["DZA", "BEN", "BFA", "TCD", "LBY", "MLI", "NGA"], "capital": "Niamey", "demonym": "Nigerien", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Western Africa", "timezones": ["UTC+01:00"], "alpha2Code": "NE", "alpha3Code": "NER", "currencies": [{"code": "XOF", "name": "West African CFA franc", "symbol": "Fr"}], "nativeName": "Niger", "population": 20715000, "numericCode": "562", "altSpellings": ["NE", "Nijar", "Republic of Niger", "République du Niger"], "callingCodes": ["227"], "translations": {"br": "Níger", "de": "Niger", "es": "Níger", "fa": "نیجر", "fr": "Niger", "hr": "Niger", "it": "Niger", "ja": "ニジェール", "nl": "Niger", "pt": "Níger"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".ne"]}, {"area": 923768.0, "cioc": "NGR", "flag": "https://restcountries.eu/data/nga.svg", "gini": 48.8, "name": "Nigeria", "latlng": [10.0, 8.0], "region": "Africa", "borders": ["BEN", "CMR", "TCD", "NER"], "capital": "Abuja", "demonym": "Nigerian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Western Africa", "timezones": ["UTC+01:00"], "alpha2Code": "NG", "alpha3Code": "NGA", "currencies": [{"code": "NGN", "name": "Nigerian naira", "symbol": "₦"}], "nativeName": "Nigeria", "population": 186988000, "numericCode": "566", "altSpellings": ["NG", "Nijeriya", "Naíjíríà", "Federal Republic of Nigeria"], "callingCodes": ["234"], "translations": {"br": "Nigéria", "de": "Nigeria", "es": "Nigeria", "fa": "نیجریه", "fr": "Nigéria", "hr": "Nigerija", "it": "Nigeria", "ja": "ナイジェリア", "nl": "Nigeria", "pt": "Nigéria"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".ng"]}, {"area": 260.0, "cioc": "", "flag": "https://restcountries.eu/data/niu.svg", "gini": null, "name": "Niue", "latlng": [-19.03333333, -169.86666666], "region": "Oceania", "borders": [], "capital": "Alofi", "demonym": "Niuean", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Polynesia", "timezones": ["UTC-11:00"], "alpha2Code": "NU", "alpha3Code": "NIU", "currencies": [{"code": "NZD", "name": "New Zealand dollar", "symbol": "$"}, {"code": "(none)", "name": "Niue dollar", "symbol": "$"}], "nativeName": "Niuē", "population": 1470, "numericCode": "570", "altSpellings": ["NU"], "callingCodes": ["683"], "translations": {"br": "Niue", "de": "Niue", "es": "Niue", "fa": "نیووی", "fr": "Niue", "hr": "Niue", "it": "Niue", "ja": "ニウエ", "nl": "Niue", "pt": "Niue"}, "regionalBlocs": [], "topLevelDomain": [".nu"]}, {"area": 36.0, "cioc": "", "flag": "https://restcountries.eu/data/nfk.svg", "gini": null, "name": "Norfolk Island", "latlng": [-29.03333333, 167.95], "region": "Oceania", "borders": [], "capital": "Kingston", "demonym": "Norfolk Islander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Australia and New Zealand", "timezones": ["UTC+11:30"], "alpha2Code": "NF", "alpha3Code": "NFK", "currencies": [{"code": "AUD", "name": "Australian dollar", "symbol": "$"}], "nativeName": "Norfolk Island", "population": 2302, "numericCode": "574", "altSpellings": ["NF", "Territory of Norfolk Island", "Teratri of Norf'k Ailen"], "callingCodes": ["672"], "translations": {"br": "Ilha Norfolk", "de": "Norfolkinsel", "es": "Isla de Norfolk", "fa": "جزیره نورفک", "fr": "Île de Norfolk", "hr": "Otok Norfolk", "it": "Isola Norfolk", "ja": "ノーフォーク島", "nl": "Norfolkeiland", "pt": "Ilha Norfolk"}, "regionalBlocs": [], "topLevelDomain": [".nf"]}, {"area": 120538.0, "cioc": "PRK", "flag": "https://restcountries.eu/data/prk.svg", "gini": null, "name": "Korea (Democratic People's Republic of)", "latlng": [40.0, 127.0], "region": "Asia", "borders": ["CHN", "KOR", "RUS"], "capital": "Pyongyang", "demonym": "North Korean", "languages": [{"name": "Korean", "iso639_1": "ko", "iso639_2": "kor", "nativeName": "한국어"}], "subregion": "Eastern Asia", "timezones": ["UTC+09:00"], "alpha2Code": "KP", "alpha3Code": "PRK", "currencies": [{"code": "KPW", "name": "North Korean won", "symbol": "₩"}], "nativeName": "북한", "population": 25281000, "numericCode": "408", "altSpellings": ["KP", "Democratic People's Republic of Korea", "조선민주주의인민공화국", "Chosŏn Minjujuŭi Inmin Konghwaguk"], "callingCodes": ["850"], "translations": {"br": "Coreia do Norte", "de": "Nordkorea", "es": "Corea del Norte", "fa": "کره جنوبی", "fr": "Corée du Nord", "hr": "Sjeverna Koreja", "it": "Corea del Nord", "ja": "朝鮮民主主義人民共和国", "nl": "Noord-Korea", "pt": "Coreia do Norte"}, "regionalBlocs": [], "topLevelDomain": [".kp"]}, {"area": 464.0, "cioc": "", "flag": "https://restcountries.eu/data/mnp.svg", "gini": null, "name": "Northern Mariana Islands", "latlng": [15.2, 145.75], "region": "Oceania", "borders": [], "capital": "Saipan", "demonym": "American", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Chamorro", "iso639_1": "ch", "iso639_2": "cha", "nativeName": "Chamoru"}], "subregion": "Micronesia", "timezones": ["UTC+10:00"], "alpha2Code": "MP", "alpha3Code": "MNP", "currencies": [{"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "Northern Mariana Islands", "population": 56940, "numericCode": "580", "altSpellings": ["MP", "Commonwealth of the Northern Mariana Islands", "Sankattan Siha Na Islas Mariånas"], "callingCodes": ["1670"], "translations": {"br": "Ilhas Marianas", "de": "Nördliche Marianen", "es": "Islas Marianas del Norte", "fa": "جزایر ماریانای شمالی", "fr": "Îles Mariannes du Nord", "hr": "Sjevernomarijanski otoci", "it": "Isole Marianne Settentrionali", "ja": "北マリアナ諸島", "nl": "Noordelijke Marianeneilanden", "pt": "Ilhas Marianas"}, "regionalBlocs": [], "topLevelDomain": [".mp"]}, {"area": 323802.0, "cioc": "NOR", "flag": "https://restcountries.eu/data/nor.svg", "gini": 25.8, "name": "Norway", "latlng": [62.0, 10.0], "region": "Europe", "borders": ["FIN", "SWE", "RUS"], "capital": "Oslo", "demonym": "Norwegian", "languages": [{"name": "Norwegian", "iso639_1": "no", "iso639_2": "nor", "nativeName": "Norsk"}, {"name": "Norwegian Bokmål", "iso639_1": "nb", "iso639_2": "nob", "nativeName": "Norsk bokmål"}, {"name": "Norwegian Nynorsk", "iso639_1": "nn", "iso639_2": "nno", "nativeName": "Norsk nynorsk"}], "subregion": "Northern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "NO", "alpha3Code": "NOR", "currencies": [{"code": "NOK", "name": "Norwegian krone", "symbol": "kr"}], "nativeName": "Norge", "population": 5223256, "numericCode": "578", "altSpellings": ["NO", "Norge", "Noreg", "Kingdom of Norway", "Kongeriket Norge", "Kongeriket Noreg"], "callingCodes": ["47"], "translations": {"br": "Noruega", "de": "Norwegen", "es": "Noruega", "fa": "نروژ", "fr": "Norvège", "hr": "Norveška", "it": "Norvegia", "ja": "ノルウェー", "nl": "Noorwegen", "pt": "Noruega"}, "regionalBlocs": [{"name": "European Free Trade Association", "acronym": "EFTA", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".no"]}, {"area": 309500.0, "cioc": "OMA", "flag": "https://restcountries.eu/data/omn.svg", "gini": null, "name": "Oman", "latlng": [21.0, 57.0], "region": "Asia", "borders": ["SAU", "ARE", "YEM"], "capital": "Muscat", "demonym": "Omani", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Western Asia", "timezones": ["UTC+04:00"], "alpha2Code": "OM", "alpha3Code": "OMN", "currencies": [{"code": "OMR", "name": "Omani rial", "symbol": "ر.ع."}], "nativeName": "عمان", "population": 4420133, "numericCode": "512", "altSpellings": ["OM", "Sultanate of Oman", "Salṭanat ʻUmān"], "callingCodes": ["968"], "translations": {"br": "Omã", "de": "Oman", "es": "Omán", "fa": "عمان", "fr": "Oman", "hr": "Oman", "it": "oman", "ja": "オマーン", "nl": "Oman", "pt": "Omã"}, "regionalBlocs": [{"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".om"]}, {"area": 881912.0, "cioc": "PAK", "flag": "https://restcountries.eu/data/pak.svg", "gini": 30.0, "name": "Pakistan", "latlng": [30.0, 70.0], "region": "Asia", "borders": ["AFG", "CHN", "IND", "IRN"], "capital": "Islamabad", "demonym": "Pakistani", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Urdu", "iso639_1": "ur", "iso639_2": "urd", "nativeName": "اردو"}], "subregion": "Southern Asia", "timezones": ["UTC+05:00"], "alpha2Code": "PK", "alpha3Code": "PAK", "currencies": [{"code": "PKR", "name": "Pakistani rupee", "symbol": "₨"}], "nativeName": "Pakistan", "population": 194125062, "numericCode": "586", "altSpellings": ["PK", "Pākistān", "Islamic Republic of Pakistan", "Islāmī Jumhūriya'eh Pākistān"], "callingCodes": ["92"], "translations": {"br": "Paquistão", "de": "Pakistan", "es": "Pakistán", "fa": "پاکستان", "fr": "Pakistan", "hr": "Pakistan", "it": "Pakistan", "ja": "パキスタン", "nl": "Pakistan", "pt": "Paquistão"}, "regionalBlocs": [{"name": "South Asian Association for Regional Cooperation", "acronym": "SAARC", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".pk"]}, {"area": 459.0, "cioc": "PLW", "flag": "https://restcountries.eu/data/plw.svg", "gini": null, "name": "Palau", "latlng": [7.5, 134.5], "region": "Oceania", "borders": [], "capital": "Ngerulmud", "demonym": "Palauan", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Micronesia", "timezones": ["UTC+09:00"], "alpha2Code": "PW", "alpha3Code": "PLW", "currencies": [{"code": "(none)", "name": "[E]", "symbol": "$"}, {"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "Palau", "population": 17950, "numericCode": "585", "altSpellings": ["PW", "Republic of Palau", "Beluu er a Belau"], "callingCodes": ["680"], "translations": {"br": "Palau", "de": "Palau", "es": "Palau", "fa": "پالائو", "fr": "Palaos", "hr": "Palau", "it": "Palau", "ja": "パラオ", "nl": "Palau", "pt": "Palau"}, "regionalBlocs": [], "topLevelDomain": [".pw"]}, {"area": null, "cioc": "PLE", "flag": "https://restcountries.eu/data/pse.svg", "gini": 35.5, "name": "Palestine, State of", "latlng": [31.9, 35.2], "region": "Asia", "borders": ["ISR", "EGY", "JOR"], "capital": "Ramallah", "demonym": "Palestinian", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Western Asia", "timezones": ["UTC+02:00"], "alpha2Code": "PS", "alpha3Code": "PSE", "currencies": [{"code": "ILS", "name": "Israeli new sheqel", "symbol": "₪"}], "nativeName": "فلسطين", "population": 4682467, "numericCode": "275", "altSpellings": ["PS", "State of Palestine", "Dawlat Filasṭin"], "callingCodes": ["970"], "translations": {"br": "Palestina", "de": "Palästina", "es": "Palestina", "fa": "فلسطین", "fr": "Palestine", "hr": "Palestina", "it": "Palestina", "ja": "パレスチナ", "nl": "Palestijnse gebieden", "pt": "Palestina"}, "regionalBlocs": [{"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".ps"]}, {"area": 75417.0, "cioc": "PAN", "flag": "https://restcountries.eu/data/pan.svg", "gini": 51.9, "name": "Panama", "latlng": [9.0, -80.0], "region": "Americas", "borders": ["COL", "CRI"], "capital": "Panama City", "demonym": "Panamanian", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "Central America", "timezones": ["UTC-05:00"], "alpha2Code": "PA", "alpha3Code": "PAN", "currencies": [{"code": "PAB", "name": "Panamanian balboa", "symbol": "B/."}, {"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "Panamá", "population": 3814672, "numericCode": "591", "altSpellings": ["PA", "Republic of Panama", "República de Panamá"], "callingCodes": ["507"], "translations": {"br": "Panamá", "de": "Panama", "es": "Panamá", "fa": "پاناما", "fr": "Panama", "hr": "Panama", "it": "Panama", "ja": "パナマ", "nl": "Panama", "pt": "Panamá"}, "regionalBlocs": [{"name": "Central American Integration System", "acronym": "CAIS", "otherNames": ["Sistema de la Integración Centroamericana,"], "otherAcronyms": ["SICA"]}], "topLevelDomain": [".pa"]}, {"area": 462840.0, "cioc": "PNG", "flag": "https://restcountries.eu/data/png.svg", "gini": 50.9, "name": "Papua New Guinea", "latlng": [-6.0, 147.0], "region": "Oceania", "borders": ["IDN"], "capital": "Port Moresby", "demonym": "Papua New Guinean", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Melanesia", "timezones": ["UTC+10:00"], "alpha2Code": "PG", "alpha3Code": "PNG", "currencies": [{"code": "PGK", "name": "Papua New Guinean kina", "symbol": "K"}], "nativeName": "Papua Niugini", "population": 8083700, "numericCode": "598", "altSpellings": ["PG", "Independent State of Papua New Guinea", "Independen Stet bilong Papua Niugini"], "callingCodes": ["675"], "translations": {"br": "Papua Nova Guiné", "de": "Papua-Neuguinea", "es": "Papúa Nueva Guinea", "fa": "پاپوآ گینه نو", "fr": "Papouasie-Nouvelle-Guinée", "hr": "Papua Nova Gvineja", "it": "Papua Nuova Guinea", "ja": "パプアニューギニア", "nl": "Papoea-Nieuw-Guinea", "pt": "Papua Nova Guiné"}, "regionalBlocs": [], "topLevelDomain": [".pg"]}, {"area": 406752.0, "cioc": "PAR", "flag": "https://restcountries.eu/data/pry.svg", "gini": 52.4, "name": "Paraguay", "latlng": [-23.0, -58.0], "region": "Americas", "borders": ["ARG", "BOL", "BRA"], "capital": "Asunción", "demonym": "Paraguayan", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}, {"name": "Guaraní", "iso639_1": "gn", "iso639_2": "grn", "nativeName": "Avañe'ẽ"}], "subregion": "South America", "timezones": ["UTC-04:00"], "alpha2Code": "PY", "alpha3Code": "PRY", "currencies": [{"code": "PYG", "name": "Paraguayan guaraní", "symbol": "₲"}], "nativeName": "Paraguay", "population": 6854536, "numericCode": "600", "altSpellings": ["PY", "Republic of Paraguay", "República del Paraguay", "Tetã Paraguái"], "callingCodes": ["595"], "translations": {"br": "Paraguai", "de": "Paraguay", "es": "Paraguay", "fa": "پاراگوئه", "fr": "Paraguay", "hr": "Paragvaj", "it": "Paraguay", "ja": "パラグアイ", "nl": "Paraguay", "pt": "Paraguai"}, "regionalBlocs": [{"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}], "topLevelDomain": [".py"]}, {"area": 1285216.0, "cioc": "PER", "flag": "https://restcountries.eu/data/per.svg", "gini": 48.1, "name": "Peru", "latlng": [-10.0, -76.0], "region": "Americas", "borders": ["BOL", "BRA", "CHL", "COL", "ECU"], "capital": "Lima", "demonym": "Peruvian", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "South America", "timezones": ["UTC-05:00"], "alpha2Code": "PE", "alpha3Code": "PER", "currencies": [{"code": "PEN", "name": "Peruvian sol", "symbol": "S/."}], "nativeName": "Perú", "population": 31488700, "numericCode": "604", "altSpellings": ["PE", "Republic of Peru", " República del Perú"], "callingCodes": ["51"], "translations": {"br": "Peru", "de": "Peru", "es": "Perú", "fa": "پرو", "fr": "Pérou", "hr": "Peru", "it": "Perù", "ja": "ペルー", "nl": "Peru", "pt": "Peru"}, "regionalBlocs": [{"name": "Pacific Alliance", "acronym": "PA", "otherNames": ["Alianza del Pacífico"], "otherAcronyms": []}, {"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}], "topLevelDomain": [".pe"]}, {"area": 342353.0, "cioc": "PHI", "flag": "https://restcountries.eu/data/phl.svg", "gini": 43.0, "name": "Philippines", "latlng": [13.0, 122.0], "region": "Asia", "borders": [], "capital": "Manila", "demonym": "Filipino", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "South-Eastern Asia", "timezones": ["UTC+08:00"], "alpha2Code": "PH", "alpha3Code": "PHL", "currencies": [{"code": "PHP", "name": "Philippine peso", "symbol": "₱"}], "nativeName": "Pilipinas", "population": 103279800, "numericCode": "608", "altSpellings": ["PH", "Republic of the Philippines", "Repúblika ng Pilipinas"], "callingCodes": ["63"], "translations": {"br": "Filipinas", "de": "Philippinen", "es": "Filipinas", "fa": "جزایر الندفیلیپین", "fr": "Philippines", "hr": "Filipini", "it": "Filippine", "ja": "フィリピン", "nl": "Filipijnen", "pt": "Filipinas"}, "regionalBlocs": [{"name": "Association of Southeast Asian Nations", "acronym": "ASEAN", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".ph"]}, {"area": 47.0, "cioc": "", "flag": "https://restcountries.eu/data/pcn.svg", "gini": null, "name": "Pitcairn", "latlng": [-25.06666666, -130.1], "region": "Oceania", "borders": [], "capital": "Adamstown", "demonym": "Pitcairn Islander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Polynesia", "timezones": ["UTC-08:00"], "alpha2Code": "PN", "alpha3Code": "PCN", "currencies": [{"code": "NZD", "name": "New Zealand dollar", "symbol": "$"}, {"code": null, "name": "Pitcairn Islands dollar", "symbol": "$"}], "nativeName": "Pitcairn Islands", "population": 56, "numericCode": "612", "altSpellings": ["PN", "Pitcairn Henderson Ducie and Oeno Islands"], "callingCodes": ["64"], "translations": {"br": "Ilhas Pitcairn", "de": "Pitcairn", "es": "Islas Pitcairn", "fa": "پیتکرن", "fr": "Îles Pitcairn", "hr": "Pitcairnovo otočje", "it": "Isole Pitcairn", "ja": "ピトケアン", "nl": "Pitcairneilanden", "pt": "Ilhas Picárnia"}, "regionalBlocs": [], "topLevelDomain": [".pn"]}, {"area": 312679.0, "cioc": "POL", "flag": "https://restcountries.eu/data/pol.svg", "gini": 34.1, "name": "Poland", "latlng": [52.0, 20.0], "region": "Europe", "borders": ["BLR", "CZE", "DEU", "LTU", "RUS", "SVK", "UKR"], "capital": "Warsaw", "demonym": "Polish", "languages": [{"name": "Polish", "iso639_1": "pl", "iso639_2": "pol", "nativeName": "język polski"}], "subregion": "Eastern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "PL", "alpha3Code": "POL", "currencies": [{"code": "PLN", "name": "Polish złoty", "symbol": "zł"}], "nativeName": "Polska", "population": 38437239, "numericCode": "616", "altSpellings": ["PL", "Republic of Poland", "Rzeczpospolita Polska"], "callingCodes": ["48"], "translations": {"br": "Polônia", "de": "Polen", "es": "Polonia", "fa": "لهستان", "fr": "Pologne", "hr": "Poljska", "it": "Polonia", "ja": "ポーランド", "nl": "Polen", "pt": "Polónia"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".pl"]}, {"area": 92090.0, "cioc": "POR", "flag": "https://restcountries.eu/data/prt.svg", "gini": 38.5, "name": "Portugal", "latlng": [39.5, -8.0], "region": "Europe", "borders": ["ESP"], "capital": "Lisbon", "demonym": "Portuguese", "languages": [{"name": "Portuguese", "iso639_1": "pt", "iso639_2": "por", "nativeName": "Português"}], "subregion": "Southern Europe", "timezones": ["UTC-01:00", "UTC"], "alpha2Code": "PT", "alpha3Code": "PRT", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Portugal", "population": 10374822, "numericCode": "620", "altSpellings": ["PT", "Portuguesa", "Portuguese Republic", "República Portuguesa"], "callingCodes": ["351"], "translations": {"br": "Portugal", "de": "Portugal", "es": "Portugal", "fa": "پرتغال", "fr": "Portugal", "hr": "Portugal", "it": "Portogallo", "ja": "ポルトガル", "nl": "Portugal", "pt": "Portugal"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".pt"]}, {"area": 8870.0, "cioc": "PUR", "flag": "https://restcountries.eu/data/pri.svg", "gini": null, "name": "Puerto Rico", "latlng": [18.25, -66.5], "region": "Americas", "borders": [], "capital": "San Juan", "demonym": "Puerto Rican", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}, {"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "PR", "alpha3Code": "PRI", "currencies": [{"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "Puerto Rico", "population": 3474182, "numericCode": "630", "altSpellings": ["PR", "Commonwealth of Puerto Rico", "Estado Libre Asociado de Puerto Rico"], "callingCodes": ["1787", "1939"], "translations": {"br": "Porto Rico", "de": "Puerto Rico", "es": "Puerto Rico", "fa": "پورتو ریکو", "fr": "Porto Rico", "hr": "Portoriko", "it": "Porto Rico", "ja": "プエルトリコ", "nl": "Puerto Rico", "pt": "Porto Rico"}, "regionalBlocs": [], "topLevelDomain": [".pr"]}, {"area": 11586.0, "cioc": "QAT", "flag": "https://restcountries.eu/data/qat.svg", "gini": 41.1, "name": "Qatar", "latlng": [25.5, 51.25], "region": "Asia", "borders": ["SAU"], "capital": "Doha", "demonym": "Qatari", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Western Asia", "timezones": ["UTC+03:00"], "alpha2Code": "QA", "alpha3Code": "QAT", "currencies": [{"code": "QAR", "name": "Qatari riyal", "symbol": "ر.ق"}], "nativeName": "قطر", "population": 2587564, "numericCode": "634", "altSpellings": ["QA", "State of Qatar", "Dawlat Qaṭar"], "callingCodes": ["974"], "translations": {"br": "Catar", "de": "Katar", "es": "Catar", "fa": "قطر", "fr": "Qatar", "hr": "Katar", "it": "Qatar", "ja": "カタール", "nl": "Qatar", "pt": "Catar"}, "regionalBlocs": [{"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".qa"]}, {"area": 10908.0, "cioc": null, "flag": "https://restcountries.eu/data/kos.svg", "gini": null, "name": "Republic of Kosovo", "latlng": [42.666667, 21.166667], "region": "Europe", "borders": ["ALB", "MKD", "MNE", "SRB"], "capital": "Pristina", "demonym": "Kosovar", "languages": [{"name": "Albanian", "iso639_1": "sq", "iso639_2": "sqi", "nativeName": "Shqip"}, {"name": "Serbian", "iso639_1": "sr", "iso639_2": "srp", "nativeName": "српски језик"}], "subregion": "Eastern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "XK", "alpha3Code": "KOS", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Republika e Kosovës", "population": 1733842, "numericCode": null, "altSpellings": ["XK", "Република Косово"], "callingCodes": ["383"], "translations": {"br": "Kosovo", "de": null, "es": "Kosovo", "fa": "کوزوو", "fr": null, "hr": "Kosovo", "it": null, "ja": null, "nl": null, "pt": "Kosovo"}, "regionalBlocs": [{"name": "Central European Free Trade Agreement", "acronym": "CEFTA", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [""]}, {"area": null, "cioc": "", "flag": "https://restcountries.eu/data/reu.svg", "gini": null, "name": "Réunion", "latlng": [-21.15, 55.5], "region": "Africa", "borders": [], "capital": "Saint-Denis", "demonym": "French", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Eastern Africa", "timezones": ["UTC+04:00"], "alpha2Code": "RE", "alpha3Code": "REU", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "La Réunion", "population": 840974, "numericCode": "638", "altSpellings": ["RE", "Reunion"], "callingCodes": ["262"], "translations": {"br": "Reunião", "de": "Réunion", "es": "Reunión", "fa": "رئونیون", "fr": "Réunion", "hr": "Réunion", "it": "Riunione", "ja": "レユニオン", "nl": "Réunion", "pt": "Reunião"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".re"]}, {"area": 238391.0, "cioc": "ROU", "flag": "https://restcountries.eu/data/rou.svg", "gini": 30.0, "name": "Romania", "latlng": [46.0, 25.0], "region": "Europe", "borders": ["BGR", "HUN", "MDA", "SRB", "UKR"], "capital": "Bucharest", "demonym": "Romanian", "languages": [{"name": "Romanian", "iso639_1": "ro", "iso639_2": "ron", "nativeName": "Română"}], "subregion": "Eastern Europe", "timezones": ["UTC+02:00"], "alpha2Code": "RO", "alpha3Code": "ROU", "currencies": [{"code": "RON", "name": "Romanian leu", "symbol": "lei"}], "nativeName": "România", "population": 19861408, "numericCode": "642", "altSpellings": ["RO", "Rumania", "Roumania", "România"], "callingCodes": ["40"], "translations": {"br": "Romênia", "de": "Rumänien", "es": "Rumania", "fa": "رومانی", "fr": "Roumanie", "hr": "Rumunjska", "it": "Romania", "ja": "ルーマニア", "nl": "Roemenië", "pt": "Roménia"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".ro"]}, {"area": 17124442, "cioc": "RUS", "flag": "https://restcountries.eu/data/rus.svg", "gini": 40.1, "name": "Russian Federation", "latlng": [60.0, 100.0], "region": "Europe", "borders": ["AZE", "BLR", "CHN", "EST", "FIN", "GEO", "KAZ", "PRK", "LVA", "LTU", "MNG", "NOR", "POL", "UKR"], "capital": "Moscow", "demonym": "Russian", "languages": [{"name": "Russian", "iso639_1": "ru", "iso639_2": "rus", "nativeName": "Русский"}], "subregion": "Eastern Europe", "timezones": ["UTC+03:00", "UTC+04:00", "UTC+06:00", "UTC+07:00", "UTC+08:00", "UTC+09:00", "UTC+10:00", "UTC+11:00", "UTC+12:00"], "alpha2Code": "RU", "alpha3Code": "RUS", "currencies": [{"code": "RUB", "name": "Russian ruble", "symbol": "₽"}], "nativeName": "Россия", "population": 146599183, "numericCode": "643", "altSpellings": ["RU", "Rossiya", "Russian Federation", "Российская Федерация", "Rossiyskaya Federatsiya"], "callingCodes": ["7"], "translations": {"br": "Rússia", "de": "Russland", "es": "Rusia", "fa": "روسیه", "fr": "Russie", "hr": "Rusija", "it": "Russia", "ja": "ロシア連邦", "nl": "Rusland", "pt": "Rússia"}, "regionalBlocs": [{"name": "Eurasian Economic Union", "acronym": "EEU", "otherNames": [], "otherAcronyms": ["EAEU"]}], "topLevelDomain": [".ru"]}, {"area": 26338.0, "cioc": "RWA", "flag": "https://restcountries.eu/data/rwa.svg", "gini": 50.8, "name": "Rwanda", "latlng": [-2.0, 30.0], "region": "Africa", "borders": ["BDI", "COD", "TZA", "UGA"], "capital": "Kigali", "demonym": "Rwandan", "languages": [{"name": "Kinyarwanda", "iso639_1": "rw", "iso639_2": "kin", "nativeName": "Ikinyarwanda"}, {"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Eastern Africa", "timezones": ["UTC+02:00"], "alpha2Code": "RW", "alpha3Code": "RWA", "currencies": [{"code": "RWF", "name": "Rwandan franc", "symbol": "Fr"}], "nativeName": "Rwanda", "population": 11553188, "numericCode": "646", "altSpellings": ["RW", "Republic of Rwanda", "Repubulika y'u Rwanda", "République du Rwanda"], "callingCodes": ["250"], "translations": {"br": "Ruanda", "de": "Ruanda", "es": "Ruanda", "fa": "رواندا", "fr": "Rwanda", "hr": "Ruanda", "it": "Ruanda", "ja": "ルワンダ", "nl": "Rwanda", "pt": "Ruanda"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".rw"]}, {"area": 21.0, "cioc": "", "flag": "https://restcountries.eu/data/blm.svg", "gini": null, "name": "Saint Barthélemy", "latlng": [18.5, -63.41666666], "region": "Americas", "borders": [], "capital": "Gustavia", "demonym": "Saint Barthélemy Islander", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "BL", "alpha3Code": "BLM", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Saint-Barthélemy", "population": 9417, "numericCode": "652", "altSpellings": ["BL", "St. Barthelemy", "Collectivity of Saint Barthélemy", "Collectivité de Saint-Barthélemy"], "callingCodes": ["590"], "translations": {"br": "São Bartolomeu", "de": "Saint-Barthélemy", "es": "San Bartolomé", "fa": "سن-بارتلمی", "fr": "Saint-Barthélemy", "hr": "Saint Barthélemy", "it": "Antille Francesi", "ja": "サン・バルテルミー", "nl": "Saint Barthélemy", "pt": "São Bartolomeu"}, "regionalBlocs": [], "topLevelDomain": [".bl"]}, {"area": null, "cioc": null, "flag": "https://restcountries.eu/data/shn.svg", "gini": null, "name": "Saint Helena, Ascension and Tristan da Cunha", "latlng": [-15.95, -5.7], "region": "Africa", "borders": [], "capital": "Jamestown", "demonym": "Saint Helenian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Western Africa", "timezones": ["UTC+00:00"], "alpha2Code": "SH", "alpha3Code": "SHN", "currencies": [{"code": "SHP", "name": "Saint Helena pound", "symbol": "£"}], "nativeName": "Saint Helena", "population": 4255, "numericCode": "654", "altSpellings": ["SH"], "callingCodes": ["290"], "translations": {"br": "Santa Helena", "de": "Sankt Helena", "es": "Santa Helena", "fa": "سنت هلنا، اسنشن و تریستان دا کونا", "fr": "Sainte-Hélène", "hr": "Sveta Helena", "it": "Sant'Elena", "ja": "セントヘレナ・アセンションおよびトリスタンダクーニャ", "nl": "Sint-Helena", "pt": "Santa Helena"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".sh"]}, {"area": 261.0, "cioc": "SKN", "flag": "https://restcountries.eu/data/kna.svg", "gini": null, "name": "Saint Kitts and Nevis", "latlng": [17.33333333, -62.75], "region": "Americas", "borders": [], "capital": "Basseterre", "demonym": "Kittian and Nevisian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "KN", "alpha3Code": "KNA", "currencies": [{"code": "XCD", "name": "East Caribbean dollar", "symbol": "$"}], "nativeName": "Saint Kitts and Nevis", "population": 46204, "numericCode": "659", "altSpellings": ["KN", "Federation of Saint Christopher and Nevis"], "callingCodes": ["1869"], "translations": {"br": "São Cristóvão e Neves", "de": "St. Kitts und Nevis", "es": "San Cristóbal y Nieves", "fa": "سنت کیتس و نویس", "fr": "Saint-Christophe-et-Niévès", "hr": "Sveti Kristof i Nevis", "it": "Saint Kitts e Nevis", "ja": "セントクリストファー・ネイビス", "nl": "Saint Kitts en Nevis", "pt": "São Cristóvão e Neves"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}], "topLevelDomain": [".kn"]}, {"area": 616.0, "cioc": "LCA", "flag": "https://restcountries.eu/data/lca.svg", "gini": 42.6, "name": "Saint Lucia", "latlng": [13.88333333, -60.96666666], "region": "Americas", "borders": [], "capital": "Castries", "demonym": "Saint Lucian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "LC", "alpha3Code": "LCA", "currencies": [{"code": "XCD", "name": "East Caribbean dollar", "symbol": "$"}], "nativeName": "Saint Lucia", "population": 186000, "numericCode": "662", "altSpellings": ["LC"], "callingCodes": ["1758"], "translations": {"br": "Santa Lúcia", "de": "Saint Lucia", "es": "Santa Lucía", "fa": "سنت لوسیا", "fr": "Saint-Lucie", "hr": "Sveta Lucija", "it": "Santa Lucia", "ja": "セントルシア", "nl": "Saint Lucia", "pt": "Santa Lúcia"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}], "topLevelDomain": [".lc"]}, {"area": 53.0, "cioc": "", "flag": "https://restcountries.eu/data/maf.svg", "gini": null, "name": "Saint Martin (French part)", "latlng": [18.08333333, -63.95], "region": "Americas", "borders": ["SXM", "NLD"], "capital": "Marigot", "demonym": "Saint Martin Islander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "Dutch", "iso639_1": "nl", "iso639_2": "nld", "nativeName": "Nederlands"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "MF", "alpha3Code": "MAF", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Saint-Martin", "population": 36979, "numericCode": "663", "altSpellings": ["MF", "Collectivity of Saint Martin", "Collectivité de Saint-Martin"], "callingCodes": ["590"], "translations": {"br": "Saint Martin", "de": "Saint Martin", "es": "Saint Martin", "fa": "سینت مارتن", "fr": "Saint-Martin", "hr": "Sveti Martin", "it": "Saint Martin", "ja": "サン・マルタン（フランス領）", "nl": "Saint-Martin", "pt": "Ilha São Martinho"}, "regionalBlocs": [], "topLevelDomain": [".mf", ".fr", ".gp"]}, {"area": 242.0, "cioc": "", "flag": "https://restcountries.eu/data/spm.svg", "gini": null, "name": "Saint Pierre and Miquelon", "latlng": [46.83333333, -56.33333333], "region": "Americas", "borders": [], "capital": "Saint-Pierre", "demonym": "French", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Northern America", "timezones": ["UTC-03:00"], "alpha2Code": "PM", "alpha3Code": "SPM", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Saint-Pierre-et-Miquelon", "population": 6069, "numericCode": "666", "altSpellings": ["PM", "Collectivité territoriale de Saint-Pierre-et-Miquelon"], "callingCodes": ["508"], "translations": {"br": "Saint-Pierre e Miquelon", "de": "Saint-Pierre und Miquelon", "es": "San Pedro y Miquelón", "fa": "سن پیر و میکلن", "fr": "Saint-Pierre-et-Miquelon", "hr": "Sveti Petar i Mikelon", "it": "Saint-Pierre e Miquelon", "ja": "サンピエール島・ミクロン島", "nl": "Saint Pierre en Miquelon", "pt": "São Pedro e Miquelon"}, "regionalBlocs": [], "topLevelDomain": [".pm"]}, {"area": 389.0, "cioc": "VIN", "flag": "https://restcountries.eu/data/vct.svg", "gini": null, "name": "Saint Vincent and the Grenadines", "latlng": [13.25, -61.2], "region": "Americas", "borders": [], "capital": "Kingstown", "demonym": "Saint Vincentian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "VC", "alpha3Code": "VCT", "currencies": [{"code": "XCD", "name": "East Caribbean dollar", "symbol": "$"}], "nativeName": "Saint Vincent and the Grenadines", "population": 109991, "numericCode": "670", "altSpellings": ["VC"], "callingCodes": ["1784"], "translations": {"br": "São Vicente e Granadinas", "de": "Saint Vincent und die Grenadinen", "es": "San Vicente y Granadinas", "fa": "سنت وینسنت و گرنادین‌ها", "fr": "Saint-Vincent-et-les-Grenadines", "hr": "Sveti Vincent i Grenadini", "it": "Saint Vincent e Grenadine", "ja": "セントビンセントおよびグレナディーン諸島", "nl": "Saint Vincent en de Grenadines", "pt": "São Vicente e Granadinas"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}], "topLevelDomain": [".vc"]}, {"area": 2842.0, "cioc": "SAM", "flag": "https://restcountries.eu/data/wsm.svg", "gini": null, "name": "Samoa", "latlng": [-13.58333333, -172.33333333], "region": "Oceania", "borders": [], "capital": "Apia", "demonym": "Samoan", "languages": [{"name": "Samoan", "iso639_1": "sm", "iso639_2": "smo", "nativeName": "gagana fa'a Samoa"}, {"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Polynesia", "timezones": ["UTC+13:00"], "alpha2Code": "WS", "alpha3Code": "WSM", "currencies": [{"code": "WST", "name": "Samoan tālā", "symbol": "T"}], "nativeName": "Samoa", "population": 194899, "numericCode": "882", "altSpellings": ["WS", "Independent State of Samoa", "Malo Saʻoloto Tutoʻatasi o Sāmoa"], "callingCodes": ["685"], "translations": {"br": "Samoa", "de": "Samoa", "es": "Samoa", "fa": "ساموآ", "fr": "Samoa", "hr": "Samoa", "it": "Samoa", "ja": "サモア", "nl": "Samoa", "pt": "Samoa"}, "regionalBlocs": [], "topLevelDomain": [".ws"]}, {"area": 61.0, "cioc": "SMR", "flag": "https://restcountries.eu/data/smr.svg", "gini": null, "name": "San Marino", "latlng": [43.76666666, 12.41666666], "region": "Europe", "borders": ["ITA"], "capital": "City of San Marino", "demonym": "Sammarinese", "languages": [{"name": "Italian", "iso639_1": "it", "iso639_2": "ita", "nativeName": "Italiano"}], "subregion": "Southern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "SM", "alpha3Code": "SMR", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "San Marino", "population": 33005, "numericCode": "674", "altSpellings": ["SM", "Republic of San Marino", "Repubblica di San Marino"], "callingCodes": ["378"], "translations": {"br": "San Marino", "de": "San Marino", "es": "San Marino", "fa": "سان مارینو", "fr": "Saint-Marin", "hr": "San Marino", "it": "San Marino", "ja": "サンマリノ", "nl": "San Marino", "pt": "São Marinho"}, "regionalBlocs": [], "topLevelDomain": [".sm"]}, {"area": 964.0, "cioc": "STP", "flag": "https://restcountries.eu/data/stp.svg", "gini": 50.8, "name": "Sao Tome and Principe", "latlng": [1.0, 7.0], "region": "Africa", "borders": [], "capital": "São Tomé", "demonym": "Sao Tomean", "languages": [{"name": "Portuguese", "iso639_1": "pt", "iso639_2": "por", "nativeName": "Português"}], "subregion": "Middle Africa", "timezones": ["UTC"], "alpha2Code": "ST", "alpha3Code": "STP", "currencies": [{"code": "STD", "name": "São Tomé and Príncipe dobra", "symbol": "Db"}], "nativeName": "São Tomé e Príncipe", "population": 187356, "numericCode": "678", "altSpellings": ["ST", "Democratic Republic of São Tomé and Príncipe", "República Democrática de São Tomé e Príncipe"], "callingCodes": ["239"], "translations": {"br": "São Tomé e Príncipe", "de": "São Tomé und Príncipe", "es": "Santo Tomé y Príncipe", "fa": "کواترو دو فرویرو", "fr": "Sao Tomé-et-Principe", "hr": "Sveti Toma i Princip", "it": "São Tomé e Príncipe", "ja": "サントメ・プリンシペ", "nl": "Sao Tomé en Principe", "pt": "São Tomé e Príncipe"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".st"]}, {"area": 2149690.0, "cioc": "KSA", "flag": "https://restcountries.eu/data/sau.svg", "gini": null, "name": "Saudi Arabia", "latlng": [25.0, 45.0], "region": "Asia", "borders": ["IRQ", "JOR", "KWT", "OMN", "QAT", "ARE", "YEM"], "capital": "Riyadh", "demonym": "Saudi Arabian", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Western Asia", "timezones": ["UTC+03:00"], "alpha2Code": "SA", "alpha3Code": "SAU", "currencies": [{"code": "SAR", "name": "Saudi riyal", "symbol": "ر.س"}], "nativeName": "العربية السعودية", "population": 32248200, "numericCode": "682", "altSpellings": ["SA", "Kingdom of Saudi Arabia", "Al-Mamlakah al-‘Arabiyyah as-Su‘ūdiyyah"], "callingCodes": ["966"], "translations": {"br": "Arábia Saudita", "de": "Saudi-Arabien", "es": "Arabia Saudí", "fa": "عربستان سعودی", "fr": "Arabie Saoudite", "hr": "Saudijska Arabija", "it": "Arabia Saudita", "ja": "サウジアラビア", "nl": "Saoedi-Arabië", "pt": "Arábia Saudita"}, "regionalBlocs": [{"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".sa"]}, {"area": 196722.0, "cioc": "SEN", "flag": "https://restcountries.eu/data/sen.svg", "gini": 39.2, "name": "Senegal", "latlng": [14.0, -14.0], "region": "Africa", "borders": ["GMB", "GIN", "GNB", "MLI", "MRT"], "capital": "Dakar", "demonym": "Senegalese", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Western Africa", "timezones": ["UTC"], "alpha2Code": "SN", "alpha3Code": "SEN", "currencies": [{"code": "XOF", "name": "West African CFA franc", "symbol": "Fr"}], "nativeName": "Sénégal", "population": 14799859, "numericCode": "686", "altSpellings": ["SN", "Republic of Senegal", "République du Sénégal"], "callingCodes": ["221"], "translations": {"br": "Senegal", "de": "Senegal", "es": "Senegal", "fa": "سنگال", "fr": "Sénégal", "hr": "Senegal", "it": "Senegal", "ja": "セネガル", "nl": "Senegal", "pt": "Senegal"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".sn"]}, {"area": 88361.0, "cioc": "SRB", "flag": "https://restcountries.eu/data/srb.svg", "gini": 27.8, "name": "Serbia", "latlng": [44.0, 21.0], "region": "Europe", "borders": ["BIH", "BGR", "HRV", "HUN", "KOS", "MKD", "MNE", "ROU"], "capital": "Belgrade", "demonym": "Serbian", "languages": [{"name": "Serbian", "iso639_1": "sr", "iso639_2": "srp", "nativeName": "српски језик"}], "subregion": "Southern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "RS", "alpha3Code": "SRB", "currencies": [{"code": "RSD", "name": "Serbian dinar", "symbol": "дин."}], "nativeName": "Србија", "population": 7076372, "numericCode": "688", "altSpellings": ["RS", "Srbija", "Republic of Serbia", "Република Србија", "Republika Srbija"], "callingCodes": ["381"], "translations": {"br": "Sérvia", "de": "Serbien", "es": "Serbia", "fa": "صربستان", "fr": "Serbie", "hr": "Srbija", "it": "Serbia", "ja": "セルビア", "nl": "Servië", "pt": "Sérvia"}, "regionalBlocs": [{"name": "Central European Free Trade Agreement", "acronym": "CEFTA", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".rs"]}, {"area": 452.0, "cioc": "SEY", "flag": "https://restcountries.eu/data/syc.svg", "gini": 65.8, "name": "Seychelles", "latlng": [-4.58333333, 55.66666666], "region": "Africa", "borders": [], "capital": "Victoria", "demonym": "Seychellois", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Eastern Africa", "timezones": ["UTC+04:00"], "alpha2Code": "SC", "alpha3Code": "SYC", "currencies": [{"code": "SCR", "name": "Seychellois rupee", "symbol": "₨"}], "nativeName": "Seychelles", "population": 91400, "numericCode": "690", "altSpellings": ["SC", "Republic of Seychelles", "Repiblik Sesel", "République des Seychelles"], "callingCodes": ["248"], "translations": {"br": "Seicheles", "de": "Seychellen", "es": "Seychelles", "fa": "سیشل", "fr": "Seychelles", "hr": "Sejšeli", "it": "Seychelles", "ja": "セーシェル", "nl": "Seychellen", "pt": "Seicheles"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".sc"]}, {"area": 71740.0, "cioc": "SLE", "flag": "https://restcountries.eu/data/sle.svg", "gini": 42.5, "name": "Sierra Leone", "latlng": [8.5, -11.5], "region": "Africa", "borders": ["GIN", "LBR"], "capital": "Freetown", "demonym": "Sierra Leonean", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Western Africa", "timezones": ["UTC"], "alpha2Code": "SL", "alpha3Code": "SLE", "currencies": [{"code": "SLL", "name": "Sierra Leonean leone", "symbol": "Le"}], "nativeName": "Sierra Leone", "population": 7075641, "numericCode": "694", "altSpellings": ["SL", "Republic of Sierra Leone"], "callingCodes": ["232"], "translations": {"br": "Serra Leoa", "de": "Sierra Leone", "es": "Sierra Leone", "fa": "سیرالئون", "fr": "Sierra Leone", "hr": "Sijera Leone", "it": "Sierra Leone", "ja": "シエラレオネ", "nl": "Sierra Leone", "pt": "Serra Leoa"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".sl"]}, {"area": 710.0, "cioc": "SIN", "flag": "https://restcountries.eu/data/sgp.svg", "gini": 48.1, "name": "Singapore", "latlng": [1.36666666, 103.8], "region": "Asia", "borders": [], "capital": "Singapore", "demonym": "Singaporean", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Malay", "iso639_1": "ms", "iso639_2": "msa", "nativeName": "bahasa Melayu"}, {"name": "Tamil", "iso639_1": "ta", "iso639_2": "tam", "nativeName": "தமிழ்"}, {"name": "Chinese", "iso639_1": "zh", "iso639_2": "zho", "nativeName": "中文 (Zhōngwén)"}], "subregion": "South-Eastern Asia", "timezones": ["UTC+08:00"], "alpha2Code": "SG", "alpha3Code": "SGP", "currencies": [{"code": "BND", "name": "Brunei dollar", "symbol": "$"}, {"code": "SGD", "name": "Singapore dollar", "symbol": "$"}], "nativeName": "Singapore", "population": 5535000, "numericCode": "702", "altSpellings": ["SG", "Singapura", "Republik Singapura", "新加坡共和国"], "callingCodes": ["65"], "translations": {"br": "Singapura", "de": "Singapur", "es": "Singapur", "fa": "سنگاپور", "fr": "Singapour", "hr": "Singapur", "it": "Singapore", "ja": "シンガポール", "nl": "Singapore", "pt": "Singapura"}, "regionalBlocs": [{"name": "Association of Southeast Asian Nations", "acronym": "ASEAN", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".sg"]}, {"area": 34.0, "cioc": "", "flag": "https://restcountries.eu/data/sxm.svg", "gini": null, "name": "Sint Maarten (Dutch part)", "latlng": [18.033333, -63.05], "region": "Americas", "borders": ["MAF"], "capital": "Philipsburg", "demonym": "Dutch", "languages": [{"name": "Dutch", "iso639_1": "nl", "iso639_2": "nld", "nativeName": "Nederlands"}, {"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "SX", "alpha3Code": "SXM", "currencies": [{"code": "ANG", "name": "Netherlands Antillean guilder", "symbol": "ƒ"}], "nativeName": "Sint Maarten", "population": 38247, "numericCode": "534", "altSpellings": ["SX"], "callingCodes": ["1721"], "translations": {"br": "Sint Maarten", "de": "Sint Maarten (niederl. Teil)", "es": null, "fa": "سینت مارتن", "fr": "Saint Martin (partie néerlandaise)", "hr": null, "it": "Saint Martin (parte olandese)", "ja": null, "nl": "Sint Maarten", "pt": "São Martinho"}, "regionalBlocs": [], "topLevelDomain": [".sx"]}, {"area": 49037.0, "cioc": "SVK", "flag": "https://restcountries.eu/data/svk.svg", "gini": 26.0, "name": "Slovakia", "latlng": [48.66666666, 19.5], "region": "Europe", "borders": ["AUT", "CZE", "HUN", "POL", "UKR"], "capital": "Bratislava", "demonym": "Slovak", "languages": [{"name": "Slovak", "iso639_1": "sk", "iso639_2": "slk", "nativeName": "slovenčina"}], "subregion": "Eastern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "SK", "alpha3Code": "SVK", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Slovensko", "population": 5426252, "numericCode": "703", "altSpellings": ["SK", "Slovak Republic", "Slovenská republika"], "callingCodes": ["421"], "translations": {"br": "Eslováquia", "de": "Slowakei", "es": "República Eslovaca", "fa": "اسلواکی", "fr": "Slovaquie", "hr": "Slovačka", "it": "Slovacchia", "ja": "スロバキア", "nl": "Slowakije", "pt": "Eslováquia"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".sk"]}, {"area": 20273.0, "cioc": "SLO", "flag": "https://restcountries.eu/data/svn.svg", "gini": 31.2, "name": "Slovenia", "latlng": [46.11666666, 14.81666666], "region": "Europe", "borders": ["AUT", "HRV", "ITA", "HUN"], "capital": "Ljubljana", "demonym": "Slovene", "languages": [{"name": "Slovene", "iso639_1": "sl", "iso639_2": "slv", "nativeName": "slovenski jezik"}], "subregion": "Southern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "SI", "alpha3Code": "SVN", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "Slovenija", "population": 2064188, "numericCode": "705", "altSpellings": ["SI", "Republic of Slovenia", "Republika Slovenija"], "callingCodes": ["386"], "translations": {"br": "Eslovênia", "de": "Slowenien", "es": "Eslovenia", "fa": "اسلوونی", "fr": "Slovénie", "hr": "Slovenija", "it": "Slovenia", "ja": "スロベニア", "nl": "Slovenië", "pt": "Eslovénia"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".si"]}, {"area": 28896.0, "cioc": "SOL", "flag": "https://restcountries.eu/data/slb.svg", "gini": null, "name": "Solomon Islands", "latlng": [-8.0, 159.0], "region": "Oceania", "borders": [], "capital": "Honiara", "demonym": "Solomon Islander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Melanesia", "timezones": ["UTC+11:00"], "alpha2Code": "SB", "alpha3Code": "SLB", "currencies": [{"code": "SBD", "name": "Solomon Islands dollar", "symbol": "$"}], "nativeName": "Solomon Islands", "population": 642000, "numericCode": "090", "altSpellings": ["SB"], "callingCodes": ["677"], "translations": {"br": "Ilhas Salomão", "de": "Salomonen", "es": "Islas Salomón", "fa": "جزایر سلیمان", "fr": "Îles Salomon", "hr": "Solomonski Otoci", "it": "Isole Salomone", "ja": "ソロモン諸島", "nl": "Salomonseilanden", "pt": "Ilhas Salomão"}, "regionalBlocs": [], "topLevelDomain": [".sb"]}, {"area": 637657.0, "cioc": "SOM", "flag": "https://restcountries.eu/data/som.svg", "gini": null, "name": "Somalia", "latlng": [10.0, 49.0], "region": "Africa", "borders": ["DJI", "ETH", "KEN"], "capital": "Mogadishu", "demonym": "Somali", "languages": [{"name": "Somali", "iso639_1": "so", "iso639_2": "som", "nativeName": "Soomaaliga"}, {"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Eastern Africa", "timezones": ["UTC+03:00"], "alpha2Code": "SO", "alpha3Code": "SOM", "currencies": [{"code": "SOS", "name": "Somali shilling", "symbol": "Sh"}], "nativeName": "Soomaaliya", "population": 11079000, "numericCode": "706", "altSpellings": ["SO", "aṣ-Ṣūmāl", "Federal Republic of Somalia", "Jamhuuriyadda Federaalka Soomaaliya", "Jumhūriyyat aṣ-Ṣūmāl al-Fiderāliyya"], "callingCodes": ["252"], "translations": {"br": "Somália", "de": "Somalia", "es": "Somalia", "fa": "سومالی", "fr": "Somalie", "hr": "Somalija", "it": "Somalia", "ja": "ソマリア", "nl": "Somalië", "pt": "Somália"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}, {"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".so"]}, {"area": 1221037.0, "cioc": "RSA", "flag": "https://restcountries.eu/data/zaf.svg", "gini": 63.1, "name": "South Africa", "latlng": [-29.0, 24.0], "region": "Africa", "borders": ["BWA", "LSO", "MOZ", "NAM", "SWZ", "ZWE"], "capital": "Pretoria", "demonym": "South African", "languages": [{"name": "Afrikaans", "iso639_1": "af", "iso639_2": "afr", "nativeName": "Afrikaans"}, {"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Southern Ndebele", "iso639_1": "nr", "iso639_2": "nbl", "nativeName": "isiNdebele"}, {"name": "Southern Sotho", "iso639_1": "st", "iso639_2": "sot", "nativeName": "Sesotho"}, {"name": "Swati", "iso639_1": "ss", "iso639_2": "ssw", "nativeName": "SiSwati"}, {"name": "Tswana", "iso639_1": "tn", "iso639_2": "tsn", "nativeName": "Setswana"}, {"name": "Tsonga", "iso639_1": "ts", "iso639_2": "tso", "nativeName": "Xitsonga"}, {"name": "Venda", "iso639_1": "ve", "iso639_2": "ven", "nativeName": "Tshivenḓa"}, {"name": "Xhosa", "iso639_1": "xh", "iso639_2": "xho", "nativeName": "isiXhosa"}, {"name": "Zulu", "iso639_1": "zu", "iso639_2": "zul", "nativeName": "isiZulu"}], "subregion": "Southern Africa", "timezones": ["UTC+02:00"], "alpha2Code": "ZA", "alpha3Code": "ZAF", "currencies": [{"code": "ZAR", "name": "South African rand", "symbol": "R"}], "nativeName": "South Africa", "population": 55653654, "numericCode": "710", "altSpellings": ["ZA", "RSA", "Suid-Afrika", "Republic of South Africa"], "callingCodes": ["27"], "translations": {"br": "República Sul-Africana", "de": "Republik Südafrika", "es": "República de Sudáfrica", "fa": "آفریقای جنوبی", "fr": "Afrique du Sud", "hr": "Južnoafrička Republika", "it": "Sud Africa", "ja": "南アフリカ", "nl": "Zuid-Afrika", "pt": "República Sul-Africana"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".za"]}, {"area": null, "cioc": "", "flag": "https://restcountries.eu/data/sgs.svg", "gini": null, "name": "South Georgia and the South Sandwich Islands", "latlng": [-54.5, -37.0], "region": "Americas", "borders": [], "capital": "King Edward Point", "demonym": "South Georgia and the South Sandwich Islander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "South America", "timezones": ["UTC-02:00"], "alpha2Code": "GS", "alpha3Code": "SGS", "currencies": [{"code": "GBP", "name": "British pound", "symbol": "£"}, {"code": "(none)", "name": null, "symbol": "£"}], "nativeName": "South Georgia", "population": 30, "numericCode": "239", "altSpellings": ["GS", "South Georgia and the South Sandwich Islands"], "callingCodes": ["500"], "translations": {"br": "Ilhas Geórgias do Sul e Sandwich do Sul", "de": "Südgeorgien und die Südlichen Sandwichinseln", "es": "Islas Georgias del Sur y Sandwich del Sur", "fa": "جزایر جورجیای جنوبی و ساندویچ جنوبی", "fr": "Géorgie du Sud-et-les Îles Sandwich du Sud", "hr": "Južna Georgija i otočje Južni Sandwich", "it": "Georgia del Sud e Isole Sandwich Meridionali", "ja": "サウスジョージア・サウスサンドウィッチ諸島", "nl": "Zuid-Georgia en Zuidelijke Sandwicheilanden", "pt": "Ilhas Geórgia do Sul e Sanduíche do Sul"}, "regionalBlocs": [{"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}], "topLevelDomain": [".gs"]}, {"area": 100210.0, "cioc": "KOR", "flag": "https://restcountries.eu/data/kor.svg", "gini": 31.3, "name": "Korea (Republic of)", "latlng": [37.0, 127.5], "region": "Asia", "borders": ["PRK"], "capital": "Seoul", "demonym": "South Korean", "languages": [{"name": "Korean", "iso639_1": "ko", "iso639_2": "kor", "nativeName": "한국어"}], "subregion": "Eastern Asia", "timezones": ["UTC+09:00"], "alpha2Code": "KR", "alpha3Code": "KOR", "currencies": [{"code": "KRW", "name": "South Korean won", "symbol": "₩"}], "nativeName": "대한민국", "population": 50801405, "numericCode": "410", "altSpellings": ["KR", "Republic of Korea"], "callingCodes": ["82"], "translations": {"br": "Coreia do Sul", "de": "Südkorea", "es": "Corea del Sur", "fa": "کره شمالی", "fr": "Corée du Sud", "hr": "Južna Koreja", "it": "Corea del Sud", "ja": "大韓民国", "nl": "Zuid-Korea", "pt": "Coreia do Sul"}, "regionalBlocs": [], "topLevelDomain": [".kr"]}, {"area": 619745.0, "cioc": "", "flag": "https://restcountries.eu/data/ssd.svg", "gini": 45.5, "name": "South Sudan", "latlng": [7.0, 30.0], "region": "Africa", "borders": ["CAF", "COD", "ETH", "KEN", "SDN", "UGA"], "capital": "Juba", "demonym": "South Sudanese", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Middle Africa", "timezones": ["UTC+03:00"], "alpha2Code": "SS", "alpha3Code": "SSD", "currencies": [{"code": "SSP", "name": "South Sudanese pound", "symbol": "£"}], "nativeName": "South Sudan", "population": 12131000, "numericCode": "728", "altSpellings": ["SS"], "callingCodes": ["211"], "translations": {"br": "Sudão do Sul", "de": "Südsudan", "es": "Sudán del Sur", "fa": "سودان جنوبی", "fr": "Soudan du Sud", "hr": "Južni Sudan", "it": "Sudan del sud", "ja": "南スーダン", "nl": "Zuid-Soedan", "pt": "Sudão do Sul"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".ss"]}, {"area": 505992.0, "cioc": "ESP", "flag": "https://restcountries.eu/data/esp.svg", "gini": 34.7, "name": "Spain", "latlng": [40.0, -4.0], "region": "Europe", "borders": ["AND", "FRA", "GIB", "PRT", "MAR"], "capital": "Madrid", "demonym": "Spanish", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "Southern Europe", "timezones": ["UTC", "UTC+01:00"], "alpha2Code": "ES", "alpha3Code": "ESP", "currencies": [{"code": "EUR", "name": "Euro", "symbol": "€"}], "nativeName": "España", "population": 46438422, "numericCode": "724", "altSpellings": ["ES", "Kingdom of Spain", "Reino de España"], "callingCodes": ["34"], "translations": {"br": "Espanha", "de": "Spanien", "es": "España", "fa": "اسپانیا", "fr": "Espagne", "hr": "Španjolska", "it": "Spagna", "ja": "スペイン", "nl": "Spanje", "pt": "Espanha"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".es"]}, {"area": 65610.0, "cioc": "SRI", "flag": "https://restcountries.eu/data/lka.svg", "gini": 40.3, "name": "Sri Lanka", "latlng": [7.0, 81.0], "region": "Asia", "borders": ["IND"], "capital": "Colombo", "demonym": "Sri Lankan", "languages": [{"name": "Sinhalese", "iso639_1": "si", "iso639_2": "sin", "nativeName": "සිංහල"}, {"name": "Tamil", "iso639_1": "ta", "iso639_2": "tam", "nativeName": "தமிழ்"}], "subregion": "Southern Asia", "timezones": ["UTC+05:30"], "alpha2Code": "LK", "alpha3Code": "LKA", "currencies": [{"code": "LKR", "name": "Sri Lankan rupee", "symbol": "Rs"}], "nativeName": "śrī laṃkāva", "population": 20966000, "numericCode": "144", "altSpellings": ["LK", "ilaṅkai", "Democratic Socialist Republic of Sri Lanka"], "callingCodes": ["94"], "translations": {"br": "Sri Lanka", "de": "Sri Lanka", "es": "Sri Lanka", "fa": "سری‌لانکا", "fr": "Sri Lanka", "hr": "Šri Lanka", "it": "Sri Lanka", "ja": "スリランカ", "nl": "Sri Lanka", "pt": "Sri Lanka"}, "regionalBlocs": [{"name": "South Asian Association for Regional Cooperation", "acronym": "SAARC", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".lk"]}, {"area": 1886068.0, "cioc": "SUD", "flag": "https://restcountries.eu/data/sdn.svg", "gini": 35.3, "name": "Sudan", "latlng": [15.0, 30.0], "region": "Africa", "borders": ["CAF", "TCD", "EGY", "ERI", "ETH", "LBY", "SSD"], "capital": "Khartoum", "demonym": "Sudanese", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}, {"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Northern Africa", "timezones": ["UTC+03:00"], "alpha2Code": "SD", "alpha3Code": "SDN", "currencies": [{"code": "SDG", "name": "Sudanese pound", "symbol": "ج.س."}], "nativeName": "السودان", "population": 39598700, "numericCode": "729", "altSpellings": ["SD", "Republic of the Sudan", "Jumhūrīyat as-Sūdān"], "callingCodes": ["249"], "translations": {"br": "Sudão", "de": "Sudan", "es": "Sudán", "fa": "سودان", "fr": "Soudan", "hr": "Sudan", "it": "Sudan", "ja": "スーダン", "nl": "Soedan", "pt": "Sudão"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}, {"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".sd"]}, {"area": 163820.0, "cioc": "SUR", "flag": "https://restcountries.eu/data/sur.svg", "gini": 52.9, "name": "Suriname", "latlng": [4.0, -56.0], "region": "Americas", "borders": ["BRA", "GUF", "FRA", "GUY"], "capital": "Paramaribo", "demonym": "Surinamer", "languages": [{"name": "Dutch", "iso639_1": "nl", "iso639_2": "nld", "nativeName": "Nederlands"}], "subregion": "South America", "timezones": ["UTC-03:00"], "alpha2Code": "SR", "alpha3Code": "SUR", "currencies": [{"code": "SRD", "name": "Surinamese dollar", "symbol": "$"}], "nativeName": "Suriname", "population": 541638, "numericCode": "740", "altSpellings": ["SR", "Sarnam", "Sranangron", "Republic of Suriname", "Republiek Suriname"], "callingCodes": ["597"], "translations": {"br": "Suriname", "de": "Suriname", "es": "Surinam", "fa": "سورینام", "fr": "Surinam", "hr": "Surinam", "it": "Suriname", "ja": "スリナム", "nl": "Suriname", "pt": "Suriname"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}, {"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}], "topLevelDomain": [".sr"]}, {"area": null, "cioc": "", "flag": "https://restcountries.eu/data/sjm.svg", "gini": null, "name": "Svalbard and Jan Mayen", "latlng": [78.0, 20.0], "region": "Europe", "borders": [], "capital": "Longyearbyen", "demonym": "Norwegian", "languages": [{"name": "Norwegian", "iso639_1": "no", "iso639_2": "nor", "nativeName": "Norsk"}], "subregion": "Northern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "SJ", "alpha3Code": "SJM", "currencies": [{"code": "NOK", "name": "Norwegian krone", "symbol": "kr"}], "nativeName": "Svalbard og Jan Mayen", "population": 2562, "numericCode": "744", "altSpellings": ["SJ", "Svalbard and Jan Mayen Islands"], "callingCodes": ["4779"], "translations": {"br": "Svalbard", "de": "Svalbard und Jan Mayen", "es": "Islas Svalbard y Jan Mayen", "fa": "سوالبارد و یان ماین", "fr": "Svalbard et Jan Mayen", "hr": "Svalbard i Jan Mayen", "it": "Svalbard e Jan Mayen", "ja": "スヴァールバル諸島およびヤンマイエン島", "nl": "Svalbard en Jan Mayen", "pt": "Svalbard"}, "regionalBlocs": [], "topLevelDomain": [".sj"]}, {"area": 17364.0, "cioc": "SWZ", "flag": "https://restcountries.eu/data/swz.svg", "gini": 51.5, "name": "Swaziland", "latlng": [-26.5, 31.5], "region": "Africa", "borders": ["MOZ", "ZAF"], "capital": "Lobamba", "demonym": "Swazi", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Swati", "iso639_1": "ss", "iso639_2": "ssw", "nativeName": "SiSwati"}], "subregion": "Southern Africa", "timezones": ["UTC+02:00"], "alpha2Code": "SZ", "alpha3Code": "SWZ", "currencies": [{"code": "SZL", "name": "Swazi lilangeni", "symbol": "L"}], "nativeName": "Swaziland", "population": 1132657, "numericCode": "748", "altSpellings": ["SZ", "weSwatini", "Swatini", "Ngwane", "Kingdom of Swaziland", "Umbuso waseSwatini"], "callingCodes": ["268"], "translations": {"br": "Suazilândia", "de": "Swasiland", "es": "Suazilandia", "fa": "سوازیلند", "fr": "Swaziland", "hr": "Svazi", "it": "Swaziland", "ja": "スワジランド", "nl": "Swaziland", "pt": "Suazilândia"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".sz"]}, {"area": 450295.0, "cioc": "SWE", "flag": "https://restcountries.eu/data/swe.svg", "gini": 25.0, "name": "Sweden", "latlng": [62.0, 15.0], "region": "Europe", "borders": ["FIN", "NOR"], "capital": "Stockholm", "demonym": "Swedish", "languages": [{"name": "Swedish", "iso639_1": "sv", "iso639_2": "swe", "nativeName": "svenska"}], "subregion": "Northern Europe", "timezones": ["UTC+01:00"], "alpha2Code": "SE", "alpha3Code": "SWE", "currencies": [{"code": "SEK", "name": "Swedish krona", "symbol": "kr"}], "nativeName": "Sverige", "population": 9894888, "numericCode": "752", "altSpellings": ["SE", "Kingdom of Sweden", "Konungariket Sverige"], "callingCodes": ["46"], "translations": {"br": "Suécia", "de": "Schweden", "es": "Suecia", "fa": "سوئد", "fr": "Suède", "hr": "Švedska", "it": "Svezia", "ja": "スウェーデン", "nl": "Zweden", "pt": "Suécia"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".se"]}, {"area": 41284.0, "cioc": "SUI", "flag": "https://restcountries.eu/data/che.svg", "gini": 33.7, "name": "Switzerland", "latlng": [47.0, 8.0], "region": "Europe", "borders": ["AUT", "FRA", "ITA", "LIE", "DEU"], "capital": "Bern", "demonym": "Swiss", "languages": [{"name": "German", "iso639_1": "de", "iso639_2": "deu", "nativeName": "Deutsch"}, {"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}, {"name": "Italian", "iso639_1": "it", "iso639_2": "ita", "nativeName": "Italiano"}], "subregion": "Western Europe", "timezones": ["UTC+01:00"], "alpha2Code": "CH", "alpha3Code": "CHE", "currencies": [{"code": "CHF", "name": "Swiss franc", "symbol": "Fr"}], "nativeName": "Schweiz", "population": 8341600, "numericCode": "756", "altSpellings": ["CH", "Swiss Confederation", "Schweiz", "Suisse", "Svizzera", "Svizra"], "callingCodes": ["41"], "translations": {"br": "Suíça", "de": "Schweiz", "es": "Suiza", "fa": "سوئیس", "fr": "Suisse", "hr": "Švicarska", "it": "Svizzera", "ja": "スイス", "nl": "Zwitserland", "pt": "Suíça"}, "regionalBlocs": [{"name": "European Free Trade Association", "acronym": "EFTA", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".ch"]}, {"area": 185180.0, "cioc": "SYR", "flag": "https://restcountries.eu/data/syr.svg", "gini": 35.8, "name": "Syrian Arab Republic", "latlng": [35.0, 38.0], "region": "Asia", "borders": ["IRQ", "ISR", "JOR", "LBN", "TUR"], "capital": "Damascus", "demonym": "Syrian", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Western Asia", "timezones": ["UTC+02:00"], "alpha2Code": "SY", "alpha3Code": "SYR", "currencies": [{"code": "SYP", "name": "Syrian pound", "symbol": "£"}], "nativeName": "سوريا", "population": 18564000, "numericCode": "760", "altSpellings": ["SY", "Syrian Arab Republic", "Al-Jumhūrīyah Al-ʻArabīyah As-Sūrīyah"], "callingCodes": ["963"], "translations": {"br": "Síria", "de": "Syrien", "es": "Siria", "fa": "سوریه", "fr": "Syrie", "hr": "Sirija", "it": "Siria", "ja": "シリア・アラブ共和国", "nl": "Syrië", "pt": "Síria"}, "regionalBlocs": [{"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".sy"]}, {"area": 36193.0, "cioc": "TPE", "flag": "https://restcountries.eu/data/twn.svg", "gini": null, "name": "Taiwan", "latlng": [23.5, 121.0], "region": "Asia", "borders": [], "capital": "Taipei", "demonym": "Taiwanese", "languages": [{"name": "Chinese", "iso639_1": "zh", "iso639_2": "zho", "nativeName": "中文 (Zhōngwén)"}], "subregion": "Eastern Asia", "timezones": ["UTC+08:00"], "alpha2Code": "TW", "alpha3Code": "TWN", "currencies": [{"code": "TWD", "name": "New Taiwan dollar", "symbol": "$"}], "nativeName": "臺灣", "population": 23503349, "numericCode": "158", "altSpellings": ["TW", "Táiwān", "Republic of China", "中華民國", "Zhōnghuá Mínguó"], "callingCodes": ["886"], "translations": {"br": "Taiwan", "de": "Taiwan", "es": "Taiwán", "fa": "تایوان", "fr": "Taïwan", "hr": "Tajvan", "it": "Taiwan", "ja": "台湾（中華民国）", "nl": "Taiwan", "pt": "Taiwan"}, "regionalBlocs": [], "topLevelDomain": [".tw"]}, {"area": 143100.0, "cioc": "TJK", "flag": "https://restcountries.eu/data/tjk.svg", "gini": 30.8, "name": "Tajikistan", "latlng": [39.0, 71.0], "region": "Asia", "borders": ["AFG", "CHN", "KGZ", "UZB"], "capital": "Dushanbe", "demonym": "Tadzhik", "languages": [{"name": "Tajik", "iso639_1": "tg", "iso639_2": "tgk", "nativeName": "тоҷикӣ"}, {"name": "Russian", "iso639_1": "ru", "iso639_2": "rus", "nativeName": "Русский"}], "subregion": "Central Asia", "timezones": ["UTC+05:00"], "alpha2Code": "TJ", "alpha3Code": "TJK", "currencies": [{"code": "TJS", "name": "Tajikistani somoni", "symbol": "ЅМ"}], "nativeName": "Тоҷикистон", "population": 8593600, "numericCode": "762", "altSpellings": ["TJ", "Toçikiston", "Republic of Tajikistan", "Ҷумҳурии Тоҷикистон", "Çumhuriyi Toçikiston"], "callingCodes": ["992"], "translations": {"br": "Tajiquistão", "de": "Tadschikistan", "es": "Tayikistán", "fa": "تاجیکستان", "fr": "Tadjikistan", "hr": "Tađikistan", "it": "Tagikistan", "ja": "タジキスタン", "nl": "Tadzjikistan", "pt": "Tajiquistão"}, "regionalBlocs": [], "topLevelDomain": [".tj"]}, {"area": 945087.0, "cioc": "TAN", "flag": "https://restcountries.eu/data/tza.svg", "gini": 37.6, "name": "Tanzania, United Republic of", "latlng": [-6.0, 35.0], "region": "Africa", "borders": ["BDI", "COD", "KEN", "MWI", "MOZ", "RWA", "UGA", "ZMB"], "capital": "Dodoma", "demonym": "Tanzanian", "languages": [{"name": "Swahili", "iso639_1": "sw", "iso639_2": "swa", "nativeName": "Kiswahili"}, {"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Eastern Africa", "timezones": ["UTC+03:00"], "alpha2Code": "TZ", "alpha3Code": "TZA", "currencies": [{"code": "TZS", "name": "Tanzanian shilling", "symbol": "Sh"}], "nativeName": "Tanzania", "population": 55155000, "numericCode": "834", "altSpellings": ["TZ", "United Republic of Tanzania", "Jamhuri ya Muungano wa Tanzania"], "callingCodes": ["255"], "translations": {"br": "Tanzânia", "de": "Tansania", "es": "Tanzania", "fa": "تانزانیا", "fr": "Tanzanie", "hr": "Tanzanija", "it": "Tanzania", "ja": "タンザニア", "nl": "Tanzania", "pt": "Tanzânia"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".tz"]}, {"area": 513120.0, "cioc": "THA", "flag": "https://restcountries.eu/data/tha.svg", "gini": 40.0, "name": "Thailand", "latlng": [15.0, 100.0], "region": "Asia", "borders": ["MMR", "KHM", "LAO", "MYS"], "capital": "Bangkok", "demonym": "Thai", "languages": [{"name": "Thai", "iso639_1": "th", "iso639_2": "tha", "nativeName": "ไทย"}], "subregion": "South-Eastern Asia", "timezones": ["UTC+07:00"], "alpha2Code": "TH", "alpha3Code": "THA", "currencies": [{"code": "THB", "name": "Thai baht", "symbol": "฿"}], "nativeName": "ประเทศไทย", "population": 65327652, "numericCode": "764", "altSpellings": ["TH", "Prathet", "Thai", "Kingdom of Thailand", "ราชอาณาจักรไทย", "Ratcha Anachak Thai"], "callingCodes": ["66"], "translations": {"br": "Tailândia", "de": "Thailand", "es": "Tailandia", "fa": "تایلند", "fr": "Thaïlande", "hr": "Tajland", "it": "Tailandia", "ja": "タイ", "nl": "Thailand", "pt": "Tailândia"}, "regionalBlocs": [{"name": "Association of Southeast Asian Nations", "acronym": "ASEAN", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".th"]}, {"area": 14874.0, "cioc": "TLS", "flag": "https://restcountries.eu/data/tls.svg", "gini": 31.9, "name": "Timor-Leste", "latlng": [-8.83333333, 125.91666666], "region": "Asia", "borders": ["IDN"], "capital": "Dili", "demonym": "East Timorese", "languages": [{"name": "Portuguese", "iso639_1": "pt", "iso639_2": "por", "nativeName": "Português"}], "subregion": "South-Eastern Asia", "timezones": ["UTC+09:00"], "alpha2Code": "TL", "alpha3Code": "TLS", "currencies": [{"code": "USD", "name": "United States dollar", "symbol": "$"}, {"code": null, "name": null, "symbol": null}], "nativeName": "Timor-Leste", "population": 1167242, "numericCode": "626", "altSpellings": ["TL", "East Timor", "Democratic Republic of Timor-Leste", "República Democrática de Timor-Leste", "Repúblika Demokrátika Timór-Leste"], "callingCodes": ["670"], "translations": {"br": "Timor Leste", "de": "Timor-Leste", "es": "Timor Oriental", "fa": "تیمور شرقی", "fr": "Timor oriental", "hr": "Istočni Timor", "it": "Timor Est", "ja": "東ティモール", "nl": "Oost-Timor", "pt": "Timor Leste"}, "regionalBlocs": [], "topLevelDomain": [".tl"]}, {"area": 56785.0, "cioc": "TOG", "flag": "https://restcountries.eu/data/tgo.svg", "gini": 34.4, "name": "Togo", "latlng": [8.0, 1.16666666], "region": "Africa", "borders": ["BEN", "BFA", "GHA"], "capital": "Lomé", "demonym": "Togolese", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Western Africa", "timezones": ["UTC"], "alpha2Code": "TG", "alpha3Code": "TGO", "currencies": [{"code": "XOF", "name": "West African CFA franc", "symbol": "Fr"}], "nativeName": "Togo", "population": 7143000, "numericCode": "768", "altSpellings": ["TG", "Togolese", "Togolese Republic", "République Togolaise"], "callingCodes": ["228"], "translations": {"br": "Togo", "de": "Togo", "es": "Togo", "fa": "توگو", "fr": "Togo", "hr": "Togo", "it": "Togo", "ja": "トーゴ", "nl": "Togo", "pt": "Togo"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".tg"]}, {"area": 12.0, "cioc": "", "flag": "https://restcountries.eu/data/tkl.svg", "gini": null, "name": "Tokelau", "latlng": [-9.0, -172.0], "region": "Oceania", "borders": [], "capital": "Fakaofo", "demonym": "Tokelauan", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Polynesia", "timezones": ["UTC+13:00"], "alpha2Code": "TK", "alpha3Code": "TKL", "currencies": [{"code": "NZD", "name": "New Zealand dollar", "symbol": "$"}], "nativeName": "Tokelau", "population": 1411, "numericCode": "772", "altSpellings": ["TK"], "callingCodes": ["690"], "translations": {"br": "Tokelau", "de": "Tokelau", "es": "Islas Tokelau", "fa": "توکلائو", "fr": "Tokelau", "hr": "Tokelau", "it": "Isole Tokelau", "ja": "トケラウ", "nl": "Tokelau", "pt": "Toquelau"}, "regionalBlocs": [], "topLevelDomain": [".tk"]}, {"area": 747.0, "cioc": "TGA", "flag": "https://restcountries.eu/data/ton.svg", "gini": null, "name": "Tonga", "latlng": [-20.0, -175.0], "region": "Oceania", "borders": [], "capital": "Nuku'alofa", "demonym": "Tongan", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Tonga (Tonga Islands)", "iso639_1": "to", "iso639_2": "ton", "nativeName": "faka Tonga"}], "subregion": "Polynesia", "timezones": ["UTC+13:00"], "alpha2Code": "TO", "alpha3Code": "TON", "currencies": [{"code": "TOP", "name": "Tongan paʻanga", "symbol": "T$"}], "nativeName": "Tonga", "population": 103252, "numericCode": "776", "altSpellings": ["TO"], "callingCodes": ["676"], "translations": {"br": "Tonga", "de": "Tonga", "es": "Tonga", "fa": "تونگا", "fr": "Tonga", "hr": "Tonga", "it": "Tonga", "ja": "トンガ", "nl": "Tonga", "pt": "Tonga"}, "regionalBlocs": [], "topLevelDomain": [".to"]}, {"area": 5130.0, "cioc": "TTO", "flag": "https://restcountries.eu/data/tto.svg", "gini": 40.3, "name": "Trinidad and Tobago", "latlng": [11.0, -61.0], "region": "Americas", "borders": [], "capital": "Port of Spain", "demonym": "Trinidadian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "TT", "alpha3Code": "TTO", "currencies": [{"code": "TTD", "name": "Trinidad and Tobago dollar", "symbol": "$"}], "nativeName": "Trinidad and Tobago", "population": 1349667, "numericCode": "780", "altSpellings": ["TT", "Republic of Trinidad and Tobago"], "callingCodes": ["1868"], "translations": {"br": "Trinidad e Tobago", "de": "Trinidad und Tobago", "es": "Trinidad y Tobago", "fa": "ترینیداد و توباگو", "fr": "Trinité et Tobago", "hr": "Trinidad i Tobago", "it": "Trinidad e Tobago", "ja": "トリニダード・トバゴ", "nl": "Trinidad en Tobago", "pt": "Trindade e Tobago"}, "regionalBlocs": [{"name": "Caribbean Community", "acronym": "CARICOM", "otherNames": ["Comunidad del Caribe", "Communauté Caribéenne", "Caribische Gemeenschap"], "otherAcronyms": []}], "topLevelDomain": [".tt"]}, {"area": 163610.0, "cioc": "TUN", "flag": "https://restcountries.eu/data/tun.svg", "gini": 41.4, "name": "Tunisia", "latlng": [34.0, 9.0], "region": "Africa", "borders": ["DZA", "LBY"], "capital": "Tunis", "demonym": "Tunisian", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Northern Africa", "timezones": ["UTC+01:00"], "alpha2Code": "TN", "alpha3Code": "TUN", "currencies": [{"code": "TND", "name": "Tunisian dinar", "symbol": "د.ت"}], "nativeName": "تونس", "population": 11154400, "numericCode": "788", "altSpellings": ["TN", "Republic of Tunisia", "al-Jumhūriyyah at-Tūnisiyyah"], "callingCodes": ["216"], "translations": {"br": "Tunísia", "de": "Tunesien", "es": "Túnez", "fa": "تونس", "fr": "Tunisie", "hr": "Tunis", "it": "Tunisia", "ja": "チュニジア", "nl": "Tunesië", "pt": "Tunísia"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}, {"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".tn"]}, {"area": 783562.0, "cioc": "TUR", "flag": "https://restcountries.eu/data/tur.svg", "gini": 39.0, "name": "Turkey", "latlng": [39.0, 35.0], "region": "Asia", "borders": ["ARM", "AZE", "BGR", "GEO", "GRC", "IRN", "IRQ", "SYR"], "capital": "Ankara", "demonym": "Turkish", "languages": [{"name": "Turkish", "iso639_1": "tr", "iso639_2": "tur", "nativeName": "Türkçe"}], "subregion": "Western Asia", "timezones": ["UTC+03:00"], "alpha2Code": "TR", "alpha3Code": "TUR", "currencies": [{"code": "TRY", "name": "Turkish lira", "symbol": null}], "nativeName": "Türkiye", "population": 78741053, "numericCode": "792", "altSpellings": ["TR", "Turkiye", "Republic of Turkey", "Türkiye Cumhuriyeti"], "callingCodes": ["90"], "translations": {"br": "Turquia", "de": "Türkei", "es": "Turquía", "fa": "ترکیه", "fr": "Turquie", "hr": "Turska", "it": "Turchia", "ja": "トルコ", "nl": "Turkije", "pt": "Turquia"}, "regionalBlocs": [], "topLevelDomain": [".tr"]}, {"area": 488100.0, "cioc": "TKM", "flag": "https://restcountries.eu/data/tkm.svg", "gini": 40.8, "name": "Turkmenistan", "latlng": [40.0, 60.0], "region": "Asia", "borders": ["AFG", "IRN", "KAZ", "UZB"], "capital": "Ashgabat", "demonym": "Turkmen", "languages": [{"name": "Turkmen", "iso639_1": "tk", "iso639_2": "tuk", "nativeName": "Türkmen"}, {"name": "Russian", "iso639_1": "ru", "iso639_2": "rus", "nativeName": "Русский"}], "subregion": "Central Asia", "timezones": ["UTC+05:00"], "alpha2Code": "TM", "alpha3Code": "TKM", "currencies": [{"code": "TMT", "name": "Turkmenistan manat", "symbol": "m"}], "nativeName": "Türkmenistan", "population": 4751120, "numericCode": "795", "altSpellings": ["TM"], "callingCodes": ["993"], "translations": {"br": "Turcomenistão", "de": "Turkmenistan", "es": "Turkmenistán", "fa": "ترکمنستان", "fr": "Turkménistan", "hr": "Turkmenistan", "it": "Turkmenistan", "ja": "トルクメニスタン", "nl": "Turkmenistan", "pt": "Turquemenistão"}, "regionalBlocs": [], "topLevelDomain": [".tm"]}, {"area": 948.0, "cioc": "", "flag": "https://restcountries.eu/data/tca.svg", "gini": null, "name": "Turks and Caicos Islands", "latlng": [21.75, -71.58333333], "region": "Americas", "borders": [], "capital": "Cockburn Town", "demonym": "Turks and Caicos Islander", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Caribbean", "timezones": ["UTC-04:00"], "alpha2Code": "TC", "alpha3Code": "TCA", "currencies": [{"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "Turks and Caicos Islands", "population": 31458, "numericCode": "796", "altSpellings": ["TC"], "callingCodes": ["1649"], "translations": {"br": "Ilhas Turcas e Caicos", "de": "Turks- und Caicosinseln", "es": "Islas Turks y Caicos", "fa": "جزایر تورکس و کایکوس", "fr": "Îles Turques-et-Caïques", "hr": "Otoci Turks i Caicos", "it": "Isole Turks e Caicos", "ja": "タークス・カイコス諸島", "nl": "Turks- en Caicoseilanden", "pt": "Ilhas Turcas e Caicos"}, "regionalBlocs": [], "topLevelDomain": [".tc"]}, {"area": 26.0, "cioc": "TUV", "flag": "https://restcountries.eu/data/tuv.svg", "gini": null, "name": "Tuvalu", "latlng": [-8.0, 178.0], "region": "Oceania", "borders": [], "capital": "Funafuti", "demonym": "Tuvaluan", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Polynesia", "timezones": ["UTC+12:00"], "alpha2Code": "TV", "alpha3Code": "TUV", "currencies": [{"code": "AUD", "name": "Australian dollar", "symbol": "$"}, {"code": "TVD[G]", "name": "Tuvaluan dollar", "symbol": "$"}], "nativeName": "Tuvalu", "population": 10640, "numericCode": "798", "altSpellings": ["TV"], "callingCodes": ["688"], "translations": {"br": "Tuvalu", "de": "Tuvalu", "es": "Tuvalu", "fa": "تووالو", "fr": "Tuvalu", "hr": "Tuvalu", "it": "Tuvalu", "ja": "ツバル", "nl": "Tuvalu", "pt": "Tuvalu"}, "regionalBlocs": [], "topLevelDomain": [".tv"]}, {"area": 241550.0, "cioc": "UGA", "flag": "https://restcountries.eu/data/uga.svg", "gini": 44.3, "name": "Uganda", "latlng": [1.0, 32.0], "region": "Africa", "borders": ["COD", "KEN", "RWA", "SSD", "TZA"], "capital": "Kampala", "demonym": "Ugandan", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Swahili", "iso639_1": "sw", "iso639_2": "swa", "nativeName": "Kiswahili"}], "subregion": "Eastern Africa", "timezones": ["UTC+03:00"], "alpha2Code": "UG", "alpha3Code": "UGA", "currencies": [{"code": "UGX", "name": "Ugandan shilling", "symbol": "Sh"}], "nativeName": "Uganda", "population": 33860700, "numericCode": "800", "altSpellings": ["UG", "Republic of Uganda", "Jamhuri ya Uganda"], "callingCodes": ["256"], "translations": {"br": "Uganda", "de": "Uganda", "es": "Uganda", "fa": "اوگاندا", "fr": "Uganda", "hr": "Uganda", "it": "Uganda", "ja": "ウガンダ", "nl": "Oeganda", "pt": "Uganda"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".ug"]}, {"area": 603700.0, "cioc": "UKR", "flag": "https://restcountries.eu/data/ukr.svg", "gini": 26.4, "name": "Ukraine", "latlng": [49.0, 32.0], "region": "Europe", "borders": ["BLR", "HUN", "MDA", "POL", "ROU", "RUS", "SVK"], "capital": "Kiev", "demonym": "Ukrainian", "languages": [{"name": "Ukrainian", "iso639_1": "uk", "iso639_2": "ukr", "nativeName": "Українська"}], "subregion": "Eastern Europe", "timezones": ["UTC+02:00"], "alpha2Code": "UA", "alpha3Code": "UKR", "currencies": [{"code": "UAH", "name": "Ukrainian hryvnia", "symbol": "₴"}], "nativeName": "Україна", "population": 42692393, "numericCode": "804", "altSpellings": ["UA", "Ukrayina"], "callingCodes": ["380"], "translations": {"br": "Ucrânia", "de": "Ukraine", "es": "Ucrania", "fa": "وکراین", "fr": "Ukraine", "hr": "Ukrajina", "it": "Ucraina", "ja": "ウクライナ", "nl": "Oekraïne", "pt": "Ucrânia"}, "regionalBlocs": [], "topLevelDomain": [".ua"]}, {"area": 83600.0, "cioc": "UAE", "flag": "https://restcountries.eu/data/are.svg", "gini": null, "name": "United Arab Emirates", "latlng": [24.0, 54.0], "region": "Asia", "borders": ["OMN", "SAU"], "capital": "Abu Dhabi", "demonym": "Emirati", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Western Asia", "timezones": ["UTC+04"], "alpha2Code": "AE", "alpha3Code": "ARE", "currencies": [{"code": "AED", "name": "United Arab Emirates dirham", "symbol": "د.إ"}], "nativeName": "دولة الإمارات العربية المتحدة", "population": 9856000, "numericCode": "784", "altSpellings": ["AE", "UAE"], "callingCodes": ["971"], "translations": {"br": "Emirados árabes Unidos", "de": "Vereinigte Arabische Emirate", "es": "Emiratos Árabes Unidos", "fa": "امارات متحده عربی", "fr": "Émirats arabes unis", "hr": "Ujedinjeni Arapski Emirati", "it": "Emirati Arabi Uniti", "ja": "アラブ首長国連邦", "nl": "Verenigde Arabische Emiraten", "pt": "Emirados árabes Unidos"}, "regionalBlocs": [{"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".ae"]}, {"area": 242900.0, "cioc": "GBR", "flag": "https://restcountries.eu/data/gbr.svg", "gini": 34.0, "name": "United Kingdom of Great Britain and Northern Ireland", "latlng": [54.0, -2.0], "region": "Europe", "borders": ["IRL"], "capital": "London", "demonym": "British", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Northern Europe", "timezones": ["UTC-08:00", "UTC-05:00", "UTC-04:00", "UTC-03:00", "UTC-02:00", "UTC", "UTC+01:00", "UTC+02:00", "UTC+06:00"], "alpha2Code": "GB", "alpha3Code": "GBR", "currencies": [{"code": "GBP", "name": "British pound", "symbol": "£"}], "nativeName": "United Kingdom", "population": 65110000, "numericCode": "826", "altSpellings": ["GB", "UK", "Great Britain"], "callingCodes": ["44"], "translations": {"br": "Reino Unido", "de": "Vereinigtes Königreich", "es": "Reino Unido", "fa": "بریتانیای کبیر و ایرلند شمالی", "fr": "Royaume-Uni", "hr": "Ujedinjeno Kraljevstvo", "it": "Regno Unito", "ja": "イギリス", "nl": "Verenigd Koninkrijk", "pt": "Reino Unido"}, "regionalBlocs": [{"name": "European Union", "acronym": "EU", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".uk"]}, {"area": 9629091.0, "cioc": "USA", "flag": "https://restcountries.eu/data/usa.svg", "gini": 48.0, "name": "United States of America", "latlng": [38.0, -97.0], "region": "Americas", "borders": ["CAN", "MEX"], "capital": "Washington, D.C.", "demonym": "American", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Northern America", "timezones": ["UTC-12:00", "UTC-11:00", "UTC-10:00", "UTC-09:00", "UTC-08:00", "UTC-07:00", "UTC-06:00", "UTC-05:00", "UTC-04:00", "UTC+10:00", "UTC+12:00"], "alpha2Code": "US", "alpha3Code": "USA", "currencies": [{"code": "USD", "name": "United States dollar", "symbol": "$"}], "nativeName": "United States", "population": 323947000, "numericCode": "840", "altSpellings": ["US", "USA", "United States of America"], "callingCodes": ["1"], "translations": {"br": "Estados Unidos", "de": "Vereinigte Staaten von Amerika", "es": "Estados Unidos", "fa": "ایالات متحده آمریکا", "fr": "États-Unis", "hr": "Sjedinjene Američke Države", "it": "Stati Uniti D'America", "ja": "アメリカ合衆国", "nl": "Verenigde Staten", "pt": "Estados Unidos"}, "regionalBlocs": [{"name": "North American Free Trade Agreement", "acronym": "NAFTA", "otherNames": ["Tratado de Libre Comercio de América del Norte", "Accord de Libre-échange Nord-Américain"], "otherAcronyms": []}], "topLevelDomain": [".us"]}, {"area": 181034.0, "cioc": "URU", "flag": "https://restcountries.eu/data/ury.svg", "gini": 39.7, "name": "Uruguay", "latlng": [-33.0, -56.0], "region": "Americas", "borders": ["ARG", "BRA"], "capital": "Montevideo", "demonym": "Uruguayan", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "South America", "timezones": ["UTC-03:00"], "alpha2Code": "UY", "alpha3Code": "URY", "currencies": [{"code": "UYU", "name": "Uruguayan peso", "symbol": "$"}], "nativeName": "Uruguay", "population": 3480222, "numericCode": "858", "altSpellings": ["UY", "Oriental Republic of Uruguay", "República Oriental del Uruguay"], "callingCodes": ["598"], "translations": {"br": "Uruguai", "de": "Uruguay", "es": "Uruguay", "fa": "اروگوئه", "fr": "Uruguay", "hr": "Urugvaj", "it": "Uruguay", "ja": "ウルグアイ", "nl": "Uruguay", "pt": "Uruguai"}, "regionalBlocs": [{"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}], "topLevelDomain": [".uy"]}, {"area": 447400.0, "cioc": "UZB", "flag": "https://restcountries.eu/data/uzb.svg", "gini": 36.7, "name": "Uzbekistan", "latlng": [41.0, 64.0], "region": "Asia", "borders": ["AFG", "KAZ", "KGZ", "TJK", "TKM"], "capital": "Tashkent", "demonym": "Uzbekistani", "languages": [{"name": "Uzbek", "iso639_1": "uz", "iso639_2": "uzb", "nativeName": "Oʻzbek"}, {"name": "Russian", "iso639_1": "ru", "iso639_2": "rus", "nativeName": "Русский"}], "subregion": "Central Asia", "timezones": ["UTC+05:00"], "alpha2Code": "UZ", "alpha3Code": "UZB", "currencies": [{"code": "UZS", "name": "Uzbekistani so'm", "symbol": null}], "nativeName": "O‘zbekiston", "population": 31576400, "numericCode": "860", "altSpellings": ["UZ", "Republic of Uzbekistan", "O‘zbekiston Respublikasi", "Ўзбекистон Республикаси"], "callingCodes": ["998"], "translations": {"br": "Uzbequistão", "de": "Usbekistan", "es": "Uzbekistán", "fa": "ازبکستان", "fr": "Ouzbékistan", "hr": "Uzbekistan", "it": "Uzbekistan", "ja": "ウズベキスタン", "nl": "Oezbekistan", "pt": "Usbequistão"}, "regionalBlocs": [], "topLevelDomain": [".uz"]}, {"area": 12189.0, "cioc": "VAN", "flag": "https://restcountries.eu/data/vut.svg", "gini": null, "name": "Vanuatu", "latlng": [-16.0, 167.0], "region": "Oceania", "borders": [], "capital": "Port Vila", "demonym": "Ni-Vanuatu", "languages": [{"name": "Bislama", "iso639_1": "bi", "iso639_2": "bis", "nativeName": "Bislama"}, {"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Melanesia", "timezones": ["UTC+11:00"], "alpha2Code": "VU", "alpha3Code": "VUT", "currencies": [{"code": "VUV", "name": "Vanuatu vatu", "symbol": "Vt"}], "nativeName": "Vanuatu", "population": 277500, "numericCode": "548", "altSpellings": ["VU", "Republic of Vanuatu", "Ripablik blong Vanuatu", "République de Vanuatu"], "callingCodes": ["678"], "translations": {"br": "Vanuatu", "de": "Vanuatu", "es": "Vanuatu", "fa": "وانواتو", "fr": "Vanuatu", "hr": "Vanuatu", "it": "Vanuatu", "ja": "バヌアツ", "nl": "Vanuatu", "pt": "Vanuatu"}, "regionalBlocs": [], "topLevelDomain": [".vu"]}, {"area": 916445.0, "cioc": "VEN", "flag": "https://restcountries.eu/data/ven.svg", "gini": 44.8, "name": "Venezuela (Bolivarian Republic of)", "latlng": [8.0, -66.0], "region": "Americas", "borders": ["BRA", "COL", "GUY"], "capital": "Caracas", "demonym": "Venezuelan", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "South America", "timezones": ["UTC-04:00"], "alpha2Code": "VE", "alpha3Code": "VEN", "currencies": [{"code": "VEF", "name": "Venezuelan bolívar", "symbol": "Bs F"}], "nativeName": "Venezuela", "population": 31028700, "numericCode": "862", "altSpellings": ["VE", "Bolivarian Republic of Venezuela", "República Bolivariana de Venezuela"], "callingCodes": ["58"], "translations": {"br": "Venezuela", "de": "Venezuela", "es": "Venezuela", "fa": "ونزوئلا", "fr": "Venezuela", "hr": "Venezuela", "it": "Venezuela", "ja": "ベネズエラ・ボリバル共和国", "nl": "Venezuela", "pt": "Venezuela"}, "regionalBlocs": [{"name": "Union of South American Nations", "acronym": "USAN", "otherNames": ["Unión de Naciones Suramericanas", "União de Nações Sul-Americanas", "Unie van Zuid-Amerikaanse Naties", "South American Union"], "otherAcronyms": ["UNASUR", "UNASUL", "UZAN"]}], "topLevelDomain": [".ve"]}, {"area": 331212.0, "cioc": "VIE", "flag": "https://restcountries.eu/data/vnm.svg", "gini": 35.6, "name": "Viet Nam", "latlng": [16.16666666, 107.83333333], "region": "Asia", "borders": ["KHM", "CHN", "LAO"], "capital": "Hanoi", "demonym": "Vietnamese", "languages": [{"name": "Vietnamese", "iso639_1": "vi", "iso639_2": "vie", "nativeName": "Tiếng Việt"}], "subregion": "South-Eastern Asia", "timezones": ["UTC+07:00"], "alpha2Code": "VN", "alpha3Code": "VNM", "currencies": [{"code": "VND", "name": "Vietnamese đồng", "symbol": "₫"}], "nativeName": "Việt Nam", "population": 92700000, "numericCode": "704", "altSpellings": ["VN", "Socialist Republic of Vietnam", "Cộng hòa Xã hội chủ nghĩa Việt Nam"], "callingCodes": ["84"], "translations": {"br": "Vietnã", "de": "Vietnam", "es": "Vietnam", "fa": "ویتنام", "fr": "Viêt Nam", "hr": "Vijetnam", "it": "Vietnam", "ja": "ベトナム", "nl": "Vietnam", "pt": "Vietname"}, "regionalBlocs": [{"name": "Association of Southeast Asian Nations", "acronym": "ASEAN", "otherNames": [], "otherAcronyms": []}], "topLevelDomain": [".vn"]}, {"area": 142.0, "cioc": "", "flag": "https://restcountries.eu/data/wlf.svg", "gini": null, "name": "Wallis and Futuna", "latlng": [-13.3, -176.2], "region": "Oceania", "borders": [], "capital": "Mata-Utu", "demonym": "Wallis and Futuna Islander", "languages": [{"name": "French", "iso639_1": "fr", "iso639_2": "fra", "nativeName": "français"}], "subregion": "Polynesia", "timezones": ["UTC+12:00"], "alpha2Code": "WF", "alpha3Code": "WLF", "currencies": [{"code": "XPF", "name": "CFP franc", "symbol": "Fr"}], "nativeName": "Wallis et Futuna", "population": 11750, "numericCode": "876", "altSpellings": ["WF", "Territory of the Wallis and Futuna Islands", "Territoire des îles Wallis et Futuna"], "callingCodes": ["681"], "translations": {"br": "Wallis e Futuna", "de": "Wallis und Futuna", "es": "Wallis y Futuna", "fa": "والیس و فوتونا", "fr": "Wallis-et-Futuna", "hr": "Wallis i Fortuna", "it": "Wallis e Futuna", "ja": "ウォリス・フツナ", "nl": "Wallis en Futuna", "pt": "Wallis e Futuna"}, "regionalBlocs": [], "topLevelDomain": [".wf"]}, {"area": 266000.0, "cioc": "", "flag": "https://restcountries.eu/data/esh.svg", "gini": null, "name": "Western Sahara", "latlng": [24.5, -13.0], "region": "Africa", "borders": ["DZA", "MRT", "MAR"], "capital": "El Aaiún", "demonym": "Sahrawi", "languages": [{"name": "Spanish", "iso639_1": "es", "iso639_2": "spa", "nativeName": "Español"}], "subregion": "Northern Africa", "timezones": ["UTC+00:00"], "alpha2Code": "EH", "alpha3Code": "ESH", "currencies": [{"code": "MAD", "name": "Moroccan dirham", "symbol": "د.م."}, {"code": "DZD", "name": "Algerian dinar", "symbol": "د.ج"}], "nativeName": "الصحراء الغربية", "population": 510713, "numericCode": "732", "altSpellings": ["EH", "Taneẓroft Tutrimt"], "callingCodes": ["212"], "translations": {"br": "Saara Ocidental", "de": "Westsahara", "es": "Sahara Occidental", "fa": "جمهوری دموکراتیک عربی صحرا", "fr": "Sahara Occidental", "hr": "Zapadna Sahara", "it": "Sahara Occidentale", "ja": "西サハラ", "nl": "Westelijke Sahara", "pt": "Saara Ocidental"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".eh"]}, {"area": 527968.0, "cioc": "YEM", "flag": "https://restcountries.eu/data/yem.svg", "gini": 37.7, "name": "Yemen", "latlng": [15.0, 48.0], "region": "Asia", "borders": ["OMN", "SAU"], "capital": "Sana'a", "demonym": "Yemeni", "languages": [{"name": "Arabic", "iso639_1": "ar", "iso639_2": "ara", "nativeName": "العربية"}], "subregion": "Western Asia", "timezones": ["UTC+03:00"], "alpha2Code": "YE", "alpha3Code": "YEM", "currencies": [{"code": "YER", "name": "Yemeni rial", "symbol": "﷼"}], "nativeName": "اليَمَن", "population": 27478000, "numericCode": "887", "altSpellings": ["YE", "Yemeni Republic", "al-Jumhūriyyah al-Yamaniyyah"], "callingCodes": ["967"], "translations": {"br": "Iêmen", "de": "Jemen", "es": "Yemen", "fa": "یمن", "fr": "Yémen", "hr": "Jemen", "it": "Yemen", "ja": "イエメン", "nl": "Jemen", "pt": "Iémen"}, "regionalBlocs": [{"name": "Arab League", "acronym": "AL", "otherNames": ["جامعة الدول العربية", "Jāmiʻat ad-Duwal al-ʻArabīyah", "League of Arab States"], "otherAcronyms": []}], "topLevelDomain": [".ye"]}, {"area": 752612.0, "cioc": "ZAM", "flag": "https://restcountries.eu/data/zmb.svg", "gini": 54.6, "name": "Zambia", "latlng": [-15.0, 30.0], "region": "Africa", "borders": ["AGO", "BWA", "COD", "MWI", "MOZ", "NAM", "TZA", "ZWE"], "capital": "Lusaka", "demonym": "Zambian", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}], "subregion": "Eastern Africa", "timezones": ["UTC+02:00"], "alpha2Code": "ZM", "alpha3Code": "ZMB", "currencies": [{"code": "ZMW", "name": "Zambian kwacha", "symbol": "ZK"}], "nativeName": "Zambia", "population": 15933883, "numericCode": "894", "altSpellings": ["ZM", "Republic of Zambia"], "callingCodes": ["260"], "translations": {"br": "Zâmbia", "de": "Sambia", "es": "Zambia", "fa": "زامبیا", "fr": "Zambie", "hr": "Zambija", "it": "Zambia", "ja": "ザンビア", "nl": "Zambia", "pt": "Zâmbia"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".zm"]}, {"area": 390757.0, "cioc": "ZIM", "flag": "https://restcountries.eu/data/zwe.svg", "gini": null, "name": "Zimbabwe", "latlng": [-20.0, 30.0], "region": "Africa", "borders": ["BWA", "MOZ", "ZAF", "ZMB"], "capital": "Harare", "demonym": "Zimbabwean", "languages": [{"name": "English", "iso639_1": "en", "iso639_2": "eng", "nativeName": "English"}, {"name": "Shona", "iso639_1": "sn", "iso639_2": "sna", "nativeName": "chiShona"}, {"name": "Northern Ndebele", "iso639_1": "nd", "iso639_2": "nde", "nativeName": "isiNdebele"}], "subregion": "Eastern Africa", "timezones": ["UTC+02:00"], "alpha2Code": "ZW", "alpha3Code": "ZWE", "currencies": [{"code": "BWP", "name": "Botswana pula", "symbol": "P"}, {"code": "GBP", "name": "British pound", "symbol": "£"}, {"code": "CNY", "name": "Chinese yuan", "symbol": "¥"}, {"code": "EUR", "name": "Euro", "symbol": "€"}, {"code": "INR", "name": "Indian rupee", "symbol": "₹"}, {"code": "JPY", "name": "Japanese yen", "symbol": "¥"}, {"code": "ZAR", "name": "South African rand", "symbol": "Rs"}, {"code": "USD", "name": "United States dollar", "symbol": "$"}, {"code": "(none)", "name": null, "symbol": null}], "nativeName": "Zimbabwe", "population": 14240168, "numericCode": "716", "altSpellings": ["ZW", "Republic of Zimbabwe"], "callingCodes": ["263"], "translations": {"br": "Zimbabwe", "de": "Simbabwe", "es": "Zimbabue", "fa": "زیمباوه", "fr": "Zimbabwe", "hr": "Zimbabve", "it": "Zimbabwe", "ja": "ジンバブエ", "nl": "Zimbabwe", "pt": "Zimbabué"}, "regionalBlocs": [{"name": "African Union", "acronym": "AU", "otherNames": ["الاتحاد الأفريقي", "Union africaine", "União Africana", "Unión Africana", "Umoja wa Afrika"], "otherAcronyms": []}], "topLevelDomain": [".zw"]}]
\.


--
-- TOC entry 5431 (class 0 OID 17266)
-- Dependencies: 283
-- Data for Name: demonym; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.demonym (demonym_id, demonym_name) FROM stdin;
1	Afghan
2	Ålandish
3	Albanian
4	Algerian
5	American
6	American Samoan
7	Andorran
8	Angolan
9	Anguillian
10	Antiguan, Barbudan
11	Argentinean
12	Armenian
13	Aruban
14	Australian
15	Austrian
16	Azerbaijani
17	Bahamian
18	Bahraini
19	Bangladeshi
20	Barbadian
21	Belarusian
22	Belgian
23	Belizean
24	Beninese
25	Bermudian
26	Bhutanese
27	Bolivian
28	Bosnian, Herzegovinian
29	Brazilian
30	British
31	Bruneian
32	Bulgarian
33	Burkinabe
34	Burmese
35	Burundian
36	Cambodian
37	Cameroonian
38	Canadian
39	Cape Verdian
40	Caymanian
41	Central African
42	Chadian
43	Channel Islander
44	Chilean
45	Chinese
46	Christmas Island
47	Cocos Islander
48	Colombian
49	Comoran
50	Congolese
51	Cook Islander
52	Costa Rican
53	Croatian
54	Cuban
55	Cypriot
56	Czech
57	Danish
58	Djibouti
59	Dominican
60	Dutch
61	East Timorese
62	Ecuadorean
63	Egyptian
64	Emirati
65	Equatorial Guinean
66	Eritrean
67	Estonian
68	Ethiopian
69	Falkland Islander
70	Faroese
71	Fijian
72	Filipino
73	Finnish
74	French
75	French Polynesian
76	Gabonese
77	Gambian
78	Georgian
79	German
80	Ghanaian
81	Gibraltar
82	Greek
83	Greenlandic
84	Grenadian
85	Guadeloupian
86	Guamanian
87	Guatemalan
88	Guinea-Bissauan
89	Guinean
90	Guyanese
91	Haitian
92	Heard and McDonald Islander
93	Honduran
94	Hungarian
95	Icelander
96	I-Kiribati
97	Indian
98	Indonesian
99	Iranian
100	Iraqi
101	Irish
102	Israeli
103	Italian
104	Ivorian
105	Jamaican
106	Japanese
107	Jordanian
108	Kazakhstani
109	Kenyan
110	Kirghiz
111	Kittian and Nevisian
112	Kosovar
113	Kuwaiti
114	Laotian
115	Latvian
116	Lebanese
117	Liberian
118	Libyan
119	Liechtensteiner
120	Lithuanian
121	Luxembourger
122	Macedonian
123	Malagasy
124	Malawian
125	Malaysian
126	Maldivan
127	Malian
128	Maltese
129	Manx
130	Marshallese
131	Mauritanian
132	Mauritian
133	Mexican
134	Micronesian
135	Moldovan
136	Monegasque
137	Mongolian
138	Montenegrin
139	Montserratian
140	Moroccan
141	Mosotho
142	Motswana
143	Mozambican
144	Namibian
145	Nauruan
146	Nepalese
147	New Caledonian
148	New Zealander
149	Nicaraguan
150	Nigerian
151	Nigerien
152	Niuean
153	Ni-Vanuatu
154	Norfolk Islander
155	North Korean
156	Norwegian
157	Omani
158	Pakistani
159	Palauan
160	Palestinian
161	Panamanian
162	Papua New Guinean
163	Paraguayan
164	Peruvian
165	Pitcairn Islander
166	Polish
167	Portuguese
168	Puerto Rican
169	Qatari
170	Romanian
171	Russian
172	Rwandan
173	Sahrawi
174	Saint Barthélemy Islander
175	Saint Helenian
176	Saint Lucian
177	Saint Martin Islander
178	Saint Vincentian
179	Salvadoran
180	Sammarinese
181	Samoan
182	Sao Tomean
183	Saudi Arabian
184	Senegalese
185	Serbian
186	Seychellois
187	Sierra Leonean
188	Singaporean
189	Slovak
190	Slovene
191	Solomon Islander
192	Somali
193	South African
194	South Georgia and the South Sandwich Islander
195	South Korean
196	South Sudanese
197	Spanish
198	Sri Lankan
199	Sudanese
200	Surinamer
201	Swazi
202	Swedish
203	Swiss
204	Syrian
205	Tadzhik
206	Taiwanese
207	Tanzanian
208	Thai
209	Togolese
210	Tokelauan
211	Tongan
212	Trinidadian
213	Tunisian
214	Turkish
215	Turkmen
216	Turks and Caicos Islander
217	Tuvaluan
218	Ugandan
219	Ukrainian
220	Uruguayan
221	Uzbekistani
222	Venezuelan
223	Vietnamese
224	Virgin Islander
225	Wallis and Futuna Islander
226	Yemeni
227	Zambian
228	Zimbabwean
\.


--
-- TOC entry 5432 (class 0 OID 17271)
-- Dependencies: 284
-- Data for Name: domain; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.domain (domain_id, domain_name) FROM stdin;
1	.uz
2	.gh
3	.pt
4	.hm
5	.py
6	.mg
7	.de
8	.kz
9	.hu
10	.fi
11	.dj
12	.kw
13	.fj
14	.tk
15	.is
16	.nl
17	.ws
18	.do
19	.gp
20	.dz
21	.ua
22	.ke
23	.cz
24	.nu
25	.lv
26	.ch
27	.tm
28	.jo
29	.ro
30	.tg
31	.gy
32	.tf
33	.gq
34	.sa
35	.tj
36	.gn
37	.je
38	.ax
39	.ci
40	.tr
41	.nc
42	.cv
43	.pe
44	.as
45	.pw
46	.pa
47	.np
48	.ug
49	.ma
50	.id
51	.fr
52	.md
53	.uy
54	.us
55	.sb
56	.mf
57	.no
58	.ie
59	.tt
60	.ca
61	.kr
62	.bd
63	.bw
64	.sk
65	.qa
66	.ag
67	.mp
68	.mq
69	.vg
70	.ml
71	.af
72	.ai
73	.gu
74	.dm
75	.bn
76	.kg
77	.tl
78	.cm
79	.me
80	.ru
81	.er
82	.ni
83	.es
84	.li
85	.fm
86	.gl
87	.ao
88	.va
89	.it
90	.eg
91	.vc
92	.cx
93	.mn
94	.co
95	.my
96	.ht
97	.aq
98	.st
99	.mw
100	.sr
101	.ae
102	.tc
103	.mc
104	.to
105	.rs
106	.et
107	.az
108	.re
109	.ge
110	.hn
111	.lc
112	.mu
113	.ar
114	.jm
115	.dk
116	.mx
117	.ms
118	.bl
119	.mo
120	.lk
121	.sj
122	.sz
123	.ck
124	.km
125	.ly
126	.tv
127	.nz
128	.ps
129	.la
130	.sl
131	.pf
132	.bg
133	.cd
134	.cy
135	.bs
136	.za
137	.mv
138	.vu
139	.gd
140	.be
141	.sv
142	.kh
143	.gs
144	.ss
145	.lt
146	.hr
147	.sg
148	.in
149	.il
150	.bt
151	.kp
152	.wf
153	.sh
154	.ga
155	.br
156	.ls
157	.jp
158	.gg
159	.cu
160	.mk
161	.bh
162	.at
163	.sn
164	.vn
165	.gf
166	.nr
167	.mr
168	.gi
169	.ba
170	.mz
171	.cw
172	.eh
173	.ee
174	.lr
175	.sc
176	.al
177	.mt
178	.pn
179	.lb
180	.pl
181	.aw
182	.uk
183	.so
184	.ec
185	.ye
186	.io
187	.fk
188	.an
189	.ne
190	.ky
191	.ki
192	.bb
193	.se
194	.sm
195	.am
196	.nf
197	.vi
198	.bj
199	.tn
200	.mm
201	.sy
202	.na
203	.tz
204	.cc
205	.td
206	.iq
207	.zm
208	.gr
209	.fo
210	.lu
211	.bi
212	.sx
213	.қаз
214	.tw
215	.gm
216	.im
217	.cr
218	.cn
219	.pm
220	.om
221	.mh
222	.cl
223	.bf
224	.bv
225	.ng
226	.si
227	.hk
228	.bo
229	.bm
230	.ad
231	.sd
232	.rw
233	.cg
234	.yt
235	.th
236	.cf
237	.zw
238	.pg
239	.kn
240	.by
241	.ph
242	.ve
243	.gw
244	.bz
245	.pr
246	.pk
247	.ir
248	.gt
249	.au
\.


--
-- TOC entry 5433 (class 0 OID 17276)
-- Dependencies: 285
-- Data for Name: language; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.language (language_id, language_iso2, language_iso3, language_name, language_nativename) FROM stdin;
1	af	afr	Afrikaans	Afrikaans
2	am	amh	Amharic	አማርኛ
3	ar	ara	Arabic	العربية
4	ay	aym	Aymara	aymar aru
5	az	aze	Azerbaijani	azərbaycan dili
6	be	bel	Belarusian	беларуская мова
7	bg	bul	Bulgarian	български език
8	bi	bis	Bislama	Bislama
9	bn	ben	Bengali	বাংলা
10	bs	bos	Bosnian	bosanski jezik
11	ca	cat	Catalan	català
12	ch	cha	Chamorro	Chamoru
13	cs	ces	Czech	čeština
14	da	dan	Danish	dansk
15	de	deu	German	Deutsch
16	dv	div	Divehi	ދިވެހި
17	dz	dzo	Dzongkha	རྫོང་ཁ
18	el	ell	Greek (modern)	ελληνικά
19	en	eng	English	English
20	es	spa	Spanish	Español
21	et	est	Estonian	eesti
22	fa	fas	Persian (Farsi)	فارسی
23	ff	ful	Fula	Fulfulde
24	fi	fin	Finnish	suomi
25	fj	fij	Fijian	vosa Vakaviti
26	fo	fao	Faroese	føroyskt
27	fr	fra	French	français
28	ga	gle	Irish	Gaeilge
29	gn	grn	Guaraní	Avañe'ẽ
30	gv	glv	Manx	Gaelg
31	he	heb	Hebrew (modern)	עברית
32	hi	hin	Hindi	हिन्दी
33	hr	hrv	Croatian	hrvatski jezik
34	ht	hat	Haitian	Kreyòl ayisyen
35	hu	hun	Hungarian	magyar
36	hy	hye	Armenian	Հայերեն
37	id	ind	Indonesian	Bahasa Indonesia
38	is	isl	Icelandic	Íslenska
39	it	ita	Italian	Italiano
40	ja	jpn	Japanese	日本語 (にほんご)
41	ka	kat	Georgian	ქართული
42	kg	kon	Kongo	Kikongo
43	kk	kaz	Kazakh	қазақ тілі
44	kl	kal	Kalaallisut	kalaallisut
45	km	khm	Khmer	ខ្មែរ
46	ko	kor	Korean	한국어
47	ku	kur	Kurdish	Kurdî
48	ky	kir	Kyrgyz	Кыргызча
49	la	lat	Latin	latine
50	lb	ltz	Luxembourgish	Lëtzebuergesch
51	ln	lin	Lingala	Lingála
52	lo	lao	Lao	ພາສາລາວ
53	lt	lit	Lithuanian	lietuvių kalba
54	lu	lub	Luba-Katanga	Tshiluba
55	lv	lav	Latvian	latviešu valoda
56	mg	mlg	Malagasy	fiteny malagasy
57	mh	mah	Marshallese	Kajin M̧ajeļ
58	mi	mri	Māori	te reo Māori
59	mk	mkd	Macedonian	македонски јазик
60	mn	mon	Mongolian	Монгол хэл
61	ms	msa	Malay	bahasa Melayu
62	mt	mlt	Maltese	Malti
63	my	mya	Burmese	ဗမာစာ
64	na	nau	Nauruan	Dorerin Naoero
65	nb	nob	Norwegian Bokmål	Norsk bokmål
66	nd	nde	Northern Ndebele	isiNdebele
67	ne	nep	Nepali	नेपाली
68	nl	nld	Dutch	Nederlands
69	nn	nno	Norwegian Nynorsk	Norsk nynorsk
70	no	nor	Norwegian	Norsk
71	nr	nbl	Southern Ndebele	isiNdebele
72	ny	nya	Chichewa	chiCheŵa
73	pa	pan	(Eastern) Punjabi	ਪੰਜਾਬੀ
74	pl	pol	Polish	język polski
75	ps	pus	Pashto	پښتو
76	pt	por	Portuguese	Português
77	qu	que	Quechua	Runa Simi
78	rn	run	Kirundi	Ikirundi
79	ro	ron	Romanian	Română
80	ru	rus	Russian	Русский
81	rw	kin	Kinyarwanda	Ikinyarwanda
82	sg	sag	Sango	yângâ tî sängö
83	si	sin	Sinhalese	සිංහල
84	sk	slk	Slovak	slovenčina
85	sl	slv	Slovene	slovenski jezik
86	sm	smo	Samoan	gagana fa'a Samoa
87	sn	sna	Shona	chiShona
88	so	som	Somali	Soomaaliga
89	sq	sqi	Albanian	Shqip
90	sr	srp	Serbian	српски језик
91	ss	ssw	Swati	SiSwati
92	st	sot	Southern Sotho	Sesotho
93	sv	swe	Swedish	svenska
94	sw	swa	Swahili	Kiswahili
95	ta	tam	Tamil	தமிழ்
96	tg	tgk	Tajik	тоҷикӣ
97	th	tha	Thai	ไทย
98	ti	tir	Tigrinya	ትግርኛ
99	tk	tuk	Turkmen	Türkmen
100	tn	tsn	Tswana	Setswana
101	to	ton	Tonga (Tonga Islands)	faka Tonga
102	tr	tur	Turkish	Türkçe
103	ts	tso	Tsonga	Xitsonga
104	uk	ukr	Ukrainian	Українська
105	ur	urd	Urdu	اردو
106	uz	uzb	Uzbek	Oʻzbek
107	ve	ven	Venda	Tshivenḓa
108	vi	vie	Vietnamese	Tiếng Việt
109	xh	xho	Xhosa	isiXhosa
110	zh	zho	Chinese	中文 (Zhōngwén)
111	zu	zul	Zulu	isiZulu
112	\N	zsm	Malaysian	بهاس مليسيا
\.


--
-- TOC entry 5434 (class 0 OID 17281)
-- Dependencies: 286
-- Data for Name: region; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.region (region_id, region_name) FROM stdin;
1	Africa
2	Americas
3	Asia
4	Europe
5	Oceania
6	Polar
\.


--
-- TOC entry 5435 (class 0 OID 17286)
-- Dependencies: 287
-- Data for Name: regionalbloc; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.regionalbloc (regionalbloc_id, regionalbloc_acronym, regionalbloc_name) FROM stdin;
1	CARICOM	Caribbean Community
2	CEFTA	Central European Free Trade Agreement
3	EEU	Eurasian Economic Union
4	AU	African Union
5	PA	Pacific Alliance
6	AL	Arab League
7	ASEAN	Association of Southeast Asian Nations
8	EU	European Union
9	CAIS	Central American Integration System
10	SAARC	South Asian Association for Regional Cooperation
11	NAFTA	North American Free Trade Agreement
12	EFTA	European Free Trade Association
13	USAN	Union of South American Nations
\.


--
-- TOC entry 5436 (class 0 OID 17291)
-- Dependencies: 288
-- Data for Name: regionalblocname; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.regionalblocname (regionalblocname_id, regionalblocname_regionalbloc_id, regionalblocname_name) FROM stdin;
1	1	Caribische Gemeenschap
2	1	Communauté Caribéenne
3	1	Comunidad del Caribe
4	4	Umoja wa Afrika
5	4	União Africana
6	4	Union africaine
7	4	Unión Africana
8	4	الاتحاد الأفريقي
9	5	Alianza del Pacífico
10	6	Jāmiʻat ad-Duwal al-ʻArabīyah
11	6	League of Arab States
12	6	جامعة الدول العربية
13	9	Sistema de la Integración Centroamericana,
14	11	Accord de Libre-échange Nord-Américain
15	11	Tratado de Libre Comercio de América del Norte
16	13	South American Union
17	13	União de Nações Sul-Americanas
18	13	Unie van Zuid-Amerikaanse Naties
19	13	Unión de Naciones Suramericanas
\.


--
-- TOC entry 5437 (class 0 OID 17296)
-- Dependencies: 289
-- Data for Name: regionalblocother; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.regionalblocother (regionalblocother_id, regionalblocother_regionalbloc_id, regionalblocother_otheracronym) FROM stdin;
1	3	EAEU
2	9	SICA
3	13	UNASUL
4	13	UNASUR
5	13	UZAN
\.


--
-- TOC entry 5457 (class 0 OID 17320)
-- Dependencies: 309
-- Data for Name: subregion; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.subregion (subregion_id, subregion_name) FROM stdin;
1	Australia and New Zealand
2	Caribbean
3	Central America
4	Central Asia
5	Eastern Africa
6	Eastern Asia
7	Eastern Europe
8	Melanesia
9	Micronesia
10	Middle Africa
11	Northern Africa
12	Northern America
13	Northern Europe
14	Polynesia
15	South America
16	South-Eastern Asia
17	Southern Africa
18	Southern Asia
19	Southern Europe
20	Western Africa
21	Western Asia
22	Western Europe
\.


--
-- TOC entry 5459 (class 0 OID 17326)
-- Dependencies: 311
-- Data for Name: timezone; Type: TABLE DATA; Schema: geoinfo; Owner: -
--

COPY geoinfo.timezone (timezone_id, timezone_timezone) FROM stdin;
1	UTC+05:45
2	UTC+03:00
3	UTC-03:00
4	UTC+11:30
5	UTC+05:30
6	UTC-08:00
7	UTC
8	UTC+09:00
9	UTC+06:30
10	UTC+01:00
11	UTC-10:00
12	UTC+04:00
13	UTC+00:00
14	UTC+12:00
15	UTC+12:45
16	UTC+09:30
17	UTC-03:30
18	UTC+04
19	UTC+10:00
20	UTC+08:00
21	UTC+07:00
22	UTC-02:00
23	UTC-07:00
24	UTC-09:30
25	UTC+10:30
26	UTC+04:30
27	UTC-04:00
28	UTC+14:00
29	UTC-11:00
30	UTC-12:00
31	UTC-05:00
32	UTC+02:00
33	UTC+06:00
34	UTC+03:30
35	UTC+05:00
36	UTC+11
37	UTC+11:00
38	UTC-06:00
39	UTC-01:00
40	UTC+13:00
41	UTC-09:00
\.


--
-- TOC entry 5508 (class 0 OID 19674)
-- Dependencies: 364
-- Data for Name: domsync; Type: TABLE DATA; Schema: libdom; Owner: -
--

COPY libdom.domsync (classname, columnname, domain, comment) FROM stdin;
report.parametrized	parametrized_state	report.parametrized.parametrized_state	\N
report.filter	filter_state	report.filter.filter_state	\N
\.


--
-- TOC entry 5507 (class 0 OID 19661)
-- Dependencies: 363
-- Data for Name: entryset; Type: TABLE DATA; Schema: libdom; Owner: -
--

COPY libdom.entryset (name, type, value, domain, label, editable, comment) FROM stdin;
report_filter_state_active	smallint	1	report.filter.filter_state	Ativo	f	\N
report_filter_state_fechado	smallint	0	report.filter.filter_state	Fechado	f	\N
report_filter_filter_valuemode_samevalue	smallint	1	report.filter.filter_valuemode	Mesmo valor	f	\N
report_filter_filter_valuemode_dateprocess	smallint	2	report.filter.filter_valuemode	Data do processamento	f	\N
report_filter_filter_valuemode_daterelative	smallint	3	report.filter.filter_valuemode	Relativo a data atual	f	\N
report_filter_filter_valuemode_ask	smallint	4	report.filter.filter_valuemode	Pedir	f	\N
report_filter_filter_valuemode_askallways	smallint	5	report.filter.filter_valuemode	Pedir sempre	f	\N
\.


--
-- TOC entry 5461 (class 0 OID 17332)
-- Dependencies: 313
-- Data for Name: constvalue; Type: TABLE DATA; Schema: map; Owner: -
--

COPY map.constvalue (constvalue_name, constvalue_type, constvalue_value, constvalue_editable, constvalue_descrision, constvalue_comment) FROM stdin;
acesso_estado_fechado	smallint	0	f	\N	\N
cluster_tcluster_local	smallint	1	f	Is current cluster	\N
colaborador_tipo_system	smallint	0	f	\N	\N
colaborador_estado_ativo	smallint	1	f	\N	\N
perfil_estado_fechado	smallint	0	f	\N	\N
menu_estado_ativo	smallint	1	f	\N	\N
perfil_estado_ativo	smallint	1	f	\N	\N
privilegio_estado_ativo	smallint	1	f	\N	\N
privilegio_estado_fechado	smallint	0	f	\N	\N
colaborador_tipo_user_master	smallint	2	f	\N	\N
cluster_tcluster_master	smallint	2	f	Is master cluster of this current cluster	\N
acesso_estado_ativo	smallint	1	f	\N	\N
colaborador_estado_fechado	smallint	0	f	\N	\N
colaborador_accesso_ativo	smallint	1	f	\N	\N
autenticacao_estado_ativo	smallint	1	f	\N	\N
autenticacao_estado_fechado	smallint	0	f	\N	\N
colaborador_accesso_fechado	smallint	0	f	\N	\N
menu_maxchildren	smallint	99	f	\N	\N
menu_estado_fechado	smallint	0	f	\N	\N
colaborador_tipo_user	smallint	1	f	\N	\N
colaborador_token_limit	interval	24:00:00	f	Limite de validade do token	Esse atributo indica o limite de validade do token
colaborador_token_length	smallint	64	f	Tamanho do token	Esse atributo indica o tamanho do token a ser gerado
colaborador_accesso_pendente	smallint	2	f	\N	\N
autenticacao_chave_length	smallint	32	f	\N	\N
cluster_tcluster_remote	smallint	3	f	Is another cluster without direct link	\N
tespaco_venda	smallint	1	f	Espaço de venda (balcão)	\N
tespaco_armazem	smallint	2	f	Armazem	\N
classe_estado_ativo	smallint	1	f	\N	\N
classe_estado_fechado	smallint	0	f	\N	\N
cluster_tcluster_child	smallint	4	f	Is child cluster of current cluster	\N
cluster_treplication_replicate	smallint	1	f	\N	\N
espaco_estado_ativo	smallint	1	f	\N	\N
espaco_estado_fechado	smallint	0	f	\N	\N
artigo_estado_ativo	smallint	1	f	\N	\N
artigo_estado_fechado	smallint	0	f	\N	\N
item_estado_ativo	smallint	1	f	\N	\N
dispoe_estado_ativo	smallint	1	f	\N	\N
dispoe_estado_fechado	smallint	0	f	\N	\N
cluster_treplication_readonly	smallint	2	f	\N	\N
cluster_tree_position_trunc	smallint	1	f	\N	\N
stock_estado_ativo	smallint	1	f	\N	\N
stock_estado_fechado	smallint	0	f	\N	\N
entrada_estado_ativo	smallint	1	f	\N	\N
entrada_estado_anulado	smallint	-1	f	\N	\N
transferencia_estado_ativo	smallint	1	f	\N	\N
transferencia_estado_aanulado	smallint	-1	f	\N	\N
acerto_estado_ativo	smallint	1	f	\N	\N
acerto_estado_anulado	smallint	-1	f	\N	\N
precario_estado_ativo	smallint	1	f	\N	\N
precario_estado_fechado	smallint	0	f	\N	\N
cambio_estado_ativo	smallint	1	f	Cambio ativo	\N
cambio_estado_fechado	smallint	0	f	Cambio fechado	\N
cluster_tree_position_branch	smallint	2	f	\N	\N
cluster_grant_revision_child	character varying	revision_child	f	\N	\N
cluster_grant_revision_sub_path	character varying	revision_sub_path	f	\N	\N
espaco_default	smallint	1	f	\N	\N
item_estado_fechado	smallint	2	f	\N	\N
movimento_estado_ativo	smallint	1	f	\N	\N
movimento_estado_anulado	smallint	0	f	\N	\N
movimento_estado_canselado	smallint	-1	f	\N	\N
colaborador_system_support	uuid	00000000-0000-0000-0000-000000000002	f	Colaborador System support	\N
colaborador_chavemodo_padrao	smallint	1	f	Chave de acesso padrao	\N
colaborador_chavemodo_gerado	smallint	2	f	Chave de acesso gerado	\N
colaborador_chavemodo_utilizador	smallint	3	f	Chave de acesso difinido pelo utilizador	\N
cambio_estado_anulado	smallint	-1	f	\N	\N
currency_std	smallint	141	f	STD	\N
toperacao_classe_stock	smallint	1	f	\N	\N
toperacao_classe_montante	smallint	2	f	\N	\N
menu_raizcomplete	character varying	00	f	\N	\N
mesa_estado_disponivel	smallint	2	f	\N	\N
mesa_estado_ocupado	smallint	1	f	\N	\N
mesa_estado_desativado	smallint	0	f	\N	\N
tposto_venda	smallint	1	f	\N	\N
tposto_cobranca	smallint	2	f	\N	\N
tposto_tudo	smallint	3	f	\N	\N
taxa_estado_ativo	smallint	1	f	\N	\N
taxa_estado_fechado	smallint	0	f	\N	\N
impostovenda_estado_ativo	smallint	1	f	\N	\N
impostovenda_estado_fechado	smallint	0	f	\N	\N
tipoimposto_estado_ativo	smallint	1	f	\N	\N
tipoimposto_estado_fechado	smallint	0	f	\N	\N
colaborador_system_data	uuid	00000000-0000-0000-0000-000000000001	f	Colaborador System data	\N
classe_itemextra	uuid	00000000-0000-0000-0000-000000000001	f	\N	\N
maguita_retalho_estado_ativo	smallint	1	f	RETALHO ESTADO ATIVO	\N
maguita_ean_estado_ativo	smallint	1	f	Estado de ean ATIVO	\N
maguita_ean_estado_fechado	smallint	0	f	Estado de ean FECHADO	\N
maguita_tlink_preco	smallint	4	f	Tipo de link	\N
maguita_fornecedor_estado_ativo	smallint	1	f	\N	\N
maguita_fornecedor_estado_fechado	smallint	0	f	\N	\N
maguita_aloca_estado_fechado	smallint	0	f	\N	\N
maguita_aloca_estado_ativo	smallint	1	f	\N	\N
maguita_posto_estado_encerado	smallint	-1	f	\N	Nenhuma caixa aberta e nem pode abrir qualquer caixa
maguita_posto_estado_fechado	smallint	1	f	\N	Nenhuma caixa atualmente no posto
maguita_posto_estado_aberto	smallint	2	f	\N	Existe uma caixa aberta no posto
maguita_tlink_classe	smallint	5	f	\N	\N
maguita_posto_caixamodo_pessoal	smallint	1	f	Cada pessoa em cada espaço com sua propria caixa	\N
maguita_posto_caixamodo_espaco	smallint	2	f	Cada espaço com sua propria caixa	\N
maguita_posto_caixamodo_posto	smallint	3	f	Uma caixa para todo o posto	\N
maguita_caixa_estado_ativo	smallint	1	f	\N	\N
maguita_caixa_estado_fechado	smallint	0	f	\N	\N
maguita_venda_estado_aberto	smallint	1	f	\N	\N
maguita_venda_estado_fechado	smallint	0	f	\N	\N
maguita_venda_estado_anulado	smallint	-1	f	\N	\N
maguita_venda_estado_canselado	smallint	-2	f	\N	\N
maguita_venda_estadopreparacao_pendente	smallint	1	f	\N	\N
maguita_venda_estadopreparacao_preparado	smallint	0	f	\N	\N
maguita_imposto_estado_ativo	smallint	1	f	\N	\N
maguita_imposto_estado_fechado	smallint	0	f	\N	\N
maguita_taplicar_adicionar	smallint	1	f	\N	\N
maguita_taplicar_retirar	smallint	2	f	\N	\N
maguita_cliente_estado_ativo	smallint	1	f	\N	\N
maguita_conta_estado_anulado	smallint	-1	f	\N	\N
maguita_espaco_estado_ativo	smallint	1	f	\N	\N
maguita_espaco_estado_fechado	smallint	0	f	\N	\N
maguita_cambio_estado_ativo	smallint	1	f	Cambio ativo	\N
maguita_cambio_estado_fechado	smallint	0	f	Cambio fechado	\N
maguita_espaco_default	smallint	1	f	\N	\N
maguita_cambio_estado_anulado	smallint	-1	f	\N	\N
maguita_tpaga_cash	smallint	1	f	\N	\N
maguita_tpaga_deposito	smallint	2	f	\N	\N
maguita_tpaga_transferencia	smallint	3	f	\N	\N
maguita_tpaga_cheque	smallint	4	f	\N	\N
maguita_tpaga_contacorrente	smallint	5	f	\N	\N
maguita_deposito_estado_ativo	smallint	1	f	\N	\N
maguita_tlancamento_deposito	smallint	1	f		\N
maguita_tlancamento_conta	smallint	2	f		\N
maguita_lancamento_estado_ativo	smallint	1	f	\N	\N
maguita_conta_estado_aberto	smallint	1	f	\N	\N
maguita_conta_estado_fechado	smallint	0	f	\N	\N
maguita_transacao_estado_ativo	smallint	1	f	Esatdo ativo de transação	\N
maguita_link_estado_fechado	smallint	0	f	\N	\N
maguita_link_estado_ativo	smallint	1	f	\N	\N
maguita_trabalha_estado_ativo	smallint	1	f	\N	\N
maguita_trabalha_estado_fechado	smallint	0	f	\N	\N
maguita_cliente_estado_desativo	smallint	0	f	\N	\N
maguita_tmovimento_credito	smallint	1	f	Movimento de credito	\N
maguita_tmovimento_debito	smallint	2	f	Movimento de credito	\N
maguita_toperacao_acerto	smallint	2	f	\N	\N
maguita_toperacao_venda	smallint	3	f	\N	\N
maguita_toperacao_transferencia	smallint	4	f	\N	\N
maguita_toperacao_entrada	smallint	1	f	\N	\N
maguita_toperacao_movimento	smallint	5	f	\N	\N
maguita_toperacao_pagamento	smallint	6	f	\N	\N
maguita_toperacao_retalho	smallint	7	f	Tipo de operação para retalho	\N
maguita_fluxo_estado_anulado	smallint	-1	f	Fluxo anulado	\N
cluster_break_status_pendent	smallint	2	f	\N	\N
maguita_serie_estado_ativo	smallint	1	f	\N	\N
cluster_break_status_solved	smallint	1	f	\N	\N
cluster_break_status_rejected	smallint	0	f	\N	\N
cluster_grant_revision_supper_path	text	cluster_grant_revision_supper_path	f	\N	\N
maguita_tserie_fatura	smallint	1	f	Serie para fatura	\N
maguita_tserie_faturarecibo	smallint	2	f	Serie para fatura & Recibo	\N
maguita_tserie_recibo	smallint	3	f	Serie para recibo	\N
maguita_tgrupo_cnormal	smallint	1	f	Conta normal	\N
maguita_tgrupo_ccorrente	smallint	2	f	Conta correte	\N
maguita_guia_estado_ativo	smallint	1	f	Estado ativo de guia	\N
maguita_tguia_entrada	smallint	1	f	Identificador para as guias de entrada	\N
maguita_tguia_saida	smallint	2	f	Identificador para as guias de saida	\N
maguita_custoguia_estado_ativo	smallint	1	f	Estado ativo para custo de guia	\N
maguita_custoguia_estado_canselado	smallint	-1	f	Estado ativo para custo de guia canselado	\N
maguita_tlink_associacao	smallint	3	f	\N	\N
money_round	integer	2	f	\N	\N
maguita_tlancamento_outros	smallint	3	f	\N	\N
maguita_lancamento_mode_automatic	smallint	1	f	\N	\N
maguita_lancamento_mode_manual	smallint	2	f	\N	\N
maguita_serie_estado_fechado	smallint	0	f	\N	\N
maguita_lancamento_estado_anulado	smallint	-1	f	Lançamento anulado	\N
cluster_auth_status_active	smallint	1	f	\N	\N
cluster_auth_status_close	smallint	0	f	\N	\N
maguita_tserie_notacredito	smallint	4	f	\N	\N
maguita_autorizacao_estado_ativo	smallint	1	f	\N	\N
maguita_autorizacao_estado_fechado	smallint	0	f	\N	\N
maguita_tserie_guiasaida	smallint	5	f	Guia de saida	Guia de saida
maguita_cliente_final	uuid	00000000-0000-0000-0000-000000000001	f	\N	\N
maguita_cliente_finalnotacredito	uuid	00000000-0000-0000-0000-000000000002	f	\N	\N
maguita_fluxo_estado_ativo	smallint	1	f	\N	\N
maguita_fluxo_estado_fechado	smallint	0	f	\N	\N
maguita_unit_state_active	smallint	1	f	\N	\N
maguita_unit_state_fechado	smallint	0	f	\N	\N
maguita_tserie_faturaproforma	smallint	6	f	Serie para guia de saida!	\N
maguita_parametrizacao_estado_ativo	smallint	1	f	\N	\N
maguita_parametrizacao_estado_fechado	smallint	1	f	\N	\N
\.


--
-- TOC entry 5499 (class 0 OID 19466)
-- Dependencies: 352
-- Data for Name: raw; Type: TABLE DATA; Schema: patch; Owner: -
--

COPY patch.raw (raw_uid, raw_text, raw_match) FROM stdin;
d1d4ddc7-62d9-4547-9dea-371e3512ea78	\n  create or replace function tweeks.__generate_caixa_code(\n    brc uuid,\n    user_brc uuid default null,\n    space_brc uuid default null\n  ) returns character varying\n    language plpgsql\n  as\n  $$\n  declare\n    _cluster cluster.cluster;\n    _code character varying;\n    _len int default 6;\n  begin\n    _cluster := cluster._get_cluster_local();\n    brc := coalesce( brc, tweeks.__branch_uid( user_brc, space_brc ));\n\n    while _code is null loop\n        _code := cluster.next( 'caixa.code/seq', sub := brc::text, lpad := _len, lpad_char := '0' );\n        if( exists(\n            select *\n            from tweeks.caixa c\n            where c.caixa_code = _code\n              and c._branch_uid = coalesce( brc, c._branch_uid )\n          )) then\n          _code := null;\n        end if;\n      end loop;\n    return _code;\n  end;\n  $$;\n\n  alter table tweeks.caixa drop if exists caixa_code;\n  alter table tweeks.caixa add if not exists caixa_code character varying;\n  update tweeks.caixa\n  set caixa_code = tweeks.__generate_caixa_code( _branch_uid, caixa_colaborador_id, caixa_espaco_auth )\n  where caixa.caixa_code is null;\n\n  create or replace function tweeks.funct_pos_reg_caixa(args jsonb) returns lib.res\n    language plpgsql\n  as\n  $$\n  declare\n    /** Essa função serve para registar uma nova caixa\n      args := {\n        arg_espaco_auth: ID\n        arg_posto_id: ID\n        arg_colaborador_id: ID\n        caixa_montanteinicial: MONTANTE\n      }\n    */\n\n    arg_posto_id uuid not null default args->>'arg_posto_id';\n    arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n    arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n    arg_caixa_montanteinicial double precision not null default args->>'caixa_montanteinicial';\n\n    _data record;\n    _posto tweeks.posto;\n    _caixa tweeks.caixa;\n    _const map.constant;\n    ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  begin\n\n    select * into _posto\n    from tweeks.posto\n    where posto_id = arg_posto_id\n    ;\n\n    _const := map.constant();\n\n    with __aloca as (\n      select\n        a.aloca_posto_id,\n        sum( a.aloca_montante ) as aloca_montante\n      from tweeks.aloca a\n      where a.aloca_estado = _const.maguita_aloca_estado_ativo\n        and a.aloca_posto_id = arg_posto_id\n        and case\n              when _posto.posto_caixamode = _const.maguita_posto_caixamodo_posto then true\n              when _posto.posto_caixamode = _const.maguita_posto_caixamodo_espaco then a.aloca_espaco_destino = arg_espaco_auth\n              when _posto.posto_caixamode = _const.maguita_posto_caixamodo_pessoal then a.aloca_espaco_destino = arg_espaco_auth\n              else false\n        end\n      group by a.aloca_posto_id\n    ), __caixa as (\n      select\n        cx.caixa_posto_id,\n        mode() within group ( order by e.espaco_nome desc ) as espaco_nome,\n        count( cx.caixa_id ) as posto_caixas\n      from tweeks.caixa cx\n             inner join tweeks.espaco e on cx.caixa_espaco_auth = e.espaco_id\n      where cx.caixa_posto_id = arg_posto_id\n        and cx.caixa_estado = _const.maguita_caixa_estado_ativo\n      group by cx.caixa_posto_id\n    ) select\n        *,\n        coalesce( aloca_montante, 0.0 ) as _aloca_montante\n    into _data\n    from tweeks.posto p\n           left join __aloca al on p.posto_id = al.aloca_posto_id\n           left join __caixa cx on p.posto_id = cx.caixa_posto_id\n    where p.posto_id = arg_posto_id\n    ;\n\n    if  not _posto.posto_multiplecaixa and _data.posto_caixas > 0 then\n      return lib.res_false(\n          format( 'Esse posto só pode trabalhar com uma caixa a cada momento, por favor fechar primeiramente a caixa abertas atualmente!' )\n        );\n    end if;\n\n\n    _caixa.caixa_colaborador_id := arg_colaborador_id;\n    _caixa.caixa_posto_id := arg_posto_id;\n    _caixa.caixa_montanteinicialposto := _data._aloca_montante;\n    _caixa.caixa_montanteinicial := arg_caixa_montanteinicial;\n    _caixa.caixa_espaco_auth := arg_espaco_auth;\n    _caixa.caixa_code := tweeks.__generate_caixa_code( ___branch, arg_colaborador_id, arg_espaco_auth );\n\n    select ( "returning" ).* into _caixa\n    from lib.sets_in(_caixa  )\n    ;\n\n    _posto.posto_estado := _const.maguita_posto_estado_aberto;\n    select ( "returning" ).* into _posto from lib.sets_up( _posto );\n\n    return lib.res_true( jsonb_build_object(\n        'caixa', _caixa,\n        'posto', _posto\n      ));\n  end\n  $$;\n	create or replace function tweeks.__generate_caixa_code( brc uuid, user_brc uuid default null, space_brc uuid default null ) returns character varying language plpgsql as $$ declare _cluster cluster.cluster; _code character varying; _len int default 6; begin _cluster := cluster._get_cluster_local(); brc := coalesce( brc, tweeks.__branch_uid( user_brc, space_brc )); while _code is null loop _code := cluster.next( 'caixa.code/seq', sub := brc::text, lpad := _len, lpad_char := '0' ); if( exists( select * from tweeks.caixa c where c.caixa_code = _code and c._branch_uid = coalesce( brc, c._branch_uid ) )) then _code := null; end if; end loop; return _code; end; $$; alter table tweeks.caixa drop if exists caixa_code; alter table tweeks.caixa add if not exists caixa_code character varying; update tweeks.caixa set caixa_code = tweeks.__generate_caixa_code( _branch_uid, caixa_colaborador_id, caixa_espaco_auth ) where caixa.caixa_code is null; create or replace function tweeks.funct_pos_reg_caixa(args jsonb) returns lib.res language plpgsql as $$ declare /** Essa função serve para registar uma nova caixa args := { arg_espaco_auth: ID arg_posto_id: ID arg_colaborador_id: ID caixa_montanteinicial: MONTANTE } */ arg_posto_id uuid not null default args->>'arg_posto_id'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_caixa_montanteinicial double precision not null default args->>'caixa_montanteinicial'; _data record; _posto tweeks.posto; _caixa tweeks.caixa; _const map.constant; ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); begin select * into _posto from tweeks.posto where posto_id = arg_posto_id ; _const := map.constant(); with __aloca as ( select a.aloca_posto_id, sum( a.aloca_montante ) as aloca_montante from tweeks.aloca a where a.aloca_estado = _const.maguita_aloca_estado_ativo and a.aloca_posto_id = arg_posto_id and case when _posto.posto_caixamode = _const.maguita_posto_caixamodo_posto then true when _posto.posto_caixamode = _const.maguita_posto_caixamodo_espaco then a.aloca_espaco_destino = arg_espaco_auth when _posto.posto_caixamode = _const.maguita_posto_caixamodo_pessoal then a.aloca_espaco_destino = arg_espaco_auth else false end group by a.aloca_posto_id ), __caixa as ( select cx.caixa_posto_id, mode() within group ( order by e.espaco_nome desc ) as espaco_nome, count( cx.caixa_id ) as posto_caixas from tweeks.caixa cx inner join tweeks.espaco e on cx.caixa_espaco_auth = e.espaco_id where cx.caixa_posto_id = arg_posto_id and cx.caixa_estado = _const.maguita_caixa_estado_ativo group by cx.caixa_posto_id ) select *, coalesce( aloca_montante, 0.0 ) as _aloca_montante into _data from tweeks.posto p left join __aloca al on p.posto_id = al.aloca_posto_id left join __caixa cx on p.posto_id = cx.caixa_posto_id where p.posto_id = arg_posto_id ; if not _posto.posto_multiplecaixa and _data.posto_caixas > 0 then return lib.res_false( format( 'Esse posto só pode trabalhar com uma caixa a cada momento, por favor fechar primeiramente a caixa abertas atualmente!' ) ); end if; _caixa.caixa_colaborador_id := arg_colaborador_id; _caixa.caixa_posto_id := arg_posto_id; _caixa.caixa_montanteinicialposto := _data._aloca_montante; _caixa.caixa_montanteinicial := arg_caixa_montanteinicial; _caixa.caixa_espaco_auth := arg_espaco_auth; _caixa.caixa_code := tweeks.__generate_caixa_code( ___branch, arg_colaborador_id, arg_espaco_auth ); select ( "returning" ).* into _caixa from lib.sets_in(_caixa ) ; _posto.posto_estado := _const.maguita_posto_estado_aberto; select ( "returning" ).* into _posto from lib.sets_up( _posto ); return lib.res_true( jsonb_build_object( 'caixa', _caixa, 'posto', _posto )); end $$;
a4126ef0-5f28-4e0e-bcd6-91d340447e99	\n  create or replace function tweeks.__tg_fluxo_on_venda() returns trigger\n    language plpgsql\n  as\n  $$\n  declare\n    _new tweeks.venda;\n    _old tweeks.venda;\n    _fluxo tweeks.fluxo;\n    _const map.constant;\n    _conta tweeks.conta;\n  begin\n\n    if cluster.__is_replication() then\n      return null;\n    end if;\n\n    _const := map.constant();\n    _new := new;\n\n    _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_venda;\n    _fluxo.fluxo_documento := null;\n    _fluxo.fluxo_data := null;\n    _fluxo.fluxo_referencia := lib.sets_ref(new );\n    _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass );\n\n    _fluxo.fluxo_refuid := _new.venda_id;\n    _fluxo.fluxo_quantidadeout := _new.venda_quantidade;\n\n    _fluxo.fluxo_artigo_out := _new.venda_artigo_id;\n\n    _fluxo.fluxo_espaco_out := _new.venda_espaco_auth;\n\n    _fluxo.fluxo_espaco_auth := _new.venda_espaco_auth;\n    _fluxo.fluxo_colaborador_id := _new.venda_colaborador_id;\n\n    if tg_op = 'INSERT' then\n      perform lib.sets_in( _fluxo );\n\n    elseif tg_op = 'UPDATE' then\n      _old := old;\n\n      -- Ao atualizar quantidade do produto no carrinho\n      if _new.venda_quantidade != _old.venda_quantidade then\n        perform lib.sets_in( _fluxo );\n        _fluxo.fluxo_quantidadeout := null;\n        _fluxo.fluxo_artigo_out := null;\n        _fluxo.fluxo_espaco_out := null;\n\n        _fluxo.fluxo_quantidadein := _old.venda_quantidade;\n        _fluxo.fluxo_artigo_in := _old.venda_artigo_id;\n        _fluxo.fluxo_espaco_in := _old.venda_espaco_auth;\n        _fluxo.fluxo_observacao := format( 'Reposição do artigo no stock por atualização da quantidade na conta' );\n        perform lib.sets_in( _fluxo );\n\n        -- Ao canselar um produto do carrinho ou ao anular uma conta\n      elseif _old.venda_estado != _new.venda_estado and _new.venda_estado in(\n                                                                             _const.maguita_venda_estado_anulado,\n                                                                             _const.maguita_venda_estado_canselado\n        )  then\n        _fluxo.fluxo_quantidadeout := null;\n        _fluxo.fluxo_artigo_out := null;\n        _fluxo.fluxo_espaco_out := null;\n\n        _fluxo.fluxo_quantidadein := _old.venda_quantidade;\n        _fluxo.fluxo_artigo_in := _old.venda_artigo_id;\n        _fluxo.fluxo_espaco_in := _old.venda_espaco_auth;\n        _fluxo.fluxo_observacao := format( 'Reposição do artigo no stock por Anulação/Canselamento da conta');\n        perform lib.sets_in( _fluxo );\n\n        -- Quando tiver que fechar as vendas definir o documento do fluxo para essa venda\n      elseif _old.venda_estado != _new.venda_estado and _new.venda_estado = _const.maguita_venda_estado_fechado then\n        _conta := tweeks._get_conta( _old.venda_conta_id );\n        update tweeks.fluxo\n        set fluxo_documento = _conta.conta_numerofatura\n        where fluxo_regclass = cluster.__format( pg_typeof( _new )::text::regclass )\n          and (fluxo_referencia->>'venda_id')::uuid = _old.venda_id\n        ;\n      end if;\n\n    end if;\n    return null;\n  end\n  $$;\n  with __fluxo_venda as (\n    select f.*, ve.*, ct.*\n    from tweeks.fluxo f\n           inner join tweeks.venda ve on ( f.fluxo_referencia->>'venda_id')::uuid  = ve.venda_id\n           inner join tweeks.conta ct on ve.venda_conta_id = ct.conta_id\n    where f.fluxo_regclass in ( 'venda', 'tweeks.venda' )\n      and (f.fluxo_documento is null or f.fluxo_regclass = 'venda' )\n  ) update tweeks.fluxo f\n  set fluxo_documento = fv.conta_numerofatura,\n      fluxo_regclass = cluster.__format( 'tweeks.venda'::regclass )\n  from __fluxo_venda fv\n  where fv.fluxo_id = f.fluxo_id;\n\n\n  create or replace function tweeks.__tg_fluxo_on_entrada() returns trigger\n    language plpgsql\n  as\n  $$\n  declare\n    _new tweeks.entrada;\n    _fluxo tweeks.fluxo;\n    _const map.constant;\n    _guia record;\n\n  begin\n\n    if cluster.__is_replication() then\n      return null;\n    end if;\n\n    _const := map.constant();\n    _new := new;\n\n    select * into _guia\n    from tweeks.guia g\n    where g.guia_uid = _new.entrada_guia_id\n    ;\n\n    _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_entrada;\n    _fluxo.fluxo_documento := _guia.guia_documentoperacao ;\n    _fluxo.fluxo_data := null;\n    _fluxo.fluxo_referencia := lib.sets_ref(new );\n    _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass );\n\n    _fluxo.fluxo_refuid := _new.entrada_id;\n    _fluxo.fluxo_quantidadein := _new.entrada_quantidade;\n--   _fluxo.fluxo_quantidadeout :=;\n\n    _fluxo.fluxo_artigo_in := _new.entrada_artigo_id;\n    --   _fluxo.fluxo_artigo_out := ;\n\n--   _fluxo.fluxo_espaco_out := ;\n    _fluxo.fluxo_espaco_in := _new.entrada_espaco_destino;\n\n    _fluxo.fluxo_espaco_auth := _new.entrada_espaco_auth;\n    _fluxo.fluxo_colaborador_id := _new.entrada_colaborador_id;\n\n    perform lib.sets_in( _fluxo );\n    return null;\n  end;\n  $$;\n  with __fluxo_entrada as (\n    select f.*, ct.*\n    from tweeks.fluxo f\n           inner join tweeks.entrada fe on ( f.fluxo_referencia->>'entrada_id')::uuid  = fe.entrada_id\n           inner join tweeks.guia ct on fe.entrada_guia_id = ct.guia_uid\n    where f.fluxo_regclass in ( 'entrada', 'tweeks.entrada' )\n      and (f.fluxo_documento is null or f.fluxo_regclass = 'entrada' )\n  ) update tweeks.fluxo f\n  set fluxo_documento = fv.guia_documentoperacao,\n      fluxo_regclass = cluster.__format( 'tweeks.entrada'::regclass )\n  from __fluxo_entrada fv\n  where fv.fluxo_id = f.fluxo_id;\n\n  alter table tweeks.retalho add retalho_codigo character varying;\n  create or replace function tweeks.__generate_retalho_code(\n    brc uuid,\n    user_brc uuid default null,\n    space_brc uuid default null\n  ) returns character varying\n    language plpgsql\n  as\n  $$\n  declare\n    _cluster cluster.cluster;\n    _code character varying;\n    _len int default 6;\n  begin\n    _cluster := cluster._get_cluster_local();\n    brc := coalesce( brc, tweeks.__branch_uid( user_brc, space_brc ));\n\n    while _code is null loop\n        _code := cluster.next( 'retalho.code/seq', sub := brc::text, lpad := _len, lpad_char := '0' );\n        if( exists(\n            select *\n            from tweeks.retalho c\n            where c.retalho_codigo = _code\n              and c._branch_uid = coalesce( brc, c._branch_uid )\n          )) then\n          _code := null;\n        end if;\n      end loop;\n    return _code;\n  end;\n  $$;\n  create or replace function tweeks.funct_pos_reg_retalho(args jsonb) returns lib.res\n    language plpgsql\n  as\n  $$\n  declare\n    /*\n     args := {\n        arg_colaborador_id,\n        arg_espaco_auth,\n  \n        retalho_artigo_composto\n        retalho_artigo_base\n        retalho_composicao\n        retalho_quantidade\n     }\n     */\n    arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n    arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n\n    _artigo_base tweeks.artigo;\n    _artigo_composto tweeks.artigo;\n    _retalho tweeks.retalho;\n    ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n\n  begin\n    _retalho := jsonb_populate_record( _retalho, args );\n    _artigo_base := tweeks._get_artigo( _retalho.retalho_artigo_base );\n    _artigo_composto := tweeks._get_artigo( _retalho.retalho_artigo_composto );\n\n    if _artigo_composto.artigo_artigo_id is null\n      or _artigo_composto.artigo_compostoquantidade is null\n    then\n      return lib.res_false( 'O artigo selecionano para composto não é um artigo composto!' );\n    end if;\n\n    _retalho.retalho_codigo = tweeks.__generate_retalho_code( ___branch );\n    _retalho.retalho_colaborador_id := arg_colaborador_id;\n    _retalho.retalho_espaco_auth := arg_espaco_auth;\n\n    select ( "returning" ).* into _retalho\n    from lib.sets( _retalho )\n    ;\n\n    return lib.res_true(jsonb_build_object(\n        'retalho', _retalho\n      ));\n  end;\n  $$;\n  update tweeks.retalho\n  set retalho_codigo = tweeks.__generate_retalho_code( _branch_uid )\n  where retalho_codigo is null;\n  with __fluxo_retalho as (\n    select f.*, fe.*\n    from tweeks.fluxo f\n           inner join tweeks.retalho fe on ( f.fluxo_referencia->>'retalho_id')::uuid  = fe.retalho_id\n    where f.fluxo_regclass in ( 'retalho', 'tweeks.retalho' )\n      and (f.fluxo_documento is null or f.fluxo_regclass = 'retalho' )\n  ) update tweeks.fluxo f\n  set fluxo_documento =  fv.retalho_codigo ,\n      fluxo_regclass = cluster.__format( 'tweeks.retalho'::regclass )\n  from __fluxo_retalho fv\n  where fv.fluxo_id = f.fluxo_id;\n  create or replace function tweeks.__tg_fluxo_on_retalho() returns trigger\n    language plpgsql\n  as\n  $$\n  declare\n    _new tweeks.retalho;\n    _fluxo tweeks.fluxo;\n    _const map.constant;\n  begin\n\n    if cluster.__is_replication() then\n      return null;\n    end if;\n\n    _const := map.constant();\n    _new := new;\n\n    _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_retalho;\n    _fluxo.fluxo_documento := _new.retalho_codigo;\n    _fluxo.fluxo_data := null;\n    _fluxo.fluxo_referencia := lib.sets_ref(new );\n    _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass );\n\n    _fluxo.fluxo_refuid := _new.retalho_id;\n    _fluxo.fluxo_quantidadeout := _new.retalho_quantidade;\n    _fluxo.fluxo_quantidadein := _new.retalho_total;\n\n    _fluxo.fluxo_artigo_out := _new.retalho_artigo_composto;\n    _fluxo.fluxo_artigo_in := _new.retalho_artigo_base;\n\n    _fluxo.fluxo_espaco_out := _new.retalho_espaco_auth;\n    _fluxo.fluxo_espaco_in  := _new.retalho_espaco_auth;\n\n    _fluxo.fluxo_espaco_auth := _new.retalho_espaco_auth;\n    _fluxo.fluxo_colaborador_id := _new.retalho_colaborador_id;\n\n    perform lib.sets_in( _fluxo );\n    return null;\n  end;\n  $$;\n\n\n  alter table tweeks.acerto add acerto_codigo character varying;\n  create or replace function tweeks.__generate_acerto_code(\n    brc uuid,\n    user_brc uuid default null,\n    space_brc uuid default null\n  ) returns character varying\n    language plpgsql\n  as\n  $$\n  declare\n    _cluster cluster.cluster;\n    _code character varying;\n    _len int default 6;\n  begin\n    _cluster := cluster._get_cluster_local();\n    brc := coalesce( brc, tweeks.__branch_uid( user_brc, space_brc ));\n\n    while _code is null loop\n        _code := cluster.next( 'acerto.code/seq', sub := brc::text, lpad := _len, lpad_char := '0' );\n        if( exists(\n            select *\n            from tweeks.acerto c\n            where c.acerto_codigo = _code\n              and c._branch_uid = coalesce( brc, c._branch_uid )\n          )) then\n          _code := null;\n        end if;\n      end loop;\n    return _code;\n  end;\n  $$;\n  create or replace function tweeks.funct_reg_acerto(args jsonb) returns lib.result\n    language plpgsql\n  as\n  $$\n  declare\n    /**\n      Essa função serve para efetuar o acerto do stock\n      args = {\n        arg_espaco_auth: ID\n        arg_espaco_id: ID,\n        arg_colaborador_id := ID,\n  \n        acerto_observacao: OBS\n        arg_acerto: [{\n          artigo_id:UUID,\n          acerto_quantidade: QUANTIDADE\n        }]\n      }\n    */\n\n    arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n    arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n    arg_espaco_id uuid not null default args->>'arg_espaco_id';\n    arg_acerto_observacao varchar default args->>'acerto_observacao';\n\n    arg_acerto_corecao double precision;\n\n    _const map.constant;\n    _stock record;\n    _acerto tweeks.acerto;\n    _new tweeks.acerto;\n\n    _acerto_group uuid;\n    _data record;\n    acertos jsonb default jsonb_build_array();\n    ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  begin\n    _const := map.constant();\n\n    for _data in\n      select\n        (e.doc->>'artigo_id')::uuid as artigo_id,\n        (e.doc->>'acerto_quantidade')::double precision as acerto_quantidade\n      from jsonb_array_elements( args->'arg_acerto' ) e( doc )\n      loop\n\n        _stock := tweeks._get_stock( _data.artigo_id, arg_espaco_id );\n        arg_acerto_corecao := _stock.stock_quantidade - _data.acerto_quantidade;\n        _acerto_group := public.uuid_generate_v4();\n        _new.acerto_codigo := tweeks.__generate_acerto_code( ___branch );\n        _new.acerto_colaborador_id :=    arg_colaborador_id;\n        _new.acerto_quantidade :=        _data.acerto_quantidade;\n        _new.acerto_quantidadeinicial := _stock.stock_quantidade;\n        _new.acerto_correcao :=          arg_acerto_corecao;\n        _new.acerto_observacao :=        arg_acerto_observacao;\n        _new.acerto_espaco_auth :=       arg_espaco_auth;\n        _new.acerto_oprgroup :=          _acerto_group;\n        _new.acerto_artigo_id :=         _data.artigo_id;\n        _new.acerto_espaco_id :=         arg_espaco_id;\n\n        -- Save acerto\n        select ( "returning" ).* into _acerto\n        from lib.sets_in( _new )\n        ;\n\n        _stock := tweeks._get_stock( _data.artigo_id, arg_espaco_id );\n        acertos := acertos || jsonb_build_object(\n            'acerto', _acerto,\n            'stock', _stock,\n            'artigo', tweeks._get_artigo( _stock.stock_artigo_id )\n          );\n      end loop;\n\n    return  true ? acertos;\n  end;\n  $$;\n  update tweeks.acerto\n  set acerto_codigo = tweeks.__generate_acerto_code( _branch_uid )\n  where acerto_codigo is null;\n  with __fluxo_acerto as (\n    select f.*, fe.*\n    from tweeks.fluxo f\n           inner join tweeks.acerto fe on ( f.fluxo_referencia->>'acerto_id')::uuid  = fe.acerto_id\n    where f.fluxo_regclass in ( 'retalho', 'tweeks.retalho' )\n      and (f.fluxo_documento is null or f.fluxo_regclass = 'retalho' )\n  ) update tweeks.fluxo f\n  set fluxo_documento = fv.acerto_codigo,\n      fluxo_regclass = cluster.__format( 'tweeks.acerto'::regclass )\n  from __fluxo_acerto fv\n  where fv.fluxo_id = f.fluxo_id;\n  create or replace function tweeks.__tg_fluxo_on_acerto() returns trigger\n    language plpgsql\n  as\n  $$\n  declare\n    _new tweeks.acerto;\n    _fluxo tweeks.fluxo;\n    _const map.constant;\n  begin\n\n    if cluster.__is_replication() then\n      return null;\n    end if;\n\n    _const := map.constant();\n    _new := new::tweeks.acerto;\n\n\n    _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_acerto;\n    -- AC#3049940\n    _fluxo.fluxo_documento := _new.acerto_codigo;\n    _fluxo.fluxo_data := null;\n    _fluxo.fluxo_referencia := lib.sets_ref(new );\n    _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass );\n    _fluxo.fluxo_refuid := _new.acerto_id;\n\n    _fluxo.fluxo_quantidadefinal := _new.acerto_quantidade;\n    _fluxo.fluxo_artigo_in := _new.acerto_artigo_id;\n    _fluxo.fluxo_espaco_in := _new.acerto_espaco_id;\n\n    _fluxo.fluxo_espaco_auth := _new.acerto_espaco_auth;\n    _fluxo.fluxo_colaborador_id := _new.acerto_colaborador_id;\n    _fluxo.fluxo_checkpoint := 0;\n\n    perform lib.sets_in( _fluxo );\n    return null;\n  end;\n  $$;\n\n\n  create or replace function tweeks.__tg_fluxo_on_transferencia() returns trigger\n    language plpgsql\n  as\n  $$\n  declare\n    _new tweeks.transferencia;\n    _fluxo tweeks.fluxo;\n    _const map.constant;\n  begin\n\n    if cluster.__is_replication() then\n      return null;\n    end if;\n\n    _const := map.constant();\n    _new := new;\n\n    _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_transferencia;\n    _fluxo.fluxo_documento := _new.transferencia_documento;\n    _fluxo.fluxo_data := null;\n    _fluxo.fluxo_referencia := lib.sets_ref(new );\n    _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass );\n\n    _fluxo.fluxo_refuid := _new.transferencia_id;\n    _fluxo.fluxo_quantidadein := _new.transferencia_quantidade;\n    _fluxo.fluxo_quantidadeout := _new.transferencia_quantidade;\n\n    _fluxo.fluxo_artigo_in := _new.transferencia_artigo_id;\n    _fluxo.fluxo_artigo_out := _new.transferencia_artigo_id;\n\n    _fluxo.fluxo_espaco_out := _new.transferencia_espaco_origem;\n    _fluxo.fluxo_espaco_in := _new.transferencia_espaco_destino;\n\n    _fluxo.fluxo_espaco_auth := _new.transferencia_espaco_auth;\n    _fluxo.fluxo_colaborador_id := _new.transferencia_colaborador_id;\n\n    perform lib.sets_in( _fluxo );\n    return null;\n  end;\n  $$;\n  with __fluxo_transferencia as (\n    select f.*, ve.*\n    from tweeks.fluxo f\n           inner join tweeks.transferencia ve on ( f.fluxo_referencia->>'transferencia_id')::uuid  = ve.transferencia_id\n    where f.fluxo_regclass in ( 'transferencia', 'tweeks.transferencia' )\n      and (f.fluxo_documento is null or f.fluxo_regclass = 'transferencia' )\n  ) update tweeks.fluxo f\n  set fluxo_documento = fv.transferencia_documento,\n      fluxo_regclass = cluster.__format( 'tweeks.transferencia'::regclass )\n  from __fluxo_transferencia fv\n  where fv.fluxo_id = f.fluxo_id;\n\n\n  alter table tweeks.toperacao add toperacao_code character varying;\n  update tweeks.toperacao set toperacao_code = 'ENTR' where toperacao_id = (map.constant()).maguita_toperacao_entrada;\n  update tweeks.toperacao set toperacao_code = 'ACER' where toperacao_id = (map.constant()).maguita_toperacao_acerto;\n  update tweeks.toperacao set toperacao_code = 'VEND' where toperacao_id = (map.constant()).maguita_toperacao_venda;\n  update tweeks.toperacao set toperacao_code = 'TRAN' where toperacao_id = (map.constant()).maguita_toperacao_transferencia;\n  update tweeks.toperacao set toperacao_code = 'PAGM' where toperacao_id = (map.constant()).maguita_toperacao_pagamento;\n  update tweeks.toperacao set toperacao_code = 'MOVM' where toperacao_id = (map.constant()).maguita_toperacao_movimento;\n  update tweeks.toperacao set toperacao_code = 'RETL' where toperacao_id = (map.constant()).maguita_toperacao_retalho;\n	create or replace function tweeks.__tg_fluxo_on_venda() returns trigger language plpgsql as $$ declare _new tweeks.venda; _old tweeks.venda; _fluxo tweeks.fluxo; _const map.constant; _conta tweeks.conta; begin if cluster.__is_replication() then return null; end if; _const := map.constant(); _new := new; _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_venda; _fluxo.fluxo_documento := null; _fluxo.fluxo_data := null; _fluxo.fluxo_referencia := lib.sets_ref(new ); _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass ); _fluxo.fluxo_refuid := _new.venda_id; _fluxo.fluxo_quantidadeout := _new.venda_quantidade; _fluxo.fluxo_artigo_out := _new.venda_artigo_id; _fluxo.fluxo_espaco_out := _new.venda_espaco_auth; _fluxo.fluxo_espaco_auth := _new.venda_espaco_auth; _fluxo.fluxo_colaborador_id := _new.venda_colaborador_id; if tg_op = 'INSERT' then perform lib.sets_in( _fluxo ); elseif tg_op = 'UPDATE' then _old := old; -- Ao atualizar quantidade do produto no carrinho if _new.venda_quantidade != _old.venda_quantidade then perform lib.sets_in( _fluxo ); _fluxo.fluxo_quantidadeout := null; _fluxo.fluxo_artigo_out := null; _fluxo.fluxo_espaco_out := null; _fluxo.fluxo_quantidadein := _old.venda_quantidade; _fluxo.fluxo_artigo_in := _old.venda_artigo_id; _fluxo.fluxo_espaco_in := _old.venda_espaco_auth; _fluxo.fluxo_observacao := format( 'Reposição do artigo no stock por atualização da quantidade na conta' ); perform lib.sets_in( _fluxo ); -- Ao canselar um produto do carrinho ou ao anular uma conta elseif _old.venda_estado != _new.venda_estado and _new.venda_estado in( _const.maguita_venda_estado_anulado, _const.maguita_venda_estado_canselado ) then _fluxo.fluxo_quantidadeout := null; _fluxo.fluxo_artigo_out := null; _fluxo.fluxo_espaco_out := null; _fluxo.fluxo_quantidadein := _old.venda_quantidade; _fluxo.fluxo_artigo_in := _old.venda_artigo_id; _fluxo.fluxo_espaco_in := _old.venda_espaco_auth; _fluxo.fluxo_observacao := format( 'Reposição do artigo no stock por Anulação/Canselamento da conta'); perform lib.sets_in( _fluxo ); -- Quando tiver que fechar as vendas definir o documento do fluxo para essa venda elseif _old.venda_estado != _new.venda_estado and _new.venda_estado = _const.maguita_venda_estado_fechado then _conta := tweeks._get_conta( _old.venda_conta_id ); update tweeks.fluxo set fluxo_documento = _conta.conta_numerofatura where fluxo_regclass = cluster.__format( pg_typeof( _new )::text::regclass ) and (fluxo_referencia->>'venda_id')::uuid = _old.venda_id ; end if; end if; return null; end $$; with __fluxo_venda as ( select f.*, ve.*, ct.* from tweeks.fluxo f inner join tweeks.venda ve on ( f.fluxo_referencia->>'venda_id')::uuid = ve.venda_id inner join tweeks.conta ct on ve.venda_conta_id = ct.conta_id where f.fluxo_regclass in ( 'venda', 'tweeks.venda' ) and (f.fluxo_documento is null or f.fluxo_regclass = 'venda' ) ) update tweeks.fluxo f set fluxo_documento = fv.conta_numerofatura, fluxo_regclass = cluster.__format( 'tweeks.venda'::regclass ) from __fluxo_venda fv where fv.fluxo_id = f.fluxo_id; create or replace function tweeks.__tg_fluxo_on_entrada() returns trigger language plpgsql as $$ declare _new tweeks.entrada; _fluxo tweeks.fluxo; _const map.constant; _guia record; begin if cluster.__is_replication() then return null; end if; _const := map.constant(); _new := new; select * into _guia from tweeks.guia g where g.guia_uid = _new.entrada_guia_id ; _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_entrada; _fluxo.fluxo_documento := _guia.guia_documentoperacao ; _fluxo.fluxo_data := null; _fluxo.fluxo_referencia := lib.sets_ref(new ); _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass ); _fluxo.fluxo_refuid := _new.entrada_id; _fluxo.fluxo_quantidadein := _new.entrada_quantidade; -- _fluxo.fluxo_quantidadeout :=; _fluxo.fluxo_artigo_in := _new.entrada_artigo_id; -- _fluxo.fluxo_artigo_out := ; -- _fluxo.fluxo_espaco_out := ; _fluxo.fluxo_espaco_in := _new.entrada_espaco_destino; _fluxo.fluxo_espaco_auth := _new.entrada_espaco_auth; _fluxo.fluxo_colaborador_id := _new.entrada_colaborador_id; perform lib.sets_in( _fluxo ); return null; end; $$; with __fluxo_entrada as ( select f.*, ct.* from tweeks.fluxo f inner join tweeks.entrada fe on ( f.fluxo_referencia->>'entrada_id')::uuid = fe.entrada_id inner join tweeks.guia ct on fe.entrada_guia_id = ct.guia_uid where f.fluxo_regclass in ( 'entrada', 'tweeks.entrada' ) and (f.fluxo_documento is null or f.fluxo_regclass = 'entrada' ) ) update tweeks.fluxo f set fluxo_documento = fv.guia_documentoperacao, fluxo_regclass = cluster.__format( 'tweeks.entrada'::regclass ) from __fluxo_entrada fv where fv.fluxo_id = f.fluxo_id; alter table tweeks.retalho add retalho_codigo character varying; create or replace function tweeks.__generate_retalho_code( brc uuid, user_brc uuid default null, space_brc uuid default null ) returns character varying language plpgsql as $$ declare _cluster cluster.cluster; _code character varying; _len int default 6; begin _cluster := cluster._get_cluster_local(); brc := coalesce( brc, tweeks.__branch_uid( user_brc, space_brc )); while _code is null loop _code := cluster.next( 'retalho.code/seq', sub := brc::text, lpad := _len, lpad_char := '0' ); if( exists( select * from tweeks.retalho c where c.retalho_codigo = _code and c._branch_uid = coalesce( brc, c._branch_uid ) )) then _code := null; end if; end loop; return _code; end; $$; create or replace function tweeks.funct_pos_reg_retalho(args jsonb) returns lib.res language plpgsql as $$ declare /* args := { arg_colaborador_id, arg_espaco_auth, retalho_artigo_composto retalho_artigo_base retalho_composicao retalho_quantidade } */ arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; _artigo_base tweeks.artigo; _artigo_composto tweeks.artigo; _retalho tweeks.retalho; ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); begin _retalho := jsonb_populate_record( _retalho, args ); _artigo_base := tweeks._get_artigo( _retalho.retalho_artigo_base ); _artigo_composto := tweeks._get_artigo( _retalho.retalho_artigo_composto ); if _artigo_composto.artigo_artigo_id is null or _artigo_composto.artigo_compostoquantidade is null then return lib.res_false( 'O artigo selecionano para composto não é um artigo composto!' ); end if; _retalho.retalho_codigo = tweeks.__generate_retalho_code( ___branch ); _retalho.retalho_colaborador_id := arg_colaborador_id; _retalho.retalho_espaco_auth := arg_espaco_auth; select ( "returning" ).* into _retalho from lib.sets( _retalho ) ; return lib.res_true(jsonb_build_object( 'retalho', _retalho )); end; $$; update tweeks.retalho set retalho_codigo = tweeks.__generate_retalho_code( _branch_uid ) where retalho_codigo is null; with __fluxo_retalho as ( select f.*, fe.* from tweeks.fluxo f inner join tweeks.retalho fe on ( f.fluxo_referencia->>'retalho_id')::uuid = fe.retalho_id where f.fluxo_regclass in ( 'retalho', 'tweeks.retalho' ) and (f.fluxo_documento is null or f.fluxo_regclass = 'retalho' ) ) update tweeks.fluxo f set fluxo_documento = fv.retalho_codigo , fluxo_regclass = cluster.__format( 'tweeks.retalho'::regclass ) from __fluxo_retalho fv where fv.fluxo_id = f.fluxo_id; create or replace function tweeks.__tg_fluxo_on_retalho() returns trigger language plpgsql as $$ declare _new tweeks.retalho; _fluxo tweeks.fluxo; _const map.constant; begin if cluster.__is_replication() then return null; end if; _const := map.constant(); _new := new; _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_retalho; _fluxo.fluxo_documento := _new.retalho_codigo; _fluxo.fluxo_data := null; _fluxo.fluxo_referencia := lib.sets_ref(new ); _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass ); _fluxo.fluxo_refuid := _new.retalho_id; _fluxo.fluxo_quantidadeout := _new.retalho_quantidade; _fluxo.fluxo_quantidadein := _new.retalho_total; _fluxo.fluxo_artigo_out := _new.retalho_artigo_composto; _fluxo.fluxo_artigo_in := _new.retalho_artigo_base; _fluxo.fluxo_espaco_out := _new.retalho_espaco_auth; _fluxo.fluxo_espaco_in := _new.retalho_espaco_auth; _fluxo.fluxo_espaco_auth := _new.retalho_espaco_auth; _fluxo.fluxo_colaborador_id := _new.retalho_colaborador_id; perform lib.sets_in( _fluxo ); return null; end; $$; alter table tweeks.acerto add acerto_codigo character varying; create or replace function tweeks.__generate_acerto_code( brc uuid, user_brc uuid default null, space_brc uuid default null ) returns character varying language plpgsql as $$ declare _cluster cluster.cluster; _code character varying; _len int default 6; begin _cluster := cluster._get_cluster_local(); brc := coalesce( brc, tweeks.__branch_uid( user_brc, space_brc )); while _code is null loop _code := cluster.next( 'acerto.code/seq', sub := brc::text, lpad := _len, lpad_char := '0' ); if( exists( select * from tweeks.acerto c where c.acerto_codigo = _code and c._branch_uid = coalesce( brc, c._branch_uid ) )) then _code := null; end if; end loop; return _code; end; $$; create or replace function tweeks.funct_reg_acerto(args jsonb) returns lib.result language plpgsql as $$ declare /** Essa função serve para efetuar o acerto do stock args = { arg_espaco_auth: ID arg_espaco_id: ID, arg_colaborador_id := ID, acerto_observacao: OBS arg_acerto: [{ artigo_id:UUID, acerto_quantidade: QUANTIDADE }] } */ arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_espaco_id uuid not null default args->>'arg_espaco_id'; arg_acerto_observacao varchar default args->>'acerto_observacao'; arg_acerto_corecao double precision; _const map.constant; _stock record; _acerto tweeks.acerto; _new tweeks.acerto; _acerto_group uuid; _data record; acertos jsonb default jsonb_build_array(); ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); begin _const := map.constant(); for _data in select (e.doc->>'artigo_id')::uuid as artigo_id, (e.doc->>'acerto_quantidade')::double precision as acerto_quantidade from jsonb_array_elements( args->'arg_acerto' ) e( doc ) loop _stock := tweeks._get_stock( _data.artigo_id, arg_espaco_id ); arg_acerto_corecao := _stock.stock_quantidade - _data.acerto_quantidade; _acerto_group := public.uuid_generate_v4(); _new.acerto_codigo := tweeks.__generate_acerto_code( ___branch ); _new.acerto_colaborador_id := arg_colaborador_id; _new.acerto_quantidade := _data.acerto_quantidade; _new.acerto_quantidadeinicial := _stock.stock_quantidade; _new.acerto_correcao := arg_acerto_corecao; _new.acerto_observacao := arg_acerto_observacao; _new.acerto_espaco_auth := arg_espaco_auth; _new.acerto_oprgroup := _acerto_group; _new.acerto_artigo_id := _data.artigo_id; _new.acerto_espaco_id := arg_espaco_id; -- Save acerto select ( "returning" ).* into _acerto from lib.sets_in( _new ) ; _stock := tweeks._get_stock( _data.artigo_id, arg_espaco_id ); acertos := acertos || jsonb_build_object( 'acerto', _acerto, 'stock', _stock, 'artigo', tweeks._get_artigo( _stock.stock_artigo_id ) ); end loop; return true ? acertos; end; $$; update tweeks.acerto set acerto_codigo = tweeks.__generate_acerto_code( _branch_uid ) where acerto_codigo is null; with __fluxo_acerto as ( select f.*, fe.* from tweeks.fluxo f inner join tweeks.acerto fe on ( f.fluxo_referencia->>'acerto_id')::uuid = fe.acerto_id where f.fluxo_regclass in ( 'retalho', 'tweeks.retalho' ) and (f.fluxo_documento is null or f.fluxo_regclass = 'retalho' ) ) update tweeks.fluxo f set fluxo_documento = fv.acerto_codigo, fluxo_regclass = cluster.__format( 'tweeks.acerto'::regclass ) from __fluxo_acerto fv where fv.fluxo_id = f.fluxo_id; create or replace function tweeks.__tg_fluxo_on_acerto() returns trigger language plpgsql as $$ declare _new tweeks.acerto; _fluxo tweeks.fluxo; _const map.constant; begin if cluster.__is_replication() then return null; end if; _const := map.constant(); _new := new::tweeks.acerto; _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_acerto; -- AC#3049940 _fluxo.fluxo_documento := _new.acerto_codigo; _fluxo.fluxo_data := null; _fluxo.fluxo_referencia := lib.sets_ref(new ); _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass ); _fluxo.fluxo_refuid := _new.acerto_id; _fluxo.fluxo_quantidadefinal := _new.acerto_quantidade; _fluxo.fluxo_artigo_in := _new.acerto_artigo_id; _fluxo.fluxo_espaco_in := _new.acerto_espaco_id; _fluxo.fluxo_espaco_auth := _new.acerto_espaco_auth; _fluxo.fluxo_colaborador_id := _new.acerto_colaborador_id; _fluxo.fluxo_checkpoint := 0; perform lib.sets_in( _fluxo ); return null; end; $$; create or replace function tweeks.__tg_fluxo_on_transferencia() returns trigger language plpgsql as $$ declare _new tweeks.transferencia; _fluxo tweeks.fluxo; _const map.constant; begin if cluster.__is_replication() then return null; end if; _const := map.constant(); _new := new; _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_transferencia; _fluxo.fluxo_documento := _new.transferencia_documento; _fluxo.fluxo_data := null; _fluxo.fluxo_referencia := lib.sets_ref(new ); _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass ); _fluxo.fluxo_refuid := _new.transferencia_id; _fluxo.fluxo_quantidadein := _new.transferencia_quantidade; _fluxo.fluxo_quantidadeout := _new.transferencia_quantidade; _fluxo.fluxo_artigo_in := _new.transferencia_artigo_id; _fluxo.fluxo_artigo_out := _new.transferencia_artigo_id; _fluxo.fluxo_espaco_out := _new.transferencia_espaco_origem; _fluxo.fluxo_espaco_in := _new.transferencia_espaco_destino; _fluxo.fluxo_espaco_auth := _new.transferencia_espaco_auth; _fluxo.fluxo_colaborador_id := _new.transferencia_colaborador_id; perform lib.sets_in( _fluxo ); return null; end; $$; with __fluxo_transferencia as ( select f.*, ve.* from tweeks.fluxo f inner join tweeks.transferencia ve on ( f.fluxo_referencia->>'transferencia_id')::uuid = ve.transferencia_id where f.fluxo_regclass in ( 'transferencia', 'tweeks.transferencia' ) and (f.fluxo_documento is null or f.fluxo_regclass = 'transferencia' ) ) update tweeks.fluxo f set fluxo_documento = fv.transferencia_documento, fluxo_regclass = cluster.__format( 'tweeks.transferencia'::regclass ) from __fluxo_transferencia fv where fv.fluxo_id = f.fluxo_id; alter table tweeks.toperacao add toperacao_code character varying; update tweeks.toperacao set toperacao_code = 'ENTR' where toperacao_id = (map.constant()).maguita_toperacao_entrada; update tweeks.toperacao set toperacao_code = 'ACER' where toperacao_id = (map.constant()).maguita_toperacao_acerto; update tweeks.toperacao set toperacao_code = 'VEND' where toperacao_id = (map.constant()).maguita_toperacao_venda; update tweeks.toperacao set toperacao_code = 'TRAN' where toperacao_id = (map.constant()).maguita_toperacao_transferencia; update tweeks.toperacao set toperacao_code = 'PAGM' where toperacao_id = (map.constant()).maguita_toperacao_pagamento; update tweeks.toperacao set toperacao_code = 'MOVM' where toperacao_id = (map.constant()).maguita_toperacao_movimento; update tweeks.toperacao set toperacao_code = 'RETL' where toperacao_id = (map.constant()).maguita_toperacao_retalho;
6cc17af1-d310-493f-bd35-45939eb2eef7	\n  create or replace function tweeks.funct_pos_change_conta_fechar(args jsonb) returns lib.res\n    language plpgsql\n  as\n  $$\n  declare\n    /**\n      Essa função fecha uma nova conta\n      arg = {\n        arg_espaco_auth: ID,\n        arg_colaborador_id: ID,\n  \n        deposito:{\n          deposito_cliente_id\n          deposito_caixa_id\n          deposito_tpaga_id\n          deposito_currency_id\n          deposito_posto_id\n          deposito_montantemoeda\n          deposito_montantetroco\n          deposito_data\n          deposito_docref: DOCUMENTO-REF?\n          deposito_observacao: OBSERVACAO?\n        }\n  \n        conta_id: ID,\n        conta_extension: {} | { reserva_id: UID }\n        conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM },\n  \n        conta_posto_id: ID,\n        conta_desconto\n  \n        conta_titular: NOME-CLIENTE\n        conta_titularnif: VARCHAR,\n        conta_data: DATA,\n        conta_cliente_id,\n  \n        //Relativos a GUIA\n        guia_documentoperacao: CODIGO,\n        guia_dataopeacao: DATA,\n        guia_observacao: DESCRICAO\n        guia_metadata: { ... any extras data }\n  \n        custos:[{\n          custoguia_montante: MONTANTE,\n          custoguia_descricao: DESCRICAO PARA O CUSTO\n          custoguia_tcusto_id: 1 - DESPESA | 2 - RECEITA\n        }]\n      }\n     */\n\n    arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n    arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n\n    arg_conta_id uuid default args->>'conta_id';\n    arg_caixa_id uuid default args->>'de_caixa_id';\n    _deposito_montantetroco double precision;\n\n\n    _conta tweeks.conta;\n    _const map.constant;\n    _caixa tweeks.caixa;\n    _res lib.res;\n    _cambio record;\n    _montante_amortizacao double precision;\n    _deposito tweeks.deposito;\n    _rec record;\n    _guia tweeks.guia;\n    _conta_estado record;\n  begin\n    _const := map.constant();\n    _caixa := tweeks._get_caixa( arg_caixa_id );\n\n    _conta := tweeks._get_conta( arg_conta_id );\n    _conta := jsonb_populate_record( _conta, args );\n    _conta.conta_data := coalesce( _conta.conta_data, current_date );\n\n    _deposito := jsonb_populate_record( _deposito, args->'deposito' );\n\n    _conta._tgrupo_id := case\n                           when _deposito.deposito_montantemoeda is null or args->'deposito' is null then _const.maguita_tgrupo_ccorrente\n                           else _const.maguita_tgrupo_cnormal\n      end;\n\n    if _conta.conta_estado = _const.maguita_conta_estado_fechado then\n      return lib.res_false( 'Essa conta já se encontra fechada!' );\n    end if;\n\n    --   select * into _conta_estado\n--     from tweeks.__lancamento_regularizacao(jsonb_build_object(\n--       'cliente_id', _conta.conta_cliente_id,\n--       'tgrupo_id', _conta._tgrupo_id,\n--       '_braunc_uid', _conta._branch_uid\n--     )) l\n--     where l.lancamento_refid = _conta.conta_id\n--   ;\n\n    if _conta.conta_posto_fecho is null then\n      return lib.res_false( 'Necessario indicar o posto de fecho!' );\n    end if;\n\n    -- Quando for conta corrente\n    if _deposito.deposito_montantemoeda is null\n      and true in (\n                   _conta.conta_cliente_id is null,\n                   _conta.conta_cliente_id = lib.to_uuid( 1 ) -- cliente final\n        )\n    then\n      return lib.res_false( 'Não pode abrir uma conta corrente para o cliente final' );\n\n      -- Quando for conta normal\n    elseif _conta._tgrupo_id = _const.maguita_tgrupo_cnormal then\n      if _deposito.deposito_tpaga_id = _const.maguita_tpaga_contacorrente then\n        return lib.res_false( 'Tipo de pagamento invalido' );\n      end if;\n\n      select * into _cambio from tweeks.__load_cambio_day(\n          arg_espaco_auth,\n          _deposito.deposito_currency_id,\n          _conta.conta_data,\n          _const\n        );\n\n      if _cambio.cambio_id is null then\n        return lib.res_false('Câmbio não foi encontrado!' );\n      end if;\n\n      if round( (_cambio.cambio_taxa * _deposito.deposito_montantemoeda)::numeric, _const.money_round )  < round( _conta.conta_montante::numeric, _const.money_round ) then\n        return lib.res_false('Montante para pagamento insuficiente' );\n      end if;\n\n      -- Se for para amortizar a conta a caixa tem que estar aberta\n      if _caixa.caixa_estado != _const.maguita_caixa_estado_ativo then\n        return lib.res_false( 'Pagamento rejeitado!' );\n      end if;\n    end if;\n\n\n    if _conta._tgrupo_id = _const.maguita_tgrupo_cnormal then\n      _rec := tweeks.__sets_generate_documento( arg_espaco_auth, _const.maguita_tserie_faturarecibo );\n      _conta.conta_numerofatura := _rec.document;\n      _conta.conta_serie := to_json( _rec );\n    elsif _conta._tgrupo_id = _const.maguita_tgrupo_ccorrente then\n      _rec := tweeks.__sets_generate_documento( arg_espaco_auth, _const.maguita_tserie_fatura );\n      _conta.conta_numerofatura := _rec.document;\n      _conta.conta_serie := to_json( _rec );\n    end if;\n\n    _conta.conta_estado := _const.maguita_conta_estado_fechado;\n    _conta.conta_imprensa := _conta.conta_imprensa +1;\n    _conta.conta_colaborador_fecho := arg_colaborador_id;\n    _conta.conta_datafecho := current_timestamp;\n    _conta.conta_cliente_id := coalesce( _conta.conta_cliente_id, lib.to_uuid( 1 ) );\n\n    -- Gerar a Guia de saida\n    _guia := jsonb_populate_record( _guia, args );\n    _guia.guia_tguia_id := _const.maguita_tguia_saida;\n    _guia.guia_espaco_saida := arg_espaco_auth;\n    _guia.guia_toperacao_id := _const.maguita_toperacao_venda;\n    _guia.guia_refclass := cluster.__format( 'tweeks.conta'::regclass );\n    _guia.guia_refuid := _conta.conta_id;\n    _guia.guia_refs := jsonb_build_object(\n        'cliente', jsonb_build_object( 'cliente_id', _conta.conta_cliente_id ),\n        'saida', jsonb_build_object( 'espaco_id', _conta.conta_espaco_auth )\n      );\n\n    _guia := tweeks.funct_sets_guia( jsonb_build_object(\n        'guia', _guia,\n        'custoguia', args->'custos',\n        'arg_colaborador_id', arg_colaborador_id,\n        'arg_espaco_auth', arg_espaco_auth\n      ));\n\n    _conta.conta_extension := coalesce( _conta.conta_extension, jsonb_build_object() )\n      || jsonb_build_object( 'guia_id', _guia.guia_uid );\n\n    select ( "returning" ).* into _conta\n    from lib.sets_up( _conta )\n    ;\n\n    if coalesce( _deposito.deposito_montantemoeda, 0.0 ) > 0 then\n\n      _montante_amortizacao  := _deposito.deposito_montantemoeda * _cambio.cambio_taxa;\n\n      if _montante_amortizacao > _conta.conta_montante and _conta._tgrupo_id != _const.maguita_tgrupo_ccorrente then\n        _deposito_montantetroco := _montante_amortizacao - _conta.conta_montante;\n      end if;\n\n      _deposito_montantetroco := coalesce( _deposito_montantetroco, _deposito.deposito_montantetroco, 0.0 );\n\n      _res := tweeks.funct_pos_reg_deposito(( args->'deposito' ) || jsonb_build_object(\n          'arg_espaco_auth', arg_espaco_auth,\n          'arg_colaborador_id', arg_colaborador_id,\n          'arg_balance_accounts', false,\n          'deposito_cliente_id', _conta.conta_cliente_id,\n          'deposito_montantetroco', _deposito_montantetroco,\n          '_tgrupo_id', _conta._tgrupo_id,\n          'deposito_referencia', lib.sets_ref( _conta ),\n          'deposito_documento', _conta.conta_numerofatura,\n          'deposito_serie', _conta.conta_serie,\n          '_raise', true\n        ));\n\n      if not _res.result then\n        perform lib.result_exception(\n            _res.message,\n            detail := _res.data::text,\n            hint := _res.error::text\n          );\n      else\n        _deposito := jsonb_populate_record( null::tweeks.deposito, _res.data->'deposito' );\n      end if;\n    end if;\n\n    return lib.res_true(\n        message := '@tweeks.conta.invoice-closed-success',\n        data := jsonb_build_object(\n            'guia', _guia,\n            'conta', tweeks._get_conta( _conta.conta_id ),\n            'fatura', _conta.conta_numerofatura,\n            'recibo', _deposito.deposito_documento\n          )\n      );\n  end;\n  $$;\n\n  with __invali_deposito as (\n    select de as desposito\n    from tweeks.deposito de\n           left join tweeks.conta ct on de.deposito_documento = ct.conta_numerofatura\n      and ct._tgrupo_id = (map.constant()).maguita_tgrupo_cnormal\n    where ct.conta_id is null\n      and de._tgrupo_id = (map.constant()).maguita_tgrupo_cnormal\n  ) delete from cluster.collector rev\n    using __invali_deposito _ide\n  where rev.collector_ref = lib.sets_ref( _ide.desposito )\n  returning *;\n\n\n  with __invali_deposito as (\n    select de as desposito\n    from tweeks.deposito de\n           left join tweeks.conta ct on de.deposito_documento = ct.conta_numerofatura\n      and ct._tgrupo_id = (map.constant()).maguita_tgrupo_cnormal\n    where ct.conta_id is null\n      and de._tgrupo_id = (map.constant()).maguita_tgrupo_cnormal\n  ) delete from cluster.object rev\n    using __invali_deposito _ide\n  where rev.object_ref = lib.sets_ref( _ide.desposito )\n  returning *;\n\n  with __invali_deposito as (\n    select *\n    from tweeks.deposito de\n           left join tweeks.conta ct on de.deposito_documento = ct.conta_numerofatura\n      and ct._tgrupo_id = (map.constant()).maguita_tgrupo_cnormal\n    where ct.conta_id is null\n      and de._tgrupo_id = (map.constant()).maguita_tgrupo_cnormal\n  ) delete from tweeks.deposito _de\n    using __invali_deposito _ide\n  where _De.deposito_id = _ide.deposito_id;\n\n  with __lancamento as (\n    select  lib.sets_ref( l ) as lanc_ref\n    from tweeks.lancamento l\n    where l.lancamento_regclass = 'tweeks.deposito'\n      and l.lancamento_refid not in (\n      select deposito_id\n      from tweeks.deposito\n    )\n  ) delete from cluster.collector\n    using __lancamento\n  where collector_ref = lanc_ref\n  returning *;\n\n  with __lancamento as (\n    select  lib.sets_ref( l ) as lanc_ref\n    from tweeks.lancamento l\n    where l.lancamento_regclass = 'tweeks.deposito'\n      and l.lancamento_refid not in (\n      select deposito_id\n      from tweeks.deposito\n    )\n  ) delete from cluster.object\n    using __lancamento\n  where object_ref = lanc_ref\n  returning *;\n\n  with __lancamento as (\n    select  lib.sets_ref( l ) as lanc_ref, l.lancamento_id _id\n    from tweeks.lancamento l\n    where l.lancamento_regclass = 'tweeks.deposito'\n      and l.lancamento_refid not in (\n      select deposito_id\n      from tweeks.deposito\n    )\n  ) delete from tweeks.lancamento\n    using __lancamento\n  where lancamento_id = _id\n  returning *;\n	create or replace function tweeks.funct_pos_change_conta_fechar(args jsonb) returns lib.res language plpgsql as $$ declare /** Essa função fecha uma nova conta arg = { arg_espaco_auth: ID, arg_colaborador_id: ID, deposito:{ deposito_cliente_id deposito_caixa_id deposito_tpaga_id deposito_currency_id deposito_posto_id deposito_montantemoeda deposito_montantetroco deposito_data deposito_docref: DOCUMENTO-REF? deposito_observacao: OBSERVACAO? } conta_id: ID, conta_extension: {} | { reserva_id: UID } conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM }, conta_posto_id: ID, conta_desconto conta_titular: NOME-CLIENTE conta_titularnif: VARCHAR, conta_data: DATA, conta_cliente_id, //Relativos a GUIA guia_documentoperacao: CODIGO, guia_dataopeacao: DATA, guia_observacao: DESCRICAO guia_metadata: { ... any extras data } custos:[{ custoguia_montante: MONTANTE, custoguia_descricao: DESCRICAO PARA O CUSTO custoguia_tcusto_id: 1 - DESPESA | 2 - RECEITA }] } */ arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_conta_id uuid default args->>'conta_id'; arg_caixa_id uuid default args->>'de_caixa_id'; _deposito_montantetroco double precision; _conta tweeks.conta; _const map.constant; _caixa tweeks.caixa; _res lib.res; _cambio record; _montante_amortizacao double precision; _deposito tweeks.deposito; _rec record; _guia tweeks.guia; _conta_estado record; begin _const := map.constant(); _caixa := tweeks._get_caixa( arg_caixa_id ); _conta := tweeks._get_conta( arg_conta_id ); _conta := jsonb_populate_record( _conta, args ); _conta.conta_data := coalesce( _conta.conta_data, current_date ); _deposito := jsonb_populate_record( _deposito, args->'deposito' ); _conta._tgrupo_id := case when _deposito.deposito_montantemoeda is null or args->'deposito' is null then _const.maguita_tgrupo_ccorrente else _const.maguita_tgrupo_cnormal end; if _conta.conta_estado = _const.maguita_conta_estado_fechado then return lib.res_false( 'Essa conta já se encontra fechada!' ); end if; -- select * into _conta_estado -- from tweeks.__lancamento_regularizacao(jsonb_build_object( -- 'cliente_id', _conta.conta_cliente_id, -- 'tgrupo_id', _conta._tgrupo_id, -- '_braunc_uid', _conta._branch_uid -- )) l -- where l.lancamento_refid = _conta.conta_id -- ; if _conta.conta_posto_fecho is null then return lib.res_false( 'Necessario indicar o posto de fecho!' ); end if; -- Quando for conta corrente if _deposito.deposito_montantemoeda is null and true in ( _conta.conta_cliente_id is null, _conta.conta_cliente_id = lib.to_uuid( 1 ) -- cliente final ) then return lib.res_false( 'Não pode abrir uma conta corrente para o cliente final' ); -- Quando for conta normal elseif _conta._tgrupo_id = _const.maguita_tgrupo_cnormal then if _deposito.deposito_tpaga_id = _const.maguita_tpaga_contacorrente then return lib.res_false( 'Tipo de pagamento invalido' ); end if; select * into _cambio from tweeks.__load_cambio_day( arg_espaco_auth, _deposito.deposito_currency_id, _conta.conta_data, _const ); if _cambio.cambio_id is null then return lib.res_false('Câmbio não foi encontrado!' ); end if; if round( (_cambio.cambio_taxa * _deposito.deposito_montantemoeda)::numeric, _const.money_round ) < round( _conta.conta_montante::numeric, _const.money_round ) then return lib.res_false('Montante para pagamento insuficiente' ); end if; -- Se for para amortizar a conta a caixa tem que estar aberta if _caixa.caixa_estado != _const.maguita_caixa_estado_ativo then return lib.res_false( 'Pagamento rejeitado!' ); end if; end if; if _conta._tgrupo_id = _const.maguita_tgrupo_cnormal then _rec := tweeks.__sets_generate_documento( arg_espaco_auth, _const.maguita_tserie_faturarecibo ); _conta.conta_numerofatura := _rec.document; _conta.conta_serie := to_json( _rec ); elsif _conta._tgrupo_id = _const.maguita_tgrupo_ccorrente then _rec := tweeks.__sets_generate_documento( arg_espaco_auth, _const.maguita_tserie_fatura ); _conta.conta_numerofatura := _rec.document; _conta.conta_serie := to_json( _rec ); end if; _conta.conta_estado := _const.maguita_conta_estado_fechado; _conta.conta_imprensa := _conta.conta_imprensa +1; _conta.conta_colaborador_fecho := arg_colaborador_id; _conta.conta_datafecho := current_timestamp; _conta.conta_cliente_id := coalesce( _conta.conta_cliente_id, lib.to_uuid( 1 ) ); -- Gerar a Guia de saida _guia := jsonb_populate_record( _guia, args ); _guia.guia_tguia_id := _const.maguita_tguia_saida; _guia.guia_espaco_saida := arg_espaco_auth; _guia.guia_toperacao_id := _const.maguita_toperacao_venda; _guia.guia_refclass := cluster.__format( 'tweeks.conta'::regclass ); _guia.guia_refuid := _conta.conta_id; _guia.guia_refs := jsonb_build_object( 'cliente', jsonb_build_object( 'cliente_id', _conta.conta_cliente_id ), 'saida', jsonb_build_object( 'espaco_id', _conta.conta_espaco_auth ) ); _guia := tweeks.funct_sets_guia( jsonb_build_object( 'guia', _guia, 'custoguia', args->'custos', 'arg_colaborador_id', arg_colaborador_id, 'arg_espaco_auth', arg_espaco_auth )); _conta.conta_extension := coalesce( _conta.conta_extension, jsonb_build_object() ) || jsonb_build_object( 'guia_id', _guia.guia_uid ); select ( "returning" ).* into _conta from lib.sets_up( _conta ) ; if coalesce( _deposito.deposito_montantemoeda, 0.0 ) > 0 then _montante_amortizacao := _deposito.deposito_montantemoeda * _cambio.cambio_taxa; if _montante_amortizacao > _conta.conta_montante and _conta._tgrupo_id != _const.maguita_tgrupo_ccorrente then _deposito_montantetroco := _montante_amortizacao - _conta.conta_montante; end if; _deposito_montantetroco := coalesce( _deposito_montantetroco, _deposito.deposito_montantetroco, 0.0 ); _res := tweeks.funct_pos_reg_deposito(( args->'deposito' ) || jsonb_build_object( 'arg_espaco_auth', arg_espaco_auth, 'arg_colaborador_id', arg_colaborador_id, 'arg_balance_accounts', false, 'deposito_cliente_id', _conta.conta_cliente_id, 'deposito_montantetroco', _deposito_montantetroco, '_tgrupo_id', _conta._tgrupo_id, 'deposito_referencia', lib.sets_ref( _conta ), 'deposito_documento', _conta.conta_numerofatura, 'deposito_serie', _conta.conta_serie, '_raise', true )); if not _res.result then perform lib.result_exception( _res.message, detail := _res.data::text, hint := _res.error::text ); else _deposito := jsonb_populate_record( null::tweeks.deposito, _res.data->'deposito' ); end if; end if; return lib.res_true( message := '@tweeks.conta.invoice-closed-success', data := jsonb_build_object( 'guia', _guia, 'conta', tweeks._get_conta( _conta.conta_id ), 'fatura', _conta.conta_numerofatura, 'recibo', _deposito.deposito_documento ) ); end; $$; with __invali_deposito as ( select de as desposito from tweeks.deposito de left join tweeks.conta ct on de.deposito_documento = ct.conta_numerofatura and ct._tgrupo_id = (map.constant()).maguita_tgrupo_cnormal where ct.conta_id is null and de._tgrupo_id = (map.constant()).maguita_tgrupo_cnormal ) delete from cluster.collector rev using __invali_deposito _ide where rev.collector_ref = lib.sets_ref( _ide.desposito ) returning *; with __invali_deposito as ( select de as desposito from tweeks.deposito de left join tweeks.conta ct on de.deposito_documento = ct.conta_numerofatura and ct._tgrupo_id = (map.constant()).maguita_tgrupo_cnormal where ct.conta_id is null and de._tgrupo_id = (map.constant()).maguita_tgrupo_cnormal ) delete from cluster.object rev using __invali_deposito _ide where rev.object_ref = lib.sets_ref( _ide.desposito ) returning *; with __invali_deposito as ( select * from tweeks.deposito de left join tweeks.conta ct on de.deposito_documento = ct.conta_numerofatura and ct._tgrupo_id = (map.constant()).maguita_tgrupo_cnormal where ct.conta_id is null and de._tgrupo_id = (map.constant()).maguita_tgrupo_cnormal ) delete from tweeks.deposito _de using __invali_deposito _ide where _De.deposito_id = _ide.deposito_id; with __lancamento as ( select lib.sets_ref( l ) as lanc_ref from tweeks.lancamento l where l.lancamento_regclass = 'tweeks.deposito' and l.lancamento_refid not in ( select deposito_id from tweeks.deposito ) ) delete from cluster.collector using __lancamento where collector_ref = lanc_ref returning *; with __lancamento as ( select lib.sets_ref( l ) as lanc_ref from tweeks.lancamento l where l.lancamento_regclass = 'tweeks.deposito' and l.lancamento_refid not in ( select deposito_id from tweeks.deposito ) ) delete from cluster.object using __lancamento where object_ref = lanc_ref returning *; with __lancamento as ( select lib.sets_ref( l ) as lanc_ref, l.lancamento_id _id from tweeks.lancamento l where l.lancamento_regclass = 'tweeks.deposito' and l.lancamento_refid not in ( select deposito_id from tweeks.deposito ) ) delete from tweeks.lancamento using __lancamento where lancamento_id = _id returning *;
1572737f-d6b1-45b6-b234-284d0dc3b7aa	\n  alter table tweeks.conta add conta_chave character varying;\n  create or replace function tweeks.funct_pos_generate_key( args jsonb )\n    returns character varying\n    language plpgsql as $$\n  declare\n    /**\n      arg_colaborador_id uuid\n      arg_espaco_auth uuid\n     */\n    arg_colaborador_id uuid default args->>'arg_colaborador_id';\n    arg_espaco_auth uuid default args->>'arg_espaco_auth';\n    ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n    _key character varying;\n  begin\n    while _key is null loop\n        _key :=  cluster.next( 'artigo.key/seq', ___branch::text, lpad := 9, lpad_char := '0' );\n        _key := format( 'CTK-%s-%s', _key, lib.dset_random_text(32 ) );\n        if exists( select from tweeks.conta ct where ct.conta_chave = _key ) then\n          _key := null;\n        end if;\n      end loop;\n    return _key;\n  end;\n  $$;\n\n  select *\n  from tweeks.funct_pos_generate_key('{"arg_espaco_auth":"45e058a5-4271-4d05-83b5-ca8145cc5091"}');\n  select * from tweeks.espaco;\n\n  alter table tweeks.conta add constraint uk_conta_chave unique ( conta_chave );\n  update tweeks.conta\n  set conta_chave = tweeks.funct_pos_generate_key( jsonb_build_object(\n      'arg_colaborador_id', conta_colaborador_id,\n      'arg_espaco_auth', conta_espaco_auth\n    ))\n  where conta.conta_chave is null;\n\n\n\n  create or replace function tweeks.funct_pos_reg_conta( args jsonb ) returns lib.res\n    language plpgsql\n  as\n  $$\n  declare\n    /**\n      Essa função registra um nova conta\n      arg = {\n  \n        -- obrigatorios\n        arg_colaborador_id: ID,\n        arg_espaco_auth: ID,\n  \n        conta_posto_id: ID,\n  \n        -- opcional\n        conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM }\n        conta_id: ID?\n        conta_extension: {} | { reserva_id: UID }\n        conta_chave: CHAVE\n  \n        conta_currency_id: ID,\n        conta_tpaga_id: ID,\n  \n        conta_cliente_id:UID\n        conta_titular: CLIENTE-NOME\n        conta_titularnif: CLIENTE-NIF\n        conta_data: DATA,\n  \n        -- requerido\n        arg_vendas: [\n          {\n            venda_id?: UID,\n            venda_artigo_id: UID,\n            venda_quantidade: QUANT,\n            venda_custounitario: COST\n            venda_custoquantidade: COST\n  \n            + venda_editado\n            + venda_isencao\n            + venda_montante\n            + venda_montanteagregado\n            + venda_montantetotal\n            + venda_imposto\n            + venda_montantesemimposto\n            + venda_montantecomimposto\n            + venda_impostoadicionar\n            + venda_impostoretirar\n  \n            + venda_descricao\n            + venda_lote\n            + venda_validade\n            + venda_metadata\n  \n            arg_itens: [\n                venda_id: UID\n                venda_artigo_id: UID,\n                venda_quantidade: QUANT,\n                venda_custounitario: COST\n                venda_custoquantidade: COST\n                venda_descricao: DESCRICAO\n                venda_lote: LOTE\n                venda_validade: VALIDADE\n                venda_metadata: {... any extras data}\n              + venda_montantetotal\n            ]\n          }\n        ]\n      }\n     */\n\n    arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n    arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n    arg_conta_id uuid default args->>'conta_id';\n    arg_conta_chave character varying not null default args->>'conta_chave';\n    arg_vendas jsonb not null default args->>'arg_vendas';\n\n    _conta tweeks.conta;\n    _const map.constant;\n    _unsets jsonb[];\n    _vendas uuid[] default array( select ( e.doc->>'venda_id' )::uuid from jsonb_array_elements( args->'arg_vendas' ) e ( doc ) where e.doc->>'venda_id' is not null);\n    _sync jsonb;\n    _reg_venda record;\n    _change tweeks.conta;\n    _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n\n    __conta_of_chave tweeks.conta;\n  begin\n\n    _const := map.constant();\n    _conta := tweeks._get_conta( arg_conta_id );\n\n    -- Carregar a conta com a chave correspondente\n    if _conta.conta_id is null and _conta.conta_chave is null then\n      select * into __conta_of_chave\n      from tweeks.conta ct\n      where ct.conta_chave = arg_conta_chave\n      ;\n    end if;\n\n    -- Tentitiva de criar uma segunda conta com a mensa chave (normalmente tentativa de duplo click na criação de uma nova conta)\n    if __conta_of_chave.conta_id is not null and _conta.conta_id is null then\n      args := args || lib.sets_ref( __conta_of_chave );\n      _conta := jsonb_populate_record( __conta_of_chave, args );\n    end if;\n\n\n    if _conta.conta_id is null then\n      _conta.conta_colaborador_id := arg_colaborador_id;\n      _conta.conta_espaco_auth := arg_espaco_auth;\n      _conta.conta_numero := cluster.next( 'conta.conta_numero/seq',\n                                           sub := _branch::text,\n                                           lpad_char := '0',\n                                           lpad := 5\n        );\n    else\n      _conta.conta_colaborador_atualizacao := arg_colaborador_id;\n      _conta.conta_dataatualizacao := current_timestamp;\n    end if;\n\n    _change := json_populate_record( _conta, args::json );\n\n    select ( "returning" ).* into _change\n    from lib.sets( _conta, replacer := args )  sets\n    where _conta::text != _change::text\n    ;\n\n    if _change.conta_id is not null then _conta := _change; end if;\n\n    -- Canselar as vendas que não fazem mais parte de conta\n    with recursive __venda as (\n      select\n        ve.venda_id,\n        ve.venda_estado\n      from tweeks.venda ve\n      where ve.venda_conta_id = _conta.conta_id\n        and ve.venda_venda_id is null\n        and ve.venda_id != all( _vendas )\n        and ve.venda_estado in (\n                                _const.maguita_venda_estado_aberto,\n                                _const.maguita_venda_estado_fechado\n        )\n      union all\n      select\n        ve.venda_id,\n        ve.venda_estado\n      from __venda vs\n             inner join tweeks.venda ve on vs.venda_id = ve.venda_venda_id\n      where vs.venda_estado in (\n                                _const.maguita_venda_estado_aberto,\n                                _const.maguita_venda_estado_fechado\n        )\n    ), __disable as(\n      update tweeks.venda up\n        set venda_estado = _const.maguita_venda_estado_canselado\n        from __venda _v\n        where up.venda_id = _v.venda_id\n        returning *\n    ) select array_agg( to_jsonb( d ) ) into _unsets\n    from __disable d;\n\n\n    _reg_venda :=  tweeks.funct_pos_reg_venda(\n        jsonb_build_object(\n            'arg_vendas', arg_vendas,\n            'arg_message_error', true,\n            'arg_espaco_auth', arg_espaco_auth,\n            'arg_colaborador_id', arg_colaborador_id,\n            'arg_conta_id', _conta.conta_id\n          )\n      );\n\n    _sync := tweeks.funct_pos__sync_conta_amount(\n        jsonb_build_object(\n            'arg_conta_id', _conta.conta_id,\n            'arg_colaborador_id', arg_colaborador_id,\n            'arg_espaco_auth', arg_espaco_auth\n          )\n      );\n\n    return lib.res_true( tweeks.funct_pos_load_conta_data( jsonb_build_object(\n        'arg_posto_id', args->'conta_posto_id',\n        'arg_espaco_auth', arg_espaco_auth,\n        'arg_colaborador_id', arg_colaborador_id,\n        'arg_conta_id', _conta.conta_id\n      )) || jsonb_build_object(\n                             'sync', _sync,\n                             'sets', _reg_venda.data->'vendas',\n                             'unsets', coalesce( _unsets, array[]::jsonb[])\n                           ));\n\n\n  exception  when others then\n    <<_ex>> declare e text; m text; d text; h text; c text;\n    begin\n      get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;\n      return lib.res_exception( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );\n    end;\n  end;\n  $$;\n\n  create or replace function tweeks.funct_pos_load_conta_aberto(args jsonb) returns SETOF jsonb\n    language plpgsql\n  as\n  $$\n  declare\n    /**\n      args := {\n        arg_colaborador_id: UID*,\n        arg_espaco_auth: UID?,\n        arg_posto_id: UID*\n      }\n     */\n    arg_colaborador_id uuid default args->>'arg_colaborador_id';\n    arg_posto_id uuid not null default args->>'arg_posto_id';\n    arg_espaco_auth uuid default args->>'arg_espaco_auth';\n    _const map.constant;\n  begin\n    _const := map.constant();\n    return query\n      with __conta as(\n        select\n          ct.conta_id,\n          ct.conta_numero,\n          ct.conta_montante,\n          ct.conta_mesa,\n          ct.conta_chave,\n          c.colaborador_id,\n          c.colaborador_nome,\n          c.colaborador_apelido,\n          e.espaco_id,\n          e.espaco_nome,\n          count( ve.venda_id ) as conta_vendas\n        from tweeks.conta ct\n               inner join auth.colaborador c on ct.conta_colaborador_id = c.colaborador_id\n               inner join tweeks.espaco e on ct.conta_espaco_auth = e.espaco_id\n               left join tweeks.venda ve on ct.conta_id = ve.venda_conta_id\n          and ve.venda_estado = _const.maguita_venda_estado_aberto\n          and ve.venda_venda_id is null\n        where ct.conta_posto_id = arg_posto_id\n          and ct.conta_estado = _const.maguita_conta_estado_aberto\n          and ct.conta_espaco_auth = coalesce( arg_espaco_auth, ct.conta_espaco_auth )\n          and not ct.conta_proforma\n        group by\n          c.colaborador_id,\n          ct.conta_id,\n          e.espaco_id\n      ) select to_jsonb( ct ) from __conta ct;\n  end;\n  $$;\n\n\n  drop table if exists cluster.tperiod cascade ;\n  create table if not exists cluster.tperiod(\n                                              tperiod_id int2,\n                                              tperiod_desc character varying,\n                                              tperiod_label character varying,\n                                              tperiod_code character varying,\n                                              constraint pk_trepeat_id primary key ( tperiod_id )\n  );\n\n  INSERT INTO cluster.tperiod ( tperiod_id, tperiod_desc, tperiod_label, tperiod_code ) VALUES (1, 'Diario', 'Dia', 'day');\n  INSERT INTO cluster.tperiod ( tperiod_id, tperiod_desc, tperiod_label, tperiod_code ) VALUES (2, 'Semanal', 'Semana', 'week');\n  INSERT INTO cluster.tperiod ( tperiod_id, tperiod_desc, tperiod_label, tperiod_code ) VALUES (3, 'Mensal', 'Mês', 'month');\n  INSERT INTO cluster.tperiod ( tperiod_id, tperiod_desc, tperiod_label, tperiod_code ) VALUES (4, 'Anual', 'Ano', 'year');\n\n  alter table cluster.cluster drop if exists cluster_licenserepeate;\n  alter table cluster.cluster add cluster_tperiod_id int2;\n  alter table cluster.cluster add constraint fk_cluster_to_tperiod foreign key ( cluster_tperiod_id ) references cluster.tperiod;\n\n  select * from cluster.tperiod order by tperiod_id;\n\n\n  create or replace function cluster.sets_clusters_admin(args jsonb) returns lib.res\n    language plpgsql\n  as\n  $$\n  declare\n    /**\n      args := {\n        cluster_license?: ( no carragamento de license )\n        cluster_licenselife: QT\n        cluster_tperiod_id: PERIODO (select * from cluster.tperiod order by tperiod_id)\n      }\n     */\n    _cluster cluster.cluster;\n    _result cluster.cluster;\n    _res lib.res;\n    _const map.constant;\n    _master cluster.cluster;\n    _local cluster.cluster;\n    _tperiod cluster.tperiod;\n\n    _doc jsonb default jsonb_build_object();\n  begin\n    _const := map.constant();\n    _cluster := jsonb_populate_record( _cluster, args );\n\n    select * into _tperiod\n    from cluster.tperiod tp\n    where tp.tperiod_id = _cluster.cluster_tperiod_id\n    ;\n\n\n    -- Quando for o cluster master\n    if _cluster.cluster_type = _const.cluster_tcluster_master then\n      --       raise exception 'Master:%', args;\n\n      -- Aplicar as confifurações de cluster master\n      _master := cluster._get_cluster_master();\n      _master.cluster_domain := _cluster.cluster_domain;\n      _master.cluster_api := _cluster.cluster_api;\n      _master.cluster_port := _cluster.cluster_port;\n      _master.cluster_type := _const.cluster_tcluster_master;\n      _master.cluster_name := coalesce( _master.cluster_name, 'Master' );\n      select ( "returning" ).* into _result from lib.sets( _master );\n      _doc := _doc || jsonb_build_object( 'master', _result );\n\n\n      -- Aplicar as configuraçõa do cluster local\n      _local := cluster._get_cluster_local();\n      _local.cluster_name := coalesce( _local.cluster_name, 'Local' );\n      _local.cluster_identifier := _cluster.cluster_identifier;\n      _local.cluster_license := _cluster.cluster_license;\n      _local.cluster_licenselife := _cluster.cluster_licenselife;\n      _local.cluster_tperiod_id := _cluster.cluster_tperiod_id;\n      select ( "returning" ).* into _result from  lib.sets( _local );\n      _doc := _doc || jsonb_build_object( 'local', _result );\n\n    elseif _cluster.cluster_type = _const.cluster_tcluster_child then\n\n      _cluster.cluster_identifier := cluster.__create_identifier();\n      _cluster.cluster_api := cluster.__create_api();\n      _cluster.cluster_key := format( '%s-%s', cluster.__create_api(), cluster.__create_api() );\n\n      select ( "returning" ).* into _result\n      from lib.sets( _cluster );\n\n      if _cluster.cluster_uid is null then\n        select * into _res\n        from cluster.sets_cluster_license( to_jsonb( _cluster ) || lib.sets_ref( _result ) );\n      end if;\n\n      _doc := _doc || jsonb_build_object( 'child', _res );\n    end if;\n\n    return lib.res_true( _doc );\n  end;\n  $$;\n\n  create or replace function cluster.load_clusters( args jsonb )\n    returns SETOF jsonb\n    language plpgsql\n  as\n  $$\n  declare\n    _const map.constant;\n  begin\n    _const := map.constant();\n    return query with\n                   __cluster as (\n                     select\n                       c.cluster_uid,\n                       c.cluster_identifier,\n                       c.cluster_type,\n                       c.cluster_code,\n                       c.cluster_path,\n                       c.cluster_domain,\n                       c.cluster_licenselife,\n                       c.cluster_license,\n                       case\n                         when c.cluster_name is null and c.cluster_type = _const.cluster_tcluster_local then 'Local server'\n                         else c.cluster_name\n                         end as cluster_name,\n                       c.cluster_port,\n                       c.cluster_api,\n                       c.cluster_version,\n                       c.cluster_grants,\n                       c.cluster_configs,\n                       c.cluster_sequence,\n                       tp.*\n                     from cluster.cluster c\n                            left join cluster.tperiod tp on c.cluster_tperiod_id = tp.tperiod_id\n                   ) select to_jsonb( _c )\n                 from __cluster _c\n                 order by case\n                            when _c.cluster_type = _const.cluster_tcluster_local then 1\n                            when _c.cluster_type = _const.cluster_tcluster_master then 2\n                            when _c.cluster_type = _const.cluster_tcluster_child then 3\n                            when _c.cluster_type = _const.cluster_tcluster_remote then 4\n                            end,\n                          _c.cluster_name\n    ;\n  end;\n  $$;\n\n  create or replace function cluster.sets_cluster_configs(args jsonb) returns lib.res\n    language plpgsql\n  as\n  $$\n  declare\n    /**\n      args := {\n        clusters: [{\n          cluster_uid\n          cluster_identifier\n          cluster_path\n          cluster_name\n          cluster_domain\n          cluster_port\n          cluster_key,\n          cluster_license,\n          cluster_licenselife,\n          cluster_tperiod_id\n        }]\n      }\n     */\n    _const map.constant;\n    _data record;\n  begin\n    _const := map.constant();\n\n    with __clusters as (\n      select c as _cluster, e.doc as cluster_replace\n      from jsonb_array_elements( args->'clusters' ) e( doc )\n             inner join jsonb_populate_record( null::cluster.cluster, e.doc ) _clu on true\n             inner join cluster.cluster c on  _clu.cluster_type = c.cluster_type\n        and _clu.cluster_type in ( _const.cluster_tcluster_master, _const.cluster_tcluster_local )\n    ), __sets as (\n      select s."returning" as cluster\n      from __clusters _c\n             inner join lib.sets( _c._cluster, _c.cluster_replace ) s on true\n    ) select array_agg( s.cluster ) as clusters into _data\n    from __sets s\n    ;\n\n    return lib.res_true(  to_jsonb( _data ) );\n  end;\n  $$;\n\n  create or replace function cluster.load_clusters_configs_to_child(args jsonb) returns SETOF jsonb\n    language plpgsql\n  as\n  $$\n  declare\n    /**\n      args := {\n        cluster_identifier: PATH\n        cluster_api: PATH\n        cluster_key\n      }\n     */\n    _const map.constant;\n    _cluster cluster.cluster;\n  begin\n    _const := map.constant();\n    _cluster := jsonb_populate_record( _cluster, args );\n\n    if not exists(\n        select *\n        from cluster.cluster c\n        where c.cluster_api = _cluster.cluster_api\n          and c.cluster_identifier = _cluster.cluster_identifier\n          and c.cluster_type = _const.cluster_tcluster_child\n      ) then\n      return;\n    end if;\n\n    return query with\n                   __cluster as (\n                     select\n                       c.cluster_identifier,\n                       case\n                         when c.cluster_type = _const.cluster_tcluster_child then _const.cluster_tcluster_local\n                         when c.cluster_type = _const.cluster_tcluster_local then _const.cluster_tcluster_master\n                         end as cluster_type,\n\n                       case\n                         when c.cluster_type = _const.cluster_tcluster_child then c.cluster_key\n                         end as cluster_key,\n\n                       case\n                         when c.cluster_type = _const.cluster_tcluster_child then c.cluster_configs\n                         else jsonb_build_object()\n                         end as cluster_configs,\n\n                       case\n                         when c.cluster_type = _const.cluster_tcluster_child then c.cluster_grants\n                         else array[ ]::text[ ]\n                         end as cluster_grants,\n\n                       coalesce( c.cluster_path, '/' ) as cluster_path,\n\n                       case\n                         when c.cluster_type = _const.cluster_tcluster_child then c.cluster_license\n                         end as cluster_license,\n                       case\n                         when c.cluster_type = _const.cluster_tcluster_child then c.cluster_code\n                         end as cluster_code,\n\n                       case\n                         when c.cluster_type = _const.cluster_tcluster_child then c.cluster_licenselife\n                         end as cluster_licenselife,\n\n                       case\n                         when c.cluster_type = _const.cluster_tcluster_child then c.cluster_tperiod_id\n                         end as cluster_tperiod_id,\n\n                       c.cluster_name\n                     from cluster.cluster c\n                     where c.cluster_type = _const.cluster_tcluster_local\n                        or ( c.cluster_identifier = _cluster.cluster_identifier and c.cluster_type = _const.cluster_tcluster_child )\n                   ) select\n                   case\n                     when _c.cluster_type = _const.cluster_tcluster_master and _c.cluster_name is null then to_jsonb( _c )\n                                                                                                              - 'cluster_key'\n                       || jsonb_build_object( 'cluster_name', 'Main Master (trunc)' )\n                     else to_jsonb( _c )\n                     end\n                 from __cluster _c\n    ;\n  end\n  $$;\n\n  drop function cluster.sets_cluster_license(args jsonb);\n  create or replace function cluster.sets_cluster_license(args jsonb) returns lib.res\n    language plpgsql\n  as\n  $$\n  declare\n    /**\n      args := {\n        cluster_uid:UID\n        cluster_tperiod_id\n        cluster_licenselife: NUMBER >> REPITICAO DO PERIODO\n      }\n     */\n    _cluster cluster.cluster;\n    _interval interval;\n    _tperid cluster.tperiod;\n    _result cluster.cluster;\n  begin\n    _cluster := jsonb_populate_record( _cluster, args );\n    select * into _tperid from cluster.tperiod where tperiod_id = _cluster.cluster_tperiod_id;\n\n    if _cluster.cluster_licenselife > 0\n      and _cluster.cluster_tperiod_id is not null\n    then\n      _interval := format( '%L %s',  _cluster.cluster_licenselife, _tperid.tperiod_code )::interval;\n      _cluster.cluster_license := current_timestamp + _interval;\n\n      select ( "returning" ).* into _result\n      from lib.sets( _cluster );\n\n      return lib.res_true( jsonb_build_object( '_cluster', _result ) );\n    end if;\n\n    return lib.res_false( 'Licensa invalida!' );\n  end;\n  $$;\n	alter table tweeks.conta add conta_chave character varying; create or replace function tweeks.funct_pos_generate_key( args jsonb ) returns character varying language plpgsql as $$ declare /** arg_colaborador_id uuid arg_espaco_auth uuid */ arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _key character varying; begin while _key is null loop _key := cluster.next( 'artigo.key/seq', ___branch::text, lpad := 9, lpad_char := '0' ); _key := format( 'CTK-%s-%s', _key, lib.dset_random_text(32 ) ); if exists( select from tweeks.conta ct where ct.conta_chave = _key ) then _key := null; end if; end loop; return _key; end; $$; select * from tweeks.funct_pos_generate_key('{"arg_espaco_auth":"45e058a5-4271-4d05-83b5-ca8145cc5091"}'); select * from tweeks.espaco; alter table tweeks.conta add constraint uk_conta_chave unique ( conta_chave ); update tweeks.conta set conta_chave = tweeks.funct_pos_generate_key( jsonb_build_object( 'arg_colaborador_id', conta_colaborador_id, 'arg_espaco_auth', conta_espaco_auth )) where conta.conta_chave is null; create or replace function tweeks.funct_pos_reg_conta( args jsonb ) returns lib.res language plpgsql as $$ declare /** Essa função registra um nova conta arg = { -- obrigatorios arg_colaborador_id: ID, arg_espaco_auth: ID, conta_posto_id: ID, -- opcional conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM } conta_id: ID? conta_extension: {} | { reserva_id: UID } conta_chave: CHAVE conta_currency_id: ID, conta_tpaga_id: ID, conta_cliente_id:UID conta_titular: CLIENTE-NOME conta_titularnif: CLIENTE-NIF conta_data: DATA, -- requerido arg_vendas: [ { venda_id?: UID, venda_artigo_id: UID, venda_quantidade: QUANT, venda_custounitario: COST venda_custoquantidade: COST + venda_editado + venda_isencao + venda_montante + venda_montanteagregado + venda_montantetotal + venda_imposto + venda_montantesemimposto + venda_montantecomimposto + venda_impostoadicionar + venda_impostoretirar + venda_descricao + venda_lote + venda_validade + venda_metadata arg_itens: [ venda_id: UID venda_artigo_id: UID, venda_quantidade: QUANT, venda_custounitario: COST venda_custoquantidade: COST venda_descricao: DESCRICAO venda_lote: LOTE venda_validade: VALIDADE venda_metadata: {... any extras data} + venda_montantetotal ] } ] } */ arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_conta_id uuid default args->>'conta_id'; arg_conta_chave character varying not null default args->>'conta_chave'; arg_vendas jsonb not null default args->>'arg_vendas'; _conta tweeks.conta; _const map.constant; _unsets jsonb[]; _vendas uuid[] default array( select ( e.doc->>'venda_id' )::uuid from jsonb_array_elements( args->'arg_vendas' ) e ( doc ) where e.doc->>'venda_id' is not null); _sync jsonb; _reg_venda record; _change tweeks.conta; _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); __conta_of_chave tweeks.conta; begin _const := map.constant(); _conta := tweeks._get_conta( arg_conta_id ); -- Carregar a conta com a chave correspondente if _conta.conta_id is null and _conta.conta_chave is null then select * into __conta_of_chave from tweeks.conta ct where ct.conta_chave = arg_conta_chave ; end if; -- Tentitiva de criar uma segunda conta com a mensa chave (normalmente tentativa de duplo click na criação de uma nova conta) if __conta_of_chave.conta_id is not null and _conta.conta_id is null then args := args || lib.sets_ref( __conta_of_chave ); _conta := jsonb_populate_record( __conta_of_chave, args ); end if; if _conta.conta_id is null then _conta.conta_colaborador_id := arg_colaborador_id; _conta.conta_espaco_auth := arg_espaco_auth; _conta.conta_numero := cluster.next( 'conta.conta_numero/seq', sub := _branch::text, lpad_char := '0', lpad := 5 ); else _conta.conta_colaborador_atualizacao := arg_colaborador_id; _conta.conta_dataatualizacao := current_timestamp; end if; _change := json_populate_record( _conta, args::json ); select ( "returning" ).* into _change from lib.sets( _conta, replacer := args ) sets where _conta::text != _change::text ; if _change.conta_id is not null then _conta := _change; end if; -- Canselar as vendas que não fazem mais parte de conta with recursive __venda as ( select ve.venda_id, ve.venda_estado from tweeks.venda ve where ve.venda_conta_id = _conta.conta_id and ve.venda_venda_id is null and ve.venda_id != all( _vendas ) and ve.venda_estado in ( _const.maguita_venda_estado_aberto, _const.maguita_venda_estado_fechado ) union all select ve.venda_id, ve.venda_estado from __venda vs inner join tweeks.venda ve on vs.venda_id = ve.venda_venda_id where vs.venda_estado in ( _const.maguita_venda_estado_aberto, _const.maguita_venda_estado_fechado ) ), __disable as( update tweeks.venda up set venda_estado = _const.maguita_venda_estado_canselado from __venda _v where up.venda_id = _v.venda_id returning * ) select array_agg( to_jsonb( d ) ) into _unsets from __disable d; _reg_venda := tweeks.funct_pos_reg_venda( jsonb_build_object( 'arg_vendas', arg_vendas, 'arg_message_error', true, 'arg_espaco_auth', arg_espaco_auth, 'arg_colaborador_id', arg_colaborador_id, 'arg_conta_id', _conta.conta_id ) ); _sync := tweeks.funct_pos__sync_conta_amount( jsonb_build_object( 'arg_conta_id', _conta.conta_id, 'arg_colaborador_id', arg_colaborador_id, 'arg_espaco_auth', arg_espaco_auth ) ); return lib.res_true( tweeks.funct_pos_load_conta_data( jsonb_build_object( 'arg_posto_id', args->'conta_posto_id', 'arg_espaco_auth', arg_espaco_auth, 'arg_colaborador_id', arg_colaborador_id, 'arg_conta_id', _conta.conta_id )) || jsonb_build_object( 'sync', _sync, 'sets', _reg_venda.data->'vendas', 'unsets', coalesce( _unsets, array[]::jsonb[]) )); exception when others then <<_ex>> declare e text; m text; d text; h text; c text; begin get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context; return lib.res_exception( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c ); end; end; $$; create or replace function tweeks.funct_pos_load_conta_aberto(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** args := { arg_colaborador_id: UID*, arg_espaco_auth: UID?, arg_posto_id: UID* } */ arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_posto_id uuid not null default args->>'arg_posto_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; _const map.constant; begin _const := map.constant(); return query with __conta as( select ct.conta_id, ct.conta_numero, ct.conta_montante, ct.conta_mesa, ct.conta_chave, c.colaborador_id, c.colaborador_nome, c.colaborador_apelido, e.espaco_id, e.espaco_nome, count( ve.venda_id ) as conta_vendas from tweeks.conta ct inner join auth.colaborador c on ct.conta_colaborador_id = c.colaborador_id inner join tweeks.espaco e on ct.conta_espaco_auth = e.espaco_id left join tweeks.venda ve on ct.conta_id = ve.venda_conta_id and ve.venda_estado = _const.maguita_venda_estado_aberto and ve.venda_venda_id is null where ct.conta_posto_id = arg_posto_id and ct.conta_estado = _const.maguita_conta_estado_aberto and ct.conta_espaco_auth = coalesce( arg_espaco_auth, ct.conta_espaco_auth ) and not ct.conta_proforma group by c.colaborador_id, ct.conta_id, e.espaco_id ) select to_jsonb( ct ) from __conta ct; end; $$; drop table if exists cluster.tperiod cascade ; create table if not exists cluster.tperiod( tperiod_id int2, tperiod_desc character varying, tperiod_label character varying, tperiod_code character varying, constraint pk_trepeat_id primary key ( tperiod_id ) ); INSERT INTO cluster.tperiod ( tperiod_id, tperiod_desc, tperiod_label, tperiod_code ) VALUES (1, 'Diario', 'Dia', 'day'); INSERT INTO cluster.tperiod ( tperiod_id, tperiod_desc, tperiod_label, tperiod_code ) VALUES (2, 'Semanal', 'Semana', 'week'); INSERT INTO cluster.tperiod ( tperiod_id, tperiod_desc, tperiod_label, tperiod_code ) VALUES (3, 'Mensal', 'Mês', 'month'); INSERT INTO cluster.tperiod ( tperiod_id, tperiod_desc, tperiod_label, tperiod_code ) VALUES (4, 'Anual', 'Ano', 'year'); alter table cluster.cluster drop if exists cluster_licenserepeate; alter table cluster.cluster add cluster_tperiod_id int2; alter table cluster.cluster add constraint fk_cluster_to_tperiod foreign key ( cluster_tperiod_id ) references cluster.tperiod; select * from cluster.tperiod order by tperiod_id; create or replace function cluster.sets_clusters_admin(args jsonb) returns lib.res language plpgsql as $$ declare /** args := { cluster_license?: ( no carragamento de license ) cluster_licenselife: QT cluster_tperiod_id: PERIODO (select * from cluster.tperiod order by tperiod_id) } */ _cluster cluster.cluster; _result cluster.cluster; _res lib.res; _const map.constant; _master cluster.cluster; _local cluster.cluster; _tperiod cluster.tperiod; _doc jsonb default jsonb_build_object(); begin _const := map.constant(); _cluster := jsonb_populate_record( _cluster, args ); select * into _tperiod from cluster.tperiod tp where tp.tperiod_id = _cluster.cluster_tperiod_id ; -- Quando for o cluster master if _cluster.cluster_type = _const.cluster_tcluster_master then -- raise exception 'Master:%', args; -- Aplicar as confifurações de cluster master _master := cluster._get_cluster_master(); _master.cluster_domain := _cluster.cluster_domain; _master.cluster_api := _cluster.cluster_api; _master.cluster_port := _cluster.cluster_port; _master.cluster_type := _const.cluster_tcluster_master; _master.cluster_name := coalesce( _master.cluster_name, 'Master' ); select ( "returning" ).* into _result from lib.sets( _master ); _doc := _doc || jsonb_build_object( 'master', _result ); -- Aplicar as configuraçõa do cluster local _local := cluster._get_cluster_local(); _local.cluster_name := coalesce( _local.cluster_name, 'Local' ); _local.cluster_identifier := _cluster.cluster_identifier; _local.cluster_license := _cluster.cluster_license; _local.cluster_licenselife := _cluster.cluster_licenselife; _local.cluster_tperiod_id := _cluster.cluster_tperiod_id; select ( "returning" ).* into _result from lib.sets( _local ); _doc := _doc || jsonb_build_object( 'local', _result ); elseif _cluster.cluster_type = _const.cluster_tcluster_child then _cluster.cluster_identifier := cluster.__create_identifier(); _cluster.cluster_api := cluster.__create_api(); _cluster.cluster_key := format( '%s-%s', cluster.__create_api(), cluster.__create_api() ); select ( "returning" ).* into _result from lib.sets( _cluster ); if _cluster.cluster_uid is null then select * into _res from cluster.sets_cluster_license( to_jsonb( _cluster ) || lib.sets_ref( _result ) ); end if; _doc := _doc || jsonb_build_object( 'child', _res ); end if; return lib.res_true( _doc ); end; $$; create or replace function cluster.load_clusters( args jsonb ) returns SETOF jsonb language plpgsql as $$ declare _const map.constant; begin _const := map.constant(); return query with __cluster as ( select c.cluster_uid, c.cluster_identifier, c.cluster_type, c.cluster_code, c.cluster_path, c.cluster_domain, c.cluster_licenselife, c.cluster_license, case when c.cluster_name is null and c.cluster_type = _const.cluster_tcluster_local then 'Local server' else c.cluster_name end as cluster_name, c.cluster_port, c.cluster_api, c.cluster_version, c.cluster_grants, c.cluster_configs, c.cluster_sequence, tp.* from cluster.cluster c left join cluster.tperiod tp on c.cluster_tperiod_id = tp.tperiod_id ) select to_jsonb( _c ) from __cluster _c order by case when _c.cluster_type = _const.cluster_tcluster_local then 1 when _c.cluster_type = _const.cluster_tcluster_master then 2 when _c.cluster_type = _const.cluster_tcluster_child then 3 when _c.cluster_type = _const.cluster_tcluster_remote then 4 end, _c.cluster_name ; end; $$; create or replace function cluster.sets_cluster_configs(args jsonb) returns lib.res language plpgsql as $$ declare /** args := { clusters: [{ cluster_uid cluster_identifier cluster_path cluster_name cluster_domain cluster_port cluster_key, cluster_license, cluster_licenselife, cluster_tperiod_id }] } */ _const map.constant; _data record; begin _const := map.constant(); with __clusters as ( select c as _cluster, e.doc as cluster_replace from jsonb_array_elements( args->'clusters' ) e( doc ) inner join jsonb_populate_record( null::cluster.cluster, e.doc ) _clu on true inner join cluster.cluster c on _clu.cluster_type = c.cluster_type and _clu.cluster_type in ( _const.cluster_tcluster_master, _const.cluster_tcluster_local ) ), __sets as ( select s."returning" as cluster from __clusters _c inner join lib.sets( _c._cluster, _c.cluster_replace ) s on true ) select array_agg( s.cluster ) as clusters into _data from __sets s ; return lib.res_true( to_jsonb( _data ) ); end; $$; create or replace function cluster.load_clusters_configs_to_child(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** args := { cluster_identifier: PATH cluster_api: PATH cluster_key } */ _const map.constant; _cluster cluster.cluster; begin _const := map.constant(); _cluster := jsonb_populate_record( _cluster, args ); if not exists( select * from cluster.cluster c where c.cluster_api = _cluster.cluster_api and c.cluster_identifier = _cluster.cluster_identifier and c.cluster_type = _const.cluster_tcluster_child ) then return; end if; return query with __cluster as ( select c.cluster_identifier, case when c.cluster_type = _const.cluster_tcluster_child then _const.cluster_tcluster_local when c.cluster_type = _const.cluster_tcluster_local then _const.cluster_tcluster_master end as cluster_type, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_key end as cluster_key, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_configs else jsonb_build_object() end as cluster_configs, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_grants else array[ ]::text[ ] end as cluster_grants, coalesce( c.cluster_path, '/' ) as cluster_path, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_license end as cluster_license, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_code end as cluster_code, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_licenselife end as cluster_licenselife, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_tperiod_id end as cluster_tperiod_id, c.cluster_name from cluster.cluster c where c.cluster_type = _const.cluster_tcluster_local or ( c.cluster_identifier = _cluster.cluster_identifier and c.cluster_type = _const.cluster_tcluster_child ) ) select case when _c.cluster_type = _const.cluster_tcluster_master and _c.cluster_name is null then to_jsonb( _c ) - 'cluster_key' || jsonb_build_object( 'cluster_name', 'Main Master (trunc)' ) else to_jsonb( _c ) end from __cluster _c ; end $$; drop function cluster.sets_cluster_license(args jsonb); create or replace function cluster.sets_cluster_license(args jsonb) returns lib.res language plpgsql as $$ declare /** args := { cluster_uid:UID cluster_tperiod_id cluster_licenselife: NUMBER >> REPITICAO DO PERIODO } */ _cluster cluster.cluster; _interval interval; _tperid cluster.tperiod; _result cluster.cluster; begin _cluster := jsonb_populate_record( _cluster, args ); select * into _tperid from cluster.tperiod where tperiod_id = _cluster.cluster_tperiod_id; if _cluster.cluster_licenselife > 0 and _cluster.cluster_tperiod_id is not null then _interval := format( '%L %s', _cluster.cluster_licenselife, _tperid.tperiod_code )::interval; _cluster.cluster_license := current_timestamp + _interval; select ( "returning" ).* into _result from lib.sets( _cluster ); return lib.res_true( jsonb_build_object( '_cluster', _result ) ); end if; return lib.res_false( 'Licensa invalida!' ); end; $$;
fcad4c84-d995-4689-800a-996a9c0c5ae0	\n  alter table cluster.cluster add cluster_namespace character varying default null;\n  alter table cluster.cluster add constraint uk_cluster_namespace unique ( cluster_namespace );\n	alter table cluster.cluster add cluster_namespace character varying default null; alter table cluster.cluster add constraint uk_cluster_namespace unique ( cluster_namespace );
d1f2417b-bcfc-4119-93f6-c21be13ebbfa	\n  alter table cluster.cluster add cluster_remote boolean not null default false;\n	alter table cluster.cluster add cluster_remote boolean not null default false;
5be436d8-08d4-4d4b-98b4-80b3c34251e4	\n  create or replace function cluster.load_cluster_by_namespace( namespace character varying)\n  returns setof jsonb language sql as $$\n    select to_jsonb( c ) from cluster.cluster c where cluster_namespace = namespace;\n  $$;\n\ncreate or replace function cluster.load_clusters_configs_to_child(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    args := {\n      cluster_identifier: PATH\n      cluster_api: PATH\n      cluster_key\n    }\n   */\n  _const map.constant;\n  _cluster cluster.cluster;\nbegin\n  _const := map.constant();\n  _cluster := jsonb_populate_record( _cluster, args );\n\n  if not exists(\n      select *\n      from cluster.cluster c\n      where c.cluster_api = _cluster.cluster_api\n        and c.cluster_identifier = _cluster.cluster_identifier\n        and c.cluster_type = _const.cluster_tcluster_child\n    ) then\n    return;\n  end if;\n\n  return query with\n     __cluster as (\n       select\n         c.cluster_identifier,\n         case\n           when c.cluster_type = _const.cluster_tcluster_child then _const.cluster_tcluster_local\n           when c.cluster_type = _const.cluster_tcluster_local then _const.cluster_tcluster_master\n           end as cluster_type,\n\n         case\n           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_key\n           end as cluster_key,\n\n         case\n           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_configs\n           else jsonb_build_object()\n           end as cluster_configs,\n\n         case\n           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_grants\n           else array[ ]::text[ ]\n           end as cluster_grants,\n\n         coalesce( c.cluster_path, '/' ) as cluster_path,\n\n         case\n           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_license\n           end as cluster_license,\n         case\n           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_code\n           end as cluster_code,\n\n        case\n           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_licenselife\n           end as cluster_licenselife,\n\n        case\n           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_tperiod_id\n           end as cluster_tperiod_id,\n\n        case\n           when c.cluster_type = _const.cluster_tcluster_child then c.cluster_namespace\n           end as cluster_namespace,\n       \n         c.cluster_name\n       \n       \n       from cluster.cluster c\n       where c.cluster_type = _const.cluster_tcluster_local\n          or ( c.cluster_identifier = _cluster.cluster_identifier and c.cluster_type = _const.cluster_tcluster_child )\n     ) select\n     case\n       when _c.cluster_type = _const.cluster_tcluster_master and _c.cluster_name is null then to_jsonb( _c )\n        - 'cluster_key'\n        || jsonb_build_object( 'cluster_name', 'Main Master (trunc)' )\n       else to_jsonb( _c )\n       end\n   from __cluster _c\n  ;\nend\n$$;\n\ncreate or replace function load_clusters(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  _const map.constant;\nbegin\n  _const := map.constant();\n  return query with\n    __cluster as (\n      select\n          c.cluster_uid,\n          c.cluster_identifier,\n          c.cluster_type,\n          c.cluster_code,\n          c.cluster_path,\n          c.cluster_domain,\n          c.cluster_licenselife,\n          c.cluster_license,\n          case\n            when c.cluster_name is null and c.cluster_type = _const.cluster_tcluster_local then 'Local server'\n            else c.cluster_name\n          end as cluster_name,\n          c.cluster_port,\n          c.cluster_api,\n          c.cluster_version,\n          c.cluster_grants,\n          c.cluster_configs,\n          c.cluster_sequence,\n          c.cluster_namespace,\n          tp.*\n        from cluster.cluster c\n          left join cluster.tperiod tp on c.cluster_tperiod_id = tp.tperiod_id\n    ) select to_jsonb( _c )\n      from __cluster _c\n      order by case\n        when _c.cluster_type = _const.cluster_tcluster_local then 1\n        when _c.cluster_type = _const.cluster_tcluster_master then 2\n        when _c.cluster_type = _const.cluster_tcluster_child then 3\n        when _c.cluster_type = _const.cluster_tcluster_remote then 4\n      end,\n      _c.cluster_name\n  ;\nend;\n$$;\n\ncreate or replace function cluster.define_namespace( args jsonb )\nreturns lib.res\nlanguage plpgsql as $$\ndeclare\n  /**\n    args := {\n      cluster_uid: UID\n      cluster_namespace: NAMESPACE\n    }\n   */\n  _cluster cluster.cluster;\n  _chars character varying[] = regexp_split_to_array( lower( 'ABCDEFGHIJKLMNOPQRSTUVWXYZ-0123456789_'), '' );\n  _check record;\nbegin\n  _cluster := jsonb_populate_record( _cluster, args );\n  _cluster.cluster_namespace := lower( _cluster.cluster_namespace );\n  \n  select \n      string_agg( format( '%I posição %s', c.character, c.ordinality ), ', ' ) characters,\n      count( * ) as count\n      into _check\n    from  unnest( regexp_split_to_array( _cluster.cluster_namespace, '' ) ) with ordinality c( character )\n    where not c = any( _chars);\n  \n  if _check.count > 0 then \n    return lib.res_false( format( 'Namespace está invalido! caracteres: %s', _check.characters ) );\n  end if;\n  \n  _cluster.cluster_namespace := lib.str_normalize( _cluster.cluster_namespace );\n  if _cluster.cluster_namespace is null then\n    return lib.res_false( 'Namespace está invalido ou não definido!' );\n  end if;\n  \n  select ("returning").* into _cluster\n    from lib.sets_up( _cluster, ref := lib.sets_ref(_cluster));\n  \n  return lib.result_true( jsonb_build_object(\n    'cluster', _cluster\n  ));\nend;\n$$;\n\ndrop function if exists cluster.switch_remote_connection();\ndrop function if exists cluster.switch_remote_connection( args jsonb );\ncreate or replace function cluster.switch_remote_connection( args jsonb )\nreturns lib.res\nlanguage plpgsql\nas $$\ndeclare\n  _local cluster.cluster;\n  _result cluster.cluster;\nbegin\n  _local := cluster._get_cluster_local();\n  _result := jsonb_populate_record( _result, args );\n  if _local.cluster_namespace is null then\n    return lib.res_true( jsonb_build_object( 'cluster_remote', false, 'cluster_remote_old', false ));\n  end if;\n  \n  update cluster.cluster\n    set cluster_remote = _result.cluster_remote \n    where cluster_uid = _local.cluster_uid\n    returning * into _result;\n  \n  return lib.res_true( jsonb_build_object(\n    'cluster_remote', _result.cluster_remote,\n    'cluster_remote_old', _local.cluster_remote\n    \n  ));\nend;\n$$;\n	create or replace function cluster.load_cluster_by_namespace( namespace character varying) returns setof jsonb language sql as $$ select to_jsonb( c ) from cluster.cluster c where cluster_namespace = namespace; $$; create or replace function cluster.load_clusters_configs_to_child(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** args := { cluster_identifier: PATH cluster_api: PATH cluster_key } */ _const map.constant; _cluster cluster.cluster; begin _const := map.constant(); _cluster := jsonb_populate_record( _cluster, args ); if not exists( select * from cluster.cluster c where c.cluster_api = _cluster.cluster_api and c.cluster_identifier = _cluster.cluster_identifier and c.cluster_type = _const.cluster_tcluster_child ) then return; end if; return query with __cluster as ( select c.cluster_identifier, case when c.cluster_type = _const.cluster_tcluster_child then _const.cluster_tcluster_local when c.cluster_type = _const.cluster_tcluster_local then _const.cluster_tcluster_master end as cluster_type, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_key end as cluster_key, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_configs else jsonb_build_object() end as cluster_configs, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_grants else array[ ]::text[ ] end as cluster_grants, coalesce( c.cluster_path, '/' ) as cluster_path, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_license end as cluster_license, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_code end as cluster_code, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_licenselife end as cluster_licenselife, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_tperiod_id end as cluster_tperiod_id, case when c.cluster_type = _const.cluster_tcluster_child then c.cluster_namespace end as cluster_namespace, c.cluster_name from cluster.cluster c where c.cluster_type = _const.cluster_tcluster_local or ( c.cluster_identifier = _cluster.cluster_identifier and c.cluster_type = _const.cluster_tcluster_child ) ) select case when _c.cluster_type = _const.cluster_tcluster_master and _c.cluster_name is null then to_jsonb( _c ) - 'cluster_key' || jsonb_build_object( 'cluster_name', 'Main Master (trunc)' ) else to_jsonb( _c ) end from __cluster _c ; end $$; create or replace function load_clusters(args jsonb) returns SETOF jsonb language plpgsql as $$ declare _const map.constant; begin _const := map.constant(); return query with __cluster as ( select c.cluster_uid, c.cluster_identifier, c.cluster_type, c.cluster_code, c.cluster_path, c.cluster_domain, c.cluster_licenselife, c.cluster_license, case when c.cluster_name is null and c.cluster_type = _const.cluster_tcluster_local then 'Local server' else c.cluster_name end as cluster_name, c.cluster_port, c.cluster_api, c.cluster_version, c.cluster_grants, c.cluster_configs, c.cluster_sequence, c.cluster_namespace, tp.* from cluster.cluster c left join cluster.tperiod tp on c.cluster_tperiod_id = tp.tperiod_id ) select to_jsonb( _c ) from __cluster _c order by case when _c.cluster_type = _const.cluster_tcluster_local then 1 when _c.cluster_type = _const.cluster_tcluster_master then 2 when _c.cluster_type = _const.cluster_tcluster_child then 3 when _c.cluster_type = _const.cluster_tcluster_remote then 4 end, _c.cluster_name ; end; $$; create or replace function cluster.define_namespace( args jsonb ) returns lib.res language plpgsql as $$ declare /** args := { cluster_uid: UID cluster_namespace: NAMESPACE } */ _cluster cluster.cluster; _chars character varying[] = regexp_split_to_array( lower( 'ABCDEFGHIJKLMNOPQRSTUVWXYZ-0123456789_'), '' ); _check record; begin _cluster := jsonb_populate_record( _cluster, args ); _cluster.cluster_namespace := lower( _cluster.cluster_namespace ); select string_agg( format( '%I posição %s', c.character, c.ordinality ), ', ' ) characters, count( * ) as count into _check from unnest( regexp_split_to_array( _cluster.cluster_namespace, '' ) ) with ordinality c( character ) where not c = any( _chars); if _check.count > 0 then return lib.res_false( format( 'Namespace está invalido! caracteres: %s', _check.characters ) ); end if; _cluster.cluster_namespace := lib.str_normalize( _cluster.cluster_namespace ); if _cluster.cluster_namespace is null then return lib.res_false( 'Namespace está invalido ou não definido!' ); end if; select ("returning").* into _cluster from lib.sets_up( _cluster, ref := lib.sets_ref(_cluster)); return lib.result_true( jsonb_build_object( 'cluster', _cluster )); end; $$; drop function if exists cluster.switch_remote_connection(); drop function if exists cluster.switch_remote_connection( args jsonb ); create or replace function cluster.switch_remote_connection( args jsonb ) returns lib.res language plpgsql as $$ declare _local cluster.cluster; _result cluster.cluster; begin _local := cluster._get_cluster_local(); _result := jsonb_populate_record( _result, args ); if _local.cluster_namespace is null then return lib.res_true( jsonb_build_object( 'cluster_remote', false, 'cluster_remote_old', false )); end if; update cluster.cluster set cluster_remote = _result.cluster_remote where cluster_uid = _local.cluster_uid returning * into _result; return lib.res_true( jsonb_build_object( 'cluster_remote', _result.cluster_remote, 'cluster_remote_old', _local.cluster_remote )); end; $$;
3f7551aa-6af3-4fbe-8af9-2e0b73279795	\n  create or replace function tweeks.funct_change_venda_preparado( args jsonb )\n  returns lib.res\n  language plpgsql as $$\n    declare\n      /**\n          args := {\n            arg_colaborador_id: UID\n            arg_espaco_auth: UID\n            arg_conta_id: UID\n            arg_vendas: [UID, UID, ..., UID]\n          }\n       */\n      arg_colaborador_id uuid default args->>'arg_colaborador_id';\n      arg_espaco_auth uuid default args->>'arg_espaco_auth';\n      \n      ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n      vendas uuid[] default array( select e.text from jsonb_array_elements_text( args->'arg_vendas' ) e( text) );\n      _const map.constant;\n      updates tweeks.venda[];\n    begin\n      _const := map.constant();\n      with __update as (\n          update tweeks.venda\n            set venda_estadopreparacao = _const.maguita_venda_estadopreparacao_preparado,\n                venda_colaborador_atualizacao = arg_colaborador_id\n            where venda_id = any( vendas )\n              and _branch_uid = ___branch\n              and venda_estado = _const.maguita_venda_estadopreparacao_pendente\n            returning *\n      ) select array_agg( u ) into updates\n          from __update u \n      ;\n      \n      \n      return lib.res_true( jsonb_build_object(\n        'venda', updates\n      ));\n    end;\n  $$\n	create or replace function tweeks.funct_change_venda_preparado( args jsonb ) returns lib.res language plpgsql as $$ declare /** args := { arg_colaborador_id: UID arg_espaco_auth: UID arg_conta_id: UID arg_vendas: [UID, UID, ..., UID] } */ arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); vendas uuid[] default array( select e.text from jsonb_array_elements_text( args->'arg_vendas' ) e( text) ); _const map.constant; updates tweeks.venda[]; begin _const := map.constant(); with __update as ( update tweeks.venda set venda_estadopreparacao = _const.maguita_venda_estadopreparacao_preparado, venda_colaborador_atualizacao = arg_colaborador_id where venda_id = any( vendas ) and _branch_uid = ___branch and venda_estado = _const.maguita_venda_estadopreparacao_pendente returning * ) select array_agg( u ) into updates from __update u ; return lib.res_true( jsonb_build_object( 'venda', updates )); end; $$
4dd0afbe-5818-40e8-a754-142a823fc8fa	\n  select map.constant( 'maguita_lancamento_estado_anulado', 'int2', -1, 'Lançamento anulado' );\n	select map.constant( 'maguita_lancamento_estado_anulado', 'int2', -1, 'Lançamento anulado' );
ef118a92-7e30-43e1-8f19-2aec96507df9	\n  drop table if exists cluster.auth;\n  create table if not exists cluster.auth(\n    auth_uid uuid default gen_random_uuid(),\n    auth_seq serial8 not null,\n    auth_key character varying default lib.dset_random_text( 128 ),\n    auth_cluster_uid uuid,\n    auth_date timestamptz not null default now(),\n    auth_status int2 not null default 1,\n    auth_close timestamptz default null,\n    constraint cluster_auth_uid primary key( auth_uid ),\n    constraint fk_auth_to_cluster foreign key ( auth_cluster_uid ) references cluster.cluster\n  );\n	drop table if exists cluster.auth; create table if not exists cluster.auth( auth_uid uuid default gen_random_uuid(), auth_seq serial8 not null, auth_key character varying default lib.dset_random_text( 128 ), auth_cluster_uid uuid, auth_date timestamptz not null default now(), auth_status int2 not null default 1, auth_close timestamptz default null, constraint cluster_auth_uid primary key( auth_uid ), constraint fk_auth_to_cluster foreign key ( auth_cluster_uid ) references cluster.cluster );
559e8ddf-3783-48d4-8b44-30de5de2a273	\ndrop view if exists report.vreport_caixa;\n\ncreate view report.vreport_caixa as\nwith  _const ( maguita_caixa_estado_fechado, maguita_caixa_estado_ativo ) as (\n  select \n    map.get('maguita_caixa_estado_fechado')::int2,\n    map.get('maguita_caixa_estado_ativo')::int2\n), __report_caixa as (\n  select\n      cx.caixa_id,\n      cx.caixa_code as "CAIXA",\n      cx.caixa_montantefecho as "$ CAP. FEC.",\n      cx.caixa_montantefechoposto "$ CAP. FEC. POS",\n\n      cx.caixa_montanteinicial "$ CAP. INI.",\n      cx.caixa_montanteinicialposto as "$ CAP. INI. POS",\n\n\n      cx.caixa_quantidadecheque as "CHEQUES",\n      cx.caixa_quantidadechequeposto as "CHEQUES POS",\n      cx.caixa_observacao as "OBSERVAÇÃO",\n      cx.caixa_dataregistro as "ABERTURA",\n\n      case\n        when coclose.colaborador_id is not null then cx.caixa_dataatualizacao\n      end as "FECHO",\n    \n      case\n        when cx.caixa_estado = _const.maguita_caixa_estado_fechado then 'FECHADO'\n        when cx.caixa_estado = _const.maguita_caixa_estado_ativo then 'ABERTA'\n      end as "ESTADO CAIXA",\n      pos.posto_designacao as "POSTO",\n      e.espaco_nome as "ARMAZÉM",\n      owner.colaborador_id as colaborador_owner,\n      owner.colaborador_nome as "PROPRIETARIO",\n      coclose.colaborador_id as colaborador_close,\n      coclose.colaborador_nome as "ENCERADOR",\n      opr.colaborador_id as colaborador_operador,\n      opr.colaborador_nome as "OPERADOR",\n      coalesce( ct.conta_titularnif, cli.cliente_titular ) as "TITULAR",\n      coalesce( ct.conta_titularnif, cli.cliente_nif ) as "NIF",\n      de.deposito_documento as "P. RECIBO",\n      tp.tpaga_designacao "P. MODALIDADE",\n      de.deposito_docref "P. DOCUMENTO",\n      cur.currency_code as "P. MOEDA",\n      de.deposito_montantemoeda as "P. $RECEBIDO",\n      de.deposito_taxacambio as "P. $CÂMBIO",\n      de.deposito_montante as "P. $REC. x $CÂM.",\n      de.deposito_montantetroco as "P. $TROCO",\n      de.deposito_montantefinal as "P. $M. FINAL",\n      de.deposito_data as "P. DATA",\n      de.deposito_dataregistro as "ENTRADA",\n\n      cli.cliente_id,\n      pos.posto_id,\n      e.espaco_id,\n      de.deposito_id,\n      cur.currency_id,\n      cx.caixa_estado,\n      tp.tpaga_id,\n      cx._branch_uid\n    from _const\n      inner join tweeks.caixa cx on true\n      inner join tweeks.posto pos on cx.caixa_posto_id = pos.posto_id\n      inner join tweeks.espaco e on pos.posto_espaco_auth = e.espaco_id\n      inner join auth.colaborador owner on cx.caixa_colaborador_id = owner.colaborador_id\n      left join auth.colaborador coclose on cx.caixa_colaborador_atualizacao = coclose.colaborador_id\n        and cx.caixa_estado = _const.maguita_caixa_estado_fechado\n      left join tweeks.deposito de on cx.caixa_id = de.deposito_caixa_id\n      left join tweeks.cliente cli on cli.cliente_id = de.deposito_cliente_id\n      left join tweeks.conta ct on cli.cliente_id = ct.conta_cliente_id\n        and ct.conta_id = (de.deposito_referencia->>'conta_id')::uuid\n        and ct.conta_numerofatura = de.deposito_documento\n      left join auth.colaborador opr on de.deposito_colaborador_id = opr.colaborador_id\n      left join geoinfo.currency cur on de.deposito_currency_id = cur.currency_id\n      left join tweeks.tpaga tp on de.deposito_tpaga_id = tp.tpaga_id\n) select *\n   from __report_caixa;\n\nselect * from report.sync( 'report.vreport_caixa', 'RELATÓRIO DE CAIXA', 1600 );\n\nUPDATE report.vcolumn SET position = 3000, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'CAIXA';\nUPDATE report.vcolumn SET position = 990, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'ARMAZÉM';\nUPDATE report.vcolumn SET position = 980, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'POSTO';\nUPDATE report.vcolumn SET position = 960, show = true, init = false, format = 'timestamp', filter = '[["query.range|start", {"name": "ABERTURA INICIO"}], ["query.range|end", {"name": "ABERTURA FIM"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_caixa' AND name = 'ABERTURA';\nUPDATE report.vcolumn SET position = 599, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = '$ CAP. INI.';\nUPDATE report.vcolumn SET position = 598, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = '$ CAP. INI. POS';\nUPDATE report.vcolumn SET position = 589, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = '$ CAP. FEC.';\nUPDATE report.vcolumn SET position = 588, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = '$ CAP. FEC. POS';\nUPDATE report.vcolumn SET position = 579, show = true, init = false, format = 'int', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_caixa' AND name = 'CHEQUES';\nUPDATE report.vcolumn SET position = 578, show = true, init = false, format = 'int', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_caixa' AND name = 'CHEQUES POS';\nUPDATE report.vcolumn SET position = 309, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'TITULAR';\nUPDATE report.vcolumn SET position = 308, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'NIF';\nUPDATE report.vcolumn SET position = 299, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'P. MODALIDADE';\nUPDATE report.vcolumn SET position = 299, show = true, init = true, format = 'code:long', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'P. RECIBO';\nUPDATE report.vcolumn SET position = 299, show = true, init = false, format = 'date', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_caixa' AND name = 'P. DATA';\nUPDATE report.vcolumn SET position = 299, show = true, init = false, format = 'code:long', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'P. DOCUMENTO';\nUPDATE report.vcolumn SET position = 258, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = 'P. $RECEBIDO';\nUPDATE report.vcolumn SET position = 257, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'P. MOEDA';\nUPDATE report.vcolumn SET position = 256, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = 'P. $CÂMBIO';\nUPDATE report.vcolumn SET position = 255, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = 'P. $REC. x $CÂM.';\nUPDATE report.vcolumn SET position = 254, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = 'P. $TROCO';\nUPDATE report.vcolumn SET position = 253, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = 'P. $M. FINAL';\nUPDATE report.vcolumn SET position = 197, show = true, init = true, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'OPERADOR';\nUPDATE report.vcolumn SET position = 196, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'PROPRIETARIO';\nUPDATE report.vcolumn SET position = 195, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'ENCERADOR';\nUPDATE report.vcolumn SET position = 194, show = true, init = true, format = 'timestamp', filter = '[["query.range|start", {"name": "ENTRADA INICIO"}], ["query.range|end", {"name": "ENTRADA FIM"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_caixa' AND name = 'ENTRADA';\nUPDATE report.vcolumn SET position = 193, show = true, init = false, format = 'timestamp', filter = '[["query.range|start", {"name": "FECHO INICIO"}], ["query.range|end", {"name": "FECHO FIM"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_caixa' AND name = 'FECHO';\nUPDATE report.vcolumn SET position = null, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_caixa' AND name = 'ESTADO CAIXA';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'text', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'OBSERVAÇÃO';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL PAGAMENTOS", "rename": "??COUNT::DISTINCT TOTAL PAGAMENTOS"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'deposito_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[["query.source|tweeks.caixa::estado", {"name": "ESTADO DA CAIXA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_caixa' AND name = 'caixa_estado';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|auth.colaborador", {"name": "ENCERADOR"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'colaborador_close';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|auth.colaborador", {"name": "OPERADOR"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'colaborador_operador';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|auth.colaborador", {"name": "PROPRIETARIO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'colaborador_owner';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|geoinfo.currency", {"name": "MOEDA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_caixa' AND name = 'currency_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.espaco", {"name": "ARMAZÉM"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'espaco_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.posto", {"name": "POSTO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'posto_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tpaga", {"name": "MODALIDADE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_caixa' AND name = 'tpaga_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = '_branch_uid';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'caixa_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'cliente_id';\n\n\n\nselect *\n  from report.vcolumn\n  where source = 'report.vreport_caixa'\n  order by position desc nulls last,\n  show desc nulls last,\n  init desc nulls last,\n  jsonb_array_length( agg ) desc,\n  jsonb_array_length( filter ) desc,\n  source,\n  name\n;\n\n	drop view if exists report.vreport_caixa; create view report.vreport_caixa as with _const ( maguita_caixa_estado_fechado, maguita_caixa_estado_ativo ) as ( select map.get('maguita_caixa_estado_fechado')::int2, map.get('maguita_caixa_estado_ativo')::int2 ), __report_caixa as ( select cx.caixa_id, cx.caixa_code as "CAIXA", cx.caixa_montantefecho as "$ CAP. FEC.", cx.caixa_montantefechoposto "$ CAP. FEC. POS", cx.caixa_montanteinicial "$ CAP. INI.", cx.caixa_montanteinicialposto as "$ CAP. INI. POS", cx.caixa_quantidadecheque as "CHEQUES", cx.caixa_quantidadechequeposto as "CHEQUES POS", cx.caixa_observacao as "OBSERVAÇÃO", cx.caixa_dataregistro as "ABERTURA", case when coclose.colaborador_id is not null then cx.caixa_dataatualizacao end as "FECHO", case when cx.caixa_estado = _const.maguita_caixa_estado_fechado then 'FECHADO' when cx.caixa_estado = _const.maguita_caixa_estado_ativo then 'ABERTA' end as "ESTADO CAIXA", pos.posto_designacao as "POSTO", e.espaco_nome as "ARMAZÉM", owner.colaborador_id as colaborador_owner, owner.colaborador_nome as "PROPRIETARIO", coclose.colaborador_id as colaborador_close, coclose.colaborador_nome as "ENCERADOR", opr.colaborador_id as colaborador_operador, opr.colaborador_nome as "OPERADOR", coalesce( ct.conta_titularnif, cli.cliente_titular ) as "TITULAR", coalesce( ct.conta_titularnif, cli.cliente_nif ) as "NIF", de.deposito_documento as "P. RECIBO", tp.tpaga_designacao "P. MODALIDADE", de.deposito_docref "P. DOCUMENTO", cur.currency_code as "P. MOEDA", de.deposito_montantemoeda as "P. $RECEBIDO", de.deposito_taxacambio as "P. $CÂMBIO", de.deposito_montante as "P. $REC. x $CÂM.", de.deposito_montantetroco as "P. $TROCO", de.deposito_montantefinal as "P. $M. FINAL", de.deposito_data as "P. DATA", de.deposito_dataregistro as "ENTRADA", cli.cliente_id, pos.posto_id, e.espaco_id, de.deposito_id, cur.currency_id, cx.caixa_estado, tp.tpaga_id, cx._branch_uid from _const inner join tweeks.caixa cx on true inner join tweeks.posto pos on cx.caixa_posto_id = pos.posto_id inner join tweeks.espaco e on pos.posto_espaco_auth = e.espaco_id inner join auth.colaborador owner on cx.caixa_colaborador_id = owner.colaborador_id left join auth.colaborador coclose on cx.caixa_colaborador_atualizacao = coclose.colaborador_id and cx.caixa_estado = _const.maguita_caixa_estado_fechado left join tweeks.deposito de on cx.caixa_id = de.deposito_caixa_id left join tweeks.cliente cli on cli.cliente_id = de.deposito_cliente_id left join tweeks.conta ct on cli.cliente_id = ct.conta_cliente_id and ct.conta_id = (de.deposito_referencia->>'conta_id')::uuid and ct.conta_numerofatura = de.deposito_documento left join auth.colaborador opr on de.deposito_colaborador_id = opr.colaborador_id left join geoinfo.currency cur on de.deposito_currency_id = cur.currency_id left join tweeks.tpaga tp on de.deposito_tpaga_id = tp.tpaga_id ) select * from __report_caixa; select * from report.sync( 'report.vreport_caixa', 'RELATÓRIO DE CAIXA', 1600 ); UPDATE report.vcolumn SET position = 3000, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'CAIXA'; UPDATE report.vcolumn SET position = 990, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'ARMAZÉM'; UPDATE report.vcolumn SET position = 980, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'POSTO'; UPDATE report.vcolumn SET position = 960, show = true, init = false, format = 'timestamp', filter = '[["query.range|start", {"name": "ABERTURA INICIO"}], ["query.range|end", {"name": "ABERTURA FIM"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_caixa' AND name = 'ABERTURA'; UPDATE report.vcolumn SET position = 599, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = '$ CAP. INI.'; UPDATE report.vcolumn SET position = 598, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = '$ CAP. INI. POS'; UPDATE report.vcolumn SET position = 589, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = '$ CAP. FEC.'; UPDATE report.vcolumn SET position = 588, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = '$ CAP. FEC. POS'; UPDATE report.vcolumn SET position = 579, show = true, init = false, format = 'int', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_caixa' AND name = 'CHEQUES'; UPDATE report.vcolumn SET position = 578, show = true, init = false, format = 'int', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_caixa' AND name = 'CHEQUES POS'; UPDATE report.vcolumn SET position = 309, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'TITULAR'; UPDATE report.vcolumn SET position = 308, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'NIF'; UPDATE report.vcolumn SET position = 299, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'P. MODALIDADE'; UPDATE report.vcolumn SET position = 299, show = true, init = true, format = 'code:long', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'P. RECIBO'; UPDATE report.vcolumn SET position = 299, show = true, init = false, format = 'date', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_caixa' AND name = 'P. DATA'; UPDATE report.vcolumn SET position = 299, show = true, init = false, format = 'code:long', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'P. DOCUMENTO'; UPDATE report.vcolumn SET position = 258, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = 'P. $RECEBIDO'; UPDATE report.vcolumn SET position = 257, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'P. MOEDA'; UPDATE report.vcolumn SET position = 256, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = 'P. $CÂMBIO'; UPDATE report.vcolumn SET position = 255, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = 'P. $REC. x $CÂM.'; UPDATE report.vcolumn SET position = 254, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = 'P. $TROCO'; UPDATE report.vcolumn SET position = 253, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_caixa' AND name = 'P. $M. FINAL'; UPDATE report.vcolumn SET position = 197, show = true, init = true, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'OPERADOR'; UPDATE report.vcolumn SET position = 196, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'PROPRIETARIO'; UPDATE report.vcolumn SET position = 195, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'ENCERADOR'; UPDATE report.vcolumn SET position = 194, show = true, init = true, format = 'timestamp', filter = '[["query.range|start", {"name": "ENTRADA INICIO"}], ["query.range|end", {"name": "ENTRADA FIM"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_caixa' AND name = 'ENTRADA'; UPDATE report.vcolumn SET position = 193, show = true, init = false, format = 'timestamp', filter = '[["query.range|start", {"name": "FECHO INICIO"}], ["query.range|end", {"name": "FECHO FIM"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_caixa' AND name = 'FECHO'; UPDATE report.vcolumn SET position = null, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_caixa' AND name = 'ESTADO CAIXA'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'text', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_caixa' AND name = 'OBSERVAÇÃO'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL PAGAMENTOS", "rename": "??COUNT::DISTINCT TOTAL PAGAMENTOS"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'deposito_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[["query.source|tweeks.caixa::estado", {"name": "ESTADO DA CAIXA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_caixa' AND name = 'caixa_estado'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|auth.colaborador", {"name": "ENCERADOR"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'colaborador_close'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|auth.colaborador", {"name": "OPERADOR"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'colaborador_operador'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|auth.colaborador", {"name": "PROPRIETARIO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'colaborador_owner'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|geoinfo.currency", {"name": "MOEDA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_caixa' AND name = 'currency_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.espaco", {"name": "ARMAZÉM"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'espaco_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.posto", {"name": "POSTO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'posto_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tpaga", {"name": "MODALIDADE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_caixa' AND name = 'tpaga_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = '_branch_uid'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'caixa_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_caixa' AND name = 'cliente_id'; select * from report.vcolumn where source = 'report.vreport_caixa' order by position desc nulls last, show desc nulls last, init desc nulls last, jsonb_array_length( agg ) desc, jsonb_array_length( filter ) desc, source, name ;
8e3dbd4d-fadc-49ed-bffd-a9ed8b1afe63	\n  create or replace function tweeks.funct_load_serie_available( args jsonb )\n  returns setof jsonb\n  language plpgsql as $$\n    declare\n      /**\n        args := {\n          arg_espaco_auth:UUID\n          arg_colaborado_id:UUID\n        }\n       */\n        arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n        arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n        ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n        _const map.constant;\n    begin\n\n      _const := map.constant();\n\n      -- Obter o espaço superior que pode gerar numero de seire\n      return query\n        with recursive __recursive_espaco as (\n          select e.espaco_id as _espaco,\n               e.*,\n               ts.tserie_id, ts.tserie_desc, ts.tserie_code,\n               s.serie_id, s.serie_numero, s.serie_numatorizacao, s.serie_numcertificacao\n            from tweeks.espaco e\n               full join tweeks.tserie ts on true\n               left join tweeks.serie s on e.espaco_id = s.serie_espaco_id\n                and s.serie_tserie_id = ts.tserie_id\n                and s.serie_estado = _const.maguita_serie_estado_ativo\n                and s._branch_uid = ___branch\n            where e.espaco_id = arg_espaco_auth\n              and e._branch_uid = ___branch\n            \n            union all\n            select _re._espaco, e.*,\n                   _re.tserie_id, _re.tserie_desc, _re.tserie_code,\n                   s.serie_id, s.serie_numero, s.serie_numatorizacao, s.serie_numcertificacao\n            from __recursive_espaco _re\n              inner join tweeks.espaco e on _re.espaco_espaco_id = e.espaco_id\n                and not _re.espaco_gerarfatura\n              inner join tweeks.serie s on e.espaco_id = s.serie_espaco_id\n                and _re.tserie_id = s.serie_tserie_id\n              and s.serie_tserie_id = _re.tserie_id\n              and s.serie_estado = _const.maguita_serie_estado_ativo\n              and s._branch_uid = ___branch\n            where e._branch_uid = ___branch\n        ), __serie_espaco as (\n          select\n                _re._espaco as espaco_id,\n                _re.espaco_id as espaco_serie,\n                _re.espaco_nivel,\n                _re.espaco_codigo,\n                _re.espaco_nome,\n                _re.tserie_id,\n                _re.tserie_desc,\n                _re.tserie_code,\n                _re.serie_id,\n                _re.serie_numcertificacao,\n                _re.serie_numatorizacao,\n                _re.serie_numero\n            from __recursive_espaco  _re\n            where _re.serie_id is not null\n      ) select to_jsonb( _se )\n          from __serie_espaco _se\n      ;\n      \n    end;\n  $$;\n	create or replace function tweeks.funct_load_serie_available( args jsonb ) returns setof jsonb language plpgsql as $$ declare /** args := { arg_espaco_auth:UUID arg_colaborado_id:UUID } */ arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _const map.constant; begin _const := map.constant(); -- Obter o espaço superior que pode gerar numero de seire return query with recursive __recursive_espaco as ( select e.espaco_id as _espaco, e.*, ts.tserie_id, ts.tserie_desc, ts.tserie_code, s.serie_id, s.serie_numero, s.serie_numatorizacao, s.serie_numcertificacao from tweeks.espaco e full join tweeks.tserie ts on true left join tweeks.serie s on e.espaco_id = s.serie_espaco_id and s.serie_tserie_id = ts.tserie_id and s.serie_estado = _const.maguita_serie_estado_ativo and s._branch_uid = ___branch where e.espaco_id = arg_espaco_auth and e._branch_uid = ___branch union all select _re._espaco, e.*, _re.tserie_id, _re.tserie_desc, _re.tserie_code, s.serie_id, s.serie_numero, s.serie_numatorizacao, s.serie_numcertificacao from __recursive_espaco _re inner join tweeks.espaco e on _re.espaco_espaco_id = e.espaco_id and not _re.espaco_gerarfatura inner join tweeks.serie s on e.espaco_id = s.serie_espaco_id and _re.tserie_id = s.serie_tserie_id and s.serie_tserie_id = _re.tserie_id and s.serie_estado = _const.maguita_serie_estado_ativo and s._branch_uid = ___branch where e._branch_uid = ___branch ), __serie_espaco as ( select _re._espaco as espaco_id, _re.espaco_id as espaco_serie, _re.espaco_nivel, _re.espaco_codigo, _re.espaco_nome, _re.tserie_id, _re.tserie_desc, _re.tserie_code, _re.serie_id, _re.serie_numcertificacao, _re.serie_numatorizacao, _re.serie_numero from __recursive_espaco _re where _re.serie_id is not null ) select to_jsonb( _se ) from __serie_espaco _se ; end; $$;
64149275-6b3b-4c4d-821f-5a61b50e3b5f	\ndrop table if exists cluster.source;\ncreate table cluster.source (\n  source_uid         uuid               not null\n    constraint pk_source_id\n      primary key,\n  source_cluster_uid uuid\n    constraint fk_spurce_to_cluster\n      references cluster.cluster,\n  source_branch_uid  uuid\n    constraint fk_source_to_branch\n      references cluster.branch,\n  source_name        varchar,\n  source_client          boolean,\n  source_server         boolean,\n  source_status      smallint default 1 not null,\n  constraint uk_source_cluster_branch\n    unique (source_cluster_uid, source_branch_uid)\n);\n\nalter table source\n  owner to maguita_dev;\n\n\n	drop table if exists cluster.source; create table cluster.source ( source_uid uuid not null constraint pk_source_id primary key, source_cluster_uid uuid constraint fk_spurce_to_cluster references cluster.cluster, source_branch_uid uuid constraint fk_source_to_branch references cluster.branch, source_name varchar, source_client boolean, source_server boolean, source_status smallint default 1 not null, constraint uk_source_cluster_branch unique (source_cluster_uid, source_branch_uid) ); alter table source owner to maguita_dev;
a10562ec-4fbe-48a1-93dc-3629819d2bb5	\n  create table cluster.source(\n    source_uid uuid,\n    source_cluster_uid uuid,\n    source_branch_uid uuid,\n    source_name character varying,\n    source_in boolean,\n    source_out boolean,\n    source_status int2 not null default 1,\n    constraint pk_source_id primary key ( source_uid ),\n    constraint uk_source_cluster_branch unique ( source_cluster_uid, source_branch_uid ),\n    constraint fk_source_to_branch foreign key ( source_branch_uid ) references cluster.branch,\n    constraint fk_spurce_to_cluster foreign key ( source_cluster_uid ) references cluster.cluster\n  )\n	create table cluster.source( source_uid uuid, source_cluster_uid uuid, source_branch_uid uuid, source_name character varying, source_in boolean, source_out boolean, source_status int2 not null default 1, constraint pk_source_id primary key ( source_uid ), constraint uk_source_cluster_branch unique ( source_cluster_uid, source_branch_uid ), constraint fk_source_to_branch foreign key ( source_branch_uid ) references cluster.branch, constraint fk_spurce_to_cluster foreign key ( source_cluster_uid ) references cluster.cluster )
9e577b3f-b7a9-4d81-a5b1-be515433941a	\n  create or replace function cluster.sets_cluster_local_private_key( args jsonb ) \n  returns lib.res language plpgsql as $$\n  declare\n    _local cluster.cluster;\n  begin\n    _local := cluster._get_cluster_local();\n    _local.cluster_private := args->>'cluster_private';\n    select (up."returning").* into _local\n      from lib.sets_up( _local ) up\n    ;\n    return lib.res_true( jsonb_build_object(\n      'cluster', _local\n    ));\n  end;\n  $$;\n\n  create or replace function cluster.load_local_branch() \n  returns setof jsonb\n  language plpgsql as $$\n    declare\n      _local cluster.cluster;\n      _const map.constant;\n    begin\n      _local := cluster._get_cluster_local();\n      _const := map.constant();\n      \n      return query \n        with __branch as (\n          select b.*\n            from cluster.source s\n              inner join cluster.branch b on s.source_branch_uid = b.branch_uid\n            where s.source_cluster_uid = _local.cluster_uid\n              and s.source_status = 1\n        ) select to_jsonb( b )\n            from __branch b\n      ;\n    end;\n  $$;\n\n  create or replace function cluster.sets_sources_list( args jsonb ) \n  returns setof jsonb\n  language plpgsql as $$\n    declare\n      /**\n        args := {\n          sources:cluster.cluster&cluster.branch & cluster.source\n        }\n       */\n      _record record;\n      _cluster cluster.cluster;\n      _branch cluster.branch;\n      _source cluster.source;\n      _const map.constant;\n    begin\n      _const := map.constant();\n      \n      for _record in\n        with __sources as (\n            select \n                e.doc,\n                jsonb_populate_record( null::cluster.cluster, e.doc ) as cluster,   \n                jsonb_populate_record( null::cluster.branch, e.doc ) as branch,   \n                jsonb_populate_record( null::cluster.source, e.doc ) as source   \n              from jsonb_array_elements( args->'sources' ) e( doc )\n        ) select\n              *,\n             (s.cluster).*,\n             (s.branch).*,\n             (s.source).*\n           from __sources s\n      loop\n        \n        _cluster := _record.cluster;\n        _cluster.cluster_type = _const.cluster_tcluster_remote;\n        _cluster.cluster_uid := (cluster._get_cluster( _record.cluster_identifier )).cluster_uid;\n        \n        select ( "returning" ).* into _cluster\n          from lib.sets( _cluster )\n        ;\n        \n        select ( "returning" ).* into _branch\n          from lib.sets( _record.branch )\n        ;\n        \n        _source := _record.source;\n        _source.source_cluster_uid := _cluster.cluster_uid;\n        _source.source_branch_uid := _branch.branch_uid;\n        \n        select ( "returning" ).* into _source\n          from lib.sets( _source );\n        return next to_jsonb( _source )|| to_jsonb( _branch ) || to_jsonb( _cluster );\n      end loop;\n    end;\n  $$;\n	create or replace function cluster.sets_cluster_local_private_key( args jsonb ) returns lib.res language plpgsql as $$ declare _local cluster.cluster; begin _local := cluster._get_cluster_local(); _local.cluster_private := args->>'cluster_private'; select (up."returning").* into _local from lib.sets_up( _local ) up ; return lib.res_true( jsonb_build_object( 'cluster', _local )); end; $$; create or replace function cluster.load_local_branch() returns setof jsonb language plpgsql as $$ declare _local cluster.cluster; _const map.constant; begin _local := cluster._get_cluster_local(); _const := map.constant(); return query with __branch as ( select b.* from cluster.source s inner join cluster.branch b on s.source_branch_uid = b.branch_uid where s.source_cluster_uid = _local.cluster_uid and s.source_status = 1 ) select to_jsonb( b ) from __branch b ; end; $$; create or replace function cluster.sets_sources_list( args jsonb ) returns setof jsonb language plpgsql as $$ declare /** args := { sources:cluster.cluster&cluster.branch & cluster.source } */ _record record; _cluster cluster.cluster; _branch cluster.branch; _source cluster.source; _const map.constant; begin _const := map.constant(); for _record in with __sources as ( select e.doc, jsonb_populate_record( null::cluster.cluster, e.doc ) as cluster, jsonb_populate_record( null::cluster.branch, e.doc ) as branch, jsonb_populate_record( null::cluster.source, e.doc ) as source from jsonb_array_elements( args->'sources' ) e( doc ) ) select *, (s.cluster).*, (s.branch).*, (s.source).* from __sources s loop _cluster := _record.cluster; _cluster.cluster_type = _const.cluster_tcluster_remote; _cluster.cluster_uid := (cluster._get_cluster( _record.cluster_identifier )).cluster_uid; select ( "returning" ).* into _cluster from lib.sets( _cluster ) ; select ( "returning" ).* into _branch from lib.sets( _record.branch ) ; _source := _record.source; _source.source_cluster_uid := _cluster.cluster_uid; _source.source_branch_uid := _branch.branch_uid; select ( "returning" ).* into _source from lib.sets( _source ); return next to_jsonb( _source )|| to_jsonb( _branch ) || to_jsonb( _cluster ); end loop; end; $$;
5b2aaa7d-6177-4363-9809-465f06d6b825	\n  alter table tweeks.branch set schema cluster;\n  create view tweeks.branch as select * from cluster.branch;\n	alter table tweeks.branch set schema cluster; create view tweeks.branch as select * from cluster.branch;
79b7ea90-09e6-484c-b4e6-a43e2a1a9445	\ncreate or replace function cluster.funct_load_configs()\n  returns jsonb language plpgsql as $$\n  declare\n    _local cluster.cluster;\n    _master cluster.cluster;\n    _branch record;\n    _source record;\n  begin\n    _local := cluster._get_cluster_local();\n    _master := cluster._get_cluster_master();\n    \n    select \n        array_agg( b.branch_uid ) as branch_uid,\n        array_agg( b ) as branch\n        into _branch\n      from cluster.branch b\n        inner join source s2 on b.branch_uid = s2.source_branch_uid\n      where s2.source_cluster_uid = _local.cluster_uid\n    ;\n    \n    select \n        array_agg( s.source_uid ) as source_uid,\n        array_agg( s ) as source\n        into _source\n      from cluster.source s\n        inner join cluster c on s.source_cluster_uid = c.cluster_uid\n      where s.source_branch_uid = any ( _branch.branch_uid )\n    ;\n    \n    return jsonb_build_object(\n      'local', _local,\n      'master', _master,\n      'branch', _branch.branch, \n      'branch_uid', _branch.branch_uid, \n      'sources', _source.source,\n      'sources_uid', _source.source_uid\n    );\n  end;\n  $$\n	create or replace function cluster.funct_load_configs() returns jsonb language plpgsql as $$ declare _local cluster.cluster; _master cluster.cluster; _branch record; _source record; begin _local := cluster._get_cluster_local(); _master := cluster._get_cluster_master(); select array_agg( b.branch_uid ) as branch_uid, array_agg( b ) as branch into _branch from cluster.branch b inner join source s2 on b.branch_uid = s2.source_branch_uid where s2.source_cluster_uid = _local.cluster_uid ; select array_agg( s.source_uid ) as source_uid, array_agg( s ) as source into _source from cluster.source s inner join cluster c on s.source_cluster_uid = c.cluster_uid where s.source_branch_uid = any ( _branch.branch_uid ) ; return jsonb_build_object( 'local', _local, 'master', _master, 'branch', _branch.branch, 'branch_uid', _branch.branch_uid, 'sources', _source.source, 'sources_uid', _source.source_uid ); end; $$
4e8f44e0-3e0b-41bf-b672-e0d108650bc9	\n  select map.constant( 'cluster_auth_status_active', 'int2', 1 );\n  select map.constant( 'cluster_auth_status_close', 'int2', 0 );\n	select map.constant( 'cluster_auth_status_active', 'int2', 1 ); select map.constant( 'cluster_auth_status_close', 'int2', 0 );
42a21728-588a-409c-baa1-99afe1b87c02	\n    create function cluster.status(args jsonb) returns SETOF jsonb\n      language plpgsql\n    as\n    $$\n    declare\n      /**\n        PROPOSE: Devolver o atual estado do cluster cluster local, isso é até onde o atual custer conhecer os outros\n    \n        args:={\n            cluster_identifier:strint\n        }\n    \n        return ({\n          cluster:[{\n            cluster_identifier: CID,\n            cluster_version: VN\n            cluster_sequence\n          }],\n          versions:[{\n            cluster_identifier: CID,\n            share_regclass: SRC,\n            version_number: VN,\n          }],\n          creq:?{\n            cluster_version: VN\n            cluster_sequence,\n            versions: [{\n              share_regclass: SRC,\n              version_number: VN,\n            }]\n          }\n        })\n     */\n      _cluster_identifier character varying default args->>'cluster_identifier';\n      _cluster cluster.cluster;\n      _local cluster.cluster;\n      _data record;\n    begin\n    \n      _cluster := cluster._get_cluster( _cluster_identifier );\n      _local := cluster._get_cluster_local(  );\n      \n      select array_agg( s.source_branch_uid ) as _branch_uid  into _data\n        from cluster.source s\n        where s.source_cluster_uid = _cluster.cluster_uid\n      ;\n    \n      return query with\n          __clusters as (\n            select\n                c.cluster_identifier,\n                c.cluster_name,\n                c.cluster_path,\n                c.cluster_version,\n                c.cluster_sequence,\n                c.cluster_verbose\n              from cluster.cluster c\n                inner join cluster.source s  on c.cluster_uid = source.source_cluster_uid\n                  and ( s.source_branch_uid = any( _data._branch_uid ) or c.cluster_uid = _local.cluster_uid )\n              group by c.cluster_uid\n          ) select to_jsonb( array_agg( c ) )\n          from __clusters c\n      ;\n    end;\n    $$;\n	create function cluster.status(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** PROPOSE: Devolver o atual estado do cluster cluster local, isso é até onde o atual custer conhecer os outros args:={ cluster_identifier:strint } return ({ cluster:[{ cluster_identifier: CID, cluster_version: VN cluster_sequence }], versions:[{ cluster_identifier: CID, share_regclass: SRC, version_number: VN, }], creq:?{ cluster_version: VN cluster_sequence, versions: [{ share_regclass: SRC, version_number: VN, }] } }) */ _cluster_identifier character varying default args->>'cluster_identifier'; _cluster cluster.cluster; _local cluster.cluster; _data record; begin _cluster := cluster._get_cluster( _cluster_identifier ); _local := cluster._get_cluster_local( ); select array_agg( s.source_branch_uid ) as _branch_uid into _data from cluster.source s where s.source_cluster_uid = _cluster.cluster_uid ; return query with __clusters as ( select c.cluster_identifier, c.cluster_name, c.cluster_path, c.cluster_version, c.cluster_sequence, c.cluster_verbose from cluster.cluster c inner join cluster.source s on c.cluster_uid = source.source_cluster_uid and ( s.source_branch_uid = any( _data._branch_uid ) or c.cluster_uid = _local.cluster_uid ) group by c.cluster_uid ) select to_jsonb( array_agg( c ) ) from __clusters c ; end; $$;
f13fc6ec-b933-4392-8cab-88038a966406	\ncreate or replace function tweeks.funct_load_artigo_base(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    arg_espaco_auth: UID\n    arg_colaborador_id: UID\n    arg_artigo_composto: UID\n\n    arg_classe_id: ID\n        arg_artigo_estado: ARTIGO_ESTADO\n        query: {\n          any?: CODE|NAME|DESCRICAO\n          code?: CODE\n          name?: NAME\n          desc?: DESCRICAO\n        }\n   */\n  arg_espaco_auth uuid default args->>'arg_espaco_auth';\n  arg_colaborador_id uuid default args->>'arg_colaborador_id';\n  arg_artigo_composto uuid default args->>'arg_artigo_composto';\n\n  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  _artigo tweeks.artigo;\n  _result record;\nbegin\n  _artigo := tweeks._get_artigo( arg_artigo_composto );\n\n  with recursive __artigos as (\n    select\n        art.artigo_id,\n        art.artigo_nome,\n        art.artigo_artigo_id,\n        array[ art.artigo_id ]::uuid[] as path\n      from tweeks.artigo art\n      where art._branch_uid = ___branch\n        and art.artigo_artigo_id is null\n    union all\n      select\n          es.artigo_id,\n          es.artigo_nome,\n          es.artigo_artigo_id,\n          _e.path || es.artigo_id\n        from __artigos _e\n          inner join tweeks.artigo es on _e.artigo_id = es.artigo_artigo_id\n        where es._branch_uid = ___branch\n  ) select array_agg( _art.artigo_id ) as artigos into _result\n      from __artigos _art\n      where  arg_artigo_composto is null or (\n          arg_artigo_composto != all( _art.path )\n        and _art.artigo_id != coalesce( _artigo.artigo_artigo_id, _artigo.artigo_id )\n        and _art.artigo_id != _artigo.artigo_id\n      )\n  ;\n  \n  return query\n    select e.document\n      from tweeks.funct_load_artigo( args ) e( document )\n      where (e.document->>'artigo_id')::uuid = any( _result.artigos )\n  ;\nend;\n$$;\n	create or replace function tweeks.funct_load_artigo_base(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** arg_espaco_auth: UID arg_colaborador_id: UID arg_artigo_composto: UID arg_classe_id: ID arg_artigo_estado: ARTIGO_ESTADO query: { any?: CODE|NAME|DESCRICAO code?: CODE name?: NAME desc?: DESCRICAO } */ arg_espaco_auth uuid default args->>'arg_espaco_auth'; arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_artigo_composto uuid default args->>'arg_artigo_composto'; ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _artigo tweeks.artigo; _result record; begin _artigo := tweeks._get_artigo( arg_artigo_composto ); with recursive __artigos as ( select art.artigo_id, art.artigo_nome, art.artigo_artigo_id, array[ art.artigo_id ]::uuid[] as path from tweeks.artigo art where art._branch_uid = ___branch and art.artigo_artigo_id is null union all select es.artigo_id, es.artigo_nome, es.artigo_artigo_id, _e.path || es.artigo_id from __artigos _e inner join tweeks.artigo es on _e.artigo_id = es.artigo_artigo_id where es._branch_uid = ___branch ) select array_agg( _art.artigo_id ) as artigos into _result from __artigos _art where arg_artigo_composto is null or ( arg_artigo_composto != all( _art.path ) and _art.artigo_id != coalesce( _artigo.artigo_artigo_id, _artigo.artigo_id ) and _art.artigo_id != _artigo.artigo_id ) ; return query select e.document from tweeks.funct_load_artigo( args ) e( document ) where (e.document->>'artigo_id')::uuid = any( _result.artigos ) ; end; $$;
d298085c-4cdd-4a18-9511-89b936071c5c	\ncreate or replace function tweeks.funct_pos_reg_retalho(args jsonb) returns lib.res\n  language plpgsql\nas\n$$\ndeclare\n  /*\n   args := {\n      arg_colaborador_id,\n      arg_espaco_auth,\n\n      retalho_artigo_composto\n      retalho_artigo_base\n      retalho_composicao\n      retalho_quantidade\n   }\n   */\n    arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n    arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n    \n    _artigo_base tweeks.artigo;\n    _artigo_composto tweeks.artigo;\n    _retalho tweeks.retalho;\n    ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n    __stock record;\nbegin\n    _retalho := jsonb_populate_record( _retalho, args );\n    _artigo_base := tweeks._get_artigo( _retalho.retalho_artigo_base );\n    _artigo_composto := tweeks._get_artigo( _retalho.retalho_artigo_composto );\n    \n    if _artigo_composto.artigo_artigo_id is null or _artigo_composto.artigo_compostoquantidade is null then\n      return lib.res_false( 'O artigo selecionano para retalhar não é um artigo composto!' );\n    end if;\n    \n    __stock := tweeks._get_stock( _retalho.retalho_artigo_composto, arg_espaco_auth );\n    \n    if __stock.stock_quantidade < _retalho.retalho_quantidade\n        and not _artigo_composto.artigo_stocknegativo\n    then\n      return lib.res_false( 'Quantidade do artigo composto no armazem atual não é suficiente para retalhar!');\n    end if;\n    \n    _retalho.retalho_codigo = tweeks.__generate_retalho_code( ___branch );\n    _retalho.retalho_colaborador_id := arg_colaborador_id;\n    _retalho.retalho_espaco_auth := arg_espaco_auth;\n    \n    select ( "returning" ).* into _retalho\n      from lib.sets( _retalho );\n    \n    return lib.res_true(jsonb_build_object(\n        'retalho', _retalho\n    ));\nend;\n$$;  \n	create or replace function tweeks.funct_pos_reg_retalho(args jsonb) returns lib.res language plpgsql as $$ declare /* args := { arg_colaborador_id, arg_espaco_auth, retalho_artigo_composto retalho_artigo_base retalho_composicao retalho_quantidade } */ arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; _artigo_base tweeks.artigo; _artigo_composto tweeks.artigo; _retalho tweeks.retalho; ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); __stock record; begin _retalho := jsonb_populate_record( _retalho, args ); _artigo_base := tweeks._get_artigo( _retalho.retalho_artigo_base ); _artigo_composto := tweeks._get_artigo( _retalho.retalho_artigo_composto ); if _artigo_composto.artigo_artigo_id is null or _artigo_composto.artigo_compostoquantidade is null then return lib.res_false( 'O artigo selecionano para retalhar não é um artigo composto!' ); end if; __stock := tweeks._get_stock( _retalho.retalho_artigo_composto, arg_espaco_auth ); if __stock.stock_quantidade < _retalho.retalho_quantidade and not _artigo_composto.artigo_stocknegativo then return lib.res_false( 'Quantidade do artigo composto no armazem atual não é suficiente para retalhar!'); end if; _retalho.retalho_codigo = tweeks.__generate_retalho_code( ___branch ); _retalho.retalho_colaborador_id := arg_colaborador_id; _retalho.retalho_espaco_auth := arg_espaco_auth; select ( "returning" ).* into _retalho from lib.sets( _retalho ); return lib.res_true(jsonb_build_object( 'retalho', _retalho )); end; $$;
260aa376-6f75-40c9-a1a0-189f8b8f7a09	\ncreate or replace function tweeks.__generate_fornecedor_code( _branch uuid )\n  returns text\n  language plpgsql as $$\ndeclare\n  __fornecedor_code text;\nbegin\n  while __fornecedor_code is null loop\n      __fornecedor_code := cluster.next( 'fornecedor/seq', lpad := 2, lpad_char := '0', sub :=  _branch::text );\n      if exists(\n          select *\n          from tweeks.fornecedor f\n          where f.fornecedor_code = __fornecedor_code\n        ) then\n        __fornecedor_code := null;\n      end if;\n    end loop;\n\n  return  __fornecedor_code;\nend;\n$$;\n\n\ncreate or replace function tweeks.funct_reg_fornecedor(args jsonb) returns lib.result\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    Essa função serve para registar um novo fornecedor no sistema\n    args := {\n      arg_espaco_auth: ID\n      arg_colaborador_id: ID,\n      arg_fornecedor_nif: ID,\n      arg_fornecedor_nome: NOME,\n      arg_fornecedor_email: EMAIL,\n      arg_fornecedor_contacto: CONTACTO,\n      arg_fornecedor_endereco: ENDERECO\n    }\n  */\n\n  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n  arg_fornecedor_nif character varying default lib.str_normalize( lib.str_nospace( args->>'arg_fornecedor_nif') );\n  arg_fornecedor_email character varying default lib.str_nospace( lower( args->>'arg_fornecedor_email' ) );\n  arg_fornecedor_nome character varying not null default  lib.str_normalize( args->>'arg_fornecedor_nome' );\n  arg_fornecedor_contacto character varying not null default lib.str_normalize( lib.str_nospace( args->>'arg_fornecedor_contacto' ) );\n  arg_fornecedor_endereco character varying not null default lib.str_nospace( args->>'arg_fornecedor_endereco' );\n\n  _fornecedor tweeks.fornecedor;\n  _branch uuid  default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n\nbegin\n\n  -- Garantir que tanto o email quanto o nif seja unico\n  if(\n    select count( * ) > 0\n      from tweeks.fornecedor fo\n      where fo.fornecedor_nif = arg_fornecedor_nif\n  ) then\n    return false? 'NIF já existe!';\n  end if;\n\n  if(\n    select count( * ) > 0\n      from tweeks.fornecedor fo\n      where fo.fornecedor_email = arg_fornecedor_email\n  ) then\n    return false? 'Email já existe!';\n  end if;\n  \n  _fornecedor.fornecedor_code := tweeks.__generate_fornecedor_code( _branch );\n\n  insert into tweeks.fornecedor (\n    fornecedor_colaborador_id,\n    fornecedor_espaco_auth,\n    fornecedor_nif,\n    fornecedor_nome,\n    fornecedor_email,\n    fornecedor_contacto,\n    fornecedor_endereco,\n    fornecedor_code\n  ) values (\n    arg_colaborador_id,\n    arg_espaco_auth,\n    arg_fornecedor_nif,\n    arg_fornecedor_nome,\n    arg_fornecedor_email,\n    arg_fornecedor_contacto,\n    arg_fornecedor_endereco,\n    _fornecedor.fornecedor_code\n  ) returning * into _fornecedor;\n\n  return true ? jsonb_build_object(\n    'fornecedor', _fornecedor\n  );\nend;\n$$;\n\n	create or replace function tweeks.__generate_fornecedor_code( _branch uuid ) returns text language plpgsql as $$ declare __fornecedor_code text; begin while __fornecedor_code is null loop __fornecedor_code := cluster.next( 'fornecedor/seq', lpad := 2, lpad_char := '0', sub := _branch::text ); if exists( select * from tweeks.fornecedor f where f.fornecedor_code = __fornecedor_code ) then __fornecedor_code := null; end if; end loop; return __fornecedor_code; end; $$; create or replace function tweeks.funct_reg_fornecedor(args jsonb) returns lib.result language plpgsql as $$ declare /** Essa função serve para registar um novo fornecedor no sistema args := { arg_espaco_auth: ID arg_colaborador_id: ID, arg_fornecedor_nif: ID, arg_fornecedor_nome: NOME, arg_fornecedor_email: EMAIL, arg_fornecedor_contacto: CONTACTO, arg_fornecedor_endereco: ENDERECO } */ arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_fornecedor_nif character varying default lib.str_normalize( lib.str_nospace( args->>'arg_fornecedor_nif') ); arg_fornecedor_email character varying default lib.str_nospace( lower( args->>'arg_fornecedor_email' ) ); arg_fornecedor_nome character varying not null default lib.str_normalize( args->>'arg_fornecedor_nome' ); arg_fornecedor_contacto character varying not null default lib.str_normalize( lib.str_nospace( args->>'arg_fornecedor_contacto' ) ); arg_fornecedor_endereco character varying not null default lib.str_nospace( args->>'arg_fornecedor_endereco' ); _fornecedor tweeks.fornecedor; _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); begin -- Garantir que tanto o email quanto o nif seja unico if( select count( * ) > 0 from tweeks.fornecedor fo where fo.fornecedor_nif = arg_fornecedor_nif ) then return false? 'NIF já existe!'; end if; if( select count( * ) > 0 from tweeks.fornecedor fo where fo.fornecedor_email = arg_fornecedor_email ) then return false? 'Email já existe!'; end if; _fornecedor.fornecedor_code := tweeks.__generate_fornecedor_code( _branch ); insert into tweeks.fornecedor ( fornecedor_colaborador_id, fornecedor_espaco_auth, fornecedor_nif, fornecedor_nome, fornecedor_email, fornecedor_contacto, fornecedor_endereco, fornecedor_code ) values ( arg_colaborador_id, arg_espaco_auth, arg_fornecedor_nif, arg_fornecedor_nome, arg_fornecedor_email, arg_fornecedor_contacto, arg_fornecedor_endereco, _fornecedor.fornecedor_code ) returning * into _fornecedor; return true ? jsonb_build_object( 'fornecedor', _fornecedor ); end; $$;
9b028729-2847-4d95-9c4f-644f9355005b	\ncreate or replace function tweeks.__generate_guia_code( _branch uuid, toperacao_id int )\n  returns text\n  language plpgsql as $$\ndeclare\n  __guia_code text;\nbegin\n    while __guia_code is null loop\n        __guia_code := cluster.next( format( 'guia|%s', toperacao_id ), sub := _branch::text, lpad := 4, lpad_char := '0' );\n        if exists(\n            select *\n            from tweeks.guia g\n            where g.guia_numero = __guia_code\n              and g.guia_toperacao_id = toperacao_id\n              and g._braunc_uid = _branch\n          ) then\n          __guia_code := null;\n        end if;\n      end loop;\n    return  __guia_code;\n  end;\n$$;\n\ncreate or replace function tweeks.funct_sets_guia(args jsonb) returns guia\n  language plpgsql\nas\n$$\ndeclare\n    /**\n      args := {\n        guia: tweeks.guia {\n          guia_toperacao_id: TOPERACAO,\n          guia_espaco_entrada: UID\n          guia_espaco_saida: UID\n          guia_tguia_id: TGUIA\n          guia_numero: NUMERO,\n          guia_metadata: { ... any data },\n          guia_dataoperacao: DATE,\n          guia_observacao: OBS,\n          guia_refs: { },\n          guia_refuid: UID\n          guia_refclass: string( regclass )\n\n        },\n\n        //Relativos a Guia\n        custoguia: tweeks.custoguia[\n          custoguia_montante: MONTANTE,\n          custoguia_descricao: DESCRICAO PARA O CUSTO\n          custoguia_tcusto_id: 1 - DESPESA | 2 - RECEITA\n        ],\n        arg_colaborador_id uuid,\n        arg_espaco_auth uuid\n      }\n     */\n    _args tweeks.guia;\n    arg_colaborador_id uuid default args->>'arg_colaborador_id';\n    arg_espaco_auth uuid default args->>'arg_espaco_auth';\n    _iNext tweeks.custoguia;\n    _custoguia tweeks.custoguia;\n    _const map.constant;\n    _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  begin\n    _const := map.constant();\n    _args := jsonb_populate_record( _args, args->'guia' );\n\n    if _args.guia_uid is null then\n      \n      _args.guia_numero := tweeks.__generate_guia_code( _branch, _args.guia_toperacao_id );\n      _args._braunc_uid := _branch;\n      _args.guia_espaco_auth := arg_espaco_auth;\n      _args.guia_colaborador_id := arg_colaborador_id;\n\n      select ( "returning" ).* into _args\n        from lib.sets_in( _args )\n      ;\n      for _iNext in\n        select cg.*\n          from jsonb_array_elements( args->'custoguia' ) e( doc )\n            inner join jsonb_populate_record( null::tweeks.custoguia, e.doc ) cg on true\n      loop\n        _iNext.custoguia_colaborador_id := arg_colaborador_id;\n        _iNext.custoguia_espaco_auth := arg_espaco_auth;\n        _iNext.custoguia_guia_uid := _args.guia_uid;\n        _iNext._branch_uid := _branch;\n        select ( "returning" ).* into _custoguia\n          from lib.sets_in( _iNext );\n      end loop;\n    else\n      _args._braunc_uid := _branch;\n      _args.guia_colaborador_atualizacao := arg_colaborador_id;\n      _args.guia_dateupdate := arg_colaborador_id;\n\n      select ( "returning" ).* into _args\n        from lib.sets_up( _args )\n      ;\n      update tweeks.custoguia\n        set custoguia_estado = _const.maguita_custoguia_estado_canselado,\n            custoguia_dateupdate = clock_timestamp(),\n            custoguia_colaborador_atualizacao = arg_colaborador_id\n        where custoguia_guia_uid = _args.guia_uid\n          and custoguia_estado = _const.maguita_custoguia_estado_ativo\n      ;\n\n      for _iNext in\n        select cg.*\n          from jsonb_array_elements( args->'custoguia' ) e( doc )\n            inner join jsonb_populate_record( null::tweeks.custoguia, e.doc ) cg on true\n        loop\n          _iNext.custoguia_guia_uid := _args.guia_uid;\n          _iNext.custoguia_colaborador_id := arg_colaborador_id;\n          _iNext.custoguia_dateupdate := clock_timestamp();\n          select ( "returning" ).* into _custoguia\n          from lib.sets_in( _iNext );\n        end loop;\n    end if;\n\n    return _args;\n  end;\n$$;\n\n\n	create or replace function tweeks.__generate_guia_code( _branch uuid, toperacao_id int ) returns text language plpgsql as $$ declare __guia_code text; begin while __guia_code is null loop __guia_code := cluster.next( format( 'guia|%s', toperacao_id ), sub := _branch::text, lpad := 4, lpad_char := '0' ); if exists( select * from tweeks.guia g where g.guia_numero = __guia_code and g.guia_toperacao_id = toperacao_id and g._braunc_uid = _branch ) then __guia_code := null; end if; end loop; return __guia_code; end; $$; create or replace function tweeks.funct_sets_guia(args jsonb) returns guia language plpgsql as $$ declare /** args := { guia: tweeks.guia { guia_toperacao_id: TOPERACAO, guia_espaco_entrada: UID guia_espaco_saida: UID guia_tguia_id: TGUIA guia_numero: NUMERO, guia_metadata: { ... any data }, guia_dataoperacao: DATE, guia_observacao: OBS, guia_refs: { }, guia_refuid: UID guia_refclass: string( regclass ) }, //Relativos a Guia custoguia: tweeks.custoguia[ custoguia_montante: MONTANTE, custoguia_descricao: DESCRICAO PARA O CUSTO custoguia_tcusto_id: 1 - DESPESA | 2 - RECEITA ], arg_colaborador_id uuid, arg_espaco_auth uuid } */ _args tweeks.guia; arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; _iNext tweeks.custoguia; _custoguia tweeks.custoguia; _const map.constant; _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); begin _const := map.constant(); _args := jsonb_populate_record( _args, args->'guia' ); if _args.guia_uid is null then _args.guia_numero := tweeks.__generate_guia_code( _branch, _args.guia_toperacao_id ); _args._braunc_uid := _branch; _args.guia_espaco_auth := arg_espaco_auth; _args.guia_colaborador_id := arg_colaborador_id; select ( "returning" ).* into _args from lib.sets_in( _args ) ; for _iNext in select cg.* from jsonb_array_elements( args->'custoguia' ) e( doc ) inner join jsonb_populate_record( null::tweeks.custoguia, e.doc ) cg on true loop _iNext.custoguia_colaborador_id := arg_colaborador_id; _iNext.custoguia_espaco_auth := arg_espaco_auth; _iNext.custoguia_guia_uid := _args.guia_uid; _iNext._branch_uid := _branch; select ( "returning" ).* into _custoguia from lib.sets_in( _iNext ); end loop; else _args._braunc_uid := _branch; _args.guia_colaborador_atualizacao := arg_colaborador_id; _args.guia_dateupdate := arg_colaborador_id; select ( "returning" ).* into _args from lib.sets_up( _args ) ; update tweeks.custoguia set custoguia_estado = _const.maguita_custoguia_estado_canselado, custoguia_dateupdate = clock_timestamp(), custoguia_colaborador_atualizacao = arg_colaborador_id where custoguia_guia_uid = _args.guia_uid and custoguia_estado = _const.maguita_custoguia_estado_ativo ; for _iNext in select cg.* from jsonb_array_elements( args->'custoguia' ) e( doc ) inner join jsonb_populate_record( null::tweeks.custoguia, e.doc ) cg on true loop _iNext.custoguia_guia_uid := _args.guia_uid; _iNext.custoguia_colaborador_id := arg_colaborador_id; _iNext.custoguia_dateupdate := clock_timestamp(); select ( "returning" ).* into _custoguia from lib.sets_in( _iNext ); end loop; end if; return _args; end; $$;
9b5d6283-a5ed-4218-bfb1-a32e36624756	\n  alter table tweeks.serie add if not exists serie_fechoautorizacao boolean not null default false;\n	alter table tweeks.serie add if not exists serie_fechoautorizacao boolean not null default false;
791983f3-5209-40f1-aaaa-6a80e0398ecb	\ndrop view if exists report.vreport_conta;\n\ncreate view report.vreport_conta as\nwith _const (maguita_lancamento_mode_manual, maguita_lancamento_mode_automatic, ___conta_regclass, ___deposito_regclass) as (\n  select\n      map.get('maguita_lancamento_mode_manual')::int2,\n      map.get('maguita_lancamento_mode_automatic')::int2,\n      cluster.__format( 'tweeks.conta' ) as ___conta_regclass,\n      cluster.__format( 'tweeks.deposito' ) as ___deposito_regclass\n  ),\n     _lancamento as ( select *  from tweeks.__lancamento_regularizacao()\n), __conta_report as (\n  select\n      l.lancamento_sequencia as "SEQUÊNCIA",\n      cli.cliente_titular as "CLIENTE",\n      cli.cliente_nif as "NIF",\n      l.lancamento_doc as "DOCUMENTO",\n      l.credito as "$ CREDITO",\n      l.debito as "$ DEBITO",\n      l.valor as "$ MONTANTE",\n      l.entrada as "$ RESULTADO",\n      l.regula_montante as "$ REGULARIZADO",\n      tlanc.tlancamento_desc as "TIPO",\n      tg.tgrupo_desc as "CONTA",\n      \n      case\n        when lanc.lancamento_operacao =  1 then 'CREDITO'\n        when lanc.lancamento_operacao = -1 then 'DEBITO'\n      end as "OPERAÇÃO",\n      case\n        when lanc.lancamento_mode = _const.maguita_lancamento_mode_manual then 'MANUAL'\n        when lanc.lancamento_mode = _const.maguita_lancamento_mode_automatic then 'AUTOMATICO'\n        end as "MODO",\n    \n      col.colaborador_nome as "COLABORADOR",\n      l.lancamento_data as "DATA",\n      l.lancamento_time as "REGISTRO",\n      lanc.lancamento_descricao as "OBSERVAÇÃO",\n      lanc.lancamento_id,\n      cli.cliente_id,\n      case when lanc.lancamento_regclass = _const.___conta_regclass then lanc.lancamento_refid end as _conta_id,\n      case when lanc.lancamento_regclass = _const.___deposito_regclass then lanc.lancamento_refid end as _deposito_id,\n      tg.tgrupo_id,\n      tlanc.tlancamento_id,\n      col.colaborador_id,\n      lanc.lancamento_mode,\n      lanc._branch_uid,\n      lanc.lancamento_operacao\n    from  _const\n      inner join _lancamento l on true\n      inner join tweeks.lancamento lanc on l.lancamento_id = lanc.lancamento_id\n      inner join tweeks.tlancamento tlanc on lanc.lancamento_tlancamento_id = tlanc.tlancamento_id\n      inner join tweeks.cliente cli on l.cliente_id = cli.cliente_id\n      inner join tweeks.tgrupo tg on lanc._tgrupo_id = tg.tgrupo_id\n      inner join auth.colaborador col on lanc.lancamento_colaborador_id = col.colaborador_id\n  order by l.lancamento_sequencia\n) select *\n    from __conta_report;\n\nselect * from report.sync( 'report.vreport_conta', 'RELATÓRIO DE CONTA/LANÇAMENTO', 1800 );\n\nUPDATE report.vcolumn SET position = 1995, show = true, init = false, format = 'int', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'bigint' WHERE source = 'report.vreport_conta' AND name = 'SEQUÊNCIA';\nUPDATE report.vcolumn SET position = 1895, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_conta' AND name = 'CLIENTE';\nUPDATE report.vcolumn SET position = 1894, show = true, init = false, format = 'code', filter = '[["query.like", {"name": "NIF"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_conta' AND name = 'NIF';\nUPDATE report.vcolumn SET position = 1795, show = true, init = true, format = 'code:long', filter = '[["query.like", {"name": "DOCUMENTO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_conta' AND name = 'DOCUMENTO';\nUPDATE report.vcolumn SET position = 1785, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_conta' AND name = '$ CREDITO';\nUPDATE report.vcolumn SET position = 1775, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_conta' AND name = '$ DEBITO';\nUPDATE report.vcolumn SET position = 1775, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_conta' AND name = '$ MONTANTE';\nUPDATE report.vcolumn SET position = 1765, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_conta' AND name = '$ RESULTADO';\nUPDATE report.vcolumn SET position = 1755, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_conta' AND name = '$ REGULARIZADO';\nUPDATE report.vcolumn SET position = 1695, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_conta' AND name = 'TIPO';\nUPDATE report.vcolumn SET position = 1685, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_conta' AND name = 'CONTA';\nUPDATE report.vcolumn SET position = 1684, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_conta' AND name = 'OPERAÇÃO';\nUPDATE report.vcolumn SET position = 1675, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_conta' AND name = 'MODO';\nUPDATE report.vcolumn SET position = 100, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_conta' AND name = 'COLABORADOR';\nUPDATE report.vcolumn SET position = 95, show = true, init = true, format = 'date', filter = '[["query.range|start", {"name": "DATA INICIO"}], ["query.range|end", {"name": "DATA FIM"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_conta' AND name = 'DATA';\nUPDATE report.vcolumn SET position = 85, show = true, init = true, format = 'timestamp', filter = '[["query.range|end", {"name": "REGISTRO INICIO"}], ["query.range|end", {"name": "REGISTRO FIM"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_conta' AND name = 'REGISTRO';\nUPDATE report.vcolumn SET position = 0, show = true, init = false, format = 'text', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_conta' AND name = 'OBSERVAÇÃO';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]', agg = '[{"func": "count::distinct", "name": "TOTAL CLIENTES", "format": "int", "rename": "??COUNT::DISTINCT TOTAL DE CLIENTES"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_conta' AND name = 'cliente_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE FATURA", "format": "int", "rename": "??COUNT::DISTINCT TOTAL DE FATURAS"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_conta' AND name = '_conta_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE DEPOSITOS", "format": "int", "rename": "??COUNT::DISTINCT TOTAL DE DEPOSITOS"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_conta' AND name = '_deposito_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE LANÇAMENTO", "format": "int", "rename": "??COUNT::DISTINCT TOTAL DE  LANCAMENTO"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_conta' AND name = 'lancamento_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|auth.colaborador", {"name": "COLABORADOR"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_conta' AND name = 'colaborador_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'code', filter = '[["query.source|tweeks.lancamento::mode", {"name": "MODO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_conta' AND name = 'lancamento_mode';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'code', filter = '[["query.source|tweeks.toperacao", {"name": "TIPO DE OPERAÇÃO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_conta' AND name = 'lancamento_operacao';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_conta' AND name = 'tgrupo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tlancamento", {"name": "TIPO DE LANÇAMENTO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_conta' AND name = 'tlancamento_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_conta' AND name = '_branch_uid';\n\n\nselect * from report.vcolumn\n  where source = 'report.vreport_conta'\n  order by position desc nulls last,\n    show desc nulls last,\n    init desc nulls last,\n    jsonb_array_length( agg ) desc,\n    jsonb_array_length( filter ) desc,\n    source, name;\n	drop view if exists report.vreport_conta; create view report.vreport_conta as with _const (maguita_lancamento_mode_manual, maguita_lancamento_mode_automatic, ___conta_regclass, ___deposito_regclass) as ( select map.get('maguita_lancamento_mode_manual')::int2, map.get('maguita_lancamento_mode_automatic')::int2, cluster.__format( 'tweeks.conta' ) as ___conta_regclass, cluster.__format( 'tweeks.deposito' ) as ___deposito_regclass ), _lancamento as ( select * from tweeks.__lancamento_regularizacao() ), __conta_report as ( select l.lancamento_sequencia as "SEQUÊNCIA", cli.cliente_titular as "CLIENTE", cli.cliente_nif as "NIF", l.lancamento_doc as "DOCUMENTO", l.credito as "$ CREDITO", l.debito as "$ DEBITO", l.valor as "$ MONTANTE", l.entrada as "$ RESULTADO", l.regula_montante as "$ REGULARIZADO", tlanc.tlancamento_desc as "TIPO", tg.tgrupo_desc as "CONTA", case when lanc.lancamento_operacao = 1 then 'CREDITO' when lanc.lancamento_operacao = -1 then 'DEBITO' end as "OPERAÇÃO", case when lanc.lancamento_mode = _const.maguita_lancamento_mode_manual then 'MANUAL' when lanc.lancamento_mode = _const.maguita_lancamento_mode_automatic then 'AUTOMATICO' end as "MODO", col.colaborador_nome as "COLABORADOR", l.lancamento_data as "DATA", l.lancamento_time as "REGISTRO", lanc.lancamento_descricao as "OBSERVAÇÃO", lanc.lancamento_id, cli.cliente_id, case when lanc.lancamento_regclass = _const.___conta_regclass then lanc.lancamento_refid end as _conta_id, case when lanc.lancamento_regclass = _const.___deposito_regclass then lanc.lancamento_refid end as _deposito_id, tg.tgrupo_id, tlanc.tlancamento_id, col.colaborador_id, lanc.lancamento_mode, lanc._branch_uid, lanc.lancamento_operacao from _const inner join _lancamento l on true inner join tweeks.lancamento lanc on l.lancamento_id = lanc.lancamento_id inner join tweeks.tlancamento tlanc on lanc.lancamento_tlancamento_id = tlanc.tlancamento_id inner join tweeks.cliente cli on l.cliente_id = cli.cliente_id inner join tweeks.tgrupo tg on lanc._tgrupo_id = tg.tgrupo_id inner join auth.colaborador col on lanc.lancamento_colaborador_id = col.colaborador_id order by l.lancamento_sequencia ) select * from __conta_report; select * from report.sync( 'report.vreport_conta', 'RELATÓRIO DE CONTA/LANÇAMENTO', 1800 ); UPDATE report.vcolumn SET position = 1995, show = true, init = false, format = 'int', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'bigint' WHERE source = 'report.vreport_conta' AND name = 'SEQUÊNCIA'; UPDATE report.vcolumn SET position = 1895, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_conta' AND name = 'CLIENTE'; UPDATE report.vcolumn SET position = 1894, show = true, init = false, format = 'code', filter = '[["query.like", {"name": "NIF"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_conta' AND name = 'NIF'; UPDATE report.vcolumn SET position = 1795, show = true, init = true, format = 'code:long', filter = '[["query.like", {"name": "DOCUMENTO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_conta' AND name = 'DOCUMENTO'; UPDATE report.vcolumn SET position = 1785, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_conta' AND name = '$ CREDITO'; UPDATE report.vcolumn SET position = 1775, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_conta' AND name = '$ DEBITO'; UPDATE report.vcolumn SET position = 1775, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_conta' AND name = '$ MONTANTE'; UPDATE report.vcolumn SET position = 1765, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_conta' AND name = '$ RESULTADO'; UPDATE report.vcolumn SET position = 1755, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_conta' AND name = '$ REGULARIZADO'; UPDATE report.vcolumn SET position = 1695, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_conta' AND name = 'TIPO'; UPDATE report.vcolumn SET position = 1685, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_conta' AND name = 'CONTA'; UPDATE report.vcolumn SET position = 1684, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_conta' AND name = 'OPERAÇÃO'; UPDATE report.vcolumn SET position = 1675, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_conta' AND name = 'MODO'; UPDATE report.vcolumn SET position = 100, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_conta' AND name = 'COLABORADOR'; UPDATE report.vcolumn SET position = 95, show = true, init = true, format = 'date', filter = '[["query.range|start", {"name": "DATA INICIO"}], ["query.range|end", {"name": "DATA FIM"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_conta' AND name = 'DATA'; UPDATE report.vcolumn SET position = 85, show = true, init = true, format = 'timestamp', filter = '[["query.range|end", {"name": "REGISTRO INICIO"}], ["query.range|end", {"name": "REGISTRO FIM"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_conta' AND name = 'REGISTRO'; UPDATE report.vcolumn SET position = 0, show = true, init = false, format = 'text', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_conta' AND name = 'OBSERVAÇÃO'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]', agg = '[{"func": "count::distinct", "name": "TOTAL CLIENTES", "format": "int", "rename": "??COUNT::DISTINCT TOTAL DE CLIENTES"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_conta' AND name = 'cliente_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE FATURA", "format": "int", "rename": "??COUNT::DISTINCT TOTAL DE FATURAS"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_conta' AND name = '_conta_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE DEPOSITOS", "format": "int", "rename": "??COUNT::DISTINCT TOTAL DE DEPOSITOS"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_conta' AND name = '_deposito_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE LANÇAMENTO", "format": "int", "rename": "??COUNT::DISTINCT TOTAL DE LANCAMENTO"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_conta' AND name = 'lancamento_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|auth.colaborador", {"name": "COLABORADOR"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_conta' AND name = 'colaborador_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'code', filter = '[["query.source|tweeks.lancamento::mode", {"name": "MODO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_conta' AND name = 'lancamento_mode'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'code', filter = '[["query.source|tweeks.toperacao", {"name": "TIPO DE OPERAÇÃO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_conta' AND name = 'lancamento_operacao'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_conta' AND name = 'tgrupo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tlancamento", {"name": "TIPO DE LANÇAMENTO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_conta' AND name = 'tlancamento_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_conta' AND name = '_branch_uid'; select * from report.vcolumn where source = 'report.vreport_conta' order by position desc nulls last, show desc nulls last, init desc nulls last, jsonb_array_length( agg ) desc, jsonb_array_length( filter ) desc, source, name;
f188c908-a067-482f-90f6-739e25187c8c	\n    create or replace function tweeks.__generate_posto_chave()\n    returns text\n    language plpgsql as  $$\n    declare\n      chars character varying default 'abcdefghijklmnopqrstuvwxyz'||upper('abcdefghijklmnopqrstuvwxyz')||'0123456789'||'$#%';\n      _posto_chave varchar;\n    begin\n      _posto_chave := lib.dset_random_text( chars, (2^8)::int )::character varying;\n      return _posto_chave;\n    end;\n    $$;\n    \n    create or replace function tweeks.funct_reg_posto(args jsonb) returns lib.result\n    language plpgsql\n    as\n    $$\n    declare\n      /**\n        Essa função serve para criar uma posto para o colaborador\n        args := {\n          arg_posto_id: UUID\n          arg_espaco_auth: ID,\n          arg_espaco_destino: [ID, ID, ID],\n          arg_colaborador_id: ID\n          arg_posto_multiplecaixa: BOOLEAN\n    \n          arg_posto_matricula:  MATRICULA (CHAVE TEMPORARIA),\n          arg_posto_designacao: DESIGNACAO,\n          arg_tposto_id: ID,\n          arg_posto_multipleuser: BOOLEAN,\n          arg_posto_designcao: ID,\n          arg_posto_montanteinicial: MONTANTE_INICIAL,\n          posto_authmode: AUTH-MODE,\n          posto_caixamode: CAIXA-MODE,\n        }\n      */\n    \n      arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n      arg_posto_id uuid default args->>'arg_posto_id';\n      arg_espaco_destino uuid[] not null default array( select e.text from jsonb_array_elements_text( args->'arg_espaco_destino') e( text ));\n      arg_posto_designacao character varying not null default args->>'arg_posto_designacao';\n      arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n      arg_tposto_id int2 not null default args->>'arg_tposto_id';\n      arg_posto_multiplecaixa boolean default args->>'arg_posto_multiplecaixa';\n      arg_posto_matricula character varying default   args->>'arg_posto_matricula';\n      arg_posto_montanteinicial float default         args->>'arg_posto_montanteinicial';\n      arg_posto_authmode int2 not null default        args->>'posto_authmode';\n      arg_posto_caixamode int2 not null default       args->>'posto_caixamode';\n    \n      _const map.constant;\n      _posto tweeks.posto;\n    \n    begin\n    \n      _const := map.constant();\n    \n      if arg_posto_id is null then\n        if (\n          select count( * ) > 0\n          from tweeks.posto p\n          where p.posto_matricula = arg_posto_matricula\n        ) then\n          return false ? 'Código do posto já existe!';\n        end if;\n    \n        _posto.posto_espaco_auth := arg_espaco_auth;\n        _posto.posto_tposto_id := arg_tposto_id;\n        _posto.posto_colaborador_id := arg_colaborador_id;\n        _posto.posto_designacao := arg_posto_designacao;\n        _posto.posto_multiplecaixa := coalesce( arg_posto_multiplecaixa, true );\n        _posto.posto_matricula := arg_posto_matricula;\n        _posto.posto_chave := tweeks.__generate_posto_chave();\n        _posto.posto_authmode := arg_posto_authmode;\n        _posto.posto_caixamode := arg_posto_caixamode;\n    \n        select ( "returning" ).* into _posto from lib.sets_in( _posto );\n    \n        update tweeks.chave\n        set chave_definitiva = _posto.posto_chave\n        where chave_temporarai = _posto.posto_matricula\n        ;\n      else\n        select ( "returning" ).* into _posto\n        from tweeks.posto p\n          inner join lib.sets_up( p, replacer := args||jsonb_build_object(\n            'posto_tposto_id', arg_tposto_id,\n            'posto_designacao', arg_posto_designacao,\n            'posto_multiplecaixa', coalesce( arg_posto_multiplecaixa, true ),\n            'posto_authmode', arg_posto_authmode,\n            'posto_caixamode', arg_posto_caixamode\n          )) up on true\n        where p.posto_id = arg_posto_id\n        ;\n      end if;\n    \n      -- Desativar os antigos espaços alocados ao posto\n      update tweeks.aloca\n      set aloca_estado = _const.maguita_aloca_estado_fechado,\n          aloca_colaborador_atualizacao = arg_colaborador_id,\n          aloca_dataatualizacao = current_timestamp\n      where aloca_posto_id = _posto.posto_id\n        and aloca_espaco_destino != all( arg_espaco_destino )\n      ;\n    \n      -- Criar nova alocaçoes\n      insert into tweeks.aloca(\n        aloca_posto_id,\n        aloca_espaco_destino,\n        aloca_espaco_auth,\n        aloca_colaborador_id,\n        aloca_montante\n      ) select\n          _posto.posto_id,\n          n.next,\n          arg_espaco_auth,\n          arg_colaborador_id,\n          coalesce( arg_posto_montanteinicial, 0 )\n      from unnest( arg_espaco_destino ) n( next )\n             left join tweeks.aloca al on n.next = al.aloca_espaco_destino\n        and al.aloca_posto_id = _posto.posto_id\n        and al.aloca_estado = _const.maguita_aloca_estado_ativo\n      where al.aloca_id is null\n      ;\n    \n      return true ? jsonb_build_object(\n          'posto', _posto,\n          'aloca', array(\n              select to_jsonb( a )\n              from tweeks.aloca a\n              where a.aloca_posto_id = _posto.posto_id\n                and a.aloca_estado = _const.maguita_aloca_estado_ativo\n            )\n        );\n    end;\n    $$;\n	create or replace function tweeks.__generate_posto_chave() returns text language plpgsql as $$ declare chars character varying default 'abcdefghijklmnopqrstuvwxyz'||upper('abcdefghijklmnopqrstuvwxyz')||'0123456789'||'$#%'; _posto_chave varchar; begin _posto_chave := lib.dset_random_text( chars, (2^8)::int )::character varying; return _posto_chave; end; $$; create or replace function tweeks.funct_reg_posto(args jsonb) returns lib.result language plpgsql as $$ declare /** Essa função serve para criar uma posto para o colaborador args := { arg_posto_id: UUID arg_espaco_auth: ID, arg_espaco_destino: [ID, ID, ID], arg_colaborador_id: ID arg_posto_multiplecaixa: BOOLEAN arg_posto_matricula: MATRICULA (CHAVE TEMPORARIA), arg_posto_designacao: DESIGNACAO, arg_tposto_id: ID, arg_posto_multipleuser: BOOLEAN, arg_posto_designcao: ID, arg_posto_montanteinicial: MONTANTE_INICIAL, posto_authmode: AUTH-MODE, posto_caixamode: CAIXA-MODE, } */ arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_posto_id uuid default args->>'arg_posto_id'; arg_espaco_destino uuid[] not null default array( select e.text from jsonb_array_elements_text( args->'arg_espaco_destino') e( text )); arg_posto_designacao character varying not null default args->>'arg_posto_designacao'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_tposto_id int2 not null default args->>'arg_tposto_id'; arg_posto_multiplecaixa boolean default args->>'arg_posto_multiplecaixa'; arg_posto_matricula character varying default args->>'arg_posto_matricula'; arg_posto_montanteinicial float default args->>'arg_posto_montanteinicial'; arg_posto_authmode int2 not null default args->>'posto_authmode'; arg_posto_caixamode int2 not null default args->>'posto_caixamode'; _const map.constant; _posto tweeks.posto; begin _const := map.constant(); if arg_posto_id is null then if ( select count( * ) > 0 from tweeks.posto p where p.posto_matricula = arg_posto_matricula ) then return false ? 'Código do posto já existe!'; end if; _posto.posto_espaco_auth := arg_espaco_auth; _posto.posto_tposto_id := arg_tposto_id; _posto.posto_colaborador_id := arg_colaborador_id; _posto.posto_designacao := arg_posto_designacao; _posto.posto_multiplecaixa := coalesce( arg_posto_multiplecaixa, true ); _posto.posto_matricula := arg_posto_matricula; _posto.posto_chave := tweeks.__generate_posto_chave(); _posto.posto_authmode := arg_posto_authmode; _posto.posto_caixamode := arg_posto_caixamode; select ( "returning" ).* into _posto from lib.sets_in( _posto ); update tweeks.chave set chave_definitiva = _posto.posto_chave where chave_temporarai = _posto.posto_matricula ; else select ( "returning" ).* into _posto from tweeks.posto p inner join lib.sets_up( p, replacer := args||jsonb_build_object( 'posto_tposto_id', arg_tposto_id, 'posto_designacao', arg_posto_designacao, 'posto_multiplecaixa', coalesce( arg_posto_multiplecaixa, true ), 'posto_authmode', arg_posto_authmode, 'posto_caixamode', arg_posto_caixamode )) up on true where p.posto_id = arg_posto_id ; end if; -- Desativar os antigos espaços alocados ao posto update tweeks.aloca set aloca_estado = _const.maguita_aloca_estado_fechado, aloca_colaborador_atualizacao = arg_colaborador_id, aloca_dataatualizacao = current_timestamp where aloca_posto_id = _posto.posto_id and aloca_espaco_destino != all( arg_espaco_destino ) ; -- Criar nova alocaçoes insert into tweeks.aloca( aloca_posto_id, aloca_espaco_destino, aloca_espaco_auth, aloca_colaborador_id, aloca_montante ) select _posto.posto_id, n.next, arg_espaco_auth, arg_colaborador_id, coalesce( arg_posto_montanteinicial, 0 ) from unnest( arg_espaco_destino ) n( next ) left join tweeks.aloca al on n.next = al.aloca_espaco_destino and al.aloca_posto_id = _posto.posto_id and al.aloca_estado = _const.maguita_aloca_estado_ativo where al.aloca_id is null ; return true ? jsonb_build_object( 'posto', _posto, 'aloca', array( select to_jsonb( a ) from tweeks.aloca a where a.aloca_posto_id = _posto.posto_id and a.aloca_estado = _const.maguita_aloca_estado_ativo ) ); end; $$;
44f3886e-a6ab-4501-9118-2533389eebe6	\n  comment on column espaco.espaco_vender is 'Esse campo indica em qual dos nucleo o espaço deve permitir a venda';\n	comment on column espaco.espaco_vender is 'Esse campo indica em qual dos nucleo o espaço deve permitir a venda';
ade3a107-0cf2-4706-80e9-d927bdc11b45	\ndrop function if exists tweeks.sets_viewargs( jsonb );\ncreate or replace function tweeks.viewargs_sets( jsonb )\nreturns table ( param text, value jsonb, text text )\nlanguage plpgsql as $$\n  declare\n    _record record;\n    _keys jsonb;\n  begin\n\n    _keys := coalesce( current_setting( 'viewargs.*', true )::jsonb, jsonb_build_array());\n    select coalesce(jsonb_agg( k.param ), jsonb_build_array()) into _keys\n      from jsonb_array_elements_text( _keys ) k( param)\n      where k.param != all( array( select format('viewargs.%I',  e ) from jsonb_object_keys( $1) e))\n    ;\n    \n    for _record in\n      select *\n        from jsonb_each( $1 )\n    loop\n      viewargs_sets.param := format('viewargs.%I', _record.key );\n      viewargs_sets.text := _record.value;\n      viewargs_sets.value := _record.value;\n      _keys := _keys || to_jsonb( viewargs_sets.param );\n      perform set_config( viewargs_sets.param, viewargs_sets.text, false );\n      return next;\n    end loop;\n\n    viewargs_sets.param := 'viewargs.*';\n    viewargs_sets.text := to_jsonb( _keys );\n    viewargs_sets.value := to_jsonb( _keys );\n    perform set_config( viewargs_sets.param, viewargs_sets.text, false );\n    return next;\n  end;\n$$;\n\ncreate or replace function tweeks.viewargs_set( key text, element anyelement )\nreturns table ( param text, value jsonb, text text )\nlanguage sql as $$\n  select *\n    from tweeks.viewargs_sets( jsonb_build_object( key, element ));\n$$;\n\ndrop function if exists tweeks.viewarg( argname text );\ncreate or replace function tweeks.viewarg( argname text )\nreturns text\nimmutable\nstrict\nparallel safe\nlanguage sql as $$\n  select jsonb_build_object( 'value', current_setting( format( 'viewargs.%I', argname ), true)::jsonb )->>'value'\n$$;\n\ndrop function if exists tweeks.viewargs_show();\ncreate or replace function tweeks.viewargs_show(out param text, out key text, out value jsonb, out text text )\nreturns setof record\nimmutable\nparallel safe\nlanguage sql as $$\n  select\n      e.param,\n      substr(e.param, length('viewargs.*'), length( e.param )),\n      current_setting( e.param, true )::jsonb,\n      jsonb_build_object( 'value', current_setting( e.param, true )::jsonb )->>'value'\n    from jsonb_array_elements_text( current_setting( 'viewargs.*', true )::jsonb ) e( param)\n$$;\n\ndrop function if exists tweeks.viewargs_object();\ncreate or replace function tweeks.viewargs_object()\nreturns jsonb\nimmutable\nparallel safe\nlanguage sql as $$\n  select\n      jsonb_object_agg(\n        substr(e.param, length('viewargs.*'), length( e.param )),\n        current_setting( e.param, true )::jsonb\n      )\n    from jsonb_array_elements_text( current_setting( 'viewargs.*', true )::jsonb )  e( param)\n$$;\n	drop function if exists tweeks.sets_viewargs( jsonb ); create or replace function tweeks.viewargs_sets( jsonb ) returns table ( param text, value jsonb, text text ) language plpgsql as $$ declare _record record; _keys jsonb; begin _keys := coalesce( current_setting( 'viewargs.*', true )::jsonb, jsonb_build_array()); select coalesce(jsonb_agg( k.param ), jsonb_build_array()) into _keys from jsonb_array_elements_text( _keys ) k( param) where k.param != all( array( select format('viewargs.%I', e ) from jsonb_object_keys( $1) e)) ; for _record in select * from jsonb_each( $1 ) loop viewargs_sets.param := format('viewargs.%I', _record.key ); viewargs_sets.text := _record.value; viewargs_sets.value := _record.value; _keys := _keys || to_jsonb( viewargs_sets.param ); perform set_config( viewargs_sets.param, viewargs_sets.text, false ); return next; end loop; viewargs_sets.param := 'viewargs.*'; viewargs_sets.text := to_jsonb( _keys ); viewargs_sets.value := to_jsonb( _keys ); perform set_config( viewargs_sets.param, viewargs_sets.text, false ); return next; end; $$; create or replace function tweeks.viewargs_set( key text, element anyelement ) returns table ( param text, value jsonb, text text ) language sql as $$ select * from tweeks.viewargs_sets( jsonb_build_object( key, element )); $$; drop function if exists tweeks.viewarg( argname text ); create or replace function tweeks.viewarg( argname text ) returns text immutable strict parallel safe language sql as $$ select jsonb_build_object( 'value', current_setting( format( 'viewargs.%I', argname ), true)::jsonb )->>'value' $$; drop function if exists tweeks.viewargs_show(); create or replace function tweeks.viewargs_show(out param text, out key text, out value jsonb, out text text ) returns setof record immutable parallel safe language sql as $$ select e.param, substr(e.param, length('viewargs.*'), length( e.param )), current_setting( e.param, true )::jsonb, jsonb_build_object( 'value', current_setting( e.param, true )::jsonb )->>'value' from jsonb_array_elements_text( current_setting( 'viewargs.*', true )::jsonb ) e( param) $$; drop function if exists tweeks.viewargs_object(); create or replace function tweeks.viewargs_object() returns jsonb immutable parallel safe language sql as $$ select jsonb_object_agg( substr(e.param, length('viewargs.*'), length( e.param )), current_setting( e.param, true )::jsonb ) from jsonb_array_elements_text( current_setting( 'viewargs.*', true )::jsonb ) e( param) $$;
fa49b0da-cb5f-4017-af28-403d3cd8d363	\n\n\ndrop materialized view if exists tweeks.vregularizacao;\ncreate materialized view tweeks.vregularizacao as\n        with data as (\n          select\n                l.lancamento_id as id,\n                l.lancamento_credito as credito,\n                l.lancamento_debito as debito,\n                l.lancamento_montante as montante,\n                l.lancamento_valor as value,\n                row_number() over ( order by l.lancamento_dataregistro, l.lancamento_sequencia) as sequencia,\n                l.lancamento_dataregistro as time,\n                l.lancamento_operacao as operacao,\n                l._branch_uid as branch,\n                l.lancamento_cliente_id as client,\n                l._tgrupo_id as tconta,\n                l.lancamento_documento as documento\n          from tweeks.lancamento l\n            where  l.lancamento_estado = (map.constant()).maguita_lancamento_estado_ativo\n              and ( tweeks.viewarg('branch')::uuid is null or l._branch_uid = tweeks.viewarg('branch')::uuid )\n              and ( tweeks.viewarg('client')::uuid is null or l.lancamento_cliente_id = tweeks.viewarg('client')::uuid )\n              and ( tweeks.viewarg('tconta')::int is null or l._tgrupo_id = tweeks.viewarg('tconta')::int )\n          order by l.lancamento_dataregistro,\n                   l.lancamento_sequencia\n        ), __regularizacao as (\n\n          select\n                l.credito,\n                l.debito,\n                l.montante,\n                sum(l.credito )  over ( partition by l.branch, l.tconta, l.client order by l.sequencia  rows between unbounded preceding and current row ) as running_credito,\n                sum(l.debito  ) over ( partition by l.branch, l.tconta, l.client order by  l.sequencia  rows between unbounded preceding and current row ) as running_debito,\n                l.id,\n                l.operacao,\n                l.sequencia,\n                l.time,\n                l.branch,\n                l.client,\n                l.documento,\n                l.value,\n                l.tconta\n            from data l\n          order by l.time, l.sequencia\n\n        ) select re.*,\n            re.running_credito - re.running_debito as running_saldo,\n            ( re.running_credito - re.running_debito ) + ( re.montante * -1 )as before_saldo,\n            case\n              when re.operacao = 1 then ( re.running_credito ) - ( re.credito )\n              else re.running_credito\n            end as before_credito,\n            case\n              when re.operacao = -1 then ( re.running_debito ) - ( re.debito )\n              else re.running_debito\n            end as before_debito,\n            case re.operacao\n              when 1 then re.running_credito\n              else re.running_debito\n            end running_operacao,\n            case re.operacao\n              when 1 then re.running_debito\n              else re.running_credito\n            end running_reverse\n        from __regularizacao re;\n\ncreate index idx_vregularizacao_operacao on tweeks.vregularizacao (  operacao );\ncreate unique index idx_vregularizacao_sequencia on tweeks.vregularizacao (  sequencia );\ncreate index idx_vregularizacao on tweeks.vregularizacao ( running_credito, running_debito, credito, debito, operacao );\ncreate unique index idx_vregularizacao_identifier on tweeks.vregularizacao ( id );\n\n\ndrop function if exists tweeks.__regulariza( variadic lancamentos uuid[] ) cascade ;\ncreate or replace function tweeks.__regulariza( variadic lancamentos uuid[] )\nreturns table(\n  lancamento uuid,\n  credito double precision,\n  debito double precision,\n  running_credito double precision,\n  running_debito double precision,\n  running_saldo double precision,\n  before_saldo double precision,\n  before_credito double precision,\n  before_debito double precision,\n  affects uuid[],\n  affects_values numeric[],\n  affects_apply numeric[],\n  affects_document jsonb,\n  "time" timestamptz,\n  client uuid,\n  branch uuid,\n  operacao int,\n  tconta int\n) language plpgsql as $$\ndeclare\n  _record record;\n  _value double precision;\nbegin\n  for _record in\n    select\n        ac.*,\n        jsonb_agg( jsonb_build_object( 'doc', affect.documento )) filter ( where affect.running_credito > ac.running_debito - ac.debito and affect.running_credito - affect.credito < ac.running_debito ) as affects_document,\n        array_agg( affect.id ) filter ( where affect.running_credito > ac.running_debito - ac.debito and affect.running_credito - affect.credito < ac.running_debito ) as affects,\n        array_agg( affect.credito::numeric ) filter ( where affect.running_credito > ac.running_debito - ac.debito and affect.running_credito - affect.credito < ac.running_debito ) as affects_credito,\n        array_agg( affect.debito::numeric ) filter ( where  ac.running_credito > affect.running_debito - affect.debito and ac.running_credito - ac.credito < affect.running_debito ) as affects_debitos,\n        array_agg(\n           (affect.running_credito - ac.before_debito) - (\n            case\n              when affect.running_credito - ac.running_debito >= 0 then affect.running_credito - ac.running_debito\n              else 0\n            end\n          ) - (\n            case\n              when affect.before_credito - ac.before_debito > 0 then affect.before_credito - ac.before_debito\n              else 0\n            end\n          )\n        ) filter ( where affect.running_credito > ac.running_debito - ac.debito and affect.running_credito - affect.credito < ac.running_debito ) as affects_apply\n    from tweeks.vregularizacao ac\n        inner join tweeks.vregularizacao affect on affect.operacao != ac.operacao and (\n          ( affect.running_credito > ac.running_debito - ac.debito and affect.running_credito - affect.credito < ac.running_debito )\n          or ( ac.running_credito > affect.running_debito - affect.debito and ac.running_credito - ac.credito < affect.running_debito )\n        )\n      where ac.id = any ( lancamentos )\n      group by\n        ac.id,\n        ac.credito,\n        ac.debito,\n        ac.operacao,\n        ac.client,\n        ac.branch,\n        ac.tconta,\n        ac.value,\n        ac.time,\n        ac.running_credito,\n        ac.running_debito,\n        ac.running_operacao,\n        ac.running_reverse,\n        ac.running_saldo,\n        ac.before_saldo,\n        ac.before_credito,\n        ac.before_debito,\n        ac.documento,\n        ac.montante,\n        ac.sequencia\n      order by ac.sequencia\n  loop\n    __regulariza.lancamento := _record.id;\n    __regulariza.credito := _record.credito;\n    __regulariza.debito := _record.debito;\n    __regulariza.running_credito := _record.running_credito;\n    __regulariza.running_debito := _record.running_debito;\n    __regulariza.running_saldo := _record.running_saldo;\n    __regulariza.before_saldo := _record.before_saldo;\n    __regulariza.before_debito := _record.before_debito;\n    __regulariza.before_credito := _record.before_credito;\n    __regulariza.affects := _record.affects;\n    __regulariza.affects_document := _record.affects_document;\n    __regulariza.time := _record.time;\n\n    -- Quando for credito\n    if _record.operacao = 1  then\n      __regulariza.affects_values := _record.affects_debitos;\n\n    -- Quando for debito\n    elseif _record.operacao = -1 then\n      __regulariza.affects_values := _record.affects_credito;\n    end if;\n\n    __regulariza.affects_apply := _record.affects_apply;\n\n    __regulariza.client := _record.client;\n    __regulariza.branch := _record.branch;\n    __regulariza.operacao := _record.operacao;\n    __regulariza.tconta := _record.tconta;\n    return next;\n  end loop;\nend;\n$$;\n\nrefresh materialized view concurrently tweeks.vregularizacao;\nvacuum full verbose ;\n\n	drop materialized view if exists tweeks.vregularizacao; create materialized view tweeks.vregularizacao as with data as ( select l.lancamento_id as id, l.lancamento_credito as credito, l.lancamento_debito as debito, l.lancamento_montante as montante, l.lancamento_valor as value, row_number() over ( order by l.lancamento_dataregistro, l.lancamento_sequencia) as sequencia, l.lancamento_dataregistro as time, l.lancamento_operacao as operacao, l._branch_uid as branch, l.lancamento_cliente_id as client, l._tgrupo_id as tconta, l.lancamento_documento as documento from tweeks.lancamento l where l.lancamento_estado = (map.constant()).maguita_lancamento_estado_ativo and ( tweeks.viewarg('branch')::uuid is null or l._branch_uid = tweeks.viewarg('branch')::uuid ) and ( tweeks.viewarg('client')::uuid is null or l.lancamento_cliente_id = tweeks.viewarg('client')::uuid ) and ( tweeks.viewarg('tconta')::int is null or l._tgrupo_id = tweeks.viewarg('tconta')::int ) order by l.lancamento_dataregistro, l.lancamento_sequencia ), __regularizacao as ( select l.credito, l.debito, l.montante, sum(l.credito ) over ( partition by l.branch, l.tconta, l.client order by l.sequencia rows between unbounded preceding and current row ) as running_credito, sum(l.debito ) over ( partition by l.branch, l.tconta, l.client order by l.sequencia rows between unbounded preceding and current row ) as running_debito, l.id, l.operacao, l.sequencia, l.time, l.branch, l.client, l.documento, l.value, l.tconta from data l order by l.time, l.sequencia ) select re.*, re.running_credito - re.running_debito as running_saldo, ( re.running_credito - re.running_debito ) + ( re.montante * -1 )as before_saldo, case when re.operacao = 1 then ( re.running_credito ) - ( re.credito ) else re.running_credito end as before_credito, case when re.operacao = -1 then ( re.running_debito ) - ( re.debito ) else re.running_debito end as before_debito, case re.operacao when 1 then re.running_credito else re.running_debito end running_operacao, case re.operacao when 1 then re.running_debito else re.running_credito end running_reverse from __regularizacao re; create index idx_vregularizacao_operacao on tweeks.vregularizacao ( operacao ); create unique index idx_vregularizacao_sequencia on tweeks.vregularizacao ( sequencia ); create index idx_vregularizacao on tweeks.vregularizacao ( running_credito, running_debito, credito, debito, operacao ); create unique index idx_vregularizacao_identifier on tweeks.vregularizacao ( id ); drop function if exists tweeks.__regulariza( variadic lancamentos uuid[] ) cascade ; create or replace function tweeks.__regulariza( variadic lancamentos uuid[] ) returns table( lancamento uuid, credito double precision, debito double precision, running_credito double precision, running_debito double precision, running_saldo double precision, before_saldo double precision, before_credito double precision, before_debito double precision, affects uuid[], affects_values numeric[], affects_apply numeric[], affects_document jsonb, "time" timestamptz, client uuid, branch uuid, operacao int, tconta int ) language plpgsql as $$ declare _record record; _value double precision; begin for _record in select ac.*, jsonb_agg( jsonb_build_object( 'doc', affect.documento )) filter ( where affect.running_credito > ac.running_debito - ac.debito and affect.running_credito - affect.credito < ac.running_debito ) as affects_document, array_agg( affect.id ) filter ( where affect.running_credito > ac.running_debito - ac.debito and affect.running_credito - affect.credito < ac.running_debito ) as affects, array_agg( affect.credito::numeric ) filter ( where affect.running_credito > ac.running_debito - ac.debito and affect.running_credito - affect.credito < ac.running_debito ) as affects_credito, array_agg( affect.debito::numeric ) filter ( where ac.running_credito > affect.running_debito - affect.debito and ac.running_credito - ac.credito < affect.running_debito ) as affects_debitos, array_agg( (affect.running_credito - ac.before_debito) - ( case when affect.running_credito - ac.running_debito >= 0 then affect.running_credito - ac.running_debito else 0 end ) - ( case when affect.before_credito - ac.before_debito > 0 then affect.before_credito - ac.before_debito else 0 end ) ) filter ( where affect.running_credito > ac.running_debito - ac.debito and affect.running_credito - affect.credito < ac.running_debito ) as affects_apply from tweeks.vregularizacao ac inner join tweeks.vregularizacao affect on affect.operacao != ac.operacao and ( ( affect.running_credito > ac.running_debito - ac.debito and affect.running_credito - affect.credito < ac.running_debito ) or ( ac.running_credito > affect.running_debito - affect.debito and ac.running_credito - ac.credito < affect.running_debito ) ) where ac.id = any ( lancamentos ) group by ac.id, ac.credito, ac.debito, ac.operacao, ac.client, ac.branch, ac.tconta, ac.value, ac.time, ac.running_credito, ac.running_debito, ac.running_operacao, ac.running_reverse, ac.running_saldo, ac.before_saldo, ac.before_credito, ac.before_debito, ac.documento, ac.montante, ac.sequencia order by ac.sequencia loop __regulariza.lancamento := _record.id; __regulariza.credito := _record.credito; __regulariza.debito := _record.debito; __regulariza.running_credito := _record.running_credito; __regulariza.running_debito := _record.running_debito; __regulariza.running_saldo := _record.running_saldo; __regulariza.before_saldo := _record.before_saldo; __regulariza.before_debito := _record.before_debito; __regulariza.before_credito := _record.before_credito; __regulariza.affects := _record.affects; __regulariza.affects_document := _record.affects_document; __regulariza.time := _record.time; -- Quando for credito if _record.operacao = 1 then __regulariza.affects_values := _record.affects_debitos; -- Quando for debito elseif _record.operacao = -1 then __regulariza.affects_values := _record.affects_credito; end if; __regulariza.affects_apply := _record.affects_apply; __regulariza.client := _record.client; __regulariza.branch := _record.branch; __regulariza.operacao := _record.operacao; __regulariza.tconta := _record.tconta; return next; end loop; end; $$; refresh materialized view concurrently tweeks.vregularizacao; vacuum full verbose ;
898a68e8-1144-45ef-9682-bd2494710419	\ncreate table cluster.classmap(\n  classname varchar not null, \n  classnameref varchar not null,\n  status int default 1 not null,\n  constraint pk_classname primary key ( classname )\n);\n\ninsert into cluster.classmap( classname, classnameref ) values ( 'tweeks.branch', 'cluster.branch' );\n	create table cluster.classmap( classname varchar not null, classnameref varchar not null, status int default 1 not null, constraint pk_classname primary key ( classname ) ); insert into cluster.classmap( classname, classnameref ) values ( 'tweeks.branch', 'cluster.branch' );
992eb95e-4d37-4505-aecb-acc12096ad1a	\n\ncreate or replace function cluster.__format(regclass) returns character varying\n  stable\n  strict\n  language sql\nas\n$$\n  select format( '%I.%I', schemaname, tablename )\n    from pg_tables\n    where format( '%I.%I', schemaname, tablename )::regclass = $1\n$$;\n    \ncreate or replace function cluster.__rows( variadic regclass[])\n  returns table( document jsonb, reference jsonb, classname regclass )\n  language plpgsql as $$\ndeclare\n  _next record;\n  _regclass regclass;\nbegin\n\n  for _next in\n    select *\n    from unnest( $1 ) n( tname )\n    loop\n      _regclass := _next.tname::regclass;\n\n      return query execute format( $sql$\n        select\n          to_jsonb( _t ),\n          lib.sets_ref( _t ),\n          %L::regclass\n          from %s _t\n        $sql$, _regclass, _regclass ) using $2;\n    end loop;\nend;\n$$;\n    \n  create table cluster.pull (\n    pull_uid uuid default gen_random_uuid() not null,\n    pull_server jsonb not null ,\n    pull_objects jsonb not null ,\n    pull_ignores jsonb,\n    pull_result jsonb,\n    pull_total int8,\n    pull_limit int8,\n    pull_revcode character varying,\n    pull_rejected int,\n    pull_sequence bigserial not null,\n    pull_instant timestamptz default clock_timestamp(),\n    pull_status int2 default 2,\n    pull_pulled jsonb default null,\n    pull_finalize timestamp default null,\n    constraint pk_pull_uid primary key ( pull_uid )\n  );\n\n\ncreate or replace function cluster.pull(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n    /**\n      PROPOSE: Descaregar para o cluster local todas as modificações vinda dos outros cluster\n      args := {\n        server:ClusterSource,\n        objects:( ObjectRevision[] )| DynamicReducer|any,\n        ignores:cluster.ignore[]\n        result:ClusterResult[]\n        total:number\n        limit:number,\n        revCode:number,\n        rejected:number,\n      }\n    */\n    _limit int default args->>'limit';\n    _server cluster.cluster;\n    _cluster cluster.cluster;\n    _local cluster.cluster;\n    _data record;\n    _i record;\n    _obj jsonb default args->'objects';\n    _objests cluster.object[] default array[]::cluster.object[];\n    _next cluster.object;\n    _pull cluster.pull;\n  begin\n    _pull.pull_server     :=  args->'server';\n    _pull.pull_objects    :=  args->'objects';\n    _pull.pull_ignores    :=  args->'ignores';\n    _pull.pull_result     :=  args->'result';\n    _pull.pull_total      :=  args->>'total';\n    _pull.pull_limit      :=  args->>'limit';\n    _pull.pull_revcode    :=  args->>'revCode';\n    _pull.pull_rejected   :=  args->>'rejected';\n    \n    select ( "returning" ).* into _pull\n      from lib.sets_in( _pull )\n    ;\n    \n    _server := jsonb_populate_record( _server, args->'server');\n    _cluster := cluster._get_cluster( _server.cluster_identifier );\n    _local := cluster._get_cluster_local(  );\n\n    with __object as (\n      select o.*\n        from jsonb_array_elements( _obj ) e( document )\n          inner join jsonb_populate_record( null::cluster.object, e.document ) o on true\n    ) select max( _o.object_seq ) as _cluster_sequence\n      into _data\n        from __object _o\n    ;\n\n    set session_replication_role to replica;\n\n    for _i in\n      with __map as (\n        select\n            obj as _object,\n            col as _collector,\n            ( e.document->>'_origin_identifier' ) as _origin_identifier,\n            coalesce( cmp.classnameref, e.document->>'_regclass' ) as _classname,\n            e.document->'_change' as _change,\n            e.document->>'_result' as _result,\n            ( e.document->>'_regclass' )::regclass as _regclass,\n            col.collector_uid as current_collector_uid,\n            col.collector_transuid as current_transuid\n          from jsonb_array_elements( args->'objects' ) e ( document )\n            inner join jsonb_populate_record( null::cluster.object, e.document ) as obj on true\n            inner join jsonb_populate_record( null::cluster.collector, e.document ) as col on true\n            left join cluster.classmap cmp on e.document->>'_regclass' = cmp.classname\n      ), __objects as (\n        select\n            v.*,\n            co.cluster_uid as _origin,\n            _cluster.cluster_uid as _receiver,\n            ( v._object ).object_ref,\n            ( v._object ).object_date,\n            ( v._object ).object_uid,\n            ( v._collector ).collector_uid,\n            ( v._collector ).collector_transuid\n          from __map v\n            inner join cluster.cluster co on co.cluster_identifier =  v._origin_identifier\n\n    ), __classnames as (\n        select array_agg( distinct  mp._classname) as allclass\n        from __map mp\n    \n      ), __row as (\n        select _r.*\n          from __classnames\n          inner join cluster.__rows( variadic allclass ) _r on true\n\n      ), __current as (\n        select\n            _up.object_ref,\n            _up._classname,\n            e.document as _current,\n            max( ob.object_date ) as date\n          from __objects _up\n            left join __row e  on e.classname = _up._regclass\n              and e.reference = _up.object_ref \n            left join cluster.object ob on ob.object_share_regclass = _up._classname\n              and ob.object_ref = _up.object_ref\n          group by\n            _up.object_ref,\n            _up._classname,\n            e.document\n          \n      ), __new as (\n        select\n            _ob.*,\n            _cur.*,\n            _created_object.object_uid is not null as _exists_object,\n            _create_collector.collector_uid is not null _exists_collector,\n            _cur._current is null as _exists_ref,\n            (\n                _cur._current is not null -- Desatualiazado: Quando já existir previamente a instancia do objecto na tabela\n                and _cur.date is not null -- Desatualiazado: & Quando ja existir pelo menus algum objecto para essa referencia\n                and _cur.date > _ob.object_date -- Desatualizado: & Quando a data a instancia atual for superior a data do objecto recebido\n\n--               not all: _cur._current is null -- Quando ainda não existir a instancia do dado na tabela\n--               or  _cur.date is null -- Ainda não existir nenhuma revisão para a referencia do objecto\n--               or _cur.date < _ob.object_date -- Data da ultima revisão registrada for inferior a data da reisão recebida\n            ) as _outdate\n          from __objects _ob\n            inner join __current _cur on _ob.object_ref = _cur.object_ref and _ob._classname = _cur._classname\n\n            -- object_uid, object_share_regclass, object_cluster_origin\n            left join cluster.object _created_object on\n              ( _ob ).object_uid = _created_object.object_uid\n              and ( _ob ).collector_transuid = _created_object.object_transuid\n              and _cur._classname = _created_object.object_share_regclass\n              and ( _ob )._origin = _created_object.object_cluster_origin\n\n            -- collector_uid, collector_transuid, collector_share_regclass, collector_cluster_origin\n            left join cluster.collector _create_collector on\n              ( _ob ).collector_uid = _create_collector.collector_uid\n              and ( _ob ).collector_transuid = _create_collector.collector_transuid\n              and _cur._classname  = _create_collector.collector_share_regclass\n              and ( _ob )._origin = _create_collector.collector_cluster_origin\n        ) select  *\n      from __new\n    loop\n      _next := cluster.__pull( to_jsonb( _i ) );\n      if _next.object_uid is not null then\n        _objests := _objests || _next;\n      end if;\n\n    end loop;\n    set session_replication_role to default;\n\n    return query\n      with __object as (\n        select (o::cluster.object).*\n          from unnest( _objests ) o\n      ), __collector as (\n        select\n            _o.*,\n            c.*,\n            _o.object_share_regclass as _regclass,\n            cc.cluster_identifier as _origin_identifier\n          from __object _o\n          inner join cluster.collector c on _o.object_collector_uid = c.collector_uid\n            and _o.object_transuid = c.collector_transuid\n            and _o.object_cluster_origin = c.collector_cluster_origin\n          inner join cluster.cluster cc on _o.object_cluster_origin = cc.cluster_uid\n      )select to_jsonb( _c )\n        from __collector _c\n    ;\n\n    -- Atualizar a versão do cluster\n    with\n    __result as (\n      select\n          pc.cluster_identifier,\n          coalesce( pc.cluster_version, 0 ) as cluster_version,\n          coalesce( pc.cluster_sequence, 0 ) as cluster_sequence\n        from jsonb_array_elements( args->'result') e( doc )\n          inner join jsonb_populate_record( null::cluster.cluster, e.doc ) pc on true\n    ), __clusters as (\n      select\n          c.cluster_identifier,\n          c.cluster_sequence,\n          max( o.object_origincver ) as object_origincver,\n          max( o.object_seq ) as object_seq\n        from cluster.object o\n          inner join cluster.cluster c on c.cluster_uid = o.object_cluster_origin\n        where o.object_cluster_origin != _local.cluster_uid\n        group by c.cluster_uid\n\n    ), __status as (\n      select\n          _r.cluster_identifier,\n          case\n            when _c.cluster_identifier = _server.cluster_identifier then _r.cluster_version\n            when _c.object_origincver >= _r.cluster_version then _c.object_origincver\n            else _r.cluster_version\n          end as cluster_version,\n          case\n            when _c.cluster_identifier = _server.cluster_identifier then _r.cluster_sequence\n            when _c.cluster_sequence >= _r.cluster_sequence then _c.cluster_sequence\n            else _r.cluster_sequence\n          end as cluster_sequence\n        from __clusters _c\n          inner join __result _r on _c.cluster_identifier = _r.cluster_identifier\n\n    ) update cluster.cluster c\n        set\n          cluster_version = _s.cluster_version,\n          cluster_sequence = _s.cluster_sequence,\n          cluster_verbose = case\n            when _s.cluster_identifier = _cluster.cluster_identifier\n              and _limit is not null\n              and _limit > jsonb_array_length( _obj ) then false\n            else c.cluster_verbose\n          end\n        from __status _s\n        where c.cluster_identifier = _s.cluster_identifier\n    ;\n\n    with __ignore as (\n      select _pi.*\n        from jsonb_array_elements( args->'ignores' ) e( doc )\n          inner join jsonb_populate_record( null::cluster.ignore, e.doc ) _pi on true\n    ) insert into cluster.ignore\n        select _ignor.*\n        from __ignore _ignor\n    ;\n    \n    update cluster.pull\n      set pull_status = 1,\n          pull_pulled = to_jsonb( _objests )\n      where pull_uid = _pull.pull_uid;\n\n    return query\n      with __clusters as (\n        select\n            c.cluster_identifier,\n            c.cluster_name,\n            c.cluster_path,\n            c.cluster_version,\n            c.cluster_sequence\n          from cluster.cluster c\n      ) select jsonb_agg( _c )\n        from __clusters _c;\n  end;\n$$;\n	create or replace function cluster.__format(regclass) returns character varying stable strict language sql as $$ select format( '%I.%I', schemaname, tablename ) from pg_tables where format( '%I.%I', schemaname, tablename )::regclass = $1 $$; create or replace function cluster.__rows( variadic regclass[]) returns table( document jsonb, reference jsonb, classname regclass ) language plpgsql as $$ declare _next record; _regclass regclass; begin for _next in select * from unnest( $1 ) n( tname ) loop _regclass := _next.tname::regclass; return query execute format( $sql$ select to_jsonb( _t ), lib.sets_ref( _t ), %L::regclass from %s _t $sql$, _regclass, _regclass ) using $2; end loop; end; $$; create table cluster.pull ( pull_uid uuid default gen_random_uuid() not null, pull_server jsonb not null , pull_objects jsonb not null , pull_ignores jsonb, pull_result jsonb, pull_total int8, pull_limit int8, pull_revcode character varying, pull_rejected int, pull_sequence bigserial not null, pull_instant timestamptz default clock_timestamp(), pull_status int2 default 2, pull_pulled jsonb default null, pull_finalize timestamp default null, constraint pk_pull_uid primary key ( pull_uid ) ); create or replace function cluster.pull(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** PROPOSE: Descaregar para o cluster local todas as modificações vinda dos outros cluster args := { server:ClusterSource, objects:( ObjectRevision[] )| DynamicReducer|any, ignores:cluster.ignore[] result:ClusterResult[] total:number limit:number, revCode:number, rejected:number, } */ _limit int default args->>'limit'; _server cluster.cluster; _cluster cluster.cluster; _local cluster.cluster; _data record; _i record; _obj jsonb default args->'objects'; _objests cluster.object[] default array[]::cluster.object[]; _next cluster.object; _pull cluster.pull; begin _pull.pull_server := args->'server'; _pull.pull_objects := args->'objects'; _pull.pull_ignores := args->'ignores'; _pull.pull_result := args->'result'; _pull.pull_total := args->>'total'; _pull.pull_limit := args->>'limit'; _pull.pull_revcode := args->>'revCode'; _pull.pull_rejected := args->>'rejected'; select ( "returning" ).* into _pull from lib.sets_in( _pull ) ; _server := jsonb_populate_record( _server, args->'server'); _cluster := cluster._get_cluster( _server.cluster_identifier ); _local := cluster._get_cluster_local( ); with __object as ( select o.* from jsonb_array_elements( _obj ) e( document ) inner join jsonb_populate_record( null::cluster.object, e.document ) o on true ) select max( _o.object_seq ) as _cluster_sequence into _data from __object _o ; set session_replication_role to replica; for _i in with __map as ( select obj as _object, col as _collector, ( e.document->>'_origin_identifier' ) as _origin_identifier, coalesce( cmp.classnameref, e.document->>'_regclass' ) as _classname, e.document->'_change' as _change, e.document->>'_result' as _result, ( e.document->>'_regclass' )::regclass as _regclass, col.collector_uid as current_collector_uid, col.collector_transuid as current_transuid from jsonb_array_elements( args->'objects' ) e ( document ) inner join jsonb_populate_record( null::cluster.object, e.document ) as obj on true inner join jsonb_populate_record( null::cluster.collector, e.document ) as col on true left join cluster.classmap cmp on e.document->>'_regclass' = cmp.classname ), __objects as ( select v.*, co.cluster_uid as _origin, _cluster.cluster_uid as _receiver, ( v._object ).object_ref, ( v._object ).object_date, ( v._object ).object_uid, ( v._collector ).collector_uid, ( v._collector ).collector_transuid from __map v inner join cluster.cluster co on co.cluster_identifier = v._origin_identifier ), __classnames as ( select array_agg( distinct mp._classname) as allclass from __map mp ), __row as ( select _r.* from __classnames inner join cluster.__rows( variadic allclass ) _r on true ), __current as ( select _up.object_ref, _up._classname, e.document as _current, max( ob.object_date ) as date from __objects _up left join __row e on e.classname = _up._regclass and e.reference = _up.object_ref left join cluster.object ob on ob.object_share_regclass = _up._classname and ob.object_ref = _up.object_ref group by _up.object_ref, _up._classname, e.document ), __new as ( select _ob.*, _cur.*, _created_object.object_uid is not null as _exists_object, _create_collector.collector_uid is not null _exists_collector, _cur._current is null as _exists_ref, ( _cur._current is not null -- Desatualiazado: Quando já existir previamente a instancia do objecto na tabela and _cur.date is not null -- Desatualiazado: & Quando ja existir pelo menus algum objecto para essa referencia and _cur.date > _ob.object_date -- Desatualizado: & Quando a data a instancia atual for superior a data do objecto recebido -- not all: _cur._current is null -- Quando ainda não existir a instancia do dado na tabela -- or _cur.date is null -- Ainda não existir nenhuma revisão para a referencia do objecto -- or _cur.date < _ob.object_date -- Data da ultima revisão registrada for inferior a data da reisão recebida ) as _outdate from __objects _ob inner join __current _cur on _ob.object_ref = _cur.object_ref and _ob._classname = _cur._classname -- object_uid, object_share_regclass, object_cluster_origin left join cluster.object _created_object on ( _ob ).object_uid = _created_object.object_uid and ( _ob ).collector_transuid = _created_object.object_transuid and _cur._classname = _created_object.object_share_regclass and ( _ob )._origin = _created_object.object_cluster_origin -- collector_uid, collector_transuid, collector_share_regclass, collector_cluster_origin left join cluster.collector _create_collector on ( _ob ).collector_uid = _create_collector.collector_uid and ( _ob ).collector_transuid = _create_collector.collector_transuid and _cur._classname = _create_collector.collector_share_regclass and ( _ob )._origin = _create_collector.collector_cluster_origin ) select * from __new loop _next := cluster.__pull( to_jsonb( _i ) ); if _next.object_uid is not null then _objests := _objests || _next; end if; end loop; set session_replication_role to default; return query with __object as ( select (o::cluster.object).* from unnest( _objests ) o ), __collector as ( select _o.*, c.*, _o.object_share_regclass as _regclass, cc.cluster_identifier as _origin_identifier from __object _o inner join cluster.collector c on _o.object_collector_uid = c.collector_uid and _o.object_transuid = c.collector_transuid and _o.object_cluster_origin = c.collector_cluster_origin inner join cluster.cluster cc on _o.object_cluster_origin = cc.cluster_uid )select to_jsonb( _c ) from __collector _c ; -- Atualizar a versão do cluster with __result as ( select pc.cluster_identifier, coalesce( pc.cluster_version, 0 ) as cluster_version, coalesce( pc.cluster_sequence, 0 ) as cluster_sequence from jsonb_array_elements( args->'result') e( doc ) inner join jsonb_populate_record( null::cluster.cluster, e.doc ) pc on true ), __clusters as ( select c.cluster_identifier, c.cluster_sequence, max( o.object_origincver ) as object_origincver, max( o.object_seq ) as object_seq from cluster.object o inner join cluster.cluster c on c.cluster_uid = o.object_cluster_origin where o.object_cluster_origin != _local.cluster_uid group by c.cluster_uid ), __status as ( select _r.cluster_identifier, case when _c.cluster_identifier = _server.cluster_identifier then _r.cluster_version when _c.object_origincver >= _r.cluster_version then _c.object_origincver else _r.cluster_version end as cluster_version, case when _c.cluster_identifier = _server.cluster_identifier then _r.cluster_sequence when _c.cluster_sequence >= _r.cluster_sequence then _c.cluster_sequence else _r.cluster_sequence end as cluster_sequence from __clusters _c inner join __result _r on _c.cluster_identifier = _r.cluster_identifier ) update cluster.cluster c set cluster_version = _s.cluster_version, cluster_sequence = _s.cluster_sequence, cluster_verbose = case when _s.cluster_identifier = _cluster.cluster_identifier and _limit is not null and _limit > jsonb_array_length( _obj ) then false else c.cluster_verbose end from __status _s where c.cluster_identifier = _s.cluster_identifier ; with __ignore as ( select _pi.* from jsonb_array_elements( args->'ignores' ) e( doc ) inner join jsonb_populate_record( null::cluster.ignore, e.doc ) _pi on true ) insert into cluster.ignore select _ignor.* from __ignore _ignor ; update cluster.pull set pull_status = 1, pull_pulled = to_jsonb( _objests ) where pull_uid = _pull.pull_uid; return query with __clusters as ( select c.cluster_identifier, c.cluster_name, c.cluster_path, c.cluster_version, c.cluster_sequence from cluster.cluster c ) select jsonb_agg( _c ) from __clusters _c; end; $$;
921c873a-1ec8-4e98-843c-513fe035e48c	\ncreate or replace function tweeks.___override_auth_funct_autenticacao(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    Essa funcao serve para autenticar um colaborador\n    no final da autenticacao sera devolvido as informacoes basica do colaborador\n    args :{\n      arg_auth_name: id | nif | email\n      arg_auth_value: VALUE_OF_AUTH_NAME,\n      arg_auth_method: senha | pin,\n      arg_auth_key: VALUE_OF_AUTH_METHOD\n    }\n */\n  _auth record;\n  espacos jsonb;\n  ___branch tweeks.branch;\n  _const map.constant;\nbegin\n  _const := map.constant();\n\n  select * into _auth\n    from auth.funct_autenticacao( args );\n\n  -- Quando o colaborador tiver accesso\n  if _auth.colaborador_id is not null then\n    ___branch := tweeks.__get_branch( tweeks.__branch_uid(\n      _auth.colaborador_id\n    ));\n\n    if ___branch.branch_uid is not null then\n      _auth.acesso := to_jsonb(array(\n        select e.grants\n          from auth.funct_load_grants(jsonb_build_object(\n            'menus', ___branch.branch_grants->'menu',\n            'colaborador_id', _auth.colaborador_id\n          )) e( grants )\n      ));\n    end if;\n\n    return query\n      with __trabaha as (\n          select array_agg( to_jsonb( tr ) || to_jsonb( es ) ) as espaco_trabalha\n            from tweeks.trabalha tr\n              inner join tweeks.espaco es on tr.trabalha_espaco_destino = es.espaco_id\n                and tr.trabalha_colaborador_proprietario = _auth.colaborador_id\n            where tr.trabalha_estado = _const.maguita_trabalha_estado_ativo\n              and es.espaco_estado = _const.maguita_espaco_estado_ativo\n      ) select jsonb_build_object(\n            'auth', _auth,\n            'espaco_trabalha', tr.espaco_trabalha\n          )\n        from __trabaha tr\n      ;\n\n    return query with\n      __clusters as ( select c.cluster_uid, c.cluster_identifier, c.cluster_name, c.cluster_path  from cluster.cluster c ),\n      __branch as (\n        select\n              b.branch_uid,\n              b.branch_path,\n              b.branch_clusters,\n              b.branch_main_user,\n              b.branch_main_workspace,\n              b.branch_grants,\n              b.branch_name,\n              b.branch_licence,\n              b.branch_state,\n              b.branch_date,\n              tb.tbranch_id,\n              tb.tbranch_configs,\n              tb.tbranch_name,\n              e.espaco_id,\n              e.espaco_nome,\n              e.espaco_nivel,\n              e.espaco_codigo,\n              cmain.colaborador_id,\n              cmain.colaborador_nome,\n              cmain.colaborador_apelido,\n              cmain.colaborador_email,\n              cmain.colaborador_estado,\n              cmain.colaborador_accesso,\n              cmain.colaborador_tipo,\n              array_agg( _clus ) as clusters\n\n          from auth.colaborador cauth\n            inner join cluster.branch b on cauth.colaborador_branch_uid = b.branch_uid\n            inner join tweeks.tbranch tb on b.branch_tbranch_id = tb.tbranch_id\n            inner join tweeks.espaco e on b.branch_uid = e.espaco_branch_uid\n              and e.espaco_id = b.branch_main_workspace\n            inner join auth.colaborador cmain on b.branch_uid = cmain.colaborador_branch_uid\n              and cmain.colaborador_id = b.branch_main_user\n            left join __clusters _clus on _clus.cluster_path = b.branch_path\n              and ( b.branch_clusters is null or _clus.cluster_identifier = any( b.branch_clusters ) )\n          where cauth.colaborador_id = _auth.colaborador_id\n          group by\n            cauth.colaborador_id,\n            b.branch_uid,\n            e.espaco_id,\n            cmain.colaborador_id,\n            tb.tbranch_id\n      ) select to_jsonb( _b )\n        from __branch _b;\n  end if;\nend;\n$$;\n	create or replace function tweeks.___override_auth_funct_autenticacao(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** Essa funcao serve para autenticar um colaborador no final da autenticacao sera devolvido as informacoes basica do colaborador args :{ arg_auth_name: id | nif | email arg_auth_value: VALUE_OF_AUTH_NAME, arg_auth_method: senha | pin, arg_auth_key: VALUE_OF_AUTH_METHOD } */ _auth record; espacos jsonb; ___branch tweeks.branch; _const map.constant; begin _const := map.constant(); select * into _auth from auth.funct_autenticacao( args ); -- Quando o colaborador tiver accesso if _auth.colaborador_id is not null then ___branch := tweeks.__get_branch( tweeks.__branch_uid( _auth.colaborador_id )); if ___branch.branch_uid is not null then _auth.acesso := to_jsonb(array( select e.grants from auth.funct_load_grants(jsonb_build_object( 'menus', ___branch.branch_grants->'menu', 'colaborador_id', _auth.colaborador_id )) e( grants ) )); end if; return query with __trabaha as ( select array_agg( to_jsonb( tr ) || to_jsonb( es ) ) as espaco_trabalha from tweeks.trabalha tr inner join tweeks.espaco es on tr.trabalha_espaco_destino = es.espaco_id and tr.trabalha_colaborador_proprietario = _auth.colaborador_id where tr.trabalha_estado = _const.maguita_trabalha_estado_ativo and es.espaco_estado = _const.maguita_espaco_estado_ativo ) select jsonb_build_object( 'auth', _auth, 'espaco_trabalha', tr.espaco_trabalha ) from __trabaha tr ; return query with __clusters as ( select c.cluster_uid, c.cluster_identifier, c.cluster_name, c.cluster_path from cluster.cluster c ), __branch as ( select b.branch_uid, b.branch_path, b.branch_clusters, b.branch_main_user, b.branch_main_workspace, b.branch_grants, b.branch_name, b.branch_licence, b.branch_state, b.branch_date, tb.tbranch_id, tb.tbranch_configs, tb.tbranch_name, e.espaco_id, e.espaco_nome, e.espaco_nivel, e.espaco_codigo, cmain.colaborador_id, cmain.colaborador_nome, cmain.colaborador_apelido, cmain.colaborador_email, cmain.colaborador_estado, cmain.colaborador_accesso, cmain.colaborador_tipo, array_agg( _clus ) as clusters from auth.colaborador cauth inner join cluster.branch b on cauth.colaborador_branch_uid = b.branch_uid inner join tweeks.tbranch tb on b.branch_tbranch_id = tb.tbranch_id inner join tweeks.espaco e on b.branch_uid = e.espaco_branch_uid and e.espaco_id = b.branch_main_workspace inner join auth.colaborador cmain on b.branch_uid = cmain.colaborador_branch_uid and cmain.colaborador_id = b.branch_main_user left join __clusters _clus on _clus.cluster_path = b.branch_path and ( b.branch_clusters is null or _clus.cluster_identifier = any( b.branch_clusters ) ) where cauth.colaborador_id = _auth.colaborador_id group by cauth.colaborador_id, b.branch_uid, e.espaco_id, cmain.colaborador_id, tb.tbranch_id ) select to_jsonb( _b ) from __branch _b; end if; end; $$;
9b205af3-801b-4a9b-95a1-ac9582664705	\n    drop table if exists tweeks.stock;\n    drop view if exists tweeks.stock;\n	drop table if exists tweeks.stock; drop view if exists tweeks.stock;
5e01ae67-cd68-431e-993f-d3ec4c46ae20	\ncreate or replace view tweeks.stock as\n  with __stock_in as (\n    select f.fluxo_espaco_in, f.fluxo_artigo_in, coalesce( sum( f.fluxo_quantidadein ), 0 ) as entrada_quantidade, count(*) as entradas\n      from tweeks.fluxo f\n      group by f.fluxo_artigo_in,\n        f.fluxo_espaco_in\n  ), __stock_out as(\n    select f.fluxo_artigo_out, f.fluxo_espaco_out, coalesce( sum( f.fluxo_quantidadeout ), 0 ) saida_quantidade, count(*) as saidas\n      from tweeks.fluxo f\n      group by f.fluxo_artigo_out,\n        f.fluxo_espaco_out\n  ), __armazems as (\n    select distinct\n        e.espaco_id,\n        a.artigo_id\n      from tweeks.espaco e\n        inner join tweeks.artigo a on e._branch_uid = a._branch_uid\n  ),  __stock as (\n    select _a.*,\n           si.*,\n           so.*,\n           coalesce( coalesce( si.entrada_quantidade, 0 ) - coalesce( so.saida_quantidade,  0 ), 0 ) as stock_quantidade\n      from __armazems _a\n        left join __stock_in si on _a.espaco_id = si.fluxo_espaco_in\n          and _a.artigo_id = si.fluxo_artigo_in\n        left join __stock_out so on _a.espaco_id = so.fluxo_espaco_out\n          and _a.artigo_id = so.fluxo_artigo_out\n  )\n  select * from __stock; 	create or replace view tweeks.stock as with __stock_in as ( select f.fluxo_espaco_in, f.fluxo_artigo_in, coalesce( sum( f.fluxo_quantidadein ), 0 ) as entrada_quantidade, count(*) as entradas from tweeks.fluxo f group by f.fluxo_artigo_in, f.fluxo_espaco_in ), __stock_out as( select f.fluxo_artigo_out, f.fluxo_espaco_out, coalesce( sum( f.fluxo_quantidadeout ), 0 ) saida_quantidade, count(*) as saidas from tweeks.fluxo f group by f.fluxo_artigo_out, f.fluxo_espaco_out ), __armazems as ( select distinct e.espaco_id, a.artigo_id from tweeks.espaco e inner join tweeks.artigo a on e._branch_uid = a._branch_uid ), __stock as ( select _a.*, si.*, so.*, coalesce( coalesce( si.entrada_quantidade, 0 ) - coalesce( so.saida_quantidade, 0 ), 0 ) as stock_quantidade from __armazems _a left join __stock_in si on _a.espaco_id = si.fluxo_espaco_in and _a.artigo_id = si.fluxo_artigo_in left join __stock_out so on _a.espaco_id = so.fluxo_espaco_out and _a.artigo_id = so.fluxo_artigo_out ) select * from __stock;
ea51fbb6-8e42-4a30-816d-d2f9ede3fec9	\ncreate or replace function tweeks._get_stock( _artigo_id uuid, _espaco_id uuid)\n  returns TABLE(stock_artigo_id uuid, stock_espaco_id uuid, stock_quantidade double precision)\n  strict\n  language sql\nas\n$$\n  select s.artigo_id, s.espaco_id, sum( s.stock_quantidade )::double precision\n    from tweeks.stock s\n    where s.artigo_id = coalesce( _artigo_id, s.artigo_id )\n      and s.espaco_id = coalesce( _espaco_id, s.espaco_id)\n    group by s.artigo_id, s.espaco_id;\n$$;\n	create or replace function tweeks._get_stock( _artigo_id uuid, _espaco_id uuid) returns TABLE(stock_artigo_id uuid, stock_espaco_id uuid, stock_quantidade double precision) strict language sql as $$ select s.artigo_id, s.espaco_id, sum( s.stock_quantidade )::double precision from tweeks.stock s where s.artigo_id = coalesce( _artigo_id, s.artigo_id ) and s.espaco_id = coalesce( _espaco_id, s.espaco_id) group by s.artigo_id, s.espaco_id; $$;
d857fbc9-9933-452e-8a18-5cf19b7967f2	\ncreate or replace function tweeks.funct_load_artigo(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n    /**\n        Essa função serve para carregar os artigos registrado\n        args := {\n          arg_espaco_auth: ID\n          arg_colaborador_id: ID\n          arg_classe_id: ID\n          arg_artigo_estado: ARTIGO_ESTADO\n          query: {\n            any?: CODE|NAME|DESCRICAO\n            code?: CODE\n            name?: NAME\n            desc?: DESCRICAO\n          }\n        }\n   */\n    arg_espaco_auth uuid default args->>'arg_espaco_auth';\n    arg_colaborador_id uuid default args->>'arg_colaborador_id';\n    arg_espaco_childs uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth );\n    arg_classe_id uuid default args->>'arg_classe_id';\n    arg_artigo_estado int2 default args->>'arg_artigo_estado';\n\n    _query_any text  default lower( args->'query'->>'any' );\n    _query_code text default lower( args->'query'->>'code' );\n    _query_name text default lower( args->'query'->>'name' );\n    _query_desc text default lower( args->'query'->>'desc' );\n    _const map.constant;\n    _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\nbegin\n    _const := map.constant();\n\n    /**\n      ID, NOME, STOCK, PRECO, [STOK-MINIMO], FOTO\n     */\n    return query\n        with\n          __artigo as (\n            select\n                art.artigo_id,\n                art.artigo_codigo,\n                art.artigo_descricao,\n                art.artigo_nome,\n                art.artigo_compostoquantidade,\n                art.artigo_artigo_id,\n\n                art.artigo_espaco_auth = any( arg_espaco_childs ) as artigo_owner,\n                s.stock_quantidade,\n                art.artigo_foto,\n                art.artigo_espaco_auth,\n                art.artigo_classe_id,\n                art.artigo_estado,\n                art.artigo_stocknegativo,\n                origin.artigo_id as origin_id,\n                origin.artigo_codigo as origin_codigo,\n                origin.artigo_descricao as orign_descricao,\n                origin.artigo_nome as origin_nome,\n                origin.artigo_compostoquantidade as orign_compostoquantidade,\n                origin.artigo_artigo_id as origin_origin_id,\n\n                coalesce( array_agg( l.link_espaco_destino ) filter ( where l.link_id is not null ), array[]::uuid[] )  as links,\n                ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'precario_custo' as precario_custo,\n                ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'precario_quantidade' as precario_quantidade,\n                ( ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'stock_minimo' )::double precision as link_stockminimo\n              from tweeks.artigo art\n                left join tweeks.artigo origin on art.artigo_artigo_id = origin.artigo_id\n                left join tweeks.link l on l.link_estado = _const.maguita_link_estado_ativo\n                  and l.link_referencia = rule.artigo_referencia( art.artigo_id )\n                  and l.link_espaco_destino = any( arg_espaco_childs )\n                  and l.link_tlink_id = _const.maguita_tlink_preco\n                  and l._branch_uid = _branch\n                left join tweeks.stock s on art.artigo_id = s.artigo_id and s.espaco_id = arg_espaco_auth\n              where art._branch_uid = _branch\n              group by art.artigo_id,\n                 origin.artigo_id,\n                s.stock_quantidade\n          ), __filter as (\n            select *,\n                coalesce( art.link_stockminimo ) as stock_minimo\n              from __artigo art\n              where ( coalesce( art.links, array[]::uuid[] )||art.artigo_espaco_auth ) && arg_espaco_childs\n                and art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id )\n                and art.artigo_estado = coalesce( arg_artigo_estado, art.artigo_estado )\n         ), __filter_query as (\n            select *\n            from __filter f\n            where arg_classe_id is not null or f.artigo_classe_id != _const.classe_itemextra\n            order by\n              case\n                when f.artigo_estado = _const.artigo_estado_ativo then 1\n                else 2\n              end,\n              case\n                when f.artigo_espaco_auth = arg_espaco_auth then 1\n                when f.artigo_espaco_auth = any( arg_espaco_childs ) then 2\n                else 3\n              end,\n              case\n                when stock_quantidade < f.stock_minimo then 1\n                when stock_quantidade = f.stock_minimo then 2\n                else 3\n               end,\n               f.artigo_nome\n           ), __query as (\n             select *\n                from __filter_query _f\n                where true\n                  and lower( _f.artigo_codigo ) = lower( coalesce( _query_code, _f.artigo_codigo ) )\n                  and lower( _f.artigo_nome ) like lower( format( '%%%s%%', coalesce( _query_name, _f.artigo_nome ) ) )\n                  and lower( coalesce( _f.artigo_descricao, '' ) ) like lower( format( '%%%s%%', coalesce( _query_desc, _f.artigo_descricao ) ) )\n                  and (\n                    lower( _f.artigo_codigo ) = lower( coalesce( _query_any, _f.artigo_codigo ) )\n                    or lower( _f.artigo_nome) like lower( format( '%%%s%%', coalesce( _query_any, _f.artigo_nome ) ) )\n                    or lower( coalesce( _f.artigo_descricao, '' ) ) like lower( format( '%%%s%%', coalesce( _query_any, _f.artigo_descricao, '' ) ))\n                  )\n          ) select to_jsonb( _q ) - 'links'\n              from __query _q\n    ;\nend\n$$;\n\ncreate or replace function tweeks.funct_pos_load_artigo(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    args := {\n      arg_colaborador_id: UID,\n      arg_espaco_auth: UID\n      arg_classe_id: UID\n      arg_artigo_nome:TXT\n    }\n   */\n  arg_colaborador_id uuid default args->>'arg_colaborador_id';\n  arg_classe_id uuid default args->>'arg_classe_id';\n  arg_espaco_auth uuid default args->>'arg_espaco_auth';\n  _const map.constant;\nbegin\n  _const := map.constant();\n  return query with __artigo as (\n    select\n        art.artigo_id,\n        art.artigo_classe_id,\n        art.artigo_nome,\n        art.artigo_foto,\n        art.artigo_stocknegativo,\n        art.artigo_estado,\n        s.stock_quantidade,\n        l.link_metadata,\n        count( di.dispoe_id ) as artigos_extras\n      from tweeks.artigo art\n        inner join tweeks.link l on to_jsonb( art ) @> l.link_referencia\n          and l.link_estado = _const.maguita_link_estado_ativo\n          and l.link_tlink_id = _const.maguita_tlink_preco\n          and l.link_espaco_destino = arg_espaco_auth\n        inner join tweeks.stock s on art.artigo_id = s.artigo_id and s.espaco_id = arg_espaco_auth\n        left join tweeks.dispoe di on art.artigo_id = di.dispoe_artigo_id\n          and di.dispoe_estado = _const.dispoe_estado_ativo\n      where art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id )\n      group by art.artigo_id,\n        s.stock_quantidade,\n        l.link_metadata,\n        art.artigo_stocknegativo,\n        art.artigo_nome,\n        art.artigo_foto\n      order by case\n          when s.stock_quantidade > 0 or art.artigo_stocknegativo then 1\n          else 2\n        end,\n        art.artigo_nome\n  ) select to_jsonb( a ) from __artigo a;\nend;\n$$;\n\n\ncreate or replace function tweeks.funct_pos_load_artigo_search(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    args := {\n      search_text:TXT,\n      arg_espaco_auth\n    }\n   */\n  arg_espaco_auth uuid default args->>'arg_espaco_auth';\n  _search_text character varying default args->>'search_text';\n  _const map.constant;\n  ___branch uuid;\nbegin\n  ___branch := tweeks.__branch_uid( null, arg_espaco_auth );\n\n  _const := map.constant();\n  return query with\n    __ean as( select e.ean_artigo_id, array_agg( e.ean_code ) as ean_code from tweeks.ean e where e.ean_estado = _const.maguita_ean_estado_ativo group by e.ean_artigo_id ),\n    __artigo as (\n    select\n        c.classe_id,\n        c.classe_nome,\n        art.artigo_id,\n        art.artigo_classe_id,\n        art.artigo_nome,\n        art.artigo_stocknegativo,\n        art.artigo_estado,\n        s.stock_quantidade,\n        l.link_metadata,\n        e.ean_code,\n        count( di.dispoe_id ) as artigos_extras\n      from tweeks.artigo art\n        inner join tweeks.classe c on art.artigo_classe_id = c.classe_id\n        inner join tweeks.link l on to_jsonb( art ) @> l.link_referencia\n          and l.link_estado = _const.maguita_link_estado_ativo\n          and l.link_tlink_id = _const.maguita_tlink_preco\n          and l.link_espaco_destino = arg_espaco_auth\n        inner join tweeks.stock s on s.artigo_id = art.artigo_id\n          and s.espaco_id = arg_espaco_auth\n        left join tweeks.dispoe di on art.artigo_id = di.dispoe_artigo_id\n          and di.dispoe_estado = _const.dispoe_estado_ativo\n        left join __ean e on e.ean_artigo_id = art.artigo_id\n      where art._branch_uid = ___branch\n      group by art.artigo_id,\n        c.classe_id,\n        s.stock_quantidade,\n        l.link_metadata,\n        art.artigo_stocknegativo,\n        art.artigo_nome,\n        e.ean_code\n      order by case\n          when s.stock_quantidade > 0 or art.artigo_stocknegativo then 1\n          else 2\n        end,\n        art.artigo_nome\n  ) select to_jsonb( a )\n      from __artigo a\n      where lower( a.artigo_nome ) like lower( format( '%%%s%%', _search_text ) )\n        or  _search_text = any ( a.ean_code )\n  ;\nend;\n$$;\n\n\ndrop function if exists funct_pos_load_caixa_auaaath(args jsonb);\ndrop function if exists tweeks.funct_load_artigo_composto(filter jsonb);\n\n-- create or replace function tweeks.funct_load_artigo_composto(filter jsonb) returns SETOF jsonb\n--   language plpgsql\n-- as\n-- $$\n--\n-- declare\n--\n--     /**\n--       Essa função serve para carregar os artigos registrado\n--       filter := {\n--         arg_espaco_auth: ID\n--         arg_classe_id: ID\n--         arg_artigo_estado: ARTIGO_ESTADO\n--       }\n--      */\n--\n--     arg_artigo_retalho uuid default filter ->>'arg_artigo_retalho';\n--     arg_espaco_auth uuid not null default filter ->>'arg_espaco_auth';\n--     arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth );\n--     _const map.constant;\n-- begin\n--     _const := map.constant();\n--\n--     return query\n--         with associacao as (\n--             select\n--                 ls.link_referencia,\n--                 sum( (st::tweeks.stock).stock_quantidade ) as associacao_stock_quantidade,\n--                 jsonb_agg( lib.jsonb_values(\n--                         to_jsonb( esp ) || to_jsonb( st ),\n--                         'espaco_id',\n--                         'espaco_nome',\n--                         'stock_id',\n--                         'stock_quantidade'\n--                     )\n--                 ) as links\n--             from tweeks.link ls\n--                      inner join tweeks.espaco esp on ls.link_espaco_destino = esp.espaco_id\n--                      inner join tweeks._get_stock( ( ls.link_referencia->>'artigo_id')::uuid, esp.espaco_id ) st on esp.espaco_id = (st::tweeks.stock).stock_espacao_id\n--             where ls.link_tlink_id = _const.tlink_associacao\n--               and ls.link_estado = _const.link_estado_associacao\n--               and ( ls.link_espaco_auth = any( arg_espaco_child ) or ls.link_espaco_destino = any( arg_espaco_child ) )\n--             group by ls.link_referencia\n--         ),  artigo_espaco as (\n--             select\n--                 art.*,\n--                 ass.associacao_stock_quantidade as artigo_stock,\n--                 coalesce( ass.links, jsonb_build_array() ) as links\n--             from tweeks.artigo art\n--                      left join associacao ass on ass.link_referencia @> jsonb_build_object( 'artigo_id', art.artigo_id )\n--             where art.artigo_artigo_id = arg_artigo_retalho\n--               and ( art.artigo_espaco_auth = any( arg_espaco_child ) or ass.link_referencia is not null )\n--             order by\n--                 art.artigo_nome\n--         ) select lib.jsonb_values(\n--                          ae,\n--                          'artigo_id',\n--                          'artigo_codigo',\n--                          'artigo_nome',\n--                          'artigo_foto',\n--                          'artigo_stock',\n--                          'artigo_descricao',\n--                          'artigo_estado',\n--                          'classe_id',\n--                          'classe_nome',\n--                          'links',\n--                          'artigo_compostomultiplo'\n--                      )\n--         from artigo_espaco ae;\n-- end;\n-- $$;\n\n\ndrop function if exists tweeks.funct_load_artigo_link(filter jsonb);\n/*\n create or replace function tweeks.funct_load_artigo_link(filter jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /** Essa função serve para devolver a lista dos artigos na link\n    args := {\n      arg_link_id: ID,\n      arg_espaco_auth: ID,\n      arg_colaborador_id: ID\n    }\n   */\n  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';\n  arg_link_id uuid not null default filter->>'arg_link_id';\n\n  _const map.constant;\n\nbegin\n  _const := map.constant();\n\n  return query\n    with artigo_item as (\n      select\n        a.*,\n        art.*,\n        st.stock_id,\n        st.stock_quantidade,\n        jsonb_agg(\n          lib.jsonb_values_as(\n            to_jsonb( it ),\n            'artigo_id', 'item_id',\n            'artigo_nome', 'item_nome',\n            'artigo_quantidadecusto', 'item_quantidadecusto',\n            'artigo_custo', 'item_custo',\n            'artigo_descricao', 'item_descricao',\n            'artigo_stock', 'item_stock'\n          )\n          order by  it.artigo_nome\n        ) filter ( where it.artigo_id is not null ) as artigo_items\n\n      from tweeks.link a\n        left join tweeks.artigo art on a.link_artigo_id = art.artigo_id\n          and art.artigo_estado = _const.artigo_estado_ativo\n        left join tweeks._get_stock( art.artigo_id, arg_espaco_auth ) st on art.artigo_id = st.stock_artigo_id\n          and st.stock_estado = _const.stock_estado_ativo\n          and ( st.stock_quantidade > 0 or art.artigo_stocknegativo )\n          and st.stock_espacao_id = arg_espaco_auth\n        left join tweeks.dispoe disp on art.artigo_id = disp.dispoe_artigo_id\n          and disp.dispoe_estado = _const.dispoe_estado_ativo\n        left join tweeks.artigo it on disp.dispoe_artigo_item = it.artigo_id\n          and it.artigo_estado = _const.artigo_estado_ativo\n\n      where a.link_espaco_destino = arg_espaco_auth\n        and coalesce( a.link_link_id, -1 ) = coalesce( arg_link_id, -1 )\n        and a.link_estado = _const.link_estado_ativo\n\n      group by\n        art.artigo_id,\n        st.stock_id,\n        st.stock_quantidade\n\n      order by a.link_posicao\n    ), class as (\n      select\n        cla.*,\n        jsonb_agg( to_jsonb( ai ) order by ai.link_posicao, ai.artigo_nome ) as calsse_artigos\n      from tweeks.classe cla\n        inner join artigo_item ai on cla.classe_id = ai.artigo_classe_id\n      where cla.classe_estado = _const.classe_estado_ativo\n        and cla.classe_id != _const.classe_itemextra\n      group by cla.classe_id\n      order by cla.classe_nome\n    )\n    select lib.jsonb_values(\n      cl,\n      'classe_id',\n      'classe_nome',\n      'classe_estado',\n      'classe_dataregistro',\n      'classe_dataatualizacao',\n      'calsse_artigos'\n    )\n      from class cl\n  ;\nend;\n$$;\n */\n\n\ndrop function if exists tweeks.funct_load_artigo_tecla(filter jsonb);\n\n /*\n  create or replace function tweeks.funct_load_artigo_tecla(filter jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /** Essa função serve para caregar os artigos pelas sua categoria\n    filter := {\n      arg_espaco_auth: ID,\n      arg_link_id: ID\n    }\n  */\n  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';\n  arg_link_id uuid not null default filter->>'arg_link_id';\n  _const  map.constant;\nbegin\n  _const := map.constant();\n  return query\n    with items as (\n      select\n        di.dispoe_artigo_id,\n        jsonb_agg(\n          lib.jsonb_values_as(\n            to_jsonb( art ),\n              'artigo_id', 'item_id',\n              'artigo_nome', 'item_nome',\n              'artigo_quantidadecusto', 'item_quantidadecusto',\n              'artigo_custo', 'item_custo',\n              'artigo_descricao', 'item_descricao',\n              'artigo_stock', 'item_stock'\n            )\n          ) artigo_items\n      from tweeks.dispoe di\n             inner join tweeks.artigo art on di.dispoe_artigo_item = art.artigo_id\n      where di.dispoe_estado = _const.dispoe_estado_ativo\n        and art.artigo_estado = _const.artigo_estado_ativo\n      group by di.dispoe_artigo_id\n\n    ), artigo_item as (\n      select\n        art.*,\n        st.stock_id,\n        st.stock_quantidade,\n        coalesce( its.artigo_items, jsonb_build_array() ) as artigo_items\n      from tweeks.artigo art\n        inner join tweeks.link ls on art.artigo_id = ls.link_artigo_id\n          and ls.link_espaco_destino = arg_espaco_auth\n          and ls.link_estado = _const.link_estado_associacao\n          and ls.link_tlink_id = _const.tlink_associacao\n        inner join tweeks._get_stock( art.artigo_id, arg_espaco_auth ) st on art.artigo_id = st.stock_artigo_id\n          and st.stock_estado = _const.stock_estado_ativo\n        left join items its on art.artigo_id = its.dispoe_artigo_id\n\n      where art.artigo_estado = _const.artigo_estado_ativo\n        and ( st.stock_quantidade > 0 or art.artigo_stocknegativo )\n        and st.stock_espacao_id = arg_espaco_auth\n    ), teclas as (\n      select\n          l.*,\n          tl.*,\n          case\n            when tl.tlink_id = _const.tlink_artigo then lib.jsonb_values(\n              ai,\n              'artigo_id',\n              'artigo_codigo',\n              'artigo_nome',\n              'artigo_custo',\n              'artigo_quantidadecusto',\n              'artigo_preparacao',\n              'artigo_foto',\n              'artigo_descricao',\n              'artigo_stock',\n              'artigo_stocknegativo',\n              'artigo_stockminimo',\n              'artigo_items'\n            )\n          end as artigo\n        from tweeks.link l\n          inner join tweeks.tlink tl on l.link_tlink_id = tl.tlink_id\n          left join artigo_item ai on l.link_artigo_id = ai.artigo_id\n        where l.link_estado = _const.link_estado_ativo\n          and coalesce( l.link_link_id, -1 ) = coalesce( arg_link_id, -1 )\n          and l.link_espaco_destino = arg_espaco_auth\n    )\n    select lib.jsonb_values(\n      tc,\n      'link_id',\n      'link_posicao',\n      'link_nome',\n      'link_custo',\n      'link_config',\n      'link_quantidadecusto',\n      'link_estado',\n      'tlink_id',\n      'tlink_designacao',\n      'artigo'\n      )\n      from teclas tc\n  ;\nend;\n$$;\n  */\n\n	create or replace function tweeks.funct_load_artigo(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** Essa função serve para carregar os artigos registrado args := { arg_espaco_auth: ID arg_colaborador_id: ID arg_classe_id: ID arg_artigo_estado: ARTIGO_ESTADO query: { any?: CODE|NAME|DESCRICAO code?: CODE name?: NAME desc?: DESCRICAO } } */ arg_espaco_auth uuid default args->>'arg_espaco_auth'; arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_espaco_childs uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth ); arg_classe_id uuid default args->>'arg_classe_id'; arg_artigo_estado int2 default args->>'arg_artigo_estado'; _query_any text default lower( args->'query'->>'any' ); _query_code text default lower( args->'query'->>'code' ); _query_name text default lower( args->'query'->>'name' ); _query_desc text default lower( args->'query'->>'desc' ); _const map.constant; _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); begin _const := map.constant(); /** ID, NOME, STOCK, PRECO, [STOK-MINIMO], FOTO */ return query with __artigo as ( select art.artigo_id, art.artigo_codigo, art.artigo_descricao, art.artigo_nome, art.artigo_compostoquantidade, art.artigo_artigo_id, art.artigo_espaco_auth = any( arg_espaco_childs ) as artigo_owner, s.stock_quantidade, art.artigo_foto, art.artigo_espaco_auth, art.artigo_classe_id, art.artigo_estado, art.artigo_stocknegativo, origin.artigo_id as origin_id, origin.artigo_codigo as origin_codigo, origin.artigo_descricao as orign_descricao, origin.artigo_nome as origin_nome, origin.artigo_compostoquantidade as orign_compostoquantidade, origin.artigo_artigo_id as origin_origin_id, coalesce( array_agg( l.link_espaco_destino ) filter ( where l.link_id is not null ), array[]::uuid[] ) as links, ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'precario_custo' as precario_custo, ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'precario_quantidade' as precario_quantidade, ( ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'stock_minimo' )::double precision as link_stockminimo from tweeks.artigo art left join tweeks.artigo origin on art.artigo_artigo_id = origin.artigo_id left join tweeks.link l on l.link_estado = _const.maguita_link_estado_ativo and l.link_referencia = rule.artigo_referencia( art.artigo_id ) and l.link_espaco_destino = any( arg_espaco_childs ) and l.link_tlink_id = _const.maguita_tlink_preco and l._branch_uid = _branch left join tweeks.stock s on art.artigo_id = s.artigo_id and s.espaco_id = arg_espaco_auth where art._branch_uid = _branch group by art.artigo_id, origin.artigo_id, s.stock_quantidade ), __filter as ( select *, coalesce( art.link_stockminimo ) as stock_minimo from __artigo art where ( coalesce( art.links, array[]::uuid[] )||art.artigo_espaco_auth ) && arg_espaco_childs and art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id ) and art.artigo_estado = coalesce( arg_artigo_estado, art.artigo_estado ) ), __filter_query as ( select * from __filter f where arg_classe_id is not null or f.artigo_classe_id != _const.classe_itemextra order by case when f.artigo_estado = _const.artigo_estado_ativo then 1 else 2 end, case when f.artigo_espaco_auth = arg_espaco_auth then 1 when f.artigo_espaco_auth = any( arg_espaco_childs ) then 2 else 3 end, case when stock_quantidade < f.stock_minimo then 1 when stock_quantidade = f.stock_minimo then 2 else 3 end, f.artigo_nome ), __query as ( select * from __filter_query _f where true and lower( _f.artigo_codigo ) = lower( coalesce( _query_code, _f.artigo_codigo ) ) and lower( _f.artigo_nome ) like lower( format( '%%%s%%', coalesce( _query_name, _f.artigo_nome ) ) ) and lower( coalesce( _f.artigo_descricao, '' ) ) like lower( format( '%%%s%%', coalesce( _query_desc, _f.artigo_descricao ) ) ) and ( lower( _f.artigo_codigo ) = lower( coalesce( _query_any, _f.artigo_codigo ) ) or lower( _f.artigo_nome) like lower( format( '%%%s%%', coalesce( _query_any, _f.artigo_nome ) ) ) or lower( coalesce( _f.artigo_descricao, '' ) ) like lower( format( '%%%s%%', coalesce( _query_any, _f.artigo_descricao, '' ) )) ) ) select to_jsonb( _q ) - 'links' from __query _q ; end $$; create or replace function tweeks.funct_pos_load_artigo(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** args := { arg_colaborador_id: UID, arg_espaco_auth: UID arg_classe_id: UID arg_artigo_nome:TXT } */ arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_classe_id uuid default args->>'arg_classe_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; _const map.constant; begin _const := map.constant(); return query with __artigo as ( select art.artigo_id, art.artigo_classe_id, art.artigo_nome, art.artigo_foto, art.artigo_stocknegativo, art.artigo_estado, s.stock_quantidade, l.link_metadata, count( di.dispoe_id ) as artigos_extras from tweeks.artigo art inner join tweeks.link l on to_jsonb( art ) @> l.link_referencia and l.link_estado = _const.maguita_link_estado_ativo and l.link_tlink_id = _const.maguita_tlink_preco and l.link_espaco_destino = arg_espaco_auth inner join tweeks.stock s on art.artigo_id = s.artigo_id and s.espaco_id = arg_espaco_auth left join tweeks.dispoe di on art.artigo_id = di.dispoe_artigo_id and di.dispoe_estado = _const.dispoe_estado_ativo where art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id ) group by art.artigo_id, s.stock_quantidade, l.link_metadata, art.artigo_stocknegativo, art.artigo_nome, art.artigo_foto order by case when s.stock_quantidade > 0 or art.artigo_stocknegativo then 1 else 2 end, art.artigo_nome ) select to_jsonb( a ) from __artigo a; end; $$; create or replace function tweeks.funct_pos_load_artigo_search(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** args := { search_text:TXT, arg_espaco_auth } */ arg_espaco_auth uuid default args->>'arg_espaco_auth'; _search_text character varying default args->>'search_text'; _const map.constant; ___branch uuid; begin ___branch := tweeks.__branch_uid( null, arg_espaco_auth ); _const := map.constant(); return query with __ean as( select e.ean_artigo_id, array_agg( e.ean_code ) as ean_code from tweeks.ean e where e.ean_estado = _const.maguita_ean_estado_ativo group by e.ean_artigo_id ), __artigo as ( select c.classe_id, c.classe_nome, art.artigo_id, art.artigo_classe_id, art.artigo_nome, art.artigo_stocknegativo, art.artigo_estado, s.stock_quantidade, l.link_metadata, e.ean_code, count( di.dispoe_id ) as artigos_extras from tweeks.artigo art inner join tweeks.classe c on art.artigo_classe_id = c.classe_id inner join tweeks.link l on to_jsonb( art ) @> l.link_referencia and l.link_estado = _const.maguita_link_estado_ativo and l.link_tlink_id = _const.maguita_tlink_preco and l.link_espaco_destino = arg_espaco_auth inner join tweeks.stock s on s.artigo_id = art.artigo_id and s.espaco_id = arg_espaco_auth left join tweeks.dispoe di on art.artigo_id = di.dispoe_artigo_id and di.dispoe_estado = _const.dispoe_estado_ativo left join __ean e on e.ean_artigo_id = art.artigo_id where art._branch_uid = ___branch group by art.artigo_id, c.classe_id, s.stock_quantidade, l.link_metadata, art.artigo_stocknegativo, art.artigo_nome, e.ean_code order by case when s.stock_quantidade > 0 or art.artigo_stocknegativo then 1 else 2 end, art.artigo_nome ) select to_jsonb( a ) from __artigo a where lower( a.artigo_nome ) like lower( format( '%%%s%%', _search_text ) ) or _search_text = any ( a.ean_code ) ; end; $$; drop function if exists funct_pos_load_caixa_auaaath(args jsonb); drop function if exists tweeks.funct_load_artigo_composto(filter jsonb); -- create or replace function tweeks.funct_load_artigo_composto(filter jsonb) returns SETOF jsonb -- language plpgsql -- as -- $$ -- -- declare -- -- /** -- Essa função serve para carregar os artigos registrado -- filter := { -- arg_espaco_auth: ID -- arg_classe_id: ID -- arg_artigo_estado: ARTIGO_ESTADO -- } -- */ -- -- arg_artigo_retalho uuid default filter ->>'arg_artigo_retalho'; -- arg_espaco_auth uuid not null default filter ->>'arg_espaco_auth'; -- arg_espaco_child uuid[] not null default rule.espaco_get_childrens( arg_espaco_auth ); -- _const map.constant; -- begin -- _const := map.constant(); -- -- return query -- with associacao as ( -- select -- ls.link_referencia, -- sum( (st::tweeks.stock).stock_quantidade ) as associacao_stock_quantidade, -- jsonb_agg( lib.jsonb_values( -- to_jsonb( esp ) || to_jsonb( st ), -- 'espaco_id', -- 'espaco_nome', -- 'stock_id', -- 'stock_quantidade' -- ) -- ) as links -- from tweeks.link ls -- inner join tweeks.espaco esp on ls.link_espaco_destino = esp.espaco_id -- inner join tweeks._get_stock( ( ls.link_referencia->>'artigo_id')::uuid, esp.espaco_id ) st on esp.espaco_id = (st::tweeks.stock).stock_espacao_id -- where ls.link_tlink_id = _const.tlink_associacao -- and ls.link_estado = _const.link_estado_associacao -- and ( ls.link_espaco_auth = any( arg_espaco_child ) or ls.link_espaco_destino = any( arg_espaco_child ) ) -- group by ls.link_referencia -- ), artigo_espaco as ( -- select -- art.*, -- ass.associacao_stock_quantidade as artigo_stock, -- coalesce( ass.links, jsonb_build_array() ) as links -- from tweeks.artigo art -- left join associacao ass on ass.link_referencia @> jsonb_build_object( 'artigo_id', art.artigo_id ) -- where art.artigo_artigo_id = arg_artigo_retalho -- and ( art.artigo_espaco_auth = any( arg_espaco_child ) or ass.link_referencia is not null ) -- order by -- art.artigo_nome -- ) select lib.jsonb_values( -- ae, -- 'artigo_id', -- 'artigo_codigo', -- 'artigo_nome', -- 'artigo_foto', -- 'artigo_stock', -- 'artigo_descricao', -- 'artigo_estado', -- 'classe_id', -- 'classe_nome', -- 'links', -- 'artigo_compostomultiplo' -- ) -- from artigo_espaco ae; -- end; -- $$; drop function if exists tweeks.funct_load_artigo_link(filter jsonb); /* create or replace function tweeks.funct_load_artigo_link(filter jsonb) returns SETOF jsonb language plpgsql as $$ declare /** Essa função serve para devolver a lista dos artigos na link args := { arg_link_id: ID, arg_espaco_auth: ID, arg_colaborador_id: ID } */ arg_espaco_auth uuid not null default filter->>'arg_espaco_auth'; arg_link_id uuid not null default filter->>'arg_link_id'; _const map.constant; begin _const := map.constant(); return query with artigo_item as ( select a.*, art.*, st.stock_id, st.stock_quantidade, jsonb_agg( lib.jsonb_values_as( to_jsonb( it ), 'artigo_id', 'item_id', 'artigo_nome', 'item_nome', 'artigo_quantidadecusto', 'item_quantidadecusto', 'artigo_custo', 'item_custo', 'artigo_descricao', 'item_descricao', 'artigo_stock', 'item_stock' ) order by it.artigo_nome ) filter ( where it.artigo_id is not null ) as artigo_items from tweeks.link a left join tweeks.artigo art on a.link_artigo_id = art.artigo_id and art.artigo_estado = _const.artigo_estado_ativo left join tweeks._get_stock( art.artigo_id, arg_espaco_auth ) st on art.artigo_id = st.stock_artigo_id and st.stock_estado = _const.stock_estado_ativo and ( st.stock_quantidade > 0 or art.artigo_stocknegativo ) and st.stock_espacao_id = arg_espaco_auth left join tweeks.dispoe disp on art.artigo_id = disp.dispoe_artigo_id and disp.dispoe_estado = _const.dispoe_estado_ativo left join tweeks.artigo it on disp.dispoe_artigo_item = it.artigo_id and it.artigo_estado = _const.artigo_estado_ativo where a.link_espaco_destino = arg_espaco_auth and coalesce( a.link_link_id, -1 ) = coalesce( arg_link_id, -1 ) and a.link_estado = _const.link_estado_ativo group by art.artigo_id, st.stock_id, st.stock_quantidade order by a.link_posicao ), class as ( select cla.*, jsonb_agg( to_jsonb( ai ) order by ai.link_posicao, ai.artigo_nome ) as calsse_artigos from tweeks.classe cla inner join artigo_item ai on cla.classe_id = ai.artigo_classe_id where cla.classe_estado = _const.classe_estado_ativo and cla.classe_id != _const.classe_itemextra group by cla.classe_id order by cla.classe_nome ) select lib.jsonb_values( cl, 'classe_id', 'classe_nome', 'classe_estado', 'classe_dataregistro', 'classe_dataatualizacao', 'calsse_artigos' ) from class cl ; end; $$; */ drop function if exists tweeks.funct_load_artigo_tecla(filter jsonb); /* create or replace function tweeks.funct_load_artigo_tecla(filter jsonb) returns SETOF jsonb language plpgsql as $$ declare /** Essa função serve para caregar os artigos pelas sua categoria filter := { arg_espaco_auth: ID, arg_link_id: ID } */ arg_espaco_auth uuid not null default filter->>'arg_espaco_auth'; arg_link_id uuid not null default filter->>'arg_link_id'; _const map.constant; begin _const := map.constant(); return query with items as ( select di.dispoe_artigo_id, jsonb_agg( lib.jsonb_values_as( to_jsonb( art ), 'artigo_id', 'item_id', 'artigo_nome', 'item_nome', 'artigo_quantidadecusto', 'item_quantidadecusto', 'artigo_custo', 'item_custo', 'artigo_descricao', 'item_descricao', 'artigo_stock', 'item_stock' ) ) artigo_items from tweeks.dispoe di inner join tweeks.artigo art on di.dispoe_artigo_item = art.artigo_id where di.dispoe_estado = _const.dispoe_estado_ativo and art.artigo_estado = _const.artigo_estado_ativo group by di.dispoe_artigo_id ), artigo_item as ( select art.*, st.stock_id, st.stock_quantidade, coalesce( its.artigo_items, jsonb_build_array() ) as artigo_items from tweeks.artigo art inner join tweeks.link ls on art.artigo_id = ls.link_artigo_id and ls.link_espaco_destino = arg_espaco_auth and ls.link_estado = _const.link_estado_associacao and ls.link_tlink_id = _const.tlink_associacao inner join tweeks._get_stock( art.artigo_id, arg_espaco_auth ) st on art.artigo_id = st.stock_artigo_id and st.stock_estado = _const.stock_estado_ativo left join items its on art.artigo_id = its.dispoe_artigo_id where art.artigo_estado = _const.artigo_estado_ativo and ( st.stock_quantidade > 0 or art.artigo_stocknegativo ) and st.stock_espacao_id = arg_espaco_auth ), teclas as ( select l.*, tl.*, case when tl.tlink_id = _const.tlink_artigo then lib.jsonb_values( ai, 'artigo_id', 'artigo_codigo', 'artigo_nome', 'artigo_custo', 'artigo_quantidadecusto', 'artigo_preparacao', 'artigo_foto', 'artigo_descricao', 'artigo_stock', 'artigo_stocknegativo', 'artigo_stockminimo', 'artigo_items' ) end as artigo from tweeks.link l inner join tweeks.tlink tl on l.link_tlink_id = tl.tlink_id left join artigo_item ai on l.link_artigo_id = ai.artigo_id where l.link_estado = _const.link_estado_ativo and coalesce( l.link_link_id, -1 ) = coalesce( arg_link_id, -1 ) and l.link_espaco_destino = arg_espaco_auth ) select lib.jsonb_values( tc, 'link_id', 'link_posicao', 'link_nome', 'link_custo', 'link_config', 'link_quantidadecusto', 'link_estado', 'tlink_id', 'tlink_designacao', 'artigo' ) from teclas tc ; end; $$; */
4903ffd0-e400-4049-a9c9-0d15d8b2c467	\n\n\n  alter table cluster.collector drop constraint fk_collector_to_share;\n  alter table cluster.object drop constraint fk_objecto_to_share;\n  alter table cluster.version drop constraint fk_version_to_share;\n\n  with __skips as (\n    select *\n    from unnest( array[\n      'cluster.branch',\n      'tweeks.branch',\n      'tweeks.espaco',\n      'auth.colaborador',\n      'auth.acesso',\n      'auth.privilegio',\n      'auth.perfil',\n      'tweeks.trabalha'\n      ]::text[]) s( classname )\n  ) delete from cluster.share s\n  where s.share_regclass not in (\n    select _s.classname\n    from __skips _s\n  );\n           \n\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.movimento', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.taxa', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.transacao', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.artigo', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.caixa', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.classe', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.conta', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.posto', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.venda', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.acerto', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.deposito', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.cambio', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.dispoe', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.entrada', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.fornecedor', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.imposto', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.impostovenda', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.trabalha', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.transferencia', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.taplicar', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.tipoimposto', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.chave', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.aloca', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.ean', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.cliente', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.lancamento', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.retalho', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.fluxo', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.serie', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.link', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('cluster.resource', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.guia', true, true);\n-- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.custoguia', true, true);\n	alter table cluster.collector drop constraint fk_collector_to_share; alter table cluster.object drop constraint fk_objecto_to_share; alter table cluster.version drop constraint fk_version_to_share; with __skips as ( select * from unnest( array[ 'cluster.branch', 'tweeks.branch', 'tweeks.espaco', 'auth.colaborador', 'auth.acesso', 'auth.privilegio', 'auth.perfil', 'tweeks.trabalha' ]::text[]) s( classname ) ) delete from cluster.share s where s.share_regclass not in ( select _s.classname from __skips _s ); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.movimento', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.taxa', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.transacao', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.artigo', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.caixa', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.classe', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.conta', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.posto', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.venda', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.acerto', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.deposito', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.cambio', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.dispoe', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.entrada', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.fornecedor', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.imposto', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.impostovenda', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.trabalha', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.transferencia', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.taplicar', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.tipoimposto', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.chave', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.aloca', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.ean', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.cliente', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.lancamento', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.retalho', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.fluxo', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.serie', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.link', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('cluster.resource', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.guia', true, true); -- INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('tweeks.custoguia', true, true);
d17fdd53-df81-4256-843c-2a08ae185b51	\ncreate or replace function tweeks.funct_pos_load_conta_dia( filter jsonb DEFAULT NULL::jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /** Essa função serve para devolver as compras do dia em uma data especifica\n    filter := {\n      arg_conta_data: DATE\n      arg_posto_id: DATE\n    }\n   */\n  _const map.constant;\n  arg_conta_data date default filter->>'arg_conta_data';\n  arg_posto_id uuid not null default filter->>'arg_posto_id';\nbegin\n\n  _const := map.constant();\n  arg_conta_data := coalesce( arg_conta_data, current_date );\n\n  if arg_conta_data < current_date - make_interval( days := 7 ) then return; end if;\n\n  return query\n    with __conta as (\n      select\n          ct.conta_id,\n          ct.conta_data,\n          ct.conta_dataregistro,\n          ct.conta_titular,\n          ct.conta_titularnif,\n          ct.conta_montante,\n          ct.conta_numerofatura,\n          ct.conta_numero,\n          p.posto_designacao,\n          p.posto_matricula,\n          de.deposito_montante,\n          de.deposito_montantemoeda,\n          de.deposito_montantetroco,\n          de.deposito_montantefinal,\n          de.deposito_taxacambio,\n          cu.currency_id,\n          cu.currency_code,\n          cu.currency_name,\n          co.colaborador_id,\n          co.colaborador_nome\n        from tweeks.conta ct\n          inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id\n          inner join tweeks.deposito de on ( de.deposito_referencia->>'conta_id' )::uuid = ct.conta_id\n          inner join geoinfo.currency cu on de.deposito_currency_id = cu.currency_id\n          inner join auth.colaborador co on ct.conta_colaborador_fecho = co.colaborador_id\n        where ct.conta_posto_fecho = arg_posto_id\n          and ct.conta_estado = _const.maguita_conta_estado_fechado\n          and ct._tgrupo_id = _const.maguita_tgrupo_cnormal\n          and ct.conta_data = arg_conta_data\n    ) select to_jsonb( _ct )\n        from __conta _ct\n    ;\nend\n$$;\n	create or replace function tweeks.funct_pos_load_conta_dia( filter jsonb DEFAULT NULL::jsonb) returns SETOF jsonb language plpgsql as $$ declare /** Essa função serve para devolver as compras do dia em uma data especifica filter := { arg_conta_data: DATE arg_posto_id: DATE } */ _const map.constant; arg_conta_data date default filter->>'arg_conta_data'; arg_posto_id uuid not null default filter->>'arg_posto_id'; begin _const := map.constant(); arg_conta_data := coalesce( arg_conta_data, current_date ); if arg_conta_data < current_date - make_interval( days := 7 ) then return; end if; return query with __conta as ( select ct.conta_id, ct.conta_data, ct.conta_dataregistro, ct.conta_titular, ct.conta_titularnif, ct.conta_montante, ct.conta_numerofatura, ct.conta_numero, p.posto_designacao, p.posto_matricula, de.deposito_montante, de.deposito_montantemoeda, de.deposito_montantetroco, de.deposito_montantefinal, de.deposito_taxacambio, cu.currency_id, cu.currency_code, cu.currency_name, co.colaborador_id, co.colaborador_nome from tweeks.conta ct inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id inner join tweeks.deposito de on ( de.deposito_referencia->>'conta_id' )::uuid = ct.conta_id inner join geoinfo.currency cu on de.deposito_currency_id = cu.currency_id inner join auth.colaborador co on ct.conta_colaborador_fecho = co.colaborador_id where ct.conta_posto_fecho = arg_posto_id and ct.conta_estado = _const.maguita_conta_estado_fechado and ct._tgrupo_id = _const.maguita_tgrupo_cnormal and ct.conta_data = arg_conta_data ) select to_jsonb( _ct ) from __conta _ct ; end $$;
83ca1f64-6fc2-47b4-955a-924151af4765	\ncreate or replace function tweeks.funct_load_classe( filter jsonb DEFAULT NULL::jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /** Essa função serve para carregar as listas de classes ativas\n    filter := {\n      arg_espaco_auth: ID\n    }\n  */\n  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';\n  arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth );\n  _const map.constant;\nbegin\n  _const := map.constant();\n\n  return query\n    with\n      __espaco as ( select e.espaco_id, e.espaco_nome from tweeks.espaco e),\n      __links as (\n        select\n            l.link_referencia,\n            array_agg( to_jsonb( e ) ) as espacos\n          from  __espaco e\n            inner join tweeks.link l on e.espaco_id = l.link_espaco_destino\n          where l.link_estado = _const.maguita_link_estado_ativo\n            and l.link_tlink_id = _const.maguita_tlink_classe\n          group by l.link_referencia\n\n        ),\n      __classe as (\n        select\n            cla.classe_id,\n            cla.classe_classe_id,\n            cla.classe_nome,\n            cla.classe_foto,\n            cla.classe_position,\n            jsonb_build_object(\n              'total', count( distinct atr.artigo_id ),\n              'ativos', count( distinct atr.artigo_id ) filter ( where atr.artigo_estado = _const.artigo_estado_ativo )\n            ) as artigos,\n            coalesce( l.espacos, array[]::jsonb[] ) as classe_espacos\n\n        from tweeks.classe cla\n          left join __links l on ( l.link_referencia->>'classe_id' )::uuid = cla.classe_id\n          left join tweeks.artigo atr on cla.classe_id = atr.artigo_classe_id\n        where cla.classe_estado = _const.classe_estado_ativo\n          and ( cla.classe_espaco_auth = any( arg_espaco_child )\n                 or cla.classe_id = _const.classe_itemextra\n              )\n        group by cla.classe_id, cla.classe_nome, l.espacos\n        order by\n          case\n            when cla.classe_id != _const.classe_itemextra then 1\n            else 2\n          end,\n          cla.classe_nome\n      ) select to_jsonb( c )\n          from __classe c\n    ;\nend;\n$$;\n\n	create or replace function tweeks.funct_load_classe( filter jsonb DEFAULT NULL::jsonb) returns SETOF jsonb language plpgsql as $$ declare /** Essa função serve para carregar as listas de classes ativas filter := { arg_espaco_auth: ID } */ arg_espaco_auth uuid not null default filter->>'arg_espaco_auth'; arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth ); _const map.constant; begin _const := map.constant(); return query with __espaco as ( select e.espaco_id, e.espaco_nome from tweeks.espaco e), __links as ( select l.link_referencia, array_agg( to_jsonb( e ) ) as espacos from __espaco e inner join tweeks.link l on e.espaco_id = l.link_espaco_destino where l.link_estado = _const.maguita_link_estado_ativo and l.link_tlink_id = _const.maguita_tlink_classe group by l.link_referencia ), __classe as ( select cla.classe_id, cla.classe_classe_id, cla.classe_nome, cla.classe_foto, cla.classe_position, jsonb_build_object( 'total', count( distinct atr.artigo_id ), 'ativos', count( distinct atr.artigo_id ) filter ( where atr.artigo_estado = _const.artigo_estado_ativo ) ) as artigos, coalesce( l.espacos, array[]::jsonb[] ) as classe_espacos from tweeks.classe cla left join __links l on ( l.link_referencia->>'classe_id' )::uuid = cla.classe_id left join tweeks.artigo atr on cla.classe_id = atr.artigo_classe_id where cla.classe_estado = _const.classe_estado_ativo and ( cla.classe_espaco_auth = any( arg_espaco_child ) or cla.classe_id = _const.classe_itemextra ) group by cla.classe_id, cla.classe_nome, l.espacos order by case when cla.classe_id != _const.classe_itemextra then 1 else 2 end, cla.classe_nome ) select to_jsonb( c ) from __classe c ; end; $$;
623641ba-0f1a-43cf-b758-3aec4a0827de	\ndrop view if exists report.vreport_fatura;\n\ncreate or replace view report.vreport_fatura as\nwith _const ( maguita_conta_estado_fechado, maguita_conta_estado_aberto, maguita_conta_estado_anulado) as (\n  select \n    map.get('maguita_conta_estado_fechado')::int2,\n    map.get('maguita_conta_estado_aberto')::int2,\n    map.get('maguita_conta_estado_anulado')::int2\n)\nselect\n    ct.conta_id,\n    ct.conta_data as "DATA",\n    ct.conta_dataregistro::date as "REGISTO",\n    ct.conta_datafecho as "FECHO",\n    ct.conta_numerofatura as "FATURA",\n    case\n      when ct.conta_proforma then 'SIM'\n      else 'NÃO'\n    end as "PROFOMA",\n  \n    ct.conta_proforma,\n    case\n      when ct.conta_estado = _const.maguita_conta_estado_fechado then 'FECHADO'\n      when ct.conta_estado = _const.maguita_conta_estado_aberto then 'ABERTO'\n    end as "ESTADO",\n    ct.conta_numero as "Nº CONTA",\n    ct.conta_imprensa as "INPRESSÕES",\n    ct.conta_proformavencimento as "PROF. VENCIMENTO",\n    ct.conta_estado,\n    tc.tgrupo_id,\n    ct._branch_uid,\n    tc.tgrupo_desc as "TIPO CONTA",\n    ct.conta_montante as "$ MONTANTE",\n    ct.conta_desconto as "$ DESCONTO",\n    ct.conta_montante - ct.conta_desconto as "$ PAGAR",\n    c.cliente_id,\n    c.cliente_titular as "CLIENTE",\n    c.cliente_nif as "NIF",\n    p.posto_id,\n    p.posto_designacao as "POSTO",\n    e.espaco_id,\n    e.espaco_nome as "ARMAZÉM",\n    e.espaco_codigo as "CÓDIGO AR.",\n    col_vend.colaborador_nome  as "VENDEDOR",\n    col_open.colaborador_nome as "ABERTURA",\n    s.serie_numero as "Nº SERIE",\n    s.serie_designacao as "SERIE",\n    ts.tserie_desc as "TIPO SERIE",\n    col_open.colaborador_id as colaborador_abertura,\n    col_vend.colaborador_id as colaborador_vendor,\n    ts.tserie_id,\n    s.serie_id\n\n  from _const, tweeks.conta ct\n    inner join tweeks.tgrupo tc on ct._tgrupo_id = tc.tgrupo_id\n    inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id\n    inner join tweeks.espaco e on p.posto_espaco_auth = e.espaco_id\n    inner join auth.colaborador col_open on ct.conta_colaborador_id = col_open.colaborador_id\n    left join auth.colaborador col_vend on ct.conta_colaborador_fecho = col_vend.colaborador_id\n    left join tweeks.serie s on ct.conta_serie_id = s.serie_id\n    left join tweeks.cliente c on ct.conta_cliente_id = c.cliente_id\n    left join tweeks.tserie ts on s.serie_tserie_id = ts.tserie_id\n  where ct.conta_estado != _const.maguita_conta_estado_anulado\n;\n\nselect * from report.sync( 'report.vreport_fatura', 'RELATÓRIO DE FATURA', 1900 );\n\nUPDATE report.vcolumn SET position = 10000, show = true, init = true, format = 'code:long', filter = '[{"opr": "like", "mode": "right", "name": "FATURA", "format": "simple"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'FATURA';\nUPDATE report.vcolumn SET position = 1900, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'integer' WHERE source = 'report.vreport_fatura' AND name = 'Nº CONTA';\nUPDATE report.vcolumn SET position = 1885, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'POSTO';\nUPDATE report.vcolumn SET position = 995, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'CÓDIGO AR.';\nUPDATE report.vcolumn SET position = 994, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'ARMAZÉM';\nUPDATE report.vcolumn SET position = 986, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'NIF';\nUPDATE report.vcolumn SET position = 985, show = true, init = false, format = 'name', filter = '[{"opr": "like", "mode": "right", "name": "NOME DO CLIENTE", "format": "simple"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'CLIENTE';\nUPDATE report.vcolumn SET position = 555, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_fatura' AND name = '$ MONTANTE';\nUPDATE report.vcolumn SET position = 554, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_fatura' AND name = '$ DESCONTO';\nUPDATE report.vcolumn SET position = 553, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_fatura' AND name = '$ PAGAR';\nUPDATE report.vcolumn SET position = 545, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'TIPO CONTA';\nUPDATE report.vcolumn SET position = 544, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_fatura' AND name = 'PROFOMA';\nUPDATE report.vcolumn SET position = 543, show = true, init = false, format = 'date', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_fatura' AND name = 'PROF. VENCIMENTO';\nUPDATE report.vcolumn SET position = 396, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'TIPO SERIE';\nUPDATE report.vcolumn SET position = 395, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'Nº SERIE';\nUPDATE report.vcolumn SET position = 394, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'SERIE';\nUPDATE report.vcolumn SET position = 295, show = true, init = false, format = 'int', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_fatura' AND name = 'INPRESSÕES';\nUPDATE report.vcolumn SET position = 95, show = true, init = true, format = 'name:mid', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'VENDEDOR';\nUPDATE report.vcolumn SET position = 94, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'ABERTURA';\nUPDATE report.vcolumn SET position = 86, show = true, init = false, format = 'timestamp', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_fatura' AND name = 'FECHO';\nUPDATE report.vcolumn SET position = 85, show = true, init = true, format = 'date', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_fatura' AND name = 'DATA';\nUPDATE report.vcolumn SET position = 84, show = true, init = false, format = 'date', filter = '[{"opr": ">=", "name": "Data inicio", "format": "date"}, {"opr": "<=", "name": "Data fim", "format": "date"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_fatura' AND name = 'REGISTO';\nUPDATE report.vcolumn SET position = 70, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_fatura' AND name = 'ESTADO';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]', agg = '[{"func": "count::distinct", "name": "TOTAL DE CLIENTES", "rename": "??COUNT::DISTINCT TOTAL DE CLIENTES"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = 'cliente_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|auth.colaborador", {"name": "COLABORADOR ABERTURA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = 'colaborador_abertura';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|auth.colaborador", {"name": "COLABORADOR VENDEDOR"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = 'colaborador_vendor';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.boolean|Y/N", {"name": "PROFORMA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'boolean' WHERE source = 'report.vreport_fatura' AND name = 'conta_proforma';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.espaco", {"name": "ARMAZÉM"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = 'espaco_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = 'posto_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.serie", {"name": "SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = 'serie_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_fatura' AND name = 'tgrupo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tserie", {"name": "TIPO DE SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_fatura' AND name = 'tserie_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = '_branch_uid';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_fatura' AND name = 'conta_estado';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = 'conta_id';\n\n\nselect * from report.vcolumn\n  where source = 'report.vreport_fatura'\n  order by position desc nulls last,\n    show desc nulls last,\n    init desc nulls last,\n    jsonb_array_length( agg ) desc,\n    jsonb_array_length( filter ) desc,\n    source, name;\n	drop view if exists report.vreport_fatura; create or replace view report.vreport_fatura as with _const ( maguita_conta_estado_fechado, maguita_conta_estado_aberto, maguita_conta_estado_anulado) as ( select map.get('maguita_conta_estado_fechado')::int2, map.get('maguita_conta_estado_aberto')::int2, map.get('maguita_conta_estado_anulado')::int2 ) select ct.conta_id, ct.conta_data as "DATA", ct.conta_dataregistro::date as "REGISTO", ct.conta_datafecho as "FECHO", ct.conta_numerofatura as "FATURA", case when ct.conta_proforma then 'SIM' else 'NÃO' end as "PROFOMA", ct.conta_proforma, case when ct.conta_estado = _const.maguita_conta_estado_fechado then 'FECHADO' when ct.conta_estado = _const.maguita_conta_estado_aberto then 'ABERTO' end as "ESTADO", ct.conta_numero as "Nº CONTA", ct.conta_imprensa as "INPRESSÕES", ct.conta_proformavencimento as "PROF. VENCIMENTO", ct.conta_estado, tc.tgrupo_id, ct._branch_uid, tc.tgrupo_desc as "TIPO CONTA", ct.conta_montante as "$ MONTANTE", ct.conta_desconto as "$ DESCONTO", ct.conta_montante - ct.conta_desconto as "$ PAGAR", c.cliente_id, c.cliente_titular as "CLIENTE", c.cliente_nif as "NIF", p.posto_id, p.posto_designacao as "POSTO", e.espaco_id, e.espaco_nome as "ARMAZÉM", e.espaco_codigo as "CÓDIGO AR.", col_vend.colaborador_nome as "VENDEDOR", col_open.colaborador_nome as "ABERTURA", s.serie_numero as "Nº SERIE", s.serie_designacao as "SERIE", ts.tserie_desc as "TIPO SERIE", col_open.colaborador_id as colaborador_abertura, col_vend.colaborador_id as colaborador_vendor, ts.tserie_id, s.serie_id from _const, tweeks.conta ct inner join tweeks.tgrupo tc on ct._tgrupo_id = tc.tgrupo_id inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id inner join tweeks.espaco e on p.posto_espaco_auth = e.espaco_id inner join auth.colaborador col_open on ct.conta_colaborador_id = col_open.colaborador_id left join auth.colaborador col_vend on ct.conta_colaborador_fecho = col_vend.colaborador_id left join tweeks.serie s on ct.conta_serie_id = s.serie_id left join tweeks.cliente c on ct.conta_cliente_id = c.cliente_id left join tweeks.tserie ts on s.serie_tserie_id = ts.tserie_id where ct.conta_estado != _const.maguita_conta_estado_anulado ; select * from report.sync( 'report.vreport_fatura', 'RELATÓRIO DE FATURA', 1900 ); UPDATE report.vcolumn SET position = 10000, show = true, init = true, format = 'code:long', filter = '[{"opr": "like", "mode": "right", "name": "FATURA", "format": "simple"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'FATURA'; UPDATE report.vcolumn SET position = 1900, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'integer' WHERE source = 'report.vreport_fatura' AND name = 'Nº CONTA'; UPDATE report.vcolumn SET position = 1885, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'POSTO'; UPDATE report.vcolumn SET position = 995, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'CÓDIGO AR.'; UPDATE report.vcolumn SET position = 994, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'ARMAZÉM'; UPDATE report.vcolumn SET position = 986, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'NIF'; UPDATE report.vcolumn SET position = 985, show = true, init = false, format = 'name', filter = '[{"opr": "like", "mode": "right", "name": "NOME DO CLIENTE", "format": "simple"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'CLIENTE'; UPDATE report.vcolumn SET position = 555, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_fatura' AND name = '$ MONTANTE'; UPDATE report.vcolumn SET position = 554, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_fatura' AND name = '$ DESCONTO'; UPDATE report.vcolumn SET position = 553, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_fatura' AND name = '$ PAGAR'; UPDATE report.vcolumn SET position = 545, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'TIPO CONTA'; UPDATE report.vcolumn SET position = 544, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_fatura' AND name = 'PROFOMA'; UPDATE report.vcolumn SET position = 543, show = true, init = false, format = 'date', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_fatura' AND name = 'PROF. VENCIMENTO'; UPDATE report.vcolumn SET position = 396, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'TIPO SERIE'; UPDATE report.vcolumn SET position = 395, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'Nº SERIE'; UPDATE report.vcolumn SET position = 394, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'SERIE'; UPDATE report.vcolumn SET position = 295, show = true, init = false, format = 'int', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_fatura' AND name = 'INPRESSÕES'; UPDATE report.vcolumn SET position = 95, show = true, init = true, format = 'name:mid', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'VENDEDOR'; UPDATE report.vcolumn SET position = 94, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fatura' AND name = 'ABERTURA'; UPDATE report.vcolumn SET position = 86, show = true, init = false, format = 'timestamp', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_fatura' AND name = 'FECHO'; UPDATE report.vcolumn SET position = 85, show = true, init = true, format = 'date', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_fatura' AND name = 'DATA'; UPDATE report.vcolumn SET position = 84, show = true, init = false, format = 'date', filter = '[{"opr": ">=", "name": "Data inicio", "format": "date"}, {"opr": "<=", "name": "Data fim", "format": "date"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_fatura' AND name = 'REGISTO'; UPDATE report.vcolumn SET position = 70, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_fatura' AND name = 'ESTADO'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]', agg = '[{"func": "count::distinct", "name": "TOTAL DE CLIENTES", "rename": "??COUNT::DISTINCT TOTAL DE CLIENTES"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = 'cliente_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|auth.colaborador", {"name": "COLABORADOR ABERTURA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = 'colaborador_abertura'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|auth.colaborador", {"name": "COLABORADOR VENDEDOR"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = 'colaborador_vendor'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.boolean|Y/N", {"name": "PROFORMA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'boolean' WHERE source = 'report.vreport_fatura' AND name = 'conta_proforma'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.espaco", {"name": "ARMAZÉM"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = 'espaco_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = 'posto_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.serie", {"name": "SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = 'serie_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_fatura' AND name = 'tgrupo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tserie", {"name": "TIPO DE SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_fatura' AND name = 'tserie_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = '_branch_uid'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_fatura' AND name = 'conta_estado'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fatura' AND name = 'conta_id'; select * from report.vcolumn where source = 'report.vreport_fatura' order by position desc nulls last, show desc nulls last, init desc nulls last, jsonb_array_length( agg ) desc, jsonb_array_length( filter ) desc, source, name;
5d4f40e3-6584-4aa2-9c3b-980aa98ed92e	\ncreate or replace function tweeks.funct_reg_precario(args jsonb) returns lib.result\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    Essa função serve para registrar e atualizar os preços dos itens\n    args := {\n      arg_espaco_auth: ID\n      arg_colaborador_id: ID,\n      arg_forced: boolean,\n      arg_precario_referencia: {\n        artigo_id: ID,\n      },\n      arg_links :[\n        {  espaco_id: *ID,\n           stock_minimo: QUNT\n           precario_custo: CUSTO,\n           precario_quantidade: QUANT_CUSTO }\n      ]\n    }\n  */\n\n  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n\n  arg_precario_referencia jsonb not null default args->>'arg_precario_referencia';\n  arg_forced boolean default args->>'arg_forced';\n  arg_artigo_id uuid;\n\n  arg_espacos_destino uuid[] default array ( select ( e.doc->>'espaco_id' )::uuid from jsonb_array_elements( args->'arg_links') e( doc ) );\n  arg_espaco_child uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth );\n\n  _const map.constant;\n  _artigo tweeks.artigo;\n  _branch uuid := tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n\nbegin\n  _const := map.constant();\n  arg_forced := coalesce( arg_forced, false );\n\n  arg_artigo_id := arg_precario_referencia->>'artigo_id';\n\n\n  if not arg_forced and arg_artigo_id is not null then\n    _artigo := tweeks._get_artigo( arg_artigo_id );\n\n    -- Alterar o preço apenas quando o artigo não estiver em nenhuma conta aberta\n    if (\n         select count( * ) > 0\n         from tweeks.venda ag\n         where ag.venda_artigo_id = arg_artigo_id\n           and ag.venda_estado in ( _const.maguita_venda_estado_aberto )\n          and ag._branch_uid = _branch\n       ) then\n      return false ? '@tweeks.artigo.price-can-not-update-open-account';\n    end if;\n  end if;\n\n  -- Desativar o precario atual\n  update tweeks.link\n    set link_estado = _const.maguita_link_estado_fechado,\n        link_dataatualizacao = now(),\n        link_colaborador_atualizacao = arg_colaborador_id\n    where link_referencia @> arg_precario_referencia\n      and link_estado = _const.maguita_link_estado_ativo\n      and link_espaco_destino = any( arg_espaco_child )\n      and _branch_uid = _branch\n      and link_tlink_id = _const.maguita_tlink_preco   \n  ;\n\n   -- Criar os novos precarios\n   insert into tweeks.link(\n      link_tlink_id,\n      link_espaco_destino,\n      link_espaco_auth,\n      link_colaborador_id,\n      link_referencia,\n      link_posicao,\n      link_nome,\n      link_metadata\n    ) select\n      (map.constant()).maguita_tlink_preco,\n      ( lp.doc->>'espaco_id' )::uuid,\n      arg_espaco_auth,\n      arg_colaborador_id,\n      arg_precario_referencia,\n      0,\n      format( 'Preço de %s para %s', _artigo.artigo_nome, e.espaco_nome ),\n      jsonb_build_object(\n          'precario_custo', ( lp.doc->>'precario_custo' )::double precision,\n          'stock_minimo', ( lp.doc->>'stock_minimo' )::double precision,\n          'precario_quantidade', (lp.doc->>'precario_quantidade')::double precision\n      )\n      from jsonb_array_elements( args->'arg_links' ) lp( doc )\n        inner join tweeks.espaco e on (lp.doc->>'espaco_id')::uuid = e.espaco_id\n    ;\n  \n  return true? jsonb_build_object(\n    'precario', array(\n        select to_jsonb( l )\n          from tweeks.link l\n          where l.link_espaco_destino = any( arg_espacos_destino )\n            and (l.link_referencia ->>'artigo_id')::uuid = arg_precario_referencia\n            and l.link_estado = _const.maguita_link_estado_ativo\n            and l.link_tlink_id = _const.maguita_tlink_preco\n            and l._branch_uid = _branch\n    )\n  );\nend;\n$$;\n\n	create or replace function tweeks.funct_reg_precario(args jsonb) returns lib.result language plpgsql as $$ declare /** Essa função serve para registrar e atualizar os preços dos itens args := { arg_espaco_auth: ID arg_colaborador_id: ID, arg_forced: boolean, arg_precario_referencia: { artigo_id: ID, }, arg_links :[ { espaco_id: *ID, stock_minimo: QUNT precario_custo: CUSTO, precario_quantidade: QUANT_CUSTO } ] } */ arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_precario_referencia jsonb not null default args->>'arg_precario_referencia'; arg_forced boolean default args->>'arg_forced'; arg_artigo_id uuid; arg_espacos_destino uuid[] default array ( select ( e.doc->>'espaco_id' )::uuid from jsonb_array_elements( args->'arg_links') e( doc ) ); arg_espaco_child uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth ); _const map.constant; _artigo tweeks.artigo; _branch uuid := tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); begin _const := map.constant(); arg_forced := coalesce( arg_forced, false ); arg_artigo_id := arg_precario_referencia->>'artigo_id'; if not arg_forced and arg_artigo_id is not null then _artigo := tweeks._get_artigo( arg_artigo_id ); -- Alterar o preço apenas quando o artigo não estiver em nenhuma conta aberta if ( select count( * ) > 0 from tweeks.venda ag where ag.venda_artigo_id = arg_artigo_id and ag.venda_estado in ( _const.maguita_venda_estado_aberto ) and ag._branch_uid = _branch ) then return false ? '@tweeks.artigo.price-can-not-update-open-account'; end if; end if; -- Desativar o precario atual update tweeks.link set link_estado = _const.maguita_link_estado_fechado, link_dataatualizacao = now(), link_colaborador_atualizacao = arg_colaborador_id where link_referencia @> arg_precario_referencia and link_estado = _const.maguita_link_estado_ativo and link_espaco_destino = any( arg_espaco_child ) and _branch_uid = _branch and link_tlink_id = _const.maguita_tlink_preco ; -- Criar os novos precarios insert into tweeks.link( link_tlink_id, link_espaco_destino, link_espaco_auth, link_colaborador_id, link_referencia, link_posicao, link_nome, link_metadata ) select (map.constant()).maguita_tlink_preco, ( lp.doc->>'espaco_id' )::uuid, arg_espaco_auth, arg_colaborador_id, arg_precario_referencia, 0, format( 'Preço de %s para %s', _artigo.artigo_nome, e.espaco_nome ), jsonb_build_object( 'precario_custo', ( lp.doc->>'precario_custo' )::double precision, 'stock_minimo', ( lp.doc->>'stock_minimo' )::double precision, 'precario_quantidade', (lp.doc->>'precario_quantidade')::double precision ) from jsonb_array_elements( args->'arg_links' ) lp( doc ) inner join tweeks.espaco e on (lp.doc->>'espaco_id')::uuid = e.espaco_id ; return true? jsonb_build_object( 'precario', array( select to_jsonb( l ) from tweeks.link l where l.link_espaco_destino = any( arg_espacos_destino ) and (l.link_referencia ->>'artigo_id')::uuid = arg_precario_referencia and l.link_estado = _const.maguita_link_estado_ativo and l.link_tlink_id = _const.maguita_tlink_preco and l._branch_uid = _branch ) ); end; $$;
16bb1225-41e2-45cc-a59f-cbbdc6743a59	\n--\n-- PostgreSQL database dump\n--\n\n-- Dumped from database version 13.7 (Ubuntu 13.7-1.pgdg20.04+1)\n-- Dumped by pg_dump version 13.2\n\n-- Started on 2023-01-05 19:40:16\n\nSET statement_timeout = 0;\nSET lock_timeout = 0;\nSET idle_in_transaction_session_timeout = 0;\nSET client_encoding = 'UTF8';\nSET standard_conforming_strings = on;\nSELECT pg_catalog.set_config('search_path', '', false);\nSET check_function_bodies = false;\nSET xmloption = content;\nSET client_min_messages = warning;\nSET row_security = off;\n\nDROP TRIGGER IF EXISTS trigger_sync_domsync ON libdom.domsync;\nDROP TRIGGER IF EXISTS sync_trigger ON libdom.entryset;\nALTER TABLE IF EXISTS ONLY libdom.entryset DROP CONSTRAINT IF EXISTS pk_name;\nALTER TABLE IF EXISTS ONLY libdom.domsync DROP CONSTRAINT IF EXISTS domsync_pkey;\nDROP TABLE IF EXISTS libdom.domsync;\nDROP FUNCTION IF EXISTS libdom.trigger_sync_entry();\nDROP FUNCTION IF EXISTS libdom.trigger_sync_domsync();\nDROP FUNCTION IF EXISTS libdom.sync_entry(name name, classtype regtype);\nDROP FUNCTION IF EXISTS libdom.sync_drop(name name, classtype regtype);\nDROP FUNCTION IF EXISTS libdom.set(name name, value character varying, label character varying, domain character varying, force boolean);\nDROP FUNCTION IF EXISTS libdom.rebuild(clean boolean);\nDROP FUNCTION IF EXISTS libdom.prefix(VARIADIC prefix character varying[]);\nDROP TABLE IF EXISTS libdom.entryset;\nDROP FUNCTION IF EXISTS libdom.get(arg_name name);\nDROP FUNCTION IF EXISTS libdom.exports(schema_name character varying, VARIADIC name character varying[]);\nDROP FUNCTION IF EXISTS libdom.entry_list(args jsonb);\nDROP FUNCTION IF EXISTS libdom.entry_drop(arg_name name, arg_dropforce boolean);\nDROP FUNCTION IF EXISTS libdom.entry(name name, type regtype, val anyelement, domain character varying, label character varying, editable boolean, comment character varying, force boolean);\nDROP FUNCTION IF EXISTS libdom.domsync(classname character varying, columnname character varying, domain character varying);\nDROP FUNCTION IF EXISTS libdom.domain_of(domain character varying, value text);\nDROP FUNCTION IF EXISTS libdom.domain_of(name name);\nDROP FUNCTION IF EXISTS libdom.domain_document(VARIADIC prefix character varying[]);\nDROP FUNCTION IF EXISTS libdom.domain(VARIADIC prefix character varying[]);\nDROP FUNCTION IF EXISTS libdom.describe(VARIADIC prefix character varying[]);\nDROP FUNCTION IF EXISTS libdom.constant_document(VARIADIC prefix character varying[]);\nDROP FUNCTION IF EXISTS libdom.constant(VARIADIC prefix character varying[]);\nDROP FUNCTION IF EXISTS libdom.columns(regclass);\nDROP FUNCTION IF EXISTS libdom.api_load_entryset(args jsonb);\nDROP FUNCTION IF EXISTS libdom.api_change_entryset(args jsonb);\nDROP TYPE IF EXISTS libdom.domain;\nDROP TYPE IF EXISTS libdom.constant;\nDROP SCHEMA IF EXISTS libdom;\n--\n-- TOC entry 9 (class 2615 OID 295045)\n-- Name: libdom; Type: SCHEMA; Schema: -; Owner: -\n--\n\nCREATE SCHEMA libdom;\n\n\n--\n-- TOC entry 783 (class 1247 OID 295048)\n-- Name: constant; Type: TYPE; Schema: libdom; Owner: -\n--\n\nCREATE TYPE libdom.constant AS ( );\n\n\n\n\n--\n-- TOC entry 786 (class 1247 OID 295051)\n-- Name: domain; Type: TYPE; Schema: libdom; Owner: -\n--\n\nCREATE TYPE libdom.domain AS ( );\n\n\n\n--\n-- TOC entry 272 (class 1255 OID 295052)\n-- Name: api_change_entryset(jsonb); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.api_change_entryset(args jsonb) RETURNS jsonb\n    LANGUAGE plpgsql\n    AS $$\ndeclare\n  /**\n    essa funcao server para editar uma entrada editavel\n   */\n  name name default args->>'name';\n  value varchar default args->>'value';\n  label varchar default args->>'label';\n  domain varchar default args->>'domain';\nbegin\n  return libdom.set( name, value, label, domain, false );\nend;\n$$;\n\n\n--\n-- TOC entry 273 (class 1255 OID 295053)\n-- Name: api_load_entryset(jsonb); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.api_load_entryset(args jsonb) RETURNS SETOF jsonb\n    LANGUAGE sql\n    AS $$\n  select to_jsonb( e )\n    from libdom.entryset e\n    where e.editable\n    order by e.domain nulls last,\n      e.label,\n      e.name,\n      e.value\n\n$$;\n\n\n--\n-- TOC entry 326 (class 1255 OID 295718)\n-- Name: columns(regclass); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.columns(regclass) RETURNS TABLE(name character varying, type character varying, defaults text, isarray boolean, isgenerated boolean)\n    LANGUAGE sql IMMUTABLE STRICT PARALLEL SAFE\n    AS $_$\nwith __columns as (\n  select\n    col.column_name,\n    format_type( pt.oid, atttypmod )::varchar column_type,\n    col.column_default,\n    col.data_type = 'ARRAY' as is_array,\n    col.is_generated = 'ALWAYS' as is_generated\n  from information_schema.columns col\n         inner join pg_class c on c.relname = col.table_name\n    and col.table_schema::regnamespace = c.relnamespace\n         inner join pg_attribute att on col.column_name = att.attname\n    and att.attrelid = format( '%s.%s', col.table_schema, col.table_name )::regclass::oid\n         inner join pg_type pt on att.atttypid = pt.oid\n  where c.oid = $1\n) select *\nfrom __columns _c\n$_$;\n\n\n--\n-- TOC entry 270 (class 1255 OID 295054)\n-- Name: constant(character varying[]); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.constant(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS libdom.constant\n    LANGUAGE sql IMMUTABLE PARALLEL SAFE\n    AS $$\n  /**\n    Essa função serve para carregar os valores das constante e inicia-la\n   */\n  select jsonb_populate_record( null::libdom.constant, libdom.constant_document( variadic prefix ));\n$$;\n\n\n--\n-- TOC entry 271 (class 1255 OID 295055)\n-- Name: constant_document(character varying[]); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.constant_document(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS jsonb\n    LANGUAGE sql IMMUTABLE PARALLEL SAFE\n    AS $$\n  -- Devolver o mapeamento dos estados\n   select\n      jsonb_object_agg( cv.name, cv.value )\n    from libdom.prefix( variadic prefix ) cv\n;\n$$;\n\n\n--\n-- TOC entry 295 (class 1255 OID 295085)\n-- Name: describe(character varying[]); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.describe(VARIADIC prefix character varying[] DEFAULT NULL::character varying[]) RETURNS TABLE(declaration text, name name, type regtype, value text, domain character varying, label character varying, editable boolean, comment character varying)\n    LANGUAGE sql IMMUTABLE\n    AS $$\n-- Devolver o mapeamento dos estados\n  select\n      format( '%I %s default %L::%s;', cv.name, cv.type, cv.value, cv.type ),\n      cv.*\n    from libdom.prefix(  variadic prefix ) cv\n$$;\n\n\n--\n-- TOC entry 274 (class 1255 OID 295057)\n-- Name: domain(character varying[]); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.domain(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS libdom.domain\n    LANGUAGE sql IMMUTABLE PARALLEL SAFE\n    AS $$\n      /**\n        Essa função serve para carregar os valores das constante e inicia-la\n       */\n  select jsonb_populate_record( null::libdom.domain, libdom.domain_document( variadic prefix ));\n$$;\n\n\n--\n-- TOC entry 275 (class 1255 OID 295058)\n-- Name: domain_document(character varying[]); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.domain_document(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS jsonb\n    LANGUAGE sql IMMUTABLE PARALLEL SAFE\n    AS $$\n  -- Devolver o mapeamento dos estados\n  select\n      jsonb_object_agg( cv.name, cv.label )\n    from libdom.prefix( variadic prefix ) cv\n  ;\n$$;\n\n\n--\n-- TOC entry 276 (class 1255 OID 295059)\n-- Name: domain_of(name); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.domain_of(name name) RETURNS text\n    LANGUAGE sql IMMUTABLE PARALLEL SAFE\n    AS $$\n\n  /**\n      Essa função serve para devolver o valor especifico de uma constante\n   */\n  select cv.label\n    from libdom.entryset cv\n    where cv.name = domain_of.name;\n$$;\n\n\n--\n-- TOC entry 277 (class 1255 OID 295060)\n-- Name: domain_of(character varying, text); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.domain_of(domain character varying, value text) RETURNS text\n    LANGUAGE sql IMMUTABLE PARALLEL SAFE\n    AS $$\n\n  /**\n      Essa função serve para devolver o valor especifico de uma constante\n   */\n  select cv.label\n    from libdom.entryset cv\n    where cv.name = domain_of.domain\n      and cv.value = domain_of.value;\n$$;\n\n\n--\n-- TOC entry 330 (class 1255 OID 295719)\n-- Name: domsync(character varying, character varying, character varying); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.domsync(classname character varying, columnname character varying, domain character varying) RETURNS SETOF text\n    LANGUAGE plpgsql\n    AS $_$\ndeclare\n  _comment record;\n  _domsync record;\n  _command text;\nbegin\n  for _domsync in\n    with __column_comment as (\n      select\n          ds.classname,\n          ds.columnname,\n          array_agg( ds.domain ) as _domain,\n          format( '<ul>%s</ul>',\n            string_agg( format( '<li>%s ->> %s</li>', ds.domain, ds.comment ), e'\\n' ) filter ( where ds.comment is not null )\n          ) as comment\n        from libdom.domsync ds\n          inner join libdom.columns( ds.classname::regclass ) c on ds.columnname = c.name\n        where ds.classname = coalesce ( $1, ds.classname )\n          and ds.columnname = coalesce( $2, ds.columnname )\n          and ds.domain = coalesce( $3, ds.domain )\n        group by ds.classname, ds.columnname\n    ) select *\n        from __column_comment cc\n        where domsync.domain = any ( cc._domain ) or domsync.domain is null\n  loop\n      select\n          format( '<table><tr><th>lable</th><th>value</th><th>domain</th><th>name</th></tr>%s</table>', string_agg( format( '<tr>%s %s %s %s </tr>',\n            format( '<td>%s</td>', es.label ),\n            format( '<td>%s</td>', es.value ),\n            format( '<td>%s</td>', es.domain ),\n            format( '<td>%s</td>', es.name )\n          ), e'\\n' ) ) as comment\n          into _comment\n        from libdom.entryset es\n        where es.domain = any ( _domsync._domain );\n\n      _command := format( 'comment on column %s.%I is $comment$ %s $comment$;', _domsync.classname, _domsync.columnname, format( e'<html><style>\ntable, th, td {\n  border:1px solid black;\n}\n</style><body><div>%s\\n%s</div></body></html>', _domsync.comment, _comment.comment ) );\n      execute _command;\n      return next _command;\n  end loop;\nend\n$_$;\n\n\n--\n-- TOC entry 278 (class 1255 OID 295061)\n-- Name: entry(name, regtype, anyelement, character varying, character varying, boolean, character varying, boolean); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.entry(name name, type regtype, val anyelement, domain character varying DEFAULT NULL::character varying, label character varying DEFAULT NULL::character varying, editable boolean DEFAULT false, comment character varying DEFAULT NULL::character varying, force boolean DEFAULT false) RETURNS boolean\n    LANGUAGE plpgsql\n    AS $$\ndeclare\n  /**\n    * Essa função serve para registrar o valor de uma constante na base de dados\n    * Se a constante já tiver o valor definido esse valor pode ser subistituido\n      pelo novo desde que o parametro arg_entryset_replace estiver verdadeiro\n    * Caso existir sem o parametro arg_entryset_replace verdadeiro uma excessão sera lançada\n   */\n  _entryset libdom.entryset;\n\nbegin\n\n  editable := coalesce( editable, false );\n\n  if domain is null and exists(\n    select *\n      from libdom.entryset e\n      where e.domain = entry.domain\n        and e.name != entry.name\n        and e.value = val::text\n  ) and not force then\n    raise exception 'Já existe um dominio com o mesmo valor para este grupo!';\n  end if;\n\n  select * into _entryset\n    from libdom.entryset const\n    where const.name = entry.name\n  ;\n\n\n  -- Deletar o valor de constante\n  delete from libdom.entryset e where e.name = entry.name;\n\n  -- Recriar o valor de constante\n  insert into libdom.entryset(\n    name,\n    type,\n    value,\n    editable,\n    label,\n    comment,\n    domain\n  ) values (\n     entry.name,\n     entry.type,\n     entry.val,\n     entry.editable,\n     entry.label,\n     entry.comment,\n     entry.domain\n   ) returning * into _entryset;\n  return true;\nend;\n$$;\n\n\n--\n-- TOC entry 289 (class 1255 OID 295062)\n-- Name: entry_drop(name, boolean); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.entry_drop(arg_name name, arg_dropforce boolean DEFAULT false) RETURNS boolean\n    LANGUAGE plpgsql\n    AS $$\ndeclare\n  /**\n    * Essa função serve para registrar o valor de uma constante na base de dados\n    * Se a constante já tiver o valor definido esse valor pode ser subistituido\n      pelo novo desde que o parametro arg_entryset_replace estiver verdadeiro\n    * Caso existir sem o parametro arg_entryset_replace verdadeiro uma excessão sera lançada\n   */\n  _entryset libdom.entryset;\n  command text;\n  arg_entryset_continer regtype := 'libdom.constant'::regtype;\nbegin\n  arg_dropforce := coalesce( arg_dropforce, false );\n  select * into _entryset\n    from libdom.entryset const\n    where const.name = arg_name\n  ;\n\n  -- Destruir a constante casao existir\n  if arg_dropforce then\n    command := format( 'alter type %s drop attribute if exists %I cascade;', arg_entryset_continer, arg_name );\n  else\n    command := format( 'alter type %s drop attribute if exists %I;', arg_entryset_continer, arg_name );\n  end if;\n  execute command;\n\n  -- Deletar o valor de constante\n  delete from libdom.entryset where name = arg_name;\n\n  return true;\nend;\n$$;\n\n\n--\n-- TOC entry 331 (class 1255 OID 315924)\n-- Name: entry_list(jsonb); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.entry_list(args jsonb) RETURNS SETOF jsonb\n    LANGUAGE plpgsql\n    AS $$\ndeclare\n  _name character varying default args->>'name';\n  _value character varying default args->>'value';\n  _domain character varying default args->>'domain';\n  _label character varying default args->>'label';\nbegin\n  return query\n    with __entry as (\n      select\n          es.name,\n          es.type,\n          es.value,\n          es.domain,\n          es.label\n        from libdom.entryset es\n        where es.name = coalesce( _name, es.name )\n          and es.value = coalesce( _value, es.value )\n          and coalesce( es.domain, '' ) = coalesce( _domain, es.domain, '' )\n          and coalesce( es.label, '' ) = coalesce( _label, es.label, '' )\n      ) select to_jsonb( _e )\n          from __entry _e\n          order by _e.domain,\n            _e.label,\n            _e.name,\n            _e.value\n  ;\nend;\n$$;\n\n\n--\n-- TOC entry 290 (class 1255 OID 295063)\n-- Name: exports(character varying, character varying[]); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.exports(schema_name character varying DEFAULT 'libdom'::character varying, VARIADIC name character varying[] DEFAULT ARRAY[]::character varying[]) RETURNS TABLE(name character varying, type regtype, value text, declaration text)\n    LANGUAGE sql\n    AS $_$\nwith names as (\n  select array_agg( distinct coalesce( un, '')||'%' ) as list\n  from unnest( $2 ) un\n)\n  select\n    cv.name,\n    cv.type,\n    cv.value,\n    format( 'select %I.entry(name := %L, type := %L::regtype, val := %L::text, domain := %L::varchar, label := %L, editable := %L, comment := %L );',\n            schema_name,\n            cv.name,\n            cv.type,\n            cv.value,\n            cv.domain,\n            cv.label,\n            cv.editable,\n            cv.comment\n      )\n  from libdom.entryset cv inner join names na on true\n  where cv.name like any( na.list )\n$_$;\n\n\n--\n-- TOC entry 291 (class 1255 OID 295064)\n-- Name: get(name); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.get(arg_name name) RETURNS text\n    LANGUAGE sql IMMUTABLE PARALLEL SAFE\n    AS $$\n\n  /**\n      Essa função serve para devolver o valor especifico de uma constante\n   */\n  select cv.value\n    from libdom.entryset cv\n    where cv.name = arg_name;\n$$;\n\n\nSET default_tablespace = '';\n\nSET default_table_access_method = heap;\n\n--\n-- TOC entry 216 (class 1259 OID 295065)\n-- Name: entryset; Type: TABLE; Schema: libdom; Owner: -\n--\n\nCREATE TABLE libdom.entryset (\n    name name NOT NULL,\n    type regtype NOT NULL,\n    value text NOT NULL,\n    domain character varying,\n    label character varying,\n    editable boolean DEFAULT false NOT NULL,\n    comment character varying\n);\n\n\n--\n-- TOC entry 3154 (class 0 OID 0)\n-- Dependencies: 216\n-- Name: TABLE entryset; Type: COMMENT; Schema: libdom; Owner: -\n--\n\nCOMMENT ON TABLE libdom.entryset IS 'Essa entidade serve para armazenar os valores das constantes';\n\n\n--\n-- TOC entry 3155 (class 0 OID 0)\n-- Dependencies: 216\n-- Name: COLUMN entryset.name; Type: COMMENT; Schema: libdom; Owner: -\n--\n\nCOMMENT ON COLUMN libdom.entryset.name IS 'Corresponde ao nome da constante';\n\n\n--\n-- TOC entry 3156 (class 0 OID 0)\n-- Dependencies: 216\n-- Name: COLUMN entryset.type; Type: COMMENT; Schema: libdom; Owner: -\n--\n\nCOMMENT ON COLUMN libdom.entryset.type IS 'Corresponde ao tipo da constante';\n\n\n--\n-- TOC entry 3157 (class 0 OID 0)\n-- Dependencies: 216\n-- Name: COLUMN entryset.value; Type: COMMENT; Schema: libdom; Owner: -\n--\n\nCOMMENT ON COLUMN libdom.entryset.value IS 'Corresponde ao valor da constante';\n\n\n--\n-- TOC entry 3158 (class 0 OID 0)\n-- Dependencies: 216\n-- Name: COLUMN entryset.label; Type: COMMENT; Schema: libdom; Owner: -\n--\n\nCOMMENT ON COLUMN libdom.entryset.label IS 'Corresponde a descrição da constante';\n\n\n--\n-- TOC entry 3159 (class 0 OID 0)\n-- Dependencies: 216\n-- Name: COLUMN entryset.editable; Type: COMMENT; Schema: libdom; Owner: -\n--\n\nCOMMENT ON COLUMN libdom.entryset.editable IS 'Esse atributo indica se a constante pode ser editavel';\n\n\n--\n-- TOC entry 3160 (class 0 OID 0)\n-- Dependencies: 216\n-- Name: COLUMN entryset.comment; Type: COMMENT; Schema: libdom; Owner: -\n--\n\nCOMMENT ON COLUMN libdom.entryset.comment IS 'Commentario para a constante';\n\n\n--\n-- TOC entry 292 (class 1255 OID 295072)\n-- Name: prefix(character varying[]); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.prefix(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS SETOF libdom.entryset\n    LANGUAGE plpgsql IMMUTABLE PARALLEL SAFE\n    AS $$\ndeclare\n  _prefix varchar[];\n  _length int default coalesce( array_length( prefix, 1), 0 );\nbegin\n  select array_agg( format( '%s%%', e.element ) ) into _prefix\n  from unnest( coalesce( prefix, '{}'::text[] ) ) e ( element );\n\n  return query\n    select e.*\n    from libdom.entryset e\n    where e.name like any( _prefix )\n       or _length = 0\n  ;\nend;\n$$;\n\n\n--\n-- TOC entry 327 (class 1255 OID 295073)\n-- Name: rebuild(boolean); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.rebuild(clean boolean) RETURNS SETOF text\n    LANGUAGE plpgsql\n    AS $$\ndeclare\n  _data record;\n  _const libdom.constant;\n  _dom libdom.domain;\n  command text;\n  constant_class regtype default 'libdom.constant'::regtype;\n  domain_class regtype default 'libdom.domain'::regtype;\nbegin\n\n  -- Lipar todos os atributos atual nas classe de dominio e de constant\n  if clean then\n    for _data in\n      select *\n        from jsonb_each (to_jsonb( _const ))\n    loop\n      command := format( 'alter type %s drop attribute if exists %I', _data.key, constant_class );\n      execute command;\n    end loop;\n\n    for _data in\n      select *\n        from jsonb_each (to_jsonb( _dom ))\n    loop\n      command := format( 'alter type %s drop attribute if exists %I', _data.key, domain_class);\n      execute command;\n    end loop;\n\n  end if;\n\n  -- Recriar todos os atributos para a classe de dominio e de constant\n  for _data in\n    select *\n      from libdom.entryset e\n  loop\n    return next to_jsonb( _data )::text;\n    return query select * from libdom.sync_entry( _data.name, 'libdom.constant' );\n    return query select * from libdom.sync_entry( _data.name, 'libdom.domain' );\n  end loop;\n  \n  return query select * from libdom.domsync( null, null, null );\nend;\n$$;\n\n\n--\n-- TOC entry 293 (class 1255 OID 295074)\n-- Name: set(name, character varying, character varying, character varying, boolean); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.set(name name, value character varying DEFAULT NULL::character varying, label character varying DEFAULT NULL::character varying, domain character varying DEFAULT NULL::character varying, force boolean DEFAULT false) RETURNS jsonb\n    LANGUAGE plpgsql\n    AS $$\ndeclare\n  /**\n      Essa função serve para atualizar o valor de uma constante\n   */\n  _entryset libdom.entryset;\nbegin\n\n  if domain is null and exists(\n      select *\n      from libdom.entryset e\n      where e.domain = set.domain\n        and e.name != set.name\n        and e.value = set.value::text\n    ) and not force then\n    return jsonb_build_object(\n      'result', false,\n      'message', 'Já existe um dominio com o mesmo valor para este grupo!'\n    );\n  end if;\n\n  if !exists(\n    select *\n      from libdom.entryset e\n      where e.name = set.name\n        and e.editable\n  ) then\n    return jsonb_build_object(\n        'result', false,\n        'message', 'Não existe uma entrada editavel com este nome!'\n      );\n  end if;\n\n  update libdom.entryset\n    set ( value, label, domain ) = ( value, label, domain )\n    where name = name\n    returning * into _entryset\n  ;\n\n  return jsonb_build_object(\n    'result', true,\n    'data', jsonb_build_object(\n      'entryset', _entryset\n    )\n  );\nend;\n$$;\n\n\n--\n-- TOC entry 294 (class 1255 OID 295075)\n-- Name: sync_drop(name, regtype); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.sync_drop(name name, classtype regtype) RETURNS SETOF text\n    LANGUAGE plpgsql\n    AS $$\ndeclare\n  command text;\nbegin\n  command := format( 'alter type %s drop attribute if exists %I', classtype, name );\n  execute command;\nend;\n$$;\n\n\n--\n-- TOC entry 328 (class 1255 OID 295076)\n-- Name: sync_entry(name, regtype); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.sync_entry(name name, classtype regtype) RETURNS SETOF text\n    LANGUAGE plpgsql\n    AS $$\ndeclare\n  /**\n    Syncronizar uma entry em na calsse expecificada\n   */\n  command text;\n  _entry libdom.entryset;\n  _type regtype default 'text'::regtype;\nbegin\n\n  select * into _entry\n    from libdom.entryset e\n    where e.name = sync_entry.name;\n\n  if classtype = 'libdom.constant'::regtype then\n    _type := _entry.type;\n  end if;\n\n  -- Destruir a constante casao existir\n  command := format( 'alter type %s drop attribute if exists %I;', classtype, name );\n  execute command;\n  return next command;\n\n  -- Recriar a constante novamente\n  command := format( 'alter type %s add attribute %I %s;', classtype, name, _type );\n  execute command;\n  return next command;\n\n  if _entry.comment is not null then\n    command := format( 'comment on column %s.%I is %L;', classtype, name, _entry.comment );\n    execute command;\n    return next command;\n  end if;\nend;\n$$;\n\n\n--\n-- TOC entry 329 (class 1255 OID 295734)\n-- Name: trigger_sync_domsync(); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.trigger_sync_domsync() RETURNS trigger\n    LANGUAGE plpgsql\n    AS $$\ndeclare\n  _new libdom.domsync;\n  _old libdom.domsync;\nbegin\n  if tg_op in ( 'UPDATE', 'INSERT' ) then\n    perform libdom.domsync( _new.classname, _new.columnname, _new.domain );\n  end if;\nend;\n$$;\n\n\n--\n-- TOC entry 296 (class 1255 OID 295077)\n-- Name: trigger_sync_entry(); Type: FUNCTION; Schema: libdom; Owner: -\n--\n\nCREATE FUNCTION libdom.trigger_sync_entry() RETURNS trigger\n    LANGUAGE plpgsql\n    AS $$\ndeclare\n  _new libdom.entryset;\n  _old libdom.entryset;\nbegin\n  _new := new;\n  _old := old;\n\n\n  if tg_op = 'UPDATE' and _new.name != _old.name then\n    perform libdom.sync_drop( _old.name, 'libdom.constant' );\n    perform libdom.sync_drop( _old.name, 'libdom.domain' );\n  end if;\n\n  if tg_op in ( 'INSERT', 'UPDATE' ) and (\n    coalesce( _new.name::text, '' ) != coalesce( _old.name::text, '' )\n    or coalesce( _new.type::text, '' ) != coalesce( _old.type::text, '' )\n    or coalesce( _new.comment::text, '' ) != coalesce( _old.comment::text, '' )\n  ) then\n    perform libdom.sync_entry( _new.name, 'libdom.constant' );\n    perform libdom.sync_entry( _new.name, 'libdom.domain' );\n    perform libdom.domsync( null, null, _new.domain );\n  end if;\n\n  if tg_op in ( 'DELETE'  ) then\n    perform libdom.sync_drop( _old.name, 'libdom.constant' );\n    perform libdom.sync_drop( _old.name, 'libdom.domain' );\n    return null;\n  end if;\n\n\n  if tg_op in ( 'INSERT', 'UPDATE' ) then\n    return _new;\n  end if;\nend;\n$$;\n\n\n--\n-- TOC entry 227 (class 1259 OID 295708)\n-- Name: domsync; Type: TABLE; Schema: libdom; Owner: -\n--\n\nCREATE TABLE libdom.domsync (\n    classname character varying NOT NULL,\n    columnname character varying NOT NULL,\n    domain character varying NOT NULL,\n    comment text,\n    CONSTRAINT domsync_classname_check CHECK (((classname)::regclass IS NOT NULL))\n);\n\n--\n-- TOC entry 2998 (class 2606 OID 295716)\n-- Name: domsync domsync_pkey; Type: CONSTRAINT; Schema: libdom; Owner: -\n--\n\nALTER TABLE ONLY libdom.domsync\n    ADD CONSTRAINT domsync_pkey PRIMARY KEY (classname, columnname);\n\n\n--\n-- TOC entry 2996 (class 2606 OID 295079)\n-- Name: entryset pk_name; Type: CONSTRAINT; Schema: libdom; Owner: -\n--\n\nALTER TABLE ONLY libdom.entryset\n    ADD CONSTRAINT pk_name PRIMARY KEY (name);\n\n\n--\n-- TOC entry 2999 (class 2620 OID 295080)\n-- Name: entryset sync_trigger; Type: TRIGGER; Schema: libdom; Owner: -\n--\n\nCREATE TRIGGER sync_trigger AFTER INSERT OR DELETE OR UPDATE ON libdom.entryset FOR EACH ROW EXECUTE FUNCTION libdom.trigger_sync_entry();\n\n\n--\n-- TOC entry 3000 (class 2620 OID 295735)\n-- Name: domsync trigger_sync_domsync; Type: TRIGGER; Schema: libdom; Owner: -\n--\n\nCREATE TRIGGER trigger_sync_domsync AFTER INSERT OR UPDATE ON libdom.domsync FOR EACH ROW EXECUTE FUNCTION libdom.trigger_sync_domsync();\n\n\n-- Completed on 2023-01-05 19:41:10\n\n--\n-- PostgreSQL database dump complete\n--\n\n	-- -- PostgreSQL database dump -- -- Dumped from database version 13.7 (Ubuntu 13.7-1.pgdg20.04+1) -- Dumped by pg_dump version 13.2 -- Started on 2023-01-05 19:40:16 SET statement_timeout = 0; SET lock_timeout = 0; SET idle_in_transaction_session_timeout = 0; SET client_encoding = 'UTF8'; SET standard_conforming_strings = on; SELECT pg_catalog.set_config('search_path', '', false); SET check_function_bodies = false; SET xmloption = content; SET client_min_messages = warning; SET row_security = off; DROP TRIGGER IF EXISTS trigger_sync_domsync ON libdom.domsync; DROP TRIGGER IF EXISTS sync_trigger ON libdom.entryset; ALTER TABLE IF EXISTS ONLY libdom.entryset DROP CONSTRAINT IF EXISTS pk_name; ALTER TABLE IF EXISTS ONLY libdom.domsync DROP CONSTRAINT IF EXISTS domsync_pkey; DROP TABLE IF EXISTS libdom.domsync; DROP FUNCTION IF EXISTS libdom.trigger_sync_entry(); DROP FUNCTION IF EXISTS libdom.trigger_sync_domsync(); DROP FUNCTION IF EXISTS libdom.sync_entry(name name, classtype regtype); DROP FUNCTION IF EXISTS libdom.sync_drop(name name, classtype regtype); DROP FUNCTION IF EXISTS libdom.set(name name, value character varying, label character varying, domain character varying, force boolean); DROP FUNCTION IF EXISTS libdom.rebuild(clean boolean); DROP FUNCTION IF EXISTS libdom.prefix(VARIADIC prefix character varying[]); DROP TABLE IF EXISTS libdom.entryset; DROP FUNCTION IF EXISTS libdom.get(arg_name name); DROP FUNCTION IF EXISTS libdom.exports(schema_name character varying, VARIADIC name character varying[]); DROP FUNCTION IF EXISTS libdom.entry_list(args jsonb); DROP FUNCTION IF EXISTS libdom.entry_drop(arg_name name, arg_dropforce boolean); DROP FUNCTION IF EXISTS libdom.entry(name name, type regtype, val anyelement, domain character varying, label character varying, editable boolean, comment character varying, force boolean); DROP FUNCTION IF EXISTS libdom.domsync(classname character varying, columnname character varying, domain character varying); DROP FUNCTION IF EXISTS libdom.domain_of(domain character varying, value text); DROP FUNCTION IF EXISTS libdom.domain_of(name name); DROP FUNCTION IF EXISTS libdom.domain_document(VARIADIC prefix character varying[]); DROP FUNCTION IF EXISTS libdom.domain(VARIADIC prefix character varying[]); DROP FUNCTION IF EXISTS libdom.describe(VARIADIC prefix character varying[]); DROP FUNCTION IF EXISTS libdom.constant_document(VARIADIC prefix character varying[]); DROP FUNCTION IF EXISTS libdom.constant(VARIADIC prefix character varying[]); DROP FUNCTION IF EXISTS libdom.columns(regclass); DROP FUNCTION IF EXISTS libdom.api_load_entryset(args jsonb); DROP FUNCTION IF EXISTS libdom.api_change_entryset(args jsonb); DROP TYPE IF EXISTS libdom.domain; DROP TYPE IF EXISTS libdom.constant; DROP SCHEMA IF EXISTS libdom; -- -- TOC entry 9 (class 2615 OID 295045) -- Name: libdom; Type: SCHEMA; Schema: -; Owner: - -- CREATE SCHEMA libdom; -- -- TOC entry 783 (class 1247 OID 295048) -- Name: constant; Type: TYPE; Schema: libdom; Owner: - -- CREATE TYPE libdom.constant AS ( ); -- -- TOC entry 786 (class 1247 OID 295051) -- Name: domain; Type: TYPE; Schema: libdom; Owner: - -- CREATE TYPE libdom.domain AS ( ); -- -- TOC entry 272 (class 1255 OID 295052) -- Name: api_change_entryset(jsonb); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.api_change_entryset(args jsonb) RETURNS jsonb LANGUAGE plpgsql AS $$ declare /** essa funcao server para editar uma entrada editavel */ name name default args->>'name'; value varchar default args->>'value'; label varchar default args->>'label'; domain varchar default args->>'domain'; begin return libdom.set( name, value, label, domain, false ); end; $$; -- -- TOC entry 273 (class 1255 OID 295053) -- Name: api_load_entryset(jsonb); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.api_load_entryset(args jsonb) RETURNS SETOF jsonb LANGUAGE sql AS $$ select to_jsonb( e ) from libdom.entryset e where e.editable order by e.domain nulls last, e.label, e.name, e.value $$; -- -- TOC entry 326 (class 1255 OID 295718) -- Name: columns(regclass); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.columns(regclass) RETURNS TABLE(name character varying, type character varying, defaults text, isarray boolean, isgenerated boolean) LANGUAGE sql IMMUTABLE STRICT PARALLEL SAFE AS $_$ with __columns as ( select col.column_name, format_type( pt.oid, atttypmod )::varchar column_type, col.column_default, col.data_type = 'ARRAY' as is_array, col.is_generated = 'ALWAYS' as is_generated from information_schema.columns col inner join pg_class c on c.relname = col.table_name and col.table_schema::regnamespace = c.relnamespace inner join pg_attribute att on col.column_name = att.attname and att.attrelid = format( '%s.%s', col.table_schema, col.table_name )::regclass::oid inner join pg_type pt on att.atttypid = pt.oid where c.oid = $1 ) select * from __columns _c $_$; -- -- TOC entry 270 (class 1255 OID 295054) -- Name: constant(character varying[]); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.constant(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS libdom.constant LANGUAGE sql IMMUTABLE PARALLEL SAFE AS $$ /** Essa função serve para carregar os valores das constante e inicia-la */ select jsonb_populate_record( null::libdom.constant, libdom.constant_document( variadic prefix )); $$; -- -- TOC entry 271 (class 1255 OID 295055) -- Name: constant_document(character varying[]); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.constant_document(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS jsonb LANGUAGE sql IMMUTABLE PARALLEL SAFE AS $$ -- Devolver o mapeamento dos estados select jsonb_object_agg( cv.name, cv.value ) from libdom.prefix( variadic prefix ) cv ; $$; -- -- TOC entry 295 (class 1255 OID 295085) -- Name: describe(character varying[]); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.describe(VARIADIC prefix character varying[] DEFAULT NULL::character varying[]) RETURNS TABLE(declaration text, name name, type regtype, value text, domain character varying, label character varying, editable boolean, comment character varying) LANGUAGE sql IMMUTABLE AS $$ -- Devolver o mapeamento dos estados select format( '%I %s default %L::%s;', cv.name, cv.type, cv.value, cv.type ), cv.* from libdom.prefix( variadic prefix ) cv $$; -- -- TOC entry 274 (class 1255 OID 295057) -- Name: domain(character varying[]); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.domain(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS libdom.domain LANGUAGE sql IMMUTABLE PARALLEL SAFE AS $$ /** Essa função serve para carregar os valores das constante e inicia-la */ select jsonb_populate_record( null::libdom.domain, libdom.domain_document( variadic prefix )); $$; -- -- TOC entry 275 (class 1255 OID 295058) -- Name: domain_document(character varying[]); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.domain_document(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS jsonb LANGUAGE sql IMMUTABLE PARALLEL SAFE AS $$ -- Devolver o mapeamento dos estados select jsonb_object_agg( cv.name, cv.label ) from libdom.prefix( variadic prefix ) cv ; $$; -- -- TOC entry 276 (class 1255 OID 295059) -- Name: domain_of(name); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.domain_of(name name) RETURNS text LANGUAGE sql IMMUTABLE PARALLEL SAFE AS $$ /** Essa função serve para devolver o valor especifico de uma constante */ select cv.label from libdom.entryset cv where cv.name = domain_of.name; $$; -- -- TOC entry 277 (class 1255 OID 295060) -- Name: domain_of(character varying, text); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.domain_of(domain character varying, value text) RETURNS text LANGUAGE sql IMMUTABLE PARALLEL SAFE AS $$ /** Essa função serve para devolver o valor especifico de uma constante */ select cv.label from libdom.entryset cv where cv.name = domain_of.domain and cv.value = domain_of.value; $$; -- -- TOC entry 330 (class 1255 OID 295719) -- Name: domsync(character varying, character varying, character varying); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.domsync(classname character varying, columnname character varying, domain character varying) RETURNS SETOF text LANGUAGE plpgsql AS $_$ declare _comment record; _domsync record; _command text; begin for _domsync in with __column_comment as ( select ds.classname, ds.columnname, array_agg( ds.domain ) as _domain, format( '<ul>%s</ul>', string_agg( format( '<li>%s ->> %s</li>', ds.domain, ds.comment ), e'\\n' ) filter ( where ds.comment is not null ) ) as comment from libdom.domsync ds inner join libdom.columns( ds.classname::regclass ) c on ds.columnname = c.name where ds.classname = coalesce ( $1, ds.classname ) and ds.columnname = coalesce( $2, ds.columnname ) and ds.domain = coalesce( $3, ds.domain ) group by ds.classname, ds.columnname ) select * from __column_comment cc where domsync.domain = any ( cc._domain ) or domsync.domain is null loop select format( '<table><tr><th>lable</th><th>value</th><th>domain</th><th>name</th></tr>%s</table>', string_agg( format( '<tr>%s %s %s %s </tr>', format( '<td>%s</td>', es.label ), format( '<td>%s</td>', es.value ), format( '<td>%s</td>', es.domain ), format( '<td>%s</td>', es.name ) ), e'\\n' ) ) as comment into _comment from libdom.entryset es where es.domain = any ( _domsync._domain ); _command := format( 'comment on column %s.%I is $comment$ %s $comment$;', _domsync.classname, _domsync.columnname, format( e'<html><style> table, th, td { border:1px solid black; } </style><body><div>%s\\n%s</div></body></html>', _domsync.comment, _comment.comment ) ); execute _command; return next _command; end loop; end $_$; -- -- TOC entry 278 (class 1255 OID 295061) -- Name: entry(name, regtype, anyelement, character varying, character varying, boolean, character varying, boolean); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.entry(name name, type regtype, val anyelement, domain character varying DEFAULT NULL::character varying, label character varying DEFAULT NULL::character varying, editable boolean DEFAULT false, comment character varying DEFAULT NULL::character varying, force boolean DEFAULT false) RETURNS boolean LANGUAGE plpgsql AS $$ declare /** * Essa função serve para registrar o valor de uma constante na base de dados * Se a constante já tiver o valor definido esse valor pode ser subistituido pelo novo desde que o parametro arg_entryset_replace estiver verdadeiro * Caso existir sem o parametro arg_entryset_replace verdadeiro uma excessão sera lançada */ _entryset libdom.entryset; begin editable := coalesce( editable, false ); if domain is null and exists( select * from libdom.entryset e where e.domain = entry.domain and e.name != entry.name and e.value = val::text ) and not force then raise exception 'Já existe um dominio com o mesmo valor para este grupo!'; end if; select * into _entryset from libdom.entryset const where const.name = entry.name ; -- Deletar o valor de constante delete from libdom.entryset e where e.name = entry.name; -- Recriar o valor de constante insert into libdom.entryset( name, type, value, editable, label, comment, domain ) values ( entry.name, entry.type, entry.val, entry.editable, entry.label, entry.comment, entry.domain ) returning * into _entryset; return true; end; $$; -- -- TOC entry 289 (class 1255 OID 295062) -- Name: entry_drop(name, boolean); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.entry_drop(arg_name name, arg_dropforce boolean DEFAULT false) RETURNS boolean LANGUAGE plpgsql AS $$ declare /** * Essa função serve para registrar o valor de uma constante na base de dados * Se a constante já tiver o valor definido esse valor pode ser subistituido pelo novo desde que o parametro arg_entryset_replace estiver verdadeiro * Caso existir sem o parametro arg_entryset_replace verdadeiro uma excessão sera lançada */ _entryset libdom.entryset; command text; arg_entryset_continer regtype := 'libdom.constant'::regtype; begin arg_dropforce := coalesce( arg_dropforce, false ); select * into _entryset from libdom.entryset const where const.name = arg_name ; -- Destruir a constante casao existir if arg_dropforce then command := format( 'alter type %s drop attribute if exists %I cascade;', arg_entryset_continer, arg_name ); else command := format( 'alter type %s drop attribute if exists %I;', arg_entryset_continer, arg_name ); end if; execute command; -- Deletar o valor de constante delete from libdom.entryset where name = arg_name; return true; end; $$; -- -- TOC entry 331 (class 1255 OID 315924) -- Name: entry_list(jsonb); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.entry_list(args jsonb) RETURNS SETOF jsonb LANGUAGE plpgsql AS $$ declare _name character varying default args->>'name'; _value character varying default args->>'value'; _domain character varying default args->>'domain'; _label character varying default args->>'label'; begin return query with __entry as ( select es.name, es.type, es.value, es.domain, es.label from libdom.entryset es where es.name = coalesce( _name, es.name ) and es.value = coalesce( _value, es.value ) and coalesce( es.domain, '' ) = coalesce( _domain, es.domain, '' ) and coalesce( es.label, '' ) = coalesce( _label, es.label, '' ) ) select to_jsonb( _e ) from __entry _e order by _e.domain, _e.label, _e.name, _e.value ; end; $$; -- -- TOC entry 290 (class 1255 OID 295063) -- Name: exports(character varying, character varying[]); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.exports(schema_name character varying DEFAULT 'libdom'::character varying, VARIADIC name character varying[] DEFAULT ARRAY[]::character varying[]) RETURNS TABLE(name character varying, type regtype, value text, declaration text) LANGUAGE sql AS $_$ with names as ( select array_agg( distinct coalesce( un, '')||'%' ) as list from unnest( $2 ) un ) select cv.name, cv.type, cv.value, format( 'select %I.entry(name := %L, type := %L::regtype, val := %L::text, domain := %L::varchar, label := %L, editable := %L, comment := %L );', schema_name, cv.name, cv.type, cv.value, cv.domain, cv.label, cv.editable, cv.comment ) from libdom.entryset cv inner join names na on true where cv.name like any( na.list ) $_$; -- -- TOC entry 291 (class 1255 OID 295064) -- Name: get(name); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.get(arg_name name) RETURNS text LANGUAGE sql IMMUTABLE PARALLEL SAFE AS $$ /** Essa função serve para devolver o valor especifico de uma constante */ select cv.value from libdom.entryset cv where cv.name = arg_name; $$; SET default_tablespace = ''; SET default_table_access_method = heap; -- -- TOC entry 216 (class 1259 OID 295065) -- Name: entryset; Type: TABLE; Schema: libdom; Owner: - -- CREATE TABLE libdom.entryset ( name name NOT NULL, type regtype NOT NULL, value text NOT NULL, domain character varying, label character varying, editable boolean DEFAULT false NOT NULL, comment character varying ); -- -- TOC entry 3154 (class 0 OID 0) -- Dependencies: 216 -- Name: TABLE entryset; Type: COMMENT; Schema: libdom; Owner: - -- COMMENT ON TABLE libdom.entryset IS 'Essa entidade serve para armazenar os valores das constantes'; -- -- TOC entry 3155 (class 0 OID 0) -- Dependencies: 216 -- Name: COLUMN entryset.name; Type: COMMENT; Schema: libdom; Owner: - -- COMMENT ON COLUMN libdom.entryset.name IS 'Corresponde ao nome da constante'; -- -- TOC entry 3156 (class 0 OID 0) -- Dependencies: 216 -- Name: COLUMN entryset.type; Type: COMMENT; Schema: libdom; Owner: - -- COMMENT ON COLUMN libdom.entryset.type IS 'Corresponde ao tipo da constante'; -- -- TOC entry 3157 (class 0 OID 0) -- Dependencies: 216 -- Name: COLUMN entryset.value; Type: COMMENT; Schema: libdom; Owner: - -- COMMENT ON COLUMN libdom.entryset.value IS 'Corresponde ao valor da constante'; -- -- TOC entry 3158 (class 0 OID 0) -- Dependencies: 216 -- Name: COLUMN entryset.label; Type: COMMENT; Schema: libdom; Owner: - -- COMMENT ON COLUMN libdom.entryset.label IS 'Corresponde a descrição da constante'; -- -- TOC entry 3159 (class 0 OID 0) -- Dependencies: 216 -- Name: COLUMN entryset.editable; Type: COMMENT; Schema: libdom; Owner: - -- COMMENT ON COLUMN libdom.entryset.editable IS 'Esse atributo indica se a constante pode ser editavel'; -- -- TOC entry 3160 (class 0 OID 0) -- Dependencies: 216 -- Name: COLUMN entryset.comment; Type: COMMENT; Schema: libdom; Owner: - -- COMMENT ON COLUMN libdom.entryset.comment IS 'Commentario para a constante'; -- -- TOC entry 292 (class 1255 OID 295072) -- Name: prefix(character varying[]); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.prefix(VARIADIC prefix character varying[] DEFAULT '{}'::character varying[]) RETURNS SETOF libdom.entryset LANGUAGE plpgsql IMMUTABLE PARALLEL SAFE AS $$ declare _prefix varchar[]; _length int default coalesce( array_length( prefix, 1), 0 ); begin select array_agg( format( '%s%%', e.element ) ) into _prefix from unnest( coalesce( prefix, '{}'::text[] ) ) e ( element ); return query select e.* from libdom.entryset e where e.name like any( _prefix ) or _length = 0 ; end; $$; -- -- TOC entry 327 (class 1255 OID 295073) -- Name: rebuild(boolean); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.rebuild(clean boolean) RETURNS SETOF text LANGUAGE plpgsql AS $$ declare _data record; _const libdom.constant; _dom libdom.domain; command text; constant_class regtype default 'libdom.constant'::regtype; domain_class regtype default 'libdom.domain'::regtype; begin -- Lipar todos os atributos atual nas classe de dominio e de constant if clean then for _data in select * from jsonb_each (to_jsonb( _const )) loop command := format( 'alter type %s drop attribute if exists %I', _data.key, constant_class ); execute command; end loop; for _data in select * from jsonb_each (to_jsonb( _dom )) loop command := format( 'alter type %s drop attribute if exists %I', _data.key, domain_class); execute command; end loop; end if; -- Recriar todos os atributos para a classe de dominio e de constant for _data in select * from libdom.entryset e loop return next to_jsonb( _data )::text; return query select * from libdom.sync_entry( _data.name, 'libdom.constant' ); return query select * from libdom.sync_entry( _data.name, 'libdom.domain' ); end loop; return query select * from libdom.domsync( null, null, null ); end; $$; -- -- TOC entry 293 (class 1255 OID 295074) -- Name: set(name, character varying, character varying, character varying, boolean); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.set(name name, value character varying DEFAULT NULL::character varying, label character varying DEFAULT NULL::character varying, domain character varying DEFAULT NULL::character varying, force boolean DEFAULT false) RETURNS jsonb LANGUAGE plpgsql AS $$ declare /** Essa função serve para atualizar o valor de uma constante */ _entryset libdom.entryset; begin if domain is null and exists( select * from libdom.entryset e where e.domain = set.domain and e.name != set.name and e.value = set.value::text ) and not force then return jsonb_build_object( 'result', false, 'message', 'Já existe um dominio com o mesmo valor para este grupo!' ); end if; if !exists( select * from libdom.entryset e where e.name = set.name and e.editable ) then return jsonb_build_object( 'result', false, 'message', 'Não existe uma entrada editavel com este nome!' ); end if; update libdom.entryset set ( value, label, domain ) = ( value, label, domain ) where name = name returning * into _entryset ; return jsonb_build_object( 'result', true, 'data', jsonb_build_object( 'entryset', _entryset ) ); end; $$; -- -- TOC entry 294 (class 1255 OID 295075) -- Name: sync_drop(name, regtype); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.sync_drop(name name, classtype regtype) RETURNS SETOF text LANGUAGE plpgsql AS $$ declare command text; begin command := format( 'alter type %s drop attribute if exists %I', classtype, name ); execute command; end; $$; -- -- TOC entry 328 (class 1255 OID 295076) -- Name: sync_entry(name, regtype); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.sync_entry(name name, classtype regtype) RETURNS SETOF text LANGUAGE plpgsql AS $$ declare /** Syncronizar uma entry em na calsse expecificada */ command text; _entry libdom.entryset; _type regtype default 'text'::regtype; begin select * into _entry from libdom.entryset e where e.name = sync_entry.name; if classtype = 'libdom.constant'::regtype then _type := _entry.type; end if; -- Destruir a constante casao existir command := format( 'alter type %s drop attribute if exists %I;', classtype, name ); execute command; return next command; -- Recriar a constante novamente command := format( 'alter type %s add attribute %I %s;', classtype, name, _type ); execute command; return next command; if _entry.comment is not null then command := format( 'comment on column %s.%I is %L;', classtype, name, _entry.comment ); execute command; return next command; end if; end; $$; -- -- TOC entry 329 (class 1255 OID 295734) -- Name: trigger_sync_domsync(); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.trigger_sync_domsync() RETURNS trigger LANGUAGE plpgsql AS $$ declare _new libdom.domsync; _old libdom.domsync; begin if tg_op in ( 'UPDATE', 'INSERT' ) then perform libdom.domsync( _new.classname, _new.columnname, _new.domain ); end if; end; $$; -- -- TOC entry 296 (class 1255 OID 295077) -- Name: trigger_sync_entry(); Type: FUNCTION; Schema: libdom; Owner: - -- CREATE FUNCTION libdom.trigger_sync_entry() RETURNS trigger LANGUAGE plpgsql AS $$ declare _new libdom.entryset; _old libdom.entryset; begin _new := new; _old := old; if tg_op = 'UPDATE' and _new.name != _old.name then perform libdom.sync_drop( _old.name, 'libdom.constant' ); perform libdom.sync_drop( _old.name, 'libdom.domain' ); end if; if tg_op in ( 'INSERT', 'UPDATE' ) and ( coalesce( _new.name::text, '' ) != coalesce( _old.name::text, '' ) or coalesce( _new.type::text, '' ) != coalesce( _old.type::text, '' ) or coalesce( _new.comment::text, '' ) != coalesce( _old.comment::text, '' ) ) then perform libdom.sync_entry( _new.name, 'libdom.constant' ); perform libdom.sync_entry( _new.name, 'libdom.domain' ); perform libdom.domsync( null, null, _new.domain ); end if; if tg_op in ( 'DELETE' ) then perform libdom.sync_drop( _old.name, 'libdom.constant' ); perform libdom.sync_drop( _old.name, 'libdom.domain' ); return null; end if; if tg_op in ( 'INSERT', 'UPDATE' ) then return _new; end if; end; $$; -- -- TOC entry 227 (class 1259 OID 295708) -- Name: domsync; Type: TABLE; Schema: libdom; Owner: - -- CREATE TABLE libdom.domsync ( classname character varying NOT NULL, columnname character varying NOT NULL, domain character varying NOT NULL, comment text, CONSTRAINT domsync_classname_check CHECK (((classname)::regclass IS NOT NULL)) ); -- -- TOC entry 2998 (class 2606 OID 295716) -- Name: domsync domsync_pkey; Type: CONSTRAINT; Schema: libdom; Owner: - -- ALTER TABLE ONLY libdom.domsync ADD CONSTRAINT domsync_pkey PRIMARY KEY (classname, columnname); -- -- TOC entry 2996 (class 2606 OID 295079) -- Name: entryset pk_name; Type: CONSTRAINT; Schema: libdom; Owner: - -- ALTER TABLE ONLY libdom.entryset ADD CONSTRAINT pk_name PRIMARY KEY (name); -- -- TOC entry 2999 (class 2620 OID 295080) -- Name: entryset sync_trigger; Type: TRIGGER; Schema: libdom; Owner: - -- CREATE TRIGGER sync_trigger AFTER INSERT OR DELETE OR UPDATE ON libdom.entryset FOR EACH ROW EXECUTE FUNCTION libdom.trigger_sync_entry(); -- -- TOC entry 3000 (class 2620 OID 295735) -- Name: domsync trigger_sync_domsync; Type: TRIGGER; Schema: libdom; Owner: - -- CREATE TRIGGER trigger_sync_domsync AFTER INSERT OR UPDATE ON libdom.domsync FOR EACH ROW EXECUTE FUNCTION libdom.trigger_sync_domsync(); -- Completed on 2023-01-05 19:41:10 -- -- PostgreSQL database dump complete --
b06f2fd5-c38c-4151-ad07-fd51e2cac5ca	\n\ndrop function if exists libdom.describe(prefix character varying[]);\n\ncreate or replace function libdom.describe(VARIADIC prefix character varying[] DEFAULT NULL::character varying[])\n  returns TABLE(\n    declaration text,\n    name name,\n    type regtype,\n    value text,\n    domain character varying,\n    label character varying,\n    editable boolean,\n    comment character varying,\n    "default" character varying\n  ) immutable\n  language sql\nas\n$$\n-- Devolver o mapeamento dos estados\n  select\n      format( '%I %s default %L::%s;', cv.name, cv.type, cv.value, cv.type ),\n      cv.*,\n      format( 'libdom.get(%L::name)::%s', cv.name, cv.type )\n    from libdom.prefix(  variadic prefix ) cv\n$$;\n	drop function if exists libdom.describe(prefix character varying[]); create or replace function libdom.describe(VARIADIC prefix character varying[] DEFAULT NULL::character varying[]) returns TABLE( declaration text, name name, type regtype, value text, domain character varying, label character varying, editable boolean, comment character varying, "default" character varying ) immutable language sql as $$ -- Devolver o mapeamento dos estados select format( '%I %s default %L::%s;', cv.name, cv.type, cv.value, cv.type ), cv.*, format( 'libdom.get(%L::name)::%s', cv.name, cv.type ) from libdom.prefix( variadic prefix ) cv $$;
692c4e56-e011-4c69-aa4d-72622e211d5b	\ncreate or replace function libdom.trigger_sync_domsync() returns trigger\n  language plpgsql\nas\n$$\ndeclare\n  _new libdom.domsync;\n  _old libdom.domsync;\nbegin\n  if tg_op in ( 'UPDATE', 'INSERT' ) then\n    perform libdom.domsync( _new.classname, _new.columnname, _new.domain );\n  end if;\n  return null;\nend;\n$$;\n	create or replace function libdom.trigger_sync_domsync() returns trigger language plpgsql as $$ declare _new libdom.domsync; _old libdom.domsync; begin if tg_op in ( 'UPDATE', 'INSERT' ) then perform libdom.domsync( _new.classname, _new.columnname, _new.domain ); end if; return null; end; $$;
e3ba5a7f-047f-479d-8c8a-cb32bf22a9cb	\n    alter table cluster.share add if not exists share_pksfrom character varying default null;\n    \n\ncreate or replace function cluster.__format(regclass) returns character varying\n  stable\n  strict\n  language sql\nas\n$$\n  with __source as (\n    select schemaname, tablename\n      from pg_tables \n    union all \n      select schemaname, viewname\n        from pg_views\n  )\n    select format( '%I.%I', schemaname, tablename )\n      from __source\n      where format( '%s.%s', schemaname, tablename )::regclass = $1\n$$;\n\n\ncreate or replace function cluster.__tg_share_check() returns trigger\n  language plpgsql\nas\n$$\ndeclare\nbegin\n  if( to_regclass( new.share_regclass ) is null ) then\n    raise exception '% is not a table', new.share_regclass;\n  end if;\n  new.share_regclass := cluster.__format( new.share_regclass );\n  new.share_pksfrom := cluster.__format( new.share_pksfrom );\n  new.share_pks := lib.sets_pks_array( coalesce( new.share_pksfrom, new.share_regclass ) );\n  return new;\nend;\n$$;\n\nINSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('cluster.branch', true, true);\ndelete from cluster.share where share_regclass::regclass = 'tweeks.branch'::regclass;\nINSERT INTO cluster.share (share_regclass, share_insert, share_update, share_pksfrom) values ( 'tweeks.branch', true, true, 'cluster.branch' );\n	alter table cluster.share add if not exists share_pksfrom character varying default null; create or replace function cluster.__format(regclass) returns character varying stable strict language sql as $$ with __source as ( select schemaname, tablename from pg_tables union all select schemaname, viewname from pg_views ) select format( '%I.%I', schemaname, tablename ) from __source where format( '%s.%s', schemaname, tablename )::regclass = $1 $$; create or replace function cluster.__tg_share_check() returns trigger language plpgsql as $$ declare begin if( to_regclass( new.share_regclass ) is null ) then raise exception '% is not a table', new.share_regclass; end if; new.share_regclass := cluster.__format( new.share_regclass ); new.share_pksfrom := cluster.__format( new.share_pksfrom ); new.share_pks := lib.sets_pks_array( coalesce( new.share_pksfrom, new.share_regclass ) ); return new; end; $$; INSERT INTO cluster.share (share_regclass, share_insert, share_update) VALUES ('cluster.branch', true, true); delete from cluster.share where share_regclass::regclass = 'tweeks.branch'::regclass; INSERT INTO cluster.share (share_regclass, share_insert, share_update, share_pksfrom) values ( 'tweeks.branch', true, true, 'cluster.branch' );
916bb74a-165f-41f3-8978-57e82bf3b834	\ndo $$\ndeclare \nbegin\n    perform map.constant('maguita_tserie_notacredito', 'int2', 4 );\n  insert into tweeks.tserie( \n    tserie_id, \n    tserie_desc, \n    tserie_code\n   ) values (\n    4,\n    'Nota de credito',\n    'NC'\n  );\nend;\n$$;\n	do $$ declare begin perform map.constant('maguita_tserie_notacredito', 'int2', 4 ); insert into tweeks.tserie( tserie_id, tserie_desc, tserie_code ) values ( 4, 'Nota de credito', 'NC' ); end; $$;
94b247a9-9743-4865-ba19-9661b1761808	\nselect map.constant( 'maguita_autorizacao_estado_ativo', 'int2', 1 );\nselect map.constant( 'maguita_autorizacao_estado_fechado', 'int2', 0 );\n\ncreate table if not exists tweeks.autorizacao(\n  autorizacao_uid uuid not null default gen_random_uuid(),\n  autorizacao_colaborador_uid uuid not null,\n  autorizacao_colaborador_atualizacao uuid,\n  autorizacao_espaco_auth uuid not null,\n  autorizacao_espaco_uid uuid not null,\n  autorizacao_designacao character varying not null,\n  autorizacao_ano integer not null,\n  autorizacao_numero character varying,\n  autorizacao_estado int2 not null default map.get('maguita_autorizacao_estado_ativo')::int2,\n  autorizacao_dataregistro timestamp not null default now(),\n  autorizacao_dataatualizacao timestamp default null,\n  _branch_uid uuid not null,\n  constraint pk_autorizacao_uid primary key ( autorizacao_uid ),\n  constraint fk_autorizacao_to_espaco foreign key ( autorizacao_espaco_uid )\n    references tweeks.espaco\n);\n\nalter table tweeks.serie add if not exists serie_autorizacao_uid uuid default null;\nalter table tweeks.serie drop constraint if exists fk_serie_to_autorizacao;\nalter table tweeks.serie add constraint fk_serie_to_autorizacao\n  foreign key ( serie_autorizacao_uid )\n  references tweeks.autorizacao\n;\n	select map.constant( 'maguita_autorizacao_estado_ativo', 'int2', 1 ); select map.constant( 'maguita_autorizacao_estado_fechado', 'int2', 0 ); create table if not exists tweeks.autorizacao( autorizacao_uid uuid not null default gen_random_uuid(), autorizacao_colaborador_uid uuid not null, autorizacao_colaborador_atualizacao uuid, autorizacao_espaco_auth uuid not null, autorizacao_espaco_uid uuid not null, autorizacao_designacao character varying not null, autorizacao_ano integer not null, autorizacao_numero character varying, autorizacao_estado int2 not null default map.get('maguita_autorizacao_estado_ativo')::int2, autorizacao_dataregistro timestamp not null default now(), autorizacao_dataatualizacao timestamp default null, _branch_uid uuid not null, constraint pk_autorizacao_uid primary key ( autorizacao_uid ), constraint fk_autorizacao_to_espaco foreign key ( autorizacao_espaco_uid ) references tweeks.espaco ); alter table tweeks.serie add if not exists serie_autorizacao_uid uuid default null; alter table tweeks.serie drop constraint if exists fk_serie_to_autorizacao; alter table tweeks.serie add constraint fk_serie_to_autorizacao foreign key ( serie_autorizacao_uid ) references tweeks.autorizacao ;
e31f2493-941a-4e47-b834-e50eaf702f23	\ndrop view if exists report.vreport_fluxo;\n\ncreate or replace view report.vreport_fluxo as\n  select\n      top.toperacao_designacao as "OPERAÇÃO",\n      case\n        when ain.artigo_id is null then aou.artigo_nome\n        when aou.artigo_id is null then ain.artigo_nome\n        when ain.artigo_id = aou.artigo_id then ain.artigo_nome\n        else format( '%s ==> %s', aou.artigo_nome, ain.artigo_nome)\n      end as "ARTIGO",\n\n      case\n        when ein.espaco_id is null then eou.espaco_nome\n        when eou.espaco_id is null then ein.espaco_nome\n        when ein.espaco_id = eou.espaco_id then ein.espaco_nome\n        else format( '%s ==> %s', eou.espaco_nome, ein.espaco_nome )\n      end as "ARMAZÉM",\n\n      case\n        when ain.artigo_id is null then f.fluxo_quantidadeout::text\n        when aou.artigo_id is null then f.fluxo_quantidadein::text\n        when ain.artigo_id = aou.artigo_id then f.fluxo_quantidadein::text\n        else format( '%s ==> %s', f.fluxo_quantidadeout, f.fluxo_quantidadein )\n      end as "QT",\n    \n      f.fluxo_documento as "DOCUMENTO",\n      coalesce( f.fluxo_data, f.fluxo_dataregistro::date ) as "DATA",\n      c.colaborador_nome as "COLABORADOR",\n      fluxo_sequencia as "SEQUENCIA",\n\n      ain.artigo_nome as "ART. ENTRADA",\n      aou.artigo_nome as "ART. SAÍDA",\n      eou.espaco_nome as "ARM. ORIGEM",\n      ein.espaco_nome as "ARM. DESTINO",\n      coalesce( f.fluxo_quantidadein, 0 ) as "QT+",\n      coalesce( f.fluxo_quantidadeout, 0 ) as "QT-",\n      f.fluxo_dataregistro as "REGISTO",\n      f.fluxo_observacao as "OBSERVAÇÃO",\n      case\n        when ain.artigo_id is null then array[ aou.artigo_id ]::uuid[]\n        when aou.artigo_id is null then array[ ain.artigo_id ]::uuid[]\n        when ain.artigo_id = aou.artigo_id then array [ ain.artigo_id ]::uuid[]\n        else array [ ain.artigo_id, aou.artigo_id ]::uuid[]\n      end __artigo_id,\n\n      case\n        when ein.espaco_id is null then array[ eou.espaco_id ]::uuid[]\n        when eou.espaco_id is null then array[ ein.espaco_id ]::uuid[]\n        when ein.espaco_id = eou.espaco_id then array [ ein.espaco_id ]::uuid[]\n        else array [ ein.espaco_id, eou.espaco_id ]::uuid[]\n      end __espaco_id,\n\n      case\n        when clain.classe_id is null then array[ claout.classe_id ]::uuid[]\n        when claout.classe_id is null then array[ clain.classe_id ]::uuid[]\n        when clain.classe_id = claout.classe_id then array [ clain.classe_id ]::uuid[]\n        else array [ clain.classe_id, claout.classe_id ]::uuid[]\n      end __classe_id,\n\n      f.fluxo_referencia,\n      f.fluxo_id,\n      top.toperacao_id,\n      ain.artigo_id as __artigo_in,\n      aou.artigo_id as __artigo_out,\n      ein.espaco_id as __espaco_in,\n      eou.espaco_id as __espaco_out,\n      clain.classe_id as __classe_in,\n      claout.classe_id as __classe_out,\n      c.colaborador_id,\n      f._branch_uid\n    from tweeks.fluxo f\n      inner join tweeks.toperacao top on f.fluxo_toperacao_id = top.toperacao_id\n      left join tweeks.artigo ain on f.fluxo_artigo_in = ain.artigo_id\n      left join tweeks.classe clain on ain.artigo_classe_id = clain.classe_id\n      left join tweeks.artigo aou on f.fluxo_artigo_out = aou.artigo_id\n      left join tweeks.classe claout on aou.artigo_classe_id = claout.classe_id\n      left join tweeks.espaco ein on f.fluxo_espaco_in = ein.espaco_id\n      left join tweeks.espaco eou on f.fluxo_espaco_out = eou.espaco_id\n      left join auth.colaborador c on f.fluxo_colaborador_id = c.colaborador_id\n  ;\n\nselect * from report.sync('report.vreport_fluxo', 'RELATÓRIO DE FLUXO', 1300 );\n\nUPDATE report.vcolumn SET position = 4000, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'bigint' WHERE source = 'report.vreport_fluxo' AND name = 'SEQUENCIA';\nUPDATE report.vcolumn SET position = 3000, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'OPERAÇÃO';\nUPDATE report.vcolumn SET position = 1117, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'ARM. ORIGEM';\nUPDATE report.vcolumn SET position = 1116, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'ARM. DESTINO';\nUPDATE report.vcolumn SET position = 1115, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_fluxo' AND name = 'ARMAZÉM';\nUPDATE report.vcolumn SET position = 997, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'ART. SAÍDA';\nUPDATE report.vcolumn SET position = 996, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'ART. ENTRADA';\nUPDATE report.vcolumn SET position = 995, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_fluxo' AND name = 'ARTIGO';\nUPDATE report.vcolumn SET position = 985, show = true, init = true, format = 'code:long', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'DOCUMENTO';\nUPDATE report.vcolumn SET position = 977, show = true, init = true, format = 'int', filter = '[["query.range|start", {"name": "QT- MÍNIMA"}], ["query.range|end", {"name": "QT- MÁXIMA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_fluxo' AND name = 'QT-';\nUPDATE report.vcolumn SET position = 976, show = true, init = true, format = 'int', filter = '[["query.range|start", {"name": "QT+ MÍNIMA"}], ["query.range|end", {"name": "QT+ MÁXIMA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_fluxo' AND name = 'QT+';\nUPDATE report.vcolumn SET position = 975, show = true, init = true, format = 'code:right', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_fluxo' AND name = 'QT';\nUPDATE report.vcolumn SET position = 195, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'COLABORADOR';\nUPDATE report.vcolumn SET position = 186, show = true, init = false, format = 'date', filter = '["query.date|start", "query.date|end"]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_fluxo' AND name = 'DATA';\nUPDATE report.vcolumn SET position = 185, show = true, init = true, format = 'timestamp', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_fluxo' AND name = 'REGISTO';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'text', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'OBSERVAÇÃO';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE FLUXOS", "rename": "??COUNT::DISTINCT TOTAL DE FLUXOS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = 'fluxo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.artigo", {"name": "ARTIGO"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid[]' WHERE source = 'report.vreport_fluxo' AND name = '__artigo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.artigo", {"name": "ARTIGO ENTRADA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = '__artigo_in';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.artigo", {"name": "ARTIGO SAÍDA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = '__artigo_out';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid[]' WHERE source = 'report.vreport_fluxo' AND name = '__classe_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA DA ENTRADA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = '__classe_in';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA DA SAÍDA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = '__classe_out';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.espaco", {"name": "ARMAZÉM"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid[]' WHERE source = 'report.vreport_fluxo' AND name = '__espaco_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.espaco", {"name": "ARMAZÉM ENTRADA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = '__espaco_in';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.espaco", {"name": "ARMAZÉM SAÍDA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = '__espaco_out';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|auth.colaborador", {"name": "COLABORADOR"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = 'colaborador_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|tweeks.toperacao"]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_fluxo' AND name = 'toperacao_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = '_branch_uid';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'jsonb' WHERE source = 'report.vreport_fluxo' AND name = 'fluxo_referencia';\n\n\nselect * from report.vcolumn\nwhere source = 'report.vreport_fluxo'\norder by position desc nulls last,\n  show desc nulls last,\n  init desc nulls last,\n  jsonb_array_length( agg ) desc,\n  jsonb_array_length( filter ) desc,\n  source, name;\n	drop view if exists report.vreport_fluxo; create or replace view report.vreport_fluxo as select top.toperacao_designacao as "OPERAÇÃO", case when ain.artigo_id is null then aou.artigo_nome when aou.artigo_id is null then ain.artigo_nome when ain.artigo_id = aou.artigo_id then ain.artigo_nome else format( '%s ==> %s', aou.artigo_nome, ain.artigo_nome) end as "ARTIGO", case when ein.espaco_id is null then eou.espaco_nome when eou.espaco_id is null then ein.espaco_nome when ein.espaco_id = eou.espaco_id then ein.espaco_nome else format( '%s ==> %s', eou.espaco_nome, ein.espaco_nome ) end as "ARMAZÉM", case when ain.artigo_id is null then f.fluxo_quantidadeout::text when aou.artigo_id is null then f.fluxo_quantidadein::text when ain.artigo_id = aou.artigo_id then f.fluxo_quantidadein::text else format( '%s ==> %s', f.fluxo_quantidadeout, f.fluxo_quantidadein ) end as "QT", f.fluxo_documento as "DOCUMENTO", coalesce( f.fluxo_data, f.fluxo_dataregistro::date ) as "DATA", c.colaborador_nome as "COLABORADOR", fluxo_sequencia as "SEQUENCIA", ain.artigo_nome as "ART. ENTRADA", aou.artigo_nome as "ART. SAÍDA", eou.espaco_nome as "ARM. ORIGEM", ein.espaco_nome as "ARM. DESTINO", coalesce( f.fluxo_quantidadein, 0 ) as "QT+", coalesce( f.fluxo_quantidadeout, 0 ) as "QT-", f.fluxo_dataregistro as "REGISTO", f.fluxo_observacao as "OBSERVAÇÃO", case when ain.artigo_id is null then array[ aou.artigo_id ]::uuid[] when aou.artigo_id is null then array[ ain.artigo_id ]::uuid[] when ain.artigo_id = aou.artigo_id then array [ ain.artigo_id ]::uuid[] else array [ ain.artigo_id, aou.artigo_id ]::uuid[] end __artigo_id, case when ein.espaco_id is null then array[ eou.espaco_id ]::uuid[] when eou.espaco_id is null then array[ ein.espaco_id ]::uuid[] when ein.espaco_id = eou.espaco_id then array [ ein.espaco_id ]::uuid[] else array [ ein.espaco_id, eou.espaco_id ]::uuid[] end __espaco_id, case when clain.classe_id is null then array[ claout.classe_id ]::uuid[] when claout.classe_id is null then array[ clain.classe_id ]::uuid[] when clain.classe_id = claout.classe_id then array [ clain.classe_id ]::uuid[] else array [ clain.classe_id, claout.classe_id ]::uuid[] end __classe_id, f.fluxo_referencia, f.fluxo_id, top.toperacao_id, ain.artigo_id as __artigo_in, aou.artigo_id as __artigo_out, ein.espaco_id as __espaco_in, eou.espaco_id as __espaco_out, clain.classe_id as __classe_in, claout.classe_id as __classe_out, c.colaborador_id, f._branch_uid from tweeks.fluxo f inner join tweeks.toperacao top on f.fluxo_toperacao_id = top.toperacao_id left join tweeks.artigo ain on f.fluxo_artigo_in = ain.artigo_id left join tweeks.classe clain on ain.artigo_classe_id = clain.classe_id left join tweeks.artigo aou on f.fluxo_artigo_out = aou.artigo_id left join tweeks.classe claout on aou.artigo_classe_id = claout.classe_id left join tweeks.espaco ein on f.fluxo_espaco_in = ein.espaco_id left join tweeks.espaco eou on f.fluxo_espaco_out = eou.espaco_id left join auth.colaborador c on f.fluxo_colaborador_id = c.colaborador_id ; select * from report.sync('report.vreport_fluxo', 'RELATÓRIO DE FLUXO', 1300 ); UPDATE report.vcolumn SET position = 4000, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'bigint' WHERE source = 'report.vreport_fluxo' AND name = 'SEQUENCIA'; UPDATE report.vcolumn SET position = 3000, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'OPERAÇÃO'; UPDATE report.vcolumn SET position = 1117, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'ARM. ORIGEM'; UPDATE report.vcolumn SET position = 1116, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'ARM. DESTINO'; UPDATE report.vcolumn SET position = 1115, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_fluxo' AND name = 'ARMAZÉM'; UPDATE report.vcolumn SET position = 997, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'ART. SAÍDA'; UPDATE report.vcolumn SET position = 996, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'ART. ENTRADA'; UPDATE report.vcolumn SET position = 995, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_fluxo' AND name = 'ARTIGO'; UPDATE report.vcolumn SET position = 985, show = true, init = true, format = 'code:long', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'DOCUMENTO'; UPDATE report.vcolumn SET position = 977, show = true, init = true, format = 'int', filter = '[["query.range|start", {"name": "QT- MÍNIMA"}], ["query.range|end", {"name": "QT- MÁXIMA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_fluxo' AND name = 'QT-'; UPDATE report.vcolumn SET position = 976, show = true, init = true, format = 'int', filter = '[["query.range|start", {"name": "QT+ MÍNIMA"}], ["query.range|end", {"name": "QT+ MÁXIMA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_fluxo' AND name = 'QT+'; UPDATE report.vcolumn SET position = 975, show = true, init = true, format = 'code:right', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_fluxo' AND name = 'QT'; UPDATE report.vcolumn SET position = 195, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'COLABORADOR'; UPDATE report.vcolumn SET position = 186, show = true, init = false, format = 'date', filter = '["query.date|start", "query.date|end"]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_fluxo' AND name = 'DATA'; UPDATE report.vcolumn SET position = 185, show = true, init = true, format = 'timestamp', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_fluxo' AND name = 'REGISTO'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'text', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_fluxo' AND name = 'OBSERVAÇÃO'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE FLUXOS", "rename": "??COUNT::DISTINCT TOTAL DE FLUXOS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = 'fluxo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.artigo", {"name": "ARTIGO"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid[]' WHERE source = 'report.vreport_fluxo' AND name = '__artigo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.artigo", {"name": "ARTIGO ENTRADA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = '__artigo_in'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.artigo", {"name": "ARTIGO SAÍDA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = '__artigo_out'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid[]' WHERE source = 'report.vreport_fluxo' AND name = '__classe_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA DA ENTRADA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = '__classe_in'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA DA SAÍDA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = '__classe_out'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.espaco", {"name": "ARMAZÉM"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid[]' WHERE source = 'report.vreport_fluxo' AND name = '__espaco_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.espaco", {"name": "ARMAZÉM ENTRADA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = '__espaco_in'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.espaco", {"name": "ARMAZÉM SAÍDA"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = '__espaco_out'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|auth.colaborador", {"name": "COLABORADOR"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = 'colaborador_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|tweeks.toperacao"]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_fluxo' AND name = 'toperacao_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_fluxo' AND name = '_branch_uid'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'jsonb' WHERE source = 'report.vreport_fluxo' AND name = 'fluxo_referencia'; select * from report.vcolumn where source = 'report.vreport_fluxo' order by position desc nulls last, show desc nulls last, init desc nulls last, jsonb_array_length( agg ) desc, jsonb_array_length( filter ) desc, source, name;
7bc78ad5-51ac-4ace-8e72-12c2a31821a7	\ncreate or replace function tweeks.funct_sets_autorizacao(args jsonb) returns lib.res\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    {\n      arg_colaborador_id: UID\n      arg_espaco_auth: UID\n      arg_autorizacao_continue: AUTORIZACAO\n\n      autorizacao_uid: UID\n      autorizacao_espaco_uid: UID\n      autorizacao_designacao:DESIG\n      autorizacao_numero:NUMERO,\n      series: [\n        {\n          serie_id uuid not null,\n          serie_tserie_id int2 not null,\n          serie_espaco_id uuid not null,\n          serie_designacao character varying not null,\n          serie_numero character varying not null,\n          serie_quantidade int not null,\n          serie_numcertificacao,\n          serie_numatorizacao\n        }\n      ]\n    }\n   */\n  _autorizacao tweeks.autorizacao;\n  _autorizacao_continue tweeks.autorizacao;\n  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n  arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  _res_serie jsonb default jsonb_build_array();\n  _next record;\n  _data record;\n\nbegin\n  _autorizacao := jsonb_populate_record( _autorizacao, args );\n  _autorizacao_continue := jsonb_populate_record( _autorizacao_continue, args->'_autorizacao_continue' );\n  \n  if _autorizacao.autorizacao_uid is null then\n    _autorizacao.autorizacao_colaborador_uid := arg_colaborador_id;\n    _autorizacao.autorizacao_espaco_auth := arg_espaco_auth;\n    _autorizacao._branch_uid := arg_branch_uid;\n    _autorizacao.autorizacao_dataregistro := now();\n    _autorizacao.autorizacao_ano := extract( years from now() );\n  else\n    _autorizacao.autorizacao_colaborador_atualizacao := arg_colaborador_id;\n    _autorizacao.autorizacao_dataatualizacao := now();\n  end if;\n  \n  if _autorizacao_continue.autorizacao_uid is null and exists(\n    select *\n      from jsonb_array_elements( args->'series' ) e ( doc )\n        inner join jsonb_populate_record( null::tweeks.serie, e.doc ) sdoc on true\n        inner join tweeks.serie s on sdoc.serie_numero = s.serie_numero\n          and s.serie_tserie_id = sdoc.serie_tserie_id\n          and s._branch_uid = arg_branch_uid\n          and s.serie_espaco_auth = arg_espaco_auth\n        inner join tweeks.autorizacao a on s.serie_autorizacao_uid = a.autorizacao_uid\n          and a._branch_uid = arg_branch_uid\n          and a.autorizacao_ano = _autorizacao.autorizacao_ano\n          and a.autorizacao_espaco_auth = arg_espaco_auth\n      where a.autorizacao_uid != _autorizacao_continue.autorizacao_uid\n  ) then\n    return lib.res_false( 'Já existe serie com essa numeração registrada' );\n  end if;\n  \n  select ( "returning" ).* into _autorizacao\n    from lib.sets( _autorizacao )\n  ;\n  \n  for _data in (\n    select\n        e.document || jsonb_build_object(\n          'arg_colaborador_id', arg_colaborador_id,\n          'arg_espaco_auth', arg_espaco_auth,\n          'serie_autorizacao_uid', _autorizacao.autorizacao_uid\n        ) as document_serie\n      from jsonb_array_elements( args->'series' ) e ( document )\n  ) loop\n    select * into _next\n      from tweeks.funct_sets_serie( _data.document_serie ) e;\n  \n    _res_serie := _res_serie || jsonb_build_object(\n      'serie', _data.document_serie,\n      'result', _next\n    );\n  end loop;\n  \n  return lib.res_true( jsonb_build_object(\n    'autorizacao', _autorizacao,\n    'series', _res_serie\n  ));\nend;\n$$;\n	create or replace function tweeks.funct_sets_autorizacao(args jsonb) returns lib.res language plpgsql as $$ declare /** { arg_colaborador_id: UID arg_espaco_auth: UID arg_autorizacao_continue: AUTORIZACAO autorizacao_uid: UID autorizacao_espaco_uid: UID autorizacao_designacao:DESIG autorizacao_numero:NUMERO, series: [ { serie_id uuid not null, serie_tserie_id int2 not null, serie_espaco_id uuid not null, serie_designacao character varying not null, serie_numero character varying not null, serie_quantidade int not null, serie_numcertificacao, serie_numatorizacao } ] } */ _autorizacao tweeks.autorizacao; _autorizacao_continue tweeks.autorizacao; arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _res_serie jsonb default jsonb_build_array(); _next record; _data record; begin _autorizacao := jsonb_populate_record( _autorizacao, args ); _autorizacao_continue := jsonb_populate_record( _autorizacao_continue, args->'_autorizacao_continue' ); if _autorizacao.autorizacao_uid is null then _autorizacao.autorizacao_colaborador_uid := arg_colaborador_id; _autorizacao.autorizacao_espaco_auth := arg_espaco_auth; _autorizacao._branch_uid := arg_branch_uid; _autorizacao.autorizacao_dataregistro := now(); _autorizacao.autorizacao_ano := extract( years from now() ); else _autorizacao.autorizacao_colaborador_atualizacao := arg_colaborador_id; _autorizacao.autorizacao_dataatualizacao := now(); end if; if _autorizacao_continue.autorizacao_uid is null and exists( select * from jsonb_array_elements( args->'series' ) e ( doc ) inner join jsonb_populate_record( null::tweeks.serie, e.doc ) sdoc on true inner join tweeks.serie s on sdoc.serie_numero = s.serie_numero and s.serie_tserie_id = sdoc.serie_tserie_id and s._branch_uid = arg_branch_uid and s.serie_espaco_auth = arg_espaco_auth inner join tweeks.autorizacao a on s.serie_autorizacao_uid = a.autorizacao_uid and a._branch_uid = arg_branch_uid and a.autorizacao_ano = _autorizacao.autorizacao_ano and a.autorizacao_espaco_auth = arg_espaco_auth where a.autorizacao_uid != _autorizacao_continue.autorizacao_uid ) then return lib.res_false( 'Já existe serie com essa numeração registrada' ); end if; select ( "returning" ).* into _autorizacao from lib.sets( _autorizacao ) ; for _data in ( select e.document || jsonb_build_object( 'arg_colaborador_id', arg_colaborador_id, 'arg_espaco_auth', arg_espaco_auth, 'serie_autorizacao_uid', _autorizacao.autorizacao_uid ) as document_serie from jsonb_array_elements( args->'series' ) e ( document ) ) loop select * into _next from tweeks.funct_sets_serie( _data.document_serie ) e; _res_serie := _res_serie || jsonb_build_object( 'serie', _data.document_serie, 'result', _next ); end loop; return lib.res_true( jsonb_build_object( 'autorizacao', _autorizacao, 'series', _res_serie )); end; $$;
8ed8d91a-0011-4d74-94a3-48fba021106c	\ncreate or replace function tweeks.__get_autorizacao( uuid )\n  returns tweeks.autorizacao\n  immutable\n  strict\n  language sql as $$\n    select * from tweeks.autorizacao where autorizacao_uid = $1;\n$$;\n\n\ncreate or replace function tweeks.funct_change_autorizacao_closeyear(\n  args jsonb\n) returns lib.res\nlanguage plpgsql as $$\ndeclare\n  /**\n    {\n      arg_colaborador_id: UID\n      arg_espaco_auth: UID\n      autorizacao_uid: UID\n    }\n   */\n  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n  arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  _autorizacao tweeks.autorizacao;\n  _const map.constant;\nbegin\n  _const := map.constant();\n  _autorizacao := jsonb_populate_record( _autorizacao, args );\n  _autorizacao := tweeks.__get_autorizacao( _autorizacao.autorizacao_uid );\n\n  if _autorizacao.autorizacao_estado != _const.maguita_autorizacao_estado_ativo then\n    return lib.res_false( 'A autorizacao selecionada para fecho já esta encerada!' );\n  end if;\n\n  update tweeks.autorizacao\n    set autorizacao_colaborador_atualizacao = arg_colaborador_id,\n        autorizacao_dataatualizacao = now(),\n        autorizacao_estado = _const.autenticacao_estado_fechado\n    where autorizacao_uid = _autorizacao.autorizacao_uid\n    returning * into _autorizacao\n  ;\n\n  update tweeks.serie\n    set serie_dataatualizacao = now(),\n        serie_colaborador_atualizacao = arg_colaborador_id,\n        serie_estado = _const.maguita_serie_estado_fechado,\n        serie_fechoautorizacao = true\n    where serie_estado = _const.maguita_serie_estado_ativo\n      and serie_autorizacao_uid = _autorizacao.autorizacao_uid\n  ;\n\n  return lib.res_true( jsonb_build_object(\n    'autorizacao', _autorizacao\n  ));\nend;\n$$;\n	create or replace function tweeks.__get_autorizacao( uuid ) returns tweeks.autorizacao immutable strict language sql as $$ select * from tweeks.autorizacao where autorizacao_uid = $1; $$; create or replace function tweeks.funct_change_autorizacao_closeyear( args jsonb ) returns lib.res language plpgsql as $$ declare /** { arg_colaborador_id: UID arg_espaco_auth: UID autorizacao_uid: UID } */ arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _autorizacao tweeks.autorizacao; _const map.constant; begin _const := map.constant(); _autorizacao := jsonb_populate_record( _autorizacao, args ); _autorizacao := tweeks.__get_autorizacao( _autorizacao.autorizacao_uid ); if _autorizacao.autorizacao_estado != _const.maguita_autorizacao_estado_ativo then return lib.res_false( 'A autorizacao selecionada para fecho já esta encerada!' ); end if; update tweeks.autorizacao set autorizacao_colaborador_atualizacao = arg_colaborador_id, autorizacao_dataatualizacao = now(), autorizacao_estado = _const.autenticacao_estado_fechado where autorizacao_uid = _autorizacao.autorizacao_uid returning * into _autorizacao ; update tweeks.serie set serie_dataatualizacao = now(), serie_colaborador_atualizacao = arg_colaborador_id, serie_estado = _const.maguita_serie_estado_fechado, serie_fechoautorizacao = true where serie_estado = _const.maguita_serie_estado_ativo and serie_autorizacao_uid = _autorizacao.autorizacao_uid ; return lib.res_true( jsonb_build_object( 'autorizacao', _autorizacao )); end; $$;
edb90c7e-2f62-4566-8d2e-b675700d9b6c	\ncreate or replace function tweeks.funct_load_autorizacao( args jsonb )\nreturns setof jsonb\nlanguage plpgsql as $$\ndeclare\n  /**\n  {\n    arg_colaborador_id: UID\n    arg_espaco_auth: UID\n  }\n */\n  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n  arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  _espaco_child uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth );\n\n  _const map.constant;\n\nbegin\n  _const := map.constant();\n  return query\n    with __autorizacao as (\n      select\n          a.autorizacao_uid,\n          a.autorizacao_numero,\n          a.autorizacao_ano,\n          a.autorizacao_estado,\n          a.autorizacao_designacao,\n          a.autorizacao_dataregistro,\n          e.espaco_id,\n          e.espaco_nome,\n          count( at.* ) filter ( where at.autorizacao_ano > a.autorizacao_ano ) as autorizacao_postone,\n          count( at.* ) filter ( where at.autorizacao_ano < a.autorizacao_ano ) as autorizacao_previews\n        from tweeks.autorizacao a\n          inner join tweeks.espaco e on a.autorizacao_espaco_uid = e.espaco_id\n          left join tweeks.autorizacao at on at.autorizacao_espaco_uid = a.autorizacao_espaco_uid\n            and at._branch_uid = a._branch_uid\n            and at.autorizacao_ano != a.autorizacao_ano\n        where a._branch_uid = arg_branch_uid\n          and true in (\n            a.autorizacao_espaco_auth = any( _espaco_child ),\n            a.autorizacao_espaco_uid = any( _espaco_child )\n          )\n        group by\n          a.autorizacao_uid,\n          e.espaco_id\n    ), __continue as (\n       select\n            at.*,\n            case\n              when at.autorizacao_estado = _const.maguita_autorizacao_estado_fechado and at.autorizacao_postone = 0 then true\n              else false\n            end as autorizacao_continue\n          from __autorizacao at\n    ) select to_jsonb( _a )\n        from __continue _a\n        order by _a.autorizacao_ano desc,\n          _a.autorizacao_dataregistro desc\n  ;\nend;\n$$;\n\n\ncreate or replace function tweeks.funct_load_serie(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    arg_espaco_auth\n    arg_colaborador_id\n    arg_autorizacao_id\n   */\n  _const map.constant;\n  arg_espaco_auth uuid default args->>'arg_espaco_auth';\n  arg_autorizacao_id uuid default args->>'arg_autorizacao_id';\n  arg_colaborador_id uuid default args->>'arg_colaborador_id';\n  ___branch_uid uuid;\n  _espaco_child uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth );\nbegin\n  _const := map.constant();\n  ___branch_uid := tweeks.__branch_uid( null, arg_espaco_auth );\n  return query\n    with\n      __serie as (\n        select _vs.*,\n            e.espaco_id,\n            e.espaco_nome\n          from tweeks.serie _vs\n            inner join tweeks.espaco e on _vs.serie_espaco_id = e.espaco_id\n          where _vs._branch_uid = ___branch_uid\n            and coalesce( _vs.serie_autorizacao_uid ) = coalesce( arg_autorizacao_id, _vs.serie_autorizacao_uid )\n            and true in (\n              _vs.serie_espaco_auth = any( _espaco_child ),\n              _vs.serie_espaco_id = any( _espaco_child )\n            )\n      )\n    select to_jsonb( _s )\n      from __serie _s;\nend;\n$$;\n\ndrop function if exists tweeks.funct_load_autorizacao_continue(args jsonb);\n\ncreate or replace function funct_sets_autorizacao_continue(args jsonb) returns lib.res\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    {\n      arg_colaborador_id: UID\n      arg_espaco_auth: UID\n      autorizacao_uid: UID\n    }\n   */\n  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n  arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n\n  _autorizacao tweeks.autorizacao;\n  _const map.constant;\n  _data record;\nbegin\n  _autorizacao := tweeks.__get_autorizacao( ( args->>'autorizacao_uid' )::uuid );\n  _const := map.constant();\n  with __serie as (\n    select\n        serie_tserie_id,\n        serie_espaco_id,\n        serie_designacao,\n        serie_numero,\n        serie_quantidade,\n        serie_numcertificacao,\n        serie_numatorizacao,\n        case \n          when _autorizacao.autorizacao_ano = extract( years from current_date)::int then serie_sequencia\n          else 0\n        end serie_sequencia\n      from tweeks.serie se\n      where se.serie_autorizacao_uid = _autorizacao.autorizacao_uid\n        and se.serie_estado = _const.maguita_serie_estado_fechado\n        and se.serie_fechoautorizacao\n        and se._branch_uid = arg_branch_uid\n  ) select\n        jsonb_agg( to_jsonb( _s ) ) as series\n        into _data\n      from __serie _s;\n\n  return tweeks.funct_sets_autorizacao( jsonb_build_object(\n    'arg_colaborador_id', arg_colaborador_id,\n    'arg_espaco_auth', arg_espaco_auth,\n    '_autorizacao_continue', _autorizacao,\n    'autorizacao_uid', null,\n    'autorizacao_espaco_uid', _autorizacao.autorizacao_espaco_uid,\n    'autorizacao_designacao', _autorizacao.autorizacao_designacao,\n    'autorizacao_numero', _autorizacao.autorizacao_numero,\n    'series', _data.series\n  ));\nend;\n$$;\n\n\ndrop function if exists tweeks.__sets_generate_documento(arg_espaco_auth uuid, arg_tserie integer);\ncreate or replace function tweeks.__sets_generate_documento(arg_espaco_auth uuid, arg_tserie integer)\n  returns TABLE(\n    document character varying,\n     serie_id uuid,\n       serie_numero character varying,\n         serie_numatorizacao character varying,\n           serie_numcertificacao character varying,\n             serie_sequencia bigint,\n               serie_quantidade bigint,\n                 autorizacao_uid uuid,\n                   autorizacao_ano int,\n                     autorizacao_numero character varying\n        )\n  strict\n  language plpgsql\nas\n$$\ndeclare\n  _serie tweeks.serie;\n  _numero_documento varchar;\n  ___branch uuid default tweeks.__branch_uid( null, arg_espaco_auth );\n  _const map.constant;\n  _espaco tweeks.espaco;\n  _tserie tweeks.tserie;\n  _iterate int default 0;\n  _autorizacao tweeks.autorizacao;\nbegin\n    _const := map.constant();\n\n    select * into _tserie\n      from tweeks.tserie ts\n      where ts.tserie_id = arg_tserie\n    ;\n\n    -- Obter o espaço superior que pode gerar numero de seire\n    with recursive __espaco as (\n      select e.*, e.espaco_gerarfatura as __generate_serie\n      from tweeks.espaco e\n      where e.espaco_id =arg_espaco_auth\n      union all\n      select w.*, w.espaco_gerarfatura\n        from __espaco _e\n          inner join tweeks.espaco w on _e.espaco_espaco_id = w.espaco_id\n        and not _e.__generate_serie\n    ) select * into _espaco from __espaco __e\n      where __e.__generate_serie\n    ;\n\n    while _numero_documento is null loop\n      update tweeks.serie s\n        set serie_sequencia = s.serie_sequencia +1\n        from tweeks.autorizacao a\n        where s.serie_autorizacao_uid = a.autorizacao_uid\n          and s._branch_uid = ___branch\n          and a._branch_uid = ___branch\n          and s.serie_espaco_id = _espaco.espaco_id\n          and s.serie_tserie_id = arg_tserie\n          and s.serie_estado = _const.maguita_serie_estado_ativo\n          and a.autorizacao_estado = _const.maguita_autorizacao_estado_ativo\n          and a.autorizacao_ano = extract( years from now() )::int\n        returning * into _serie\n      ;\n\n      if _serie.serie_id is null then\n        raise exception 'Nenhuma serie disponivel para gerar a sequencia!';\n      end if;\n\n      if length( _serie.serie_sequencia::text ) > _tserie.tserie_seqlimit::int then\n        raise exception 'O numero de sequencia excede o tamanho maximo definido para e seire';\n      end if;\n\n      _autorizacao := tweeks.__get_autorizacao( _serie.serie_autorizacao_uid );\n\n      -- ex: FT0000119000001\n      -- TIPO|FIXA|ANO|SEQUENCIA\n      _numero_documento := format(\n        '%s%s%s%s',\n        _tserie.tserie_code, --TYPE\n        lpad( "left"( _serie.serie_numero, _tserie.tserie_numlimit-2), _tserie.tserie_numlimit-2, '0'), --FIXA\n        to_char( make_date( _autorizacao.autorizacao_ano, 1, 1 ), 'yy' ), --YEAR\n        lpad( _serie.serie_sequencia::text, _tserie.tserie_seqlimit::int,  '0' ) --SEQUENCE\n      );\n\n      if _tserie.tserie_id in ( _const.maguita_tserie_fatura, _const.maguita_tserie_faturarecibo )\n        and exists(\n          select *\n            from tweeks.conta c\n            where c.conta_numerofatura = _numero_documento\n              and c._branch_uid = ___branch\n      ) then\n        _numero_documento := null;\n      end if;\n\n      if _numero_documento is not null\n        and _tserie.tserie_id in ( _const.maguita_tserie_recibo, _const.maguita_tserie_faturarecibo )\n        and exists(\n          select *\n            from tweeks.deposito de\n            where de.deposito_documento = _numero_documento\n              and de._branch_uid = ___branch\n      ) then\n        _numero_documento := null;\n      end if;\n      _iterate := _iterate +1;\n\n      if _iterate = 1000 then\n        raise exception 'Exedeu o limite de tentativa para geração de numero de serie, por favor proucure pelo suporte.';\n      end if;\n    end loop;\n\n    __sets_generate_documento.document := _numero_documento;\n    __sets_generate_documento.serie_id := _serie.serie_id;\n    __sets_generate_documento.serie_sequencia := _serie.serie_sequencia;\n    __sets_generate_documento.serie_numero := _serie.serie_numero;\n    __sets_generate_documento.serie_quantidade := _serie.serie_quantidade;\n    __sets_generate_documento.serie_numatorizacao := _serie.serie_numatorizacao;\n    __sets_generate_documento.serie_numcertificacao := _serie.serie_numcertificacao;\n    __sets_generate_documento.autorizacao_uid := _autorizacao.autorizacao_uid;\n    __sets_generate_documento.autorizacao_ano := _autorizacao.autorizacao_ano;\n    __sets_generate_documento.autorizacao_numero := _autorizacao.autorizacao_numero;\n\n    return next;\nend;\n$$;\n	create or replace function tweeks.funct_load_autorizacao( args jsonb ) returns setof jsonb language plpgsql as $$ declare /** { arg_colaborador_id: UID arg_espaco_auth: UID } */ arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _espaco_child uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth ); _const map.constant; begin _const := map.constant(); return query with __autorizacao as ( select a.autorizacao_uid, a.autorizacao_numero, a.autorizacao_ano, a.autorizacao_estado, a.autorizacao_designacao, a.autorizacao_dataregistro, e.espaco_id, e.espaco_nome, count( at.* ) filter ( where at.autorizacao_ano > a.autorizacao_ano ) as autorizacao_postone, count( at.* ) filter ( where at.autorizacao_ano < a.autorizacao_ano ) as autorizacao_previews from tweeks.autorizacao a inner join tweeks.espaco e on a.autorizacao_espaco_uid = e.espaco_id left join tweeks.autorizacao at on at.autorizacao_espaco_uid = a.autorizacao_espaco_uid and at._branch_uid = a._branch_uid and at.autorizacao_ano != a.autorizacao_ano where a._branch_uid = arg_branch_uid and true in ( a.autorizacao_espaco_auth = any( _espaco_child ), a.autorizacao_espaco_uid = any( _espaco_child ) ) group by a.autorizacao_uid, e.espaco_id ), __continue as ( select at.*, case when at.autorizacao_estado = _const.maguita_autorizacao_estado_fechado and at.autorizacao_postone = 0 then true else false end as autorizacao_continue from __autorizacao at ) select to_jsonb( _a ) from __continue _a order by _a.autorizacao_ano desc, _a.autorizacao_dataregistro desc ; end; $$; create or replace function tweeks.funct_load_serie(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** arg_espaco_auth arg_colaborador_id arg_autorizacao_id */ _const map.constant; arg_espaco_auth uuid default args->>'arg_espaco_auth'; arg_autorizacao_id uuid default args->>'arg_autorizacao_id'; arg_colaborador_id uuid default args->>'arg_colaborador_id'; ___branch_uid uuid; _espaco_child uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth ); begin _const := map.constant(); ___branch_uid := tweeks.__branch_uid( null, arg_espaco_auth ); return query with __serie as ( select _vs.*, e.espaco_id, e.espaco_nome from tweeks.serie _vs inner join tweeks.espaco e on _vs.serie_espaco_id = e.espaco_id where _vs._branch_uid = ___branch_uid and coalesce( _vs.serie_autorizacao_uid ) = coalesce( arg_autorizacao_id, _vs.serie_autorizacao_uid ) and true in ( _vs.serie_espaco_auth = any( _espaco_child ), _vs.serie_espaco_id = any( _espaco_child ) ) ) select to_jsonb( _s ) from __serie _s; end; $$; drop function if exists tweeks.funct_load_autorizacao_continue(args jsonb); create or replace function funct_sets_autorizacao_continue(args jsonb) returns lib.res language plpgsql as $$ declare /** { arg_colaborador_id: UID arg_espaco_auth: UID autorizacao_uid: UID } */ arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _autorizacao tweeks.autorizacao; _const map.constant; _data record; begin _autorizacao := tweeks.__get_autorizacao( ( args->>'autorizacao_uid' )::uuid ); _const := map.constant(); with __serie as ( select serie_tserie_id, serie_espaco_id, serie_designacao, serie_numero, serie_quantidade, serie_numcertificacao, serie_numatorizacao, case when _autorizacao.autorizacao_ano = extract( years from current_date)::int then serie_sequencia else 0 end serie_sequencia from tweeks.serie se where se.serie_autorizacao_uid = _autorizacao.autorizacao_uid and se.serie_estado = _const.maguita_serie_estado_fechado and se.serie_fechoautorizacao and se._branch_uid = arg_branch_uid ) select jsonb_agg( to_jsonb( _s ) ) as series into _data from __serie _s; return tweeks.funct_sets_autorizacao( jsonb_build_object( 'arg_colaborador_id', arg_colaborador_id, 'arg_espaco_auth', arg_espaco_auth, '_autorizacao_continue', _autorizacao, 'autorizacao_uid', null, 'autorizacao_espaco_uid', _autorizacao.autorizacao_espaco_uid, 'autorizacao_designacao', _autorizacao.autorizacao_designacao, 'autorizacao_numero', _autorizacao.autorizacao_numero, 'series', _data.series )); end; $$; drop function if exists tweeks.__sets_generate_documento(arg_espaco_auth uuid, arg_tserie integer); create or replace function tweeks.__sets_generate_documento(arg_espaco_auth uuid, arg_tserie integer) returns TABLE( document character varying, serie_id uuid, serie_numero character varying, serie_numatorizacao character varying, serie_numcertificacao character varying, serie_sequencia bigint, serie_quantidade bigint, autorizacao_uid uuid, autorizacao_ano int, autorizacao_numero character varying ) strict language plpgsql as $$ declare _serie tweeks.serie; _numero_documento varchar; ___branch uuid default tweeks.__branch_uid( null, arg_espaco_auth ); _const map.constant; _espaco tweeks.espaco; _tserie tweeks.tserie; _iterate int default 0; _autorizacao tweeks.autorizacao; begin _const := map.constant(); select * into _tserie from tweeks.tserie ts where ts.tserie_id = arg_tserie ; -- Obter o espaço superior que pode gerar numero de seire with recursive __espaco as ( select e.*, e.espaco_gerarfatura as __generate_serie from tweeks.espaco e where e.espaco_id =arg_espaco_auth union all select w.*, w.espaco_gerarfatura from __espaco _e inner join tweeks.espaco w on _e.espaco_espaco_id = w.espaco_id and not _e.__generate_serie ) select * into _espaco from __espaco __e where __e.__generate_serie ; while _numero_documento is null loop update tweeks.serie s set serie_sequencia = s.serie_sequencia +1 from tweeks.autorizacao a where s.serie_autorizacao_uid = a.autorizacao_uid and s._branch_uid = ___branch and a._branch_uid = ___branch and s.serie_espaco_id = _espaco.espaco_id and s.serie_tserie_id = arg_tserie and s.serie_estado = _const.maguita_serie_estado_ativo and a.autorizacao_estado = _const.maguita_autorizacao_estado_ativo and a.autorizacao_ano = extract( years from now() )::int returning * into _serie ; if _serie.serie_id is null then raise exception 'Nenhuma serie disponivel para gerar a sequencia!'; end if; if length( _serie.serie_sequencia::text ) > _tserie.tserie_seqlimit::int then raise exception 'O numero de sequencia excede o tamanho maximo definido para e seire'; end if; _autorizacao := tweeks.__get_autorizacao( _serie.serie_autorizacao_uid ); -- ex: FT0000119000001 -- TIPO|FIXA|ANO|SEQUENCIA _numero_documento := format( '%s%s%s%s', _tserie.tserie_code, --TYPE lpad( "left"( _serie.serie_numero, _tserie.tserie_numlimit-2), _tserie.tserie_numlimit-2, '0'), --FIXA to_char( make_date( _autorizacao.autorizacao_ano, 1, 1 ), 'yy' ), --YEAR lpad( _serie.serie_sequencia::text, _tserie.tserie_seqlimit::int, '0' ) --SEQUENCE ); if _tserie.tserie_id in ( _const.maguita_tserie_fatura, _const.maguita_tserie_faturarecibo ) and exists( select * from tweeks.conta c where c.conta_numerofatura = _numero_documento and c._branch_uid = ___branch ) then _numero_documento := null; end if; if _numero_documento is not null and _tserie.tserie_id in ( _const.maguita_tserie_recibo, _const.maguita_tserie_faturarecibo ) and exists( select * from tweeks.deposito de where de.deposito_documento = _numero_documento and de._branch_uid = ___branch ) then _numero_documento := null; end if; _iterate := _iterate +1; if _iterate = 1000 then raise exception 'Exedeu o limite de tentativa para geração de numero de serie, por favor proucure pelo suporte.'; end if; end loop; __sets_generate_documento.document := _numero_documento; __sets_generate_documento.serie_id := _serie.serie_id; __sets_generate_documento.serie_sequencia := _serie.serie_sequencia; __sets_generate_documento.serie_numero := _serie.serie_numero; __sets_generate_documento.serie_quantidade := _serie.serie_quantidade; __sets_generate_documento.serie_numatorizacao := _serie.serie_numatorizacao; __sets_generate_documento.serie_numcertificacao := _serie.serie_numcertificacao; __sets_generate_documento.autorizacao_uid := _autorizacao.autorizacao_uid; __sets_generate_documento.autorizacao_ano := _autorizacao.autorizacao_ano; __sets_generate_documento.autorizacao_numero := _autorizacao.autorizacao_numero; return next; end; $$;
48d5d583-51b8-4aed-b1a0-9f3674823b78	\ncreate or replace function tweeks.funct_load_cambio_ativo(args jsonb) returns SETOF jsonb\n  strict\n  language plpgsql\nas\n$$\ndeclare\n  arg_colaborador_id uuid default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid default args->>'arg_espaco_auth';\n  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  _const map.constant;\n  _data record;\nbegin\n  _const := map.constant();\n\n  select * into _data\n    from geoinfo.currency cu \n      left join tweeks.cambio cb on cb.cambio_currency_id = cu.currency_id\n        and cb.cambio_estado = _const.cambio_estado_ativo\n        and cb.cambio_espaco_auth = arg_espaco_auth\n        and cb._branch_uid = ___branch\n    where upper( cu.currency_code )  = 'STN'\n  ;\n  \n  if _data.cambio_id is null then\n    insert into tweeks.cambio (\n      cambio_currency_id,\n      cambio_espaco_auth, \n      cambio_colaborador_id, \n      cambio_taxa, \n      _branch_uid\n    ) values (\n      _data.currency_id,\n      arg_espaco_auth,\n      _const.colaborador_system_data,\n      1,\n      ___branch\n    );\n  end if;\n\n  return query\n    with __cambio as (\n      select\n          cb.cambio_id,\n          cb.cambio_data,\n          cb.cambio_taxa,\n          cb.cambio_dataregistro,\n          cu.currency_id,\n          cu.currency_name,\n          cu.currency_code,\n          cu.currency_symbol,\n          rank() over ( partition by cb.cambio_currency_id order by\n            case when cambio_espaco_auth = arg_espaco_auth then 1 else 2 end,\n            cb.cambio_dataregistro desc )  as cambio_rank\n        from tweeks.cambio cb\n          inner join geoinfo.currency cu on cb.cambio_currency_id = cu.currency_id\n        where cb.cambio_estado = _const.cambio_estado_ativo\n          and cb.cambio_espaco_auth = arg_espaco_auth\n          and cb._branch_uid = ___branch\n    ) select\n        to_jsonb( cb )\n      from __cambio cb\n      where cb.cambio_rank = 1\n  ;\nend;\n$$;\n\ncreate or replace function tweeks.funct_reg_precario(args jsonb) returns lib.result\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    Essa função serve para registrar e atualizar os preços dos itens\n    args := {\n      arg_espaco_auth: ID\n      arg_colaborador_id: ID,\n      arg_forced: boolean,\n      arg_precario_referencia: {\n        artigo_id: ID,\n      },\n      arg_links :[\n        {  espaco_id: *ID,\n           stock_minimo: QUNT\n           precario_custo: CUSTO,\n           precario_quantidade: QUANT_CUSTO }\n      ]\n    }\n  */\n\n  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n\n  arg_precario_referencia jsonb not null default args->>'arg_precario_referencia';\n  arg_forced boolean default args->>'arg_forced';\n  arg_artigo_id uuid;\n\n  arg_espacos_destino uuid[] default array ( select ( e.doc->>'espaco_id' )::uuid from jsonb_array_elements( args->'arg_links') e( doc ) );\n  arg_espaco_child uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth );\n\n  _const map.constant;\n  _artigo tweeks.artigo;\n  _branch uuid := tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n\nbegin\n  _const := map.constant();\n  arg_forced := coalesce( arg_forced, false );\n\n  arg_artigo_id := arg_precario_referencia->>'artigo_id';\n\n\n  if not arg_forced and arg_artigo_id is not null then\n    _artigo := tweeks._get_artigo( arg_artigo_id );\n\n    -- Alterar o preço apenas quando o artigo não estiver em nenhuma conta aberta\n    if (\n         select count( * ) > 0\n         from tweeks.venda ag\n         where ag.venda_artigo_id = arg_artigo_id\n           and ag.venda_estado in ( _const.maguita_venda_estado_aberto )\n          and ag._branch_uid = _branch\n       ) then\n      return false ? '@tweeks.artigo.price-can-not-update-open-account';\n    end if;\n  end if;\n\n  -- Desativar o precario atual\n  update tweeks.link\n    set link_estado = _const.maguita_link_estado_fechado,\n        link_dataatualizacao = now(),\n        link_colaborador_atualizacao = arg_colaborador_id\n    where link_referencia @> arg_precario_referencia\n      and link_estado = _const.maguita_link_estado_ativo\n      and link_espaco_destino = any( arg_espaco_child )\n      and _branch_uid = _branch\n      and link_tlink_id = _const.maguita_tlink_preco   \n  ;\n\n   -- Criar os novos precarios\n   insert into tweeks.link(\n      link_tlink_id,\n      link_espaco_destino,\n      link_espaco_auth,\n      link_colaborador_id,\n      link_referencia,\n      link_posicao,\n      link_nome,\n      link_metadata\n    ) select\n      (map.constant()).maguita_tlink_preco,\n      ( lp.doc->>'espaco_id' )::uuid,\n      arg_espaco_auth,\n      arg_colaborador_id,\n      arg_precario_referencia,\n      0,\n      format( 'Preço de %s para %s', _artigo.artigo_nome, e.espaco_nome ),\n      jsonb_build_object(\n          'precario_custo', ( lp.doc->>'precario_custo' )::double precision,\n          'stock_minimo', ( lp.doc->>'stock_minimo' )::double precision,\n          'precario_quantidade', (lp.doc->>'precario_quantidade')::double precision\n      )\n      from jsonb_array_elements( args->'arg_links' ) lp( doc )\n        inner join tweeks.espaco e on (lp.doc->>'espaco_id')::uuid = e.espaco_id\n    ;\n  \n  return lib.result_true(jsonb_build_object(\n    'precario', array(\n        select to_jsonb( l )\n          from tweeks.link l\n          where l.link_espaco_destino = any( arg_espacos_destino )\n            and (l.link_referencia ->>'artigo_id')::uuid = (arg_precario_referencia->>'artigo_id')::uuid\n            and l.link_estado = _const.maguita_link_estado_ativo\n            and l.link_tlink_id = _const.maguita_tlink_preco\n            and l._branch_uid = _branch\n    )\n  ));\nend;\n$$;\n\n	create or replace function tweeks.funct_load_cambio_ativo(args jsonb) returns SETOF jsonb strict language plpgsql as $$ declare arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _const map.constant; _data record; begin _const := map.constant(); select * into _data from geoinfo.currency cu left join tweeks.cambio cb on cb.cambio_currency_id = cu.currency_id and cb.cambio_estado = _const.cambio_estado_ativo and cb.cambio_espaco_auth = arg_espaco_auth and cb._branch_uid = ___branch where upper( cu.currency_code ) = 'STN' ; if _data.cambio_id is null then insert into tweeks.cambio ( cambio_currency_id, cambio_espaco_auth, cambio_colaborador_id, cambio_taxa, _branch_uid ) values ( _data.currency_id, arg_espaco_auth, _const.colaborador_system_data, 1, ___branch ); end if; return query with __cambio as ( select cb.cambio_id, cb.cambio_data, cb.cambio_taxa, cb.cambio_dataregistro, cu.currency_id, cu.currency_name, cu.currency_code, cu.currency_symbol, rank() over ( partition by cb.cambio_currency_id order by case when cambio_espaco_auth = arg_espaco_auth then 1 else 2 end, cb.cambio_dataregistro desc ) as cambio_rank from tweeks.cambio cb inner join geoinfo.currency cu on cb.cambio_currency_id = cu.currency_id where cb.cambio_estado = _const.cambio_estado_ativo and cb.cambio_espaco_auth = arg_espaco_auth and cb._branch_uid = ___branch ) select to_jsonb( cb ) from __cambio cb where cb.cambio_rank = 1 ; end; $$; create or replace function tweeks.funct_reg_precario(args jsonb) returns lib.result language plpgsql as $$ declare /** Essa função serve para registrar e atualizar os preços dos itens args := { arg_espaco_auth: ID arg_colaborador_id: ID, arg_forced: boolean, arg_precario_referencia: { artigo_id: ID, }, arg_links :[ { espaco_id: *ID, stock_minimo: QUNT precario_custo: CUSTO, precario_quantidade: QUANT_CUSTO } ] } */ arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_precario_referencia jsonb not null default args->>'arg_precario_referencia'; arg_forced boolean default args->>'arg_forced'; arg_artigo_id uuid; arg_espacos_destino uuid[] default array ( select ( e.doc->>'espaco_id' )::uuid from jsonb_array_elements( args->'arg_links') e( doc ) ); arg_espaco_child uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth ); _const map.constant; _artigo tweeks.artigo; _branch uuid := tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); begin _const := map.constant(); arg_forced := coalesce( arg_forced, false ); arg_artigo_id := arg_precario_referencia->>'artigo_id'; if not arg_forced and arg_artigo_id is not null then _artigo := tweeks._get_artigo( arg_artigo_id ); -- Alterar o preço apenas quando o artigo não estiver em nenhuma conta aberta if ( select count( * ) > 0 from tweeks.venda ag where ag.venda_artigo_id = arg_artigo_id and ag.venda_estado in ( _const.maguita_venda_estado_aberto ) and ag._branch_uid = _branch ) then return false ? '@tweeks.artigo.price-can-not-update-open-account'; end if; end if; -- Desativar o precario atual update tweeks.link set link_estado = _const.maguita_link_estado_fechado, link_dataatualizacao = now(), link_colaborador_atualizacao = arg_colaborador_id where link_referencia @> arg_precario_referencia and link_estado = _const.maguita_link_estado_ativo and link_espaco_destino = any( arg_espaco_child ) and _branch_uid = _branch and link_tlink_id = _const.maguita_tlink_preco ; -- Criar os novos precarios insert into tweeks.link( link_tlink_id, link_espaco_destino, link_espaco_auth, link_colaborador_id, link_referencia, link_posicao, link_nome, link_metadata ) select (map.constant()).maguita_tlink_preco, ( lp.doc->>'espaco_id' )::uuid, arg_espaco_auth, arg_colaborador_id, arg_precario_referencia, 0, format( 'Preço de %s para %s', _artigo.artigo_nome, e.espaco_nome ), jsonb_build_object( 'precario_custo', ( lp.doc->>'precario_custo' )::double precision, 'stock_minimo', ( lp.doc->>'stock_minimo' )::double precision, 'precario_quantidade', (lp.doc->>'precario_quantidade')::double precision ) from jsonb_array_elements( args->'arg_links' ) lp( doc ) inner join tweeks.espaco e on (lp.doc->>'espaco_id')::uuid = e.espaco_id ; return lib.result_true(jsonb_build_object( 'precario', array( select to_jsonb( l ) from tweeks.link l where l.link_espaco_destino = any( arg_espacos_destino ) and (l.link_referencia ->>'artigo_id')::uuid = (arg_precario_referencia->>'artigo_id')::uuid and l.link_estado = _const.maguita_link_estado_ativo and l.link_tlink_id = _const.maguita_tlink_preco and l._branch_uid = _branch ) )); end; $$;
29b3dd79-cb3a-43cb-9320-4fb75b79f16d	\ncreate table if not exists tweeks.codigoimposto(\n  codigoimposto_codigo character varying,\n  codigoimposto_descricao character varying,\n  constraint pk_codigoimposto_codigo primary key ( codigoimposto_codigo )\n);\n\nalter table tweeks.artigo add if not exists artigo_codigoimposto character varying default null;\nalter table tweeks.venda add if not exists venda_codigoimposto character varying default null;\nalter table tweeks.posto add if not exists  posto_vermontatefaturado boolean not null default false;\n\ntruncate tweeks.codigoimposto;\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '111', 'Facturas de transmissões de bens e prestações de serviços com IVA liquidado à taxa normal de 15%' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '112', 'Facturas de transmissões de bens e prestações de serviços com IVA liquidado à taxa reduzida de 7,5%' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '201', 'Facturas isentas do IVA nos termos da al. a) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '202', 'Facturas isentas do IVA nos termos da al. b) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '203', 'Facturas isentas do IVA nos termos da al. c) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '204', 'acturas isentas do IVA nos termos da al. d) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '205', 'Facturas isentas do IVA nos termos da al. e) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '206', 'Facturas isentas do IVA nos termos da al. a) do nº 3 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '207', 'Facturas isentas do IVA nos termos da al. b) do nº 3 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '208', 'Facturas isentas do IVA nos termos da al. a) do nº 4 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '209', 'Facturas isentas do IVA nos termos da al. b) do nº 4 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '210', 'Facturas isentas do IVA nos termos da al. a) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '211', 'Facturas isentas do IVA nos termos da al. b) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '212', 'Facturas isentas do IVA nos termos da al. c) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '213', 'Facturas isentas do IVA nos termos da al. d) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '214', 'Facturas isentas do IVA nos termos da al. e) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '215', 'Facturas isentas do IVA nos termos da al. f) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '216', 'Facturas isentas do IVA nos termos da al. g) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '311', 'Nota de crédito relativa às facturas de transmissões de bens e prestações de serviços com IVA liquidado à taxa normal de 15%' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '312', 'Nota de crédito relativa às facturas de transmissões de bens e prestações de serviços com IVA liquidado à taxa normal de 7,5%' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '401', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. a) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '402', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. b) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '403', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. c) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '404', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. d) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '405', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. e) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '406', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. a) do nº 3 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '407', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. b) do nº 3 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '408', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. a) do nº 4 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '409', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. b) do nº 4 do art. do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '410', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. a) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '411', 'ota de crédito relativa às facturas isentas do IVA nos termos da al. b) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '412', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. c) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '413', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. d) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '414', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. e) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '415', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. f) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '416', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. g) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '551', 'Facturas de aquisição de serviços autoliquidados à taxa de 15%' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '611', 'Facturas de aquisição de bens e prestações de serviços com IVA liquidado à taxa normal de 15%' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '612', 'Facturas de aquisição de bens e serviços com IVA liquidado à taxa reduzida de 7,5%' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '701', 'Facturas de aquisição isentas do IVA nos termos da al. a) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '702', 'Facturas de aquisição isentas do IVA nos termos da al. b) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '703', 'Facturas de operações isentas do IVA nos termos da al. c) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '704', 'Facturas de aquisição isentas do IVA nos termos da al. d) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '705', 'acturas de aquisição isentas do IVA nos termos da al. e) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '706', 'Facturas de aquisição isentas do IVA nos termos da al. a) do nº 3 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '707', 'Facturas de aquisição isentas do IVA nos termos da al. b) do nº 3 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '708', 'Facturas de aquisição isentas do IVA nos termos da al. a) do nº 4 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '709', 'Facturas de aquisição isentas do IVA nos termos da al. b) do nº 4 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '710', 'Facturas de aquisição isentas do IVA nos termos da al. a) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '711', 'Facturas de aquisição isentas do IVA nos termos da al. b) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '712', 'Facturas de aquisição isentas do IVA nos termos da al. c) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '713', 'Facturas de aquisição isentas do IVA nos termos da al. d) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '714', 'Facturas de aquisição isentas do IVA nos termos da al. e) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '715', 'Facturas de aquisição isentas do IVA nos termos da al. f) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '716', 'Facturas isentas do IVA nos termos da al. g) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '811', 'Nota de débito relativa às facturas de aquisição de bens e serviços com IVA liquidado à taxa normal de 15%' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '812', 'Nota de débito relativa às facturas de aquisição de bens e serviços com IVA liquidado à taxa normal de 7,5%' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '901', 'Nota de débito relativa às facturas isentas do IVA nos termos da al. a) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '902', 'Nota de débito relativa às facturas isentas do IVA nos termos da al. b) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '903', 'Nota de débito relativa às facturas isentas do IVA nos termos da al. c) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '904', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. d) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '905', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. e) do nº 1 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '906', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. a) do nº 3 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '907', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. b) do nº 3 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '908', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. a) do nº 4 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '909', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. b) do nº 4 do art. 17º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '910', 'ta de débito relativa às facturas de aquisição isentas do IVA nos termos da al. a) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '911', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. b) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '912', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. c) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '913', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. d) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '914', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. e) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '915', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. f) do nº1 do art. 20º do CIVA' );\nINSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '916', 'Nota de débito relativa às facturas isentas do IVA nos termos da al. g) do nº1 do art. 20º do CIVA' );\n\n	create table if not exists tweeks.codigoimposto( codigoimposto_codigo character varying, codigoimposto_descricao character varying, constraint pk_codigoimposto_codigo primary key ( codigoimposto_codigo ) ); alter table tweeks.artigo add if not exists artigo_codigoimposto character varying default null; alter table tweeks.venda add if not exists venda_codigoimposto character varying default null; alter table tweeks.posto add if not exists posto_vermontatefaturado boolean not null default false; truncate tweeks.codigoimposto; INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '111', 'Facturas de transmissões de bens e prestações de serviços com IVA liquidado à taxa normal de 15%' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '112', 'Facturas de transmissões de bens e prestações de serviços com IVA liquidado à taxa reduzida de 7,5%' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '201', 'Facturas isentas do IVA nos termos da al. a) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '202', 'Facturas isentas do IVA nos termos da al. b) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '203', 'Facturas isentas do IVA nos termos da al. c) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '204', 'acturas isentas do IVA nos termos da al. d) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '205', 'Facturas isentas do IVA nos termos da al. e) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '206', 'Facturas isentas do IVA nos termos da al. a) do nº 3 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '207', 'Facturas isentas do IVA nos termos da al. b) do nº 3 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '208', 'Facturas isentas do IVA nos termos da al. a) do nº 4 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '209', 'Facturas isentas do IVA nos termos da al. b) do nº 4 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '210', 'Facturas isentas do IVA nos termos da al. a) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '211', 'Facturas isentas do IVA nos termos da al. b) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '212', 'Facturas isentas do IVA nos termos da al. c) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '213', 'Facturas isentas do IVA nos termos da al. d) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '214', 'Facturas isentas do IVA nos termos da al. e) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '215', 'Facturas isentas do IVA nos termos da al. f) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '216', 'Facturas isentas do IVA nos termos da al. g) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '311', 'Nota de crédito relativa às facturas de transmissões de bens e prestações de serviços com IVA liquidado à taxa normal de 15%' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '312', 'Nota de crédito relativa às facturas de transmissões de bens e prestações de serviços com IVA liquidado à taxa normal de 7,5%' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '401', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. a) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '402', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. b) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '403', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. c) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '404', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. d) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '405', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. e) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '406', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. a) do nº 3 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '407', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. b) do nº 3 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '408', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. a) do nº 4 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '409', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. b) do nº 4 do art. do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '410', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. a) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '411', 'ota de crédito relativa às facturas isentas do IVA nos termos da al. b) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '412', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. c) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '413', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. d) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '414', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. e) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '415', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. f) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '416', 'Nota de crédito relativa às facturas isentas do IVA nos termos da al. g) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '551', 'Facturas de aquisição de serviços autoliquidados à taxa de 15%' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '611', 'Facturas de aquisição de bens e prestações de serviços com IVA liquidado à taxa normal de 15%' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '612', 'Facturas de aquisição de bens e serviços com IVA liquidado à taxa reduzida de 7,5%' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '701', 'Facturas de aquisição isentas do IVA nos termos da al. a) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '702', 'Facturas de aquisição isentas do IVA nos termos da al. b) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '703', 'Facturas de operações isentas do IVA nos termos da al. c) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '704', 'Facturas de aquisição isentas do IVA nos termos da al. d) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '705', 'acturas de aquisição isentas do IVA nos termos da al. e) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '706', 'Facturas de aquisição isentas do IVA nos termos da al. a) do nº 3 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '707', 'Facturas de aquisição isentas do IVA nos termos da al. b) do nº 3 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '708', 'Facturas de aquisição isentas do IVA nos termos da al. a) do nº 4 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '709', 'Facturas de aquisição isentas do IVA nos termos da al. b) do nº 4 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '710', 'Facturas de aquisição isentas do IVA nos termos da al. a) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '711', 'Facturas de aquisição isentas do IVA nos termos da al. b) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '712', 'Facturas de aquisição isentas do IVA nos termos da al. c) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '713', 'Facturas de aquisição isentas do IVA nos termos da al. d) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '714', 'Facturas de aquisição isentas do IVA nos termos da al. e) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '715', 'Facturas de aquisição isentas do IVA nos termos da al. f) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '716', 'Facturas isentas do IVA nos termos da al. g) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '811', 'Nota de débito relativa às facturas de aquisição de bens e serviços com IVA liquidado à taxa normal de 15%' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '812', 'Nota de débito relativa às facturas de aquisição de bens e serviços com IVA liquidado à taxa normal de 7,5%' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '901', 'Nota de débito relativa às facturas isentas do IVA nos termos da al. a) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '902', 'Nota de débito relativa às facturas isentas do IVA nos termos da al. b) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '903', 'Nota de débito relativa às facturas isentas do IVA nos termos da al. c) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '904', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. d) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '905', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. e) do nº 1 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '906', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. a) do nº 3 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '907', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. b) do nº 3 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '908', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. a) do nº 4 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '909', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. b) do nº 4 do art. 17º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '910', 'ta de débito relativa às facturas de aquisição isentas do IVA nos termos da al. a) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '911', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. b) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '912', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. c) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '913', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. d) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '914', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. e) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '915', 'Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. f) do nº1 do art. 20º do CIVA' ); INSERT INTO tweeks.codigoimposto ( codigoimposto_codigo, codigoimposto_descricao ) VALUES ( '916', 'Nota de débito relativa às facturas isentas do IVA nos termos da al. g) do nº1 do art. 20º do CIVA' );
878960a5-383c-4e7e-91d0-7ae641db21d8	\ndo $$\nBEGIN \n  if not exists(\n    select *\n      from tweeks.tserie\n      where tserie_id = 5\n  ) then \n    INSERT INTO tweeks.tserie (tserie_id, tserie_desc, tserie_code, tserie_seqlimit, tserie_numlimit) VALUES (5, 'Guia Saida', 'GS', 6, 7);\n  end if;\n  \n  perform map.constant('maguita_tserie_guiasaida', 'int2', 5, 'Guia de saida', false, 'Guia de saida' );\nend;\n$$\n	do $$ BEGIN if not exists( select * from tweeks.tserie where tserie_id = 5 ) then INSERT INTO tweeks.tserie (tserie_id, tserie_desc, tserie_code, tserie_seqlimit, tserie_numlimit) VALUES (5, 'Guia Saida', 'GS', 6, 7); end if; perform map.constant('maguita_tserie_guiasaida', 'int2', 5, 'Guia de saida', false, 'Guia de saida' ); end; $$
a9258d43-2d55-49dd-9705-b2f8d5b43828	\ndo $$\nBEGIN \n  if not exists(\n    select *\n      from tweeks.tpaga\n      where tpaga_id = 6\n  ) then\n      INSERT INTO tweeks.tpaga (tpaga_id, tpaga_designacao) VALUES (6, 'POS');\n  end if;\n  \nend;\n$$\n	do $$ BEGIN if not exists( select * from tweeks.tpaga where tpaga_id = 6 ) then INSERT INTO tweeks.tpaga (tpaga_id, tpaga_designacao) VALUES (6, 'POS'); end if; end; $$
080e9762-ca35-44dc-9762-a6bb812fcf1d	\n    select map.constant( 'maguita_cliente_final', 'uuid', lib.to_uuid( 1 ) );\n    select map.constant( 'maguita_cliente_finalnotacredito', 'uuid', lib.to_uuid( 2 ) );\n	select map.constant( 'maguita_cliente_final', 'uuid', lib.to_uuid( 1 ) ); select map.constant( 'maguita_cliente_finalnotacredito', 'uuid', lib.to_uuid( 2 ) );
20a3b290-946a-447f-b38d-9fc716e001f1	\ncreate or replace function tweeks.funct_pos_change_conta_fechar(args jsonb) returns lib.res\n  language plpgsql\nas\n$$\ndeclare\n    /**\n      Essa função fecha uma nova conta\n      arg = {\n        arg_espaco_auth: ID,\n        arg_colaborador_id: ID,\n        arg_tserie_id: ID,      \n        deposito:{\n          deposito_cliente_id\n          deposito_caixa_id\n          deposito_tpaga_id\n          deposito_currency_id\n          deposito_posto_id\n          deposito_montantemoeda\n          deposito_montantetroco\n          deposito_data\n          deposito_docref: DOCUMENTO-REF?\n          deposito_observacao: OBSERVACAO?\n        }\n\n        conta_id: ID,\n        conta_extension: {} | { reserva_id: UID }\n        conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM },\n\n        conta_posto_id: ID,\n        conta_desconto\n\n        conta_titular: NOME-CLIENTE\n        conta_titularnif: VARCHAR,\n        conta_data: DATA,\n        conta_cliente_id,\n\n        //Relativos a GUIA\n        guia_documentoperacao: CODIGO,\n        guia_dataopeacao: DATA,\n        guia_observacao: DESCRICAO\n        guia_metadata: { ... any extras data }\n\n        custos:[{\n          custoguia_montante: MONTANTE,\n          custoguia_descricao: DESCRICAO PARA O CUSTO\n          custoguia_tcusto_id: 1 - DESPESA | 2 - RECEITA\n        }]\n      }\n     */\n\n    arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n    arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n    arg_tserie_id int2 default args->>'arg_tserie_id';\n\n    arg_conta_id uuid default args->>'conta_id';\n    arg_caixa_id uuid default args->>'de_caixa_id';\n    _deposito_montantetroco double precision;\n\n\n    _conta tweeks.conta;\n    _const map.constant;\n    _caixa tweeks.caixa;\n    _res lib.res;\n    _cambio record;\n    _montante_amortizacao double precision;\n    _deposito tweeks.deposito;\n    _rec record;\n    _guia tweeks.guia;\n    _message text;\n  begin\n    _const := map.constant();\n    _caixa := tweeks._get_caixa( arg_caixa_id );\n    _conta := tweeks._get_conta( arg_conta_id );\n    _conta := jsonb_populate_record( _conta, args );\n    _conta.conta_data := coalesce( _conta.conta_data, current_date );\n    _deposito := jsonb_populate_record( _deposito, args->'deposito' );\n\n    _message := tweeks.__check_conta_data( \n      _tserie_id := arg_tserie_id, \n      _conta_data := _conta.conta_data,\n      _raise := false\n    );\n    \n    if _message is not null then \n        return lib.res_false( _message );\n    end if;\n    \n    if _conta.conta_id is null then \n      raise exception '%', 'Identificador da conta a ser fechada não foi informado!';\n    end if;\n    \n    if _conta.conta_estado = _const.maguita_conta_estado_fechado then\n      return lib.res_false( 'Essa conta já se encontra fechada!' );\n    end if;\n    \n    if arg_tserie_id not in (\n        _const.maguita_tserie_fatura,\n        _const.maguita_tserie_faturarecibo,\n        _const.maguita_tserie_guiasaida,\n        _const.maguita_tserie_notacredito\n    ) then\n      return lib.res_false( 'Não pode fechar a conta o com tipo de serie selecionada!' );\n    end if;\n    \n    if _conta.conta_posto_fecho is null then\n      return lib.res_false( 'Necessario indicar o posto de fecho!' );\n    end if;\n    \n    -- Na fatura recibo não pode haver conta corrente\n    if arg_tserie_id = _const.maguita_tserie_faturarecibo and _deposito.deposito_montantemoeda is null then \n      return lib.res_false( 'O pagamento para as faturas/recibo é obrigatorio!' );\n    end if;\n    \n    -- Os cliente finais só podem receber fatura/recibo ou nota de credito\n    if true in (\n        _conta.conta_cliente_id is null,\n        _conta.conta_cliente_id = lib.to_uuid( 1 ) -- cliente final\n    ) and arg_tserie_id not in (\n      _const.maguita_tserie_faturarecibo\n    ) then\n      return lib.res_false( 'Só pode lançar nos cliente finais as futuras/recibos!');\n    end if;\n    \n    \n    -- Quando hover necessidade de efetuar o deposito então, deve-se obter a taxa de cambio para o dia\n    if arg_tserie_id = _const.maguita_tserie_faturarecibo \n      or _deposito.deposito_montantemoeda is not null\n    then\n      if _deposito.deposito_tpaga_id = _const.maguita_tpaga_contacorrente then\n        return lib.res_false( 'Tipo de pagamento invalido' );\n      end if;\n      \n      -- Obter o cambio para a moeda selecionada\n      select * into _cambio from tweeks.__load_cambio_day(\n        arg_espaco_auth,\n        _deposito.deposito_currency_id,\n        _conta.conta_data,\n        _const\n      );\n      \n      if _cambio.cambio_id is null then\n        return lib.res_false( 'Câmbio não foi encontrado!' );\n      end if;\n    end if;\n    \n    -- O valor do deposito nas conta de fatura/recibo deve ser o suficiente para cobrir o montante da fatura\n    if arg_tserie_id = _const.maguita_tserie_faturarecibo then \n      if round( ( _cambio.cambio_taxa * _deposito.deposito_montantemoeda)::numeric, _const.money_round )  < round( _conta.conta_montante::numeric, _const.money_round ) then\n        return lib.res_false( 'Montante para pagamento insuficiente' );\n      end if;\n\n      -- Se for para amortizar a conta a caixa tem que estar aberta\n      if _caixa.caixa_estado != _const.maguita_caixa_estado_ativo then\n        return lib.res_false( 'Pagamento rejeitado!' );\n      end if;\n    end if;\n\n    -- Definir em aqual conta a fatura deve ser enviado\n    _conta._tgrupo_id := case\n      when arg_tserie_id = _const.maguita_tserie_faturarecibo then _const.maguita_tgrupo_cnormal\n      when arg_tserie_id = _const.maguita_tserie_fatura then _const.maguita_tgrupo_ccorrente\n      when arg_tserie_id = _const.maguita_tserie_guiasaida then _const.maguita_tgrupo_ccorrente\n      when arg_tserie_id = _const.maguita_tserie_notacredito then _const.maguita_tgrupo_ccorrente\n    end;\n    \n    -- Gerar a serie para a conta dependento do tipo do documento (fatura, faturarecibo, notacredito, guiasaida)\n    _rec := tweeks.__sets_generate_documento( arg_espaco_auth, arg_tserie_id );\n    _conta.conta_numerofatura := _rec.document;\n    _conta.conta_serie := to_json( _rec );\n    _conta.conta_serie_id = _rec.serie_id;\n\n    _conta.conta_estado := _const.maguita_conta_estado_fechado;\n    _conta.conta_imprensa := 1;\n    _conta.conta_colaborador_fecho := arg_colaborador_id;\n    _conta.conta_datafecho := current_timestamp;\n    _conta.conta_cliente_id := coalesce( _conta.conta_cliente_id, lib.to_uuid( 1 ) );\n\n    -- Gerar a Guia de saida\n    _guia := jsonb_populate_record( _guia, args );\n    _guia.guia_tguia_id := _const.maguita_tguia_saida;\n    _guia.guia_espaco_saida := arg_espaco_auth;\n    _guia.guia_toperacao_id := _const.maguita_toperacao_venda;\n    _guia.guia_refclass := cluster.__format( 'tweeks.conta'::regclass );\n    _guia.guia_refuid := _conta.conta_id;\n    _guia.guia_refs := jsonb_build_object(\n      'cliente', jsonb_build_object( 'cliente_id', _conta.conta_cliente_id ),\n      'saida', jsonb_build_object( 'espaco_id', _conta.conta_espaco_auth )\n    );\n\n    _guia := tweeks.funct_sets_guia( jsonb_build_object(\n      'guia', _guia,\n      'custoguia', args->'custos',\n      'arg_colaborador_id', arg_colaborador_id,\n      'arg_espaco_auth', arg_espaco_auth\n    ));\n\n    -- Vicular a informaçao de guia na conta extension com a tag guia_id\n    _conta.conta_extension := coalesce( _conta.conta_extension, jsonb_build_object() )\n      || jsonb_build_object( 'guia_id', _guia.guia_uid );\n\n    select ( "returning" ).* into _conta\n      from lib.sets_up( _conta )\n    ;\n\n    \n    -- Caso necessairio lançar o deposito viculado a conta\n    if coalesce( _deposito.deposito_montantemoeda, 0.0 ) > 0 then\n      \n      _montante_amortizacao  := _deposito.deposito_montantemoeda * _cambio.cambio_taxa;\n      if _montante_amortizacao > _conta.conta_montante and _conta._tgrupo_id != _const.maguita_tgrupo_ccorrente then\n        _deposito_montantetroco := _montante_amortizacao - _conta.conta_montante;\n      end if;\n\n      _deposito_montantetroco := coalesce( _deposito_montantetroco, _deposito.deposito_montantetroco, 0.0 );\n\n      _res := tweeks.funct_pos_reg_deposito(( args->'deposito' ) || jsonb_build_object(\n          'arg_espaco_auth', arg_espaco_auth,\n          'arg_colaborador_id', arg_colaborador_id,\n          'arg_balance_accounts', false,\n          'deposito_cliente_id', _conta.conta_cliente_id,\n          'deposito_montantetroco', _deposito_montantetroco,\n          '_tgrupo_id', _conta._tgrupo_id,\n          'deposito_referencia', jsonb_build_object( 'conta_id', _conta.conta_id ), -- Vincula o deposito a conta\n          'deposito_documento', _conta.conta_numerofatura,\n          'deposito_serie', _conta.conta_serie,\n          'deposito_serie_id', _conta.conta_serie_id,\n          '_raise', true -- Criar exception para comportamentos indesejados\n        ));\n      \n      if not _res.result then\n        perform lib.result_exception(\n            _res.message,\n            detail := _res.data::text,\n            hint := _res.error::text\n          );\n      else\n        _deposito := jsonb_populate_record( null::tweeks.deposito, _res.data->'deposito' );\n      end if;\n    end if;\n\n    return lib.res_true(\n        message := '@tweeks.conta.invoice-closed-success',\n        data := jsonb_build_object(\n            'guia', _guia,\n            'conta', tweeks._get_conta( _conta.conta_id ),\n            'fatura', _conta.conta_numerofatura,\n            'recibo', _deposito.deposito_documento\n          )\n      );\n  end;\n$$;\n\ncreate or replace function tweeks.funct_pos_reg_deposito(args jsonb) returns lib.res\n  language plpgsql\nas\n$$\ndeclare\n  /** Essa função serve para registar uma nova amortizacao\n    args := {\n      arg_espaco_auth: ID,\n      arg_colaborador_id: ID,\n\n      deposito_montantetroco: TROCO*\n      deposito_caixa_id: UID,\n      deposito_tpaga_id: ID,\n      deposito_currency_id: UID,\n      deposito_posto_id: UID,\n      deposito_cliente_id: UID,\n      deposito_referencia: {conta_id}\n      deposito_montantemoeda: MONTANTE,\n      deposito_data: DATA,\n      deposito_observacao: OBS?\n      deposito_documento: DOC?\n      deposito_docref: NUMERO DOC?,\n      _tgrupo_id\n    }\n  */\n  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n\n  _deposito tweeks.deposito;\n  _posto tweeks.posto;\n  _const map.constant;\n  _cambio record;\n  _caixa tweeks.caixa;\n  _raise bool;\n  _rec record;\n\nbegin\n\n  _raise := args->>'_raise';\n\n  _const := map.constant();\n  _deposito := jsonb_populate_record( _deposito, args );\n\n\n  if _deposito.deposito_posto_id is not null then\n    _posto := tweeks._get_posto( _deposito.deposito_posto_id );\n  end if;\n\n  if _deposito.deposito_caixa_id is not null then\n    _caixa := tweeks._get_caixa( _deposito.deposito_caixa_id );\n    if _caixa.caixa_estado != _const.maguita_caixa_estado_ativo and _raise then\n      raise exception 'Não pode registar um deposito numa caixa fechado!';\n    elseif _caixa.caixa_estado != _const.maguita_caixa_estado_ativo then\n      return lib.res_false( 'Não pode registar um deposito numa caixa fechado!' );\n    end if;\n  end if;\n  _deposito.deposito_data := coalesce( _deposito.deposito_data, current_date );\n  _deposito.deposito_colaborador_id := arg_colaborador_id;\n  _deposito.deposito_espaco_auth := arg_espaco_auth;\n\n  select * into _cambio from tweeks.__load_cambio_day(\n    arg_espaco_auth,\n    _deposito.deposito_currency_id,\n    current_date,\n    _const\n  );\n\n  if _cambio.cambio_id is null and _raise then\n    raise exception '@tweeks.conta.cambio-not-found';\n  elseif _cambio.cambio_id is null then\n    return lib.res_false( 'Câmbio não foi encontrado!' );\n  end if;\n\n  _deposito.deposito_montante := _deposito.deposito_montantemoeda * _cambio.cambio_taxa;\n\n  if coalesce( _deposito.deposito_montantetroco, 0.0 ) >= _deposito.deposito_montante and _raise then\n    raise exception 'O montante de troco tem que ser inferior a montante cambiado!';\n  elsif coalesce( _deposito.deposito_montantetroco, 0.0 ) >= _deposito.deposito_montante then\n    return lib.res_false( 'O montante de troco tem que ser inferior a montante cambiado!' );\n  end if;\n\n  if _deposito.deposito_referencia is null or _deposito.deposito_documento is null then\n    _rec := tweeks.__sets_generate_documento( arg_espaco_auth, 3 /* Recibo*/ );\n    _deposito.deposito_documento := _rec.document;\n    _deposito.deposito_serie := to_json( _rec );\n    _deposito.deposito_serie_id := _rec.serie_id;\n  end if;\n\n--     if _deposito.deposito_referencia is null then\n--         _deposito.deposito_documento := tweeks.__sets_generate_documento( arg_espaco_auth, 2 /*Fatura Recibo */  );\n--     else\n--         _deposito.deposito_documento := tweeks.__sets_generate_documento( arg_espaco_auth, 3 /* Recibo*/ );\n--     end if;\n--   --_deposito.deposito_documento := tweeks.__generate_deposito_serie( arg_espaco_auth );\n\n  select ( "returning" ).* into _deposito\n    from lib.sets( _deposito )\n  ;\n\n  return lib.res_true(\n    jsonb_build_object(\n      'deposito', _deposito\n    )\n  );\nend;\n$$;\n\ncreate or replace function tweeks.funct_pos_load_conta_data(filter jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n    /**\n      Essa função devolve uma mesa juntamente com as conta associada que ainda esta aberta\n      filter := {\n        with_client:boolean\n        arg_posto_id: ID\n        arg_espaco_auth: ID\n        arg_colaborador_id: ID\n        arg_conta_id: ID\n      }\n     */\n\n--     arg_posto_id uuid  not null default filter->>'arg_posto_id';\n    arg_espaco_auth uuid  not null default filter->>'arg_espaco_auth';\n    arg_conta_id uuid not null default filter->>'arg_conta_id';\n    arg_colaborador_id uuid default filter->>'arg_colaborador_id';\n    _with_client boolean default filter->>'with_client';\n\n    _const map.constant;\n    _client jsonb;\n    _conta tweeks.conta;\n    ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\nbegin\n\n  _const := map.constant();\n\n  if _with_client then\n    select to_jsonb( c ) into _client\n      from cliente c\n        inner join tweeks.conta ct on c.cliente_id = ct.conta_cliente_id\n      where ct.conta_id = arg_conta_id\n    ;\n  end if;\n\n  if _client is null then\n    _client := jsonb_build_object();\n  end if;\n\n  select * into _conta\n    from tweeks.conta ct\n    where ct.conta_id = arg_conta_id\n  ;\n\n  return query with\n    __venda as (\n      select\n        v.venda_id,\n        v.venda_conta_id,\n        v.venda_venda_id,\n        v.venda_quantidade,\n        v.venda_custoquantidade,\n        v.venda_custounitario,\n        v.venda_montante,\n        v.venda_montantesemimposto,\n        v.venda_montantecomimposto,\n        v.venda_montantetotal,\n        v.venda_imposto,\n        v.venda_impostoadicionar,\n        v.venda_impostoretirar,\n        v.venda_montanteagregado,\n        v.venda_isencao,\n        v.venda_estado,\n        v.venda_estadopreparacao,\n        v.venda_metadata,\n        v.venda_descricao,\n        v.venda_validade,\n        v.venda_editado,\n        v.venda_taxas,\n        v.venda_lote,\n        a.artigo_id,\n        a.artigo_nome,\n        a.artigo_codigo,\n        a.artigo_compostoquantidade,\n        a.artigo_artigo_id,\n        u.unit_id,\n        u.unit_code,\n        u.unit_name,\n        tx.taxa_percentagem,\n        tx.taxa_taxa,\n        tip.tipoimposto_id,\n        tip.tipoimposto_codigo,\n        tip.tipoimposto_nome\n      from tweeks.venda v\n        inner join tweeks.artigo a on v.venda_artigo_id = a.artigo_id\n        left join tweeks.taxa tx on tx.taxa_id = any ( v.venda_taxas )\n        left join tweeks.tipoimposto tip on tx.taxa_tipoimposto_id = tip.tipoimposto_id\n        left join tweeks.unit u on a.artigo_unit_id = u.unit_id\n      where v._branch_uid = ___branch\n        and v.venda_estado in (\n           _const.maguita_venda_estado_aberto,\n           _const.maguita_venda_estado_fechado\n        )\n    ), __venda_group as (\n      select\n          v.venda_id as _venda_id,\n          v.venda_conta_id as _venda_conta_id,\n          coalesce( array_agg( vi order by vi.artigo_nome ) filter ( where vi.venda_id is not null ),\n            array[]::record[]\n          ) as venda_itens\n        from  tweeks.venda v\n          inner join tweeks.artigo a on v.venda_artigo_id = a.artigo_id\n          left join __venda vi on v.venda_id = vi.venda_venda_id\n        where v.venda_estado in ( _const.maguita_venda_estado_aberto,  _const.maguita_venda_estado_fechado )\n          and v.venda_venda_id is null\n          and v.venda_conta_id = arg_conta_id\n          and v.venda_estado in (\n            _const.maguita_venda_estado_aberto,\n            _const.maguita_venda_estado_fechado\n          )\n        group by v.venda_id, a.artigo_id\n    ), __conta as (\n      select\n          c.conta_id,\n          c.conta_numero,\n          c.conta_numerofatura,\n          c.conta_montante,\n          c.conta_mesa,\n          c.conta_estado,\n          c.conta_serie,\n          c.conta_observacao,\n          c.conta_extension,\n          c.conta_props,\n          c.conta_serie_id,\n          c._tgrupo_id,\n          c.conta_data,\n          c.conta_dataregistro,\n          c.conta_conta_docorigin,\n          c.conta_titular,\n          c.conta_titularnif,\n          ccl.cliente_id,\n          ccl.cliente_code,\n          ccl.cliente_nif,\n          ccl.cliente_titular,\n          ccl.cliente_metadata,\n          de.deposito_montante,\n          de.deposito_montantetroco,\n          de.deposito_montantefinal,\n          de.deposito_montantemoeda,\n          de.deposito_tpaga_id,\n          corigen.conta_numerofatura as conta_documentoorigem,\n          array_agg( to_jsonb( v )||to_jsonb( vg ) order by v.artigo_nome ) as conta_vendas\n        from tweeks.conta c\n          left join tweeks.cliente ccl on c.conta_cliente_id = ccl.cliente_id\n          left join tweeks.conta corigen on c.conta_conta_docorigin = corigen.conta_id\n          left join __venda_group vg on c.conta_id = vg._venda_conta_id\n          left join __venda v on vg._venda_id = v.venda_id\n          left join tweeks.deposito de on c.conta_id = (de.deposito_referencia->>'conta_id')::uuid\n        where c.conta_id = arg_conta_id\n          and c._branch_uid = ___branch\n        group by c.conta_id, \n          de.deposito_id,\n          ccl.cliente_id,\n          corigen.conta_id\n     ) select to_jsonb( c ) || _client from __conta c\n  ;\n\n  if _conta._tgrupo_id = _const.maguita_tgrupo_cnormal then\n    return query\n      with __deposito as (\n        select\n            de.deposito_id,\n            de.deposito_montante,\n            de.deposito_montantemoeda,\n            de.deposito_montantetroco,\n            de.deposito_montantefinal,\n            de.deposito_taxacambio,\n            cu.currency_code,\n            cu.currency_id,\n            cu.currency_name,\n            tp.tpaga_id,\n            tp.tpaga_designacao,\n            p.posto_designacao,\n            p.posto_id,\n            cx.caixa_id\n          from tweeks.deposito de\n            inner join geoinfo.currency cu on de.deposito_currency_id = cu.currency_id\n            inner join tweeks.tpaga tp on de.deposito_tpaga_id = tp.tpaga_id\n            left join tweeks.caixa cx on de.deposito_caixa_id = cx.caixa_id\n            left join tweeks.posto p on cx.caixa_posto_id = p.posto_id\n          where (de.deposito_referencia->>'conta_id')::uuid = _conta.conta_id\n            and de._branch_uid = ___branch\n      ) select to_jsonb( _de )\n          from __deposito _de\n    ;\n  end if;\nend\n$$;\n\n\ncreate or replace function tweeks.funct_load_artigo(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n    /**\n        Essa função serve para carregar os artigos registrado\n        args := {\n          arg_espaco_auth: ID\n          arg_colaborador_id: ID\n          arg_classe_id: ID\n          arg_artigo_estado: ARTIGO_ESTADO\n          query: {\n            any?: CODE|NAME|DESCRICAO\n            code?: CODE\n            name?: NAME\n            desc?: DESCRICAO\n          }\n        }\n   */\n    arg_espaco_auth uuid default args->>'arg_espaco_auth';\n    arg_colaborador_id uuid default args->>'arg_colaborador_id';\n    arg_espaco_childs uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth );\n    arg_classe_id uuid default args->>'arg_classe_id';\n    arg_artigo_estado int2 default args->>'arg_artigo_estado';\n\n    _query_any text  default lower( args->'query'->>'any' );\n    _query_code text default lower( args->'query'->>'code' );\n    _query_name text default lower( args->'query'->>'name' );\n    _query_desc text default lower( args->'query'->>'desc' );\n    _const map.constant;\n    _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\nbegin\n    _const := map.constant();\n\n    /**\n      ID, NOME, STOCK, PRECO, [STOK-MINIMO], FOTO\n     */\n    return query\n        with\n          __stock as (\n            select\n                fluxo_artigo_id as stock_artigo_id,\n                fluxo_espaco_id as stock_espaco_id,\n                fluxo_resultado as stock_quantidade\n              from tweeks.__fluxo_scan(\n                _branch := _branch,\n                _espaco_id := arg_espaco_auth,\n                _resume := true\n              )\n          ), __artigo as (\n            select\n                art.artigo_id,\n                art.artigo_codigo,\n                art.artigo_descricao,\n                art.artigo_nome,\n                art.artigo_compostoquantidade,\n                art.artigo_artigo_id,\n\n                art.artigo_espaco_auth = any( arg_espaco_childs ) as artigo_owner,\n                coalesce( s.stock_quantidade, 0 ) as stock_quantidade,\n                art.artigo_foto,\n                art.artigo_espaco_auth,\n                art.artigo_classe_id,\n                art.artigo_estado,\n                art.artigo_stocknegativo,\n                art.artigo_codigoimposto,\n                origin.artigo_id as origin_id,\n                origin.artigo_codigo as origin_codigo,\n                origin.artigo_descricao as orign_descricao,\n                origin.artigo_nome as origin_nome,\n                origin.artigo_compostoquantidade as orign_compostoquantidade,\n                origin.artigo_artigo_id as origin_origin_id,\n\n                coalesce( array_agg( l.link_espaco_destino ) filter ( where l.link_id is not null ), array[]::uuid[] )  as links,\n                ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'precario_custo' as precario_custo,\n                ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'precario_quantidade' as precario_quantidade,\n                ( ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'stock_minimo' )::double precision as link_stockminimo\n              from tweeks.artigo art\n                left join tweeks.artigo origin on art.artigo_artigo_id = origin.artigo_id\n                left join tweeks.link l on l.link_estado = _const.maguita_link_estado_ativo\n                  and l.link_referencia = rule.artigo_referencia( art.artigo_id )\n                  and l.link_espaco_destino = any( arg_espaco_childs )\n                  and l.link_tlink_id = _const.maguita_tlink_preco\n                  and l._branch_uid = _branch\n                left join __stock s on art.artigo_id = s.stock_artigo_id and s.stock_espaco_id = arg_espaco_auth\n              where art._branch_uid = _branch\n              group by art.artigo_id,\n                 origin.artigo_id,\n                s.stock_quantidade\n          ), __filter as (\n            select *,\n                coalesce( art.link_stockminimo ) as stock_minimo\n              from __artigo art\n              where ( coalesce( art.links, array[]::uuid[] )||art.artigo_espaco_auth ) && arg_espaco_childs\n                and art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id )\n                and art.artigo_estado = coalesce( arg_artigo_estado, art.artigo_estado )\n         ), __filter_query as (\n            select *\n            from __filter f\n            where arg_classe_id is not null or f.artigo_classe_id != _const.classe_itemextra\n            order by\n              case\n                when f.artigo_estado = _const.artigo_estado_ativo then 1\n                else 2\n              end,\n              case\n                when f.artigo_espaco_auth = arg_espaco_auth then 1\n                when f.artigo_espaco_auth = any( arg_espaco_childs ) then 2\n                else 3\n              end,\n              case\n                when stock_quantidade < f.stock_minimo then 1\n                when stock_quantidade = f.stock_minimo then 2\n                else 3\n               end,\n               f.artigo_nome\n           ), __query as (\n             select *\n                from __filter_query _f\n                where true\n                  and lower( _f.artigo_codigo ) = lower( coalesce( _query_code, _f.artigo_codigo ) )\n                  and lower( _f.artigo_nome ) like lower( format( '%%%s%%', coalesce( _query_name, _f.artigo_nome ) ) )\n                  and lower( coalesce( _f.artigo_descricao, '' ) ) like lower( format( '%%%s%%', coalesce( _query_desc, _f.artigo_descricao ) ) )\n                  and (\n                    lower( _f.artigo_codigo ) = lower( coalesce( _query_any, _f.artigo_codigo ) )\n                    or lower( _f.artigo_nome) like lower( format( '%%%s%%', coalesce( _query_any, _f.artigo_nome ) ) )\n                    or lower( coalesce( _f.artigo_descricao, '' ) ) like lower( format( '%%%s%%', coalesce( _query_any, _f.artigo_descricao, '' ) ))\n                  )\n          ) select to_jsonb( _q ) - 'links'\n              from __query _q\n    ;\nend\n$$;\n	create or replace function tweeks.funct_pos_change_conta_fechar(args jsonb) returns lib.res language plpgsql as $$ declare /** Essa função fecha uma nova conta arg = { arg_espaco_auth: ID, arg_colaborador_id: ID, arg_tserie_id: ID, deposito:{ deposito_cliente_id deposito_caixa_id deposito_tpaga_id deposito_currency_id deposito_posto_id deposito_montantemoeda deposito_montantetroco deposito_data deposito_docref: DOCUMENTO-REF? deposito_observacao: OBSERVACAO? } conta_id: ID, conta_extension: {} | { reserva_id: UID } conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM }, conta_posto_id: ID, conta_desconto conta_titular: NOME-CLIENTE conta_titularnif: VARCHAR, conta_data: DATA, conta_cliente_id, //Relativos a GUIA guia_documentoperacao: CODIGO, guia_dataopeacao: DATA, guia_observacao: DESCRICAO guia_metadata: { ... any extras data } custos:[{ custoguia_montante: MONTANTE, custoguia_descricao: DESCRICAO PARA O CUSTO custoguia_tcusto_id: 1 - DESPESA | 2 - RECEITA }] } */ arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_tserie_id int2 default args->>'arg_tserie_id'; arg_conta_id uuid default args->>'conta_id'; arg_caixa_id uuid default args->>'de_caixa_id'; _deposito_montantetroco double precision; _conta tweeks.conta; _const map.constant; _caixa tweeks.caixa; _res lib.res; _cambio record; _montante_amortizacao double precision; _deposito tweeks.deposito; _rec record; _guia tweeks.guia; _message text; begin _const := map.constant(); _caixa := tweeks._get_caixa( arg_caixa_id ); _conta := tweeks._get_conta( arg_conta_id ); _conta := jsonb_populate_record( _conta, args ); _conta.conta_data := coalesce( _conta.conta_data, current_date ); _deposito := jsonb_populate_record( _deposito, args->'deposito' ); _message := tweeks.__check_conta_data( _tserie_id := arg_tserie_id, _conta_data := _conta.conta_data, _raise := false ); if _message is not null then return lib.res_false( _message ); end if; if _conta.conta_id is null then raise exception '%', 'Identificador da conta a ser fechada não foi informado!'; end if; if _conta.conta_estado = _const.maguita_conta_estado_fechado then return lib.res_false( 'Essa conta já se encontra fechada!' ); end if; if arg_tserie_id not in ( _const.maguita_tserie_fatura, _const.maguita_tserie_faturarecibo, _const.maguita_tserie_guiasaida, _const.maguita_tserie_notacredito ) then return lib.res_false( 'Não pode fechar a conta o com tipo de serie selecionada!' ); end if; if _conta.conta_posto_fecho is null then return lib.res_false( 'Necessario indicar o posto de fecho!' ); end if; -- Na fatura recibo não pode haver conta corrente if arg_tserie_id = _const.maguita_tserie_faturarecibo and _deposito.deposito_montantemoeda is null then return lib.res_false( 'O pagamento para as faturas/recibo é obrigatorio!' ); end if; -- Os cliente finais só podem receber fatura/recibo ou nota de credito if true in ( _conta.conta_cliente_id is null, _conta.conta_cliente_id = lib.to_uuid( 1 ) -- cliente final ) and arg_tserie_id not in ( _const.maguita_tserie_faturarecibo ) then return lib.res_false( 'Só pode lançar nos cliente finais as futuras/recibos!'); end if; -- Quando hover necessidade de efetuar o deposito então, deve-se obter a taxa de cambio para o dia if arg_tserie_id = _const.maguita_tserie_faturarecibo or _deposito.deposito_montantemoeda is not null then if _deposito.deposito_tpaga_id = _const.maguita_tpaga_contacorrente then return lib.res_false( 'Tipo de pagamento invalido' ); end if; -- Obter o cambio para a moeda selecionada select * into _cambio from tweeks.__load_cambio_day( arg_espaco_auth, _deposito.deposito_currency_id, _conta.conta_data, _const ); if _cambio.cambio_id is null then return lib.res_false( 'Câmbio não foi encontrado!' ); end if; end if; -- O valor do deposito nas conta de fatura/recibo deve ser o suficiente para cobrir o montante da fatura if arg_tserie_id = _const.maguita_tserie_faturarecibo then if round( ( _cambio.cambio_taxa * _deposito.deposito_montantemoeda)::numeric, _const.money_round ) < round( _conta.conta_montante::numeric, _const.money_round ) then return lib.res_false( 'Montante para pagamento insuficiente' ); end if; -- Se for para amortizar a conta a caixa tem que estar aberta if _caixa.caixa_estado != _const.maguita_caixa_estado_ativo then return lib.res_false( 'Pagamento rejeitado!' ); end if; end if; -- Definir em aqual conta a fatura deve ser enviado _conta._tgrupo_id := case when arg_tserie_id = _const.maguita_tserie_faturarecibo then _const.maguita_tgrupo_cnormal when arg_tserie_id = _const.maguita_tserie_fatura then _const.maguita_tgrupo_ccorrente when arg_tserie_id = _const.maguita_tserie_guiasaida then _const.maguita_tgrupo_ccorrente when arg_tserie_id = _const.maguita_tserie_notacredito then _const.maguita_tgrupo_ccorrente end; -- Gerar a serie para a conta dependento do tipo do documento (fatura, faturarecibo, notacredito, guiasaida) _rec := tweeks.__sets_generate_documento( arg_espaco_auth, arg_tserie_id ); _conta.conta_numerofatura := _rec.document; _conta.conta_serie := to_json( _rec ); _conta.conta_serie_id = _rec.serie_id; _conta.conta_estado := _const.maguita_conta_estado_fechado; _conta.conta_imprensa := 1; _conta.conta_colaborador_fecho := arg_colaborador_id; _conta.conta_datafecho := current_timestamp; _conta.conta_cliente_id := coalesce( _conta.conta_cliente_id, lib.to_uuid( 1 ) ); -- Gerar a Guia de saida _guia := jsonb_populate_record( _guia, args ); _guia.guia_tguia_id := _const.maguita_tguia_saida; _guia.guia_espaco_saida := arg_espaco_auth; _guia.guia_toperacao_id := _const.maguita_toperacao_venda; _guia.guia_refclass := cluster.__format( 'tweeks.conta'::regclass ); _guia.guia_refuid := _conta.conta_id; _guia.guia_refs := jsonb_build_object( 'cliente', jsonb_build_object( 'cliente_id', _conta.conta_cliente_id ), 'saida', jsonb_build_object( 'espaco_id', _conta.conta_espaco_auth ) ); _guia := tweeks.funct_sets_guia( jsonb_build_object( 'guia', _guia, 'custoguia', args->'custos', 'arg_colaborador_id', arg_colaborador_id, 'arg_espaco_auth', arg_espaco_auth )); -- Vicular a informaçao de guia na conta extension com a tag guia_id _conta.conta_extension := coalesce( _conta.conta_extension, jsonb_build_object() ) || jsonb_build_object( 'guia_id', _guia.guia_uid ); select ( "returning" ).* into _conta from lib.sets_up( _conta ) ; -- Caso necessairio lançar o deposito viculado a conta if coalesce( _deposito.deposito_montantemoeda, 0.0 ) > 0 then _montante_amortizacao := _deposito.deposito_montantemoeda * _cambio.cambio_taxa; if _montante_amortizacao > _conta.conta_montante and _conta._tgrupo_id != _const.maguita_tgrupo_ccorrente then _deposito_montantetroco := _montante_amortizacao - _conta.conta_montante; end if; _deposito_montantetroco := coalesce( _deposito_montantetroco, _deposito.deposito_montantetroco, 0.0 ); _res := tweeks.funct_pos_reg_deposito(( args->'deposito' ) || jsonb_build_object( 'arg_espaco_auth', arg_espaco_auth, 'arg_colaborador_id', arg_colaborador_id, 'arg_balance_accounts', false, 'deposito_cliente_id', _conta.conta_cliente_id, 'deposito_montantetroco', _deposito_montantetroco, '_tgrupo_id', _conta._tgrupo_id, 'deposito_referencia', jsonb_build_object( 'conta_id', _conta.conta_id ), -- Vincula o deposito a conta 'deposito_documento', _conta.conta_numerofatura, 'deposito_serie', _conta.conta_serie, 'deposito_serie_id', _conta.conta_serie_id, '_raise', true -- Criar exception para comportamentos indesejados )); if not _res.result then perform lib.result_exception( _res.message, detail := _res.data::text, hint := _res.error::text ); else _deposito := jsonb_populate_record( null::tweeks.deposito, _res.data->'deposito' ); end if; end if; return lib.res_true( message := '@tweeks.conta.invoice-closed-success', data := jsonb_build_object( 'guia', _guia, 'conta', tweeks._get_conta( _conta.conta_id ), 'fatura', _conta.conta_numerofatura, 'recibo', _deposito.deposito_documento ) ); end; $$; create or replace function tweeks.funct_pos_reg_deposito(args jsonb) returns lib.res language plpgsql as $$ declare /** Essa função serve para registar uma nova amortizacao args := { arg_espaco_auth: ID, arg_colaborador_id: ID, deposito_montantetroco: TROCO* deposito_caixa_id: UID, deposito_tpaga_id: ID, deposito_currency_id: UID, deposito_posto_id: UID, deposito_cliente_id: UID, deposito_referencia: {conta_id} deposito_montantemoeda: MONTANTE, deposito_data: DATA, deposito_observacao: OBS? deposito_documento: DOC? deposito_docref: NUMERO DOC?, _tgrupo_id } */ arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; _deposito tweeks.deposito; _posto tweeks.posto; _const map.constant; _cambio record; _caixa tweeks.caixa; _raise bool; _rec record; begin _raise := args->>'_raise'; _const := map.constant(); _deposito := jsonb_populate_record( _deposito, args ); if _deposito.deposito_posto_id is not null then _posto := tweeks._get_posto( _deposito.deposito_posto_id ); end if; if _deposito.deposito_caixa_id is not null then _caixa := tweeks._get_caixa( _deposito.deposito_caixa_id ); if _caixa.caixa_estado != _const.maguita_caixa_estado_ativo and _raise then raise exception 'Não pode registar um deposito numa caixa fechado!'; elseif _caixa.caixa_estado != _const.maguita_caixa_estado_ativo then return lib.res_false( 'Não pode registar um deposito numa caixa fechado!' ); end if; end if; _deposito.deposito_data := coalesce( _deposito.deposito_data, current_date ); _deposito.deposito_colaborador_id := arg_colaborador_id; _deposito.deposito_espaco_auth := arg_espaco_auth; select * into _cambio from tweeks.__load_cambio_day( arg_espaco_auth, _deposito.deposito_currency_id, current_date, _const ); if _cambio.cambio_id is null and _raise then raise exception '@tweeks.conta.cambio-not-found'; elseif _cambio.cambio_id is null then return lib.res_false( 'Câmbio não foi encontrado!' ); end if; _deposito.deposito_montante := _deposito.deposito_montantemoeda * _cambio.cambio_taxa; if coalesce( _deposito.deposito_montantetroco, 0.0 ) >= _deposito.deposito_montante and _raise then raise exception 'O montante de troco tem que ser inferior a montante cambiado!'; elsif coalesce( _deposito.deposito_montantetroco, 0.0 ) >= _deposito.deposito_montante then return lib.res_false( 'O montante de troco tem que ser inferior a montante cambiado!' ); end if; if _deposito.deposito_referencia is null or _deposito.deposito_documento is null then _rec := tweeks.__sets_generate_documento( arg_espaco_auth, 3 /* Recibo*/ ); _deposito.deposito_documento := _rec.document; _deposito.deposito_serie := to_json( _rec ); _deposito.deposito_serie_id := _rec.serie_id; end if; -- if _deposito.deposito_referencia is null then -- _deposito.deposito_documento := tweeks.__sets_generate_documento( arg_espaco_auth, 2 /*Fatura Recibo */ ); -- else -- _deposito.deposito_documento := tweeks.__sets_generate_documento( arg_espaco_auth, 3 /* Recibo*/ ); -- end if; -- --_deposito.deposito_documento := tweeks.__generate_deposito_serie( arg_espaco_auth ); select ( "returning" ).* into _deposito from lib.sets( _deposito ) ; return lib.res_true( jsonb_build_object( 'deposito', _deposito ) ); end; $$; create or replace function tweeks.funct_pos_load_conta_data(filter jsonb) returns SETOF jsonb language plpgsql as $$ declare /** Essa função devolve uma mesa juntamente com as conta associada que ainda esta aberta filter := { with_client:boolean arg_posto_id: ID arg_espaco_auth: ID arg_colaborador_id: ID arg_conta_id: ID } */ -- arg_posto_id uuid not null default filter->>'arg_posto_id'; arg_espaco_auth uuid not null default filter->>'arg_espaco_auth'; arg_conta_id uuid not null default filter->>'arg_conta_id'; arg_colaborador_id uuid default filter->>'arg_colaborador_id'; _with_client boolean default filter->>'with_client'; _const map.constant; _client jsonb; _conta tweeks.conta; ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); begin _const := map.constant(); if _with_client then select to_jsonb( c ) into _client from cliente c inner join tweeks.conta ct on c.cliente_id = ct.conta_cliente_id where ct.conta_id = arg_conta_id ; end if; if _client is null then _client := jsonb_build_object(); end if; select * into _conta from tweeks.conta ct where ct.conta_id = arg_conta_id ; return query with __venda as ( select v.venda_id, v.venda_conta_id, v.venda_venda_id, v.venda_quantidade, v.venda_custoquantidade, v.venda_custounitario, v.venda_montante, v.venda_montantesemimposto, v.venda_montantecomimposto, v.venda_montantetotal, v.venda_imposto, v.venda_impostoadicionar, v.venda_impostoretirar, v.venda_montanteagregado, v.venda_isencao, v.venda_estado, v.venda_estadopreparacao, v.venda_metadata, v.venda_descricao, v.venda_validade, v.venda_editado, v.venda_taxas, v.venda_lote, a.artigo_id, a.artigo_nome, a.artigo_codigo, a.artigo_compostoquantidade, a.artigo_artigo_id, u.unit_id, u.unit_code, u.unit_name, tx.taxa_percentagem, tx.taxa_taxa, tip.tipoimposto_id, tip.tipoimposto_codigo, tip.tipoimposto_nome from tweeks.venda v inner join tweeks.artigo a on v.venda_artigo_id = a.artigo_id left join tweeks.taxa tx on tx.taxa_id = any ( v.venda_taxas ) left join tweeks.tipoimposto tip on tx.taxa_tipoimposto_id = tip.tipoimposto_id left join tweeks.unit u on a.artigo_unit_id = u.unit_id where v._branch_uid = ___branch and v.venda_estado in ( _const.maguita_venda_estado_aberto, _const.maguita_venda_estado_fechado ) ), __venda_group as ( select v.venda_id as _venda_id, v.venda_conta_id as _venda_conta_id, coalesce( array_agg( vi order by vi.artigo_nome ) filter ( where vi.venda_id is not null ), array[]::record[] ) as venda_itens from tweeks.venda v inner join tweeks.artigo a on v.venda_artigo_id = a.artigo_id left join __venda vi on v.venda_id = vi.venda_venda_id where v.venda_estado in ( _const.maguita_venda_estado_aberto, _const.maguita_venda_estado_fechado ) and v.venda_venda_id is null and v.venda_conta_id = arg_conta_id and v.venda_estado in ( _const.maguita_venda_estado_aberto, _const.maguita_venda_estado_fechado ) group by v.venda_id, a.artigo_id ), __conta as ( select c.conta_id, c.conta_numero, c.conta_numerofatura, c.conta_montante, c.conta_mesa, c.conta_estado, c.conta_serie, c.conta_observacao, c.conta_extension, c.conta_props, c.conta_serie_id, c._tgrupo_id, c.conta_data, c.conta_dataregistro, c.conta_conta_docorigin, c.conta_titular, c.conta_titularnif, ccl.cliente_id, ccl.cliente_code, ccl.cliente_nif, ccl.cliente_titular, ccl.cliente_metadata, de.deposito_montante, de.deposito_montantetroco, de.deposito_montantefinal, de.deposito_montantemoeda, de.deposito_tpaga_id, corigen.conta_numerofatura as conta_documentoorigem, array_agg( to_jsonb( v )||to_jsonb( vg ) order by v.artigo_nome ) as conta_vendas from tweeks.conta c left join tweeks.cliente ccl on c.conta_cliente_id = ccl.cliente_id left join tweeks.conta corigen on c.conta_conta_docorigin = corigen.conta_id left join __venda_group vg on c.conta_id = vg._venda_conta_id left join __venda v on vg._venda_id = v.venda_id left join tweeks.deposito de on c.conta_id = (de.deposito_referencia->>'conta_id')::uuid where c.conta_id = arg_conta_id and c._branch_uid = ___branch group by c.conta_id, de.deposito_id, ccl.cliente_id, corigen.conta_id ) select to_jsonb( c ) || _client from __conta c ; if _conta._tgrupo_id = _const.maguita_tgrupo_cnormal then return query with __deposito as ( select de.deposito_id, de.deposito_montante, de.deposito_montantemoeda, de.deposito_montantetroco, de.deposito_montantefinal, de.deposito_taxacambio, cu.currency_code, cu.currency_id, cu.currency_name, tp.tpaga_id, tp.tpaga_designacao, p.posto_designacao, p.posto_id, cx.caixa_id from tweeks.deposito de inner join geoinfo.currency cu on de.deposito_currency_id = cu.currency_id inner join tweeks.tpaga tp on de.deposito_tpaga_id = tp.tpaga_id left join tweeks.caixa cx on de.deposito_caixa_id = cx.caixa_id left join tweeks.posto p on cx.caixa_posto_id = p.posto_id where (de.deposito_referencia->>'conta_id')::uuid = _conta.conta_id and de._branch_uid = ___branch ) select to_jsonb( _de ) from __deposito _de ; end if; end $$; create or replace function tweeks.funct_load_artigo(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** Essa função serve para carregar os artigos registrado args := { arg_espaco_auth: ID arg_colaborador_id: ID arg_classe_id: ID arg_artigo_estado: ARTIGO_ESTADO query: { any?: CODE|NAME|DESCRICAO code?: CODE name?: NAME desc?: DESCRICAO } } */ arg_espaco_auth uuid default args->>'arg_espaco_auth'; arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_espaco_childs uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth ); arg_classe_id uuid default args->>'arg_classe_id'; arg_artigo_estado int2 default args->>'arg_artigo_estado'; _query_any text default lower( args->'query'->>'any' ); _query_code text default lower( args->'query'->>'code' ); _query_name text default lower( args->'query'->>'name' ); _query_desc text default lower( args->'query'->>'desc' ); _const map.constant; _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); begin _const := map.constant(); /** ID, NOME, STOCK, PRECO, [STOK-MINIMO], FOTO */ return query with __stock as ( select fluxo_artigo_id as stock_artigo_id, fluxo_espaco_id as stock_espaco_id, fluxo_resultado as stock_quantidade from tweeks.__fluxo_scan( _branch := _branch, _espaco_id := arg_espaco_auth, _resume := true ) ), __artigo as ( select art.artigo_id, art.artigo_codigo, art.artigo_descricao, art.artigo_nome, art.artigo_compostoquantidade, art.artigo_artigo_id, art.artigo_espaco_auth = any( arg_espaco_childs ) as artigo_owner, coalesce( s.stock_quantidade, 0 ) as stock_quantidade, art.artigo_foto, art.artigo_espaco_auth, art.artigo_classe_id, art.artigo_estado, art.artigo_stocknegativo, art.artigo_codigoimposto, origin.artigo_id as origin_id, origin.artigo_codigo as origin_codigo, origin.artigo_descricao as orign_descricao, origin.artigo_nome as origin_nome, origin.artigo_compostoquantidade as orign_compostoquantidade, origin.artigo_artigo_id as origin_origin_id, coalesce( array_agg( l.link_espaco_destino ) filter ( where l.link_id is not null ), array[]::uuid[] ) as links, ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'precario_custo' as precario_custo, ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'precario_quantidade' as precario_quantidade, ( ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'stock_minimo' )::double precision as link_stockminimo from tweeks.artigo art left join tweeks.artigo origin on art.artigo_artigo_id = origin.artigo_id left join tweeks.link l on l.link_estado = _const.maguita_link_estado_ativo and l.link_referencia = rule.artigo_referencia( art.artigo_id ) and l.link_espaco_destino = any( arg_espaco_childs ) and l.link_tlink_id = _const.maguita_tlink_preco and l._branch_uid = _branch left join __stock s on art.artigo_id = s.stock_artigo_id and s.stock_espaco_id = arg_espaco_auth where art._branch_uid = _branch group by art.artigo_id, origin.artigo_id, s.stock_quantidade ), __filter as ( select *, coalesce( art.link_stockminimo ) as stock_minimo from __artigo art where ( coalesce( art.links, array[]::uuid[] )||art.artigo_espaco_auth ) && arg_espaco_childs and art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id ) and art.artigo_estado = coalesce( arg_artigo_estado, art.artigo_estado ) ), __filter_query as ( select * from __filter f where arg_classe_id is not null or f.artigo_classe_id != _const.classe_itemextra order by case when f.artigo_estado = _const.artigo_estado_ativo then 1 else 2 end, case when f.artigo_espaco_auth = arg_espaco_auth then 1 when f.artigo_espaco_auth = any( arg_espaco_childs ) then 2 else 3 end, case when stock_quantidade < f.stock_minimo then 1 when stock_quantidade = f.stock_minimo then 2 else 3 end, f.artigo_nome ), __query as ( select * from __filter_query _f where true and lower( _f.artigo_codigo ) = lower( coalesce( _query_code, _f.artigo_codigo ) ) and lower( _f.artigo_nome ) like lower( format( '%%%s%%', coalesce( _query_name, _f.artigo_nome ) ) ) and lower( coalesce( _f.artigo_descricao, '' ) ) like lower( format( '%%%s%%', coalesce( _query_desc, _f.artigo_descricao ) ) ) and ( lower( _f.artigo_codigo ) = lower( coalesce( _query_any, _f.artigo_codigo ) ) or lower( _f.artigo_nome) like lower( format( '%%%s%%', coalesce( _query_any, _f.artigo_nome ) ) ) or lower( coalesce( _f.artigo_descricao, '' ) ) like lower( format( '%%%s%%', coalesce( _query_any, _f.artigo_descricao, '' ) )) ) ) select to_jsonb( _q ) - 'links' from __query _q ; end $$;
d7c975c5-0aad-4c86-b0f7-c9e00c2c2845	\nalter table tweeks.conta add column if not exists conta_conta_docorigin uuid default null;\nalter table tweeks.venda add column if not exists venda_venda_docorign uuid default null;\n\nalter table tweeks.conta drop constraint if exists fk_conta_to_conta_docorigin;\nalter table tweeks.venda drop constraint if exists fk_venda_to_venda_docorigin;\n\nalter table tweeks.conta add constraint fk_conta_to_conta_docorigin foreign key ( conta_conta_docorigin )\n  references tweeks.conta;\n\nalter table tweeks.venda add constraint fk_venda_to_venda_docorigin foreign key ( venda_venda_docorign )\n  references tweeks.venda\n	alter table tweeks.conta add column if not exists conta_conta_docorigin uuid default null; alter table tweeks.venda add column if not exists venda_venda_docorign uuid default null; alter table tweeks.conta drop constraint if exists fk_conta_to_conta_docorigin; alter table tweeks.venda drop constraint if exists fk_venda_to_venda_docorigin; alter table tweeks.conta add constraint fk_conta_to_conta_docorigin foreign key ( conta_conta_docorigin ) references tweeks.conta; alter table tweeks.venda add constraint fk_venda_to_venda_docorigin foreign key ( venda_venda_docorign ) references tweeks.venda
92e621ed-cc5a-4078-9785-94b4ba985242	\ncreate or replace function tweeks.funct_reg_conta_nota_credito(args jsonb) returns lib.res\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    args := {\n      conta_chave: CHAVE\n      arg_colaborador_id: UID\n      arg_espaco_auth: UID\n      conta_id: UID,\n      conta_data: DATE,\n      conta_posto_id: UID\n      conta_observacao\n      itens: [\n        { venda_id:ID },\n        { venda_id:ID },\n        { venda_id:ID }...\n      ]\n    }\n   */\n  arg_colaborador_id uuid default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid default args->>'arg_espaco_auth';\n  arg_conta_id uuid default args->>'conta_id';\n  arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  __branch cluster.branch;\n  _data record;\n  _vendas record;\n  _conta tweeks.conta;\n  _conta_args tweeks.conta;\n  _const map.constant;\n  _conta_res lib.res;\n  _conta_close_res lib.res;\n  itens uuid[] default array( select (e.doc->>'venda_id')::uuid from jsonb_array_elements( args->'itens' ) e ( doc ) );\nbegin\n  _const := map.constant();\n  _conta_args := jsonb_populate_record( _conta_args, args );\n  _conta_args.conta_posto_fecho := _conta_args.conta_posto_id;\n  _conta := tweeks._get_conta( arg_conta_id );\n\n  if _conta.conta_estado != _const.maguita_conta_estado_fechado then\n    return  lib.res_false( 'Essa conta não se encontra fechada' );\n  end if;\n\n\n  with conta_origin as (\n    select\n        ct.*,\n        ve.*,\n        art.*,\n        count( venc.venda_id ) > 0 as venda_ncexists\n      from tweeks.conta ct\n        inner join tweeks.venda ve on ct.conta_id = ve.venda_conta_id\n          and ve._branch_uid = arg_branch_uid\n          and ve.venda_estado = _const.maguita_venda_estado_fechado\n        left join tweeks.artigo art on ve.venda_artigo_id = art.artigo_id\n          and art._branch_uid = arg_branch_uid\n        left join tweeks.conta ctnc on ct.conta_id = ctnc.conta_conta_docorigin\n          and ctnc.conta_estado = _const.maguita_conta_estado_fechado\n          and ctnc._branch_uid = arg_branch_uid\n        left join tweeks.venda venc on ctnc.conta_id = ve.venda_conta_id\n          and venc.venda_venda_docorign = ve.venda_id\n          and venc.venda_estado = _const.maguita_venda_estado_fechado\n          and venc._branch_uid = arg_branch_uid\n      where ct.conta_id = arg_conta_id\n      group by ct.conta_id,\n        art.artigo_id,\n        ve.venda_id\n  ), notacareito_usar as (\n    select\n        count( * ) filter (\n          where not ct.venda_ncexists\n            and ct.venda_id = any ( itens )\n            and ct.venda_venda_id is null\n        ) as notacredito_aplicartotal,\n\n        array_agg( ct.venda_id ) filter (\n          where not ct.venda_ncexists\n            and ct.venda_id = any ( itens )\n            and ct.venda_venda_id is null\n        ) as notacredito_aplicar,\n\n        count( * ) filter (\n          where ct.venda_id = any ( itens )\n            and ct.venda_venda_id is null\n        ) as notacredito_usartotal,\n       array_agg(\n         jsonb_build_object(\n           'artigo_id', ct.artigo_id,\n           'artigo_codigo', ct.artigo_codigo,\n           'artigo_nome', ct.artigo_nome,\n           'venda_id', ct.venda_id,\n           'venda_quantidade', ct.venda_quantidade,\n           'venda_custounitario', ct.venda_custounitario\n         )\n       ) filter (\n         where ct.venda_ncexists\n           and ct.venda_id = any ( itens )\n           and ct.venda_venda_id is null\n       ) as notacredito_exists\n      from conta_origin ct\n  ) select * into _data\n     from notacareito_usar\n  ;\n\n  if _data.notacredito_aplicartotal = 0 then\n    return lib.res_false( 'Nenhum dos iten selecionado pode-se aplicar nota de credito sobre ele' );\n  end if;\n\n  if _data.notacredito_aplicartotal < _data.notacredito_usartotal then\n    return lib.res_false( 'Alguns dos itens selecionados já têm notas de creditos aplicado sobre ele',\n      jsonb_build_object(\n          'notacredito_exists', _data.notacredito_exists\n        )\n    );\n  end if;\n\n\n  /*\n    arg_vendas: [\n        {\n          venda_id?: UID,\n          venda_artigo_id: UID,\n          venda_quantidade: QUANT,\n          venda_custounitario: COST\n          venda_custoquantidade: COST\n\n          + venda_editado\n          + venda_isencao\n          + venda_montante\n          + venda_montanteagregado\n          + venda_montantetotal\n          + venda_imposto\n          + venda_montantesemimposto\n          + venda_montantecomimposto\n          + venda_impostoadicionar\n          + venda_impostoretirar\n\n          + venda_descricao\n          + venda_lote\n          + venda_validade\n          + venda_metadata\n\n          arg_itens: [\n              venda_id: UID\n              venda_artigo_id: UID,\n              venda_quantidade: QUANT,\n              venda_custounitario: COST\n              venda_custoquantidade: COST\n              venda_descricao: DESCRICAO\n              venda_lote: LOTE\n              venda_validade: VALIDADE\n              venda_metadata: {... any extras data}\n            + venda_montantetotal\n          ]\n   */\n  with __iten as (\n    select\n        iten.venda_artigo_id,\n        iten.venda_quantidade * -1 as venda_quantidade,\n        iten.venda_custounitario,\n        iten.venda_custoquantidade,\n        iten.venda_descricao,\n        iten.venda_lote,\n        iten.venda_validade,\n        iten.venda_metadata,\n        iten.venda_taxas,\n        iten.venda_montantetotal * -1 as venda_montantetotal,\n        iten.venda_id as venda_venda_docorign,\n        iten.venda_venda_id as ___iten_venda_super\n      from tweeks.venda iten\n        inner join tweeks.artigo at on iten.venda_artigo_id = at.artigo_id\n          and at._branch_uid = arg_branch_uid\n      where iten.venda_venda_id = any( _data.notacredito_aplicar )\n        and iten.venda_estado = _const.maguita_venda_estado_fechado\n        and iten._branch_uid = arg_branch_uid\n  ), __vendas as (\n    select\n        ve.venda_id as venda_venda_docorign,\n        ve.venda_artigo_id,\n        ve.venda_quantidade * -1 as venda_quantidade,\n        ve.venda_custounitario,\n        ve.venda_custoquantidade,\n        ve.venda_editado,\n        ve.venda_isencao,\n        ve.venda_montante * -1 as venda_montante,\n        ve.venda_montanteagregado * -1 as venda_montanteagregado,\n        ve.venda_montantetotal * -1 as venda_montantetotal,\n        ve.venda_imposto * -1 as venda_imposto,\n        ve.venda_montantesemimposto * -1 as venda_montantesemimposto,\n        ve.venda_montantecomimposto * -1 as venda_montantecomimposto,\n        ve.venda_impostoadicionar * -1 as venda_impostoadicionar,\n        ve.venda_impostoretirar * -1 as venda_impostoretirar,\n        ve.venda_descricao,\n        ve.venda_lote,\n        ve.venda_validade,\n        ve.venda_metadata,\n        ve.venda_taxas,\n        coalesce( jsonb_agg( to_jsonb( iten ) ) filter ( where iten.venda_venda_docorign is not null ), jsonb_build_array()) as arg_itens\n      from tweeks.venda ve\n        left join __iten iten on ve.venda_id = iten.___iten_venda_super\n\n      where ve.venda_id = any( _data.notacredito_aplicar )\n        and ve.venda_venda_id is null\n      group by ve.venda_id\n  ) select\n        jsonb_agg( to_jsonb( ve ) ) as arg_vendas\n        into _vendas\n      from __vendas ve\n  ;\n\n  /*\n   -- obrigatorios\n      arg_colaborador_id: ID,\n      arg_espaco_auth: ID,\n\n      conta_posto_id: ID,\n\n      -- opcional\n      conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM }\n      conta_id: ID?\n      conta_extension: {} | { reserva_id: UID }\n      conta_chave: CHAVE\n\n      conta_currency_id: ID,\n      conta_tpaga_id: ID,\n\n      conta_cliente_id:UID\n      conta_titular: CLIENTE-NOME\n      conta_titularnif: CLIENTE-NIF\n      conta_data: DATA,\n\n      -- requerido\n      arg_vendas\n   */\n\n\n\n  if _conta.conta_cliente_id is null or _conta.conta_cliente_id = _const.maguita_cliente_final and not exists(\n      select *\n      from tweeks.cliente c\n      where c.cliente_id = _const.maguita_cliente_finalnotacredito\n  ) then\n      select * into __branch from cluster.branch where _branch_uid = arg_branch_uid;\n      insert into tweeks.cliente(\n          cliente_id,\n          cliente_colaborador_id,\n          cliente_colaborador_gerente,\n          cliente_espaco_auth,\n          cliente_titular,\n          _branch_uid,\n          cliente_code\n      ) values (\n           _const.maguita_cliente_finalnotacredito,\n           _const.colaborador_system_data,\n           __branch.branch_main_user,\n           __branch.branch_main_workspace,\n           'CONTA DE NOTA DE CREDITO',\n           __branch._branch_uid,\n           'NC100010'\n       );\n  end if;\n  \n  _conta_args.conta_cliente_id := _conta.conta_cliente_id;\n  _conta_args.conta_data := coalesce( _conta_args.conta_data, current_date );\n  if _conta_args.conta_cliente_id is null or _conta_args.conta_cliente_id = _const.maguita_cliente_final then\n      _conta_args.conta_cliente_id := _const.maguita_cliente_finalnotacredito;\n  end if;\n  \n\n\n  _conta_res := tweeks.funct_pos_reg_conta(\n    jsonb_build_object(\n      'arg_colaborador_id', arg_colaborador_id,\n      'arg_espaco_auth', _conta.conta_espaco_auth,\n      'conta_posto_id', _conta_args.conta_posto_id,\n      'conta_mesa', _conta_args.conta_mesa,\n      'conta_extension', coalesce( _conta_args.conta_extension, jsonb_build_object()),\n      'conta_chave', _conta_args.conta_chave,\n      'conta_currency_id', null,\n      'conta_tpaga_id', null,\n      'conta_cliente_id', _conta_args.conta_cliente_id,\n      'conta_titular', _conta.conta_titular,\n      'conta_titularnif', _conta.conta_titularnif,\n      'conta_data', _conta_args.conta_data,\n      'arg_vendas', _vendas.arg_vendas,\n      'conta_conta_docorigin', _conta.conta_id,\n      'conta_observacao', _conta_args.conta_observacao,\n      'conta_tserie_id', _const.maguita_tserie_notacredito,\n      'conta_espaco_notacredito', arg_espaco_auth\n    )\n  );\n  \n  if not _conta_res.result then\n    return _conta_res;\n  end if;\n\n  /*\n    Essa função fecha uma nova conta\n      arg = {\n        arg_espaco_auth: ID,\n        arg_colaborador_id: ID,\n\n        deposito:{\n          deposito_cliente_id\n          deposito_caixa_id\n          deposito_tpaga_id\n          deposito_currency_id\n          deposito_posto_id\n          deposito_montantemoeda\n          deposito_montantetroco\n          deposito_data\n          deposito_docref: DOCUMENTO-REF?\n          deposito_observacao: OBSERVACAO?\n        }\n\n        conta_id: ID,\n        conta_extension: {} | { reserva_id: UID }\n        conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM },\n\n        conta_posto_id: ID,\n        conta_desconto\n\n        conta_titular: NOME-CLIENTE\n        conta_titularnif: VARCHAR,\n        conta_data: DATA,\n        conta_cliente_id,\n\n        //Relativos a GUIA\n        guia_documentoperacao: CODIGO,\n        guia_dataopeacao: DATA,\n        guia_observacao: DESCRICAO\n        guia_metadata: { ... any extras data }\n\n        custos:[{\n          custoguia_montante: MONTANTE,\n          custoguia_descricao: DESCRICAO PARA O CUSTO\n          custoguia_tcusto_id: 1 - DESPESA | 2 - RECEITA\n        }]\n   */\n  \n  _conta_close_res := tweeks.funct_pos_change_conta_fechar(\n    jsonb_build_object(\n      'arg_colaborador_id', arg_colaborador_id,\n      'arg_espaco_auth', _conta.conta_espaco_auth,\n      'arg_tserie_id', _const.maguita_tserie_notacredito,\n      'conta_conta_docorigin', _conta.conta_id,\n      'conta_id', _conta_res.data->>'conta_id',\n      'conta_extension', jsonb_build_object(),\n      'conta_posto_id',  _conta_args.conta_posto_id,\n      'conta_posto_fecho',  _conta_args.conta_posto_id,\n      'conta_desconto', ( _conta.conta_desconto ),\n      'conta_titular', _conta.conta_titular,\n      'conta_tserie_id', _const.maguita_tserie_notacredito,\n      'conta_titularnif', _conta.conta_titularnif,\n      'conta_data', coalesce( _conta_args.conta_data, now()::date),\n      'conta_cliente_id', _conta_args.conta_cliente_id,\n      'guia_documentoperacao', format('NC-%s',  to_char( clock_timestamp(), 'YYYYMMDDHHMISS-US')),\n      'guia_observacao', 'Guia de devolução ao stock ao efeturar uma nota de credito',\n      'guia_metadata', coalesce( _conta_res.data, jsonb_build_object() ),\n      'custos', jsonb_build_array(),\n      'conta_chave', _conta_args.conta_chave,\n      'arg_group_id', _conta._tgrupo_id\n    )\n  );\n\n  return _conta_close_res;\n\nexception  when others then\n    <<_ex>> declare e text; m text; d text; h text; c text;\n    begin\n        get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;\n        return lib.res_exception( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );\n    end;\nend\n$$;\n\n\ncreate or replace function tweeks.funct_load_conta_notacredito( args jsonb )\nreturns setof jsonb\nlanguage plpgsql as $$\ndeclare\n  /**\n    args := {\n      arg_colaborador_id: UID\n      arg_espaco_auth: UID\n      conta_fatura\n    }\n   */\n  arg_colaborador_id uuid default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid default args->>'arg_espaco_auth';\n  arg_branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  _conta_fatura character varying := args->>'conta_fatura';\n  _const map.constant;\nbegin\n  _const := map.constant();\n  return query\n    with __venda as (\n      select\n          ve.*,\n          art.*,\n          sum( tx.taxa_taxa ) as taxa_taxa,\n          sum( tx.taxa_percentagem ) as taxa_percentagem\n        from tweeks.venda ve\n          inner join tweeks.artigo art on ve.venda_artigo_id = art.artigo_id\n          left join tweeks.taxa tx on tx.taxa_id = any( venda_taxas )\n        where ve._branch_uid  = arg_branch\n          and ve.venda_venda_id is null\n          and ve.venda_estado = _const.maguita_venda_estado_fechado\n        group by ve.venda_id,\n          art.artigo_id\n    ), __venda_group as (\n      select\n          _ve.venda_id,\n          _ve.venda_conta_id,\n          array_agg( to_jsonb( _vei ) ) as venda_itens\n        from __venda _ve\n          left join __venda _vei on _ve.venda_id = _vei.venda_venda_id\n        where _ve.venda_venda_id is null\n        group by _ve.venda_id,\n          _ve.venda_conta_id\n\n    ), __conta as (\n      select\n        ct.*,\n        array_agg( to_jsonb( _veg ) || to_jsonb( _ved ) ) as conta_vendas\n        from tweeks.conta ct\n          inner join __venda_group _veg on ct.conta_id = _veg.venda_conta_id\n          inner join __venda _ved on _veg.venda_id = _ved.venda_id\n          left join tweeks.venda venda_ncred on _veg.venda_id = venda_ncred.venda_venda_docorign\n            and venda_ncred.venda_estado = _const.maguita_venda_estado_fechado\n        where ct._branch_uid = arg_branch\n          and ct.conta_estado = _const.maguita_conta_estado_fechado\n          and venda_ncred.venda_id is null\n          and ct.conta_numerofatura = _conta_fatura\n        group by ct.conta_id\n    ) select to_jsonb( _ct )\n        from __conta _ct\n  ;\nend;\n$$;\n	create or replace function tweeks.funct_reg_conta_nota_credito(args jsonb) returns lib.res language plpgsql as $$ declare /** args := { conta_chave: CHAVE arg_colaborador_id: UID arg_espaco_auth: UID conta_id: UID, conta_data: DATE, conta_posto_id: UID conta_observacao itens: [ { venda_id:ID }, { venda_id:ID }, { venda_id:ID }... ] } */ arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; arg_conta_id uuid default args->>'conta_id'; arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); __branch cluster.branch; _data record; _vendas record; _conta tweeks.conta; _conta_args tweeks.conta; _const map.constant; _conta_res lib.res; _conta_close_res lib.res; itens uuid[] default array( select (e.doc->>'venda_id')::uuid from jsonb_array_elements( args->'itens' ) e ( doc ) ); begin _const := map.constant(); _conta_args := jsonb_populate_record( _conta_args, args ); _conta_args.conta_posto_fecho := _conta_args.conta_posto_id; _conta := tweeks._get_conta( arg_conta_id ); if _conta.conta_estado != _const.maguita_conta_estado_fechado then return lib.res_false( 'Essa conta não se encontra fechada' ); end if; with conta_origin as ( select ct.*, ve.*, art.*, count( venc.venda_id ) > 0 as venda_ncexists from tweeks.conta ct inner join tweeks.venda ve on ct.conta_id = ve.venda_conta_id and ve._branch_uid = arg_branch_uid and ve.venda_estado = _const.maguita_venda_estado_fechado left join tweeks.artigo art on ve.venda_artigo_id = art.artigo_id and art._branch_uid = arg_branch_uid left join tweeks.conta ctnc on ct.conta_id = ctnc.conta_conta_docorigin and ctnc.conta_estado = _const.maguita_conta_estado_fechado and ctnc._branch_uid = arg_branch_uid left join tweeks.venda venc on ctnc.conta_id = ve.venda_conta_id and venc.venda_venda_docorign = ve.venda_id and venc.venda_estado = _const.maguita_venda_estado_fechado and venc._branch_uid = arg_branch_uid where ct.conta_id = arg_conta_id group by ct.conta_id, art.artigo_id, ve.venda_id ), notacareito_usar as ( select count( * ) filter ( where not ct.venda_ncexists and ct.venda_id = any ( itens ) and ct.venda_venda_id is null ) as notacredito_aplicartotal, array_agg( ct.venda_id ) filter ( where not ct.venda_ncexists and ct.venda_id = any ( itens ) and ct.venda_venda_id is null ) as notacredito_aplicar, count( * ) filter ( where ct.venda_id = any ( itens ) and ct.venda_venda_id is null ) as notacredito_usartotal, array_agg( jsonb_build_object( 'artigo_id', ct.artigo_id, 'artigo_codigo', ct.artigo_codigo, 'artigo_nome', ct.artigo_nome, 'venda_id', ct.venda_id, 'venda_quantidade', ct.venda_quantidade, 'venda_custounitario', ct.venda_custounitario ) ) filter ( where ct.venda_ncexists and ct.venda_id = any ( itens ) and ct.venda_venda_id is null ) as notacredito_exists from conta_origin ct ) select * into _data from notacareito_usar ; if _data.notacredito_aplicartotal = 0 then return lib.res_false( 'Nenhum dos iten selecionado pode-se aplicar nota de credito sobre ele' ); end if; if _data.notacredito_aplicartotal < _data.notacredito_usartotal then return lib.res_false( 'Alguns dos itens selecionados já têm notas de creditos aplicado sobre ele', jsonb_build_object( 'notacredito_exists', _data.notacredito_exists ) ); end if; /* arg_vendas: [ { venda_id?: UID, venda_artigo_id: UID, venda_quantidade: QUANT, venda_custounitario: COST venda_custoquantidade: COST + venda_editado + venda_isencao + venda_montante + venda_montanteagregado + venda_montantetotal + venda_imposto + venda_montantesemimposto + venda_montantecomimposto + venda_impostoadicionar + venda_impostoretirar + venda_descricao + venda_lote + venda_validade + venda_metadata arg_itens: [ venda_id: UID venda_artigo_id: UID, venda_quantidade: QUANT, venda_custounitario: COST venda_custoquantidade: COST venda_descricao: DESCRICAO venda_lote: LOTE venda_validade: VALIDADE venda_metadata: {... any extras data} + venda_montantetotal ] */ with __iten as ( select iten.venda_artigo_id, iten.venda_quantidade * -1 as venda_quantidade, iten.venda_custounitario, iten.venda_custoquantidade, iten.venda_descricao, iten.venda_lote, iten.venda_validade, iten.venda_metadata, iten.venda_taxas, iten.venda_montantetotal * -1 as venda_montantetotal, iten.venda_id as venda_venda_docorign, iten.venda_venda_id as ___iten_venda_super from tweeks.venda iten inner join tweeks.artigo at on iten.venda_artigo_id = at.artigo_id and at._branch_uid = arg_branch_uid where iten.venda_venda_id = any( _data.notacredito_aplicar ) and iten.venda_estado = _const.maguita_venda_estado_fechado and iten._branch_uid = arg_branch_uid ), __vendas as ( select ve.venda_id as venda_venda_docorign, ve.venda_artigo_id, ve.venda_quantidade * -1 as venda_quantidade, ve.venda_custounitario, ve.venda_custoquantidade, ve.venda_editado, ve.venda_isencao, ve.venda_montante * -1 as venda_montante, ve.venda_montanteagregado * -1 as venda_montanteagregado, ve.venda_montantetotal * -1 as venda_montantetotal, ve.venda_imposto * -1 as venda_imposto, ve.venda_montantesemimposto * -1 as venda_montantesemimposto, ve.venda_montantecomimposto * -1 as venda_montantecomimposto, ve.venda_impostoadicionar * -1 as venda_impostoadicionar, ve.venda_impostoretirar * -1 as venda_impostoretirar, ve.venda_descricao, ve.venda_lote, ve.venda_validade, ve.venda_metadata, ve.venda_taxas, coalesce( jsonb_agg( to_jsonb( iten ) ) filter ( where iten.venda_venda_docorign is not null ), jsonb_build_array()) as arg_itens from tweeks.venda ve left join __iten iten on ve.venda_id = iten.___iten_venda_super where ve.venda_id = any( _data.notacredito_aplicar ) and ve.venda_venda_id is null group by ve.venda_id ) select jsonb_agg( to_jsonb( ve ) ) as arg_vendas into _vendas from __vendas ve ; /* -- obrigatorios arg_colaborador_id: ID, arg_espaco_auth: ID, conta_posto_id: ID, -- opcional conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM } conta_id: ID? conta_extension: {} | { reserva_id: UID } conta_chave: CHAVE conta_currency_id: ID, conta_tpaga_id: ID, conta_cliente_id:UID conta_titular: CLIENTE-NOME conta_titularnif: CLIENTE-NIF conta_data: DATA, -- requerido arg_vendas */ if _conta.conta_cliente_id is null or _conta.conta_cliente_id = _const.maguita_cliente_final and not exists( select * from tweeks.cliente c where c.cliente_id = _const.maguita_cliente_finalnotacredito ) then select * into __branch from cluster.branch where _branch_uid = arg_branch_uid; insert into tweeks.cliente( cliente_id, cliente_colaborador_id, cliente_colaborador_gerente, cliente_espaco_auth, cliente_titular, _branch_uid, cliente_code ) values ( _const.maguita_cliente_finalnotacredito, _const.colaborador_system_data, __branch.branch_main_user, __branch.branch_main_workspace, 'CONTA DE NOTA DE CREDITO', __branch._branch_uid, 'NC100010' ); end if; _conta_args.conta_cliente_id := _conta.conta_cliente_id; _conta_args.conta_data := coalesce( _conta_args.conta_data, current_date ); if _conta_args.conta_cliente_id is null or _conta_args.conta_cliente_id = _const.maguita_cliente_final then _conta_args.conta_cliente_id := _const.maguita_cliente_finalnotacredito; end if; _conta_res := tweeks.funct_pos_reg_conta( jsonb_build_object( 'arg_colaborador_id', arg_colaborador_id, 'arg_espaco_auth', _conta.conta_espaco_auth, 'conta_posto_id', _conta_args.conta_posto_id, 'conta_mesa', _conta_args.conta_mesa, 'conta_extension', coalesce( _conta_args.conta_extension, jsonb_build_object()), 'conta_chave', _conta_args.conta_chave, 'conta_currency_id', null, 'conta_tpaga_id', null, 'conta_cliente_id', _conta_args.conta_cliente_id, 'conta_titular', _conta.conta_titular, 'conta_titularnif', _conta.conta_titularnif, 'conta_data', _conta_args.conta_data, 'arg_vendas', _vendas.arg_vendas, 'conta_conta_docorigin', _conta.conta_id, 'conta_observacao', _conta_args.conta_observacao, 'conta_tserie_id', _const.maguita_tserie_notacredito, 'conta_espaco_notacredito', arg_espaco_auth ) ); if not _conta_res.result then return _conta_res; end if; /* Essa função fecha uma nova conta arg = { arg_espaco_auth: ID, arg_colaborador_id: ID, deposito:{ deposito_cliente_id deposito_caixa_id deposito_tpaga_id deposito_currency_id deposito_posto_id deposito_montantemoeda deposito_montantetroco deposito_data deposito_docref: DOCUMENTO-REF? deposito_observacao: OBSERVACAO? } conta_id: ID, conta_extension: {} | { reserva_id: UID } conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM }, conta_posto_id: ID, conta_desconto conta_titular: NOME-CLIENTE conta_titularnif: VARCHAR, conta_data: DATA, conta_cliente_id, //Relativos a GUIA guia_documentoperacao: CODIGO, guia_dataopeacao: DATA, guia_observacao: DESCRICAO guia_metadata: { ... any extras data } custos:[{ custoguia_montante: MONTANTE, custoguia_descricao: DESCRICAO PARA O CUSTO custoguia_tcusto_id: 1 - DESPESA | 2 - RECEITA }] */ _conta_close_res := tweeks.funct_pos_change_conta_fechar( jsonb_build_object( 'arg_colaborador_id', arg_colaborador_id, 'arg_espaco_auth', _conta.conta_espaco_auth, 'arg_tserie_id', _const.maguita_tserie_notacredito, 'conta_conta_docorigin', _conta.conta_id, 'conta_id', _conta_res.data->>'conta_id', 'conta_extension', jsonb_build_object(), 'conta_posto_id', _conta_args.conta_posto_id, 'conta_posto_fecho', _conta_args.conta_posto_id, 'conta_desconto', ( _conta.conta_desconto ), 'conta_titular', _conta.conta_titular, 'conta_tserie_id', _const.maguita_tserie_notacredito, 'conta_titularnif', _conta.conta_titularnif, 'conta_data', coalesce( _conta_args.conta_data, now()::date), 'conta_cliente_id', _conta_args.conta_cliente_id, 'guia_documentoperacao', format('NC-%s', to_char( clock_timestamp(), 'YYYYMMDDHHMISS-US')), 'guia_observacao', 'Guia de devolução ao stock ao efeturar uma nota de credito', 'guia_metadata', coalesce( _conta_res.data, jsonb_build_object() ), 'custos', jsonb_build_array(), 'conta_chave', _conta_args.conta_chave, 'arg_group_id', _conta._tgrupo_id ) ); return _conta_close_res; exception when others then <<_ex>> declare e text; m text; d text; h text; c text; begin get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context; return lib.res_exception( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c ); end; end $$; create or replace function tweeks.funct_load_conta_notacredito( args jsonb ) returns setof jsonb language plpgsql as $$ declare /** args := { arg_colaborador_id: UID arg_espaco_auth: UID conta_fatura } */ arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; arg_branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _conta_fatura character varying := args->>'conta_fatura'; _const map.constant; begin _const := map.constant(); return query with __venda as ( select ve.*, art.*, sum( tx.taxa_taxa ) as taxa_taxa, sum( tx.taxa_percentagem ) as taxa_percentagem from tweeks.venda ve inner join tweeks.artigo art on ve.venda_artigo_id = art.artigo_id left join tweeks.taxa tx on tx.taxa_id = any( venda_taxas ) where ve._branch_uid = arg_branch and ve.venda_venda_id is null and ve.venda_estado = _const.maguita_venda_estado_fechado group by ve.venda_id, art.artigo_id ), __venda_group as ( select _ve.venda_id, _ve.venda_conta_id, array_agg( to_jsonb( _vei ) ) as venda_itens from __venda _ve left join __venda _vei on _ve.venda_id = _vei.venda_venda_id where _ve.venda_venda_id is null group by _ve.venda_id, _ve.venda_conta_id ), __conta as ( select ct.*, array_agg( to_jsonb( _veg ) || to_jsonb( _ved ) ) as conta_vendas from tweeks.conta ct inner join __venda_group _veg on ct.conta_id = _veg.venda_conta_id inner join __venda _ved on _veg.venda_id = _ved.venda_id left join tweeks.venda venda_ncred on _veg.venda_id = venda_ncred.venda_venda_docorign and venda_ncred.venda_estado = _const.maguita_venda_estado_fechado where ct._branch_uid = arg_branch and ct.conta_estado = _const.maguita_conta_estado_fechado and venda_ncred.venda_id is null and ct.conta_numerofatura = _conta_fatura group by ct.conta_id ) select to_jsonb( _ct ) from __conta _ct ; end; $$;
19b2478d-c613-4eac-ba4b-ba6bc9675ef1	\nselect * from map.constant('maguita_fluxo_estado_ativo', 'int2', 1 );\nselect * from map.constant('maguita_fluxo_estado_fechado', 'int2', 0 );\n\nupdate tweeks.fluxo\n  set fluxo_estado = (map.constant()).maguita_fluxo_estado_ativo\n  where fluxo_estado is null\n;\n\nalter table tweeks.fluxo alter fluxo_estado set not null;\n\ndrop function if exists tweeks.__fluxo_scan(_artigo_id uuid, _espaco_id uuid, _resume boolean);\ncreate or replace function tweeks.__fluxo_scan(_artigo_id uuid DEFAULT NULL::uuid, _espaco_id uuid DEFAULT NULL::uuid, _resume boolean DEFAULT true, _branch uuid default null)\n  returns TABLE(fluxo_artigo_id uuid, fluxo_espaco_id uuid, fluxo_preview double precision, fluxo_resultado double precision, fluxo_checkmarks uuid, fluxo_check double precision, fluxo_order bigint, fluxo_end bigint, fluxo_resume boolean, fluxo_credito double precision, fluxo_debito double precision, fluxo_calc double precision, fluxo_quantidade double precision, fluxo_id uuid, fluxo_date timestamp with time zone, fluxo_sequencia bigint)\n  language sql\nas\n$$\nwith recursive\n  __map as ( select maguita_fluxo_estado_ativo, maguita_fluxo_estado_fechado, maguita_fluxo_estado_anulado from map.constant() ),\n  __stock_point as(\n    select\n      a.artigo_id,\n      e.espaco_id,\n      mode() within group ( order by f.fluxo_dataregistro desc ) as point\n    from tweeks.fluxo f\n      inner join __map _const on f.fluxo_estado = _const.maguita_fluxo_estado_ativo\n      inner join tweeks.artigo a on a.artigo_id in ( f.fluxo_artigo_in, f.fluxo_artigo_out )\n        and a.artigo_id = coalesce( _artigo_id, a.artigo_id )\n        and a._branch_uid = coalesce( _branch, a._branch_uid )\n      inner join tweeks.espaco e on e.espaco_id in ( f.fluxo_espaco_in, f.fluxo_espaco_out )\n        and e.espaco_id = coalesce( _espaco_id, e.espaco_id )\n        and e._branch_uid = coalesce( _branch, e._branch_uid )\n    where f.fluxo_checkpoint = 0\n      and f._branch_uid = coalesce( _branch, f._branch_uid )\n      and f.fluxo_estado = _const.maguita_fluxo_estado_ativo\n    group by a.artigo_id,\n      e.espaco_id\n  ),\n  __fluxo as (\n    select\n      a.artigo_id,\n      e.espaco_id,\n      f.*,\n      case\n        when e.espaco_id = f.fluxo_espaco_in and a.artigo_id = f.fluxo_artigo_in then f.fluxo_quantidadein\n        else 0\n        end as fluxo_credito,\n      case\n        when e.espaco_id = f.fluxo_espaco_out and a.artigo_id = f.fluxo_artigo_out then f.fluxo_quantidadeout\n        else 0\n        end as fluxo_debito,\n      case\n        when f.fluxo_quantidadefinal is not null then f.fluxo_quantidadefinal\n        when e.espaco_id = f.fluxo_espaco_in and a.artigo_id = f.fluxo_artigo_in then f.fluxo_quantidadein * 1\n        when e.espaco_id = f.fluxo_espaco_out and a.artigo_id = f.fluxo_artigo_out then f.fluxo_quantidadeout * -1\n        end as fluxo_quantidade,\n      row_number() over ( partition by a.artigo_id, e.espaco_id ) as fluxo_order,\n      count( f.fluxo_id ) over ( partition by a.artigo_id, e.espaco_id ) as fluxo_end\n\n    from tweeks.fluxo f\n      inner join __map _const on f.fluxo_estado = _const.maguita_fluxo_estado_ativo\n      inner join tweeks.artigo a on a.artigo_id in ( f.fluxo_artigo_in, f.fluxo_artigo_out )\n        and a.artigo_id = coalesce( _artigo_id, a.artigo_id )\n        and a._branch_uid = coalesce( _branch, a._branch_uid )\n      inner join tweeks.espaco e on e.espaco_id in ( f.fluxo_espaco_in, f.fluxo_espaco_out )\n        and e.espaco_id = coalesce( _espaco_id, e.espaco_id )\n        and e._branch_uid = coalesce( _branch, e._branch_uid )\n      left join __stock_point _sp on _sp.artigo_id = a.artigo_id and _sp.espaco_id = e.espaco_id\n    where  f.fluxo_dataregistro >= coalesce( _sp.point, f.fluxo_dataregistro )\n      and f._branch_uid = coalesce( _branch, f._branch_uid )\n    order by a.artigo_id,\n      e.espaco_id,\n      f.fluxo_dataregistro,\n      f.fluxo_sequencia\n  ), __fluxo_stock as (\n  select\n    _f.*,\n    _f.fluxo_quantidade as fluxo_resultado,\n    0.0::double precision as fluxo_preview,\n    _f.fluxo_id as fluxo_checkmarks,\n    _f.fluxo_quantidade as fluxo_checkquant,\n    _f.fluxo_order = _f.fluxo_end as fluxo_resume\n  from __fluxo _f\n    inner join __map _const on true\n  where _f.fluxo_order = 1\n  union all\n  select\n    _f.*,\n    ( _fs.fluxo_resultado * _f.fluxo_checkpoint ) + ( _f.fluxo_quantidade ),\n    _fs.fluxo_resultado as fluxo_priview,\n    case\n      when _f.fluxo_checkpoint = 0 then _f.fluxo_id\n      else _fs.fluxo_checkmarks\n      end,\n    case\n      when _f.fluxo_checkpoint = 0 then _f.fluxo_quantidade\n      else _fs.fluxo_checkquant\n      end,\n    _f.fluxo_order = _f.fluxo_end as fluxo_resume\n\n  from __fluxo_stock _fs\n         inner join __fluxo _f on _fs.espaco_id = _f.espaco_id\n    and _fs.artigo_id = _f.artigo_id\n    and _fs.fluxo_order +1 = _f.fluxo_order\n) select\n    _fs.artigo_id as stock_artigo_id,\n    _fs.espaco_id as stock_espaco_id,\n    _fs.fluxo_preview,\n    _fs.fluxo_resultado,\n\n    _fs.fluxo_checkmarks,\n    _fs.fluxo_checkquant,\n\n    _fs.fluxo_order,\n    _fs.fluxo_end,\n    _fs.fluxo_resume,\n\n    _fs.fluxo_credito,\n    _fs.fluxo_debito,\n    _fs.fluxo_credito - _fs.fluxo_debito,\n    _fs.fluxo_quantidade,\n    _fs.fluxo_id,\n    _fs.fluxo_dataregistro,\n    _fs.fluxo_sequencia\nfrom __fluxo_stock _fs\nwhere true in (\n    coalesce( _resume, true ) = _fs.fluxo_resume,\n    not _resume\n  )\n$$;\n\n\ndrop view if exists tweeks.stock;\ncreate or replace view tweeks.stock as\n  select\n      fluxo_espaco_id as espaco_id,\n      fluxo_artigo_id as artigo_id,\n      null::uuid as fluxo_espaco_in,\n      null::uuid as fluxo_artigo_in,\n      null::int8 as entrada_quantidade,\n      null::int8 entradas,\n      null::uuid as fluxo_artigo_out,\n      null::uuid as fluxo_espaco_out,\n      null::int8 as saida_quantidade,\n      null::int8 as saidas,\n      fluxo_resultado as stock_quantidade\n    from tweeks.__fluxo_scan(\n      null,\n      null,\n      true,\n      null\n    );\n	select * from map.constant('maguita_fluxo_estado_ativo', 'int2', 1 ); select * from map.constant('maguita_fluxo_estado_fechado', 'int2', 0 ); update tweeks.fluxo set fluxo_estado = (map.constant()).maguita_fluxo_estado_ativo where fluxo_estado is null ; alter table tweeks.fluxo alter fluxo_estado set not null; drop function if exists tweeks.__fluxo_scan(_artigo_id uuid, _espaco_id uuid, _resume boolean); create or replace function tweeks.__fluxo_scan(_artigo_id uuid DEFAULT NULL::uuid, _espaco_id uuid DEFAULT NULL::uuid, _resume boolean DEFAULT true, _branch uuid default null) returns TABLE(fluxo_artigo_id uuid, fluxo_espaco_id uuid, fluxo_preview double precision, fluxo_resultado double precision, fluxo_checkmarks uuid, fluxo_check double precision, fluxo_order bigint, fluxo_end bigint, fluxo_resume boolean, fluxo_credito double precision, fluxo_debito double precision, fluxo_calc double precision, fluxo_quantidade double precision, fluxo_id uuid, fluxo_date timestamp with time zone, fluxo_sequencia bigint) language sql as $$ with recursive __map as ( select maguita_fluxo_estado_ativo, maguita_fluxo_estado_fechado, maguita_fluxo_estado_anulado from map.constant() ), __stock_point as( select a.artigo_id, e.espaco_id, mode() within group ( order by f.fluxo_dataregistro desc ) as point from tweeks.fluxo f inner join __map _const on f.fluxo_estado = _const.maguita_fluxo_estado_ativo inner join tweeks.artigo a on a.artigo_id in ( f.fluxo_artigo_in, f.fluxo_artigo_out ) and a.artigo_id = coalesce( _artigo_id, a.artigo_id ) and a._branch_uid = coalesce( _branch, a._branch_uid ) inner join tweeks.espaco e on e.espaco_id in ( f.fluxo_espaco_in, f.fluxo_espaco_out ) and e.espaco_id = coalesce( _espaco_id, e.espaco_id ) and e._branch_uid = coalesce( _branch, e._branch_uid ) where f.fluxo_checkpoint = 0 and f._branch_uid = coalesce( _branch, f._branch_uid ) and f.fluxo_estado = _const.maguita_fluxo_estado_ativo group by a.artigo_id, e.espaco_id ), __fluxo as ( select a.artigo_id, e.espaco_id, f.*, case when e.espaco_id = f.fluxo_espaco_in and a.artigo_id = f.fluxo_artigo_in then f.fluxo_quantidadein else 0 end as fluxo_credito, case when e.espaco_id = f.fluxo_espaco_out and a.artigo_id = f.fluxo_artigo_out then f.fluxo_quantidadeout else 0 end as fluxo_debito, case when f.fluxo_quantidadefinal is not null then f.fluxo_quantidadefinal when e.espaco_id = f.fluxo_espaco_in and a.artigo_id = f.fluxo_artigo_in then f.fluxo_quantidadein * 1 when e.espaco_id = f.fluxo_espaco_out and a.artigo_id = f.fluxo_artigo_out then f.fluxo_quantidadeout * -1 end as fluxo_quantidade, row_number() over ( partition by a.artigo_id, e.espaco_id ) as fluxo_order, count( f.fluxo_id ) over ( partition by a.artigo_id, e.espaco_id ) as fluxo_end from tweeks.fluxo f inner join __map _const on f.fluxo_estado = _const.maguita_fluxo_estado_ativo inner join tweeks.artigo a on a.artigo_id in ( f.fluxo_artigo_in, f.fluxo_artigo_out ) and a.artigo_id = coalesce( _artigo_id, a.artigo_id ) and a._branch_uid = coalesce( _branch, a._branch_uid ) inner join tweeks.espaco e on e.espaco_id in ( f.fluxo_espaco_in, f.fluxo_espaco_out ) and e.espaco_id = coalesce( _espaco_id, e.espaco_id ) and e._branch_uid = coalesce( _branch, e._branch_uid ) left join __stock_point _sp on _sp.artigo_id = a.artigo_id and _sp.espaco_id = e.espaco_id where f.fluxo_dataregistro >= coalesce( _sp.point, f.fluxo_dataregistro ) and f._branch_uid = coalesce( _branch, f._branch_uid ) order by a.artigo_id, e.espaco_id, f.fluxo_dataregistro, f.fluxo_sequencia ), __fluxo_stock as ( select _f.*, _f.fluxo_quantidade as fluxo_resultado, 0.0::double precision as fluxo_preview, _f.fluxo_id as fluxo_checkmarks, _f.fluxo_quantidade as fluxo_checkquant, _f.fluxo_order = _f.fluxo_end as fluxo_resume from __fluxo _f inner join __map _const on true where _f.fluxo_order = 1 union all select _f.*, ( _fs.fluxo_resultado * _f.fluxo_checkpoint ) + ( _f.fluxo_quantidade ), _fs.fluxo_resultado as fluxo_priview, case when _f.fluxo_checkpoint = 0 then _f.fluxo_id else _fs.fluxo_checkmarks end, case when _f.fluxo_checkpoint = 0 then _f.fluxo_quantidade else _fs.fluxo_checkquant end, _f.fluxo_order = _f.fluxo_end as fluxo_resume from __fluxo_stock _fs inner join __fluxo _f on _fs.espaco_id = _f.espaco_id and _fs.artigo_id = _f.artigo_id and _fs.fluxo_order +1 = _f.fluxo_order ) select _fs.artigo_id as stock_artigo_id, _fs.espaco_id as stock_espaco_id, _fs.fluxo_preview, _fs.fluxo_resultado, _fs.fluxo_checkmarks, _fs.fluxo_checkquant, _fs.fluxo_order, _fs.fluxo_end, _fs.fluxo_resume, _fs.fluxo_credito, _fs.fluxo_debito, _fs.fluxo_credito - _fs.fluxo_debito, _fs.fluxo_quantidade, _fs.fluxo_id, _fs.fluxo_dataregistro, _fs.fluxo_sequencia from __fluxo_stock _fs where true in ( coalesce( _resume, true ) = _fs.fluxo_resume, not _resume ) $$; drop view if exists tweeks.stock; create or replace view tweeks.stock as select fluxo_espaco_id as espaco_id, fluxo_artigo_id as artigo_id, null::uuid as fluxo_espaco_in, null::uuid as fluxo_artigo_in, null::int8 as entrada_quantidade, null::int8 entradas, null::uuid as fluxo_artigo_out, null::uuid as fluxo_espaco_out, null::int8 as saida_quantidade, null::int8 as saidas, fluxo_resultado as stock_quantidade from tweeks.__fluxo_scan( null, null, true, null );
83d9f9c7-ca37-4580-b07b-2e76094ca661	\ncreate or replace function tweeks.funct_load_posto(filter jsonb DEFAULT NULL::jsonb) returns SETOF jsonb\nlanguage plpgsql\nas\n$$\n    declare\n    /** Essa função serve para devolver os postos\n      filter := {\n        arg_colaborador_id UUID\n        arg_espaco_auth UUID\n        arg_aloca_espaco:UUID\n      }\n     */\n    arg_colaborador_id uuid not null default filter->>'arg_colaborador_id';\n  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';\n\n  __branch uuid not null default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  arg_aloca_espaco uuid default filter->>'arg_aloca_espaco';\n  arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth );\n  _const map.constant;\n    begin\n  _const := map.constant();\n\n    return query\n        with __alocacao as (\n      select\n        a.aloca_posto_id as posto_id,\n        sum( a.aloca_montante ) as posto_montante,\n        coalesce( array_agg( e.espaco_id ), array[]::uuid[] )||a.aloca_posto_id as posto_espacos,\n        jsonb_agg( to_jsonb( a )||to_jsonb( e ) ) as posto_alocacao\n      from tweeks.aloca a\n             inner join tweeks.espaco e on a.aloca_espaco_destino = e.espaco_id\n      where a.aloca_estado = _const.maguita_aloca_estado_ativo\n        and e.espaco_estado = _const.maguita_espaco_estado_ativo\n      group by a.aloca_posto_id\n    ), __posto_filter as (\n      select\n        pos.posto_id,\n        pos.posto_designacao,\n        pos.posto_estado != _const.maguita_posto_estado_encerado as posto_ativo,\n        a.posto_montante as posto_montante,\n        coalesce( a.posto_alocacao, jsonb_build_array() ) as posto_alocacao,\n        pos.posto_estado,\n        pos.posto_caixamode,\n        pos.posto_authmode,\n        pos.posto_chave,\n        pos.posto_vermontatefaturado,\n        pos.posto_multiplecaixa,\n        pos.posto_definirmontanteautomaticamente,\n        tpos.tposto_id,\n        tpos.tposto_designacao\n      from tweeks.posto pos\n        inner join tweeks.tposto tpos on pos.posto_tposto_id = tpos.tposto_id\n        left join __alocacao a on pos.posto_id = a.posto_id\n      where pos._branch_uid = __branch\n        and ( arg_aloca_espaco = any ( a.posto_espacos ) or arg_aloca_espaco is null )\n      order by\n        case\n          when pos.posto_estado = _const.maguita_posto_estado_aberto then 1\n          when pos.posto_estado = _const.maguita_posto_estado_fechado then 2\n          when pos.posto_estado = _const.maguita_posto_estado_encerado then 3\n        end,\n        pos.posto_designacao\n    ), __treat_posto as (\n      select ps.*,\n        coalesce( ps.posto_alocacao, jsonb_build_array() ) as posto_alocacao\n        from __posto_filter ps\n    ) select to_jsonb( t )\n      from __treat_posto t\n    ;\n    end;\n$$;\n\n\ncreate or replace function tweeks.funct_pos_load_caixa_auth(args jsonb) returns SETOF jsonb\n    language plpgsql\nas\n$$\ndeclare\n  /**\n    args := {\n      arg_colaborador_id: UUID,\n      arg_espaco_auth: UUID,\n      arg_posto_id:UUID\n      auth: BOOLEAN\n    }\n   */\n  arg_posto_id uuid not null default args->>'arg_posto_id';\n  arg_colaborador_id uuid default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid default args->>'arg_espaco_auth';\n  branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  _const map.constant;\n  _posto tweeks.posto;\n\nbegin\n  _const := map.constant();\n\n  select * into _posto from tweeks.posto;\n\n  return query with\n  __deposito as (\n    select\n        dep.deposito_caixa_id,\n        dep.deposito_currency_id,\n        cur.currency_id,\n        cur.currency_name,\n        cur.currency_code,\n        sum( dep.deposito_montantefinal ) deposito_montantefinal,\n        sum( dep.deposito_montante ) deposito_montante,\n        sum( dep.deposito_montantemoeda ) deposito_montantemoeda,\n        sum( dep.deposito_montantetroco ) deposito_montantetroco\n      from tweeks.deposito dep\n        inner join geoinfo.currency cur on dep.deposito_currency_id = cur.currency_id\n      where dep.deposito_estado = _const.maguita_deposito_estado_ativo\n        and dep._branch_uid = branch\n      group by dep.deposito_caixa_id,\n        dep.deposito_currency_id,\n        cur.currency_id,\n        cur.currency_name,\n        cur.currency_code\n  ),__deposito_caixa as (\n      select\n          dep.deposito_caixa_id,\n          sum( dep.deposito_montantefinal ) as deposito_montantefinal,\n          jsonb_object_agg(\n              dep.currency_code, jsonb_build_object(\n                  'deposito_montantemoeda', deposito_montantemoeda,\n                  'deposito_montantefinal', deposito_montantefinal,\n                  'deposito_montante', deposito_montante,\n                  'deposito_montantetroco', deposito_montantetroco\n              )\n          ) as deposito_montantemoeda,\n          sum( dep.deposito_montante ) as deposito_montante,\n          sum( dep.deposito_montantefinal ) as deposito_montantefinal,\n          sum( dep.deposito_montantetroco ) as deposito_montantetroco\n        from __deposito dep\n        group by\n          dep.deposito_caixa_id\n  ),__posto as (\n    select\n        c.caixa_id,\n        c.caixa_estado,\n        c.caixa_montanteinicial,\n        c.caixa_montanteinicialposto,\n        p.posto_caixamode,\n        dep.*\n      from tweeks.posto p\n        inner join tweeks.caixa c on p.posto_id = c.caixa_posto_id\n          and c.caixa_estado = _const.maguita_caixa_estado_ativo\n          and case\n            when p.posto_caixamode = _const.maguita_posto_caixamodo_pessoal then c.caixa_colaborador_id = arg_colaborador_id\n            when p.posto_caixamode = _const.maguita_posto_caixamodo_espaco  then c.caixa_espaco_auth    = arg_espaco_auth\n            when p.posto_caixamode = _const.maguita_posto_caixamodo_posto   then c.caixa_posto_id       = arg_posto_id\n            else false\n          end\n        left join __deposito_caixa dep on c.caixa_id = dep.deposito_caixa_id\n      where p.posto_id = arg_posto_id\n        and p._branch_uid = branch\n        and c._branch_uid = branch\n  ) select to_jsonb( p )\n    from __posto p;\nend;\n$$;\n\n\ncreate or replace function tweeks.funct_pos_report_venda(\n  args jsonb\n)\nreturns setof jsonb\nlanguage plpgsql as $$\ndeclare\n  arg_colaborador_id uuid default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid default args->>'arg_espaco_auth';\n  arg_posto_id uuid default args->>'arg_posto_id';\n  arg_date_start date default args->>'arg_date_start';\n  arg_date_end date default args->>'arg_date_end';\n  branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  _const map.constant;\nbegin\n  _const := map.constant();\n  return query\n    with __venda as (\n      select\n          art.artigo_id,\n          art.artigo_nome,\n          v.venda_custounitario,\n          sum( v.venda_quantidade ) as venda_quantidade,\n          sum( v.venda_montantecomimposto ) as venda_montantecomimposto,\n          sum( v.venda_montantesemimposto ) as venda_montantesemimposto\n        from tweeks.venda v\n          inner join tweeks.artigo art on v.venda_artigo_id = art.artigo_id\n          inner join tweeks.conta ct on v.venda_conta_id = ct.conta_id\n        where v._branch_uid = branch\n          and v.venda_estado = _const.maguita_venda_estado_fechado\n          and ct.conta_estado = _const.maguita_conta_estado_fechado\n          and ct.conta_datafecho::date >= coalesce( arg_date_start, ct.conta_datafecho::date )\n          and ct.conta_datafecho::date <= coalesce( arg_date_end, ct.conta_datafecho::date )\n          and ct.conta_posto_fecho = arg_posto_id\n        group by art.artigo_id,\n          v.venda_custounitario\n    ) select to_jsonb( v2 )\n        from __venda v2\n    ;\nend;\n$$\n	create or replace function tweeks.funct_load_posto(filter jsonb DEFAULT NULL::jsonb) returns SETOF jsonb language plpgsql as $$ declare /** Essa função serve para devolver os postos filter := { arg_colaborador_id UUID arg_espaco_auth UUID arg_aloca_espaco:UUID } */ arg_colaborador_id uuid not null default filter->>'arg_colaborador_id'; arg_espaco_auth uuid not null default filter->>'arg_espaco_auth'; __branch uuid not null default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); arg_aloca_espaco uuid default filter->>'arg_aloca_espaco'; arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth ); _const map.constant; begin _const := map.constant(); return query with __alocacao as ( select a.aloca_posto_id as posto_id, sum( a.aloca_montante ) as posto_montante, coalesce( array_agg( e.espaco_id ), array[]::uuid[] )||a.aloca_posto_id as posto_espacos, jsonb_agg( to_jsonb( a )||to_jsonb( e ) ) as posto_alocacao from tweeks.aloca a inner join tweeks.espaco e on a.aloca_espaco_destino = e.espaco_id where a.aloca_estado = _const.maguita_aloca_estado_ativo and e.espaco_estado = _const.maguita_espaco_estado_ativo group by a.aloca_posto_id ), __posto_filter as ( select pos.posto_id, pos.posto_designacao, pos.posto_estado != _const.maguita_posto_estado_encerado as posto_ativo, a.posto_montante as posto_montante, coalesce( a.posto_alocacao, jsonb_build_array() ) as posto_alocacao, pos.posto_estado, pos.posto_caixamode, pos.posto_authmode, pos.posto_chave, pos.posto_vermontatefaturado, pos.posto_multiplecaixa, pos.posto_definirmontanteautomaticamente, tpos.tposto_id, tpos.tposto_designacao from tweeks.posto pos inner join tweeks.tposto tpos on pos.posto_tposto_id = tpos.tposto_id left join __alocacao a on pos.posto_id = a.posto_id where pos._branch_uid = __branch and ( arg_aloca_espaco = any ( a.posto_espacos ) or arg_aloca_espaco is null ) order by case when pos.posto_estado = _const.maguita_posto_estado_aberto then 1 when pos.posto_estado = _const.maguita_posto_estado_fechado then 2 when pos.posto_estado = _const.maguita_posto_estado_encerado then 3 end, pos.posto_designacao ), __treat_posto as ( select ps.*, coalesce( ps.posto_alocacao, jsonb_build_array() ) as posto_alocacao from __posto_filter ps ) select to_jsonb( t ) from __treat_posto t ; end; $$; create or replace function tweeks.funct_pos_load_caixa_auth(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** args := { arg_colaborador_id: UUID, arg_espaco_auth: UUID, arg_posto_id:UUID auth: BOOLEAN } */ arg_posto_id uuid not null default args->>'arg_posto_id'; arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _const map.constant; _posto tweeks.posto; begin _const := map.constant(); select * into _posto from tweeks.posto; return query with __deposito as ( select dep.deposito_caixa_id, dep.deposito_currency_id, cur.currency_id, cur.currency_name, cur.currency_code, sum( dep.deposito_montantefinal ) deposito_montantefinal, sum( dep.deposito_montante ) deposito_montante, sum( dep.deposito_montantemoeda ) deposito_montantemoeda, sum( dep.deposito_montantetroco ) deposito_montantetroco from tweeks.deposito dep inner join geoinfo.currency cur on dep.deposito_currency_id = cur.currency_id where dep.deposito_estado = _const.maguita_deposito_estado_ativo and dep._branch_uid = branch group by dep.deposito_caixa_id, dep.deposito_currency_id, cur.currency_id, cur.currency_name, cur.currency_code ),__deposito_caixa as ( select dep.deposito_caixa_id, sum( dep.deposito_montantefinal ) as deposito_montantefinal, jsonb_object_agg( dep.currency_code, jsonb_build_object( 'deposito_montantemoeda', deposito_montantemoeda, 'deposito_montantefinal', deposito_montantefinal, 'deposito_montante', deposito_montante, 'deposito_montantetroco', deposito_montantetroco ) ) as deposito_montantemoeda, sum( dep.deposito_montante ) as deposito_montante, sum( dep.deposito_montantefinal ) as deposito_montantefinal, sum( dep.deposito_montantetroco ) as deposito_montantetroco from __deposito dep group by dep.deposito_caixa_id ),__posto as ( select c.caixa_id, c.caixa_estado, c.caixa_montanteinicial, c.caixa_montanteinicialposto, p.posto_caixamode, dep.* from tweeks.posto p inner join tweeks.caixa c on p.posto_id = c.caixa_posto_id and c.caixa_estado = _const.maguita_caixa_estado_ativo and case when p.posto_caixamode = _const.maguita_posto_caixamodo_pessoal then c.caixa_colaborador_id = arg_colaborador_id when p.posto_caixamode = _const.maguita_posto_caixamodo_espaco then c.caixa_espaco_auth = arg_espaco_auth when p.posto_caixamode = _const.maguita_posto_caixamodo_posto then c.caixa_posto_id = arg_posto_id else false end left join __deposito_caixa dep on c.caixa_id = dep.deposito_caixa_id where p.posto_id = arg_posto_id and p._branch_uid = branch and c._branch_uid = branch ) select to_jsonb( p ) from __posto p; end; $$; create or replace function tweeks.funct_pos_report_venda( args jsonb ) returns setof jsonb language plpgsql as $$ declare arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; arg_posto_id uuid default args->>'arg_posto_id'; arg_date_start date default args->>'arg_date_start'; arg_date_end date default args->>'arg_date_end'; branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _const map.constant; begin _const := map.constant(); return query with __venda as ( select art.artigo_id, art.artigo_nome, v.venda_custounitario, sum( v.venda_quantidade ) as venda_quantidade, sum( v.venda_montantecomimposto ) as venda_montantecomimposto, sum( v.venda_montantesemimposto ) as venda_montantesemimposto from tweeks.venda v inner join tweeks.artigo art on v.venda_artigo_id = art.artigo_id inner join tweeks.conta ct on v.venda_conta_id = ct.conta_id where v._branch_uid = branch and v.venda_estado = _const.maguita_venda_estado_fechado and ct.conta_estado = _const.maguita_conta_estado_fechado and ct.conta_datafecho::date >= coalesce( arg_date_start, ct.conta_datafecho::date ) and ct.conta_datafecho::date <= coalesce( arg_date_end, ct.conta_datafecho::date ) and ct.conta_posto_fecho = arg_posto_id group by art.artigo_id, v.venda_custounitario ) select to_jsonb( v2 ) from __venda v2 ; end; $$
58697449-3020-4d75-9db7-56f2138218a6	\n    create OR REPLACE function tweeks.funct_pos_load_conta_dia(filter jsonb DEFAULT NULL::jsonb) returns SETOF jsonb\n        language plpgsql\n    as\n    $$\n    declare\n        /** Essa função serve para devolver as compras do dia em uma data especifica\n          filter := {\n            arg_conta_data: DATE\n            arg_posto_id: DATE\n          }\n         */\n        _const map.constant;\n        arg_conta_data date default filter->>'arg_conta_data';\n        arg_posto_id uuid not null default filter->>'arg_posto_id';\n    begin\n\n        _const := map.constant();\n        arg_conta_data := coalesce( arg_conta_data, current_date );\n\n        if arg_conta_data < current_date - make_interval( days := 7 ) then return; end if;\n\n        return query\n            with __conta as (\n                select\n                    ct.conta_id,\n                    ct.conta_data,\n                    ct.conta_dataregistro,\n                    ct.conta_titular,\n                    ct.conta_titularnif,\n                    ct.conta_montante,\n                    ct.conta_numerofatura,\n                    ct.conta_numero,\n                    p.posto_designacao,\n                    p.posto_matricula,\n                    de.deposito_montante,\n                    de.deposito_montantemoeda,\n                    de.deposito_montantetroco,\n                    de.deposito_montantefinal,\n                    de.deposito_taxacambio,\n                    cu.currency_id,\n                    cu.currency_code,\n                    cu.currency_name,\n                    co.colaborador_id,\n                    co.colaborador_nome\n                from tweeks.conta ct\n                         inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id\n                         inner join tweeks.deposito de on ( de.deposito_referencia->>'conta_id' )::uuid = ct.conta_id\n                         inner join geoinfo.currency cu on de.deposito_currency_id = cu.currency_id\n                         inner join auth.colaborador co on ct.conta_colaborador_fecho = co.colaborador_id\n                where ct.conta_posto_fecho = arg_posto_id\n                  and ct.conta_estado = _const.maguita_conta_estado_fechado\n                  and ct._tgrupo_id = _const.maguita_tgrupo_cnormal\n                  and ct.conta_datafecho = arg_conta_data\n            ) select to_jsonb( _ct )\n            from __conta _ct\n        ;\n    end\n    $$;\n	create OR REPLACE function tweeks.funct_pos_load_conta_dia(filter jsonb DEFAULT NULL::jsonb) returns SETOF jsonb language plpgsql as $$ declare /** Essa função serve para devolver as compras do dia em uma data especifica filter := { arg_conta_data: DATE arg_posto_id: DATE } */ _const map.constant; arg_conta_data date default filter->>'arg_conta_data'; arg_posto_id uuid not null default filter->>'arg_posto_id'; begin _const := map.constant(); arg_conta_data := coalesce( arg_conta_data, current_date ); if arg_conta_data < current_date - make_interval( days := 7 ) then return; end if; return query with __conta as ( select ct.conta_id, ct.conta_data, ct.conta_dataregistro, ct.conta_titular, ct.conta_titularnif, ct.conta_montante, ct.conta_numerofatura, ct.conta_numero, p.posto_designacao, p.posto_matricula, de.deposito_montante, de.deposito_montantemoeda, de.deposito_montantetroco, de.deposito_montantefinal, de.deposito_taxacambio, cu.currency_id, cu.currency_code, cu.currency_name, co.colaborador_id, co.colaborador_nome from tweeks.conta ct inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id inner join tweeks.deposito de on ( de.deposito_referencia->>'conta_id' )::uuid = ct.conta_id inner join geoinfo.currency cu on de.deposito_currency_id = cu.currency_id inner join auth.colaborador co on ct.conta_colaborador_fecho = co.colaborador_id where ct.conta_posto_fecho = arg_posto_id and ct.conta_estado = _const.maguita_conta_estado_fechado and ct._tgrupo_id = _const.maguita_tgrupo_cnormal and ct.conta_datafecho = arg_conta_data ) select to_jsonb( _ct ) from __conta _ct ; end $$;
5f52e49d-21c6-4562-919f-e2822fc19813	\n    with __keep_schare as (\n        select n.share_regclass\n        from unnest(array[\n            'auth.colaborador',\n            'auth.perfil',\n            'tweeks.espaco',\n            'auth.acesso',\n            'auth.privilegio',\n            'tweeks.trabalha',\n            'cluster.branch',\n            'tweeks.branch',\n            'tweeks.classe',\n            'cluster.resource',\n            'tweeks.cambio'\n            ]::text[] ) n( share_regclass )\n    )\n    delete from cluster.object o\n    where o.object_share_regclass not in (\n        select share_regclass\n        from __keep_schare\n    );\n\n\n    with __keep_schare as (\n        select n.share_regclass\n        from unnest(array[\n            'auth.colaborador',\n            'auth.perfil',\n            'tweeks.espaco',\n            'auth.acesso',\n            'auth.privilegio',\n            'tweeks.trabalha',\n            'cluster.branch',\n            'tweeks.branch',\n            'tweeks.classe',\n            'cluster.resource',\n            'tweeks.cambio'\n            ]::text[] ) n( share_regclass )\n    ) delete from cluster.collector o\n    where o.collector_share_regclass not in (\n        select share_regclass\n        from __keep_schare\n    );\n\n\n    with __keep_schare as (\n        select n.share_regclass\n        from unnest(array[\n            'auth.colaborador',\n            'auth.perfil',\n            'tweeks.espaco',\n            'auth.acesso',\n            'auth.privilegio',\n            'tweeks.trabalha',\n            'cluster.branch',\n            'tweeks.branch',\n            'tweeks.classe',\n            'cluster.resource',\n            'tweeks.cambio'\n            ]::text[] ) n( share_regclass )\n    ) delete from cluster.version o\n    where o.version_share_regclass not in (\n        select share_regclass\n        from __keep_schare\n    );\n\n    with __keep_schare as (\n        select n.share_regclass\n        from unnest(array[\n            'auth.colaborador',\n            'auth.perfil',\n            'tweeks.espaco',\n            'auth.acesso',\n            'auth.privilegio',\n            'tweeks.trabalha',\n            'cluster.branch',\n            'tweeks.branch',\n            'tweeks.classe',\n            'cluster.resource',\n            'tweeks.cambio'\n            ]::text[] ) n( share_regclass )\n    ) delete from cluster.share o\n    where o.share_regclass not in (\n        select share_regclass\n        from __keep_schare\n    );\n	with __keep_schare as ( select n.share_regclass from unnest(array[ 'auth.colaborador', 'auth.perfil', 'tweeks.espaco', 'auth.acesso', 'auth.privilegio', 'tweeks.trabalha', 'cluster.branch', 'tweeks.branch', 'tweeks.classe', 'cluster.resource', 'tweeks.cambio' ]::text[] ) n( share_regclass ) ) delete from cluster.object o where o.object_share_regclass not in ( select share_regclass from __keep_schare ); with __keep_schare as ( select n.share_regclass from unnest(array[ 'auth.colaborador', 'auth.perfil', 'tweeks.espaco', 'auth.acesso', 'auth.privilegio', 'tweeks.trabalha', 'cluster.branch', 'tweeks.branch', 'tweeks.classe', 'cluster.resource', 'tweeks.cambio' ]::text[] ) n( share_regclass ) ) delete from cluster.collector o where o.collector_share_regclass not in ( select share_regclass from __keep_schare ); with __keep_schare as ( select n.share_regclass from unnest(array[ 'auth.colaborador', 'auth.perfil', 'tweeks.espaco', 'auth.acesso', 'auth.privilegio', 'tweeks.trabalha', 'cluster.branch', 'tweeks.branch', 'tweeks.classe', 'cluster.resource', 'tweeks.cambio' ]::text[] ) n( share_regclass ) ) delete from cluster.version o where o.version_share_regclass not in ( select share_regclass from __keep_schare ); with __keep_schare as ( select n.share_regclass from unnest(array[ 'auth.colaborador', 'auth.perfil', 'tweeks.espaco', 'auth.acesso', 'auth.privilegio', 'tweeks.trabalha', 'cluster.branch', 'tweeks.branch', 'tweeks.classe', 'cluster.resource', 'tweeks.cambio' ]::text[] ) n( share_regclass ) ) delete from cluster.share o where o.share_regclass not in ( select share_regclass from __keep_schare );
f60009fa-2cf6-4641-a31e-76115ac0dfd8	\nalter table tweeks.conta drop constraint if exists uk_conta_chave;\nalter table tweeks.conta add constraint uk_conta_chave unique ( conta_chave, _branch_uid );\n	alter table tweeks.conta drop constraint if exists uk_conta_chave; alter table tweeks.conta add constraint uk_conta_chave unique ( conta_chave, _branch_uid );
74b907a2-4282-4507-9728-4f55731e1d9c	\ncreate or replace function tweeks.__fluxo_scan( _artigo_id uuid DEFAULT NULL::uuid, _espaco_id uuid DEFAULT NULL::uuid, _resume boolean DEFAULT true, _branch uuid DEFAULT NULL::uuid)\n  returns TABLE(fluxo_artigo_id uuid, fluxo_espaco_id uuid, fluxo_preview double precision, fluxo_resultado double precision, fluxo_checkmarks uuid, fluxo_check double precision, fluxo_order bigint, fluxo_end bigint, fluxo_resume boolean, fluxo_credito double precision, fluxo_debito double precision, fluxo_calc double precision, fluxo_quantidade double precision, fluxo_id uuid, fluxo_date timestamp with time zone, fluxo_sequencia bigint)\n  language sql\nas\n$$\nwith recursive\n  __map as ( select maguita_fluxo_estado_ativo, maguita_fluxo_estado_fechado, maguita_fluxo_estado_anulado from map.constant()\n\n  ), __espaco as (\n    select a.espaco_id\n      from tweeks.espaco a\n      where a.espaco_id = coalesce( _espaco_id, a.espaco_id )\n      and a._branch_uid = coalesce( _branch, a._branch_uid )\n  ), __artigo as (\n    select a.artigo_id\n      from tweeks.artigo a\n      where a.artigo_id = coalesce( _artigo_id, a.artigo_id )\n      and a._branch_uid = coalesce( _branch, a._branch_uid )\n ), __stock_point as(\n    select\n      a.artigo_id,\n      e.espaco_id,\n      mode() within group ( order by f.fluxo_dataregistro desc ) as point\n    from tweeks.fluxo f\n      inner join __map _const on f.fluxo_estado = _const.maguita_fluxo_estado_ativo\n      inner join __artigo a on a.artigo_id in ( f.fluxo_artigo_in, f.fluxo_artigo_out )\n      inner join __espaco e on e.espaco_id in ( f.fluxo_espaco_in, f.fluxo_espaco_out )\n    where f.fluxo_checkpoint = 0\n      and f._branch_uid = coalesce( _branch, f._branch_uid )\n      and f.fluxo_estado = _const.maguita_fluxo_estado_ativo\n    group by a.artigo_id,\n      e.espaco_id\n  ),\n  __fluxo as (\n    select\n      a.artigo_id,\n      e.espaco_id,\n      f.fluxo_id,\n      f.fluxo_dataregistro,\n      f.fluxo_sequencia,\n      f.fluxo_checkpoint,\n      case\n        when e.espaco_id = f.fluxo_espaco_in and a.artigo_id = f.fluxo_artigo_in then f.fluxo_quantidadein\n        else 0\n        end as fluxo_credito,\n      case\n        when e.espaco_id = f.fluxo_espaco_out and a.artigo_id = f.fluxo_artigo_out then f.fluxo_quantidadeout\n        else 0\n        end as fluxo_debito,\n      case\n        when f.fluxo_quantidadefinal is not null then f.fluxo_quantidadefinal\n        when e.espaco_id = f.fluxo_espaco_in and a.artigo_id = f.fluxo_artigo_in then f.fluxo_quantidadein * 1\n        when e.espaco_id = f.fluxo_espaco_out and a.artigo_id = f.fluxo_artigo_out then f.fluxo_quantidadeout * -1\n        end as fluxo_quantidade,\n      row_number() over ( partition by a.artigo_id, e.espaco_id ) as fluxo_order,\n      count( f.fluxo_id ) over ( partition by a.artigo_id, e.espaco_id ) as fluxo_end\n\n    from tweeks.fluxo f\n      inner join __map _const on f.fluxo_estado = _const.maguita_fluxo_estado_ativo\n      inner join __artigo a on a.artigo_id in ( f.fluxo_artigo_in, f.fluxo_artigo_out )\n      inner join __espaco e on e.espaco_id in ( f.fluxo_espaco_in, f.fluxo_espaco_out )\n      left join __stock_point _sp on _sp.artigo_id = a.artigo_id and _sp.espaco_id = e.espaco_id\n    where  f.fluxo_dataregistro >= coalesce( _sp.point, f.fluxo_dataregistro )\n      and f._branch_uid = coalesce( _branch, f._branch_uid )\n    order by a.artigo_id,\n      e.espaco_id,\n      f.fluxo_dataregistro,\n      f.fluxo_sequencia\n  ), __fluxo_stock as (\n  select\n    _f.artigo_id,\n    _f.espaco_id,\n    _f.fluxo_order,\n    _f.fluxo_end,\n    _f.fluxo_credito,\n    _f.fluxo_debito,\n    _f.fluxo_quantidade,\n    _f.fluxo_id,\n--     _f.fluxo_dataregistro,\n--     _f.fluxo_sequencia,\n\n    _f.fluxo_quantidade as fluxo_resultado,\n    0.0::double precision as fluxo_preview,\n--     _f.fluxo_id as fluxo_checkmarks,\n--     _f.fluxo_quantidade as fluxo_checkquant,\n    _f.fluxo_order = _f.fluxo_end as fluxo_resume\n  from __fluxo _f\n    inner join __map _const on true\n  where _f.fluxo_order = 1\n  union all\n  select\n    _f.artigo_id,\n    _f.espaco_id,\n    _f.fluxo_order,\n    _f.fluxo_end,\n    _f.fluxo_credito,\n    _f.fluxo_debito,\n    _f.fluxo_quantidade,\n    _f.fluxo_id,\n--     _f.fluxo_dataregistro,\n--     _f.fluxo_sequencia,\n    \n    ( _fs.fluxo_resultado * _f.fluxo_checkpoint ) + ( _f.fluxo_quantidade ),\n    _fs.fluxo_resultado as fluxo_priview,\n--     case\n--       when _f.fluxo_checkpoint = 0 then _f.fluxo_id\n--       else _fs.fluxo_checkmarks\n--       end,\n--     case\n--       when _f.fluxo_checkpoint = 0 then _f.fluxo_quantidade\n--       else _fs.fluxo_checkquant\n--       end,\n    _f.fluxo_order = _f.fluxo_end as fluxo_resume\n\n  from __fluxo_stock _fs\n    inner join __fluxo _f on _fs.espaco_id = _f.espaco_id\n        and _fs.artigo_id = _f.artigo_id\n        and _fs.fluxo_order +1 = _f.fluxo_order\n) select\n    _fs.artigo_id as stock_artigo_id,\n    _fs.espaco_id as stock_espaco_id,\n    _fs.fluxo_preview,\n    _fs.fluxo_resultado,\n\n    null::uuid as fluxo_checkmarks,--     _fs.fluxo_checkmarks,\n    null::double precision as fluxo_checkquant, --     _fs.fluxo_checkquant,\n    _fs.fluxo_order,\n    _fs.fluxo_end,\n    _fs.fluxo_resume,\n\n    _fs.fluxo_credito,\n    _fs.fluxo_debito,\n    _fs.fluxo_credito - _fs.fluxo_debito,\n    _fs.fluxo_quantidade,\n    _fs.fluxo_id,\n    null::timestamptz, ---_fs.fluxo_dataregistro,\n    null::int8 -- _fs.fluxo_sequencia\nfrom __fluxo_stock _fs\nwhere true in (\n    coalesce( _resume, true ) = _fs.fluxo_resume,\n    not _resume\n  )\n$$;\n\n	create or replace function tweeks.__fluxo_scan( _artigo_id uuid DEFAULT NULL::uuid, _espaco_id uuid DEFAULT NULL::uuid, _resume boolean DEFAULT true, _branch uuid DEFAULT NULL::uuid) returns TABLE(fluxo_artigo_id uuid, fluxo_espaco_id uuid, fluxo_preview double precision, fluxo_resultado double precision, fluxo_checkmarks uuid, fluxo_check double precision, fluxo_order bigint, fluxo_end bigint, fluxo_resume boolean, fluxo_credito double precision, fluxo_debito double precision, fluxo_calc double precision, fluxo_quantidade double precision, fluxo_id uuid, fluxo_date timestamp with time zone, fluxo_sequencia bigint) language sql as $$ with recursive __map as ( select maguita_fluxo_estado_ativo, maguita_fluxo_estado_fechado, maguita_fluxo_estado_anulado from map.constant() ), __espaco as ( select a.espaco_id from tweeks.espaco a where a.espaco_id = coalesce( _espaco_id, a.espaco_id ) and a._branch_uid = coalesce( _branch, a._branch_uid ) ), __artigo as ( select a.artigo_id from tweeks.artigo a where a.artigo_id = coalesce( _artigo_id, a.artigo_id ) and a._branch_uid = coalesce( _branch, a._branch_uid ) ), __stock_point as( select a.artigo_id, e.espaco_id, mode() within group ( order by f.fluxo_dataregistro desc ) as point from tweeks.fluxo f inner join __map _const on f.fluxo_estado = _const.maguita_fluxo_estado_ativo inner join __artigo a on a.artigo_id in ( f.fluxo_artigo_in, f.fluxo_artigo_out ) inner join __espaco e on e.espaco_id in ( f.fluxo_espaco_in, f.fluxo_espaco_out ) where f.fluxo_checkpoint = 0 and f._branch_uid = coalesce( _branch, f._branch_uid ) and f.fluxo_estado = _const.maguita_fluxo_estado_ativo group by a.artigo_id, e.espaco_id ), __fluxo as ( select a.artigo_id, e.espaco_id, f.fluxo_id, f.fluxo_dataregistro, f.fluxo_sequencia, f.fluxo_checkpoint, case when e.espaco_id = f.fluxo_espaco_in and a.artigo_id = f.fluxo_artigo_in then f.fluxo_quantidadein else 0 end as fluxo_credito, case when e.espaco_id = f.fluxo_espaco_out and a.artigo_id = f.fluxo_artigo_out then f.fluxo_quantidadeout else 0 end as fluxo_debito, case when f.fluxo_quantidadefinal is not null then f.fluxo_quantidadefinal when e.espaco_id = f.fluxo_espaco_in and a.artigo_id = f.fluxo_artigo_in then f.fluxo_quantidadein * 1 when e.espaco_id = f.fluxo_espaco_out and a.artigo_id = f.fluxo_artigo_out then f.fluxo_quantidadeout * -1 end as fluxo_quantidade, row_number() over ( partition by a.artigo_id, e.espaco_id ) as fluxo_order, count( f.fluxo_id ) over ( partition by a.artigo_id, e.espaco_id ) as fluxo_end from tweeks.fluxo f inner join __map _const on f.fluxo_estado = _const.maguita_fluxo_estado_ativo inner join __artigo a on a.artigo_id in ( f.fluxo_artigo_in, f.fluxo_artigo_out ) inner join __espaco e on e.espaco_id in ( f.fluxo_espaco_in, f.fluxo_espaco_out ) left join __stock_point _sp on _sp.artigo_id = a.artigo_id and _sp.espaco_id = e.espaco_id where f.fluxo_dataregistro >= coalesce( _sp.point, f.fluxo_dataregistro ) and f._branch_uid = coalesce( _branch, f._branch_uid ) order by a.artigo_id, e.espaco_id, f.fluxo_dataregistro, f.fluxo_sequencia ), __fluxo_stock as ( select _f.artigo_id, _f.espaco_id, _f.fluxo_order, _f.fluxo_end, _f.fluxo_credito, _f.fluxo_debito, _f.fluxo_quantidade, _f.fluxo_id, -- _f.fluxo_dataregistro, -- _f.fluxo_sequencia, _f.fluxo_quantidade as fluxo_resultado, 0.0::double precision as fluxo_preview, -- _f.fluxo_id as fluxo_checkmarks, -- _f.fluxo_quantidade as fluxo_checkquant, _f.fluxo_order = _f.fluxo_end as fluxo_resume from __fluxo _f inner join __map _const on true where _f.fluxo_order = 1 union all select _f.artigo_id, _f.espaco_id, _f.fluxo_order, _f.fluxo_end, _f.fluxo_credito, _f.fluxo_debito, _f.fluxo_quantidade, _f.fluxo_id, -- _f.fluxo_dataregistro, -- _f.fluxo_sequencia, ( _fs.fluxo_resultado * _f.fluxo_checkpoint ) + ( _f.fluxo_quantidade ), _fs.fluxo_resultado as fluxo_priview, -- case -- when _f.fluxo_checkpoint = 0 then _f.fluxo_id -- else _fs.fluxo_checkmarks -- end, -- case -- when _f.fluxo_checkpoint = 0 then _f.fluxo_quantidade -- else _fs.fluxo_checkquant -- end, _f.fluxo_order = _f.fluxo_end as fluxo_resume from __fluxo_stock _fs inner join __fluxo _f on _fs.espaco_id = _f.espaco_id and _fs.artigo_id = _f.artigo_id and _fs.fluxo_order +1 = _f.fluxo_order ) select _fs.artigo_id as stock_artigo_id, _fs.espaco_id as stock_espaco_id, _fs.fluxo_preview, _fs.fluxo_resultado, null::uuid as fluxo_checkmarks,-- _fs.fluxo_checkmarks, null::double precision as fluxo_checkquant, -- _fs.fluxo_checkquant, _fs.fluxo_order, _fs.fluxo_end, _fs.fluxo_resume, _fs.fluxo_credito, _fs.fluxo_debito, _fs.fluxo_credito - _fs.fluxo_debito, _fs.fluxo_quantidade, _fs.fluxo_id, null::timestamptz, ---_fs.fluxo_dataregistro, null::int8 -- _fs.fluxo_sequencia from __fluxo_stock _fs where true in ( coalesce( _resume, true ) = _fs.fluxo_resume, not _resume ) $$;
33195baf-9fcf-4a90-9fac-f024f4392285	\ncreate or replace function tweeks.__fluxo_stock( _artigo_uid uuid default null, _espaco_uid uuid default null, _classe_uid uuid default null, _branch uuid default null)\n  returns table(\n    espaco_id uuid,\n    artigo_id uuid,\n    stock_quantidade double precision\n)\n  language sql as $$\n    with  __artigo as (\n      select a.artigo_id\n        from tweeks.artigo a\n      where a.artigo_id = coalesce( _artigo_uid, a.artigo_id )\n        and a.artigo_classe_id = coalesce( _classe_uid, a.artigo_classe_id )\n        and a._branch_uid = coalesce( _branch, a._branch_uid )\n        and not a.artigo_stocknegativo\n    ), __espaco as (\n      select e.espaco_id\n        from tweeks.espaco e\n        where e.espaco_id = coalesce( _espaco_uid, e.espaco_id )\n          and e._branch_uid = coalesce( _branch, e._branch_uid )\n    ), __fluxo as (\n      select\n          a.artigo_id,\n          e.espaco_id,\n          f.fluxo_id,\n          f.fluxo_sequencia,\n          f.fluxo_dataregistro,\n          f.fluxo_quantidadefinal,\n          f.fluxo_quantidadein,\n          f.fluxo_quantidadeout,\n          f.fluxo_artigo_in as artigo_in,\n          f.fluxo_artigo_out as artigo_out,\n          f.fluxo_espaco_out as espaco_out,\n          f.fluxo_espaco_in as espaco_in,\n          f.fluxo_checkpoint\n        from tweeks.fluxo f\n          inner join __espaco e on e.espaco_id  in ( f.fluxo_espaco_in, f.fluxo_espaco_out)\n          inner join __artigo a on a.artigo_id in ( f.fluxo_artigo_in, f.fluxo_artigo_out )\n        where f._branch_uid = coalesce( _branch, f._branch_uid )\n    ), __check_point as (\n      select\n          f.artigo_id,\n          f.espaco_id,\n          f.fluxo_id,\n          f.fluxo_dataregistro,\n          f.fluxo_quantidadefinal,\n          rank() over ( partition by f.artigo_id, f.espaco_id order by f.fluxo_dataregistro desc , f.fluxo_sequencia desc ) as fluxo_rank\n        from __fluxo f\n        where f.fluxo_checkpoint = 0\n    ), __sumary as (\n      select\n        f.artigo_id,\n        f.espaco_id,\n        coalesce(\n            sum( f.fluxo_quantidadein ) filter ( where f.artigo_id = f.artigo_in and f.espaco_id = f.espaco_in ),\n            0\n        ) + coalesce( cp.fluxo_quantidadefinal, 0.0 ) as credito,\n        coalesce(\n            sum( f.fluxo_quantidadeout ) filter ( where f.artigo_id = f.artigo_out and f.espaco_id = f.espaco_out ),\n            0\n        ) + coalesce( cp.fluxo_quantidadefinal, 0.0 ) as debigo\n      from __fluxo f\n        left join __check_point cp on  f.artigo_id = cp.artigo_id\n          and f.espaco_id = cp.espaco_id\n          and cp.fluxo_rank = 1\n        where (f.fluxo_dataregistro > cp.fluxo_dataregistro)\n           or cp.fluxo_id is null\n        group by\n          f.artigo_id,\n          f.espaco_id,\n          cp.fluxo_quantidadefinal\n    ) select\n          s.espaco_id,\n          s.artigo_id,\n          s.credito - s.debigo as stock\n        from __sumary s\n    ;\n  $$;\n	create or replace function tweeks.__fluxo_stock( _artigo_uid uuid default null, _espaco_uid uuid default null, _classe_uid uuid default null, _branch uuid default null) returns table( espaco_id uuid, artigo_id uuid, stock_quantidade double precision ) language sql as $$ with __artigo as ( select a.artigo_id from tweeks.artigo a where a.artigo_id = coalesce( _artigo_uid, a.artigo_id ) and a.artigo_classe_id = coalesce( _classe_uid, a.artigo_classe_id ) and a._branch_uid = coalesce( _branch, a._branch_uid ) and not a.artigo_stocknegativo ), __espaco as ( select e.espaco_id from tweeks.espaco e where e.espaco_id = coalesce( _espaco_uid, e.espaco_id ) and e._branch_uid = coalesce( _branch, e._branch_uid ) ), __fluxo as ( select a.artigo_id, e.espaco_id, f.fluxo_id, f.fluxo_sequencia, f.fluxo_dataregistro, f.fluxo_quantidadefinal, f.fluxo_quantidadein, f.fluxo_quantidadeout, f.fluxo_artigo_in as artigo_in, f.fluxo_artigo_out as artigo_out, f.fluxo_espaco_out as espaco_out, f.fluxo_espaco_in as espaco_in, f.fluxo_checkpoint from tweeks.fluxo f inner join __espaco e on e.espaco_id in ( f.fluxo_espaco_in, f.fluxo_espaco_out) inner join __artigo a on a.artigo_id in ( f.fluxo_artigo_in, f.fluxo_artigo_out ) where f._branch_uid = coalesce( _branch, f._branch_uid ) ), __check_point as ( select f.artigo_id, f.espaco_id, f.fluxo_id, f.fluxo_dataregistro, f.fluxo_quantidadefinal, rank() over ( partition by f.artigo_id, f.espaco_id order by f.fluxo_dataregistro desc , f.fluxo_sequencia desc ) as fluxo_rank from __fluxo f where f.fluxo_checkpoint = 0 ), __sumary as ( select f.artigo_id, f.espaco_id, coalesce( sum( f.fluxo_quantidadein ) filter ( where f.artigo_id = f.artigo_in and f.espaco_id = f.espaco_in ), 0 ) + coalesce( cp.fluxo_quantidadefinal, 0.0 ) as credito, coalesce( sum( f.fluxo_quantidadeout ) filter ( where f.artigo_id = f.artigo_out and f.espaco_id = f.espaco_out ), 0 ) + coalesce( cp.fluxo_quantidadefinal, 0.0 ) as debigo from __fluxo f left join __check_point cp on f.artigo_id = cp.artigo_id and f.espaco_id = cp.espaco_id and cp.fluxo_rank = 1 where (f.fluxo_dataregistro > cp.fluxo_dataregistro) or cp.fluxo_id is null group by f.artigo_id, f.espaco_id, cp.fluxo_quantidadefinal ) select s.espaco_id, s.artigo_id, s.credito - s.debigo as stock from __sumary s ; $$;
5b9aa3ca-b79e-469c-8dc0-edf2e3ca1b33	\ncreate or replace function tweeks.funct_load_artigo(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n    /**\n        Essa função serve para carregar os artigos registrado\n        args := {\n          arg_espaco_auth: ID\n          arg_colaborador_id: ID\n          arg_classe_id: ID\n          arg_artigo_estado: ARTIGO_ESTADO\n          query: {\n            any?: CODE|NAME|DESCRICAO\n            code?: CODE\n            name?: NAME\n            desc?: DESCRICAO\n          }\n        }\n   */\n    arg_espaco_auth uuid default args->>'arg_espaco_auth';\n    arg_colaborador_id uuid default args->>'arg_colaborador_id';\n    arg_espaco_childs uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth );\n    arg_classe_id uuid default args->>'arg_classe_id';\n    arg_artigo_estado int2 default args->>'arg_artigo_estado';\n\n    _query_any text  default lower( args->'query'->>'any' );\n    _query_code text default lower( args->'query'->>'code' );\n    _query_name text default lower( args->'query'->>'name' );\n    _query_desc text default lower( args->'query'->>'desc' );\n    _const map.constant;\n    _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\nbegin\n    _const := map.constant();\n\n    /**\n      ID, NOME, STOCK, PRECO, [STOK-MINIMO], FOTO\n     */\n    return query\n        with\n          __stock as (\n            select\n                artigo_id as stock_artigo_id,\n                espaco_id as stock_espaco_id,\n                stock_quantidade as stock_quantidade\n              from tweeks.__fluxo_stock(\n                _branch := _branch,\n                _espaco_uid := arg_espaco_auth,\n                _classe_uid := arg_classe_id\n              )\n          ), __artigo as (\n            select\n                art.artigo_id,\n                art.artigo_codigo,\n                art.artigo_descricao,\n                art.artigo_nome,\n                art.artigo_compostoquantidade,\n                art.artigo_artigo_id,\n                u.unit_id,\n                u.unit_code,\n                u.unit_name,\n                \n                uorig.unit_id as unit_originid,\n                uorig.unit_code as unit_origncode,\n                uorig.unit_name as unit_origenname,\n\n                art.artigo_espaco_auth = any( arg_espaco_childs ) as artigo_owner,\n                coalesce( s.stock_quantidade, 0 ) as stock_quantidade,\n                art.artigo_foto,\n                art.artigo_espaco_auth,\n                art.artigo_classe_id,\n                art.artigo_estado,\n                art.artigo_stocknegativo,\n                art.artigo_codigoimposto,\n                origin.artigo_id as origin_id,\n                origin.artigo_codigo as origin_codigo,\n                origin.artigo_descricao as orign_descricao,\n                origin.artigo_nome as origin_nome,\n                origin.artigo_compostoquantidade as orign_compostoquantidade,\n                origin.artigo_artigo_id as origin_origin_id,\n\n                coalesce( array_agg( l.link_espaco_destino ) filter ( where l.link_id is not null ), array[]::uuid[] )  as links,\n                ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'precario_custo' as precario_custo,\n                ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'precario_quantidade' as precario_quantidade,\n                ( ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'stock_minimo' )::double precision as link_stockminimo\n              from tweeks.artigo art\n                left join tweeks.unit u on art.artigo_unit_id = u.unit_id\n                left join tweeks.artigo origin on art.artigo_artigo_id = origin.artigo_id\n                left join tweeks.unit uorig on origin.artigo_unit_id = uorig.unit_id\n                left join tweeks.link l on l.link_estado = _const.maguita_link_estado_ativo\n                  and l.link_referencia = rule.artigo_referencia( art.artigo_id )\n                  and l.link_espaco_destino = any( arg_espaco_childs )\n                  and l.link_tlink_id = _const.maguita_tlink_preco\n                  and l._branch_uid = _branch\n                left join __stock s on art.artigo_id = s.stock_artigo_id and s.stock_espaco_id = arg_espaco_auth\n              where art._branch_uid = _branch\n              group by \n                art.artigo_id,\n                u.unit_id,\n                uorig.unit_id,\n                origin.artigo_id,\n                s.stock_quantidade\n          ), __filter as (\n            select *,\n                coalesce( art.link_stockminimo ) as stock_minimo\n              from __artigo art\n              where ( coalesce( art.links, array[]::uuid[] )||art.artigo_espaco_auth ) && arg_espaco_childs\n                and art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id )\n                and art.artigo_estado = coalesce( arg_artigo_estado, art.artigo_estado )\n         ), __filter_query as (\n            select *\n            from __filter f\n            where arg_classe_id is not null or f.artigo_classe_id != _const.classe_itemextra\n            order by\n              case\n                when f.artigo_estado = _const.artigo_estado_ativo then 1\n                else 2\n              end,\n              case\n                when f.artigo_espaco_auth = arg_espaco_auth then 1\n                when f.artigo_espaco_auth = any( arg_espaco_childs ) then 2\n                else 3\n              end,\n              case\n                when stock_quantidade < f.stock_minimo then 1\n                when stock_quantidade = f.stock_minimo then 2\n                else 3\n               end,\n               f.artigo_nome\n           ), __query as (\n             select *\n                from __filter_query _f\n                where true\n                  and lower( _f.artigo_codigo ) = lower( coalesce( _query_code, _f.artigo_codigo ) )\n                  and lower( _f.artigo_nome ) like lower( format( '%%%s%%', coalesce( _query_name, _f.artigo_nome ) ) )\n                  and lower( coalesce( _f.artigo_descricao, '' ) ) like lower( format( '%%%s%%', coalesce( _query_desc, _f.artigo_descricao ) ) )\n                  and (\n                    lower( _f.artigo_codigo ) = lower( coalesce( _query_any, _f.artigo_codigo ) )\n                    or lower( _f.artigo_nome) like lower( format( '%%%s%%', coalesce( _query_any, _f.artigo_nome ) ) )\n                    or lower( coalesce( _f.artigo_descricao, '' ) ) like lower( format( '%%%s%%', coalesce( _query_any, _f.artigo_descricao, '' ) ))\n                  )\n          ) select to_jsonb( _q ) - 'links'\n              from __query _q\n    ;\nend\n$$;\n\n	create or replace function tweeks.funct_load_artigo(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** Essa função serve para carregar os artigos registrado args := { arg_espaco_auth: ID arg_colaborador_id: ID arg_classe_id: ID arg_artigo_estado: ARTIGO_ESTADO query: { any?: CODE|NAME|DESCRICAO code?: CODE name?: NAME desc?: DESCRICAO } } */ arg_espaco_auth uuid default args->>'arg_espaco_auth'; arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_espaco_childs uuid[] default rule.espaco_get_childrens_static( arg_espaco_auth ); arg_classe_id uuid default args->>'arg_classe_id'; arg_artigo_estado int2 default args->>'arg_artigo_estado'; _query_any text default lower( args->'query'->>'any' ); _query_code text default lower( args->'query'->>'code' ); _query_name text default lower( args->'query'->>'name' ); _query_desc text default lower( args->'query'->>'desc' ); _const map.constant; _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); begin _const := map.constant(); /** ID, NOME, STOCK, PRECO, [STOK-MINIMO], FOTO */ return query with __stock as ( select artigo_id as stock_artigo_id, espaco_id as stock_espaco_id, stock_quantidade as stock_quantidade from tweeks.__fluxo_stock( _branch := _branch, _espaco_uid := arg_espaco_auth, _classe_uid := arg_classe_id ) ), __artigo as ( select art.artigo_id, art.artigo_codigo, art.artigo_descricao, art.artigo_nome, art.artigo_compostoquantidade, art.artigo_artigo_id, u.unit_id, u.unit_code, u.unit_name, uorig.unit_id as unit_originid, uorig.unit_code as unit_origncode, uorig.unit_name as unit_origenname, art.artigo_espaco_auth = any( arg_espaco_childs ) as artigo_owner, coalesce( s.stock_quantidade, 0 ) as stock_quantidade, art.artigo_foto, art.artigo_espaco_auth, art.artigo_classe_id, art.artigo_estado, art.artigo_stocknegativo, art.artigo_codigoimposto, origin.artigo_id as origin_id, origin.artigo_codigo as origin_codigo, origin.artigo_descricao as orign_descricao, origin.artigo_nome as origin_nome, origin.artigo_compostoquantidade as orign_compostoquantidade, origin.artigo_artigo_id as origin_origin_id, coalesce( array_agg( l.link_espaco_destino ) filter ( where l.link_id is not null ), array[]::uuid[] ) as links, ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'precario_custo' as precario_custo, ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'precario_quantidade' as precario_quantidade, ( ( lib.first( l.link_metadata ) filter ( where l.link_espaco_destino = arg_espaco_auth ) )->>'stock_minimo' )::double precision as link_stockminimo from tweeks.artigo art left join tweeks.unit u on art.artigo_unit_id = u.unit_id left join tweeks.artigo origin on art.artigo_artigo_id = origin.artigo_id left join tweeks.unit uorig on origin.artigo_unit_id = uorig.unit_id left join tweeks.link l on l.link_estado = _const.maguita_link_estado_ativo and l.link_referencia = rule.artigo_referencia( art.artigo_id ) and l.link_espaco_destino = any( arg_espaco_childs ) and l.link_tlink_id = _const.maguita_tlink_preco and l._branch_uid = _branch left join __stock s on art.artigo_id = s.stock_artigo_id and s.stock_espaco_id = arg_espaco_auth where art._branch_uid = _branch group by art.artigo_id, u.unit_id, uorig.unit_id, origin.artigo_id, s.stock_quantidade ), __filter as ( select *, coalesce( art.link_stockminimo ) as stock_minimo from __artigo art where ( coalesce( art.links, array[]::uuid[] )||art.artigo_espaco_auth ) && arg_espaco_childs and art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id ) and art.artigo_estado = coalesce( arg_artigo_estado, art.artigo_estado ) ), __filter_query as ( select * from __filter f where arg_classe_id is not null or f.artigo_classe_id != _const.classe_itemextra order by case when f.artigo_estado = _const.artigo_estado_ativo then 1 else 2 end, case when f.artigo_espaco_auth = arg_espaco_auth then 1 when f.artigo_espaco_auth = any( arg_espaco_childs ) then 2 else 3 end, case when stock_quantidade < f.stock_minimo then 1 when stock_quantidade = f.stock_minimo then 2 else 3 end, f.artigo_nome ), __query as ( select * from __filter_query _f where true and lower( _f.artigo_codigo ) = lower( coalesce( _query_code, _f.artigo_codigo ) ) and lower( _f.artigo_nome ) like lower( format( '%%%s%%', coalesce( _query_name, _f.artigo_nome ) ) ) and lower( coalesce( _f.artigo_descricao, '' ) ) like lower( format( '%%%s%%', coalesce( _query_desc, _f.artigo_descricao ) ) ) and ( lower( _f.artigo_codigo ) = lower( coalesce( _query_any, _f.artigo_codigo ) ) or lower( _f.artigo_nome) like lower( format( '%%%s%%', coalesce( _query_any, _f.artigo_nome ) ) ) or lower( coalesce( _f.artigo_descricao, '' ) ) like lower( format( '%%%s%%', coalesce( _query_any, _f.artigo_descricao, '' ) )) ) ) select to_jsonb( _q ) - 'links' from __query _q ; end $$;
e4447b4b-bdcb-4fce-9441-43ab0e2daf16	\ncreate or replace function tweeks.funct_pos_load_artigo(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    args := {\n      arg_colaborador_id: UID,\n      arg_espaco_auth: UID\n      arg_classe_id: UID\n      arg_artigo_nome:TXT\n    }\n   */\n  arg_colaborador_id uuid default args->>'arg_colaborador_id';\n  arg_classe_id uuid default args->>'arg_classe_id';\n  arg_espaco_auth uuid default args->>'arg_espaco_auth';\n  _const map.constant;\n  _branch uuid not null default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\nbegin\n  _const := map.constant();\n  return query\n    \n    with __stock as (\n      select *\n        from tweeks.__fluxo_stock(\n          _classe_uid := arg_classe_id,\n          _branch := _branch\n        )\n    ), __artigo as (\n    select\n        art.artigo_id,\n        art.artigo_classe_id,\n        art.artigo_nome,\n        art.artigo_foto,\n        art.artigo_stocknegativo,\n        art.artigo_estado,\n        s.stock_quantidade,\n        l.link_metadata,\n        u.unit_id,\n        u.unit_code,\n        u.unit_name,\n        count( di.dispoe_id ) as artigos_extras\n      from tweeks.artigo art\n        inner join tweeks.link l on art.artigo_id =(  l.link_referencia->>'artigo_id' )::uuid\n          and l.link_estado = _const.maguita_link_estado_ativo\n          and l.link_tlink_id = _const.maguita_tlink_preco\n          and l.link_espaco_destino = arg_espaco_auth\n        left join __stock s on art.artigo_id = s.artigo_id and s.espaco_id = arg_espaco_auth\n        left join tweeks.dispoe di on art.artigo_id = di.dispoe_artigo_id\n          and di.dispoe_estado = _const.dispoe_estado_ativo\n        left join tweeks.unit u on art.artigo_unit_id = u.unit_id\n\n    where art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id )\n      group by art.artigo_id,\n        s.stock_quantidade,\n        l.link_metadata,\n        art.artigo_stocknegativo,\n        art.artigo_nome,\n        art.artigo_foto,\n        u.unit_id\n      order by case\n          when s.stock_quantidade > 0 or art.artigo_stocknegativo then 1\n          else 2\n        end,\n        art.artigo_nome\n  ) select to_jsonb( a ) from __artigo a;\nend;\n$$;\n	create or replace function tweeks.funct_pos_load_artigo(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** args := { arg_colaborador_id: UID, arg_espaco_auth: UID arg_classe_id: UID arg_artigo_nome:TXT } */ arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_classe_id uuid default args->>'arg_classe_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; _const map.constant; _branch uuid not null default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); begin _const := map.constant(); return query with __stock as ( select * from tweeks.__fluxo_stock( _classe_uid := arg_classe_id, _branch := _branch ) ), __artigo as ( select art.artigo_id, art.artigo_classe_id, art.artigo_nome, art.artigo_foto, art.artigo_stocknegativo, art.artigo_estado, s.stock_quantidade, l.link_metadata, u.unit_id, u.unit_code, u.unit_name, count( di.dispoe_id ) as artigos_extras from tweeks.artigo art inner join tweeks.link l on art.artigo_id =( l.link_referencia->>'artigo_id' )::uuid and l.link_estado = _const.maguita_link_estado_ativo and l.link_tlink_id = _const.maguita_tlink_preco and l.link_espaco_destino = arg_espaco_auth left join __stock s on art.artigo_id = s.artigo_id and s.espaco_id = arg_espaco_auth left join tweeks.dispoe di on art.artigo_id = di.dispoe_artigo_id and di.dispoe_estado = _const.dispoe_estado_ativo left join tweeks.unit u on art.artigo_unit_id = u.unit_id where art.artigo_classe_id = coalesce( arg_classe_id, art.artigo_classe_id ) group by art.artigo_id, s.stock_quantidade, l.link_metadata, art.artigo_stocknegativo, art.artigo_nome, art.artigo_foto, u.unit_id order by case when s.stock_quantidade > 0 or art.artigo_stocknegativo then 1 else 2 end, art.artigo_nome ) select to_jsonb( a ) from __artigo a; end; $$;
26d2eab9-a3f8-4456-b92c-1548e2fbba23	\ncreate or replace function tweeks.funct_pos_load_class(args jsonb) returns SETOF jsonb\n    language plpgsql\nas\n$$\ndeclare\n  /**\n    args := {\n      arg_espaco_auth: UID,\n      arg_colaborador_id: UID\n    }\n   */\n  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n  _branch uuid not null default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  _const map.constant;\nbegin\n  _const := map.constant();\n\n  return query with\n    __classe as (\n      select\n          c.classe_id,\n          c.classe_classe_id,\n          c.classe_nome,\n          c.classe_codigo,\n          c.classe_foto,\n          count( distinct lart.link_id ) filter ( where lart.link_id is not null ) as classe_artigos\n        from tweeks.classe c\n          inner join tweeks.link lcla on c.classe_id = (lcla.link_referencia->>'classe_id')::uuid\n            and lcla.link_estado = _const.maguita_link_estado_ativo\n          inner join tweeks.artigo art on c.classe_id = art.artigo_classe_id\n            and art.artigo_estado = _const.artigo_estado_ativo\n          inner join tweeks.link lart on art.artigo_id = ( lart.link_referencia->>'artigo_id' )::uuid\n            and lart.link_estado = _const.maguita_link_estado_ativo\n--             and lart.link_espaco_destino = artigo_espaco_auth\n        where lcla.link_espaco_destino = arg_espaco_auth\n          and lcla.link_tlink_id = _const.maguita_tlink_classe\n          and c._branch_uid = _branch\n          and art._branch_uid = _branch\n          and lcla._branch_uid = c._branch_uid\n          and lart._branch_uid = c._branch_uid\n        group by c.classe_id\n    ) select  to_jsonb( c )\n      from __classe c;\nend;\n$$;\n	create or replace function tweeks.funct_pos_load_class(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** args := { arg_espaco_auth: UID, arg_colaborador_id: UID } */ arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; _branch uuid not null default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _const map.constant; begin _const := map.constant(); return query with __classe as ( select c.classe_id, c.classe_classe_id, c.classe_nome, c.classe_codigo, c.classe_foto, count( distinct lart.link_id ) filter ( where lart.link_id is not null ) as classe_artigos from tweeks.classe c inner join tweeks.link lcla on c.classe_id = (lcla.link_referencia->>'classe_id')::uuid and lcla.link_estado = _const.maguita_link_estado_ativo inner join tweeks.artigo art on c.classe_id = art.artigo_classe_id and art.artigo_estado = _const.artigo_estado_ativo inner join tweeks.link lart on art.artigo_id = ( lart.link_referencia->>'artigo_id' )::uuid and lart.link_estado = _const.maguita_link_estado_ativo -- and lart.link_espaco_destino = artigo_espaco_auth where lcla.link_espaco_destino = arg_espaco_auth and lcla.link_tlink_id = _const.maguita_tlink_classe and c._branch_uid = _branch and art._branch_uid = _branch and lcla._branch_uid = c._branch_uid and lart._branch_uid = c._branch_uid group by c.classe_id ) select to_jsonb( c ) from __classe c; end; $$;
f0fb4869-49bd-49d4-aa39-e26afeea45b4	\ncreate or replace function tweeks.funct_load_classe(filter jsonb DEFAULT NULL::jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /** Essa função serve para carregar as listas de classes ativas\n    filter := {\n      arg_espaco_auth: ID\n    }\n  */\n  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';\n  arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth );\n  _const map.constant;\nbegin\n  _const := map.constant();\n\n  return query\n    with\n      __espaco as ( select e.espaco_id, e.espaco_nome from tweeks.espaco e),\n      __links as (\n        select\n            l.link_referencia,\n            l.link_espaco_destino,\n            array_agg( to_jsonb( e ) ) as espacos\n          from  __espaco e\n            inner join tweeks.link l on e.espaco_id = l.link_espaco_destino\n          where l.link_estado = _const.maguita_link_estado_ativo\n            and l.link_tlink_id = _const.maguita_tlink_classe\n          group by l.link_referencia,\n            l.link_espaco_destino\n\n        ),\n      __classe as (\n        select\n            cla.classe_id,\n            cla.classe_classe_id,\n            cla.classe_nome,\n            cla.classe_foto,\n            cla.classe_position,\n            jsonb_build_object(\n              'total', count( distinct atr.artigo_id ),\n              'ativos', count( distinct atr.artigo_id ) filter ( where atr.artigo_estado = _const.artigo_estado_ativo )\n            ) as artigos,\n            coalesce( l.espacos, array[]::jsonb[] ) as classe_espacos\n\n        from tweeks.classe cla\n          left join __links l on ( l.link_referencia->>'classe_id' )::uuid = cla.classe_id\n          left join tweeks.artigo atr on cla.classe_id = atr.artigo_classe_id\n        where cla.classe_estado = _const.classe_estado_ativo\n          and ( \n            cla.classe_espaco_auth = any( arg_espaco_child )\n              or l.link_espaco_destino = any( arg_espaco_child )\n              or cla.classe_id = _const.classe_itemextra\n          )\n        group by cla.classe_id, cla.classe_nome, l.espacos\n        order by\n          case\n            when cla.classe_id != _const.classe_itemextra then 1\n            else 2\n          end,\n          cla.classe_nome\n      ) select to_jsonb( c )\n          from __classe c\n    ;\nend;\n$$;\n	create or replace function tweeks.funct_load_classe(filter jsonb DEFAULT NULL::jsonb) returns SETOF jsonb language plpgsql as $$ declare /** Essa função serve para carregar as listas de classes ativas filter := { arg_espaco_auth: ID } */ arg_espaco_auth uuid not null default filter->>'arg_espaco_auth'; arg_espaco_child uuid[] default rule.espaco_get_childrens( arg_espaco_auth ); _const map.constant; begin _const := map.constant(); return query with __espaco as ( select e.espaco_id, e.espaco_nome from tweeks.espaco e), __links as ( select l.link_referencia, l.link_espaco_destino, array_agg( to_jsonb( e ) ) as espacos from __espaco e inner join tweeks.link l on e.espaco_id = l.link_espaco_destino where l.link_estado = _const.maguita_link_estado_ativo and l.link_tlink_id = _const.maguita_tlink_classe group by l.link_referencia, l.link_espaco_destino ), __classe as ( select cla.classe_id, cla.classe_classe_id, cla.classe_nome, cla.classe_foto, cla.classe_position, jsonb_build_object( 'total', count( distinct atr.artigo_id ), 'ativos', count( distinct atr.artigo_id ) filter ( where atr.artigo_estado = _const.artigo_estado_ativo ) ) as artigos, coalesce( l.espacos, array[]::jsonb[] ) as classe_espacos from tweeks.classe cla left join __links l on ( l.link_referencia->>'classe_id' )::uuid = cla.classe_id left join tweeks.artigo atr on cla.classe_id = atr.artigo_classe_id where cla.classe_estado = _const.classe_estado_ativo and ( cla.classe_espaco_auth = any( arg_espaco_child ) or l.link_espaco_destino = any( arg_espaco_child ) or cla.classe_id = _const.classe_itemextra ) group by cla.classe_id, cla.classe_nome, l.espacos order by case when cla.classe_id != _const.classe_itemextra then 1 else 2 end, cla.classe_nome ) select to_jsonb( c ) from __classe c ; end; $$;
6946b587-1f62-482b-93ce-1fb84be67689	\ncreate or replace function tweeks.funct_pos_load_artigo_search(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    args := {\n      search_text:TXT,\n      arg_espaco_auth\n    }\n   */\n  arg_espaco_auth uuid default args->>'arg_espaco_auth';\n  _search_text character varying default args->>'search_text';\n  _search_text_like character varying;\n  _const map.constant;\n  ___branch uuid;\nbegin\n  ___branch := tweeks.__branch_uid( null, arg_espaco_auth );\n  \n  _search_text := lib.str_nospace( lower( public.unaccent( _search_text ) ) );\n  _search_text_like := format( '%s%s%s', '%', _search_text, '%' );\n\n  _const := map.constant();\n  return query with\n    __ean as( select e.ean_artigo_id, array_agg( e.ean_code ) as ean_code from tweeks.ean e where e.ean_estado = _const.maguita_ean_estado_ativo group by e.ean_artigo_id ),\n    __artigo as (\n    select\n        c.classe_id,\n        c.classe_nome,\n        u.unit_id,\n        u.unit_code,\n        u.unit_name,\n        art.artigo_id,\n        art.artigo_classe_id,\n        art.artigo_nome,\n        art.artigo_codigo,\n        art.artigo_stocknegativo,\n        art.artigo_estado,\n        s.stock_quantidade,\n        l.link_metadata,\n        e.ean_code,\n        count( di.dispoe_id ) as artigos_extras\n      from tweeks.artigo art\n        inner join tweeks.classe c on art.artigo_classe_id = c.classe_id\n        inner join tweeks.link l on art.artigo_id =  ( l.link_referencia->>'artigo_id' )::uuid\n          and l.link_estado = _const.maguita_link_estado_ativo\n          and l.link_tlink_id = _const.maguita_tlink_preco\n          and l.link_espaco_destino = arg_espaco_auth\n        inner join tweeks.stock s on s.artigo_id = art.artigo_id\n          and s.espaco_id = arg_espaco_auth\n        left join tweeks.dispoe di on art.artigo_id = di.dispoe_artigo_id\n          and di.dispoe_estado = _const.dispoe_estado_ativo\n        left join __ean e on e.ean_artigo_id = art.artigo_id\n        left join tweeks.unit u on art.artigo_unit_id = u.unit_id\n\n    where art._branch_uid = ___branch\n      group by art.artigo_id,\n        c.classe_id,\n        u.unit_id,\n        s.stock_quantidade,\n        l.link_metadata,\n        art.artigo_stocknegativo,\n        art.artigo_nome,\n        e.ean_code\n      order by case\n          when s.stock_quantidade > 0 or art.artigo_stocknegativo then 1\n          else 2\n        end,\n        art.artigo_nome\n  ) select to_jsonb( a )\n      from __artigo a\n      where\n        lower( public.unaccent( a.artigo_nome ) )  like _search_text_like\n          or lower( public.unaccent( a.artigo_codigo ) )  like _search_text_like\n          or  _search_text = any ( a.ean_code )\n  ;\nend\n$$;\n	create or replace function tweeks.funct_pos_load_artigo_search(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** args := { search_text:TXT, arg_espaco_auth } */ arg_espaco_auth uuid default args->>'arg_espaco_auth'; _search_text character varying default args->>'search_text'; _search_text_like character varying; _const map.constant; ___branch uuid; begin ___branch := tweeks.__branch_uid( null, arg_espaco_auth ); _search_text := lib.str_nospace( lower( public.unaccent( _search_text ) ) ); _search_text_like := format( '%s%s%s', '%', _search_text, '%' ); _const := map.constant(); return query with __ean as( select e.ean_artigo_id, array_agg( e.ean_code ) as ean_code from tweeks.ean e where e.ean_estado = _const.maguita_ean_estado_ativo group by e.ean_artigo_id ), __artigo as ( select c.classe_id, c.classe_nome, u.unit_id, u.unit_code, u.unit_name, art.artigo_id, art.artigo_classe_id, art.artigo_nome, art.artigo_codigo, art.artigo_stocknegativo, art.artigo_estado, s.stock_quantidade, l.link_metadata, e.ean_code, count( di.dispoe_id ) as artigos_extras from tweeks.artigo art inner join tweeks.classe c on art.artigo_classe_id = c.classe_id inner join tweeks.link l on art.artigo_id = ( l.link_referencia->>'artigo_id' )::uuid and l.link_estado = _const.maguita_link_estado_ativo and l.link_tlink_id = _const.maguita_tlink_preco and l.link_espaco_destino = arg_espaco_auth inner join tweeks.stock s on s.artigo_id = art.artigo_id and s.espaco_id = arg_espaco_auth left join tweeks.dispoe di on art.artigo_id = di.dispoe_artigo_id and di.dispoe_estado = _const.dispoe_estado_ativo left join __ean e on e.ean_artigo_id = art.artigo_id left join tweeks.unit u on art.artigo_unit_id = u.unit_id where art._branch_uid = ___branch group by art.artigo_id, c.classe_id, u.unit_id, s.stock_quantidade, l.link_metadata, art.artigo_stocknegativo, art.artigo_nome, e.ean_code order by case when s.stock_quantidade > 0 or art.artigo_stocknegativo then 1 else 2 end, art.artigo_nome ) select to_jsonb( a ) from __artigo a where lower( public.unaccent( a.artigo_nome ) ) like _search_text_like or lower( public.unaccent( a.artigo_codigo ) ) like _search_text_like or _search_text = any ( a.ean_code ) ; end $$;
36a3408e-3eb3-4049-9374-aa991b7ea2e0	\ncreate or replace function tweeks.funct_pos_load_conta_dia(filter jsonb DEFAULT NULL::jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n    /** Essa função serve para devolver as compras do dia em uma data especifica\n      filter := {\n        arg_conta_data: DATE\n        arg_posto_id: DATE\n      }\n     */\n    _const map.constant;\n    arg_conta_data date default filter->>'arg_conta_data';\n    arg_posto_id uuid not null default filter->>'arg_posto_id';\nbegin\n\n    _const := map.constant();\n    arg_conta_data := coalesce( arg_conta_data, current_date );\n\n    if arg_conta_data < current_date - make_interval( days := 7 ) then return; end if;\n\n    return query\n        with __conta as (\n            select\n                ct.conta_id,\n                ct.conta_data,\n                ct.conta_dataregistro,\n                ct.conta_titular,\n                ct.conta_titularnif,\n                ct.conta_montante,\n                ct.conta_numerofatura,\n                ct.conta_numero,\n                p.posto_designacao,\n                p.posto_matricula,\n                de.deposito_montante,\n                de.deposito_montantemoeda,\n                de.deposito_montantetroco,\n                de.deposito_montantefinal,\n                de.deposito_taxacambio,\n                cu.currency_id,\n                cu.currency_code,\n                cu.currency_name,\n                co.colaborador_id,\n                co.colaborador_nome\n            from tweeks.conta ct\n                inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id\n                inner join tweeks.deposito de on ( de.deposito_referencia->>'conta_id' )::uuid = ct.conta_id\n                inner join geoinfo.currency cu on de.deposito_currency_id = cu.currency_id\n                inner join auth.colaborador co on ct.conta_colaborador_fecho = co.colaborador_id\n            where ct.conta_posto_fecho = arg_posto_id\n              and ct.conta_estado = _const.maguita_conta_estado_fechado\n              and ct._tgrupo_id = _const.maguita_tgrupo_cnormal\n              and ct.conta_datafecho::date = arg_conta_data\n        ) select to_jsonb( _ct )\n        from __conta _ct\n    ;\nend\n$$;\n	create or replace function tweeks.funct_pos_load_conta_dia(filter jsonb DEFAULT NULL::jsonb) returns SETOF jsonb language plpgsql as $$ declare /** Essa função serve para devolver as compras do dia em uma data especifica filter := { arg_conta_data: DATE arg_posto_id: DATE } */ _const map.constant; arg_conta_data date default filter->>'arg_conta_data'; arg_posto_id uuid not null default filter->>'arg_posto_id'; begin _const := map.constant(); arg_conta_data := coalesce( arg_conta_data, current_date ); if arg_conta_data < current_date - make_interval( days := 7 ) then return; end if; return query with __conta as ( select ct.conta_id, ct.conta_data, ct.conta_dataregistro, ct.conta_titular, ct.conta_titularnif, ct.conta_montante, ct.conta_numerofatura, ct.conta_numero, p.posto_designacao, p.posto_matricula, de.deposito_montante, de.deposito_montantemoeda, de.deposito_montantetroco, de.deposito_montantefinal, de.deposito_taxacambio, cu.currency_id, cu.currency_code, cu.currency_name, co.colaborador_id, co.colaborador_nome from tweeks.conta ct inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id inner join tweeks.deposito de on ( de.deposito_referencia->>'conta_id' )::uuid = ct.conta_id inner join geoinfo.currency cu on de.deposito_currency_id = cu.currency_id inner join auth.colaborador co on ct.conta_colaborador_fecho = co.colaborador_id where ct.conta_posto_fecho = arg_posto_id and ct.conta_estado = _const.maguita_conta_estado_fechado and ct._tgrupo_id = _const.maguita_tgrupo_cnormal and ct.conta_datafecho::date = arg_conta_data ) select to_jsonb( _ct ) from __conta _ct ; end $$;
80bdbbdc-a5a5-4b71-9407-23624f57ecf6	\ncreate or replace function tweeks.__artigo_has_stock(\n    arg_artigo_id uuid,\n    arg_espaco_id uuid,\n    arg_quantidadedebito double precision\n) returns boolean\n    language plpgsql\nas\n$$\ndeclare\n    /** Essa função serve para verificar se existe diponibilidade de um artig em um stock para cobrir uma quantidade de debito\n     */\n    _artigo tweeks.artigo;\n    _stock record;\nbegin\n    _artigo := tweeks._get_artigo( arg_artigo_id );\n\n    -- Aceitar sempre que o artigo for do tipo staock negativo\n    if _artigo.artigo_stocknegativo then return true; end if;\n\n    select *\n      from tweeks._get_stock( arg_artigo_id, arg_espaco_id )\n      into _stock\n    ;\n    \n    return _stock.stock_quantidade >= arg_quantidadedebito;\nend;\n$$;\n\n	create or replace function tweeks.__artigo_has_stock( arg_artigo_id uuid, arg_espaco_id uuid, arg_quantidadedebito double precision ) returns boolean language plpgsql as $$ declare /** Essa função serve para verificar se existe diponibilidade de um artig em um stock para cobrir uma quantidade de debito */ _artigo tweeks.artigo; _stock record; begin _artigo := tweeks._get_artigo( arg_artigo_id ); -- Aceitar sempre que o artigo for do tipo staock negativo if _artigo.artigo_stocknegativo then return true; end if; select * from tweeks._get_stock( arg_artigo_id, arg_espaco_id ) into _stock ; return _stock.stock_quantidade >= arg_quantidadedebito; end; $$;
be576107-48f9-45db-bc46-1c0ebac51eaa	\ncreate or replace function libdom.domset(_class character varying, _column character varying, _domain character varying, _comment character varying DEFAULT NULL::character varying) returns boolean\n  language plpgsql\nas\n$$\ndeclare\n  /**doc\n\n   doc*/\n  _data record;\nbegin\n    update libdom.domsync\n      set domain = _domain,\n          comment = _comment\n    where classname = _class\n      and columnname = _column\n    returning * into _data\n  ;\n\n  if _data.classname is null then\n    insert into libdom.domsync(\n      classname,\n      columnname,\n      domain,\n      comment\n    ) values (\n      _class,\n      _column,\n      _domain,\n      _comment\n    );\n  end if;\n  return true;\nend;\n$$;\n	create or replace function libdom.domset(_class character varying, _column character varying, _domain character varying, _comment character varying DEFAULT NULL::character varying) returns boolean language plpgsql as $$ declare /**doc doc*/ _data record; begin update libdom.domsync set domain = _domain, comment = _comment where classname = _class and columnname = _column returning * into _data ; if _data.classname is null then insert into libdom.domsync( classname, columnname, domain, comment ) values ( _class, _column, _domain, _comment ); end if; return true; end; $$;
eb139c63-a567-4211-bb49-57e298c1c1e2	\n    create schema if not exists report;\n\n    drop table if exists report.filter;\n    drop table if exists report.parametrized;\n    create table if not exists report.parametrized(\n        parametrized_uid uuid primary key not null default gen_random_uuid(),\n        parametrized_name character varying not null,\n        parametrized_source character varying not null,\n        parametrized_columns jsonb not null default jsonb_build_array(),\n        parametrized_groups jsonb not null default jsonb_build_array(),\n        parametrized_props jsonb not null default jsonb_build_object(),\n        parametrized_grants character varying[] not null,\n        parametrized_state int2 not null default libdom.get( 'report_filter_state_active' )::int2,\n        parametrized_date timestamptz not null default clock_timestamp(),\n        parametrized_update timestamptz,\n        parametrized_user_id character varying not null,\n        parametrized_espaco_auth character varying not null,\n        parametrized_user_update character varying default null,\n        _branch_uid  character varying not null\n    );\n    \n    create table if not exists report.filter(\n        filter_uid uuid not null primary key default gen_random_uuid(),\n        filter_parametrized_uid uuid not null references report.parametrized,\n        filter_name character varying not null,\n        filter_props jsonb not null default jsonb_build_object(),\n        filter_require boolean not null default false,\n        filter_column character varying not null,\n        filter_type character varying not null,\n        filter_opr character varying not null,\n        filter_mode character varying not null,\n        filter_basevalue character varying default null,\n        filter_valuemode int not null default libdom.get( 'report_filter_filter_valuemode_raw' )::int2,\n        filter_increment character varying default null,\n        filter_grants character varying[] not null,\n        filter_state int2 not null default libdom.get( 'report_filter_state_active' )::int2,\n        filter_date timestamptz not null default clock_timestamp(),\n        filter_update timestamptz,\n        filter_user_id character varying not null,\n        filter_user_update character varying default null,\n        filter_espaco_auth character varying not null,\n        _branch_uid  character varying not null\n    );\n	create schema if not exists report; drop table if exists report.filter; drop table if exists report.parametrized; create table if not exists report.parametrized( parametrized_uid uuid primary key not null default gen_random_uuid(), parametrized_name character varying not null, parametrized_source character varying not null, parametrized_columns jsonb not null default jsonb_build_array(), parametrized_groups jsonb not null default jsonb_build_array(), parametrized_props jsonb not null default jsonb_build_object(), parametrized_grants character varying[] not null, parametrized_state int2 not null default libdom.get( 'report_filter_state_active' )::int2, parametrized_date timestamptz not null default clock_timestamp(), parametrized_update timestamptz, parametrized_user_id character varying not null, parametrized_espaco_auth character varying not null, parametrized_user_update character varying default null, _branch_uid character varying not null ); create table if not exists report.filter( filter_uid uuid not null primary key default gen_random_uuid(), filter_parametrized_uid uuid not null references report.parametrized, filter_name character varying not null, filter_props jsonb not null default jsonb_build_object(), filter_require boolean not null default false, filter_column character varying not null, filter_type character varying not null, filter_opr character varying not null, filter_mode character varying not null, filter_basevalue character varying default null, filter_valuemode int not null default libdom.get( 'report_filter_filter_valuemode_raw' )::int2, filter_increment character varying default null, filter_grants character varying[] not null, filter_state int2 not null default libdom.get( 'report_filter_state_active' )::int2, filter_date timestamptz not null default clock_timestamp(), filter_update timestamptz, filter_user_id character varying not null, filter_user_update character varying default null, filter_espaco_auth character varying not null, _branch_uid character varying not null );
fc64cc51-dec8-4649-9c85-ec0b80fac2a8	\nalter table report.filter drop column if exists filter_mode;\n	alter table report.filter drop column if exists filter_mode;
f3e7ac9d-5af1-41f5-a389-4c13dae936cb	\n\n    select libdom.entry( 'report_filter_state_active', 'int2', 1, 'report.parametrized.parametrized_state', 'Ativo');\n    select libdom.entry( 'report_filter_state_fechado', 'int2', 0, 'report.parametrized.parametrized_state', 'Fechado');\n    select libdom.entry( 'report_filter_state_active', 'int2', 1, 'report.filter.filter_state', 'Ativo');\n    select libdom.entry( 'report_filter_state_fechado', 'int2', 0, 'report.filter.filter_state', 'Fechado');\n\n    select libdom.domset('report.parametrized', 'parametrized_state', 'report.parametrized.parametrized_state' );\n    select libdom.domset('report.filter', 'filter_state', 'report.filter.filter_state' );\n\n    select libdom.entry_drop('report_filter_filter_valuemode_raw', true );\n    select libdom.entry_drop('report_filter_filter_valuemode_eval', true );\n\n    select libdom.entry( 'report_filter_filter_valuemode_samevalue', 'int2', 1, 'report.filter.filter_valuemode', 'Mesmo valor');\n    select libdom.entry( 'report_filter_filter_valuemode_dateprocess', 'int2', 2, 'report.filter.filter_valuemode', 'Data do processamento');\n    select libdom.entry( 'report_filter_filter_valuemode_daterelative', 'int2', 3, 'report.filter.filter_valuemode', 'Relativo a data atual');\n    select libdom.entry( 'report_filter_filter_valuemode_ask', 'int2', 4, 'report.filter.filter_valuemode', 'Pedir');\n    select libdom.entry( 'report_filter_filter_valuemode_askallways', 'int2', 5, 'report.filter.filter_valuemode', 'Pedir sempre');\n	select libdom.entry( 'report_filter_state_active', 'int2', 1, 'report.parametrized.parametrized_state', 'Ativo'); select libdom.entry( 'report_filter_state_fechado', 'int2', 0, 'report.parametrized.parametrized_state', 'Fechado'); select libdom.entry( 'report_filter_state_active', 'int2', 1, 'report.filter.filter_state', 'Ativo'); select libdom.entry( 'report_filter_state_fechado', 'int2', 0, 'report.filter.filter_state', 'Fechado'); select libdom.domset('report.parametrized', 'parametrized_state', 'report.parametrized.parametrized_state' ); select libdom.domset('report.filter', 'filter_state', 'report.filter.filter_state' ); select libdom.entry_drop('report_filter_filter_valuemode_raw', true ); select libdom.entry_drop('report_filter_filter_valuemode_eval', true ); select libdom.entry( 'report_filter_filter_valuemode_samevalue', 'int2', 1, 'report.filter.filter_valuemode', 'Mesmo valor'); select libdom.entry( 'report_filter_filter_valuemode_dateprocess', 'int2', 2, 'report.filter.filter_valuemode', 'Data do processamento'); select libdom.entry( 'report_filter_filter_valuemode_daterelative', 'int2', 3, 'report.filter.filter_valuemode', 'Relativo a data atual'); select libdom.entry( 'report_filter_filter_valuemode_ask', 'int2', 4, 'report.filter.filter_valuemode', 'Pedir'); select libdom.entry( 'report_filter_filter_valuemode_askallways', 'int2', 5, 'report.filter.filter_valuemode', 'Pedir sempre');
528a2d90-86a9-4e96-b900-3146bb3fcbd9	\ncreate or replace function report.sets_parametrized_report(\n  args jsonb\n) returns setof jsonb\nlanguage plpgsql as $$\n  declare\n    /**doc\n      args := {\n        _user_id character varying not null,\n        _espaco_auth character varying not null,\n        _branch  character varying not null\n\n        parametrized_uid uuid primary key not null default gen_random_uuid(),\n        parametrized_name character varying not null,\n        parametrized_source character varying not null,\n        parametrized_columns jsonb not null default jsonb_build_array(),\n        parametrized_groups jsonb not null default jsonb_build_array(),\n        parametrized_props jsonb not null default jsonb_build_object(),\n        parametrized_grants character varying[] not null,\n\n        filters:[{\n          filter_uid uuid not null primary key default gen_random_uuid(),\n          filter_name character varying not null,\n          filter_props jsonb not null default jsonb_build_object(),\n          filter_require boolean not null default false,\n          filter_column character varying not null,\n          filter_type character varying not null,\n          filter_opr character varying not null,\n          filter_basevalue character varying default null,\n          filter_valuemode int not null default libdom.get( 'report_filter_filter_valuemode_raw' )::int2,\n          filter_increment character varying default null,\n          filter_espaco_destino character varying[] not null\n        }]\n      }\n     doc*/\n    _filters_id uuid[] default array( select (e.doc->>'filter_uid')::uuid from jsonb_array_elements( args->'filters' ) e( doc ));\n    _parametrized report.parametrized;\n    _user_id character varying default args->>'_user_id';\n    _branch character varying default args->>'_branch';\n    _espaco_auth character varying default args->>'_espaco_auth';\n    _const libdom.constant;\n    _filter report.filter;\n  begin\n    _parametrized := jsonb_populate_record( _parametrized, args );\n    _const := libdom.constant();\n    \n    -- Garantir que o nome do retatorio não se duplique\n    if _parametrized.parametrized_uid is null and exists(\n      select *\n        from report.parametrized \n        where trim( lower( parametrized_name ) ) = lower( trim( _parametrized.parametrized_name ) )\n          and _branch_uid = _branch\n    ) then \n      return next jsonb_build_object(\n        'result', false,\n        'message', 'Já existe uma relatorio parametizado com o nome'\n      );\n      return;\n    end if;\n    \n    if _parametrized.parametrized_uid is null then\n      _parametrized.parametrized_user_id := _user_id;\n      _parametrized._branch_uid := _branch;\n      _parametrized.parametrized_espaco_auth := _espaco_auth;\n    else\n      _parametrized.parametrized_user_update := _user_id;\n      _parametrized.parametrized_update := clock_timestamp();\n    end if;\n    \n    if _user_id != all( _parametrized.parametrized_grants ) then \n        _parametrized.parametrized_grants := _parametrized.parametrized_grants || _user_id;\n    end if;\n    if _espaco_auth != all( _parametrized.parametrized_grants ) then \n        _parametrized.parametrized_grants := _parametrized.parametrized_grants || _espaco_auth;\n    end if;\n\n    select ( "returning" ).* into _parametrized\n      from lib.sets( _parametrized )\n    ;\n\n    return next jsonb_build_object(\n      'result', true\n    )||jsonb_build_object( 'type', 'result');\n\n    return next to_jsonb( _parametrized )\n      ||jsonb_build_object( 'type', 'report.parametrized');\n\n\n    update report.filter\n      set filter_state = _const.report_filter_state_active,\n          filter_update  = clock_timestamp()\n      where filter_parametrized_uid = _parametrized.parametrized_uid\n        and filter_state = _const.report_filter_state_active\n        and filter_uid != all ( _filters_id )\n    ;\n\n\n    for _filter in\n      select f.*\n        from jsonb_array_elements( args->'filters' ) e( doc )\n          inner join jsonb_populate_record( null::report.filter, e.doc ) f on true\n    loop\n      if _filter.filter_uid is null then\n        _filter.filter_user_id := _user_id;\n        _filter._branch_uid := _branch;\n        _filter.filter_espaco_auth := _user_id;\n        _filter.filter_parametrized_uid := _parametrized.parametrized_uid;\n      else\n        _filter.filter_user_update := _user_id;\n        _filter.filter_update := clock_timestamp();\n      end if;\n\n      if _user_id != all( _filter.filter_grants ) then\n          _filter.filter_grants := _filter.filter_grants || _user_id;\n      end if;\n      if _espaco_auth != all( _filter.filter_grants ) then\n          _filter.filter_grants := _filter.filter_grants || _espaco_auth;\n      end if;\n      \n      if _filter.filter_type::regtype in ( \n        'date'::regtype,\n        'timestamp'::regtype,\n        'timestamptz'::regtype\n      ) and _filter.filter_valuemode = _const.report_filter_filter_valuemode_daterelative then\n        _filter.filter_increment := clock_timestamp() - ( _filter.filter_basevalue::timestamptz );\n      end if;\n      \n      select ("returning").* into _filter\n        from lib.sets( _filter )\n      ;\n      return next to_jsonb( _filter )\n          ||jsonb_build_object( 'type', 'filter');\n    end loop;\n    \n  end\n$$;\n\n\ncreate or replace function report.funct_load_report_parametrized( args jsonb )\nreturns setof jsonb\nlanguage plpgsql as $$\ndeclare\n  /**doc\n    args := {\n      _branch:text\n      _user_id: text\n      _workspace: text,\n      _grants: text\n    }\n   doc*/\n    _branch text default args->>'_branch';\n    _user_id text default args->>'_user_id';\n    _workspace text default args->>'_workspace';\n    _grants text default args->>'_grants';\nbegin\n  return query \n    with __parametrized_report as (\n      select *\n        from report.parametrized p\n        where p._branch_uid = _branch\n          and _workspace = any ( p.parametrized_grants )\n          and ( _grants is null or _grants = any ( p.parametrized_grants ) )  \n    )  select to_jsonb( _pr )\n          from __parametrized_report _pr;\nend;\n$$;\n\n\ncreate or replace function report.funct_load_report_parametrized_filter( args jsonb )\nreturns setof jsonb\nlanguage plpgsql as $$\ndeclare\n  /**doc\n    args := {\n      _branch:text\n      _user_id: text\n      _workspace: text\n      _parametrized_uid\n    }\n   doc*/\n  _branch text default args->>'_branch';\n  _user_id text default args->>'_user_id';\n  _workspace text default args->>'_workspace';\n  _parametrized_uid uuid default args->>'_parametrized_uid';\n\n  _filter record;\n  _const libdom.constant;\n  _is_date boolean;\n  _is_timestamp boolean;\n  _use_value text;\nbegin\n  _const := libdom.constant();\n  for _filter in \n    select *\n      from report.filter f\n      where f._branch_uid = _branch\n        and f.filter_parametrized_uid = _parametrized_uid\n  loop\n    _use_value := null;\n      _is_date := _filter.filter_type::regtype in (\n        'date'::regtype\n      );\n    \n      _is_timestamp := _filter.filter_type::regtype in (\n        'timestamp'::regtype,\n        'timestamptz'::regtype\n      );\n      \n      if (_is_date or _is_timestamp) and  _filter.filter_valuemode = _const.report_filter_filter_valuemode_daterelative  then\n        _use_value := _filter.filter_basevalue::timestamptz + (_filter.filter_increment)::interval;\n      elsif ( _is_date or _is_timestamp ) and _filter.filter_valuemode = _const.report_filter_filter_valuemode_dateprocess then\n        _use_value := now();\n      elsif _filter.filter_valuemode = _const.report_filter_filter_valuemode_samevalue then \n        _use_value := _filter.filter_basevalue;\n      end if;\n    \n      if _use_value is not null and _is_date then \n          _use_value := _use_value::date;\n      end if;\n    \n      return next to_jsonb( _filter )|| jsonb_build_object(\n        'filter_value', _use_value\n      );\n    \n  end loop;\nend;\n$$\n	create or replace function report.sets_parametrized_report( args jsonb ) returns setof jsonb language plpgsql as $$ declare /**doc args := { _user_id character varying not null, _espaco_auth character varying not null, _branch character varying not null parametrized_uid uuid primary key not null default gen_random_uuid(), parametrized_name character varying not null, parametrized_source character varying not null, parametrized_columns jsonb not null default jsonb_build_array(), parametrized_groups jsonb not null default jsonb_build_array(), parametrized_props jsonb not null default jsonb_build_object(), parametrized_grants character varying[] not null, filters:[{ filter_uid uuid not null primary key default gen_random_uuid(), filter_name character varying not null, filter_props jsonb not null default jsonb_build_object(), filter_require boolean not null default false, filter_column character varying not null, filter_type character varying not null, filter_opr character varying not null, filter_basevalue character varying default null, filter_valuemode int not null default libdom.get( 'report_filter_filter_valuemode_raw' )::int2, filter_increment character varying default null, filter_espaco_destino character varying[] not null }] } doc*/ _filters_id uuid[] default array( select (e.doc->>'filter_uid')::uuid from jsonb_array_elements( args->'filters' ) e( doc )); _parametrized report.parametrized; _user_id character varying default args->>'_user_id'; _branch character varying default args->>'_branch'; _espaco_auth character varying default args->>'_espaco_auth'; _const libdom.constant; _filter report.filter; begin _parametrized := jsonb_populate_record( _parametrized, args ); _const := libdom.constant(); -- Garantir que o nome do retatorio não se duplique if _parametrized.parametrized_uid is null and exists( select * from report.parametrized where trim( lower( parametrized_name ) ) = lower( trim( _parametrized.parametrized_name ) ) and _branch_uid = _branch ) then return next jsonb_build_object( 'result', false, 'message', 'Já existe uma relatorio parametizado com o nome' ); return; end if; if _parametrized.parametrized_uid is null then _parametrized.parametrized_user_id := _user_id; _parametrized._branch_uid := _branch; _parametrized.parametrized_espaco_auth := _espaco_auth; else _parametrized.parametrized_user_update := _user_id; _parametrized.parametrized_update := clock_timestamp(); end if; if _user_id != all( _parametrized.parametrized_grants ) then _parametrized.parametrized_grants := _parametrized.parametrized_grants || _user_id; end if; if _espaco_auth != all( _parametrized.parametrized_grants ) then _parametrized.parametrized_grants := _parametrized.parametrized_grants || _espaco_auth; end if; select ( "returning" ).* into _parametrized from lib.sets( _parametrized ) ; return next jsonb_build_object( 'result', true )||jsonb_build_object( 'type', 'result'); return next to_jsonb( _parametrized ) ||jsonb_build_object( 'type', 'report.parametrized'); update report.filter set filter_state = _const.report_filter_state_active, filter_update = clock_timestamp() where filter_parametrized_uid = _parametrized.parametrized_uid and filter_state = _const.report_filter_state_active and filter_uid != all ( _filters_id ) ; for _filter in select f.* from jsonb_array_elements( args->'filters' ) e( doc ) inner join jsonb_populate_record( null::report.filter, e.doc ) f on true loop if _filter.filter_uid is null then _filter.filter_user_id := _user_id; _filter._branch_uid := _branch; _filter.filter_espaco_auth := _user_id; _filter.filter_parametrized_uid := _parametrized.parametrized_uid; else _filter.filter_user_update := _user_id; _filter.filter_update := clock_timestamp(); end if; if _user_id != all( _filter.filter_grants ) then _filter.filter_grants := _filter.filter_grants || _user_id; end if; if _espaco_auth != all( _filter.filter_grants ) then _filter.filter_grants := _filter.filter_grants || _espaco_auth; end if; if _filter.filter_type::regtype in ( 'date'::regtype, 'timestamp'::regtype, 'timestamptz'::regtype ) and _filter.filter_valuemode = _const.report_filter_filter_valuemode_daterelative then _filter.filter_increment := clock_timestamp() - ( _filter.filter_basevalue::timestamptz ); end if; select ("returning").* into _filter from lib.sets( _filter ) ; return next to_jsonb( _filter ) ||jsonb_build_object( 'type', 'filter'); end loop; end $$; create or replace function report.funct_load_report_parametrized( args jsonb ) returns setof jsonb language plpgsql as $$ declare /**doc args := { _branch:text _user_id: text _workspace: text, _grants: text } doc*/ _branch text default args->>'_branch'; _user_id text default args->>'_user_id'; _workspace text default args->>'_workspace'; _grants text default args->>'_grants'; begin return query with __parametrized_report as ( select * from report.parametrized p where p._branch_uid = _branch and _workspace = any ( p.parametrized_grants ) and ( _grants is null or _grants = any ( p.parametrized_grants ) ) ) select to_jsonb( _pr ) from __parametrized_report _pr; end; $$; create or replace function report.funct_load_report_parametrized_filter( args jsonb ) returns setof jsonb language plpgsql as $$ declare /**doc args := { _branch:text _user_id: text _workspace: text _parametrized_uid } doc*/ _branch text default args->>'_branch'; _user_id text default args->>'_user_id'; _workspace text default args->>'_workspace'; _parametrized_uid uuid default args->>'_parametrized_uid'; _filter record; _const libdom.constant; _is_date boolean; _is_timestamp boolean; _use_value text; begin _const := libdom.constant(); for _filter in select * from report.filter f where f._branch_uid = _branch and f.filter_parametrized_uid = _parametrized_uid loop _use_value := null; _is_date := _filter.filter_type::regtype in ( 'date'::regtype ); _is_timestamp := _filter.filter_type::regtype in ( 'timestamp'::regtype, 'timestamptz'::regtype ); if (_is_date or _is_timestamp) and _filter.filter_valuemode = _const.report_filter_filter_valuemode_daterelative then _use_value := _filter.filter_basevalue::timestamptz + (_filter.filter_increment)::interval; elsif ( _is_date or _is_timestamp ) and _filter.filter_valuemode = _const.report_filter_filter_valuemode_dateprocess then _use_value := now(); elsif _filter.filter_valuemode = _const.report_filter_filter_valuemode_samevalue then _use_value := _filter.filter_basevalue; end if; if _use_value is not null and _is_date then _use_value := _use_value::date; end if; return next to_jsonb( _filter )|| jsonb_build_object( 'filter_value', _use_value ); end loop; end; $$
1f539c26-3d38-4c20-967c-a081bf5e04f3	\n  alter table tweeks.posto add if not exists posto_definirmontanteautomaticamente boolean default false;\n	alter table tweeks.posto add if not exists posto_definirmontanteautomaticamente boolean default false;
fc535ed6-a620-4a0b-b89c-063325672905	\n    drop view if exists report.vreport_balanco;\n    drop view if exists report.vreport_caixa;\n    drop view if exists report.vreport_conta;\n    drop view if exists report.vreport_fatura;\n    drop view if exists report.vreport_fluxo;\n    drop view if exists report.vreport_guiaentrada;\n    drop view if exists report.vreport_guiasaida;\n    drop view if exists report.vreport_imposto;\n    drop view if exists report.vreport_notacredito;\n    drop view if exists report.vreport_venda;\n\nselect map.constant('maguita_unit_state_active', 'int2', 1 );\nselect map.constant('maguita_unit_state_fechado', 'int2', 0 );\ncreate table if not exists tweeks.unit(\n  unit_id uuid not null default gen_random_uuid() primary key ,\n  unit_code character varying not null,\n  unit_name character varying not null,\n  unit_state int2 not null default map.get('maguita_unit_state_active')::int2,\n  unit_date timestamptz not null default clock_timestamp(),\n  unit_update timestamptz default null,\n  unit_espaco_auth uuid not null references tweeks.espaco,\n  unit_user_id uuid not null references auth.colaborador,\n  unit_user_update uuid,\n  _branch_uid uuid not null,\n  constraint uk_unit_code unique ( unit_code, _branch_uid )\n);\n\nalter table tweeks.artigo add if not exists artigo_unit_id uuid default null;\ndo $$\n  declare\n    _record record;\n    _unit tweeks.unit;\n  begin\n    for _record in \n      select * from tweeks.branch e\n        left join tweeks.unit u on e.branch_uid  = u._branch_uid\n          and lower( u.unit_code ) = lower( 'Unit')\n        where u.unit_id is null\n    loop\n        insert into tweeks.unit ( \n            unit_code,\n            unit_name,\n            unit_espaco_auth,\n            unit_user_id,\n            _branch_uid\n        ) values (\n            'Unit',\n            'Unidades',\n            _record.branch_main_workspace,\n            _record.branch_main_user,\n            _record.branch_uid\n      ) returning * into _unit;\n        update tweeks.artigo\n          set artigo_unit_id = _unit.unit_id\n          where artigo_unit_id is null \n            and _branch_uid = _record.branch_uid\n      ;\n  end loop;\n    for _record in \n      with __unit ( _code, _name) as (\n        values \n          ( 'G', 'Gramas' ),\n          ( 'KG', 'Kilogramas' ),\n          ( 'T', 'Toneladas' ),\n          ( 'L', 'Litros' ),\n          ( 'SC', 'Sacos' ),\n          ( 'CX', 'Caixas' ),\n          ( 'EMB', 'Embalagem' ),\n          ( 'PC', 'Pacotes' )\n      )\n      select * from tweeks.branch e\n        left join __unit _u on true\n        left join tweeks.unit u on e.branch_uid  = u._branch_uid\n          and lower( u.unit_code ) = lower( _u._code )\n        where u.unit_id is null\n    loop\n        insert into tweeks.unit ( \n            unit_code,\n            unit_name,\n            unit_espaco_auth,\n            unit_user_id,\n            _branch_uid\n        ) values (\n            _record._code,\n            _record._name,\n            _record.branch_main_workspace,\n            _record.branch_main_user,\n            _record.branch_uid\n      ) returning * into _unit;\n  end loop;\n  end;\n$$;\n	drop view if exists report.vreport_balanco; drop view if exists report.vreport_caixa; drop view if exists report.vreport_conta; drop view if exists report.vreport_fatura; drop view if exists report.vreport_fluxo; drop view if exists report.vreport_guiaentrada; drop view if exists report.vreport_guiasaida; drop view if exists report.vreport_imposto; drop view if exists report.vreport_notacredito; drop view if exists report.vreport_venda; select map.constant('maguita_unit_state_active', 'int2', 1 ); select map.constant('maguita_unit_state_fechado', 'int2', 0 ); create table if not exists tweeks.unit( unit_id uuid not null default gen_random_uuid() primary key , unit_code character varying not null, unit_name character varying not null, unit_state int2 not null default map.get('maguita_unit_state_active')::int2, unit_date timestamptz not null default clock_timestamp(), unit_update timestamptz default null, unit_espaco_auth uuid not null references tweeks.espaco, unit_user_id uuid not null references auth.colaborador, unit_user_update uuid, _branch_uid uuid not null, constraint uk_unit_code unique ( unit_code, _branch_uid ) ); alter table tweeks.artigo add if not exists artigo_unit_id uuid default null; do $$ declare _record record; _unit tweeks.unit; begin for _record in select * from tweeks.branch e left join tweeks.unit u on e.branch_uid = u._branch_uid and lower( u.unit_code ) = lower( 'Unit') where u.unit_id is null loop insert into tweeks.unit ( unit_code, unit_name, unit_espaco_auth, unit_user_id, _branch_uid ) values ( 'Unit', 'Unidades', _record.branch_main_workspace, _record.branch_main_user, _record.branch_uid ) returning * into _unit; update tweeks.artigo set artigo_unit_id = _unit.unit_id where artigo_unit_id is null and _branch_uid = _record.branch_uid ; end loop; for _record in with __unit ( _code, _name) as ( values ( 'G', 'Gramas' ), ( 'KG', 'Kilogramas' ), ( 'T', 'Toneladas' ), ( 'L', 'Litros' ), ( 'SC', 'Sacos' ), ( 'CX', 'Caixas' ), ( 'EMB', 'Embalagem' ), ( 'PC', 'Pacotes' ) ) select * from tweeks.branch e left join __unit _u on true left join tweeks.unit u on e.branch_uid = u._branch_uid and lower( u.unit_code ) = lower( _u._code ) where u.unit_id is null loop insert into tweeks.unit ( unit_code, unit_name, unit_espaco_auth, unit_user_id, _branch_uid ) values ( _record._code, _record._name, _record.branch_main_workspace, _record.branch_main_user, _record.branch_uid ) returning * into _unit; end loop; end; $$;
a152f1f1-0cd1-473d-b401-a9d337be05c1	\ncreate or replace function tweeks.funct_sets_unit( args jsonb )\n  returns lib.res\nlanguage plpgsql as $$ \ndeclare\n  /**doc\n    Sets unit\n    args := {\n        _espaco_auth\n        _user_id\n        unit_id? ,\n        unit_code,\n        unit_name,\n        unit_state?\n    }\n  doc*/\n  _espaco_auth uuid not null default args->>'_espaco_auth';\n  _user_id uuid not null default args->>'_user_id';\n  _branch uuid default tweeks.__branch_uid( _user_id, _espaco_auth );\n  _args tweeks.unit;\n  _unit tweeks.unit;\nbegin\n  \n  _args := jsonb_populate_record( _args, args );\n  if _args.unit_id is null then \n    _args.unit_user_id := _user_id;\n    _args.unit_espaco_auth := _espaco_auth;\n    _args._branch_uid := _branch;\n  else\n    _args.unit_update := clock_timestamp();\n    _args.unit_user_update := _user_id;\n  end if;\n  \n  -- Garantir que o codigo da unidade não se repita\n  if _args.unit_id is null and exists(\n    select *\n      from tweeks.unit u \n      where u._branch_uid = _args._branch_uid\n        and lower( trim( u.unit_code ) )  = lower( trim( _args.unit_code ) )\n  ) then\n    return lib.res_false( 'Já existe uma unidade com o código selecionado!' );\n  end if;\n  \n  select ( "returning").* into _unit\n    from lib.sets( _args )\n  ;\n  \n  return lib.res_true( jsonb_build_object(\n    'unit', _unit\n  ));\nend;\n$$;\n\ncreate or replace function tweeks.funct_load_unit( args jsonb )\nreturns setof jsonb\nlanguage plpgsql as $$\ndeclare\n    /**doc\n        Carregar os documentos \n        args := {\n          _espaco_auth\n          _user_id\n        }\n  doc*/\n    _espaco_auth uuid not null default args->>'_espaco_auth';\n    _user_id uuid not null default args->>'_user_id';\n    _branch uuid default tweeks.__branch_uid( _user_id, _espaco_auth );\nbegin\n  return query\n    with _unit as (\n      select *\n        from tweeks.unit u\n        where u._branch_uid = _branch\n    ) select to_jsonb( _u ) from _unit _u;\nend;\n$$;\n	create or replace function tweeks.funct_sets_unit( args jsonb ) returns lib.res language plpgsql as $$ declare /**doc Sets unit args := { _espaco_auth _user_id unit_id? , unit_code, unit_name, unit_state? } doc*/ _espaco_auth uuid not null default args->>'_espaco_auth'; _user_id uuid not null default args->>'_user_id'; _branch uuid default tweeks.__branch_uid( _user_id, _espaco_auth ); _args tweeks.unit; _unit tweeks.unit; begin _args := jsonb_populate_record( _args, args ); if _args.unit_id is null then _args.unit_user_id := _user_id; _args.unit_espaco_auth := _espaco_auth; _args._branch_uid := _branch; else _args.unit_update := clock_timestamp(); _args.unit_user_update := _user_id; end if; -- Garantir que o codigo da unidade não se repita if _args.unit_id is null and exists( select * from tweeks.unit u where u._branch_uid = _args._branch_uid and lower( trim( u.unit_code ) ) = lower( trim( _args.unit_code ) ) ) then return lib.res_false( 'Já existe uma unidade com o código selecionado!' ); end if; select ( "returning").* into _unit from lib.sets( _args ) ; return lib.res_true( jsonb_build_object( 'unit', _unit )); end; $$; create or replace function tweeks.funct_load_unit( args jsonb ) returns setof jsonb language plpgsql as $$ declare /**doc Carregar os documentos args := { _espaco_auth _user_id } doc*/ _espaco_auth uuid not null default args->>'_espaco_auth'; _user_id uuid not null default args->>'_user_id'; _branch uuid default tweeks.__branch_uid( _user_id, _espaco_auth ); begin return query with _unit as ( select * from tweeks.unit u where u._branch_uid = _branch ) select to_jsonb( _u ) from _unit _u; end; $$;
1cf2c5a5-fbab-489f-b6d9-e68ae733d928	\ncreate or replace function tweeks.__tg_create_lancamento() returns trigger\n  language plpgsql\nas\n$$\ndeclare\n  _deposito tweeks.deposito;\n  _conta tweeks.conta;\n  _conta_old tweeks.conta;\n  _const map.constant;\n  _lancamento tweeks.lancamento;\n  _data record;\n  _conta_data record;\nbegin\n\n  --Abortar o trigger quando for conexão com utilizador de replicação\n  if cluster.__is_replication() then\n    return null;\n  end if;\n\n  _const := map.constant();\n\n  if pg_typeof( new ) = pg_typeof( _deposito ) and tg_op = 'INSERT' then\n    _deposito :=  new;\n    select * into _data from tweeks.tpaga where tpaga_id = _deposito.deposito_tpaga_id;\n\n    _lancamento.lancamento_tlancamento_id := _const.maguita_tlancamento_deposito;\n    _lancamento._tgrupo_id := _deposito._tgrupo_id;\n    _lancamento.lancamento_refid := _deposito.deposito_id;\n    _lancamento.lancamento_regclass := cluster.__format( pg_typeof( _deposito )::text::regclass );\n    _lancamento.lancamento_valor := _deposito.deposito_montantefinal;\n    _lancamento.lancamento_operacao := 1;\n    _lancamento.lancamento_cliente_id := _deposito.deposito_cliente_id;\n    _lancamento.lancamento_espaco_auth := _deposito.deposito_espaco_auth;\n    _lancamento.lancamento_colaborador_id := _deposito.deposito_colaborador_id;\n    _lancamento.lancamento_data := _deposito.deposito_data;\n    _lancamento.lancamento_descricao := case\n      when _deposito.deposito_docref is not null then format( 'Lançamente de deposito na conta em modalidade %I usando documento nº %I em %I', _data.tpaga_designacao, _deposito.deposito_docref, _deposito.deposito_data )\n      else format( 'Lançamente de deposito na conta em modalidade %I em %I', _data.tpaga_designacao, _deposito.deposito_data )\n    end;\n    _lancamento.lancamento_documento := _deposito.deposito_documento;\n    _lancamento.lancamento_referencia := lib.sets_ref( _deposito );\n\n  elseif pg_typeof( new ) = pg_typeof( _conta ) and tg_op = 'UPDATE' then\n    _conta := new;\n    _conta_old := old;\n    \n    select * \n      from tweeks.conta ct \n        inner join tweeks.serie s on ct.conta_serie_id = s.serie_id\n        inner join tweeks.tserie ts on s.serie_tserie_id = ts.tserie_id\n      where ct.conta_id = _conta.conta_id\n      into _conta_data\n    ;\n\n    if _conta_old.conta_estado != _conta.conta_estado and _conta.conta_estado = _const.maguita_conta_estado_fechado and not exists(\n      select *\n        from tweeks.lancamento l\n        where l.lancamento_regclass = cluster.__format( pg_typeof(_conta)::text::regclass )\n          and l.lancamento_refid = _conta.conta_id\n    ) then\n      _lancamento.lancamento_tlancamento_id := _const.maguita_tlancamento_conta;\n      _lancamento._tgrupo_id := _conta._tgrupo_id;\n      _lancamento.lancamento_refid := _conta.conta_id;\n      _lancamento.lancamento_regclass := cluster.__format( pg_typeof( _conta )::text::regclass );\n      _lancamento.lancamento_valor := _conta.conta_montante;\n      _lancamento.lancamento_cliente_id := _conta.conta_cliente_id;\n      _lancamento.lancamento_espaco_auth := _conta.conta_espaco_auth;\n      _lancamento.lancamento_colaborador_id := coalesce( _conta.conta_colaborador_fecho, _conta.conta_colaborador_atualizacao, _conta.conta_colaborador_id );\n      _lancamento.lancamento_data := _conta.conta_data;\n      _lancamento.lancamento_descricao := format( 'Lançamento de divida na conta com fatura nº %s', _conta.conta_numerofatura );\n      _lancamento.lancamento_operacao := -1;\n      \n      if _conta_data.tserie_id = _const.maguita_tserie_notacredito then\n        _lancamento.lancamento_descricao := format( 'Lançamento de nota de credito na conta com fatura nº %s', _conta.conta_numerofatura );\n        _lancamento.lancamento_operacao := 1;\n        _lancamento.lancamento_valor := _conta.conta_montante * -1;\n      elsif _conta_data.tserie_id in(  _const.maguita_tserie_faturarecibo, _const.maguita_tserie_fatura ) then \n        _lancamento.lancamento_descricao := format( 'Lançamento de divida na conta com fatura nº %s', _conta.conta_numerofatura );\n      elsif _conta_data.tserie_id = _const.maguita_tserie_guiasaida then \n        _lancamento.lancamento_descricao := format( 'Lançamento de guia de saida com fatura nº %s', _conta.conta_numerofatura );\n      end if;\n      \n      _lancamento.lancamento_documento := _conta.conta_numerofatura;\n      _lancamento.lancamento_referencia := lib.sets_ref( _conta );\n    end if;\n  end if;\n\n  if _lancamento.lancamento_tlancamento_id is not null then\n    _lancamento.lancamento_estado := _const.maguita_lancamento_estado_ativo;\n    perform lib.sets( _lancamento );\n  end if;\n\n  return null;\nend;\n$$;\n	create or replace function tweeks.__tg_create_lancamento() returns trigger language plpgsql as $$ declare _deposito tweeks.deposito; _conta tweeks.conta; _conta_old tweeks.conta; _const map.constant; _lancamento tweeks.lancamento; _data record; _conta_data record; begin --Abortar o trigger quando for conexão com utilizador de replicação if cluster.__is_replication() then return null; end if; _const := map.constant(); if pg_typeof( new ) = pg_typeof( _deposito ) and tg_op = 'INSERT' then _deposito := new; select * into _data from tweeks.tpaga where tpaga_id = _deposito.deposito_tpaga_id; _lancamento.lancamento_tlancamento_id := _const.maguita_tlancamento_deposito; _lancamento._tgrupo_id := _deposito._tgrupo_id; _lancamento.lancamento_refid := _deposito.deposito_id; _lancamento.lancamento_regclass := cluster.__format( pg_typeof( _deposito )::text::regclass ); _lancamento.lancamento_valor := _deposito.deposito_montantefinal; _lancamento.lancamento_operacao := 1; _lancamento.lancamento_cliente_id := _deposito.deposito_cliente_id; _lancamento.lancamento_espaco_auth := _deposito.deposito_espaco_auth; _lancamento.lancamento_colaborador_id := _deposito.deposito_colaborador_id; _lancamento.lancamento_data := _deposito.deposito_data; _lancamento.lancamento_descricao := case when _deposito.deposito_docref is not null then format( 'Lançamente de deposito na conta em modalidade %I usando documento nº %I em %I', _data.tpaga_designacao, _deposito.deposito_docref, _deposito.deposito_data ) else format( 'Lançamente de deposito na conta em modalidade %I em %I', _data.tpaga_designacao, _deposito.deposito_data ) end; _lancamento.lancamento_documento := _deposito.deposito_documento; _lancamento.lancamento_referencia := lib.sets_ref( _deposito ); elseif pg_typeof( new ) = pg_typeof( _conta ) and tg_op = 'UPDATE' then _conta := new; _conta_old := old; select * from tweeks.conta ct inner join tweeks.serie s on ct.conta_serie_id = s.serie_id inner join tweeks.tserie ts on s.serie_tserie_id = ts.tserie_id where ct.conta_id = _conta.conta_id into _conta_data ; if _conta_old.conta_estado != _conta.conta_estado and _conta.conta_estado = _const.maguita_conta_estado_fechado and not exists( select * from tweeks.lancamento l where l.lancamento_regclass = cluster.__format( pg_typeof(_conta)::text::regclass ) and l.lancamento_refid = _conta.conta_id ) then _lancamento.lancamento_tlancamento_id := _const.maguita_tlancamento_conta; _lancamento._tgrupo_id := _conta._tgrupo_id; _lancamento.lancamento_refid := _conta.conta_id; _lancamento.lancamento_regclass := cluster.__format( pg_typeof( _conta )::text::regclass ); _lancamento.lancamento_valor := _conta.conta_montante; _lancamento.lancamento_cliente_id := _conta.conta_cliente_id; _lancamento.lancamento_espaco_auth := _conta.conta_espaco_auth; _lancamento.lancamento_colaborador_id := coalesce( _conta.conta_colaborador_fecho, _conta.conta_colaborador_atualizacao, _conta.conta_colaborador_id ); _lancamento.lancamento_data := _conta.conta_data; _lancamento.lancamento_descricao := format( 'Lançamento de divida na conta com fatura nº %s', _conta.conta_numerofatura ); _lancamento.lancamento_operacao := -1; if _conta_data.tserie_id = _const.maguita_tserie_notacredito then _lancamento.lancamento_descricao := format( 'Lançamento de nota de credito na conta com fatura nº %s', _conta.conta_numerofatura ); _lancamento.lancamento_operacao := 1; _lancamento.lancamento_valor := _conta.conta_montante * -1; elsif _conta_data.tserie_id in( _const.maguita_tserie_faturarecibo, _const.maguita_tserie_fatura ) then _lancamento.lancamento_descricao := format( 'Lançamento de divida na conta com fatura nº %s', _conta.conta_numerofatura ); elsif _conta_data.tserie_id = _const.maguita_tserie_guiasaida then _lancamento.lancamento_descricao := format( 'Lançamento de guia de saida com fatura nº %s', _conta.conta_numerofatura ); end if; _lancamento.lancamento_documento := _conta.conta_numerofatura; _lancamento.lancamento_referencia := lib.sets_ref( _conta ); end if; end if; if _lancamento.lancamento_tlancamento_id is not null then _lancamento.lancamento_estado := _const.maguita_lancamento_estado_ativo; perform lib.sets( _lancamento ); end if; return null; end; $$;
8974e00f-edc9-44f3-b09c-7cd2554e856a	\ncreate or replace function tweeks.__tg_venda_before_sets() returns trigger\n  language plpgsql\nas\n$$\ndeclare\n  _sets record;\n  _new tweeks.venda;\nbegin\n  _new := new;\n  if _new.venda_proforma is null then\n      select * into _sets\n        from tweeks.conta ct \n        where ct.conta_id = _new.venda_conta_id\n      ;\n      \n      _new.venda_proforma := _sets.conta_proforma;\n  end if;\n  return _new;\nend;\n$$;\n\ncreate or replace function tweeks.__tg_fluxo_on_venda() returns trigger\n  language plpgsql\nas\n$$\ndeclare\n  _new tweeks.venda;\n  _old tweeks.venda;\n  _fluxo tweeks.fluxo;\n  _const map.constant;\n  _conta tweeks.conta;\n  ___restaurar boolean default true;\n  __debitar boolean default true;\nbegin\n\n  if cluster.__is_replication() then\n    return null;\n  end if;\n\n  _const := map.constant();\n  _new := new;\n  if tg_op = 'UPDATE' then\n      _old := old;\n  end if;\n  \n  if _new.venda_proforma is null then\n    raise exception 'O campo venda_proforma não foi definido!';\n  end if;\n\n  _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_venda;\n  _fluxo.fluxo_documento := null;\n  _fluxo.fluxo_data := null;\n  _fluxo.fluxo_referencia := jsonb_build_object( 'venda_id', _new.venda_id );\n  _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass );\n  _fluxo.fluxo_refuid := _new.venda_id;\n  _fluxo.fluxo_colaborador_id := _new.venda_colaborador_id;\n  _fluxo.fluxo_espaco_auth := _new.venda_espaco_auth;\n  \n  \n  -- Report o stock quando mudar a conta de normal para proforma\n  if tg_op = 'UPDATE' \n    and ___restaurar\n    and not _old.venda_proforma \n    and _new.venda_proforma \n  then\n    _fluxo.fluxo_quantidadein := _old.venda_quantidade;\n    _fluxo.fluxo_artigo_in := _old.venda_artigo_id;\n    _fluxo.fluxo_espaco_in := _old.venda_espaco_auth;\n    _fluxo.fluxo_observacao := format( 'Reposição do artigo no stock por transformação de conta normal em proforma' );\n    perform lib.sets_in( _fluxo );\n    ___restaurar := false;\n  end if;\n  \n  \n  -- Report o stock quando atualizar a  quantidade na venda normal ou o venda for anulada\n  if tg_op = 'UPDATE'\n    and ___restaurar\n    and not _old.venda_proforma \n    and _old.venda_quantidade != _new.venda_quantidade\n  then\n    _fluxo.fluxo_quantidadein := _old.venda_quantidade;\n    _fluxo.fluxo_artigo_in := _old.venda_artigo_id;\n    _fluxo.fluxo_espaco_in := _old.venda_espaco_auth;\n    _fluxo.fluxo_observacao := format( 'Reposição do artigo no stock por atualização da quantidade na conta' );\n    perform lib.sets_in( _fluxo );\n    ___restaurar := false;\n  end if;\n  \n  -- Report o stock quando a venda for anulada\n  if tg_op = 'UPDATE'\n    and ___restaurar\n    and not _old.venda_proforma \n    and _old.venda_estado != _new.venda_estado\n    and _new.venda_estado in (\n      _const.maguita_venda_estado_anulado,\n      _const.maguita_venda_estado_canselado\n    )\n  then\n    _fluxo.fluxo_quantidadein := _old.venda_quantidade;\n    _fluxo.fluxo_artigo_in := _old.venda_artigo_id;\n    _fluxo.fluxo_espaco_in := _old.venda_espaco_auth;\n    _fluxo.fluxo_observacao := format( 'Reposição do artigo no stock por Anulação/Canselamento da conta');\n    perform lib.sets_in( _fluxo );\n    ___restaurar := false;\n  end if;\n\n  _fluxo.fluxo_quantidadein := null;\n  _fluxo.fluxo_artigo_in := null;\n  _fluxo.fluxo_espaco_in := null;\n  _fluxo.fluxo_quantidadeout := _new.venda_quantidade;\n  _fluxo.fluxo_artigo_out := _new.venda_artigo_id;\n  _fluxo.fluxo_espaco_out := _new.venda_espaco_auth;\n  \n  if tg_op = 'INSERT' \n    and not _new.venda_proforma \n    and __debitar \n  then\n    _fluxo.fluxo_observacao := format( 'Debito no stock atravez de uma venda' );\n    perform lib.sets_in( _fluxo );\n    __debitar := false;\n  end if;\n  \n  if tg_op = 'UPDATE'\n    and __debitar\n    and not _new.venda_proforma\n    and _new.venda_quantidade != _old.venda_quantidade\n    and _new.venda_estado not in (\n      _const.maguita_venda_estado_anulado,\n      _const.maguita_venda_estado_canselado\n    )\n  then\n    _fluxo.fluxo_observacao := format( 'Debito no stock atravez de uma venda' );\n    perform lib.sets_in( _fluxo );\n    __debitar := false;\n  end if;\n\n\n  if _old.venda_estado != _new.venda_estado and _new.venda_estado = _const.maguita_venda_estado_fechado then\n    _conta := tweeks._get_conta( _old.venda_conta_id );\n    update tweeks.fluxo\n      set fluxo_documento = _conta.conta_numerofatura\n      where fluxo_regclass = cluster.__format( pg_typeof( _new )::text::regclass )\n      and ( fluxo_referencia->>'venda_id')::uuid = _old.venda_id\n    ;\n  end if;\n  return null;\nend\n$$;\n	create or replace function tweeks.__tg_venda_before_sets() returns trigger language plpgsql as $$ declare _sets record; _new tweeks.venda; begin _new := new; if _new.venda_proforma is null then select * into _sets from tweeks.conta ct where ct.conta_id = _new.venda_conta_id ; _new.venda_proforma := _sets.conta_proforma; end if; return _new; end; $$; create or replace function tweeks.__tg_fluxo_on_venda() returns trigger language plpgsql as $$ declare _new tweeks.venda; _old tweeks.venda; _fluxo tweeks.fluxo; _const map.constant; _conta tweeks.conta; ___restaurar boolean default true; __debitar boolean default true; begin if cluster.__is_replication() then return null; end if; _const := map.constant(); _new := new; if tg_op = 'UPDATE' then _old := old; end if; if _new.venda_proforma is null then raise exception 'O campo venda_proforma não foi definido!'; end if; _fluxo.fluxo_toperacao_id := _const.maguita_toperacao_venda; _fluxo.fluxo_documento := null; _fluxo.fluxo_data := null; _fluxo.fluxo_referencia := jsonb_build_object( 'venda_id', _new.venda_id ); _fluxo.fluxo_regclass := cluster.__format( pg_typeof( new )::text::regclass ); _fluxo.fluxo_refuid := _new.venda_id; _fluxo.fluxo_colaborador_id := _new.venda_colaborador_id; _fluxo.fluxo_espaco_auth := _new.venda_espaco_auth; -- Report o stock quando mudar a conta de normal para proforma if tg_op = 'UPDATE' and ___restaurar and not _old.venda_proforma and _new.venda_proforma then _fluxo.fluxo_quantidadein := _old.venda_quantidade; _fluxo.fluxo_artigo_in := _old.venda_artigo_id; _fluxo.fluxo_espaco_in := _old.venda_espaco_auth; _fluxo.fluxo_observacao := format( 'Reposição do artigo no stock por transformação de conta normal em proforma' ); perform lib.sets_in( _fluxo ); ___restaurar := false; end if; -- Report o stock quando atualizar a quantidade na venda normal ou o venda for anulada if tg_op = 'UPDATE' and ___restaurar and not _old.venda_proforma and _old.venda_quantidade != _new.venda_quantidade then _fluxo.fluxo_quantidadein := _old.venda_quantidade; _fluxo.fluxo_artigo_in := _old.venda_artigo_id; _fluxo.fluxo_espaco_in := _old.venda_espaco_auth; _fluxo.fluxo_observacao := format( 'Reposição do artigo no stock por atualização da quantidade na conta' ); perform lib.sets_in( _fluxo ); ___restaurar := false; end if; -- Report o stock quando a venda for anulada if tg_op = 'UPDATE' and ___restaurar and not _old.venda_proforma and _old.venda_estado != _new.venda_estado and _new.venda_estado in ( _const.maguita_venda_estado_anulado, _const.maguita_venda_estado_canselado ) then _fluxo.fluxo_quantidadein := _old.venda_quantidade; _fluxo.fluxo_artigo_in := _old.venda_artigo_id; _fluxo.fluxo_espaco_in := _old.venda_espaco_auth; _fluxo.fluxo_observacao := format( 'Reposição do artigo no stock por Anulação/Canselamento da conta'); perform lib.sets_in( _fluxo ); ___restaurar := false; end if; _fluxo.fluxo_quantidadein := null; _fluxo.fluxo_artigo_in := null; _fluxo.fluxo_espaco_in := null; _fluxo.fluxo_quantidadeout := _new.venda_quantidade; _fluxo.fluxo_artigo_out := _new.venda_artigo_id; _fluxo.fluxo_espaco_out := _new.venda_espaco_auth; if tg_op = 'INSERT' and not _new.venda_proforma and __debitar then _fluxo.fluxo_observacao := format( 'Debito no stock atravez de uma venda' ); perform lib.sets_in( _fluxo ); __debitar := false; end if; if tg_op = 'UPDATE' and __debitar and not _new.venda_proforma and _new.venda_quantidade != _old.venda_quantidade and _new.venda_estado not in ( _const.maguita_venda_estado_anulado, _const.maguita_venda_estado_canselado ) then _fluxo.fluxo_observacao := format( 'Debito no stock atravez de uma venda' ); perform lib.sets_in( _fluxo ); __debitar := false; end if; if _old.venda_estado != _new.venda_estado and _new.venda_estado = _const.maguita_venda_estado_fechado then _conta := tweeks._get_conta( _old.venda_conta_id ); update tweeks.fluxo set fluxo_documento = _conta.conta_numerofatura where fluxo_regclass = cluster.__format( pg_typeof( _new )::text::regclass ) and ( fluxo_referencia->>'venda_id')::uuid = _old.venda_id ; end if; return null; end $$;
b55785c1-83ca-4915-ba04-217c6ea69e81	\n  drop trigger if exists tg_fluxo_on_venda_update on tweeks.venda;\n  drop trigger if exists tg_fluxo_on_venda_create on tweeks.venda;\n  drop trigger if exists tg_fluxo_on_venda_sets on tweeks.venda;\n\n  create trigger tg_fluxo_on_venda_sets\n      after insert or update \n      on tweeks.venda\n      for each row\n      when (NOT cluster.__is_replication())\n  execute procedure tweeks.__tg_fluxo_on_venda();\n\n  create trigger tg_venda_before_sets\n      after insert or update \n      on tweeks.venda\n      for each row\n      when (NOT cluster.__is_replication())\n  execute procedure tweeks.__tg_venda_before_sets();\n	drop trigger if exists tg_fluxo_on_venda_update on tweeks.venda; drop trigger if exists tg_fluxo_on_venda_create on tweeks.venda; drop trigger if exists tg_fluxo_on_venda_sets on tweeks.venda; create trigger tg_fluxo_on_venda_sets after insert or update on tweeks.venda for each row when (NOT cluster.__is_replication()) execute procedure tweeks.__tg_fluxo_on_venda(); create trigger tg_venda_before_sets after insert or update on tweeks.venda for each row when (NOT cluster.__is_replication()) execute procedure tweeks.__tg_venda_before_sets();
71cb322f-54cc-4f26-9fdb-e244673a4c79	\ncreate or replace function tweeks.__tg_venda_before_check()\nreturns trigger\nlanguage plpgsql as $$\ndeclare\n  _conta record;\n  _artigo record;\n  _new tweeks.venda;\nbegin\n  if upper( tg_op ) in ( 'INSERT', 'UPDATE' ) then\n    _new := new;\n    select *\n      from tweeks.conta ct\n      where ct.conta_id = _new.venda_conta_id\n      into _conta\n    ;\n\n    select *\n      from tweeks.artigo a\n      where a.artigo_id = _new.venda_artigo_id\n      into _artigo\n    ;\n    \n    -- Garantir que a quantidade vendida nunca seja de zero\n    if new.venda_quantidade = 0 then\n      raise exception '%', format('A quantidade de artigo para %I %s não pode ser zero', _artigo.artigo_nome, case\n        when _new.venda_descricao != _artigo.artigo_nome then format( 'com descrição %I', _new.venda_descricao )\n        else ''\n      end) ;\n    end if;\n\n    -- Garantir que a quantidade vendida só seja negativa para o caso de conta corrente\n    if _new.venda_quantidade < 0 and _conta.conta_conta_docorigin is null then\n      raise exception '%', format( 'Não vender o artigo %I %s com quantidade negativa!', _artigo.artigo_nome, case\n        when _new.venda_descricao != _artigo.artigo_nome then format( 'com descrição %I', _new.venda_descricao )\n        else ''\n      end);\n    end if;\n\n    return new;\n  end if;\nend;\n$$;\n	create or replace function tweeks.__tg_venda_before_check() returns trigger language plpgsql as $$ declare _conta record; _artigo record; _new tweeks.venda; begin if upper( tg_op ) in ( 'INSERT', 'UPDATE' ) then _new := new; select * from tweeks.conta ct where ct.conta_id = _new.venda_conta_id into _conta ; select * from tweeks.artigo a where a.artigo_id = _new.venda_artigo_id into _artigo ; -- Garantir que a quantidade vendida nunca seja de zero if new.venda_quantidade = 0 then raise exception '%', format('A quantidade de artigo para %I %s não pode ser zero', _artigo.artigo_nome, case when _new.venda_descricao != _artigo.artigo_nome then format( 'com descrição %I', _new.venda_descricao ) else '' end) ; end if; -- Garantir que a quantidade vendida só seja negativa para o caso de conta corrente if _new.venda_quantidade < 0 and _conta.conta_conta_docorigin is null then raise exception '%', format( 'Não vender o artigo %I %s com quantidade negativa!', _artigo.artigo_nome, case when _new.venda_descricao != _artigo.artigo_nome then format( 'com descrição %I', _new.venda_descricao ) else '' end); end if; return new; end if; end; $$;
dadd3ca4-34a7-4480-b746-1bc06c66cc05	\ncreate trigger tg_venda_before_check\n  after insert or update\n  on tweeks.venda\n  for each row\n  execute procedure tweeks.__tg_venda_before_check();\n	create trigger tg_venda_before_check after insert or update on tweeks.venda for each row execute procedure tweeks.__tg_venda_before_check();
f3d3bea8-d948-4abb-a0bd-2136828846b3	\ncreate or replace function tweeks.funct_pos_generate_key( args jsonb )\n    returns character varying\n    language plpgsql as $$\n  declare\n    /**\n      arg_colaborador_id uuid\n      arg_espaco_auth uuid\n     */\n    arg_colaborador_id uuid default args->>'arg_colaborador_id';\n    arg_espaco_auth uuid default args->>'arg_espaco_auth';\n    ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n    _key character varying;\n  begin\n    while _key is null loop\n        _key :=  cluster.next( 'artigo.key/seq', ___branch::text, lpad := 9, lpad_char := '0' );\n        _key := format( 'CTK-%s-%s', _key, lib.dset_random_text(32 ) );\n        if exists(\n            select *\n              from tweeks.conta ct\n              where ct.conta_chave = _key\n                and ct._branch_uid = ___branch\n        ) then\n          _key := null;\n        end if;\n      end loop;\n    return _key;\n  end;\n  $$;\n	create or replace function tweeks.funct_pos_generate_key( args jsonb ) returns character varying language plpgsql as $$ declare /** arg_colaborador_id uuid arg_espaco_auth uuid */ arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _key character varying; begin while _key is null loop _key := cluster.next( 'artigo.key/seq', ___branch::text, lpad := 9, lpad_char := '0' ); _key := format( 'CTK-%s-%s', _key, lib.dset_random_text(32 ) ); if exists( select * from tweeks.conta ct where ct.conta_chave = _key and ct._branch_uid = ___branch ) then _key := null; end if; end loop; return _key; end; $$;
8d975386-a7bf-4871-b809-663227d7ab9f	\ncreate or replace function tweeks.funct_pos_reg_conta(args jsonb) returns lib.res\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    Essa função registra um nova conta\n    arg = {\n      -- obrigatorios\n      arg_colaborador_id: ID,\n      arg_espaco_auth: ID,\n\n      conta_posto_id: ID,\n\n      -- opcional\n      conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM }\n      conta_id: ID?\n      conta_extension: {} | { reserva_id: UID }\n      conta_chave: CHAVE\n\n      conta_currency_id: ID,\n      conta_tpaga_id: ID,\n\n      conta_cliente_id:UID\n      conta_titular: CLIENTE-NOME\n      conta_titularnif: CLIENTE-NIF\n      conta_data: DATA,\n      conta_tserie_id\n\n      -- requerido\n      arg_vendas: [\n        {\n          venda_id?: UID,\n          venda_artigo_id: UID,\n          venda_quantidade: QUANT,\n          venda_custounitario: COST\n          venda_custoquantidade: COST\n\n          + venda_editado\n          + venda_isencao\n          + venda_montante\n          + venda_montanteagregado\n          + venda_montantetotal\n          + venda_imposto\n          + venda_montantesemimposto\n          + venda_montantecomimposto\n          + venda_impostoadicionar\n          + venda_impostoretirar\n\n          + venda_descricao\n          + venda_lote\n          + venda_validade\n          + venda_metadata\n\n          arg_itens: [\n              venda_id: UID\n              venda_artigo_id: UID,\n              venda_quantidade: QUANT,\n              venda_custounitario: COST\n              venda_custoquantidade: COST\n              venda_descricao: DESCRICAO\n              venda_lote: LOTE\n              venda_validade: VALIDADE\n              venda_metadata: {... any extras data}\n            + venda_montantetotal\n          ]\n        }\n      ]\n    }\n   */\n\n  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n  arg_conta_id uuid default args->>'conta_id';\n  arg_conta_chave character varying not null default args->>'conta_chave';\n  arg_vendas jsonb not null default args->>'arg_vendas';\n\n  _conta tweeks.conta;\n  _const map.constant;\n  _unsets jsonb[];\n  _vendas uuid[] default array( select ( e.doc->>'venda_id' )::uuid from jsonb_array_elements( args->'arg_vendas' ) e ( doc ) where e.doc->>'venda_id' is not null);\n  _sync jsonb;\n  _reg_venda record;\n  _change tweeks.conta;\n  _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  _message text;\n  _new jsonb;\n  _old jsonb;\nbegin\n  _const := map.constant();\n  _conta := tweeks._get_conta( arg_conta_id );\n  \n  if _conta.conta_id is null and exists(\n    select *\n      from tweeks.conta ct \n      where ct.conta_chave = arg_conta_chave\n        and ct._branch_uid = _branch\n  ) then\n    return lib.res_false( 'Já existe uma conta com a mesma chave (atualize a pagina e tente novamente)!' );\n  end if;\n  \n  _old := coalesce( to_jsonb( _conta ), jsonb_build_object() );\n  _change := jsonb_populate_record( _conta, args );\n  _change.conta_data := coalesce( _change.conta_data, current_date );\n  _new := to_jsonb( _change );\n  \n  if _change.conta_tserie_id is null then \n      raise exception '%', format('O tipo de serie é obrigatorio na criação de uma nova conta!');\n  end if;\n\n  if _change.conta_id is null then\n    _change.conta_colaborador_id := arg_colaborador_id;\n    _change.conta_espaco_auth := arg_espaco_auth;\n    _change.conta_numero := cluster.next( 'conta.conta_numero/seq',\n      sub := _branch::text,\n      lpad_char := '0',\n      lpad := 5\n    );\n    _new := to_jsonb( _change );\n  else\n    _change.conta_colaborador_atualizacao := arg_colaborador_id;\n    _new := to_jsonb( _change );\n    _change.conta_dataatualizacao := current_timestamp;\n  end if;\n  \n  _message := tweeks.__check_conta_data(\n    _change.conta_tserie_id,\n    _change.conta_data,\n    false\n  );\n  \n  if _message is not  null then\n    return lib.res_false( _message );\n  end if;\n  \n  select ( "returning" ).* into _conta\n    from lib.sets( _change, replacer := args )  sets\n    where _new != _old\n  ;\n  \n  -- Canselar as vendas que não fazem mais parte de conta\n  with recursive __venda as (\n      select\n          ve.venda_id,\n          ve.venda_estado\n        from tweeks.venda ve\n        where ve.venda_conta_id = _conta.conta_id\n          and ve.venda_venda_id is null\n          and ve.venda_id != all( _vendas )\n          and ve.venda_estado in (\n            _const.maguita_venda_estado_aberto,\n            _const.maguita_venda_estado_fechado\n          )\n      union all\n        select\n            ve.venda_id,\n            ve.venda_estado\n          from __venda vs\n            inner join tweeks.venda ve on vs.venda_id = ve.venda_venda_id\n          where vs.venda_estado in (\n            _const.maguita_venda_estado_aberto,\n            _const.maguita_venda_estado_fechado\n          )\n  ), __disable as(\n    update tweeks.venda up\n      set venda_estado = _const.maguita_venda_estado_canselado\n      from __venda _v\n      where up.venda_id = _v.venda_id\n      returning *\n  ) select array_agg( to_jsonb( d ) ) into _unsets\n      from __disable d;\n\n\n  _reg_venda :=  tweeks.funct_pos_reg_venda(\n    jsonb_build_object(\n      'arg_vendas', arg_vendas,\n      'arg_message_error', true,\n      'arg_espaco_auth', arg_espaco_auth,\n      'arg_colaborador_id', arg_colaborador_id,\n      'arg_conta_id', _conta.conta_id\n    )\n  );\n\n  _sync := tweeks.funct_pos__sync_conta_amount(\n    jsonb_build_object(\n      'arg_conta_id', _conta.conta_id,\n      'arg_colaborador_id', arg_colaborador_id,\n      'arg_espaco_auth', arg_espaco_auth\n    )\n  );\n\n  return lib.res_true( tweeks.funct_pos_load_conta_data( jsonb_build_object(\n    'arg_posto_id', args->'conta_posto_id',\n    'arg_espaco_auth', arg_espaco_auth,\n    'arg_colaborador_id', arg_colaborador_id,\n    'arg_conta_id', _conta.conta_id\n  )) || jsonb_build_object(\n    'sync', _sync,\n    'sets', _reg_venda.data->'vendas',\n    'unsets', coalesce( _unsets, array[]::jsonb[])\n  ));\n\nexception  when others then\n  <<_ex>> declare e text; m text; d text; h text; c text;\n  begin\n    get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context;\n    return lib.res_exception( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c );\n  end;\nend;\n$$;\n	create or replace function tweeks.funct_pos_reg_conta(args jsonb) returns lib.res language plpgsql as $$ declare /** Essa função registra um nova conta arg = { -- obrigatorios arg_colaborador_id: ID, arg_espaco_auth: ID, conta_posto_id: ID, -- opcional conta_mesa: { numero:NUM, descricao:TEXT, lotacao:NUM } conta_id: ID? conta_extension: {} | { reserva_id: UID } conta_chave: CHAVE conta_currency_id: ID, conta_tpaga_id: ID, conta_cliente_id:UID conta_titular: CLIENTE-NOME conta_titularnif: CLIENTE-NIF conta_data: DATA, conta_tserie_id -- requerido arg_vendas: [ { venda_id?: UID, venda_artigo_id: UID, venda_quantidade: QUANT, venda_custounitario: COST venda_custoquantidade: COST + venda_editado + venda_isencao + venda_montante + venda_montanteagregado + venda_montantetotal + venda_imposto + venda_montantesemimposto + venda_montantecomimposto + venda_impostoadicionar + venda_impostoretirar + venda_descricao + venda_lote + venda_validade + venda_metadata arg_itens: [ venda_id: UID venda_artigo_id: UID, venda_quantidade: QUANT, venda_custounitario: COST venda_custoquantidade: COST venda_descricao: DESCRICAO venda_lote: LOTE venda_validade: VALIDADE venda_metadata: {... any extras data} + venda_montantetotal ] } ] } */ arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_conta_id uuid default args->>'conta_id'; arg_conta_chave character varying not null default args->>'conta_chave'; arg_vendas jsonb not null default args->>'arg_vendas'; _conta tweeks.conta; _const map.constant; _unsets jsonb[]; _vendas uuid[] default array( select ( e.doc->>'venda_id' )::uuid from jsonb_array_elements( args->'arg_vendas' ) e ( doc ) where e.doc->>'venda_id' is not null); _sync jsonb; _reg_venda record; _change tweeks.conta; _branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _message text; _new jsonb; _old jsonb; begin _const := map.constant(); _conta := tweeks._get_conta( arg_conta_id ); if _conta.conta_id is null and exists( select * from tweeks.conta ct where ct.conta_chave = arg_conta_chave and ct._branch_uid = _branch ) then return lib.res_false( 'Já existe uma conta com a mesma chave (atualize a pagina e tente novamente)!' ); end if; _old := coalesce( to_jsonb( _conta ), jsonb_build_object() ); _change := jsonb_populate_record( _conta, args ); _change.conta_data := coalesce( _change.conta_data, current_date ); _new := to_jsonb( _change ); if _change.conta_tserie_id is null then raise exception '%', format('O tipo de serie é obrigatorio na criação de uma nova conta!'); end if; if _change.conta_id is null then _change.conta_colaborador_id := arg_colaborador_id; _change.conta_espaco_auth := arg_espaco_auth; _change.conta_numero := cluster.next( 'conta.conta_numero/seq', sub := _branch::text, lpad_char := '0', lpad := 5 ); _new := to_jsonb( _change ); else _change.conta_colaborador_atualizacao := arg_colaborador_id; _new := to_jsonb( _change ); _change.conta_dataatualizacao := current_timestamp; end if; _message := tweeks.__check_conta_data( _change.conta_tserie_id, _change.conta_data, false ); if _message is not null then return lib.res_false( _message ); end if; select ( "returning" ).* into _conta from lib.sets( _change, replacer := args ) sets where _new != _old ; -- Canselar as vendas que não fazem mais parte de conta with recursive __venda as ( select ve.venda_id, ve.venda_estado from tweeks.venda ve where ve.venda_conta_id = _conta.conta_id and ve.venda_venda_id is null and ve.venda_id != all( _vendas ) and ve.venda_estado in ( _const.maguita_venda_estado_aberto, _const.maguita_venda_estado_fechado ) union all select ve.venda_id, ve.venda_estado from __venda vs inner join tweeks.venda ve on vs.venda_id = ve.venda_venda_id where vs.venda_estado in ( _const.maguita_venda_estado_aberto, _const.maguita_venda_estado_fechado ) ), __disable as( update tweeks.venda up set venda_estado = _const.maguita_venda_estado_canselado from __venda _v where up.venda_id = _v.venda_id returning * ) select array_agg( to_jsonb( d ) ) into _unsets from __disable d; _reg_venda := tweeks.funct_pos_reg_venda( jsonb_build_object( 'arg_vendas', arg_vendas, 'arg_message_error', true, 'arg_espaco_auth', arg_espaco_auth, 'arg_colaborador_id', arg_colaborador_id, 'arg_conta_id', _conta.conta_id ) ); _sync := tweeks.funct_pos__sync_conta_amount( jsonb_build_object( 'arg_conta_id', _conta.conta_id, 'arg_colaborador_id', arg_colaborador_id, 'arg_espaco_auth', arg_espaco_auth ) ); return lib.res_true( tweeks.funct_pos_load_conta_data( jsonb_build_object( 'arg_posto_id', args->'conta_posto_id', 'arg_espaco_auth', arg_espaco_auth, 'arg_colaborador_id', arg_colaborador_id, 'arg_conta_id', _conta.conta_id )) || jsonb_build_object( 'sync', _sync, 'sets', _reg_venda.data->'vendas', 'unsets', coalesce( _unsets, array[]::jsonb[]) )); exception when others then <<_ex>> declare e text; m text; d text; h text; c text; begin get stacked diagnostics e=returned_sqlstate, m=message_text, d=pg_exception_detail, h=pg_exception_hint, c=pg_exception_context; return lib.res_exception( _ex.e, _ex.m, _ex.h, _ex.d, _ex.c ); end; end; $$;
7163d02d-6e4c-4059-84b1-40ed641f4505	\n  alter table tweeks.conta add column if not exists conta_props jsonb default null;\n	alter table tweeks.conta add column if not exists conta_props jsonb default null;
a6b4d496-597e-4fa6-98b0-c6284fd46fe2	\nalter table tweeks.venda add column if not exists venda_proforma boolean default false;\n	alter table tweeks.venda add column if not exists venda_proforma boolean default false;
8847aeb5-608a-459b-ba3c-c1ea69f35bbb	\ncreate or replace function tweeks.funct_pos_load_conta_proforma(filter jsonb DEFAULT NULL::jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /** Essa função serve para devolver as compras do dia em uma data especifica\n    filter := {\n      arg_posto_id: DATE\n      arg_espaco_id uuid\n      arg_colaborador_id\n    }\n   */\n  _const map.constant;\n--   arg_posto_id uuid not null default filter->>'arg_posto_id';\n  arg_colaborador_id uuid not null default filter->>'arg_colaborador_id';\n  arg_espaco_auth uuid not null default filter->>'arg_espaco_auth';\n\n  _posto tweeks.posto;\n  __branch_uid uuid not null default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\nbegin\n--   _posto := tweeks._get_posto( arg_posto_id );\n  _const := map.constant();\n\n  return query\n    with __conta as (\n      select\n          ct.conta_id,\n          ct.conta_data,\n          ct.conta_dataregistro,\n          ct.conta_titular,\n          ct.conta_titularnif,\n          ct.conta_montante,\n          ct.conta_numerofatura,\n          ct.conta_numero,\n          ct.conta_proformavencimento,\n          ct.conta_proformaextras,\n          ct.conta_props,\n          cli.cliente_id,\n          cli.cliente_titular,\n          cli.cliente_nif,\n          cli.cliente_metadata,\n          cli.cliente_documento,\n          td.tdocumento_id,\n          td.tdocumento_nome,\n          co.colaborador_id,\n          co.colaborador_nome,\n          co.colaborador_apelido\n        from tweeks.conta ct\n          left join auth.colaborador co on coalesce( ct.conta_colaborador_fecho, ct.conta_colaborador_atualizacao, ct.conta_colaborador_id ) = co.colaborador_id\n          left join tweeks.cliente cli on ct.conta_cliente_id = cli.cliente_id\n          left join tweeks.tdocuemto td on cli.cliente_tdocument_id = td.tdocumento_id\n        where ct._branch_uid = __branch_uid\n          and ct.conta_estado = _const.maguita_conta_estado_aberto\n          and ct.conta_proforma\n    ) select to_jsonb( _ct )\n        from __conta _ct\n    ;\nend\n$$;\n	create or replace function tweeks.funct_pos_load_conta_proforma(filter jsonb DEFAULT NULL::jsonb) returns SETOF jsonb language plpgsql as $$ declare /** Essa função serve para devolver as compras do dia em uma data especifica filter := { arg_posto_id: DATE arg_espaco_id uuid arg_colaborador_id } */ _const map.constant; -- arg_posto_id uuid not null default filter->>'arg_posto_id'; arg_colaborador_id uuid not null default filter->>'arg_colaborador_id'; arg_espaco_auth uuid not null default filter->>'arg_espaco_auth'; _posto tweeks.posto; __branch_uid uuid not null default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); begin -- _posto := tweeks._get_posto( arg_posto_id ); _const := map.constant(); return query with __conta as ( select ct.conta_id, ct.conta_data, ct.conta_dataregistro, ct.conta_titular, ct.conta_titularnif, ct.conta_montante, ct.conta_numerofatura, ct.conta_numero, ct.conta_proformavencimento, ct.conta_proformaextras, ct.conta_props, cli.cliente_id, cli.cliente_titular, cli.cliente_nif, cli.cliente_metadata, cli.cliente_documento, td.tdocumento_id, td.tdocumento_nome, co.colaborador_id, co.colaborador_nome, co.colaborador_apelido from tweeks.conta ct left join auth.colaborador co on coalesce( ct.conta_colaborador_fecho, ct.conta_colaborador_atualizacao, ct.conta_colaborador_id ) = co.colaborador_id left join tweeks.cliente cli on ct.conta_cliente_id = cli.cliente_id left join tweeks.tdocuemto td on cli.cliente_tdocument_id = td.tdocumento_id where ct._branch_uid = __branch_uid and ct.conta_estado = _const.maguita_conta_estado_aberto and ct.conta_proforma ) select to_jsonb( _ct ) from __conta _ct ; end $$;
939f0a73-2129-4cc3-8a64-6ed4475f45b3	\ncreate or replace function tweeks.funct_load_guia_data(args jsonb) returns SETOF json\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    args := {\n      guia_id UUID,\n      arg_colaborador_id UUID\n      arg_espaco_auth UUID\n    }\n   */\n  arg_colaborador_id uuid default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid default args->>'arg_espaco_auth';\n\n  _guia tweeks.guia;\n  _const map.constant;\n  ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\nbegin\n  _const := map.constant();\n  _guia := jsonb_populate_record( _guia, args );\n  select * into _guia\n    from tweeks.guia\n    where guia_uid = _guia.guia_uid\n      and _branch_uid = ___branch\n  ;\n\n  return next json_build_object( 'type', cluster.__format( pg_typeof( _guia )::text::regclass ), 'data', _guia );\n\n  return query with __custoguia as (\n    select ent as data, cluster.__format( ent.tableoid ) as type\n      from tweeks.custoguia ent\n      where ent.custoguia_guia_uid = _guia.guia_uid\n        and ent.custoguia_estado = _const.maguita_custoguia_estado_ativo\n        and ent._branch_uid = ___branch\n  ) select to_json( _e ) from __custoguia _e;\n\n  if _guia.guia_toperacao_id = _const.maguita_toperacao_entrada then\n    return query with __raw as (\n      select ent.*,\n             art.artigo_id,\n             art.artigo_nome,\n             art.artigo_codigo,\n             un.unit_id,\n             un.unit_code,\n             un.unit_name,\n             cluster.__format( ent.tableoid ) as type\n        from tweeks.entrada ent\n          inner join tweeks.artigo art on ent.entrada_artigo_id = art.artigo_id\n          left join tweeks.unit un on art.artigo_unit_id = un.unit_id\n        where ent.entrada_guia_id = _guia.guia_uid\n          and ent.entrada_estado = _const.entrada_estado_ativo\n          and ent._branch_uid = ___branch\n    ), __entrada as (\n      select to_json( r ) as data, r.type\n        from __raw r\n    ) select to_json( _e ) from __entrada _e;\n\n    return query with __fornecedor as (\n      select ent as data, cluster.__format( ent.tableoid ) as type\n        from tweeks.fornecedor ent\n      where ent._branch_uid = ___branch\n        and ent.fornecedor_id = _guia.guia_refuid\n        and _guia.guia_refclass::regclass = ent.TABLEOID::regclass\n    ) select to_json( _f ) from __fornecedor _f;\n\n  elseif _guia.guia_toperacao_id = _const.maguita_toperacao_venda then\n    return query with __venda as (\n      select ent as data, cluster.__format( 'tweeks.conta'::regclass ) as type\n      from tweeks.funct_pos_load_conta_data( args ) ent\n    ) select to_json( _e ) from __venda _e;\n\n  end if;\nend\n$$;\n	create or replace function tweeks.funct_load_guia_data(args jsonb) returns SETOF json language plpgsql as $$ declare /** args := { guia_id UUID, arg_colaborador_id UUID arg_espaco_auth UUID } */ arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; _guia tweeks.guia; _const map.constant; ___branch uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); begin _const := map.constant(); _guia := jsonb_populate_record( _guia, args ); select * into _guia from tweeks.guia where guia_uid = _guia.guia_uid and _branch_uid = ___branch ; return next json_build_object( 'type', cluster.__format( pg_typeof( _guia )::text::regclass ), 'data', _guia ); return query with __custoguia as ( select ent as data, cluster.__format( ent.tableoid ) as type from tweeks.custoguia ent where ent.custoguia_guia_uid = _guia.guia_uid and ent.custoguia_estado = _const.maguita_custoguia_estado_ativo and ent._branch_uid = ___branch ) select to_json( _e ) from __custoguia _e; if _guia.guia_toperacao_id = _const.maguita_toperacao_entrada then return query with __raw as ( select ent.*, art.artigo_id, art.artigo_nome, art.artigo_codigo, un.unit_id, un.unit_code, un.unit_name, cluster.__format( ent.tableoid ) as type from tweeks.entrada ent inner join tweeks.artigo art on ent.entrada_artigo_id = art.artigo_id left join tweeks.unit un on art.artigo_unit_id = un.unit_id where ent.entrada_guia_id = _guia.guia_uid and ent.entrada_estado = _const.entrada_estado_ativo and ent._branch_uid = ___branch ), __entrada as ( select to_json( r ) as data, r.type from __raw r ) select to_json( _e ) from __entrada _e; return query with __fornecedor as ( select ent as data, cluster.__format( ent.tableoid ) as type from tweeks.fornecedor ent where ent._branch_uid = ___branch and ent.fornecedor_id = _guia.guia_refuid and _guia.guia_refclass::regclass = ent.TABLEOID::regclass ) select to_json( _f ) from __fornecedor _f; elseif _guia.guia_toperacao_id = _const.maguita_toperacao_venda then return query with __venda as ( select ent as data, cluster.__format( 'tweeks.conta'::regclass ) as type from tweeks.funct_pos_load_conta_data( args ) ent ) select to_json( _e ) from __venda _e; end if; end $$;
3c06a093-51df-44fd-b5f9-c595ef77e6ef	\ncreate or replace function tweeks.funct_pos_reg_venda(args jsonb) returns lib.res\n  language plpgsql\nas\n$$\ndeclare\n  /** Essa função serve para associar mais vendas a conta\n    args := {\n      arg_colaborador_id: ID,\n      arg_conta_id: ID,\n      arg_espaco_auth: ID,\n      arg_message_error: TRUE|FALSE,\n      arg_venda_id: ID\n      arg_vendas: [{\n          venda_id?: UID,\n          venda_artigo_id: UID,\n          venda_quantidade: QUANT,\n          venda_custounitario: COST\n          venda_custoquantidade: COST\n\n          + venda_editado BOOLEAN\n          + venda_isencao BOOLEAN\n          + venda_montante\n          + venda_montanteagregado\n          + venda_montantetotal\n          + venda_imposto\n          + venda_montantesemimposto\n          + venda_montantecomimposto\n          + venda_impostoadicionar\n          + venda_impostoretirar\n\n          + venda_descricao\n          + venda_lote\n          + venda_validade\n          + venda_metadata\n          + venda_taxas\n\n          arg_itens: [\n              venda_id: UID\n              venda_artigo_id: UID,\n              venda_quantidade: QUANT,\n              venda_custounitario: COST\n              venda_custoquantidade: COST\n              venda_descricao: DESCRICAO\n              venda_lote: LOTE\n              venda_validade: VALIDADE\n              venda_metadata: {... any extras data}\n            + venda_montantetotal\n          ]\n        }\n      ]\n    }\n   */\n\n  arg_colaborador_id uuid not null default args->>'arg_colaborador_id';\n  arg_conta_id uuid not null default args->>'arg_conta_id';\n  arg_espaco_auth uuid not null default args->>'arg_espaco_auth';\n  arg_vendas jsonb not null default args->>'arg_vendas';\n  arg_message_error boolean default args->>'arg_message_error';\n\n  _const map.constant;\n  _conta tweeks.conta;\n  _data record;\n  _stocks record;\n  _simple tweeks.venda;\n  __vendas tweeks.venda[];\n\nbegin\n  _const := map.constant();\n  _conta := tweeks._get_conta( arg_conta_id );\n\n  -- Quando a conta não esta aberta\n  if _conta.conta_estado != _const.maguita_conta_estado_aberto and arg_message_error then\n    raise exception '@conta.estado.not-closed';\n  elseif  _conta.conta_estado != _const.maguita_conta_estado_aberto then\n    return false ? '@conta.estado.not-closed';\n  end if;\n\n  _stocks := tweeks.__check_stock_on_venda( arg_espaco_auth, arg_vendas );\n\n  if not _stocks.stocks  and arg_message_error then\n    raise exception '%', _stocks.message;\n\n  elsif not _stocks.stocks  then\n    return lib.res_false(\n      _stocks.message\n    );\n  end if;\n\n  with recursive __element as (\n    select\n        row_number() over () as row,\n           ( jsonb_populate_record( null::tweeks.venda, e.doc || jsonb_build_object(\n              'venda_proforma', _conta.conta_proforma\n          ) )).*,\n--         ( e.doc->>'venda_artigo_id' )::uuid  as venda_artigo_id,\n--         ( e.doc->>'venda_quantidade' )::double precision as venda_quantidade,\n--         ( e.doc->>'venda_custounitario' )::double precision as venda_custounitario,\n--         ( e.doc->>'venda_custoquantidade' )::double precision as venda_custoquantidade,\n        ( e.doc || jsonb_build_object(\n          'venda_proforma', _conta.conta_proforma\n        ) )::jsonb  as document,\n        coalesce( e.doc->'arg_itens', '[ ]'::jsonb )::jsonb as itens,\n        false as _is_extension\n      from jsonb_array_elements( arg_vendas ) e ( doc )\n    union all\n      select\n          row,\n          ( jsonb_populate_record( null::tweeks.venda, e.doc || jsonb_build_object(\n              'venda_montanteagregado', 0,\n              'venda_imposto', 0,\n              'venda_montantesemimposto', 0,\n              'venda_montantecomimposto', 0,\n              'venda_imposto', 0,\n              'venda_editado', false,\n              'venda_taxas', jsonb_build_array(),\n              'venda_proforma', _conta.conta_proforma\n            \n            ))).*,\n--           ( e.doc->>'venda_artigo_id' )::uuid  as venda_artigo_id,\n--           ( e.doc->>'venda_quantidade' )::double precision as venda_quantidade,\n--           ( e.doc->>'venda_custounitario' )::double precision as venda_custounitario,\n--           ( e.doc->>'venda_custoquantidade' )::double precision as venda_custoquantidade,\n          ( e.doc || jsonb_build_object(\n            'venda_proforma', _conta.conta_proforma\n          ))::jsonb  as document,\n          coalesce( e.doc->'arg_itens', '[]'::jsonb )::jsonb as itens,\n          true as _is_extension\n        from __element ep\n          inner join jsonb_array_elements( ep.itens ) e( doc ) on jsonb_array_length( ep.itens ) > 0\n        where jsonb_array_length( ep.itens ) > 0\n          and ep.itens is not null\n  ), __calcs as (\n    select\n        e.*,\n        e.document as docreplacer,\n        ve.venda_id as _venda_id,\n        coalesce( ve.venda_dataregistro, now() ) as venda_dataregistro,\n        coalesce( ve.venda_colaborador_id, arg_colaborador_id ) as venda_colaborador_id,\n        coalesce( ve.venda_conta_id, arg_conta_id ) as venda_conta_id,\n        coalesce( ve.venda_espaco_auth, arg_espaco_auth ) as venda_espaco_auth,\n        case\n          when art.artigo_preparacao then _const.maguita_venda_estadopreparacao_pendente\n          else _const.maguita_venda_estadopreparacao_preparado\n        end as venda_estadopreparacao\n      from __element e\n        inner join tweeks.artigo art on e.venda_artigo_id = art.artigo_id\n        left join tweeks.venda ve on ve.venda_id = ( e.document->>'venda_id' )::uuid\n      where ve.venda_id is null\n        or( ve.venda_id is not null and true in (\n          ve.venda_quantidade != e.venda_quantidade,\n          ve.venda_custounitario != e.venda_custounitario,\n          ve.venda_custoquantidade != e.venda_custoquantidade,\n          ve.venda_montante != e.venda_montante,\n          ve.venda_montanteagregado != e.venda_montanteagregado,\n          coalesce( ve.venda_proforma, false ) != coalesce( e.venda_proforma, false ),\n          ve.venda_montantetotal != e.venda_montantetotal,\n          ve.venda_imposto != e.venda_imposto,\n          ve.venda_montantesemimposto != e.venda_montantesemimposto,\n          ve.venda_montantecomimposto != e.venda_montantecomimposto,\n          ve.venda_impostoadicionar != e.venda_impostoadicionar,\n          ve.venda_impostoretirar != e.venda_impostoretirar,\n          ve.venda_descricao != e.venda_descricao,\n          ve.venda_lote != e.venda_lote,\n          ve.venda_validade != e.venda_validade,\n          ve.venda_artigo_id != e.venda_artigo_id,\n          ve.venda_metadata::text != e.venda_metadata::text\n        ))\n  ), __sets as (\n    select "returning"::tweeks.venda, row, c._is_extension\n      from __calcs c\n        inner join lib.sets( _simple, replacer := (to_jsonb( c ) - 'venda_estado' - 'venda_id' - 'venda_taxas')\n          || c.docreplacer\n          ||  jsonb_build_object(\n          'venda_colaborador_atualizacao', case\n            when c._venda_id is null then null\n            else arg_colaborador_id\n          end,\n          'venda_dataatualizacao', case\n            when c._venda_id is null then null\n            else current_timestamp\n          end\n        )) on true\n      where not c._is_extension\n    union all\n      select _s."returning"::tweeks.venda, c.row, true\n        from __sets sui\n          inner join __calcs c on sui.row = c.row and c._is_extension\n          inner join lib.sets( _simple, replacer := ( to_jsonb( c ) - 'venda_estado' - 'venda_id' - 'venda_taxas' )\n              || c.docreplacer\n              || jsonb_build_object(\n            'venda_venda_id', (sui."returning"::tweeks.venda).venda_id,\n            'venda_colaborador_atualizacao', case\n              when c._venda_id is null then null\n              else arg_colaborador_id\n              end,\n            'venda_dataatualizacao', case\n              when c._venda_id is null then null\n              else current_timestamp\n            end\n          )) _s on true\n        where not sui._is_extension\n  ) select array_agg( "returning" ) into __vendas from __sets;\n\n  return lib.res_true( jsonb_build_object(\n    'vendas', __vendas\n  ));\nend\n$$;\n	create or replace function tweeks.funct_pos_reg_venda(args jsonb) returns lib.res language plpgsql as $$ declare /** Essa função serve para associar mais vendas a conta args := { arg_colaborador_id: ID, arg_conta_id: ID, arg_espaco_auth: ID, arg_message_error: TRUE|FALSE, arg_venda_id: ID arg_vendas: [{ venda_id?: UID, venda_artigo_id: UID, venda_quantidade: QUANT, venda_custounitario: COST venda_custoquantidade: COST + venda_editado BOOLEAN + venda_isencao BOOLEAN + venda_montante + venda_montanteagregado + venda_montantetotal + venda_imposto + venda_montantesemimposto + venda_montantecomimposto + venda_impostoadicionar + venda_impostoretirar + venda_descricao + venda_lote + venda_validade + venda_metadata + venda_taxas arg_itens: [ venda_id: UID venda_artigo_id: UID, venda_quantidade: QUANT, venda_custounitario: COST venda_custoquantidade: COST venda_descricao: DESCRICAO venda_lote: LOTE venda_validade: VALIDADE venda_metadata: {... any extras data} + venda_montantetotal ] } ] } */ arg_colaborador_id uuid not null default args->>'arg_colaborador_id'; arg_conta_id uuid not null default args->>'arg_conta_id'; arg_espaco_auth uuid not null default args->>'arg_espaco_auth'; arg_vendas jsonb not null default args->>'arg_vendas'; arg_message_error boolean default args->>'arg_message_error'; _const map.constant; _conta tweeks.conta; _data record; _stocks record; _simple tweeks.venda; __vendas tweeks.venda[]; begin _const := map.constant(); _conta := tweeks._get_conta( arg_conta_id ); -- Quando a conta não esta aberta if _conta.conta_estado != _const.maguita_conta_estado_aberto and arg_message_error then raise exception '@conta.estado.not-closed'; elseif _conta.conta_estado != _const.maguita_conta_estado_aberto then return false ? '@conta.estado.not-closed'; end if; _stocks := tweeks.__check_stock_on_venda( arg_espaco_auth, arg_vendas ); if not _stocks.stocks and arg_message_error then raise exception '%', _stocks.message; elsif not _stocks.stocks then return lib.res_false( _stocks.message ); end if; with recursive __element as ( select row_number() over () as row, ( jsonb_populate_record( null::tweeks.venda, e.doc || jsonb_build_object( 'venda_proforma', _conta.conta_proforma ) )).*, -- ( e.doc->>'venda_artigo_id' )::uuid as venda_artigo_id, -- ( e.doc->>'venda_quantidade' )::double precision as venda_quantidade, -- ( e.doc->>'venda_custounitario' )::double precision as venda_custounitario, -- ( e.doc->>'venda_custoquantidade' )::double precision as venda_custoquantidade, ( e.doc || jsonb_build_object( 'venda_proforma', _conta.conta_proforma ) )::jsonb as document, coalesce( e.doc->'arg_itens', '[ ]'::jsonb )::jsonb as itens, false as _is_extension from jsonb_array_elements( arg_vendas ) e ( doc ) union all select row, ( jsonb_populate_record( null::tweeks.venda, e.doc || jsonb_build_object( 'venda_montanteagregado', 0, 'venda_imposto', 0, 'venda_montantesemimposto', 0, 'venda_montantecomimposto', 0, 'venda_imposto', 0, 'venda_editado', false, 'venda_taxas', jsonb_build_array(), 'venda_proforma', _conta.conta_proforma ))).*, -- ( e.doc->>'venda_artigo_id' )::uuid as venda_artigo_id, -- ( e.doc->>'venda_quantidade' )::double precision as venda_quantidade, -- ( e.doc->>'venda_custounitario' )::double precision as venda_custounitario, -- ( e.doc->>'venda_custoquantidade' )::double precision as venda_custoquantidade, ( e.doc || jsonb_build_object( 'venda_proforma', _conta.conta_proforma ))::jsonb as document, coalesce( e.doc->'arg_itens', '[]'::jsonb )::jsonb as itens, true as _is_extension from __element ep inner join jsonb_array_elements( ep.itens ) e( doc ) on jsonb_array_length( ep.itens ) > 0 where jsonb_array_length( ep.itens ) > 0 and ep.itens is not null ), __calcs as ( select e.*, e.document as docreplacer, ve.venda_id as _venda_id, coalesce( ve.venda_dataregistro, now() ) as venda_dataregistro, coalesce( ve.venda_colaborador_id, arg_colaborador_id ) as venda_colaborador_id, coalesce( ve.venda_conta_id, arg_conta_id ) as venda_conta_id, coalesce( ve.venda_espaco_auth, arg_espaco_auth ) as venda_espaco_auth, case when art.artigo_preparacao then _const.maguita_venda_estadopreparacao_pendente else _const.maguita_venda_estadopreparacao_preparado end as venda_estadopreparacao from __element e inner join tweeks.artigo art on e.venda_artigo_id = art.artigo_id left join tweeks.venda ve on ve.venda_id = ( e.document->>'venda_id' )::uuid where ve.venda_id is null or( ve.venda_id is not null and true in ( ve.venda_quantidade != e.venda_quantidade, ve.venda_custounitario != e.venda_custounitario, ve.venda_custoquantidade != e.venda_custoquantidade, ve.venda_montante != e.venda_montante, ve.venda_montanteagregado != e.venda_montanteagregado, coalesce( ve.venda_proforma, false ) != coalesce( e.venda_proforma, false ), ve.venda_montantetotal != e.venda_montantetotal, ve.venda_imposto != e.venda_imposto, ve.venda_montantesemimposto != e.venda_montantesemimposto, ve.venda_montantecomimposto != e.venda_montantecomimposto, ve.venda_impostoadicionar != e.venda_impostoadicionar, ve.venda_impostoretirar != e.venda_impostoretirar, ve.venda_descricao != e.venda_descricao, ve.venda_lote != e.venda_lote, ve.venda_validade != e.venda_validade, ve.venda_artigo_id != e.venda_artigo_id, ve.venda_metadata::text != e.venda_metadata::text )) ), __sets as ( select "returning"::tweeks.venda, row, c._is_extension from __calcs c inner join lib.sets( _simple, replacer := (to_jsonb( c ) - 'venda_estado' - 'venda_id' - 'venda_taxas') || c.docreplacer || jsonb_build_object( 'venda_colaborador_atualizacao', case when c._venda_id is null then null else arg_colaborador_id end, 'venda_dataatualizacao', case when c._venda_id is null then null else current_timestamp end )) on true where not c._is_extension union all select _s."returning"::tweeks.venda, c.row, true from __sets sui inner join __calcs c on sui.row = c.row and c._is_extension inner join lib.sets( _simple, replacer := ( to_jsonb( c ) - 'venda_estado' - 'venda_id' - 'venda_taxas' ) || c.docreplacer || jsonb_build_object( 'venda_venda_id', (sui."returning"::tweeks.venda).venda_id, 'venda_colaborador_atualizacao', case when c._venda_id is null then null else arg_colaborador_id end, 'venda_dataatualizacao', case when c._venda_id is null then null else current_timestamp end )) _s on true where not sui._is_extension ) select array_agg( "returning" ) into __vendas from __sets; return lib.res_true( jsonb_build_object( 'vendas', __vendas )); end $$;
efee91e4-102d-402f-a2e1-2a1639ea6fc2	\nwith __source ( tserie_id, tserie_desc, tserie_code, tserie_seqlimit, tserie_numlimit ) as (\n    VALUES (6, 'Fatura proforma', 'FP', 6, 7)\n) select *\n  from __source _s\n    inner join lib.sets( _s::text::tweeks.tserie ) on true\n;\n\nselect * from map.constant( 'maguita_tserie_faturaproforma', 'int2', 6, 'Serie para guia de saida!' );\n\nalter table tweeks.conta add column if not exists conta_tserie_id int2 default null;\nwith __conta_fechada as (\n  select *\n    from tweeks.conta ct\n      inner join tweeks.serie s on ct.conta_serie_id = s.serie_id\n    where ct.conta_estado = ( map.constant()).maguita_conta_estado_fechado\n) update tweeks.conta c\n  set conta_tserie_id = cf.conta_tserie_id\n    from __conta_fechada cf \n    where cf.conta_id = c.conta_id \n	with __source ( tserie_id, tserie_desc, tserie_code, tserie_seqlimit, tserie_numlimit ) as ( VALUES (6, 'Fatura proforma', 'FP', 6, 7) ) select * from __source _s inner join lib.sets( _s::text::tweeks.tserie ) on true ; select * from map.constant( 'maguita_tserie_faturaproforma', 'int2', 6, 'Serie para guia de saida!' ); alter table tweeks.conta add column if not exists conta_tserie_id int2 default null; with __conta_fechada as ( select * from tweeks.conta ct inner join tweeks.serie s on ct.conta_serie_id = s.serie_id where ct.conta_estado = ( map.constant()).maguita_conta_estado_fechado ) update tweeks.conta c set conta_tserie_id = cf.conta_tserie_id from __conta_fechada cf where cf.conta_id = c.conta_id
66707f08-762b-4bf2-9add-764f75b9b347	\ndelete from report.template where type = 'query';\n\ninsert into report.template( type, name, configs ) values ('query', 'date|start', '{\n  "opr": ">=",\n  "format": "date",\n  "name": { "$template": true, "$type": "text", "$structure": "${name} INICIO", "$default": "DATA INICIO"}\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'date|end', '{\n  "opr": "<=",\n  "format": "date",\n  "name": { "$template": true, "$type": "text", "$structure": "${name} FIM", "$default": "DATA FIM"}\n}');\n\n\ninsert into report.template( type, name, configs ) values ('query', 'range|start', '{\n  "opr": ">=",\n  "format": { "$template": true, "$type": "text", "$structure": "${format}", "$default": "DE"},\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default": "DE"}\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'range|end', '{\n  "opr": "<=",\n  "format": { "$template": true, "$type": "text", "$structure": "${format}", "$default": "ATÉ"},\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default": "ATÉ"}\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'equalsSimple', '{\n  "opr": { "$template": true, "$type": "text", "default": "=", "$structure": "${args.opr}"},\n  "format": "simple",\n  "name": { "$template": true, "$type": "text", "$structure": "Filtrar por ${args.name}"}\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'like', '{\n  "opr": "like",\n  "format": "simple",\n  "mode": { "$template": true, "$type": "text", "$structure": "${args.mode}", "$default":"right" },\n  "name": { "$template": true, "$type": "text", "$structure": "Filtrar por ${args.name}"}\n}');\n\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.posto', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"POSTO" },\n  "format": "select",\n  "source": "tweeks.posto"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'boolean|Y/N', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"OPÇÃO (SIN/NÃO)" },\n  "format": "select",\n  "source": "boolean|Y/N"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'boolean|ON/OFF', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"OPÇÃO (ATIVO/DESATIVO)" },\n  "format": "select",\n  "source": "boolean|ON/OFF"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'STATUS', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"ESTADOS" },\n  "format": "select",\n  "source": "STATUS"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.tgroup', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"ESTADOS" },\n  "format": "select",\n  "source": "tweeks.tgroup"\n}');\n\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.classe', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"CATEGORIA" },\n  "format": "select",\n  "source": "tweeks.classe"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|auth.colaborador', '{\n  "opr": "=",\n  "src": "db",\n  "format":"select",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"COLABORADOR" },\n  "source": "auth.colaborador"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.espaco', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"ARMAZEM" },\n  "format": "select",\n  "source": "tweeks.espaco"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.artigo', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"ARTIGO" },\n  "format": "select",\n  "source": "tweeks.artigo"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|geoinfo.currency', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"MOEDA" },\n  "format": "select",\n  "source": "geoinfo.currency"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.toperacao', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"OPERAÇÃO" },\n  "format": "select",\n  "source": "tweeks.toperacao"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.tpaga', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"MODALIDADE DE PAGAMENTO" },\n  "format": "select",\n  "source": "tweeks.tpaga"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.cliente', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"CLIENTE" },\n  "format": "select",\n  "source": "tweeks.cliente"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.fornecedor', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"FORNECEDOR" },\n  "format": "select",\n  "source": "tweeks.fornecedor"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.tipoimposto', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"TIPO IMPOSTO" },\n  "format": "select",\n  "source": "tweeks.tipoimposto"\n}');\n\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.serie', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"SERIE DE FATURA" },\n  "format": "select",\n  "source": "tweeks.serie"\n}');\n\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.tserie', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"TIPO DE SERIE" },\n  "format": "select",\n  "source": "tweeks.tserie"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.caixa::estado', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"ESTADO DE CAIXA" },\n  "format": "select",\n  "source": "tweeks.caixa::estado"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.tlancamento', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"TIPO DE LANÇAMENTO" },\n  "format": "select",\n  "source": "tweeks.tlancamento"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.lancamento::mode', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"MODO LANÇAMENTO" },\n  "format": "select",\n  "source": "tweeks.lancamento::mode"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.tmovimento', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"TIPO DE MOVIMENTO" },\n  "format": "select",\n  "source": "tweeks.tmovimento"\n}');\n    \ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.tserie::venda', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"SERIE" },\n  "format": "select",\n  "source": "tweeks.tserie::venda"\n}');\n\ninsert into report.template( type, name, configs ) values ('query', 'source|tweeks.caixa', '{\n  "opr": "=",\n  "src": "db",\n  "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"CAIXA" },\n  "format": "select",\n  "source": "tweeks.caixa"\n}');\n    \n	delete from report.template where type = 'query'; insert into report.template( type, name, configs ) values ('query', 'date|start', '{ "opr": ">=", "format": "date", "name": { "$template": true, "$type": "text", "$structure": "${name} INICIO", "$default": "DATA INICIO"} }'); insert into report.template( type, name, configs ) values ('query', 'date|end', '{ "opr": "<=", "format": "date", "name": { "$template": true, "$type": "text", "$structure": "${name} FIM", "$default": "DATA FIM"} }'); insert into report.template( type, name, configs ) values ('query', 'range|start', '{ "opr": ">=", "format": { "$template": true, "$type": "text", "$structure": "${format}", "$default": "DE"}, "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default": "DE"} }'); insert into report.template( type, name, configs ) values ('query', 'range|end', '{ "opr": "<=", "format": { "$template": true, "$type": "text", "$structure": "${format}", "$default": "ATÉ"}, "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default": "ATÉ"} }'); insert into report.template( type, name, configs ) values ('query', 'equalsSimple', '{ "opr": { "$template": true, "$type": "text", "default": "=", "$structure": "${args.opr}"}, "format": "simple", "name": { "$template": true, "$type": "text", "$structure": "Filtrar por ${args.name}"} }'); insert into report.template( type, name, configs ) values ('query', 'like', '{ "opr": "like", "format": "simple", "mode": { "$template": true, "$type": "text", "$structure": "${args.mode}", "$default":"right" }, "name": { "$template": true, "$type": "text", "$structure": "Filtrar por ${args.name}"} }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.posto', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"POSTO" }, "format": "select", "source": "tweeks.posto" }'); insert into report.template( type, name, configs ) values ('query', 'boolean|Y/N', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"OPÇÃO (SIN/NÃO)" }, "format": "select", "source": "boolean|Y/N" }'); insert into report.template( type, name, configs ) values ('query', 'boolean|ON/OFF', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"OPÇÃO (ATIVO/DESATIVO)" }, "format": "select", "source": "boolean|ON/OFF" }'); insert into report.template( type, name, configs ) values ('query', 'STATUS', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"ESTADOS" }, "format": "select", "source": "STATUS" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.tgroup', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"ESTADOS" }, "format": "select", "source": "tweeks.tgroup" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.classe', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"CATEGORIA" }, "format": "select", "source": "tweeks.classe" }'); insert into report.template( type, name, configs ) values ('query', 'source|auth.colaborador', '{ "opr": "=", "src": "db", "format":"select", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"COLABORADOR" }, "source": "auth.colaborador" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.espaco', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"ARMAZEM" }, "format": "select", "source": "tweeks.espaco" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.artigo', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"ARTIGO" }, "format": "select", "source": "tweeks.artigo" }'); insert into report.template( type, name, configs ) values ('query', 'source|geoinfo.currency', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"MOEDA" }, "format": "select", "source": "geoinfo.currency" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.toperacao', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"OPERAÇÃO" }, "format": "select", "source": "tweeks.toperacao" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.tpaga', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"MODALIDADE DE PAGAMENTO" }, "format": "select", "source": "tweeks.tpaga" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.cliente', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"CLIENTE" }, "format": "select", "source": "tweeks.cliente" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.fornecedor', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"FORNECEDOR" }, "format": "select", "source": "tweeks.fornecedor" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.tipoimposto', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"TIPO IMPOSTO" }, "format": "select", "source": "tweeks.tipoimposto" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.serie', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"SERIE DE FATURA" }, "format": "select", "source": "tweeks.serie" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.tserie', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"TIPO DE SERIE" }, "format": "select", "source": "tweeks.tserie" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.caixa::estado', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"ESTADO DE CAIXA" }, "format": "select", "source": "tweeks.caixa::estado" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.tlancamento', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"TIPO DE LANÇAMENTO" }, "format": "select", "source": "tweeks.tlancamento" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.lancamento::mode', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"MODO LANÇAMENTO" }, "format": "select", "source": "tweeks.lancamento::mode" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.tmovimento', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"TIPO DE MOVIMENTO" }, "format": "select", "source": "tweeks.tmovimento" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.tserie::venda', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"SERIE" }, "format": "select", "source": "tweeks.tserie::venda" }'); insert into report.template( type, name, configs ) values ('query', 'source|tweeks.caixa', '{ "opr": "=", "src": "db", "name": { "$template": true, "$type": "text", "$structure": "${args.name}", "$default":"CAIXA" }, "format": "select", "source": "tweeks.caixa" }');
43c4023e-946d-496e-a0d9-f14b17847231	\ndrop function if exists tweeks.__check_conta_data(\n  _tserie_id int,\n  _conta_data date,\n  _raise boolean\n);\n\ncreate or replace function tweeks.__check_conta_data( \n  _tserie_id int,\n  _conta_data date,\n  _raise boolean\n) returns text\nlanguage plpgsql as $$\ndeclare \n  _data record;\n  _tserie tweeks.tserie;\n  _message text;\nbegin\n    select max( ct.conta_data ) as conta_data\n      from tweeks.conta ct \n      where ct.conta_tserie_id = _tserie_id \n        and ct.conta_data <= current_date\n      into _data\n    ;\n    \n    _data.conta_data := coalesce( _data.conta_data, _conta_data, current_date );\n    \n    select *\n      from tweeks.tserie ts \n      where ts.tserie_id = _tserie_id\n      into _tserie\n    ;\n    \n    if _conta_data > current_date and _message is null then \n      _message :=  format( 'Data de emissão invalida para a operação! A data para a %I não pode ser superior a data atual!', _tserie.tserie_desc );\n    end if;\n    \n    if _conta_data < _data.conta_data and _message is null then\n      _message := format( 'Data de emissão invalida para a operação! A última data de emissão para %I foi de %I!', _tserie.tserie_desc, _data.conta_data );\n    end if;\n    \n    if _raise and _message is not null then\n        raise exception '%', _message;\n    end if;\n    \n    return _message;\nend;\n$$\n	drop function if exists tweeks.__check_conta_data( _tserie_id int, _conta_data date, _raise boolean ); create or replace function tweeks.__check_conta_data( _tserie_id int, _conta_data date, _raise boolean ) returns text language plpgsql as $$ declare _data record; _tserie tweeks.tserie; _message text; begin select max( ct.conta_data ) as conta_data from tweeks.conta ct where ct.conta_tserie_id = _tserie_id and ct.conta_data <= current_date into _data ; _data.conta_data := coalesce( _data.conta_data, _conta_data, current_date ); select * from tweeks.tserie ts where ts.tserie_id = _tserie_id into _tserie ; if _conta_data > current_date and _message is null then _message := format( 'Data de emissão invalida para a operação! A data para a %I não pode ser superior a data atual!', _tserie.tserie_desc ); end if; if _conta_data < _data.conta_data and _message is null then _message := format( 'Data de emissão invalida para a operação! A última data de emissão para %I foi de %I!', _tserie.tserie_desc, _data.conta_data ); end if; if _raise and _message is not null then raise exception '%', _message; end if; return _message; end; $$
77501049-bfdc-46c6-bfc8-5d255658db13	\ncreate or replace function tweeks.funct_pos_change_conta_proforma(args jsonb) returns lib.res\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    args := {\n      arg_colaborador_id: UUID,\n      arg_espaco_auth: UUID,\n\n      conta_id UUID,\n      conta_cliente_id: UID,\n      conta_proformavencimento: DATE\n      conta_proformaextras\n    }\n   */\n  arg_conta_id uuid default args->>'conta_id';\n  arg_espaco_auth uuid default args->>'arg_espaco_auth';\n  arg_colaborador_id uuid default args->>'arg_colaborador_id';\n\n  _conta tweeks.conta;\n  _const map.constant;\n  _invalid_date_message text;\nbegin\n  _const := map.constant();\n  _conta := tweeks._get_conta( arg_conta_id );\n\n  if _conta.conta_estado != _const.maguita_conta_estado_aberto then\n    return lib.res_false( 'Não pode colocar uma conta em modo proforma para as conta já fechada!' );\n  end if;\n\n  _invalid_date_message :=  tweeks.__check_conta_data(\n    _tserie_id := _const.maguita_tserie_fatura,\n    _conta_data := _conta.conta_data,\n    _raise := true\n  );\n  \n  if _invalid_date_message is not null then \n    return lib.res_false( _invalid_date_message );\n  end if;\n  \n  _conta.conta_proforma := true;\n\n  select ( "returning" ).* into _conta\n    from lib.sets( _conta, args  );\n  \n  update tweeks.venda\n    set venda_proforma = true\n    where venda_conta_id = _conta.conta_id\n      and venda_estado not in (\n        _const.maguita_venda_estado_anulado,  \n        _const.maguita_venda_estado_canselado  \n      )\n      and not venda_proforma\n  ;\n\n  return lib.res_true( jsonb_build_object(\n    'conta', _conta\n  ));\nend;\n$$;\n	create or replace function tweeks.funct_pos_change_conta_proforma(args jsonb) returns lib.res language plpgsql as $$ declare /** args := { arg_colaborador_id: UUID, arg_espaco_auth: UUID, conta_id UUID, conta_cliente_id: UID, conta_proformavencimento: DATE conta_proformaextras } */ arg_conta_id uuid default args->>'conta_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; arg_colaborador_id uuid default args->>'arg_colaborador_id'; _conta tweeks.conta; _const map.constant; _invalid_date_message text; begin _const := map.constant(); _conta := tweeks._get_conta( arg_conta_id ); if _conta.conta_estado != _const.maguita_conta_estado_aberto then return lib.res_false( 'Não pode colocar uma conta em modo proforma para as conta já fechada!' ); end if; _invalid_date_message := tweeks.__check_conta_data( _tserie_id := _const.maguita_tserie_fatura, _conta_data := _conta.conta_data, _raise := true ); if _invalid_date_message is not null then return lib.res_false( _invalid_date_message ); end if; _conta.conta_proforma := true; select ( "returning" ).* into _conta from lib.sets( _conta, args ); update tweeks.venda set venda_proforma = true where venda_conta_id = _conta.conta_id and venda_estado not in ( _const.maguita_venda_estado_anulado, _const.maguita_venda_estado_canselado ) and not venda_proforma ; return lib.res_true( jsonb_build_object( 'conta', _conta )); end; $$;
61edc788-f524-4695-89cc-bc6a40524716	\ncreate or replace function tweeks.funct_load_chave(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    arg_chave_temporaria: CHAVE-TEMP\n   */\n    arg_chave_temporaria character varying default args->>'arg_chave_temporaria';\n    _const map.constant;\nbegin\n  _const := map.constant();\n  delete\n    from tweeks.chave s\n    where chave_definitiva is null\n      and chave_date < now() - interval '1' day\n  ;\n  \n  if arg_chave_temporaria is null then\n      return query\n          select to_jsonb( ch )\n            from tweeks.chave ch\n            where (ch.chave_date + interval '24' hour )  > now()\n              and ch.chave_definitiva is null;\n  else\n      return query\n          select to_jsonb( ch ) || coalesce( to_jsonb( p ), jsonb_build_object()) || jsonb_build_object(\n                'posto_disponivel', coalesce( p.posto_estado != _const.maguita_posto_estado_encerado, false )\n            )\n          from tweeks.chave ch\n            left join tweeks.posto p on ch.chave_definitiva = p.posto_chave\n          where ch.chave_temporarai = arg_chave_temporaria\n      ;\n  end if;\nend;\n$$;\n	create or replace function tweeks.funct_load_chave(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** arg_chave_temporaria: CHAVE-TEMP */ arg_chave_temporaria character varying default args->>'arg_chave_temporaria'; _const map.constant; begin _const := map.constant(); delete from tweeks.chave s where chave_definitiva is null and chave_date < now() - interval '1' day ; if arg_chave_temporaria is null then return query select to_jsonb( ch ) from tweeks.chave ch where (ch.chave_date + interval '24' hour ) > now() and ch.chave_definitiva is null; else return query select to_jsonb( ch ) || coalesce( to_jsonb( p ), jsonb_build_object()) || jsonb_build_object( 'posto_disponivel', coalesce( p.posto_estado != _const.maguita_posto_estado_encerado, false ) ) from tweeks.chave ch left join tweeks.posto p on ch.chave_definitiva = p.posto_chave where ch.chave_temporarai = arg_chave_temporaria ; end if; end; $$;
72a37d17-0aad-45ec-8128-8afd9b74bdc5	\nselect map.constant('maguita_parametrizacao_estado_ativo', 'int2', 1);\nselect map.constant('maguita_parametrizacao_estado_fechado', 'int2', 1);\n-- drop table if  exists tweeks.parametrizacao;\ncreate table if not exists tweeks.parametrizacao(\n  parametrizacao_uid uuid not null primary key default gen_random_uuid(),\n  parametrizacao_props jsonb not null default jsonb_build_object(),\n  parametrizacao_tags character varying[] not null default array[]::text[],\n  parametrizacao_estado int2 not null default map.get('maguita_parametrizacao_estado_ativo')::int2,\n  parametrizacao_user_uid uuid not null,\n  parametrizacao_user_update uuid default null,\n  parametrizacao_espaco_auth uuid not null default null,\n  parametrizacao_date timestamptz not null default clock_timestamp(),\n  parametrizacao_dateupdate timestamptz default null,\n  _branch_uid uuid not null\n);\n	select map.constant('maguita_parametrizacao_estado_ativo', 'int2', 1); select map.constant('maguita_parametrizacao_estado_fechado', 'int2', 1); -- drop table if exists tweeks.parametrizacao; create table if not exists tweeks.parametrizacao( parametrizacao_uid uuid not null primary key default gen_random_uuid(), parametrizacao_props jsonb not null default jsonb_build_object(), parametrizacao_tags character varying[] not null default array[]::text[], parametrizacao_estado int2 not null default map.get('maguita_parametrizacao_estado_ativo')::int2, parametrizacao_user_uid uuid not null, parametrizacao_user_update uuid default null, parametrizacao_espaco_auth uuid not null default null, parametrizacao_date timestamptz not null default clock_timestamp(), parametrizacao_dateupdate timestamptz default null, _branch_uid uuid not null );
f44a7706-e499-465b-b7a7-f2f5134125d7	\ndrop view if exists report.vreport_balanco;\n\ncreate or replace view report.vreport_balanco as\nwith\n  _const ( maguita_conta_estado_fechado, maguita_venda_estado_fechado ) as ( \n    select \n      map.get('maguita_conta_estado_fechado')::int2,\n      map.get('maguita_venda_estado_fechado')::int2\n  ),\n  __lancamento as ( select * from tweeks.__lancamento_regularizacao() l ),\n  __receitas as (\n    select\n        art.artigo_id,\n        art.artigo_nome,\n        art.artigo_codigo,\n        cla.classe_id,\n        cla.classe_nome,\n        es.espaco_id,\n        es.espaco_nome,\n        ve.venda_montantecomimposto,\n        ve.venda_quantidade,\n        l.regula_montante as conta_montanteefetivo,\n\n        -- Obter a percentagem da conta que foi paga\n        l.regula_montante/ct.conta_montante as conta_percentageefetiva,\n\n        -- Obter o equivalente percentual pago nos item da fatura\n        ((l.regula_montante/ct.conta_montante ) * ve.venda_montantecomimposto)::double precision as venda_montanteefetivo,\n\n\n        ct.conta_data,\n        ct._branch_uid\n      from _const, tweeks.conta ct\n        inner join tweeks.venda ve on ct.conta_id = ve.venda_conta_id\n          and ve.venda_venda_id is null\n        inner join tweeks.espaco es on ct.conta_espaco_auth = es.espaco_id\n        inner join tweeks.artigo art on ve.venda_artigo_id = art.artigo_id\n        inner join tweeks.classe cla on art.artigo_classe_id = cla.classe_id\n        inner join __lancamento l on ct.conta_id = l.lancamento_refid\n      where ct.conta_estado = _const.maguita_conta_estado_fechado\n        and ve.venda_estado = _const.maguita_venda_estado_fechado\n  ), ___despesas as (\n    select\n        art.artigo_id,\n        art.artigo_nome,\n        art.artigo_codigo,\n        cla.classe_id,\n        cla.classe_nome,\n        es.espaco_id,\n        es.espaco_nome,\n        g.guia_date as entrada_data,\n        g.guia_documentoperacao as entrada_codigofatura,\n        en.entrada_quantidade,\n        en.entrada_custounitario as quantidade_custounidade,\n        en.entrada_custounitario * en.entrada_quantidade as entrada_montanteefetivo,\n        0.0::double precision  as entrada_montanteprevisto,\n        en._branch_uid\n      from tweeks.entrada en\n        inner join tweeks.guia g on en.entrada_guia_id = g.guia_uid\n        inner join tweeks.espaco es on en.entrada_espaco_destino = es.espaco_id\n        inner join tweeks.artigo art on en.entrada_artigo_id = art.artigo_id\n        inner join tweeks.classe cla on art.artigo_classe_id = cla.classe_id\n), __union as (\n  select\n      coalesce( __rec.artigo_id, _desps.artigo_id ) as artigo_id,\n      coalesce( __rec.artigo_nome, _desps.artigo_nome ) as artigo_nome,\n      coalesce( __rec.artigo_codigo, _desps.artigo_codigo ) as artigo_codigo,\n      coalesce( __rec.classe_id, _desps.classe_id ) as classe_id,\n      coalesce( __rec.classe_nome, _desps.classe_nome ) as classe_nome,\n      coalesce( __rec.espaco_id, _desps.espaco_id ) as espaco_id,\n      coalesce( __rec.espaco_nome, _desps.espaco_nome ) as espaco_nome,\n      coalesce( __rec._branch_uid, _desps._branch_uid ) as _branch_uid,\n\n      coalesce( __rec.conta_data, _desps.entrada_data ) as data,\n\n      coalesce( _desps.entrada_quantidade, 0.0 ) as despesa_quantidade,\n      coalesce( _desps.entrada_montanteefetivo, 0.0 ) as despesa_montanteefetivo,\n      coalesce( _desps.entrada_montanteprevisto, 0.0 ) as despesa_montanteprevisto,\n\n      coalesce( __rec.venda_quantidade, 0.0 ) as receita_quantidade,\n      coalesce( __rec.venda_montanteefetivo, 0.0::double precision) as receita_montanteefetivo,\n      coalesce( __rec.venda_montantecomimposto - __rec.venda_montanteefetivo, 0.0::double precision ) as receita_montanteprevisto\n\n    from __receitas __rec\n      full join ___despesas _desps on __rec.conta_data = _desps.entrada_data\n        and __rec.artigo_id = _desps.artigo_id\n        and __rec.classe_id = _desps.classe_id\n        and __rec.espaco_id = _desps.espaco_id\n\n), __resultado as (\n  select\n      _un.artigo_id,\n      _un.artigo_nome as "ARTIGO",\n      _un.artigo_codigo as "CÓDIGO",\n      _un.classe_id,\n      _un.espaco_id,\n      _un.espaco_nome as "ARMAZÉM",\n      _un._branch_uid,\n      _un.classe_nome as "CATEGORIA",\n      _un.data as "DATA",\n      \n      sum( _un.despesa_quantidade ) as "QT. ENTRADA",\n      sum( _un.receita_montanteefetivo ) as "$ RECEITA EFET.",\n      sum( _un.receita_montanteprevisto ) as "$ RECEITA PREV.",\n      sum( _un.receita_montanteefetivo + _un.receita_montanteprevisto ) as "$ RECEITA ESTI.",\n\n      sum( _un.receita_quantidade ) as "QT. SAÍDA",\n      sum( _un.despesa_montanteefetivo ) as "$ DESPESA EFET.",\n      sum( _un.despesa_montanteprevisto ) as "$ DESPESA PREV.",\n      sum( _un.despesa_montanteefetivo + _un.despesa_montanteprevisto ) as "$ DESPESA ESTI.",\n\n      sum( _un.receita_montanteprevisto - _un.despesa_montanteprevisto ) as "$ REST. PREV.",\n\n      sum( _un.receita_montanteefetivo - _un.despesa_montanteefetivo ) as "$ REST. EFET.",\n      sum( ( ( _un.receita_montanteefetivo + _un.receita_montanteprevisto ) ) - ( _un.despesa_montanteefetivo + _un.despesa_montanteprevisto ) ) as "$ REST. ESTI.",\n      sum( _un.despesa_quantidade - _un.receita_quantidade ) as "REST. QT."\n    from __union _un\n    group by\n      _un.artigo_id,\n      _un.espaco_id,\n      _un.espaco_nome,\n      _un.artigo_nome,\n      _un.artigo_codigo,\n      _un.classe_id,\n      _un.classe_nome,\n      _un._branch_uid,\n      _un.data\n\n) select * from __resultado\norder by "CATEGORIA", "ARTIGO", "DATA"\n;\n\n-- select to_char( acesso_dataregisto, 'DD-MM-YYYY HH:MI' ), count(*)\n--   from auth.acesso\n--   group by --to_char( acesso_dataregisto, 'DD-MM-YYYY HH:MI' )\n--           to_char( acesso_dataregisto, 'YYYY-MM-DD HH:MI' )\n--   order by  to_char( acesso_dataregisto, 'YYYY-MM-DD HH:MI' ) desc;\n\n\nselect * from report.sync( 'report.vreport_balanco', 'RELATÓRIO DE BALANÇO', 1 );\n\nUPDATE report.vcolumn SET position = 1996, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_balanco' AND name = 'ARTIGO';\nUPDATE report.vcolumn SET position = 1995, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_balanco' AND name = 'CÓDIGO';\nUPDATE report.vcolumn SET position = 1994, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_balanco' AND name = 'CATEGORIA';\nUPDATE report.vcolumn SET position = 1895, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_balanco' AND name = 'ARMAZÉM';\nUPDATE report.vcolumn SET position = 89, show = true, init = true, format = 'int', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = 'QT. ENTRADA';\nUPDATE report.vcolumn SET position = 88, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ DESPESA PREV.';\nUPDATE report.vcolumn SET position = 87, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ DESPESA EFET.';\nUPDATE report.vcolumn SET position = 86, show = false, init = false, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ DESPESA ESTI.';\nUPDATE report.vcolumn SET position = 79, show = true, init = true, format = 'int', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = 'QT. SAÍDA';\nUPDATE report.vcolumn SET position = 78, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ RECEITA PREV.';\nUPDATE report.vcolumn SET position = 77, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ RECEITA EFET.';\nUPDATE report.vcolumn SET position = 76, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ RECEITA ESTI.';\nUPDATE report.vcolumn SET position = 50, show = true, init = true, format = 'int', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = 'REST. QT.';\nUPDATE report.vcolumn SET position = 49, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ REST. PREV.';\nUPDATE report.vcolumn SET position = 48, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ REST. EFET.';\nUPDATE report.vcolumn SET position = 47, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ REST. ESTI.';\nUPDATE report.vcolumn SET position = 0, show = true, init = true, format = 'date', filter = '["query.date|start", "query.date|end"]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_balanco' AND name = 'DATA';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|tweeks.artigo"]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ARTIGO", "rename": "??COUNT::DISTINCT TOTAL ARTIGO"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_balanco' AND name = 'artigo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|tweeks.classe"]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_balanco' AND name = 'classe_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|tweeks.espaco"]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_balanco' AND name = 'espaco_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_balanco' AND name = '_branch_uid';\n\n\nselect * from report.vcolumn\nwhere source = 'report.vreport_balanco'\norder by position desc nulls last,\n         show desc nulls last,\n         init desc nulls last,\n         jsonb_array_length( agg ) desc,\n         jsonb_array_length( filter ) desc,\n         source, name;\n	drop view if exists report.vreport_balanco; create or replace view report.vreport_balanco as with _const ( maguita_conta_estado_fechado, maguita_venda_estado_fechado ) as ( select map.get('maguita_conta_estado_fechado')::int2, map.get('maguita_venda_estado_fechado')::int2 ), __lancamento as ( select * from tweeks.__lancamento_regularizacao() l ), __receitas as ( select art.artigo_id, art.artigo_nome, art.artigo_codigo, cla.classe_id, cla.classe_nome, es.espaco_id, es.espaco_nome, ve.venda_montantecomimposto, ve.venda_quantidade, l.regula_montante as conta_montanteefetivo, -- Obter a percentagem da conta que foi paga l.regula_montante/ct.conta_montante as conta_percentageefetiva, -- Obter o equivalente percentual pago nos item da fatura ((l.regula_montante/ct.conta_montante ) * ve.venda_montantecomimposto)::double precision as venda_montanteefetivo, ct.conta_data, ct._branch_uid from _const, tweeks.conta ct inner join tweeks.venda ve on ct.conta_id = ve.venda_conta_id and ve.venda_venda_id is null inner join tweeks.espaco es on ct.conta_espaco_auth = es.espaco_id inner join tweeks.artigo art on ve.venda_artigo_id = art.artigo_id inner join tweeks.classe cla on art.artigo_classe_id = cla.classe_id inner join __lancamento l on ct.conta_id = l.lancamento_refid where ct.conta_estado = _const.maguita_conta_estado_fechado and ve.venda_estado = _const.maguita_venda_estado_fechado ), ___despesas as ( select art.artigo_id, art.artigo_nome, art.artigo_codigo, cla.classe_id, cla.classe_nome, es.espaco_id, es.espaco_nome, g.guia_date as entrada_data, g.guia_documentoperacao as entrada_codigofatura, en.entrada_quantidade, en.entrada_custounitario as quantidade_custounidade, en.entrada_custounitario * en.entrada_quantidade as entrada_montanteefetivo, 0.0::double precision as entrada_montanteprevisto, en._branch_uid from tweeks.entrada en inner join tweeks.guia g on en.entrada_guia_id = g.guia_uid inner join tweeks.espaco es on en.entrada_espaco_destino = es.espaco_id inner join tweeks.artigo art on en.entrada_artigo_id = art.artigo_id inner join tweeks.classe cla on art.artigo_classe_id = cla.classe_id ), __union as ( select coalesce( __rec.artigo_id, _desps.artigo_id ) as artigo_id, coalesce( __rec.artigo_nome, _desps.artigo_nome ) as artigo_nome, coalesce( __rec.artigo_codigo, _desps.artigo_codigo ) as artigo_codigo, coalesce( __rec.classe_id, _desps.classe_id ) as classe_id, coalesce( __rec.classe_nome, _desps.classe_nome ) as classe_nome, coalesce( __rec.espaco_id, _desps.espaco_id ) as espaco_id, coalesce( __rec.espaco_nome, _desps.espaco_nome ) as espaco_nome, coalesce( __rec._branch_uid, _desps._branch_uid ) as _branch_uid, coalesce( __rec.conta_data, _desps.entrada_data ) as data, coalesce( _desps.entrada_quantidade, 0.0 ) as despesa_quantidade, coalesce( _desps.entrada_montanteefetivo, 0.0 ) as despesa_montanteefetivo, coalesce( _desps.entrada_montanteprevisto, 0.0 ) as despesa_montanteprevisto, coalesce( __rec.venda_quantidade, 0.0 ) as receita_quantidade, coalesce( __rec.venda_montanteefetivo, 0.0::double precision) as receita_montanteefetivo, coalesce( __rec.venda_montantecomimposto - __rec.venda_montanteefetivo, 0.0::double precision ) as receita_montanteprevisto from __receitas __rec full join ___despesas _desps on __rec.conta_data = _desps.entrada_data and __rec.artigo_id = _desps.artigo_id and __rec.classe_id = _desps.classe_id and __rec.espaco_id = _desps.espaco_id ), __resultado as ( select _un.artigo_id, _un.artigo_nome as "ARTIGO", _un.artigo_codigo as "CÓDIGO", _un.classe_id, _un.espaco_id, _un.espaco_nome as "ARMAZÉM", _un._branch_uid, _un.classe_nome as "CATEGORIA", _un.data as "DATA", sum( _un.despesa_quantidade ) as "QT. ENTRADA", sum( _un.receita_montanteefetivo ) as "$ RECEITA EFET.", sum( _un.receita_montanteprevisto ) as "$ RECEITA PREV.", sum( _un.receita_montanteefetivo + _un.receita_montanteprevisto ) as "$ RECEITA ESTI.", sum( _un.receita_quantidade ) as "QT. SAÍDA", sum( _un.despesa_montanteefetivo ) as "$ DESPESA EFET.", sum( _un.despesa_montanteprevisto ) as "$ DESPESA PREV.", sum( _un.despesa_montanteefetivo + _un.despesa_montanteprevisto ) as "$ DESPESA ESTI.", sum( _un.receita_montanteprevisto - _un.despesa_montanteprevisto ) as "$ REST. PREV.", sum( _un.receita_montanteefetivo - _un.despesa_montanteefetivo ) as "$ REST. EFET.", sum( ( ( _un.receita_montanteefetivo + _un.receita_montanteprevisto ) ) - ( _un.despesa_montanteefetivo + _un.despesa_montanteprevisto ) ) as "$ REST. ESTI.", sum( _un.despesa_quantidade - _un.receita_quantidade ) as "REST. QT." from __union _un group by _un.artigo_id, _un.espaco_id, _un.espaco_nome, _un.artigo_nome, _un.artigo_codigo, _un.classe_id, _un.classe_nome, _un._branch_uid, _un.data ) select * from __resultado order by "CATEGORIA", "ARTIGO", "DATA" ; -- select to_char( acesso_dataregisto, 'DD-MM-YYYY HH:MI' ), count(*) -- from auth.acesso -- group by --to_char( acesso_dataregisto, 'DD-MM-YYYY HH:MI' ) -- to_char( acesso_dataregisto, 'YYYY-MM-DD HH:MI' ) -- order by to_char( acesso_dataregisto, 'YYYY-MM-DD HH:MI' ) desc; select * from report.sync( 'report.vreport_balanco', 'RELATÓRIO DE BALANÇO', 1 ); UPDATE report.vcolumn SET position = 1996, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_balanco' AND name = 'ARTIGO'; UPDATE report.vcolumn SET position = 1995, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_balanco' AND name = 'CÓDIGO'; UPDATE report.vcolumn SET position = 1994, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_balanco' AND name = 'CATEGORIA'; UPDATE report.vcolumn SET position = 1895, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_balanco' AND name = 'ARMAZÉM'; UPDATE report.vcolumn SET position = 89, show = true, init = true, format = 'int', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = 'QT. ENTRADA'; UPDATE report.vcolumn SET position = 88, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ DESPESA PREV.'; UPDATE report.vcolumn SET position = 87, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ DESPESA EFET.'; UPDATE report.vcolumn SET position = 86, show = false, init = false, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ DESPESA ESTI.'; UPDATE report.vcolumn SET position = 79, show = true, init = true, format = 'int', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = 'QT. SAÍDA'; UPDATE report.vcolumn SET position = 78, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ RECEITA PREV.'; UPDATE report.vcolumn SET position = 77, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ RECEITA EFET.'; UPDATE report.vcolumn SET position = 76, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ RECEITA ESTI.'; UPDATE report.vcolumn SET position = 50, show = true, init = true, format = 'int', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = 'REST. QT.'; UPDATE report.vcolumn SET position = 49, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ REST. PREV.'; UPDATE report.vcolumn SET position = 48, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ REST. EFET.'; UPDATE report.vcolumn SET position = 47, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_balanco' AND name = '$ REST. ESTI.'; UPDATE report.vcolumn SET position = 0, show = true, init = true, format = 'date', filter = '["query.date|start", "query.date|end"]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_balanco' AND name = 'DATA'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|tweeks.artigo"]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ARTIGO", "rename": "??COUNT::DISTINCT TOTAL ARTIGO"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_balanco' AND name = 'artigo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|tweeks.classe"]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_balanco' AND name = 'classe_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|tweeks.espaco"]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_balanco' AND name = 'espaco_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_balanco' AND name = '_branch_uid'; select * from report.vcolumn where source = 'report.vreport_balanco' order by position desc nulls last, show desc nulls last, init desc nulls last, jsonb_array_length( agg ) desc, jsonb_array_length( filter ) desc, source, name;
bcd0a7cb-7938-42ed-b63d-93aec2f816ab	\ncreate or replace function tweeks.sets_parametrizacao( args jsonb )\n  returns lib.res\nlanguage plpgsql as $$\ndeclare\n  /**doc\n    args := {\n      arg_colaborador_id:UID\n      arg_espaco_auth: UID,\n      parametrizacao_uid?\n      parametrizacao_props\n      parametrizacao_tags* varchar[],\n      parametrizacao_estado?\n    }\n   doc*/\n  _user_id uuid not null default args->>'arg_colaborador_id';\n  _espaco_auth uuid not null default args->>'arg_espaco_auth';\n  ___branch uuid default tweeks.__branch_uid( _user_id, _espaco_auth );\n  _const map.constant;\n  _parametrizacao tweeks.parametrizacao;\nbegin\n  _const := map.constant();\n  _parametrizacao := jsonb_populate_record( _parametrizacao, args );\n  \n  if _parametrizacao.parametrizacao_uid is null then\n    _parametrizacao.parametrizacao_user_uid := _user_id;\n    _parametrizacao.parametrizacao_espaco_auth := _espaco_auth;\n    _parametrizacao._branch_uid := ___branch;\n  else \n    _parametrizacao.parametrizacao_user_update := _user_id;\n    _parametrizacao.parametrizacao_dateupdate := clock_timestamp();\n  end if;\n  \n  select ( "returning" ).* \n    from lib.sets( _parametrizacao )\n    into _parametrizacao\n  ;\n  \n  return lib.res_true( jsonb_build_object(\n    'parametrizacao', _parametrizacao\n  ));\nend;\n$$;\n\n\ncreate or replace function tweeks.funct_load_parametrizacao( args jsonb )\nreturns setof jsonb\nlanguage plpgsql as $$\ndeclare\n  /**doc\n    args := {\n      arg_colaborador_id:UID\n      arg_espaco_auth: UID,\n      parametrizacao_tags: []\n    \n    }\n  doc*/\n  \n  _user_id uuid not null default args->>'arg_colaborador_id';\n  _espaco_auth uuid not null default args->>'arg_espaco_auth';\n  ___branch uuid default tweeks.__branch_uid( _user_id, _espaco_auth );\n  _const map.constant;\n  _parametrizacao tweeks.parametrizacao;\nbegin\n  _const := map.constant();\n  _parametrizacao := jsonb_populate_record( _parametrizacao, args );\n  if coalesce( array_length( _parametrizacao.parametrizacao_tags, 1 ),  0 ) = 0 then \n      _parametrizacao.parametrizacao_tags := null;\n  end if;\n  return query \n    with __parametrizacao as (\n      select *\n        from tweeks.parametrizacao p \n        where p.parametrizacao_estado = _const.maguita_parametrizacao_estado_ativo\n          and p.parametrizacao_tags @> coalesce( _parametrizacao.parametrizacao_tags, p.parametrizacao_tags )\n          and p._branch_uid = ___branch\n    ) select to_jsonb( _p )\n       from __parametrizacao _p\n  ;\nend;\n$$\n	create or replace function tweeks.sets_parametrizacao( args jsonb ) returns lib.res language plpgsql as $$ declare /**doc args := { arg_colaborador_id:UID arg_espaco_auth: UID, parametrizacao_uid? parametrizacao_props parametrizacao_tags* varchar[], parametrizacao_estado? } doc*/ _user_id uuid not null default args->>'arg_colaborador_id'; _espaco_auth uuid not null default args->>'arg_espaco_auth'; ___branch uuid default tweeks.__branch_uid( _user_id, _espaco_auth ); _const map.constant; _parametrizacao tweeks.parametrizacao; begin _const := map.constant(); _parametrizacao := jsonb_populate_record( _parametrizacao, args ); if _parametrizacao.parametrizacao_uid is null then _parametrizacao.parametrizacao_user_uid := _user_id; _parametrizacao.parametrizacao_espaco_auth := _espaco_auth; _parametrizacao._branch_uid := ___branch; else _parametrizacao.parametrizacao_user_update := _user_id; _parametrizacao.parametrizacao_dateupdate := clock_timestamp(); end if; select ( "returning" ).* from lib.sets( _parametrizacao ) into _parametrizacao ; return lib.res_true( jsonb_build_object( 'parametrizacao', _parametrizacao )); end; $$; create or replace function tweeks.funct_load_parametrizacao( args jsonb ) returns setof jsonb language plpgsql as $$ declare /**doc args := { arg_colaborador_id:UID arg_espaco_auth: UID, parametrizacao_tags: [] } doc*/ _user_id uuid not null default args->>'arg_colaborador_id'; _espaco_auth uuid not null default args->>'arg_espaco_auth'; ___branch uuid default tweeks.__branch_uid( _user_id, _espaco_auth ); _const map.constant; _parametrizacao tweeks.parametrizacao; begin _const := map.constant(); _parametrizacao := jsonb_populate_record( _parametrizacao, args ); if coalesce( array_length( _parametrizacao.parametrizacao_tags, 1 ), 0 ) = 0 then _parametrizacao.parametrizacao_tags := null; end if; return query with __parametrizacao as ( select * from tweeks.parametrizacao p where p.parametrizacao_estado = _const.maguita_parametrizacao_estado_ativo and p.parametrizacao_tags @> coalesce( _parametrizacao.parametrizacao_tags, p.parametrizacao_tags ) and p._branch_uid = ___branch ) select to_jsonb( _p ) from __parametrizacao _p ; end; $$
baf1c8ed-1e05-4f00-869f-d34f6e75b255	\n\ndo $block$\n  declare\n    _data record;\n    _menu auth.menu;\n  begin\n    for _data in\n      select *\n        from jsonb_array_elements($jsonb$[\n   \n        \n  {\n    "menu_id": 89,\n    "menu_menu_id": 71,\n    "menu_codigo": "maguita.pos.remover",\n    "menu_raiz": "71",\n    "menu_nivel": 1,\n    "menu_icon": null,\n    "menu_nome": "Remover artigos depois de confirmar conta",\n    "menu_link": null,\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 0\n  },\n  {\n    "menu_id": 104,\n    "menu_menu_id": 71,\n    "menu_codigo": "maguita.pos.alterar_preco",\n    "menu_raiz": "71",\n    "menu_nivel": 1,\n    "menu_icon": null,\n    "menu_nome": "Alterar preço de artigo no carrinho",\n    "menu_link": null,\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 0\n  },\n  {\n    "menu_id": 107,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.entrada.artigos",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "<svg x=\\"0px\\" y=\\"0px\\" viewBox=\\"0 0 512 512\\" style=\\"enable-background:new 0 0 512 512;\\"\\n\\t\\t\\t\\t\\t\\t\\txml:space=\\"preserve\\">\\n\\t\\t\\t\\t\\t\\t\\t<g>\\n\\t\\t\\t\\t\\t\\t\\t\\t<g>\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<path\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\td=\\"M472,313v139c0,11.028-8.972,20-20,20H60c-11.028,0-20-8.972-20-20V313H0v139c0,33.084,26.916,60,60,60h392 c33.084,0,60-26.916,60-60V313H472z\\" />\\n\\t\\t\\t\\t\\t\\t\\t\\t</g>\\n\\t\\t\\t\\t\\t\\t\\t</g>\\n\\t\\t\\t\\t\\t\\t\\t<g>\\n\\t\\t\\t\\t\\t\\t\\t\\t<g>\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<polygon\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tpoints=\\"352,235.716 276,311.716 276,0 236,0 236,311.716 160,235.716 131.716,264 256,388.284 380.284,264\\" />\\n\\t\\t\\t\\t\\t\\t\\t\\t</g>\\n\\t\\t\\t\\t\\t\\t\\t</g>\\n\\t\\t\\t\\t\\t\\t</svg>",\n    "menu_nome": "Guia de Entrada",\n    "menu_link": "../includes/guiaEntrada.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 3\n  },\n  {\n    "menu_id": 87,\n    "menu_menu_id": 71,\n    "menu_codigo": "maguita.pos.adicionar",\n    "menu_raiz": "71",\n    "menu_nivel": 1,\n    "menu_icon": null,\n    "menu_nome": "Adicionar artigos depois de confirmar conta",\n    "menu_link": null,\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 0\n  },\n  {\n    "menu_id": 90,\n    "menu_menu_id": 71,\n    "menu_codigo": "maguita.pos.vendas",\n    "menu_raiz": "71",\n    "menu_nivel": 1,\n    "menu_icon": null,\n    "menu_nome": "Vendas",\n    "menu_link": null,\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 0\n  },\n  {\n    "menu_id": 98,\n    "menu_menu_id": 71,\n    "menu_codigo": "maquita.pos.anularconta",\n    "menu_raiz": "71",\n    "menu_nivel": 1,\n    "menu_icon": null,\n    "menu_nome": "Anular conta",\n    "menu_link": null,\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 0\n  },\n  {\n    "menu_id": 93,\n    "menu_menu_id": 71,\n    "menu_codigo": "maguita.pos.imprimir.conta",\n    "menu_raiz": "71",\n    "menu_nivel": 1,\n    "menu_icon": null,\n    "menu_nome": "Impressão de conta",\n    "menu_link": null,\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 0\n  },\n  {\n    "menu_id": 94,\n    "menu_menu_id": 71,\n    "menu_codigo": "maguita.pos.pagamentoDireto",\n    "menu_raiz": "71",\n    "menu_nivel": 1,\n    "menu_icon": null,\n    "menu_nome": "Pagamento direto",\n    "menu_link": null,\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 0\n  },\n  {\n    "menu_id": 88,\n    "menu_menu_id": 71,\n    "menu_codigo": "maguita.pos.diminuirQuantidade",\n    "menu_raiz": "71",\n    "menu_nivel": 1,\n    "menu_icon": null,\n    "menu_nome": "Diminuir quantidade de artigos depois de confirmado",\n    "menu_link": null,\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 0\n  },\n  {\n    "menu_id": 69,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.definicao",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "\\t\\t<svg enable-background=\\"new 0 0 512 512\\" viewBox=\\"0 0 512 512\\">\\n                  <path\\n                    d=\\"m272.066 512h-32.133c-25.989 0-47.134-21.144-47.134-47.133v-10.871c-11.049-3.53-21.784-7.986-32.097-13.323l-7.704 7.704c-18.659 18.682-48.548 18.134-66.665-.007l-22.711-22.71c-18.149-18.129-18.671-48.008.006-66.665l7.698-7.698c-5.337-10.313-9.792-21.046-13.323-32.097h-10.87c-25.988 0-47.133-21.144-47.133-47.133v-32.134c0-25.989 21.145-47.133 47.134-47.133h10.87c3.531-11.05 7.986-21.784 13.323-32.097l-7.704-7.703c-18.666-18.646-18.151-48.528.006-66.665l22.713-22.712c18.159-18.184 48.041-18.638 66.664.006l7.697 7.697c10.313-5.336 21.048-9.792 32.097-13.323v-10.87c0-25.989 21.144-47.133 47.134-47.133h32.133c25.989 0 47.133 21.144 47.133 47.133v10.871c11.049 3.53 21.784 7.986 32.097 13.323l7.704-7.704c18.659-18.682 48.548-18.134 66.665.007l22.711 22.71c18.149 18.129 18.671 48.008-.006 66.665l-7.698 7.698c5.337 10.313 9.792 21.046 13.323 32.097h10.87c25.989 0 47.134 21.144 47.134 47.133v32.134c0 25.989-21.145 47.133-47.134 47.133h-10.87c-3.531 11.05-7.986 21.784-13.323 32.097l7.704 7.704c18.666 18.646 18.151 48.528-.006 66.665l-22.713 22.712c-18.159 18.184-48.041 18.638-66.664-.006l-7.697-7.697c-10.313 5.336-21.048 9.792-32.097 13.323v10.871c0 25.987-21.144 47.131-47.134 47.131zm-106.349-102.83c14.327 8.473 29.747 14.874 45.831 19.025 6.624 1.709 11.252 7.683 11.252 14.524v22.148c0 9.447 7.687 17.133 17.134 17.133h32.133c9.447 0 17.134-7.686 17.134-17.133v-22.148c0-6.841 4.628-12.815 11.252-14.524 16.084-4.151 31.504-10.552 45.831-19.025 5.895-3.486 13.4-2.538 18.243 2.305l15.688 15.689c6.764 6.772 17.626 6.615 24.224.007l22.727-22.726c6.582-6.574 6.802-17.438.006-24.225l-15.695-15.695c-4.842-4.842-5.79-12.348-2.305-18.242 8.473-14.326 14.873-29.746 19.024-45.831 1.71-6.624 7.684-11.251 14.524-11.251h22.147c9.447 0 17.134-7.686 17.134-17.133v-32.134c0-9.447-7.687-17.133-17.134-17.133h-22.147c-6.841 0-12.814-4.628-14.524-11.251-4.151-16.085-10.552-31.505-19.024-45.831-3.485-5.894-2.537-13.4 2.305-18.242l15.689-15.689c6.782-6.774 6.605-17.634.006-24.225l-22.725-22.725c-6.587-6.596-17.451-6.789-24.225-.006l-15.694 15.695c-4.842 4.843-12.35 5.791-18.243 2.305-14.327-8.473-29.747-14.874-45.831-19.025-6.624-1.709-11.252-7.683-11.252-14.524v-22.15c0-9.447-7.687-17.133-17.134-17.133h-32.133c-9.447 0-17.134 7.686-17.134 17.133v22.148c0 6.841-4.628 12.815-11.252 14.524-16.084 4.151-31.504 10.552-45.831 19.025-5.896 3.485-13.401 2.537-18.243-2.305l-15.688-15.689c-6.764-6.772-17.627-6.615-24.224-.007l-22.727 22.726c-6.582 6.574-6.802 17.437-.006 24.225l15.695 15.695c4.842 4.842 5.79 12.348 2.305 18.242-8.473 14.326-14.873 29.746-19.024 45.831-1.71 6.624-7.684 11.251-14.524 11.251h-22.148c-9.447.001-17.134 7.687-17.134 17.134v32.134c0 9.447 7.687 17.133 17.134 17.133h22.147c6.841 0 12.814 4.628 14.524 11.251 4.151 16.085 10.552 31.505 19.024 45.831 3.485 5.894 2.537 13.4-2.305 18.242l-15.689 15.689c-6.782 6.774-6.605 17.634-.006 24.225l22.725 22.725c6.587 6.596 17.451 6.789 24.225.006l15.694-15.695c3.568-3.567 10.991-6.594 18.244-2.304z\\" />\\n                  <path\\n                    d=\\"m256 367.4c-61.427 0-111.4-49.974-111.4-111.4s49.973-111.4 111.4-111.4 111.4 49.974 111.4 111.4-49.973 111.4-111.4 111.4zm0-192.8c-44.885 0-81.4 36.516-81.4 81.4s36.516 81.4 81.4 81.4 81.4-36.516 81.4-81.4-36.515-81.4-81.4-81.4z\\" />\\n                </svg>",\n    "menu_nome": "Definições",\n    "menu_link": "../includes/settings.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 4\n  },\n  {\n    "menu_id": 106,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.transferencia.artigos",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "<svg x=\\"0px\\" y=\\"0px\\" viewBox=\\"0 0 477.859 477.859\\"\\n\\t\\t\\t\\t\\t\\t\\tstyle=\\"enable-background:new 0 0 477.859 477.859;\\" xml:space=\\"preserve\\">\\n\\t\\t\\t\\t\\t\\t\\t<g>\\n\\t\\t\\t\\t\\t\\t\\t\\t<g>\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<path d=\\"M472.863,175.662L353.396,56.195c-6.666-6.664-17.472-6.662-24.136,0.004c-3.199,3.2-4.996,7.538-4.997,12.063v51.2\\n\\t\\t\\t\\t\\t\\tH204.796c-9.426,0-17.067,7.641-17.067,17.067c0,9.426,7.641,17.067,17.067,17.067H341.33c9.426,0,17.067-7.641,17.067-17.067\\n\\t\\t\\t\\t\\t\\tV109.46l78.268,78.268l-78.268,78.268v-27.068c0-9.426-7.641-17.067-17.067-17.067H153.596v-51.2\\n\\t\\t\\t\\t\\t\\tc-0.002-9.426-7.645-17.065-17.07-17.063c-4.524,0.001-8.863,1.798-12.063,4.997L4.997,278.062\\n\\t\\t\\t\\t\\t\\tc-6.663,6.665-6.663,17.468,0,24.132l119.467,119.467c3.2,3.201,7.54,5,12.066,5.001c2.243,0.007,4.466-0.434,6.536-1.297\\n\\t\\t\\t\\t\\t\\tc6.376-2.644,10.532-8.867,10.53-15.77v-51.2h119.467c9.426,0,17.067-7.641,17.067-17.067s-7.641-17.067-17.067-17.067H136.53\\n\\t\\t\\t\\t\\t\\tc-9.426,0-17.067,7.641-17.067,17.067v27.068l-78.268-78.268l78.268-78.268v27.068c0,9.426,7.641,17.067,17.067,17.067h187.733\\n\\t\\t\\t\\t\\t\\tv51.2c0.002,9.426,7.645,17.065,17.07,17.063c4.524-0.001,8.863-1.798,12.063-4.997l119.467-119.467\\n\\t\\t\\t\\t\\t\\tC479.525,193.129,479.525,182.326,472.863,175.662z\\" />\\n\\t\\t\\t\\t\\t\\t\\t\\t</g>\\n\\t\\t\\t\\t\\t\\t\\t</g>\\n\\t\\t\\t\\t\\t\\t</svg>",\n    "menu_nome": "Transferência de Artigos",\n    "menu_link": "../includes/transferArticles.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 3\n  },\n  {\n    "menu_id": 108,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.saida.artigos",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "<?xml version=\\"1.0\\" ?><!DOCTYPE svg  PUBLIC '-//W3C//DTD SVG 1.1//EN'  'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'><svg enable-background=\\"new 0 0 32 32\\"  id=\\"Слой_1\\" version=\\"1.1\\" viewBox=\\"0 0 32 32\\"  xml:space=\\"preserve\\" xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\"><g id=\\"Share\\"><path clip-rule=\\"evenodd\\" d=\\"M8.624,21.336h2.015c1.402-7.953,8.329-14,16.684-14   c0.35,0,0.683,0.003,1.019,0.006l-3.664,3.663c-0.391,0.391-0.391,1.023,0,1.414c0.195,0.195,0.451,0.293,0.707,0.293   c0.256,0,0.512-0.098,0.707-0.293L32,6.356l-5.907-6.063c-0.391-0.391-1.023-0.391-1.414,0c-0.391,0.391-0.391,1.023,0,1.414   l3.631,3.631c-0.318-0.001-0.62-0.003-0.945-0.003C17.895,5.336,10.066,12.271,8.624,21.336z\\" fill=\\"#121313\\" fill-rule=\\"evenodd\\"/><path clip-rule=\\"evenodd\\" d=\\"M29,15c-0.552,0-1,0.448-1,1v14H2V10h9c0.552,0,1-0.448,1-1   c0-0.552-0.448-1-1-1h-0.03H2c-1.104,0-2,0.896-2,2v20c0,1.104,0.896,2,2,2h26c1.104,0,2-0.896,2-2V16C30,15.448,29.552,15,29,15z\\" fill=\\"#121313\\" fill-rule=\\"evenodd\\"/></g><g/><g/><g/><g/><g/><g/></svg>",\n    "menu_nome": "Guia de Saída",\n    "menu_link": "../includes/guiaSaida.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 3\n  },\n  {\n    "menu_id": 109,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.clientes",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "<?xml version=\\"1.0\\" encoding=\\"iso-8859-1\\"?>\\n<!-- Generator: Adobe Illustrator 22.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\\n<svg version=\\"1.1\\" xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\" x=\\"0px\\" y=\\"0px\\"\\n\\t viewBox=\\"0 0 50 50\\" style=\\"enable-background:new 0 0 50 50;\\" xml:space=\\"preserve\\">\\n<g id=\\"Layer_1\\">\\n\\t<path d=\\"M19.38,19.265C13.464,20.481,9,25.729,9,32v17h32V32c0-6.271-4.464-11.519-10.38-12.735C33.261,17.464,35,14.431,35,11\\n\\t\\tc0-5.514-4.486-10-10-10S15,5.486,15,11C15,14.431,16.739,17.464,19.38,19.265z M28,21c6.065,0,11,4.935,11,11v15H11V32\\n\\t\\tc0-6.065,4.935-11,11-11H28z M25,3c4.411,0,8,3.589,8,8s-3.589,8-8,8s-8-3.589-8-8S20.589,3,25,3z\\"/>\\n</g>\\n<g>\\n</g>\\n</svg>",\n    "menu_nome": "Clientes",\n    "menu_link": "../includes/customers.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 3\n  },\n  {\n    "menu_id": 116,\n    "menu_menu_id": 71,\n    "menu_codigo": "maguita.pos.report",\n    "menu_raiz": "71",\n    "menu_nivel": 1,\n    "menu_icon": null,\n    "menu_nome": "Relatório",\n    "menu_link": null,\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 0\n  },\n  {\n    "menu_id": 117,\n    "menu_menu_id": 71,\n    "menu_codigo": "maguita.pos.conta",\n    "menu_raiz": "71",\n    "menu_nivel": 1,\n    "menu_icon": null,\n    "menu_nome": "..........",\n    "menu_link": null,\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 0\n  },\n  {\n    "menu_id": 70,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.relatorio",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "\\t<svg x=\\"0px\\" y=\\"0px\\" viewBox=\\"0 0 512.001 512.001\\" style=\\"enable-background:new 0 0 512.001 512.001;\\" xml:space=\\"preserve\\">\\n                  <g>\\n                    <g>\\n                      <path d=\\"M506.35,80.699c-7.57-7.589-19.834-7.609-27.43-0.052L331.662,227.31l-42.557-42.557c-7.577-7.57-19.846-7.577-27.423,0\\n                      L89.076,357.36c-7.577,7.57-7.577,19.853,0,27.423c3.782,3.788,8.747,5.682,13.712,5.682c4.958,0,9.93-1.894,13.711-5.682\\n                      l158.895-158.888l42.531,42.524c7.57,7.57,19.808,7.577,27.397,0.032l160.97-160.323\\n                      C513.881,100.571,513.907,88.288,506.35,80.699z\\" />\\n                    </g>\\n                  </g>\\n                  <g>\\n                    <g>\\n                      <path d=\\"M491.96,449.94H38.788V42.667c0-10.712-8.682-19.394-19.394-19.394S0,31.955,0,42.667v426.667\\n                      c0,10.712,8.682,19.394,19.394,19.394H491.96c10.712,0,19.394-8.682,19.394-19.394C511.354,458.622,502.672,449.94,491.96,449.94z\\n                      \\" />\\n                    </g>\\n                  </g>\\n                  <g>\\n                    <g>\\n                      <path d=\\"M492.606,74.344H347.152c-10.712,0-19.394,8.682-19.394,19.394s8.682,19.394,19.394,19.394h126.061v126.067\\n                      c0,10.705,8.682,19.394,19.394,19.394S512,249.904,512,239.192V93.738C512,83.026,503.318,74.344,492.606,74.344z\\" />\\n                    </g>\\n                  </g>\\n                </svg>",\n    "menu_nome": "Relatórios",\n    "menu_link": "../includes/report.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 3\n  },\n  {\n    "menu_id": 74,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.artigo",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "<svg enable-background=\\"new 0 0 511.414 511.414\\" viewBox=\\"0 0 511.414 511.414\\"><path d=\\"m497.695 108.838c0-6.488-3.919-12.334-9.92-14.8l-225.988-92.838c-3.896-1.6-8.264-1.6-12.16 0l-225.988 92.838c-6.001 2.465-9.92 8.312-9.92 14.8v293.738c0 6.488 3.918 12.334 9.92 14.8l225.988 92.838c3.854 1.583 8.186 1.617 12.14-.001.193-.064-8.363 3.445 226.008-92.837 6.002-2.465 9.92-8.312 9.92-14.8zm-241.988 76.886-83.268-34.207 179.951-78.501 88.837 36.495zm-209.988-51.67 71.841 29.513v83.264c0 8.836 7.164 16 16 16s16-7.164 16-16v-70.118l90.147 37.033v257.797l-193.988-79.692zm209.988-100.757 55.466 22.786-179.951 78.501-61.035-25.074zm16 180.449 193.988-79.692v257.797l-193.988 79.692z\\"/></svg>",\n    "menu_nome": "Artigos",\n    "menu_link": "../includes/artigos.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 2\n  },\n  {\n    "menu_id": 71,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.pos",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "",\n    "menu_nome": "Pos",\n    "menu_link": null,\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 1\n  },\n  {\n    "menu_id": 75,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.colaboradores",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "<svg viewBox=\\"0 0 512 512\\"><path d=\\"m471.386719 325.011719c-16.96875-14.910157-37.546875-27.792969-61.167969-38.289063-10.097656-4.484375-21.914062.0625-26.398438 10.15625-4.484374 10.09375.0625 21.910156 10.15625 26.398438 19.917969 8.851562 37.082032 19.542968 51.007813 31.78125 17.167969 15.085937 27.015625 36.929687 27.015625 59.941406v37c0 11.027344-8.972656 20-20 20h-392c-11.027344 0-20-8.972656-20-20v-37c0-23.011719 9.847656-44.855469 27.015625-59.941406 20.207031-17.757813 79.082031-59.058594 188.984375-59.058594 81.605469 0 148-66.394531 148-148s-66.394531-148-148-148-148 66.394531-148 148c0 47.707031 22.695312 90.207031 57.851562 117.289062-64.328124 14.140626-104.34375 41.359376-125.238281 59.722657-25.808593 22.675781-40.613281 55.472656-40.613281 89.988281v37c0 33.085938 26.914062 60 60 60h392c33.085938 0 60-26.914062 60-60v-37c0-34.515625-14.804688-67.3125-40.613281-89.988281zm-323.386719-177.011719c0-59.550781 48.449219-108 108-108s108 48.449219 108 108-48.449219 108-108 108-108-48.449219-108-108zm0 0\\"/></svg>",\n    "menu_nome": "Colaboradores",\n    "menu_link": "../includes/colabs.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 5\n  },\n  {\n    "menu_id": 77,\n    "menu_menu_id": 71,\n    "menu_codigo": "maguita.pos.contacorrente",\n    "menu_raiz": "71",\n    "menu_nivel": 1,\n    "menu_icon": null,\n    "menu_nome": "Conta corrente",\n    "menu_link": null,\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 0\n  },\n  {\n    "menu_id": 95,\n    "menu_menu_id": 71,\n    "menu_codigo": "maguita.pos.criar.proforma",\n    "menu_raiz": "71",\n    "menu_nivel": 1,\n    "menu_icon": null,\n    "menu_nome": "Criar proforma",\n    "menu_link": null,\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 0\n  },\n  {\n    "menu_id": 100,\n    "menu_menu_id": 71,\n    "menu_codigo": "maguita.pos.retalho",\n    "menu_raiz": "71",\n    "menu_nivel": 1,\n    "menu_icon": null,\n    "menu_nome": "Retalho de artigos",\n    "menu_link": null,\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 0\n  },\n  {\n    "menu_id": 113,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.utentes",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "<?xml version=\\"1.0\\" encoding=\\"iso-8859-1\\"?>\\n<!-- Generator: Adobe Illustrator 22.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\\n<svg version=\\"1.1\\" xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\" x=\\"0px\\" y=\\"0px\\"\\n\\t viewBox=\\"0 0 50 50\\" style=\\"enable-background:new 0 0 50 50;\\" xml:space=\\"preserve\\">\\n<g id=\\"Layer_1\\">\\n\\t<path d=\\"M19.38,19.265C13.464,20.481,9,25.729,9,32v17h32V32c0-6.271-4.464-11.519-10.38-12.735C33.261,17.464,35,14.431,35,11\\n\\t\\tc0-5.514-4.486-10-10-10S15,5.486,15,11C15,14.431,16.739,17.464,19.38,19.265z M28,21c6.065,0,11,4.935,11,11v15H11V32\\n\\t\\tc0-6.065,4.935-11,11-11H28z M25,3c4.411,0,8,3.589,8,8s-3.589,8-8,8s-8-3.589-8-8S20.589,3,25,3z\\"/>\\n</g>\\n<g>\\n</g>\\n</svg>",\n    "menu_nome": "Utentes",\n    "menu_link": "../includes/utentes.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 3\n  },\n  {\n    "menu_id": 114,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.calendar",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "<svg xmlns=\\"http://www.w3.org/2000/svg\\" width=\\"16\\" height=\\"16\\" fill=\\"currentColor\\" class=\\"bi bi-calendar2-check\\" viewBox=\\"0 0 16 16\\"> <path d=\\"M10.854 8.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708 0z\\"/> <path d=\\"M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H2z\\"/> <path d=\\"M2.5 4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V4z\\"/> </svg>",\n    "menu_nome": "Agenda",\n    "menu_link": "../includes/calendar.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 3\n  },\n  {\n    "menu_id": 102,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.contacorrente",\n    "menu_raiz": "103",\n    "menu_nivel": 0,\n    "menu_icon": "<svg  enable-background=\\"new 0 0 512 512\\" viewBox=\\"0 0 512 512\\"><g><path d=\\"m436.812 75.188c-48.485-48.486-112.699-75.188-180.812-75.188s-132.327 26.702-180.812 75.188c-48.486 48.485-75.188 112.699-75.188 180.812s26.702 132.327 75.188 180.812c48.485 48.486 112.699 75.188 180.812 75.188s132.327-26.702 180.812-75.188c48.486-48.485 75.188-112.699 75.188-180.812s-26.702-132.327-75.188-180.812zm-180.812 406.812c-124.617 0-226-101.383-226-226s101.383-226 226-226 226 101.383 226 226-101.383 226-226 226z\\"/><path d=\\"m256 61c-107.523 0-195 87.477-195 195s87.477 195 195 195 195-87.477 195-195-87.477-195-195-195zm0 360c-90.981 0-165-74.019-165-165s74.019-165 165-165 165 74.019 165 165-74.019 165-165 165z\\"/><path d=\\"m301 210.848c0 8.284 6.716 15 15 15s15-6.716 15-15c0-16.612-8.592-32.584-23.574-43.82-10.233-7.675-22.824-12.802-36.426-14.983v-16.198c0-8.284-6.716-15-15-15s-15 6.716-15 15v16.198c-13.603 2.181-26.194 7.308-36.426 14.983-14.982 11.236-23.574 27.208-23.574 43.82s8.592 32.583 23.574 43.82c10.233 7.675 22.824 12.802 36.426 14.983v59.409c-17.28-4.223-30-15.437-30-28.212 0-8.284-6.716-15-15-15s-15 6.716-15 15c0 16.612 8.592 32.583 23.574 43.82 10.233 7.675 22.824 12.802 36.426 14.983v16.349c0 8.284 6.716 15 15 15s15-6.716 15-15v-16.349c13.603-2.181 26.194-7.308 36.426-14.983 14.982-11.236 23.574-27.208 23.574-43.82s-8.592-32.584-23.574-43.82c-10.233-7.675-22.824-12.802-36.426-14.983v-59.409c17.28 4.224 30 15.437 30 28.212zm-90 0c0-12.775 12.72-23.989 30-28.212v56.423c-17.28-4.222-30-15.436-30-28.211zm90 90c0 12.775-12.72 23.989-30 28.212v-56.423c17.28 4.223 30 15.436 30 28.211z\\"/></g></svg>",\n    "menu_nome": "Conta corrente",\n    "menu_link": "../includes/accurent.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 0\n  },\n  {\n    "menu_id": 110,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.proforma",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "<?xml version=\\"1.0\\" encoding=\\"iso-8859-1\\"?>\\n<!-- Generator: Adobe Illustrator 22.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\\n<svg version=\\"1.1\\" id=\\"Layer_1\\" xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\" x=\\"0px\\" y=\\"0px\\"\\n\\t viewBox=\\"0 0 100.25 100.25\\" style=\\"enable-background:new 0 0 100.25 100.25;\\" xml:space=\\"preserve\\">\\n<path d=\\"M79.567,29.924l-18.26-18.479C61.025,11.16,60.641,11,60.24,11H20.5c-0.828,0-1.5,0.672-1.5,1.5v75\\n\\tc0,0.828,0.672,1.5,1.5,1.5h58c0.828,0,1.5-0.672,1.5-1.5V30.979C80,30.585,79.845,30.206,79.567,29.924z M62,16.415L74.929,29.5H62\\n\\tV16.415z M22,86V14h37v17c0,0.828,0.672,1.5,1.5,1.5H77V86H22z\\"/>\\n</svg>",\n    "menu_nome": "Fatura Proforma",\n    "menu_link": "../includes/faturaProforma.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 3\n  },\n  {\n    "menu_id": 111,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.fatura",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "<?xml version=\\"1.0\\" encoding=\\"iso-8859-1\\"?>\\n<!-- Generator: Adobe Illustrator 22.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\\n<svg version=\\"1.1\\" id=\\"Layer_1\\" xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\" x=\\"0px\\" y=\\"0px\\"\\n\\t viewBox=\\"0 0 100.25 100.25\\" style=\\"enable-background:new 0 0 100.25 100.25;\\" xml:space=\\"preserve\\">\\n<path d=\\"M79.567,29.924l-18.26-18.479C61.025,11.16,60.641,11,60.24,11H20.5c-0.828,0-1.5,0.672-1.5,1.5v75\\n\\tc0,0.828,0.672,1.5,1.5,1.5h58c0.828,0,1.5-0.672,1.5-1.5V30.979C80,30.585,79.845,30.206,79.567,29.924z M62,16.415L74.929,29.5H62\\n\\tV16.415z M22,86V14h37v17c0,0.828,0.672,1.5,1.5,1.5H77V86H22z\\"/>\\n</svg>",\n    "menu_nome": "Fatura",\n    "menu_link": "../includes/fatura.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 3\n  },\n  {\n    "menu_id": 112,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.fornecedores",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "<?xml version=\\"1.0\\" ?><svg viewBox=\\"0 0 64 64\\" xmlns=\\"http://www.w3.org/2000/svg\\"><title/><g id=\\"User\\"><path d=\\"M41.2452,33.0349a16,16,0,1,0-18.49,0A26.0412,26.0412,0,0,0,4,58a2,2,0,0,0,2,2H58a2,2,0,0,0,2-2A26.0412,26.0412,0,0,0,41.2452,33.0349ZM20,20A12,12,0,1,1,32,32,12.0137,12.0137,0,0,1,20,20ZM8.09,56A22.0293,22.0293,0,0,1,30,36h4A22.0293,22.0293,0,0,1,55.91,56Z\\"/></g></svg>",\n    "menu_nome": "Fornecedores",\n    "menu_link": "../includes/providers.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 3\n  },\n  {\n    "menu_id": 115,\n    "menu_menu_id": null,\n    "menu_codigo": "maguita.nota.credito",\n    "menu_raiz": "",\n    "menu_nivel": 0,\n    "menu_icon": "<?xml version=\\"1.0\\" encoding=\\"iso-8859-1\\"?>\\n    <!-- Generator: Adobe Illustrator 22.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\\n    <svg version=\\"1.1\\" id=\\"Layer_1\\" xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\" x=\\"0px\\" y=\\"0px\\"\\n    viewBox=\\"0 0 100.25 100.25\\" style=\\"enable-background:new 0 0 100.25 100.25;\\" xml:space=\\"preserve\\">\\n    <path d=\\"M79.567,29.924l-18.26-18.479C61.025,11.16,60.641,11,60.24,11H20.5c-0.828,0-1.5,0.672-1.5,1.5v75\\n    c0,0.828,0.672,1.5,1.5,1.5h58c0.828,0,1.5-0.672,1.5-1.5V30.979C80,30.585,79.845,30.206,79.567,29.924z M62,16.415L74.929,29.5H62\\n    V16.415z M22,86V14h37v17c0,0.828,0.672,1.5,1.5,1.5H77V86H22z\\"/>\\n    </svg>",\n    "menu_nome": "Nota Credito",\n    "menu_link": "../includes/notaCredito.html",\n    "menu_estado": 1,\n    "menu_children": 0,\n    "menu_maxnode": 0,\n    "menu_directchildern": 0,\n    "menu_position": 3\n  }\n\n\n      ]$jsonb$::jsonb) d ( document )\n    loop\n      _menu := jsonb_populate_record( _menu, _data.document );\n      perform lib.sets( _menu );\n    end loop;\n  end;\n$block$;\n	do $block$ declare _data record; _menu auth.menu; begin for _data in select * from jsonb_array_elements($jsonb$[ { "menu_id": 89, "menu_menu_id": 71, "menu_codigo": "maguita.pos.remover", "menu_raiz": "71", "menu_nivel": 1, "menu_icon": null, "menu_nome": "Remover artigos depois de confirmar conta", "menu_link": null, "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 0 }, { "menu_id": 104, "menu_menu_id": 71, "menu_codigo": "maguita.pos.alterar_preco", "menu_raiz": "71", "menu_nivel": 1, "menu_icon": null, "menu_nome": "Alterar preço de artigo no carrinho", "menu_link": null, "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 0 }, { "menu_id": 107, "menu_menu_id": null, "menu_codigo": "maguita.entrada.artigos", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "<svg x=\\"0px\\" y=\\"0px\\" viewBox=\\"0 0 512 512\\" style=\\"enable-background:new 0 0 512 512;\\"\\n\\t\\t\\t\\t\\t\\t\\txml:space=\\"preserve\\">\\n\\t\\t\\t\\t\\t\\t\\t<g>\\n\\t\\t\\t\\t\\t\\t\\t\\t<g>\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<path\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\td=\\"M472,313v139c0,11.028-8.972,20-20,20H60c-11.028,0-20-8.972-20-20V313H0v139c0,33.084,26.916,60,60,60h392 c33.084,0,60-26.916,60-60V313H472z\\" />\\n\\t\\t\\t\\t\\t\\t\\t\\t</g>\\n\\t\\t\\t\\t\\t\\t\\t</g>\\n\\t\\t\\t\\t\\t\\t\\t<g>\\n\\t\\t\\t\\t\\t\\t\\t\\t<g>\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<polygon\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tpoints=\\"352,235.716 276,311.716 276,0 236,0 236,311.716 160,235.716 131.716,264 256,388.284 380.284,264\\" />\\n\\t\\t\\t\\t\\t\\t\\t\\t</g>\\n\\t\\t\\t\\t\\t\\t\\t</g>\\n\\t\\t\\t\\t\\t\\t</svg>", "menu_nome": "Guia de Entrada", "menu_link": "../includes/guiaEntrada.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 3 }, { "menu_id": 87, "menu_menu_id": 71, "menu_codigo": "maguita.pos.adicionar", "menu_raiz": "71", "menu_nivel": 1, "menu_icon": null, "menu_nome": "Adicionar artigos depois de confirmar conta", "menu_link": null, "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 0 }, { "menu_id": 90, "menu_menu_id": 71, "menu_codigo": "maguita.pos.vendas", "menu_raiz": "71", "menu_nivel": 1, "menu_icon": null, "menu_nome": "Vendas", "menu_link": null, "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 0 }, { "menu_id": 98, "menu_menu_id": 71, "menu_codigo": "maquita.pos.anularconta", "menu_raiz": "71", "menu_nivel": 1, "menu_icon": null, "menu_nome": "Anular conta", "menu_link": null, "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 0 }, { "menu_id": 93, "menu_menu_id": 71, "menu_codigo": "maguita.pos.imprimir.conta", "menu_raiz": "71", "menu_nivel": 1, "menu_icon": null, "menu_nome": "Impressão de conta", "menu_link": null, "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 0 }, { "menu_id": 94, "menu_menu_id": 71, "menu_codigo": "maguita.pos.pagamentoDireto", "menu_raiz": "71", "menu_nivel": 1, "menu_icon": null, "menu_nome": "Pagamento direto", "menu_link": null, "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 0 }, { "menu_id": 88, "menu_menu_id": 71, "menu_codigo": "maguita.pos.diminuirQuantidade", "menu_raiz": "71", "menu_nivel": 1, "menu_icon": null, "menu_nome": "Diminuir quantidade de artigos depois de confirmado", "menu_link": null, "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 0 }, { "menu_id": 69, "menu_menu_id": null, "menu_codigo": "maguita.definicao", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "\\t\\t<svg enable-background=\\"new 0 0 512 512\\" viewBox=\\"0 0 512 512\\">\\n <path\\n d=\\"m272.066 512h-32.133c-25.989 0-47.134-21.144-47.134-47.133v-10.871c-11.049-3.53-21.784-7.986-32.097-13.323l-7.704 7.704c-18.659 18.682-48.548 18.134-66.665-.007l-22.711-22.71c-18.149-18.129-18.671-48.008.006-66.665l7.698-7.698c-5.337-10.313-9.792-21.046-13.323-32.097h-10.87c-25.988 0-47.133-21.144-47.133-47.133v-32.134c0-25.989 21.145-47.133 47.134-47.133h10.87c3.531-11.05 7.986-21.784 13.323-32.097l-7.704-7.703c-18.666-18.646-18.151-48.528.006-66.665l22.713-22.712c18.159-18.184 48.041-18.638 66.664.006l7.697 7.697c10.313-5.336 21.048-9.792 32.097-13.323v-10.87c0-25.989 21.144-47.133 47.134-47.133h32.133c25.989 0 47.133 21.144 47.133 47.133v10.871c11.049 3.53 21.784 7.986 32.097 13.323l7.704-7.704c18.659-18.682 48.548-18.134 66.665.007l22.711 22.71c18.149 18.129 18.671 48.008-.006 66.665l-7.698 7.698c5.337 10.313 9.792 21.046 13.323 32.097h10.87c25.989 0 47.134 21.144 47.134 47.133v32.134c0 25.989-21.145 47.133-47.134 47.133h-10.87c-3.531 11.05-7.986 21.784-13.323 32.097l7.704 7.704c18.666 18.646 18.151 48.528-.006 66.665l-22.713 22.712c-18.159 18.184-48.041 18.638-66.664-.006l-7.697-7.697c-10.313 5.336-21.048 9.792-32.097 13.323v10.871c0 25.987-21.144 47.131-47.134 47.131zm-106.349-102.83c14.327 8.473 29.747 14.874 45.831 19.025 6.624 1.709 11.252 7.683 11.252 14.524v22.148c0 9.447 7.687 17.133 17.134 17.133h32.133c9.447 0 17.134-7.686 17.134-17.133v-22.148c0-6.841 4.628-12.815 11.252-14.524 16.084-4.151 31.504-10.552 45.831-19.025 5.895-3.486 13.4-2.538 18.243 2.305l15.688 15.689c6.764 6.772 17.626 6.615 24.224.007l22.727-22.726c6.582-6.574 6.802-17.438.006-24.225l-15.695-15.695c-4.842-4.842-5.79-12.348-2.305-18.242 8.473-14.326 14.873-29.746 19.024-45.831 1.71-6.624 7.684-11.251 14.524-11.251h22.147c9.447 0 17.134-7.686 17.134-17.133v-32.134c0-9.447-7.687-17.133-17.134-17.133h-22.147c-6.841 0-12.814-4.628-14.524-11.251-4.151-16.085-10.552-31.505-19.024-45.831-3.485-5.894-2.537-13.4 2.305-18.242l15.689-15.689c6.782-6.774 6.605-17.634.006-24.225l-22.725-22.725c-6.587-6.596-17.451-6.789-24.225-.006l-15.694 15.695c-4.842 4.843-12.35 5.791-18.243 2.305-14.327-8.473-29.747-14.874-45.831-19.025-6.624-1.709-11.252-7.683-11.252-14.524v-22.15c0-9.447-7.687-17.133-17.134-17.133h-32.133c-9.447 0-17.134 7.686-17.134 17.133v22.148c0 6.841-4.628 12.815-11.252 14.524-16.084 4.151-31.504 10.552-45.831 19.025-5.896 3.485-13.401 2.537-18.243-2.305l-15.688-15.689c-6.764-6.772-17.627-6.615-24.224-.007l-22.727 22.726c-6.582 6.574-6.802 17.437-.006 24.225l15.695 15.695c4.842 4.842 5.79 12.348 2.305 18.242-8.473 14.326-14.873 29.746-19.024 45.831-1.71 6.624-7.684 11.251-14.524 11.251h-22.148c-9.447.001-17.134 7.687-17.134 17.134v32.134c0 9.447 7.687 17.133 17.134 17.133h22.147c6.841 0 12.814 4.628 14.524 11.251 4.151 16.085 10.552 31.505 19.024 45.831 3.485 5.894 2.537 13.4-2.305 18.242l-15.689 15.689c-6.782 6.774-6.605 17.634-.006 24.225l22.725 22.725c6.587 6.596 17.451 6.789 24.225.006l15.694-15.695c3.568-3.567 10.991-6.594 18.244-2.304z\\" />\\n <path\\n d=\\"m256 367.4c-61.427 0-111.4-49.974-111.4-111.4s49.973-111.4 111.4-111.4 111.4 49.974 111.4 111.4-49.973 111.4-111.4 111.4zm0-192.8c-44.885 0-81.4 36.516-81.4 81.4s36.516 81.4 81.4 81.4 81.4-36.516 81.4-81.4-36.515-81.4-81.4-81.4z\\" />\\n </svg>", "menu_nome": "Definições", "menu_link": "../includes/settings.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 4 }, { "menu_id": 106, "menu_menu_id": null, "menu_codigo": "maguita.transferencia.artigos", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "<svg x=\\"0px\\" y=\\"0px\\" viewBox=\\"0 0 477.859 477.859\\"\\n\\t\\t\\t\\t\\t\\t\\tstyle=\\"enable-background:new 0 0 477.859 477.859;\\" xml:space=\\"preserve\\">\\n\\t\\t\\t\\t\\t\\t\\t<g>\\n\\t\\t\\t\\t\\t\\t\\t\\t<g>\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<path d=\\"M472.863,175.662L353.396,56.195c-6.666-6.664-17.472-6.662-24.136,0.004c-3.199,3.2-4.996,7.538-4.997,12.063v51.2\\n\\t\\t\\t\\t\\t\\tH204.796c-9.426,0-17.067,7.641-17.067,17.067c0,9.426,7.641,17.067,17.067,17.067H341.33c9.426,0,17.067-7.641,17.067-17.067\\n\\t\\t\\t\\t\\t\\tV109.46l78.268,78.268l-78.268,78.268v-27.068c0-9.426-7.641-17.067-17.067-17.067H153.596v-51.2\\n\\t\\t\\t\\t\\t\\tc-0.002-9.426-7.645-17.065-17.07-17.063c-4.524,0.001-8.863,1.798-12.063,4.997L4.997,278.062\\n\\t\\t\\t\\t\\t\\tc-6.663,6.665-6.663,17.468,0,24.132l119.467,119.467c3.2,3.201,7.54,5,12.066,5.001c2.243,0.007,4.466-0.434,6.536-1.297\\n\\t\\t\\t\\t\\t\\tc6.376-2.644,10.532-8.867,10.53-15.77v-51.2h119.467c9.426,0,17.067-7.641,17.067-17.067s-7.641-17.067-17.067-17.067H136.53\\n\\t\\t\\t\\t\\t\\tc-9.426,0-17.067,7.641-17.067,17.067v27.068l-78.268-78.268l78.268-78.268v27.068c0,9.426,7.641,17.067,17.067,17.067h187.733\\n\\t\\t\\t\\t\\t\\tv51.2c0.002,9.426,7.645,17.065,17.07,17.063c4.524-0.001,8.863-1.798,12.063-4.997l119.467-119.467\\n\\t\\t\\t\\t\\t\\tC479.525,193.129,479.525,182.326,472.863,175.662z\\" />\\n\\t\\t\\t\\t\\t\\t\\t\\t</g>\\n\\t\\t\\t\\t\\t\\t\\t</g>\\n\\t\\t\\t\\t\\t\\t</svg>", "menu_nome": "Transferência de Artigos", "menu_link": "../includes/transferArticles.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 3 }, { "menu_id": 108, "menu_menu_id": null, "menu_codigo": "maguita.saida.artigos", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "<?xml version=\\"1.0\\" ?><!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'><svg enable-background=\\"new 0 0 32 32\\" id=\\"Слой_1\\" version=\\"1.1\\" viewBox=\\"0 0 32 32\\" xml:space=\\"preserve\\" xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\"><g id=\\"Share\\"><path clip-rule=\\"evenodd\\" d=\\"M8.624,21.336h2.015c1.402-7.953,8.329-14,16.684-14 c0.35,0,0.683,0.003,1.019,0.006l-3.664,3.663c-0.391,0.391-0.391,1.023,0,1.414c0.195,0.195,0.451,0.293,0.707,0.293 c0.256,0,0.512-0.098,0.707-0.293L32,6.356l-5.907-6.063c-0.391-0.391-1.023-0.391-1.414,0c-0.391,0.391-0.391,1.023,0,1.414 l3.631,3.631c-0.318-0.001-0.62-0.003-0.945-0.003C17.895,5.336,10.066,12.271,8.624,21.336z\\" fill=\\"#121313\\" fill-rule=\\"evenodd\\"/><path clip-rule=\\"evenodd\\" d=\\"M29,15c-0.552,0-1,0.448-1,1v14H2V10h9c0.552,0,1-0.448,1-1 c0-0.552-0.448-1-1-1h-0.03H2c-1.104,0-2,0.896-2,2v20c0,1.104,0.896,2,2,2h26c1.104,0,2-0.896,2-2V16C30,15.448,29.552,15,29,15z\\" fill=\\"#121313\\" fill-rule=\\"evenodd\\"/></g><g/><g/><g/><g/><g/><g/></svg>", "menu_nome": "Guia de Saída", "menu_link": "../includes/guiaSaida.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 3 }, { "menu_id": 109, "menu_menu_id": null, "menu_codigo": "maguita.clientes", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "<?xml version=\\"1.0\\" encoding=\\"iso-8859-1\\"?>\\n<!-- Generator: Adobe Illustrator 22.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) -->\\n<svg version=\\"1.1\\" xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\" x=\\"0px\\" y=\\"0px\\"\\n\\t viewBox=\\"0 0 50 50\\" style=\\"enable-background:new 0 0 50 50;\\" xml:space=\\"preserve\\">\\n<g id=\\"Layer_1\\">\\n\\t<path d=\\"M19.38,19.265C13.464,20.481,9,25.729,9,32v17h32V32c0-6.271-4.464-11.519-10.38-12.735C33.261,17.464,35,14.431,35,11\\n\\t\\tc0-5.514-4.486-10-10-10S15,5.486,15,11C15,14.431,16.739,17.464,19.38,19.265z M28,21c6.065,0,11,4.935,11,11v15H11V32\\n\\t\\tc0-6.065,4.935-11,11-11H28z M25,3c4.411,0,8,3.589,8,8s-3.589,8-8,8s-8-3.589-8-8S20.589,3,25,3z\\"/>\\n</g>\\n<g>\\n</g>\\n</svg>", "menu_nome": "Clientes", "menu_link": "../includes/customers.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 3 }, { "menu_id": 116, "menu_menu_id": 71, "menu_codigo": "maguita.pos.report", "menu_raiz": "71", "menu_nivel": 1, "menu_icon": null, "menu_nome": "Relatório", "menu_link": null, "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 0 }, { "menu_id": 117, "menu_menu_id": 71, "menu_codigo": "maguita.pos.conta", "menu_raiz": "71", "menu_nivel": 1, "menu_icon": null, "menu_nome": "..........", "menu_link": null, "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 0 }, { "menu_id": 70, "menu_menu_id": null, "menu_codigo": "maguita.relatorio", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "\\t<svg x=\\"0px\\" y=\\"0px\\" viewBox=\\"0 0 512.001 512.001\\" style=\\"enable-background:new 0 0 512.001 512.001;\\" xml:space=\\"preserve\\">\\n <g>\\n <g>\\n <path d=\\"M506.35,80.699c-7.57-7.589-19.834-7.609-27.43-0.052L331.662,227.31l-42.557-42.557c-7.577-7.57-19.846-7.577-27.423,0\\n L89.076,357.36c-7.577,7.57-7.577,19.853,0,27.423c3.782,3.788,8.747,5.682,13.712,5.682c4.958,0,9.93-1.894,13.711-5.682\\n l158.895-158.888l42.531,42.524c7.57,7.57,19.808,7.577,27.397,0.032l160.97-160.323\\n C513.881,100.571,513.907,88.288,506.35,80.699z\\" />\\n </g>\\n </g>\\n <g>\\n <g>\\n <path d=\\"M491.96,449.94H38.788V42.667c0-10.712-8.682-19.394-19.394-19.394S0,31.955,0,42.667v426.667\\n c0,10.712,8.682,19.394,19.394,19.394H491.96c10.712,0,19.394-8.682,19.394-19.394C511.354,458.622,502.672,449.94,491.96,449.94z\\n \\" />\\n </g>\\n </g>\\n <g>\\n <g>\\n <path d=\\"M492.606,74.344H347.152c-10.712,0-19.394,8.682-19.394,19.394s8.682,19.394,19.394,19.394h126.061v126.067\\n c0,10.705,8.682,19.394,19.394,19.394S512,249.904,512,239.192V93.738C512,83.026,503.318,74.344,492.606,74.344z\\" />\\n </g>\\n </g>\\n </svg>", "menu_nome": "Relatórios", "menu_link": "../includes/report.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 3 }, { "menu_id": 74, "menu_menu_id": null, "menu_codigo": "maguita.artigo", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "<svg enable-background=\\"new 0 0 511.414 511.414\\" viewBox=\\"0 0 511.414 511.414\\"><path d=\\"m497.695 108.838c0-6.488-3.919-12.334-9.92-14.8l-225.988-92.838c-3.896-1.6-8.264-1.6-12.16 0l-225.988 92.838c-6.001 2.465-9.92 8.312-9.92 14.8v293.738c0 6.488 3.918 12.334 9.92 14.8l225.988 92.838c3.854 1.583 8.186 1.617 12.14-.001.193-.064-8.363 3.445 226.008-92.837 6.002-2.465 9.92-8.312 9.92-14.8zm-241.988 76.886-83.268-34.207 179.951-78.501 88.837 36.495zm-209.988-51.67 71.841 29.513v83.264c0 8.836 7.164 16 16 16s16-7.164 16-16v-70.118l90.147 37.033v257.797l-193.988-79.692zm209.988-100.757 55.466 22.786-179.951 78.501-61.035-25.074zm16 180.449 193.988-79.692v257.797l-193.988 79.692z\\"/></svg>", "menu_nome": "Artigos", "menu_link": "../includes/artigos.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 2 }, { "menu_id": 71, "menu_menu_id": null, "menu_codigo": "maguita.pos", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "", "menu_nome": "Pos", "menu_link": null, "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 1 }, { "menu_id": 75, "menu_menu_id": null, "menu_codigo": "maguita.colaboradores", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "<svg viewBox=\\"0 0 512 512\\"><path d=\\"m471.386719 325.011719c-16.96875-14.910157-37.546875-27.792969-61.167969-38.289063-10.097656-4.484375-21.914062.0625-26.398438 10.15625-4.484374 10.09375.0625 21.910156 10.15625 26.398438 19.917969 8.851562 37.082032 19.542968 51.007813 31.78125 17.167969 15.085937 27.015625 36.929687 27.015625 59.941406v37c0 11.027344-8.972656 20-20 20h-392c-11.027344 0-20-8.972656-20-20v-37c0-23.011719 9.847656-44.855469 27.015625-59.941406 20.207031-17.757813 79.082031-59.058594 188.984375-59.058594 81.605469 0 148-66.394531 148-148s-66.394531-148-148-148-148 66.394531-148 148c0 47.707031 22.695312 90.207031 57.851562 117.289062-64.328124 14.140626-104.34375 41.359376-125.238281 59.722657-25.808593 22.675781-40.613281 55.472656-40.613281 89.988281v37c0 33.085938 26.914062 60 60 60h392c33.085938 0 60-26.914062 60-60v-37c0-34.515625-14.804688-67.3125-40.613281-89.988281zm-323.386719-177.011719c0-59.550781 48.449219-108 108-108s108 48.449219 108 108-48.449219 108-108 108-108-48.449219-108-108zm0 0\\"/></svg>", "menu_nome": "Colaboradores", "menu_link": "../includes/colabs.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 5 }, { "menu_id": 77, "menu_menu_id": 71, "menu_codigo": "maguita.pos.contacorrente", "menu_raiz": "71", "menu_nivel": 1, "menu_icon": null, "menu_nome": "Conta corrente", "menu_link": null, "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 0 }, { "menu_id": 95, "menu_menu_id": 71, "menu_codigo": "maguita.pos.criar.proforma", "menu_raiz": "71", "menu_nivel": 1, "menu_icon": null, "menu_nome": "Criar proforma", "menu_link": null, "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 0 }, { "menu_id": 100, "menu_menu_id": 71, "menu_codigo": "maguita.pos.retalho", "menu_raiz": "71", "menu_nivel": 1, "menu_icon": null, "menu_nome": "Retalho de artigos", "menu_link": null, "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 0 }, { "menu_id": 113, "menu_menu_id": null, "menu_codigo": "maguita.utentes", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "<?xml version=\\"1.0\\" encoding=\\"iso-8859-1\\"?>\\n<!-- Generator: Adobe Illustrator 22.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) -->\\n<svg version=\\"1.1\\" xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\" x=\\"0px\\" y=\\"0px\\"\\n\\t viewBox=\\"0 0 50 50\\" style=\\"enable-background:new 0 0 50 50;\\" xml:space=\\"preserve\\">\\n<g id=\\"Layer_1\\">\\n\\t<path d=\\"M19.38,19.265C13.464,20.481,9,25.729,9,32v17h32V32c0-6.271-4.464-11.519-10.38-12.735C33.261,17.464,35,14.431,35,11\\n\\t\\tc0-5.514-4.486-10-10-10S15,5.486,15,11C15,14.431,16.739,17.464,19.38,19.265z M28,21c6.065,0,11,4.935,11,11v15H11V32\\n\\t\\tc0-6.065,4.935-11,11-11H28z M25,3c4.411,0,8,3.589,8,8s-3.589,8-8,8s-8-3.589-8-8S20.589,3,25,3z\\"/>\\n</g>\\n<g>\\n</g>\\n</svg>", "menu_nome": "Utentes", "menu_link": "../includes/utentes.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 3 }, { "menu_id": 114, "menu_menu_id": null, "menu_codigo": "maguita.calendar", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "<svg xmlns=\\"http://www.w3.org/2000/svg\\" width=\\"16\\" height=\\"16\\" fill=\\"currentColor\\" class=\\"bi bi-calendar2-check\\" viewBox=\\"0 0 16 16\\"> <path d=\\"M10.854 8.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708 0z\\"/> <path d=\\"M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H2z\\"/> <path d=\\"M2.5 4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V4z\\"/> </svg>", "menu_nome": "Agenda", "menu_link": "../includes/calendar.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 3 }, { "menu_id": 102, "menu_menu_id": null, "menu_codigo": "maguita.contacorrente", "menu_raiz": "103", "menu_nivel": 0, "menu_icon": "<svg enable-background=\\"new 0 0 512 512\\" viewBox=\\"0 0 512 512\\"><g><path d=\\"m436.812 75.188c-48.485-48.486-112.699-75.188-180.812-75.188s-132.327 26.702-180.812 75.188c-48.486 48.485-75.188 112.699-75.188 180.812s26.702 132.327 75.188 180.812c48.485 48.486 112.699 75.188 180.812 75.188s132.327-26.702 180.812-75.188c48.486-48.485 75.188-112.699 75.188-180.812s-26.702-132.327-75.188-180.812zm-180.812 406.812c-124.617 0-226-101.383-226-226s101.383-226 226-226 226 101.383 226 226-101.383 226-226 226z\\"/><path d=\\"m256 61c-107.523 0-195 87.477-195 195s87.477 195 195 195 195-87.477 195-195-87.477-195-195-195zm0 360c-90.981 0-165-74.019-165-165s74.019-165 165-165 165 74.019 165 165-74.019 165-165 165z\\"/><path d=\\"m301 210.848c0 8.284 6.716 15 15 15s15-6.716 15-15c0-16.612-8.592-32.584-23.574-43.82-10.233-7.675-22.824-12.802-36.426-14.983v-16.198c0-8.284-6.716-15-15-15s-15 6.716-15 15v16.198c-13.603 2.181-26.194 7.308-36.426 14.983-14.982 11.236-23.574 27.208-23.574 43.82s8.592 32.583 23.574 43.82c10.233 7.675 22.824 12.802 36.426 14.983v59.409c-17.28-4.223-30-15.437-30-28.212 0-8.284-6.716-15-15-15s-15 6.716-15 15c0 16.612 8.592 32.583 23.574 43.82 10.233 7.675 22.824 12.802 36.426 14.983v16.349c0 8.284 6.716 15 15 15s15-6.716 15-15v-16.349c13.603-2.181 26.194-7.308 36.426-14.983 14.982-11.236 23.574-27.208 23.574-43.82s-8.592-32.584-23.574-43.82c-10.233-7.675-22.824-12.802-36.426-14.983v-59.409c17.28 4.224 30 15.437 30 28.212zm-90 0c0-12.775 12.72-23.989 30-28.212v56.423c-17.28-4.222-30-15.436-30-28.211zm90 90c0 12.775-12.72 23.989-30 28.212v-56.423c17.28 4.223 30 15.436 30 28.211z\\"/></g></svg>", "menu_nome": "Conta corrente", "menu_link": "../includes/accurent.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 0 }, { "menu_id": 110, "menu_menu_id": null, "menu_codigo": "maguita.proforma", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "<?xml version=\\"1.0\\" encoding=\\"iso-8859-1\\"?>\\n<!-- Generator: Adobe Illustrator 22.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) -->\\n<svg version=\\"1.1\\" id=\\"Layer_1\\" xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\" x=\\"0px\\" y=\\"0px\\"\\n\\t viewBox=\\"0 0 100.25 100.25\\" style=\\"enable-background:new 0 0 100.25 100.25;\\" xml:space=\\"preserve\\">\\n<path d=\\"M79.567,29.924l-18.26-18.479C61.025,11.16,60.641,11,60.24,11H20.5c-0.828,0-1.5,0.672-1.5,1.5v75\\n\\tc0,0.828,0.672,1.5,1.5,1.5h58c0.828,0,1.5-0.672,1.5-1.5V30.979C80,30.585,79.845,30.206,79.567,29.924z M62,16.415L74.929,29.5H62\\n\\tV16.415z M22,86V14h37v17c0,0.828,0.672,1.5,1.5,1.5H77V86H22z\\"/>\\n</svg>", "menu_nome": "Fatura Proforma", "menu_link": "../includes/faturaProforma.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 3 }, { "menu_id": 111, "menu_menu_id": null, "menu_codigo": "maguita.fatura", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "<?xml version=\\"1.0\\" encoding=\\"iso-8859-1\\"?>\\n<!-- Generator: Adobe Illustrator 22.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) -->\\n<svg version=\\"1.1\\" id=\\"Layer_1\\" xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\" x=\\"0px\\" y=\\"0px\\"\\n\\t viewBox=\\"0 0 100.25 100.25\\" style=\\"enable-background:new 0 0 100.25 100.25;\\" xml:space=\\"preserve\\">\\n<path d=\\"M79.567,29.924l-18.26-18.479C61.025,11.16,60.641,11,60.24,11H20.5c-0.828,0-1.5,0.672-1.5,1.5v75\\n\\tc0,0.828,0.672,1.5,1.5,1.5h58c0.828,0,1.5-0.672,1.5-1.5V30.979C80,30.585,79.845,30.206,79.567,29.924z M62,16.415L74.929,29.5H62\\n\\tV16.415z M22,86V14h37v17c0,0.828,0.672,1.5,1.5,1.5H77V86H22z\\"/>\\n</svg>", "menu_nome": "Fatura", "menu_link": "../includes/fatura.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 3 }, { "menu_id": 112, "menu_menu_id": null, "menu_codigo": "maguita.fornecedores", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "<?xml version=\\"1.0\\" ?><svg viewBox=\\"0 0 64 64\\" xmlns=\\"http://www.w3.org/2000/svg\\"><title/><g id=\\"User\\"><path d=\\"M41.2452,33.0349a16,16,0,1,0-18.49,0A26.0412,26.0412,0,0,0,4,58a2,2,0,0,0,2,2H58a2,2,0,0,0,2-2A26.0412,26.0412,0,0,0,41.2452,33.0349ZM20,20A12,12,0,1,1,32,32,12.0137,12.0137,0,0,1,20,20ZM8.09,56A22.0293,22.0293,0,0,1,30,36h4A22.0293,22.0293,0,0,1,55.91,56Z\\"/></g></svg>", "menu_nome": "Fornecedores", "menu_link": "../includes/providers.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 3 }, { "menu_id": 115, "menu_menu_id": null, "menu_codigo": "maguita.nota.credito", "menu_raiz": "", "menu_nivel": 0, "menu_icon": "<?xml version=\\"1.0\\" encoding=\\"iso-8859-1\\"?>\\n <!-- Generator: Adobe Illustrator 22.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) -->\\n <svg version=\\"1.1\\" id=\\"Layer_1\\" xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\" x=\\"0px\\" y=\\"0px\\"\\n viewBox=\\"0 0 100.25 100.25\\" style=\\"enable-background:new 0 0 100.25 100.25;\\" xml:space=\\"preserve\\">\\n <path d=\\"M79.567,29.924l-18.26-18.479C61.025,11.16,60.641,11,60.24,11H20.5c-0.828,0-1.5,0.672-1.5,1.5v75\\n c0,0.828,0.672,1.5,1.5,1.5h58c0.828,0,1.5-0.672,1.5-1.5V30.979C80,30.585,79.845,30.206,79.567,29.924z M62,16.415L74.929,29.5H62\\n V16.415z M22,86V14h37v17c0,0.828,0.672,1.5,1.5,1.5H77V86H22z\\"/>\\n </svg>", "menu_nome": "Nota Credito", "menu_link": "../includes/notaCredito.html", "menu_estado": 1, "menu_children": 0, "menu_maxnode": 0, "menu_directchildern": 0, "menu_position": 3 } ]$jsonb$::jsonb) d ( document ) loop _menu := jsonb_populate_record( _menu, _data.document ); perform lib.sets( _menu ); end loop; end; $block$;
e1f2a308-460e-4a30-ae48-bc8779d90189	\ndrop function if exists report.__formattable();\ncreate or replace function report.__formattable()\nreturns text[] immutable language sql as $$\n  select array_agg( distinct te.name )\n    from report.talias ta\n      inner join unnest(( ta.alias|| ta.type) ) te( name ) on true\n    where ( ta.alias|| ta.type) && array[ 'date', 'timestamp', 'timestamptz' ]::text[];\n$$;\n\n\ndrop function if exists  report.__prepare_order( report jsonb );\ncreate or replace function  report.__prepare_order( report jsonb,\n  columns jsonb[],\n  aggregates jsonb[]\n)\nreturns table( counts int8, expression text, selected jsonb[] )\nimmutable\nlanguage plpgsql as $$\ndeclare\n  _orders record;\n  _source record;\n  _selected jsonb[];\n  _formattable record;\nbegin\n  select * into _source from report.source_map( (report->>'source' )::regclass );\n  select * into _formattable from report.__formattable() f( types );\n\n  with __orders as (\n    select\n      e.element,\n      ( e.element->>'priority' )::int as priority,\n      e.ordinality as ordinality\n    from jsonb_array_elements( report->'orders' ) with ordinality e( element )\n  ) select array_agg( e.element order by e.priority desc nulls last, e.ordinality ) as orders into _selected\n      from __orders e\n  ;\n\n  if( coalesce( array_length( _selected, 1 ), 0 ) ) = 0 then\n    with __columns as (\n    select\n        e.element->>'column' as "column",\n        e.element->>'rename' as rename,\n        e.element->>'type' as "type",\n        e.ordinality,\n        -- Prioridade igual a ordem reverva, quanto maoir for a ordem posicional menor a prioridade\n        e.ordinality * -1 as priority\n      from unnest( columns || aggregates ) with ordinality e ( element )\n    ), __orders as (\n      select\n          case\n            when cc.type = 'group' then cc.rename\n            when cc.type = 'column' then cc.column\n          end as "column",\n          'asc' as "orientation",\n          'last' as "nulls",\n          cc.ordinality,\n          cc.priority\n        from __columns cc\n        order by cc.ordinality\n    ) select array_agg( to_jsonb( o ) order by o.priority desc nulls last, o.ordinality) as orders into _selected\n        from __orders o\n        where o."column" is not null\n    ;\n  end if;\n\n  with __orders as (\n    select\n        case\n          when ( sc."column"->>'mask' ) is not null and c.column_type = any( _formattable.types ) then format( '\\:%s', c.column_name )\n          else c.column_name\n        end as "column",\n        (o."order"->>'priority')::int as "priority",\n        coalesce( lib.str_normalize( o."order"->>'orientation' ), 'asc' ) as "orientation",\n        coalesce( lib.str_normalize( o."order"->>'nulls' ), 'last' ) as "nulls",\n        o.ordinality\n      from report.columns( _source.source_class ) c\n        inner join unnest( _selected ) with ordinality o( "order" ) on c.column_name = o."order"->>'column'\n        inner join unnest( columns ) sc( "column" ) on o."order"->>'column' = sc."column"->>'column' and sc."column"->>'column' = c.column_name\n  ) select\n        string_agg( format( '%I %s nulls %s', o."column", o.orientation, o.nulls ), e',\n            '\n          order by o.priority desc nulls last, o.ordinality\n        ) as expression,\n        count( * ) as counts\n        into _orders\n      from __orders o\n      where o.orientation in ( 'asc', 'desc')\n        and o.nulls in ( 'last', 'first' )\n  ;\n\n  __prepare_order.counts := _orders.counts;\n  __prepare_order.expression := _orders.expression;\n  __prepare_order.selected := _selected;\n  return next;\nend;\n$$;\n\ndrop function if exists  report.__prepare_aggregate( report jsonb );\ncreate or replace function report.__prepare_aggregate( report jsonb )\nreturns table(\n  counts int8,\n  expression text,\n  selected jsonb[],\n  exports_expression text,\n  exports_rename text[]\n)\nimmutable\nlanguage plpgsql as $$\ndeclare\n  _source record;\n  _aggregate record;\n  _selected jsonb[];\nbegin\n  select * into _source from report.source_map( (report->>'source' )::regclass );\n\n  select array_agg( coalesce( rc.element, jsonb_build_object() ) || e.doc ) into _selected\n    from jsonb_array_elements( report->'groups' ) with ordinality e( doc )\n      left join report.vcolumns( report ) rc( element ) on rc.element->>'column' = e.doc->>'column'\n        and rc.element->>'key' = e.doc->>'key'\n        and rc.element->>'type' = 'group'\n  ;\n\n  with  __group as (\n    select\n        e.doc->>'column' as group_column,\n        e.doc->>'mode' as group_mode,\n        e.doc->>'func' as group_func,\n        e.doc->>'rename' as group_rename,\n        e.doc->>'expression' as group_expression,\n        e.doc->>'column_position' as column_position,\n        e.doc->>'priority' as group_priority\n      from unnest( _selected ) e( doc )\n  ), __prepare_group as (\n    select\n      g.*\n      from __group g\n      where g.group_func is not null\n  ), __prepare_group_by as (\n    select\n        _sc.*,\n        _g.*\n      from report.columns( _source.source_class ) _sc\n        inner join __prepare_group _g on _sc.column_name = _g.group_column\n  ) select\n        count( * ) as counts,\n        string_agg( agg.group_expression, e',\n          ' order by agg.column_position desc nulls last, agg.group_priority ) as expression,\n        string_agg( format( '%I', agg.group_rename ), ', ' ) as exports_expression,\n        array_agg( agg.group_rename ) as exports_rename\n\n        into _aggregate\n      from __prepare_group_by agg\n  ;\n\n  __prepare_aggregate.counts := _aggregate.counts;\n  __prepare_aggregate.expression := _aggregate.expression;\n  __prepare_aggregate.selected := _selected;\n  __prepare_aggregate.exports_rename := _aggregate.exports_rename;\n  __prepare_aggregate.exports_expression := _aggregate.exports_expression;\n  return next;\nend;\n$$;\n\ndrop function if exists  report.__prepare_where( report jsonb );\ncreate or replace function report.__prepare_where( report jsonb )\nreturns table( counts int8, expression text, selected jsonb[] )\nimmutable\nlanguage plpgsql as $$\ndeclare\n  _source record;\n  _where record;\n  _selected jsonb[];\nbegin\n  select * into _source from report.source_map( (report->>'source' )::regclass );\n\n  select array_agg( coalesce( rc.element, jsonb_build_object() ) || e.doc ) into _selected\n    from jsonb_array_elements( report->'filters' ) with ordinality e( doc )\n      left join report.vcolumns( report ) rc( element ) on rc.element->>'column' = e.doc->>'column'\n        and rc.element->>'key' = e.doc->>'key'\n        and rc.element->>'type' = 'filter'\n  ;\n\n\n  -- FILTERS\n  with __filters as (\n    select\n        e.doc->>'column' as filter_column,\n        coalesce( e.doc->>'opr', '=' ) as filter_opr,\n        coalesce( e.doc->>'mode', 'default' ) as filter_oprmode,\n        e.doc->>'value' as filter_value,\n        e.doc->>'key' as filter_key\n      from unnest( _selected ) e( doc )\n  ), __prepare_filter as (\n    select\n        _f.filter_column,\n        _f.filter_opr,\n        _f.filter_oprmode,\n        _f.filter_key,\n        case\n          when lower( _f.filter_opr ) = 'like' and _f.filter_oprmode = 'default' then format( '%s%s%s', '%', lower( _f.filter_value ), '%' )\n          when lower( _f.filter_opr ) = 'like' and _f.filter_oprmode = 'right' then format( '%s%s', lower( _f.filter_value ), '%')\n          else filter_value\n        end as filter_value\n      from __filters _f\n  ), __prepare_where as (\n    select\n        case\n          when _sc.is_array then format( 'any( %I )', _sc.column_name)\n          when _f.filter_opr = 'like' then format( 'lower( %I )::text', _sc.column_name )\n          else format( '%I', _sc.column_name )\n        end as column_exp,\n\n        case\n          when _sc.is_array then format( '(%L)::%s', _f.filter_value, _sc.column_basetype )\n          when _f.filter_opr = 'like' then format( '(%L)::text', _f.filter_value )\n          else format( '(%L)::%s', _f.filter_value, _sc.column_type )\n        end as args,\n        _sc.*,\n        _f.*\n\n      from report.columns( _source.source_class ) _sc\n        inner join __prepare_filter _f on _sc.column_name = _f.filter_column\n  ), __group_where as (\n    select\n        _pr.filter_key,\n        string_agg(\n            case\n              when  _pr.is_array then format( '%s %s %s', args, filter_opr, column_exp )\n              else format( '%s %s %s', column_exp, filter_opr, args )\n              end, e',\n            '\n          ) as expression\n      from __prepare_where _pr\n      group by _pr.filter_key\n  ) select\n        count( * ) as counts,\n        string_agg(\n          format( e'true in ( \n%s )', _pr.expression )\n          , e'\n          and '\n\n        ) as expression\n        into _where\n      from __group_where _pr\n  ;\n\n  __prepare_where.selected := _selected;\n  __prepare_where.expression := _where.expression;\n  __prepare_where.counts := _where.counts;\n  return next;\nend;\n$$;\n\ndrop function if exists report.__rownumber_of( text );\ncreate or replace function report.__rownumber_of( text )\nreturns text\nimmutable\nlanguage sql as $$ select format('\\:$( %s ):#ROW_NUMBER', $1 ) $$;\n\ndrop function if exists  report.__prepare_wf( report jsonb );\ncreate or replace function report.__prepare_wf( report jsonb )\nreturns table( counts int8, expression text )\nimmutable\nlanguage plpgsql as $$\ndeclare\n  _columns record;\n  _aggregates record;\n  _wfunction record;\n  _wf_keys text[] default array( select e.text from jsonb_array_elements_text( report->'windows_function_key' )e( text));\nbegin\n\n  if coalesce( array_length( _wf_keys, 1 ), 0 ) = 0  then\n    _wf_keys := array [ 'sum' ]::text[];\n  end if;\n  select * into _columns from report.__prepare_column( report );\n  select * into _aggregates from report.__prepare_aggregate( report );\n\n  -- WINDOWS FUNCTIONS\n  with  __columns as (\n      select\n        e.element->>'format' as format,\n        coalesce( e.element->>'rename', e.element->>'_reduce_name' ) as "rename"\n      from unnest( _columns.selected || _aggregates.selected || jsonb_build_object(\n        'rename', '*',\n        'format', '*'\n      )) e( element )\n  ), __expression as (\n      select\n        format( '%s:%s', _c.rename, _wf.key ) as name,\n        format( _wf.over, case when _c.rename = '*' then '*' else format( '%I', _c.rename ) end, report.__rownumber_of( _c.rename ) ) as expression\n        from __columns _c\n          inner join report.agg _wf on _c.format = any( _wf.types )\n            and true in ( _wf.key = any( _wf_keys ), _c.rename = '*' )\n            and _wf.over is not null\n  )  select\n        string_agg( format( '%L, %s', _exp.name, _exp.expression ), e',\n            ' ) as expression,\n        count( * ) as counts\n        into _wfunction\n      from __expression _exp\n  ;\n\n  __prepare_wf.counts := _wfunction.counts;\n  __prepare_wf.expression := _wfunction.expression;\n  return next ;\nend;\n$$;\n\ndrop function if exists report.reduce_name(  text );\ncreate or replace function report.reduce_name(  text )\nreturns text immutable language sql as $$\n  select format( '\\:%s', $1 )\n$$;\n\n\ndrop function if exists  report.__prepare_column( report jsonb );\ncreate or replace function report.__prepare_column( report jsonb )\nreturns table(\n  expression text,\n  expression_map jsonb,\n  counts int8,\n  selected jsonb[],\n  reduces text[],\n  reduces_counts int8,\n  reduces_map jsonb,\n  reduces_expression text,\n  groupby_expression text,\n  exports text[],\n  exports_reduce text[],\n  exports_representation text[],\n  exports_expression text\n)\nimmutable\nlanguage plpgsql as $$\ndeclare\n  __selected jsonb[];\n  _formattable record;\n  _columns record;\n  _source record;\nbegin\n  select * into _source from report.source_map( (report->>'source' )::regclass );\n\n  select * into _formattable from report.__formattable() f( types );\n\n  select array_agg( coalesce( rc.element, jsonb_build_object() ) || e.doc || jsonb_build_object(\n      '_reduce_name',  report.reduce_name( rc.element->>'column' )\n    )) into __selected\n    from jsonb_array_elements( report->'columns' ) with ordinality e( doc )\n      inner join report.vcolumns( report ) rc( element ) on rc.element->>'column' = e.doc->>'column'\n        and rc.element->>'key' = e.doc->>'key'\n        and rc.element->>'type' = 'column'\n  ;\n\n  -- COLUMNS\n  with __representation as (\n    select *,\n        true as representation,\n        false as reduce\n       from report.columns( _source.source_class )\n    union all\n      select *,\n          false as representation,\n          true as reduce\n         from report.columns( _source.source_class )\n  ), __columns as (\n    select\n        e.doc->>'column' as column_name,\n        e.doc->>'order' as column_order,\n        e.doc->>'mask' as column_mask,\n        e.doc->>'format' as column_formattype,\n        e.doc->>'_reduce_name' as _reduce_name,\n        e.ordinality\n      from unnest( __selected ) with ordinality e( doc )\n  ), __prepare_columns as (\n    select\n        _rp.column_name as _original_column_name,\n        format( '%I', _rp.column_name ) as column_name,\n         format( '%I', _c._reduce_name ) as column_reduce,\n        _c._reduce_name,\n        _rp.reduce,\n        _rp.representation,\n        case\n          when _rp.reduce then 2\n          else 1\n        end as ___priority,\n        case\n          when _rp.column_type = any( _formattable.types ) and _c.column_mask is not null and _rp.reduce then format( 'report.__mask_reduce( %I::%s, %L, %L )',  _rp.column_name, _rp.column_type, column_formattype, _c.column_mask )\n          when _rp.column_type = any( _formattable.types ) and _c.column_mask is not null and _rp.representation then format( 'report.__mask( %I::%s, %L, %L, %L )', _rp.column_name, _rp.column_type, column_formattype, _c.column_mask, _rp.representation )\n          else format( '%I', _rp.column_name )\n        end as expression,\n        _c.ordinality\n      from __representation _rp\n        inner join __columns _c on _rp.column_name = _c.column_name\n  ) select\n      count( pc.column_name ) as counts,\n      string_agg( format( '%s', pc.expression ), e',\n          'order by pc.___priority, pc.ordinality ) as columns,\n      string_agg( pc.column_reduce, ', '  ) filter ( where pc.reduce ) reduces_expression,\n      array_agg( pc._original_column_name ) filter ( where pc.reduce ) reduces,\n      jsonb_object_agg( pc._original_column_name, pc._reduce_name  ) filter ( where pc.reduce ) reduces_map,\n\n      count( * )  filter ( where pc.reduce ) reduces_counts,\n      string_agg( format( '%s as %s', pc.expression,\n        case\n          when pc.reduce then pc.column_reduce\n          else pc.column_name\n        end ), e',\n          ' order by pc.___priority, pc.ordinality ) as expression,\n      jsonb_object_agg( case when pc.reduce then pc._reduce_name else pc._original_column_name end, jsonb_build_object(\n        'expression', pc.expression,\n        'reduce', pc.reduce,\n        'representation', pc.representation,\n        'reduce_name', pc._reduce_name,\n        'column_name', pc._original_column_name\n      )) as expression_map,\n      array_agg( case when pc.reduce then pc._reduce_name else pc._original_column_name end ) as exports,\n      array_agg( pc._reduce_name ) filter ( where pc.reduce )as exports_reduce,\n      array_agg( pc._original_column_name ) filter ( where pc.representation )as exports_representation,\n      string_agg( case when pc.reduce then pc.column_reduce else pc.column_name end, ', ') as exports_expresssion,\n      string_agg( format( '%s', pc.expression ), e',\n          ' order by pc.___priority, pc.ordinality ) filter ( where true in ( pc.reduce, pc.representation) ) as groupby_expression\n      into _columns\n    from __prepare_columns pc\n  ;\n\n  __prepare_column.selected := __selected;\n  __prepare_column.counts := _columns.counts;\n  __prepare_column.expression := _columns.expression;\n  __prepare_column.expression_map := _columns.expression_map;\n  __prepare_column.reduces := _columns.reduces;\n  __prepare_column.reduces_map := _columns.reduces_map;\n  __prepare_column.reduces_counts := _columns.reduces_counts;\n  __prepare_column.reduces_expression := _columns.reduces_expression;\n  __prepare_column.groupby_expression := _columns.groupby_expression;\n  __prepare_column.exports := _columns.exports;\n  __prepare_column.exports_reduce := _columns.exports_reduce;\n  __prepare_column.exports_representation := _columns.exports_representation;\n  __prepare_column.exports_expression := _columns.exports_expresssion;\n  return next;\nend;\n$$;\n\n\ncreate or replace function report.__prepare_row_number( report jsonb )\nreturns table( counts int8, expression text, exports_expression text, exports_rownumber text[] )\nimmutable\nlanguage plpgsql as $$\ndeclare\n  _columns record;\n  _aggregate record;\n  _rn record;\nbegin\n  select * into _aggregate\n    from report.__prepare_aggregate( report );\n\n  select * into _columns\n    from report.__prepare_column( report );\n\n  with __exports as (\n    select\n        e.export,\n        report.__rownumber_of( e.export ) as row_numbername,\n        format( 'row_number() over ( partition by %I )', e.export ) as row_expression\n      from unnest( _columns.exports_reduce || _aggregate.exports_rename ) e( export )\n  ) select\n        count( * ) as counts,\n        string_agg( format( '%s as %I', row_expression, row_numbername), e',\n            ' ) as expression,\n        array_agg( row_numbername ) as exports_rownumber,\n        string_agg( format('%I', row_numbername ), ', ') as exports_expression\n        into _rn\n      from __exports;\n\n  __prepare_row_number.expression := _rn.expression;\n  __prepare_row_number.counts := _rn.counts;\n  __prepare_row_number.exports_rownumber := _rn.exports_rownumber;\n  __prepare_row_number.exports_expression := _rn.exports_expression;\n  return next;\nend;\n$$;\n\n\ndrop function if exists report.__prepare( report jsonb );\ncreate or replace function report.__prepare( report jsonb )\nreturns setof text\n  immutable\n  language plpgsql\nas\n$body_report_prepare$\ndeclare\n  /**\n    report := {\n      source: view|table\n      _branch_uid: BRANCH-UID\n      windows_function_key: [sum | avg | max | min | count | count::distinct],\n      with_reduce?:boolean\n      with_column_row_number?:boolean\n      orders: [{\n        *column: "COLUMN" value para coluna | "RENAME" value para o grupo,\n        orientation?: "asc" | "desc" (default "first",\n        nulls?: "last" | "first" (default "last" ),\n        priority? number-level\n      }],\n\n      columns: [{\n        column:COLUMN,\n        format?: YYYY | YYYY-MM | YYYY-MM-DD | YYYY-MM-DD HH:MI\n      }]\n      filters: [{\n        column: src.COL-NAME,\n        opr: =|<|>|<=|>=|like\n        mode?: default|right\n        value: VALUE-FILTER\n      }],\n      groups:[{\n        column: src.COL-NAME\n        func: count|sum|max|min|avg\n        rename: NEW-NAME\n      }]\n    }\n   */\n  _orders record;\n  _columns record;\n  _rownumber record;\n  _aggregate record;\n  _windows record;\n  _statement text;\n  _where record;\n  _source record;\n  _formattable record;\nbegin\n  select * into _source from report.source_map( (report->>'source' )::regclass );\n  select * into _formattable from report.__formattable() f( types );\n  select * into _columns from report.__prepare_column( report );\n  select * into _aggregate from report.__prepare_aggregate( report );\n  select * into _rownumber from report.__prepare_row_number( report );\n  select * into _where from report.__prepare_where( report );\n  select * into _windows from report.__prepare_wf( report );\n  select * into _orders from report.__prepare_order( report, _columns.selected, _aggregate.selected );\n\n  --language=PostgreSQL\n  _statement := $sql$\n    with \n    __report_fixe ( "$_*_fixed") as (\n      values(1)\n    ), __report_engine as (\n      select\n          '(__$report__columns_expression)'\n          '(__$report_aggregate_expression)'\n        from '(select * from __$report_source)'\n        where _branch_uid = $1\n          and '(__$report_where)'\n        group by '(__$report_group_by)'\n    ), __distinct as (\n      select pr.*, '(__$report_row_number_expression)' as "$ROW-NUMBER"\n        from __report_engine pr\n    ), __windows as (\n        select _re.*,\n          jsonb_build_object(\n            '(__$report_windows_functions)'\n          ) as "*_$"\n          from __report_fixe _rf\n            left join __distinct _re on true\n          order by '(__$report_order_by)'\n          limit $2\n          offset $3\n    ) select to_json( _w )\n        from __windows _w\n  $sql$;\n\n\n  _statement := replace( _statement, $$'(select * from __$report_source)'$$, _source.source_format );\n  if _columns.counts > 0 then\n    _statement := replace( _statement, $$'(__$report__columns_expression)'$$, format( '%s', _columns.expression ) );\n  else\n    _statement := replace( _statement, $$'(__$report__columns_expression)'$$, '' );\n  end if;\n\n  if _columns.counts > 0 and _aggregate.counts >0 then\n    _statement := replace( _statement, $$'(__$report_aggregate_expression)'$$, format( ', %s', _aggregate.expression ) );\n  elsif _aggregate.counts > 0 then\n    _statement := replace( _statement, $$'(__$report_aggregate_expression)'$$, format( '%s', _aggregate.expression ) );\n  else\n    _statement := replace( _statement, $$'(__$report_aggregate_expression)'$$, format( '%s', '' ) );\n  end if;\n\n\n  if _where.counts > 0 then\n    _statement := replace( _statement, $$'(__$report_where)'$$, _where.expression );\n  else\n    _statement := replace( _statement, $$and '(__$report_where)'$$, '' );\n  end if;\n\n  if _rownumber.expression is null then\n    raise exception 'Row Number Is NUll';\n  end if;\n\n  if _rownumber.counts > 0 then\n    _statement := replace( _statement, $$'(__$report_row_number_expression)' as "$ROW-NUMBER"$$, _rownumber.expression );\n  else\n    _statement := replace( _statement, $$, '(__$report_row_number_expression)' as "$ROW-NUMBER"$$, '' );\n  end if;\n\n  if _columns.counts > 0 and _aggregate.counts > 0 then\n    _statement := replace( _statement, $$'(__$report_group_by)'$$, _columns.groupby_expression );\n  else\n    _statement := replace( _statement, $$group by '(__$report_group_by)'$$, '' );\n  end if;\n\n  if _orders.counts > 0 then\n    _statement := replace( _statement, $$'(__$report_order_by)'$$, _orders.expression );\n  else\n    _statement := replace( _statement, $$order by '(__$report_order_by)'$$, '' );\n  end if;\n\n  if _windows.counts > 0 then\n    _statement := replace( _statement, $s$'(__$report_windows_functions)'$s$, _windows.expression );\n  else\n    _statement := replace( _statement, $s$'(__$report_windows_functions)'$s$, '' );\n  end if;\n\n  select string_agg( e.line, e'\n' ) into _statement\n    from regexp_split_to_table( _statement, e'\n' ) e( line )\n    where length( trim( e.line ) ) > 0\n  ;\n  _statement := trim( _statement );\n  return next _statement;\nend;\n$body_report_prepare$;\n\n	drop function if exists report.__formattable(); create or replace function report.__formattable() returns text[] immutable language sql as $$ select array_agg( distinct te.name ) from report.talias ta inner join unnest(( ta.alias|| ta.type) ) te( name ) on true where ( ta.alias|| ta.type) && array[ 'date', 'timestamp', 'timestamptz' ]::text[]; $$; drop function if exists report.__prepare_order( report jsonb ); create or replace function report.__prepare_order( report jsonb, columns jsonb[], aggregates jsonb[] ) returns table( counts int8, expression text, selected jsonb[] ) immutable language plpgsql as $$ declare _orders record; _source record; _selected jsonb[]; _formattable record; begin select * into _source from report.source_map( (report->>'source' )::regclass ); select * into _formattable from report.__formattable() f( types ); with __orders as ( select e.element, ( e.element->>'priority' )::int as priority, e.ordinality as ordinality from jsonb_array_elements( report->'orders' ) with ordinality e( element ) ) select array_agg( e.element order by e.priority desc nulls last, e.ordinality ) as orders into _selected from __orders e ; if( coalesce( array_length( _selected, 1 ), 0 ) ) = 0 then with __columns as ( select e.element->>'column' as "column", e.element->>'rename' as rename, e.element->>'type' as "type", e.ordinality, -- Prioridade igual a ordem reverva, quanto maoir for a ordem posicional menor a prioridade e.ordinality * -1 as priority from unnest( columns || aggregates ) with ordinality e ( element ) ), __orders as ( select case when cc.type = 'group' then cc.rename when cc.type = 'column' then cc.column end as "column", 'asc' as "orientation", 'last' as "nulls", cc.ordinality, cc.priority from __columns cc order by cc.ordinality ) select array_agg( to_jsonb( o ) order by o.priority desc nulls last, o.ordinality) as orders into _selected from __orders o where o."column" is not null ; end if; with __orders as ( select case when ( sc."column"->>'mask' ) is not null and c.column_type = any( _formattable.types ) then format( '\\:%s', c.column_name ) else c.column_name end as "column", (o."order"->>'priority')::int as "priority", coalesce( lib.str_normalize( o."order"->>'orientation' ), 'asc' ) as "orientation", coalesce( lib.str_normalize( o."order"->>'nulls' ), 'last' ) as "nulls", o.ordinality from report.columns( _source.source_class ) c inner join unnest( _selected ) with ordinality o( "order" ) on c.column_name = o."order"->>'column' inner join unnest( columns ) sc( "column" ) on o."order"->>'column' = sc."column"->>'column' and sc."column"->>'column' = c.column_name ) select string_agg( format( '%I %s nulls %s', o."column", o.orientation, o.nulls ), e', ' order by o.priority desc nulls last, o.ordinality ) as expression, count( * ) as counts into _orders from __orders o where o.orientation in ( 'asc', 'desc') and o.nulls in ( 'last', 'first' ) ; __prepare_order.counts := _orders.counts; __prepare_order.expression := _orders.expression; __prepare_order.selected := _selected; return next; end; $$; drop function if exists report.__prepare_aggregate( report jsonb ); create or replace function report.__prepare_aggregate( report jsonb ) returns table( counts int8, expression text, selected jsonb[], exports_expression text, exports_rename text[] ) immutable language plpgsql as $$ declare _source record; _aggregate record; _selected jsonb[]; begin select * into _source from report.source_map( (report->>'source' )::regclass ); select array_agg( coalesce( rc.element, jsonb_build_object() ) || e.doc ) into _selected from jsonb_array_elements( report->'groups' ) with ordinality e( doc ) left join report.vcolumns( report ) rc( element ) on rc.element->>'column' = e.doc->>'column' and rc.element->>'key' = e.doc->>'key' and rc.element->>'type' = 'group' ; with __group as ( select e.doc->>'column' as group_column, e.doc->>'mode' as group_mode, e.doc->>'func' as group_func, e.doc->>'rename' as group_rename, e.doc->>'expression' as group_expression, e.doc->>'column_position' as column_position, e.doc->>'priority' as group_priority from unnest( _selected ) e( doc ) ), __prepare_group as ( select g.* from __group g where g.group_func is not null ), __prepare_group_by as ( select _sc.*, _g.* from report.columns( _source.source_class ) _sc inner join __prepare_group _g on _sc.column_name = _g.group_column ) select count( * ) as counts, string_agg( agg.group_expression, e', ' order by agg.column_position desc nulls last, agg.group_priority ) as expression, string_agg( format( '%I', agg.group_rename ), ', ' ) as exports_expression, array_agg( agg.group_rename ) as exports_rename into _aggregate from __prepare_group_by agg ; __prepare_aggregate.counts := _aggregate.counts; __prepare_aggregate.expression := _aggregate.expression; __prepare_aggregate.selected := _selected; __prepare_aggregate.exports_rename := _aggregate.exports_rename; __prepare_aggregate.exports_expression := _aggregate.exports_expression; return next; end; $$; drop function if exists report.__prepare_where( report jsonb ); create or replace function report.__prepare_where( report jsonb ) returns table( counts int8, expression text, selected jsonb[] ) immutable language plpgsql as $$ declare _source record; _where record; _selected jsonb[]; begin select * into _source from report.source_map( (report->>'source' )::regclass ); select array_agg( coalesce( rc.element, jsonb_build_object() ) || e.doc ) into _selected from jsonb_array_elements( report->'filters' ) with ordinality e( doc ) left join report.vcolumns( report ) rc( element ) on rc.element->>'column' = e.doc->>'column' and rc.element->>'key' = e.doc->>'key' and rc.element->>'type' = 'filter' ; -- FILTERS with __filters as ( select e.doc->>'column' as filter_column, coalesce( e.doc->>'opr', '=' ) as filter_opr, coalesce( e.doc->>'mode', 'default' ) as filter_oprmode, e.doc->>'value' as filter_value, e.doc->>'key' as filter_key from unnest( _selected ) e( doc ) ), __prepare_filter as ( select _f.filter_column, _f.filter_opr, _f.filter_oprmode, _f.filter_key, case when lower( _f.filter_opr ) = 'like' and _f.filter_oprmode = 'default' then format( '%s%s%s', '%', lower( _f.filter_value ), '%' ) when lower( _f.filter_opr ) = 'like' and _f.filter_oprmode = 'right' then format( '%s%s', lower( _f.filter_value ), '%') else filter_value end as filter_value from __filters _f ), __prepare_where as ( select case when _sc.is_array then format( 'any( %I )', _sc.column_name) when _f.filter_opr = 'like' then format( 'lower( %I )::text', _sc.column_name ) else format( '%I', _sc.column_name ) end as column_exp, case when _sc.is_array then format( '(%L)::%s', _f.filter_value, _sc.column_basetype ) when _f.filter_opr = 'like' then format( '(%L)::text', _f.filter_value ) else format( '(%L)::%s', _f.filter_value, _sc.column_type ) end as args, _sc.*, _f.* from report.columns( _source.source_class ) _sc inner join __prepare_filter _f on _sc.column_name = _f.filter_column ), __group_where as ( select _pr.filter_key, string_agg( case when _pr.is_array then format( '%s %s %s', args, filter_opr, column_exp ) else format( '%s %s %s', column_exp, filter_opr, args ) end, e', ' ) as expression from __prepare_where _pr group by _pr.filter_key ) select count( * ) as counts, string_agg( format( e'true in ( %s )', _pr.expression ) , e' and ' ) as expression into _where from __group_where _pr ; __prepare_where.selected := _selected; __prepare_where.expression := _where.expression; __prepare_where.counts := _where.counts; return next; end; $$; drop function if exists report.__rownumber_of( text ); create or replace function report.__rownumber_of( text ) returns text immutable language sql as $$ select format('\\:$( %s ):#ROW_NUMBER', $1 ) $$; drop function if exists report.__prepare_wf( report jsonb ); create or replace function report.__prepare_wf( report jsonb ) returns table( counts int8, expression text ) immutable language plpgsql as $$ declare _columns record; _aggregates record; _wfunction record; _wf_keys text[] default array( select e.text from jsonb_array_elements_text( report->'windows_function_key' )e( text)); begin if coalesce( array_length( _wf_keys, 1 ), 0 ) = 0 then _wf_keys := array [ 'sum' ]::text[]; end if; select * into _columns from report.__prepare_column( report ); select * into _aggregates from report.__prepare_aggregate( report ); -- WINDOWS FUNCTIONS with __columns as ( select e.element->>'format' as format, coalesce( e.element->>'rename', e.element->>'_reduce_name' ) as "rename" from unnest( _columns.selected || _aggregates.selected || jsonb_build_object( 'rename', '*', 'format', '*' )) e( element ) ), __expression as ( select format( '%s:%s', _c.rename, _wf.key ) as name, format( _wf.over, case when _c.rename = '*' then '*' else format( '%I', _c.rename ) end, report.__rownumber_of( _c.rename ) ) as expression from __columns _c inner join report.agg _wf on _c.format = any( _wf.types ) and true in ( _wf.key = any( _wf_keys ), _c.rename = '*' ) and _wf.over is not null ) select string_agg( format( '%L, %s', _exp.name, _exp.expression ), e', ' ) as expression, count( * ) as counts into _wfunction from __expression _exp ; __prepare_wf.counts := _wfunction.counts; __prepare_wf.expression := _wfunction.expression; return next ; end; $$; drop function if exists report.reduce_name( text ); create or replace function report.reduce_name( text ) returns text immutable language sql as $$ select format( '\\:%s', $1 ) $$; drop function if exists report.__prepare_column( report jsonb ); create or replace function report.__prepare_column( report jsonb ) returns table( expression text, expression_map jsonb, counts int8, selected jsonb[], reduces text[], reduces_counts int8, reduces_map jsonb, reduces_expression text, groupby_expression text, exports text[], exports_reduce text[], exports_representation text[], exports_expression text ) immutable language plpgsql as $$ declare __selected jsonb[]; _formattable record; _columns record; _source record; begin select * into _source from report.source_map( (report->>'source' )::regclass ); select * into _formattable from report.__formattable() f( types ); select array_agg( coalesce( rc.element, jsonb_build_object() ) || e.doc || jsonb_build_object( '_reduce_name', report.reduce_name( rc.element->>'column' ) )) into __selected from jsonb_array_elements( report->'columns' ) with ordinality e( doc ) inner join report.vcolumns( report ) rc( element ) on rc.element->>'column' = e.doc->>'column' and rc.element->>'key' = e.doc->>'key' and rc.element->>'type' = 'column' ; -- COLUMNS with __representation as ( select *, true as representation, false as reduce from report.columns( _source.source_class ) union all select *, false as representation, true as reduce from report.columns( _source.source_class ) ), __columns as ( select e.doc->>'column' as column_name, e.doc->>'order' as column_order, e.doc->>'mask' as column_mask, e.doc->>'format' as column_formattype, e.doc->>'_reduce_name' as _reduce_name, e.ordinality from unnest( __selected ) with ordinality e( doc ) ), __prepare_columns as ( select _rp.column_name as _original_column_name, format( '%I', _rp.column_name ) as column_name, format( '%I', _c._reduce_name ) as column_reduce, _c._reduce_name, _rp.reduce, _rp.representation, case when _rp.reduce then 2 else 1 end as ___priority, case when _rp.column_type = any( _formattable.types ) and _c.column_mask is not null and _rp.reduce then format( 'report.__mask_reduce( %I::%s, %L, %L )', _rp.column_name, _rp.column_type, column_formattype, _c.column_mask ) when _rp.column_type = any( _formattable.types ) and _c.column_mask is not null and _rp.representation then format( 'report.__mask( %I::%s, %L, %L, %L )', _rp.column_name, _rp.column_type, column_formattype, _c.column_mask, _rp.representation ) else format( '%I', _rp.column_name ) end as expression, _c.ordinality from __representation _rp inner join __columns _c on _rp.column_name = _c.column_name ) select count( pc.column_name ) as counts, string_agg( format( '%s', pc.expression ), e', 'order by pc.___priority, pc.ordinality ) as columns, string_agg( pc.column_reduce, ', ' ) filter ( where pc.reduce ) reduces_expression, array_agg( pc._original_column_name ) filter ( where pc.reduce ) reduces, jsonb_object_agg( pc._original_column_name, pc._reduce_name ) filter ( where pc.reduce ) reduces_map, count( * ) filter ( where pc.reduce ) reduces_counts, string_agg( format( '%s as %s', pc.expression, case when pc.reduce then pc.column_reduce else pc.column_name end ), e', ' order by pc.___priority, pc.ordinality ) as expression, jsonb_object_agg( case when pc.reduce then pc._reduce_name else pc._original_column_name end, jsonb_build_object( 'expression', pc.expression, 'reduce', pc.reduce, 'representation', pc.representation, 'reduce_name', pc._reduce_name, 'column_name', pc._original_column_name )) as expression_map, array_agg( case when pc.reduce then pc._reduce_name else pc._original_column_name end ) as exports, array_agg( pc._reduce_name ) filter ( where pc.reduce )as exports_reduce, array_agg( pc._original_column_name ) filter ( where pc.representation )as exports_representation, string_agg( case when pc.reduce then pc.column_reduce else pc.column_name end, ', ') as exports_expresssion, string_agg( format( '%s', pc.expression ), e', ' order by pc.___priority, pc.ordinality ) filter ( where true in ( pc.reduce, pc.representation) ) as groupby_expression into _columns from __prepare_columns pc ; __prepare_column.selected := __selected; __prepare_column.counts := _columns.counts; __prepare_column.expression := _columns.expression; __prepare_column.expression_map := _columns.expression_map; __prepare_column.reduces := _columns.reduces; __prepare_column.reduces_map := _columns.reduces_map; __prepare_column.reduces_counts := _columns.reduces_counts; __prepare_column.reduces_expression := _columns.reduces_expression; __prepare_column.groupby_expression := _columns.groupby_expression; __prepare_column.exports := _columns.exports; __prepare_column.exports_reduce := _columns.exports_reduce; __prepare_column.exports_representation := _columns.exports_representation; __prepare_column.exports_expression := _columns.exports_expresssion; return next; end; $$; create or replace function report.__prepare_row_number( report jsonb ) returns table( counts int8, expression text, exports_expression text, exports_rownumber text[] ) immutable language plpgsql as $$ declare _columns record; _aggregate record; _rn record; begin select * into _aggregate from report.__prepare_aggregate( report ); select * into _columns from report.__prepare_column( report ); with __exports as ( select e.export, report.__rownumber_of( e.export ) as row_numbername, format( 'row_number() over ( partition by %I )', e.export ) as row_expression from unnest( _columns.exports_reduce || _aggregate.exports_rename ) e( export ) ) select count( * ) as counts, string_agg( format( '%s as %I', row_expression, row_numbername), e', ' ) as expression, array_agg( row_numbername ) as exports_rownumber, string_agg( format('%I', row_numbername ), ', ') as exports_expression into _rn from __exports; __prepare_row_number.expression := _rn.expression; __prepare_row_number.counts := _rn.counts; __prepare_row_number.exports_rownumber := _rn.exports_rownumber; __prepare_row_number.exports_expression := _rn.exports_expression; return next; end; $$; drop function if exists report.__prepare( report jsonb ); create or replace function report.__prepare( report jsonb ) returns setof text immutable language plpgsql as $body_report_prepare$ declare /** report := { source: view|table _branch_uid: BRANCH-UID windows_function_key: [sum | avg | max | min | count | count::distinct], with_reduce?:boolean with_column_row_number?:boolean orders: [{ *column: "COLUMN" value para coluna | "RENAME" value para o grupo, orientation?: "asc" | "desc" (default "first", nulls?: "last" | "first" (default "last" ), priority? number-level }], columns: [{ column:COLUMN, format?: YYYY | YYYY-MM | YYYY-MM-DD | YYYY-MM-DD HH:MI }] filters: [{ column: src.COL-NAME, opr: =|<|>|<=|>=|like mode?: default|right value: VALUE-FILTER }], groups:[{ column: src.COL-NAME func: count|sum|max|min|avg rename: NEW-NAME }] } */ _orders record; _columns record; _rownumber record; _aggregate record; _windows record; _statement text; _where record; _source record; _formattable record; begin select * into _source from report.source_map( (report->>'source' )::regclass ); select * into _formattable from report.__formattable() f( types ); select * into _columns from report.__prepare_column( report ); select * into _aggregate from report.__prepare_aggregate( report ); select * into _rownumber from report.__prepare_row_number( report ); select * into _where from report.__prepare_where( report ); select * into _windows from report.__prepare_wf( report ); select * into _orders from report.__prepare_order( report, _columns.selected, _aggregate.selected ); --language=PostgreSQL _statement := $sql$ with __report_fixe ( "$_*_fixed") as ( values(1) ), __report_engine as ( select '(__$report__columns_expression)' '(__$report_aggregate_expression)' from '(select * from __$report_source)' where _branch_uid = $1 and '(__$report_where)' group by '(__$report_group_by)' ), __distinct as ( select pr.*, '(__$report_row_number_expression)' as "$ROW-NUMBER" from __report_engine pr ), __windows as ( select _re.*, jsonb_build_object( '(__$report_windows_functions)' ) as "*_$" from __report_fixe _rf left join __distinct _re on true order by '(__$report_order_by)' limit $2 offset $3 ) select to_json( _w ) from __windows _w $sql$; _statement := replace( _statement, $$'(select * from __$report_source)'$$, _source.source_format ); if _columns.counts > 0 then _statement := replace( _statement, $$'(__$report__columns_expression)'$$, format( '%s', _columns.expression ) ); else _statement := replace( _statement, $$'(__$report__columns_expression)'$$, '' ); end if; if _columns.counts > 0 and _aggregate.counts >0 then _statement := replace( _statement, $$'(__$report_aggregate_expression)'$$, format( ', %s', _aggregate.expression ) ); elsif _aggregate.counts > 0 then _statement := replace( _statement, $$'(__$report_aggregate_expression)'$$, format( '%s', _aggregate.expression ) ); else _statement := replace( _statement, $$'(__$report_aggregate_expression)'$$, format( '%s', '' ) ); end if; if _where.counts > 0 then _statement := replace( _statement, $$'(__$report_where)'$$, _where.expression ); else _statement := replace( _statement, $$and '(__$report_where)'$$, '' ); end if; if _rownumber.expression is null then raise exception 'Row Number Is NUll'; end if; if _rownumber.counts > 0 then _statement := replace( _statement, $$'(__$report_row_number_expression)' as "$ROW-NUMBER"$$, _rownumber.expression ); else _statement := replace( _statement, $$, '(__$report_row_number_expression)' as "$ROW-NUMBER"$$, '' ); end if; if _columns.counts > 0 and _aggregate.counts > 0 then _statement := replace( _statement, $$'(__$report_group_by)'$$, _columns.groupby_expression ); else _statement := replace( _statement, $$group by '(__$report_group_by)'$$, '' ); end if; if _orders.counts > 0 then _statement := replace( _statement, $$'(__$report_order_by)'$$, _orders.expression ); else _statement := replace( _statement, $$order by '(__$report_order_by)'$$, '' ); end if; if _windows.counts > 0 then _statement := replace( _statement, $s$'(__$report_windows_functions)'$s$, _windows.expression ); else _statement := replace( _statement, $s$'(__$report_windows_functions)'$s$, '' ); end if; select string_agg( e.line, e' ' ) into _statement from regexp_split_to_table( _statement, e' ' ) e( line ) where length( trim( e.line ) ) > 0 ; _statement := trim( _statement ); return next _statement; end; $body_report_prepare$;
7ec4be50-b385-4303-9c33-2eeef018b2ed	\n\ndrop function if exists report.report(report jsonb );\ndrop function if exists report.engine(report jsonb );\ncreate or replace function report.engine(report jsonb )\nreturns SETOF json\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    report := {\n      _branch_uid: BRANCH\n      limit?: int\n      offset?: int\n      source: view|table\n      columns: [ COL1, COL2, COL3 ]\n      filters: [{\n        column: src.COL-NAME,\n        opr: =|<|>|<=|>=|like\n        mode?: default|right\n        value: VALUE-FILTER\n      }],\n      groups:[{\n        column: src.COL-NAME\n        func: count|sum|max|min|avg\n        rename: NEW-NAME\n      }]\n    }\n   */\n  _limit int8 default report->>'limit';\n  _offset int8 default report->>'offset';\n  ___branch uuid default report->>'_branch_uid';\n  _next record;\nbegin\n  for _next in select * from report.__prepare( report ) n( statement ) loop\n      raise notice 'REPORT %', report;\n      raise notice e'REPORT:STATEMENT \n%', _next.statement;\n      return query execute _next.statement using ___branch, _limit, _offset;\n  end loop;\nend;\n$$;\n\n\n\ndrop function if exists report.report_formats(anyelement, type text, format text, representation boolean);\ndrop function if exists report.__mask(anyelement, type text, format text, representation boolean);\n\ncreate or replace function report.__mask( anyelement, type text, format text, representation boolean default false )\nreturns text\nimmutable strict\nlanguage plpgsql as $body$\n<<func>>\ndeclare\n  _format report.mask;\n  mouth_group double precision;\n  base int;\nbegin\n  representation := coalesce( representation, false );\n  select * into _format\n    from report.mask rf\n    where rf.mask = __mask.format\n      and __mask.type = any( rf.type );\n\n  if _format.mask is null then return null; end if;\n\n  -- to_char\n  if lower( _format.function ) = 'to_char' then\n    return to_char( $1, case\n      when representation then _format.representation\n      else _format.mask\n    end);\n  end if;\n\n  if lower( _format.function ) = 'mouth_group' then\n    mouth_group := extract( months from $1 ) / ( 12.0 / _format.mask::double precision);\n    base := case\n      when mouth_group::int < mouth_group then  mouth_group::int+1\n      else mouth_group::int\n    end;\n    return to_char( $1,\n      case when representation then format( '%I%I"º" YYYY', _format.representation, base )\n           else format( 'YYYY %I%I', _format.representation, base )\n      end);\n  end if;\nend;\n$body$;\n\n\n\ncreate or replace function report.__mask_reduce( anyelement, type text, format text )\nreturns anyelement\nimmutable strict\nlanguage plpgsql as $body$\n<<func>>\ndeclare\n  _format report.mask;\n  _types record;\n  mouth_group double precision;\n  base int;\n  _month int;\n  _year int;\nbegin\n  select * into _format\n    from report.mask rf\n    where rf.mask = __mask_reduce.format\n      and __mask_reduce.type = any( rf.type );\n\n  select * into _types\n    from report.talias ta\n    where __mask_reduce.type = any( ta.alias )\n  ;\n\n  if _format.mask is null then return null; end if;\n\n  -- to_char\n  if lower( _format.function ) = 'to_char' then\n    case\n      when 'date' = any( _types.alias ) then return to_date( to_char( $1, _format.mask ), _format.mask );\n      when 'timestamp' = any( _types.alias ) then return to_timestamp( to_char( $1, _format.mask ), _format.mask );\n      when 'timestamptz' = any( _types.alias ) then return to_timestamp( to_char( $1, _format.mask ), _format.mask )::timestamptz;\n      else return $1;\n    end case;\n  end if;\n\n  if lower( _format.function ) = 'mouth_group' then\n    mouth_group := extract( months from $1 ) / ( 12.0 / _format.mask::double precision);\n    base := case\n      when mouth_group::int < mouth_group then  mouth_group::int+1\n      else mouth_group::int\n    end;\n    _month := base * ( 12.0 / _format.mask::double precision )-( 12.0 / _format.mask::double precision)+1;\n    _year := extract( year from $1 );\n    case\n      when 'date' = any( _types.alias ) then return make_date( _year, _month, 1 );\n      when 'timestamp' = any( _types.alias ) then return make_timestamp( _year, _month, 1, 0, 0, 0 );\n      when 'timestamptz' = any( _types.alias ) then return make_timestamptz( _year, _month, 1, 0, 0, 0, to_char( $1, 'tz' ) );\n    end case;\n  end if;\nend;\n$body$;\n\ndrop table if exists tweeks.repconf;\ndrop function if exists tweeks.report_formats_of(args jsonb);\ndrop view if exists tweeks.vreport_balanco;\ndrop view if exists tweeks.vreport_caixa;\ndrop view if exists tweeks.vreport_conta;\ndrop view if exists tweeks.vreport_fatura;\ndrop view if exists tweeks.vreport_fluxo;\ndrop view if exists tweeks.vreport_imposto;\ndrop view if exists tweeks.vreport_venda;\n\ndrop table if exists report;\ndrop table if exists reportagg;\ndrop table if exists reportmask;\ndrop table if exists reporttypealias;\ndrop table if exists reptemplate;\n\n\ndrop function if exists tweeks.__tg_report_format;\n\ndrop function if exists repcolumns;\ndrop function if exists report;\ndrop function if exists report_configs;\ndrop function if exists report_mask;\ndrop function if exists report_prepare;\ndrop function if exists report_reduce;\ndrop function if exists report_register_sync;\ndrop function if exists report_source;\ndrop function if exists report_temporal;\ndrop function if exists reptemplateof;\n	drop function if exists report.report(report jsonb ); drop function if exists report.engine(report jsonb ); create or replace function report.engine(report jsonb ) returns SETOF json language plpgsql as $$ declare /** report := { _branch_uid: BRANCH limit?: int offset?: int source: view|table columns: [ COL1, COL2, COL3 ] filters: [{ column: src.COL-NAME, opr: =|<|>|<=|>=|like mode?: default|right value: VALUE-FILTER }], groups:[{ column: src.COL-NAME func: count|sum|max|min|avg rename: NEW-NAME }] } */ _limit int8 default report->>'limit'; _offset int8 default report->>'offset'; ___branch uuid default report->>'_branch_uid'; _next record; begin for _next in select * from report.__prepare( report ) n( statement ) loop raise notice 'REPORT %', report; raise notice e'REPORT:STATEMENT %', _next.statement; return query execute _next.statement using ___branch, _limit, _offset; end loop; end; $$; drop function if exists report.report_formats(anyelement, type text, format text, representation boolean); drop function if exists report.__mask(anyelement, type text, format text, representation boolean); create or replace function report.__mask( anyelement, type text, format text, representation boolean default false ) returns text immutable strict language plpgsql as $body$ <<func>> declare _format report.mask; mouth_group double precision; base int; begin representation := coalesce( representation, false ); select * into _format from report.mask rf where rf.mask = __mask.format and __mask.type = any( rf.type ); if _format.mask is null then return null; end if; -- to_char if lower( _format.function ) = 'to_char' then return to_char( $1, case when representation then _format.representation else _format.mask end); end if; if lower( _format.function ) = 'mouth_group' then mouth_group := extract( months from $1 ) / ( 12.0 / _format.mask::double precision); base := case when mouth_group::int < mouth_group then mouth_group::int+1 else mouth_group::int end; return to_char( $1, case when representation then format( '%I%I"º" YYYY', _format.representation, base ) else format( 'YYYY %I%I', _format.representation, base ) end); end if; end; $body$; create or replace function report.__mask_reduce( anyelement, type text, format text ) returns anyelement immutable strict language plpgsql as $body$ <<func>> declare _format report.mask; _types record; mouth_group double precision; base int; _month int; _year int; begin select * into _format from report.mask rf where rf.mask = __mask_reduce.format and __mask_reduce.type = any( rf.type ); select * into _types from report.talias ta where __mask_reduce.type = any( ta.alias ) ; if _format.mask is null then return null; end if; -- to_char if lower( _format.function ) = 'to_char' then case when 'date' = any( _types.alias ) then return to_date( to_char( $1, _format.mask ), _format.mask ); when 'timestamp' = any( _types.alias ) then return to_timestamp( to_char( $1, _format.mask ), _format.mask ); when 'timestamptz' = any( _types.alias ) then return to_timestamp( to_char( $1, _format.mask ), _format.mask )::timestamptz; else return $1; end case; end if; if lower( _format.function ) = 'mouth_group' then mouth_group := extract( months from $1 ) / ( 12.0 / _format.mask::double precision); base := case when mouth_group::int < mouth_group then mouth_group::int+1 else mouth_group::int end; _month := base * ( 12.0 / _format.mask::double precision )-( 12.0 / _format.mask::double precision)+1; _year := extract( year from $1 ); case when 'date' = any( _types.alias ) then return make_date( _year, _month, 1 ); when 'timestamp' = any( _types.alias ) then return make_timestamp( _year, _month, 1, 0, 0, 0 ); when 'timestamptz' = any( _types.alias ) then return make_timestamptz( _year, _month, 1, 0, 0, 0, to_char( $1, 'tz' ) ); end case; end if; end; $body$; drop table if exists tweeks.repconf; drop function if exists tweeks.report_formats_of(args jsonb); drop view if exists tweeks.vreport_balanco; drop view if exists tweeks.vreport_caixa; drop view if exists tweeks.vreport_conta; drop view if exists tweeks.vreport_fatura; drop view if exists tweeks.vreport_fluxo; drop view if exists tweeks.vreport_imposto; drop view if exists tweeks.vreport_venda; drop table if exists report; drop table if exists reportagg; drop table if exists reportmask; drop table if exists reporttypealias; drop table if exists reptemplate; drop function if exists tweeks.__tg_report_format; drop function if exists repcolumns; drop function if exists report; drop function if exists report_configs; drop function if exists report_mask; drop function if exists report_prepare; drop function if exists report_reduce; drop function if exists report_register_sync; drop function if exists report_source; drop function if exists report_temporal; drop function if exists reptemplateof;
03140623-4ba0-4c8c-b0bc-6d9c4931cc4b	\n\ndrop function if exists report."3x"( report jsonb );\ndrop function if exists report."xxx"( report jsonb );\ncreate or replace function report."3x"( report jsonb )\nreturns setof json\nlanguage plpgsql as $$\ndeclare\n  /**\n    args := {\n      row_column: column\n      row_order: asc|desc (default asc)\n      column_column: column\n      column_order asc|desc (default asc)\n      aggregation:RENAME\n    }\n   */\n  statement text;\n  _columns record;\n  _row_column text default report->>'row_column';\n  _row_order text default report->>'row_order';\n  _column_column text default report->>'column_column';\n  _column_order text default report->>'column_order';\n  _aggregation text default report->>'aggregation';\n  _row_reduce text;\n  _column_reduce text;\n  _sources record;\n  _limit int8 default report->>'limit';\n  _offset int8 default report->>'offset';\nbegin\n  report := report - 'limit' - 'offset';\n\n  select * into _columns\n    from report.__prepare_column( report );\n\n  raise notice '%', to_jsonb( _columns );\n\n  if _row_column = any( _columns.reduces ) then _row_reduce := _columns.reduces_map->>( _row_column ); end if;\n  if _column_column = any( _columns.reduces ) then _column_reduce := _columns.reduces_map->>( _column_column ); end if;\n\n  _row_reduce := coalesce( _row_reduce, _row_column );\n  _column_reduce := coalesce( _column_reduce, _column_column );\n\n  raise notice '_row_reduce: %', _row_reduce;\n  raise notice '_column_reduce: %', _column_reduce;\n\n  select jsonb_object_agg( c.column_name, jsonb_build_object(\n      'type', c.column_type,\n      'basetype', c.column_basetype,\n      'default', c.column_default,\n      'is_array', c.is_array,\n      'is_generated', c.is_generated\n    )) as maps into _sources\n    from report.columns( (report->>'source')::text::regclass ) c;\n\n-- $1 => report\n-- $2 => row_column\n-- $3 => row_reduce\n-- $4 => column_column\n-- $5 => column_reduce\n-- $6 => aggregation\n\n--language=sql\nstatement := $sql$\n  with __source as (\n    select e.data::text::jsonb as data\n      from report.engine( $1 ) e( data )\n  ), __xxx as (\n    select\n        _s.data->>$2 as "($rowColumnName)",\n        json_object_agg( _s.data ->> $4, (_s.data-> $6) order by (_s.data ->> $5)::"($columnColumnType)" "($columnOrder)" nulls last ) as "($columnColumnName)"\n      from __source _s\n      group by\n        _s.data->>$2,\n        _s.data->>$3\n      order by (_s.data->>$3)::"($rowColumnType)" "($rowOrder)" nulls last\n  ), __xxx_header as (\n    select\n        distinct _s.data ->> $4 as header_representation,\n        ( _s.data ->> $5)::"($columnColumnType)" as header_reduce\n      from __source _s\n  ), __result as  (\n    select json_agg( _xh.header_representation order by _xh.header_reduce "($columnOrder)" nulls last )  as data\n      from __xxx_header _xh\n    union all\n      select to_json( _x )\n        from __xxx _x\n  ) select data\n      from __result\n      limit $7\n      offset $8\n\n$sql$;\n\n  statement := replace( statement, '"($rowColumnName)"', format( '%I', _row_column ) );\n  statement := replace( statement, '"($columnColumnType)"', _sources.maps->( _column_column )->>'type' );\n  statement := replace( statement, '"($columnColumnName)"', format( '%I', _column_column ) );\n  statement := replace( statement, '"($columnOrder)"', coalesce( _column_order, 'asc' ) );\n  statement := replace( statement, '"($rowColumnType)"', _sources.maps->( _row_column )->>'type' );\n  statement := replace( statement, '"($rowOrder)"', coalesce( _row_order, 'asc' ) );\n\n  raise notice  '%', statement;\n\n  return query execute statement using\n    report,\n    _row_column,\n    _row_reduce,\n    _column_column,\n    _column_reduce,\n    _aggregation,\n    _limit,\n    _offset\n  ;\nend;\n$$;\n\n\n/*\nselect * from report."3x"('{\n    "groups": [\n      {\n        "key": "aggregation|report.vreport_venda.$ TOTAL::#sum",\n        "func": "sum",\n        "column": "$ TOTAL",\n        "rename": "#SUMOF $ TOTAL"\n      }\n    ],\n    "offset": 0,\n    "orders": [\n      {\n        "column": "ARTIGO",\n        "priority": "100",\n        "orientation": "asc"\n      },\n      {\n        "column": "DATA",\n        "priority": "100",\n        "orientation": "asc"\n      }\n    ],\n    "source": "report.vreport_venda",\n    "columns": [\n      {\n        "key": "column|report.vreport_venda.ARTIGO",\n        "init": "true",\n        "name": "ARTIGO",\n        "type": "column",\n        "column": "ARTIGO"\n      },\n      {\n        "key"   : "column|report.vreport_venda.DATA",\n        "init"  : "true",\n        "mask"  : "YYYY-MM-DD",\n        "name"  : "DATA",\n        "type"  : "column",\n        "column": "DATA"\n      }\n    ],\n    "filters": [],\n    "_branch_uid": "4ec28576-0fd6-436e-b2e3-d1ac7c2e1d49",\n    "windows_function_key": [\n      "count::distinct"\n    ],\n    "row_column": "ARTIGO",\n    "row_order": "asc",\n    "column_column": "DATA",\n    "column_order": "asc",\n    "aggregation": "#SUMOF $ TOTAL"\n  }');\n */\n	drop function if exists report."3x"( report jsonb ); drop function if exists report."xxx"( report jsonb ); create or replace function report."3x"( report jsonb ) returns setof json language plpgsql as $$ declare /** args := { row_column: column row_order: asc|desc (default asc) column_column: column column_order asc|desc (default asc) aggregation:RENAME } */ statement text; _columns record; _row_column text default report->>'row_column'; _row_order text default report->>'row_order'; _column_column text default report->>'column_column'; _column_order text default report->>'column_order'; _aggregation text default report->>'aggregation'; _row_reduce text; _column_reduce text; _sources record; _limit int8 default report->>'limit'; _offset int8 default report->>'offset'; begin report := report - 'limit' - 'offset'; select * into _columns from report.__prepare_column( report ); raise notice '%', to_jsonb( _columns ); if _row_column = any( _columns.reduces ) then _row_reduce := _columns.reduces_map->>( _row_column ); end if; if _column_column = any( _columns.reduces ) then _column_reduce := _columns.reduces_map->>( _column_column ); end if; _row_reduce := coalesce( _row_reduce, _row_column ); _column_reduce := coalesce( _column_reduce, _column_column ); raise notice '_row_reduce: %', _row_reduce; raise notice '_column_reduce: %', _column_reduce; select jsonb_object_agg( c.column_name, jsonb_build_object( 'type', c.column_type, 'basetype', c.column_basetype, 'default', c.column_default, 'is_array', c.is_array, 'is_generated', c.is_generated )) as maps into _sources from report.columns( (report->>'source')::text::regclass ) c; -- $1 => report -- $2 => row_column -- $3 => row_reduce -- $4 => column_column -- $5 => column_reduce -- $6 => aggregation --language=sql statement := $sql$ with __source as ( select e.data::text::jsonb as data from report.engine( $1 ) e( data ) ), __xxx as ( select _s.data->>$2 as "($rowColumnName)", json_object_agg( _s.data ->> $4, (_s.data-> $6) order by (_s.data ->> $5)::"($columnColumnType)" "($columnOrder)" nulls last ) as "($columnColumnName)" from __source _s group by _s.data->>$2, _s.data->>$3 order by (_s.data->>$3)::"($rowColumnType)" "($rowOrder)" nulls last ), __xxx_header as ( select distinct _s.data ->> $4 as header_representation, ( _s.data ->> $5)::"($columnColumnType)" as header_reduce from __source _s ), __result as ( select json_agg( _xh.header_representation order by _xh.header_reduce "($columnOrder)" nulls last ) as data from __xxx_header _xh union all select to_json( _x ) from __xxx _x ) select data from __result limit $7 offset $8 $sql$; statement := replace( statement, '"($rowColumnName)"', format( '%I', _row_column ) ); statement := replace( statement, '"($columnColumnType)"', _sources.maps->( _column_column )->>'type' ); statement := replace( statement, '"($columnColumnName)"', format( '%I', _column_column ) ); statement := replace( statement, '"($columnOrder)"', coalesce( _column_order, 'asc' ) ); statement := replace( statement, '"($rowColumnType)"', _sources.maps->( _row_column )->>'type' ); statement := replace( statement, '"($rowOrder)"', coalesce( _row_order, 'asc' ) ); raise notice '%', statement; return query execute statement using report, _row_column, _row_reduce, _column_column, _column_reduce, _aggregation, _limit, _offset ; end; $$; /* select * from report."3x"('{ "groups": [ { "key": "aggregation|report.vreport_venda.$ TOTAL::#sum", "func": "sum", "column": "$ TOTAL", "rename": "#SUMOF $ TOTAL" } ], "offset": 0, "orders": [ { "column": "ARTIGO", "priority": "100", "orientation": "asc" }, { "column": "DATA", "priority": "100", "orientation": "asc" } ], "source": "report.vreport_venda", "columns": [ { "key": "column|report.vreport_venda.ARTIGO", "init": "true", "name": "ARTIGO", "type": "column", "column": "ARTIGO" }, { "key" : "column|report.vreport_venda.DATA", "init" : "true", "mask" : "YYYY-MM-DD", "name" : "DATA", "type" : "column", "column": "DATA" } ], "filters": [], "_branch_uid": "4ec28576-0fd6-436e-b2e3-d1ac7c2e1d49", "windows_function_key": [ "count::distinct" ], "row_column": "ARTIGO", "row_order": "asc", "column_column": "DATA", "column_order": "asc", "aggregation": "#SUMOF $ TOTAL" }'); */
4a5cb860-35b6-4e6b-bfd3-3078c642d377	\n\ncreate schema if not exists report;\ndrop function if exists report.sync(regclass, name text);\ndrop function if exists report.sync(regclass, name text, priority integer);\ndrop function if exists report.sync(regclass, name text, priority integer, boolean );\n\ncreate table if not exists report.report ();\ndrop table if exists report.____temp_report;\ncreate table report.____temp_report as select * from report.report;\ndrop table if exists report.report;\n\ncreate table if not exists report.report ();\nalter table report.report add if not exists report_name     varchar;\nalter table report.report add if not exists report_source   varchar;\nalter table report.report add if not exists report_columns  text[];\nalter table report.report add if not exists report_priority integer;\nalter table report.report add if not exists report_active   boolean default true not null;\nalter table report.report add constraint pk_report_source primary key (report_source);\n\ninsert into report.report\nselect (jsonb_populate_record( null::report.report, to_jsonb( tr ))).*\nfrom report.____temp_report tr;\ndrop table report.____temp_report;\n\ncreate table if not exists report.template();\ndrop  table if exists report.____temp_template;\ncreate table report.____temp_template as select * from report.template;\ndrop table if exists report.template;\n\ncreate table if not exists report.template();\nalter table report.template add type character varying;\nalter table report.template add name character varying;\nalter table report.template add  configs jsonb;\n\ninsert into report.template\nselect (jsonb_populate_record( null::report.template, to_jsonb( trp ))).*\nfrom report.____temp_template trp;\ndrop table report.____temp_template;\n\n\n\ncreate table if not exists report.vcolumn();\ndrop  table if exists report.____temp_vcolumn;\ncreate table report.____temp_vcolumn as select * from report.vcolumn;\ndrop table if exists report.vcolumn;\n\ncreate table if not exists report.vcolumn();\nalter table report.vcolumn add if not exists  source   varchar;\nalter table report.vcolumn add if not exists  name     varchar;\nalter table report.vcolumn add if not exists  position smallint;\nalter table report.vcolumn add if not exists  show     boolean default false;\nalter table report.vcolumn add if not exists  init     boolean default false;\nalter table report.vcolumn add if not exists  format   varchar;\nalter table report.vcolumn add if not exists  filter   jsonb   default jsonb_build_array();\nalter table report.vcolumn add if not exists  agg      jsonb   default jsonb_build_array();\nalter table report.vcolumn add if not exists  noagg    boolean default false;\nalter table report.vcolumn add if not exists  gen      jsonb   default jsonb_build_array();\nalter table report.vcolumn add if not exists  rename   varchar;\nalter table report.vcolumn add if not exists  type     varchar;\nalter table report.vcolumn add constraint pk_vcolumn_source primary key (source, name );\n\ninsert into report.vcolumn\nselect (jsonb_populate_record( null::report.vcolumn, to_jsonb( trp ))).*\nfrom report.____temp_vcolumn trp;\n\ndrop table report.____temp_vcolumn;\ndrop table if exists report.agg;\ncreate table report.agg(\n  key text,\n  priority int,\n  function text,\n  types text[],\n  format text,\n  label text,\n  name text,\n  rename text,\n  description text,\n  simple text,\n  expression text,\n  over text,\n  constraint pk_agg_key primary key ( key )\n);\n\ninsert into report.agg ( key, priority, function, types, format, label, name, rename, description, simple, expression, over) VALUES ('sum', 1, 'sum', '{int,double,money}', null, 'SOMAR', '∑SOM. %s', '#SUMOF %s', 'SOMATORIO DOS VALORES NA COLUNA %s', 'sum( %s )', 'sum( %s ) as %I', 'sum( %s ) over ()');\ninsert into report.agg ( key, priority, function, types, format, label, name, rename, description, simple, expression, over) VALUES ('count', 2, 'count', '{int,double,money,date,timestamp,time,timestamptz,name,code,text,id,*}', 'int', 'CONTAR TUDO', '∑QTD. %s', '#COUNTOF %s', 'CONTAGEM DOS VALORES NA COLUNA %s (INCLUIDO DUPLICADOS)', 'count( %s )', 'count( %s ) as %I', 'count( %s ) over ()');\ninsert into report.agg ( key, priority, function, types, format, label, name, rename, description, simple, expression, over) VALUES ('count::distinct', 3, 'count', '{int,double,money,date,timestamp,time,timestamptz,name,code,text,id}', 'int', 'CONTAR DISTINTO', '∑QTD. DIST. %s', '#COUNTOF:DISTINCT %s', 'CONTAGEM DOS VALORES NA COLUNA %s (EXCLUINDO DUPLICADOS)', 'count( distinct %s ) ', 'count(  distinct %s ) as %I ', 'count( %s ) filter( where %I = 1) over ()');\ninsert into report.agg ( key, priority, function, types, format, label, name, rename, description, simple, expression, over) VALUES ('max', 4, 'max', '{int,double,money,date,timestamp,time,timestamptz,name,code,text,id}', null, 'MÁXIMO', '∑MAX. %s', '#MAXOF %s', 'MAXIMO VALOR NA COLUNA %s', 'max( %s )', 'max( %s ) as %I', 'max( %s ) over ()');\ninsert into report.agg ( key, priority, function, types, format, label, name, rename, description, simple, expression, over) VALUES ('min', 5, 'min', '{int,double,money,date,timestamp,time,timestamptz,name,code,text,id}', null, 'MÍNIMO', '∑MIN. %s', '#MINOF %s', 'MINIMO VALOR NA COLUNA %s', 'min( %s )', 'min( %s ) as %I', 'min( %s ) over ()');\ninsert into report.agg ( key, priority, function, types, format, label, name, rename, description, simple, expression, over) VALUES ('avg', 6, 'avg', '{int,double,money}', null, 'MEDIA', '∑MED. %s', '#AVGOF %s', 'MEDIA DE VALORES NA COLUNA %s', 'avg( %s )', 'avg( %s ) as %I', 'avg( %s ) over ()');\n\nselect * from report.agg;\n\n\ndrop table if exists report.talias;\ncreate table if not exists report.talias(\n  type text,\n  alias text[],\n  constraint pk_talias_type primary key ( type )\n);\n\nselect format_type( 'numeric'::regtype, null );\n\ninsert into report.talias ( type, alias ) values ( 'date', '{date}');\ninsert into report.talias ( type, alias ) values ( 'int', '{int,int4,integer}');\ninsert into report.talias ( type, alias ) values ( 'smallint', '{int2,smallint}');\ninsert into report.talias ( type, alias ) values ( 'bigint', '{bigint,int8}');\ninsert into report.talias ( type, alias ) values ( 'varchar', '{varchar,character varying}');\ninsert into report.talias ( type, alias ) values ( 'double', '{double,double precision,float8}');\ninsert into report.talias ( type, alias ) values ( 'char', '{char,character}');\ninsert into report.talias ( type, alias ) values ( 'bool', '{bool,boolean}');\ninsert into report.talias ( type, alias ) values ( 'timestamp', '{timestamp,timestamp without time zone}');\ninsert into report.talias ( type, alias ) values ( 'time', '{time,time without time zone}');\ninsert into report.talias ( type, alias ) values ( 'timestamptz', '{timestamptz,timestamp with time zone}');\ninsert into report.talias ( type, alias ) values ( 'timetz', '{timetz,time with time zone}');\n\n\ndrop table if exists report.mask;\ncreate table if not exists report.mask(\n  type text[] default array[]::text[],\n  mask text,\n  name text,\n  description character varying,\n  representation text,\n  function text,\n  priority int2,\n  constraint pk_reportformats primary key ( type, mask )\n);\n\nINSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', 'YYYY-MM-DD', 'DIARIO', 'APRESENTAÇÃO DIÁRIA', 'DD-MM-YYYY', 'to_char', 100);\nINSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', 'YYYY-MM', 'MENSAL', 'APRESENTAÇÃO MENSAL', 'MON "DE" YYYY', 'to_char', 90);\nINSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', 'YYYY', 'ANUAL', 'APESENTAÇÃO ANUAL', 'YYYY', 'to_char', 80);\nINSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', 'YYYY "T"Q', 'TRIMESTRAL', 'APRESENTAÇÃO TRIMESTRAL', 'YYYY "T"Q', 'to_char', 70);\nINSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', '2', 'SIMESTRAL', 'APRESENTAÇÃO SEMESTRAL', 'S', 'mouth_group', 60);\nINSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', 'YYYY-WW', 'SEMANAL', 'APRESENTAÇÃO SEMANAL', 'WW"ª SEM" "DE" YYYY', 'to_char', 50);\nINSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', 'YYYY-MM-W', 'SEMANAL MENSAL', 'APRESENTAÇÃO SEMANAL MENSAL', 'W"ª SEM" "DE" MON YYYY', 'to_char', 49);\nINSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', 'YYYY-MM-DD HH:MI', 'MOMENTANIO', 'APRESENTACÃO DIÁRIO INCLUINDO HORA E MINUTO', 'DD-MM-YYYY HH:MI', 'to_char', null);\n\n\ncreate or replace function report.____tg_report_format() returns trigger\n  language plpgsql\nas\n$$\ndeclare\n  _source record;\n  _repcoll report.vcolumn;\n  _report report.report;\nbegin\n  if pg_typeof( new )::text::regclass = 'report.report'::regclass then\n    _report := new;\n    select * into _source\n    from report.source_map( _report.report_source::regclass );\n    _report.report_source := _source.source_format;\n    return _report;\n  elsif pg_typeof( new )::text::regclass = 'report.vcolumn'::regclass then\n    _repcoll := new;\n    select * into _source\n    from report.source_map( _repcoll.source::regclass );\n    _repcoll.source := _source.source_format;\n    return _repcoll;\n  end if;\n  return new;\nend;\n$$;\n\ncreate trigger tg_report_format before insert or update on report.report for each row\nexecute procedure report.____tg_report_format();\n\n\ndrop function if exists report.eval;\ncreate or replace function report.eval( expression text, args anyelement ) returns jsonb\n  language plpgsql\nas\n$$\ndeclare\n  result text;\n  statement text;\nbegin\n  statement := format( 'select to_jsonb((%s))', expression );\n  raise notice 'eval: %', statement;\n  execute statement using args into result;\n  return result;\nend\n$$;\n\n\ndrop table if exists report.var;\ncreate table report.var();\nalter table report.var add var_key text;\nalter table report.var add var_description text;\nalter table report.var add var_type text;\nalter table report.var add var_expression text;\n\n\nalter table report.var add constraint pk_value_key primary key ( var_key );\n\n\nINSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('current_timestamp', 'Timestamp Atual', 'timestamp', 'select current_timestamp');\nINSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('current_user', 'Current Database User', 'text', 'select "current_user"()');\nINSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('current_collaborator', 'Collaborador atual', 'uuid', 'select $1->>''arg_colaborador_id''');\nINSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('current_branch', 'Branch Atual', 'uuid', 'select coalesce( ($1->>''branch_uid'')::uuid, ( $1->>''arg_branch_id'')::uuid, ( $1->>''_branch_uid'')::uuid, ( $1->>''arg_branch_uid'')::uuid, tweeks.__branch_uid( ($1->>''arg_colaborador_id'')::uuid, ($1->>''arg_espaco_auth'' )::uuid))');\nINSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('current_space', 'Espaço atual (Armazem Atual)', 'uuid', 'select $1->>''arg_espaco_auth''');\nINSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('today', 'Hoje', 'date', 'select current_date');\nINSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('yesterday', 'Ontem', 'date', 'select current_date - interval ''1'' day');\nINSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('end_of_month', 'Fim do mês', 'date', 'select to_date(to_char(current_date + interval ''1'' month, ''yyyy-mm''), ''yyyy-mm'')-interval ''1'' day');\nINSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('current_time', 'Hora atual', 'time', 'select current_time');\nINSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('now', 'Momento atual', 'timestamptz', 'select now()');\n\ncreate or replace function report.vars( args jsonb )\nreturns setof jsonb\nlanguage plpgsql as $$\ndeclare\n  /**\n    args := {\n      var_key: [key, key, key],\n      arg_colaborador_id::UID\n      arg_espaco_id::UID\n      source::(report-source)\n    }\n   */\n  _var_key text[] default array( select e.text from jsonb_array_elements_text( args->'var_key') e ( text ) );\nbegin\n  if coalesce( array_length(_var_key, 1), 0 ) = 0 then\n    select array_agg( var_key ) into  _var_key\n      from report.var v;\n  end if;\n\n  return query\n    with __vars as (\n      select vk.*,\n        report.eval( format( 'select (%s)::%s', vk.var_expression, vk.var_type ), '{}'::jsonb ) as value\n      from report.var vk\n      where vk.var_key = any( _var_key )\n    ) select to_jsonb( _vk )\n    from __vars _vk\n  ;\nend;\n$$;\n\ncreate or replace function report.vcolumns(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /**\n    args: {\n      "source":"REPORT_SOURCE"\n    },\n   */\n  _src character varying default args->>'source';\n  _source record;\nbegin\n  select * into _source\n  from report.source_map( _src );\n\n  -- COLUMNS\n  return query\n    select\n      jsonb_build_object(\n          'key', format( 'column|%s.%s', _src, rc.name ),\n          'column', rc.name,\n          'name', coalesce( rc.rename, rc.name ),\n          'type', 'column',\n          'format', rc.format,\n          'dataType', rc.type,\n          'init', rc.init\n        )\n    from report.vcolumn rc\n    where rc.source = _source.source_format\n      and rc.show\n    order by rc.position desc\n      nulls last,\n             coalesce( rc.rename, rc.name )\n  ;\n\n  -- FILTER\n  return query\n    with __filters as (\n      select rc.*, f.ordinality, report.__template_of( f.doc, to_jsonb( rc ) || to_jsonb( _source ) || to_jsonb( r ) ) as doc\n      from report.vcolumn rc\n         inner join report.report r on rc.source = r.report_source\n         inner join jsonb_array_elements( rc.filter ) with ordinality f( doc ) on true\n      where rc.source = _source.source_format\n        and jsonb_array_length( rc.filter ) > 0\n    ) select f.doc || jsonb_build_object(\n        'key', format( 'filter|%s.%s::#%s', _src, f.name, f.ordinality ),\n        'opr', f.doc->'opr',\n        'column', f.name,\n        'dataType', f.type,\n        'name', f.doc->'name',\n        'mode', f.doc->'mode',\n        'source', f.doc->'source',\n        'src', f.doc->'src',\n        'format', f.doc->'format',\n        'type', 'filter'\n      ) from __filters  f\n    order by\n      coalesce( ( f.doc->>'position')::int2, f.position ) desc\n      nulls last,\n      f.ordinality,\n      coalesce( f.doc->>'name', f.name )\n  ;\n\n  -- GROUP\n  return query\n    with __filters as (\n      select rc.*,\n             agg.function as agg_function,\n             agg.label as agg_label,\n             agg.key as agg_key,\n             agg.priority as agg_priority,\n             lib.str_normalize( format( agg.name, rc.name ) ) as agg_name,\n             agg.format as agg_format,\n             lib.str_normalize( format( agg.rename, rc.name ) ) as agg_rename,\n             agg.simple as agg_simple,\n             agg.expression as agg_expresion,\n             agg.over as agg_over,\n             agg.types as agg_types,\n             format( '%I', rc.name ) as agg_usecolumn,\n             lib.str_normalize( format( agg.rename, rc.name ) ) as agg_userename\n      from report.vcolumn rc\n             inner join report.report r on rc.source = r.report_source\n             inner join report.agg agg on rc.format = any( agg.types )\n\n      where rc.source = _source.source_format\n        and rc.show\n    ) select jsonb_build_object(\n                 'key', format( 'aggregation|%s.%s::#%s', _src, f.name, f.agg_key ),\n                 'column', f.name,\n                 'name',  f.agg_name,\n                 'func', f.agg_function,  -- f.doc -> 'func',\n                 'format', coalesce( f.agg_format, f.format ), -- f.doc -> 'format',\n                 'rename', f.agg_rename,\n                 'type', 'group',\n                 'label', f.agg_label,\n                 'init', false,\n                 'dataType', f.type,\n                 'simple', format( f.agg_simple,  f.agg_usecolumn ),\n                 'expression', format( f.agg_expresion, f.agg_usecolumn, f.agg_rename ),\n                 'priority', f.agg_priority,\n                 'column_position', f.position,\n                 'over', format( f.agg_over, f.agg_usecolumn, format( '\\\\\\\\:%s:#ROW_NUMBER', f.name  ) )\n               ) from __filters  f\n    order by\n      f.position desc nulls last,\n      f.name,\n      f.agg_priority nulls last;\n\n  -- INDEPENDENT AGGREGATION\n  return query\n    with __vcolumn as (\n      select\n        rc.*,\n        agg.function,\n        agg.label,\n        agg.key,\n        agg.priority,\n        agg.simple,\n        agg.expression,\n        agg.over,\n        agg.types,\n        agg.format _agg_format,\n        lib.str_normalize( format( agg.name, rc.name ) ) as _agg_name,\n        lib.str_normalize( format( agg.rename, rc.name ) ) as _agg_rename\n\n        from report.vcolumn rc\n          inner join report.report r on rc.source = r.report_source\n          inner join report.agg agg on rc.format = any( agg.types )\n\n\n\n    ),  __filters as (\n      select rc.*,\n             rc.function as agg_function,\n             rc.label as agg_label,\n             rc.key as agg_key,\n             rc.priority as agg_priority,\n             coalesce( e.doc->>'name', rc._agg_name ) as agg_name,\n             coalesce( e.doc->>'format', rc._agg_format, rc.format ) as agg_format,\n             coalesce( e.doc->>'rename', rc._agg_rename, e.doc->>'name', rc._agg_name ) as agg_rename,\n             rc.simple as agg_simple,\n             rc.expression as agg_expresion,\n             rc.over as agg_over,\n             rc.types as agg_types,\n             format( '%I', rc.name )  as agg_usecolumn,\n             format( '%I', coalesce( e.doc->>'rename', rc._agg_rename, e.doc->>'name', rc._agg_name, rc.name ) ) as agg_userename\n      from __vcolumn rc\n             inner join jsonb_array_elements( rc.agg ) with ordinality e( doc ) on true\n               and ( e.doc->>'func' ) = rc.key\n      where rc.source = _source.source_format\n        and jsonb_array_length( rc.agg ) > 0\n    ) select jsonb_build_object(\n                 'key', format( 'aggregation|%s.%s::#%s', _src, f.name, f.agg_key ),\n                 'column', f.name,\n                 'dataType', f.type,\n                 'name',  f.agg_name,\n                 'func', f.agg_function,\n                 'format', agg_format,\n                 'rename', f.agg_rename,\n                 'type', 'group',\n                 'label', f.agg_label,\n                 'init', false,\n                 'simple', format( f.agg_simple,  f.agg_usecolumn ),\n                 'expression', format( f.agg_expresion, f.agg_usecolumn, f.agg_rename ),\n                 'priority', f.agg_priority,\n                 'column_position', f.position,\n                 'over', format( f.agg_over, f.agg_usecolumn, format( '\\\\\\\\:%s:#ROW_NUMBER', f.name  ) )\n               ) from __filters  f\n    order by\n      f.position desc nulls last,\n      f.name,\n      f.agg_priority nulls last;\nend\n$$;\n\n\ncreate or replace function report.configs(args jsonb) returns SETOF jsonb\n  language sql\nas\n$$\nwith __report as (\n      select\n        r.*,\n        jsonb_agg( conf.doc  ) as configs\n      from report.report r\n        inner join report.vcolumns( jsonb_build_object('source', r.report_source ) ) conf ( doc ) on true\n      where r.report_active\n      group by r.report_source\n    ) select to_jsonb( _r )\n        from __report _r\n        order by _r.report_priority desc nulls last,\n          _r.report_name nulls last\n$$;\n\n\nCREATE or replace FUNCTION report.sync(regclass, name text DEFAULT NULL::text, priority integer DEFAULT NULL::integer, active boolean DEFAULT true) RETURNS SETOF json\n  LANGUAGE plpgsql\nAS $_$\ndeclare\n  _rec record;\n  _report report.report;\n  _source record;\nbegin\n  select * into _source\n  from report.source_map( $1 );\n\n  active := coalesce( active, true );\n\n  with __columns as (\n    select\n      col.column_name,\n      format_type( pt.oid, atttypmod ) column_type,\n      col.data_type = 'ARRAY' as is_array,\n      col.column_default,\n      col.is_generated = 'ALWAYS' as is_generated\n    from information_schema.columns col\n           inner join report.source_map( _source.source_class ) c on c.source_name = col.table_name\n      and col.table_schema::regnamespace = c.source_schema::regnamespace\n           inner join pg_attribute att on col.column_name = att.attname\n      and att.attrelid = format( '%s.%s', col.table_schema, col.table_name )::regclass::oid\n           inner join pg_type pt on att.atttypid = pt.oid\n    where format('%s.%s', c.source_schema, c.source_name)::regclass = _source.source_class\n  )\n\n  select array_agg( to_jsonb( c ) ) as configs,\n         array_agg(c.column_name ) as columns\n  into _rec\n  from __columns c\n  ;\n\n  select * into _report\n  from report.report r\n  where r.report_source = cluster.__format( $1 )\n  ;\n  _report.report_name := coalesce( name, _report.report_name, cluster.__format( $1 ) );\n  _report.report_source := _source.source_format;\n  _report.report_columns := _rec.columns;\n  _report.report_priority := priority;\n  _report.report_active := active;\n\n  select  ("returning").* into _report\n  from lib.sets( _report );\n\n  return next to_json( _report );\n\n\n  delete from report.vcolumn r\n    where r.name != all ( _rec.columns )\n      and source = _source.source_format\n  ;\n\n\n  with __news as (\n    select\n      n.doc->>'column_name' as name,\n      n.doc->>'column_type' as type\n    from unnest( _rec.configs ) n ( doc )\n      left join report.vcolumn rc on n.doc->>'column_name' = rc.name\n        and rc.source = _source.source_format\n    where rc.name is null\n  )\n  insert into report.vcolumn (\n    source,\n    name,\n    filter,\n    agg,\n    type\n  ) select\n      _report.report_source,\n      _n.name,\n      jsonb_build_array(),\n      jsonb_build_array(),\n      _n.type\n  from __news _n;\n\n  with __updates as  (\n    select\n      n.doc->>'column_name' as name,\n      n.doc->>'column_type' as type\n    from unnest( _rec.configs ) n ( doc )\n  ) update report.vcolumn c\n  set\n    type = _up.type\n  from __updates _up\n  where c.name = _up.name\n    and c.source = _source.source_format\n  ;\n\n  return query\n    select  to_json( rc )\n      from report.vcolumn rc\n      where rc.source = _report.report_source\n  ;\nend;\n$_$;\n\n\ncreate or replace function report.source_map(regclass)\n  returns TABLE(source_name character varying, source_schema character varying, source_class regclass, source_format character varying, type text)\n  language sql\nas\n$$\nwith __class as (\n  select\n         pc.tablename::text,\n         pc.schemaname::text,\n         format( '%s.%s', pc.schemaname::regnamespace::text, pc.tablename )::regclass,\n         format( '%s.%s', pc.schemaname::regnamespace::text, pc.tablename ),\n         'table'\n  from pg_tables pc\n  where (format( '%s.%s', pc.schemaname::regnamespace::text, pc.tablename )::regclass = $1)\n  union all\n  select pv.viewname::text,\n         pv.schemaname::text,\n         format( '%s.%s', pv.schemaname::regnamespace::text, pv.viewname )::regclass,\n         format( '%s.%s', pv.schemaname::regnamespace::text, pv.viewname ),\n         'view'\n  from pg_views pv\n  where (format( '%s.%s', pv.schemaname::regnamespace::text, pv.viewname )::regclass = $1)\n) select *\nfrom __class\n$$;\n\n\n\ncreate or replace function report.__template_of(ref jsonb, colconfigs jsonb) returns jsonb\n  language plpgsql\nas\n$$\ndeclare\n  refname text;\n  args jsonb;\n  _name text;\n  _type text;\nbegin\n  if ref is null then return null; end if;\n  if jsonb_typeof( ref ) = 'object' then return ref; end if;\n  if jsonb_typeof( ref ) = 'string' then refname = ref->>0;\n  elseif jsonb_typeof( ref ) = 'array' then\n    refname := ref->>0;\n    args := ref->1;\n  end if;\n\n  if args is not null and jsonb_typeof( args ) != 'object' then raise exception 'args is not object, %', args ; end if;\n  _type := (regexp_split_to_array( refname, '\\.' ))[1];\n  _name := (\n    select string_agg( u.text, '.' )\n    from  unnest( ( regexp_split_to_array( refname, '\\.' ))[2:] ) u( text)\n  );\n\n--  raise exception 'type: %, _name: %, LENGTH: %', _type, _name, array_length (regexp_split_to_array( refname, '\\.' ), 1);\n\n  if _type is null or _name is null or array_length(regexp_split_to_array( refname, '\\.' ), 1)  < 2 then\n    raise exception 'Type or name indeterminated %: ', ref;\n  end if;\n\n  declare\n    _template record;\n    _i record;\n    _j record;\n    _obj jsonb default jsonb_build_object();\n    _conversion text;\n    _value jsonb;\n  begin\n    select * into _template\n    from report.template t\n    where type = _type\n      and t.name = _name;\n\n    if _template.name is null then raise exception 'Template not found with ref: % | type: % | name: %', ref, _type, _name; end if;\n    for _i in\n      select\n        e.key,\n        e.value,\n        jsonb_typeof( e.value ) as type,\n        case\n          when jsonb_typeof( e.value ) in ( 'object', 'array' ) then e.value::text\n          else e.value->>0\n          end as text\n      from jsonb_each( _template.configs ) e\n      loop\n        if _i.type in ( 'string', 'boolean', 'null', 'number' ) then _value := _i.value;\n        elsif _i.type = 'object' and (_i.value->>'$template')::boolean then\n          _conversion := _i.value->>'$structure';\n          if _conversion is null then raise exception 'Null AQUI 452739'; end if;\n          for _j in\n            select\n              e.key,\n              e.value,\n              jsonb_typeof( e.value ) as type,\n              case\n                when jsonb_typeof( e.value ) in ( 'object', 'array' ) then e.value::text\n                else e.value->>0\n                end as text\n            from jsonb_each( colConfigs ) e\n            loop\n              _conversion := replace( _conversion, format( '${%s}', _j.key ), coalesce( _j.text, '' ) );\n              if _conversion is null then raise exception 'Null AQUI 77736'; end if;\n            end loop;\n\n          for _j in\n            select\n              e.key,\n              e.value,\n              jsonb_typeof( e.value ) as type,\n              case\n                when jsonb_typeof( e.value ) in ( 'object', 'array' ) then e.value::text\n                else e.value->>0\n                end as text\n            from jsonb_each( args ) e\n            loop\n              _conversion := replace( _conversion, format( '${args.%s}', _j.key ), coalesce( _j.text, '' ) );\n              if _conversion is null then raise exception 'Null AQUI kjskdhs'; end if;\n            end loop;\n\n          _conversion := coalesce( _conversion, _i.value->>'$default', _i.value->>'$defaults' );\n          if _conversion is null then raise exception '#C001 Conversion is null template: %; key: %; value %; args <= %', _template.name , _j.key, _j.value, args; end if;\n          if _conversion = _i.value->>'$structure' then _conversion := coalesce(  _i.value->>'$default', _i.value->>'$defaults' ); end if;\n          if _conversion is null then raise exception '#C002 Conversion is null template: %; key: %; value %; args <= %', _template.name , _j.key, _j.value, args;  end if;\n\n          if _i.value->>'$type' in ( 'string', 'text', 'varchar', 'character varying' ) then\n            _value := to_jsonb( _conversion );\n          elseif _i.value->>'$type' in ( 'number', 'numeric', 'int', 'integer', 'double', 'double precision' ) then\n            _value := to_jsonb( _conversion::numeric );\n\n          elseif _i.value->>'$type' in ( 'bool', 'boolean' ) then\n            _value := to_jsonb( _conversion::boolean );\n          else\n            _value := to_jsonb( _conversion );\n          end if;\n        else _value := _i.value;\n        end if;\n\n        _obj := _obj || jsonb_build_object(\n          _i.key,\n          _value\n          );\n\n        if _obj is null then raise exception 'Object is null in {%:%} args: % base: %', _i.key, _i.value, args, colConfigs; end if;\n        if _value is null then raise exception 'Object.value is null in {%:%} args: % base: %', _i.key, _i.value, args, colConfigs; end if;\n        if jsonb_typeof(_value) = 'null' then raise exception 'Type Object.value is null in {%:%} args: % base: %', _i.key, _i.value, args, colConfigs; end if;\n      end loop;\n    return _obj;\n  end;\nend\n$$;\n\ncreate or replace function report.columns(regclass)\n  returns TABLE(column_name text, column_type text, column_basetype text, column_default text, is_array boolean, is_generated boolean)\n  strict\n  language sql\nas\n$$\nselect\n    col.column_name::text,\n    format_type( pt.oid, atttypmod )::text column_type,\n    case\n      when col.data_type = 'ARRAY' then format_type( pt.typelem, atttypmod )\n      else format_type( pt.oid, atttypmod )\n    end as column_basetype,\n    col.column_default::text,\n    col.data_type = 'ARRAY' as is_array,\n    col.is_generated = 'ALWAYS' as is_generated\n  from information_schema.columns col\n         inner join report.source_map( $1 ) c on c.source_name = col.table_name\n    and col.table_schema::regnamespace = c.source_schema::regnamespace\n         inner join pg_attribute att on col.column_name = att.attname\n    and att.attrelid = format( '%s.%s', col.table_schema, col.table_name )::regclass::oid\n         inner join pg_type pt on att.atttypid = pt.oid\n  where format('%s.%s', c.source_schema, c.source_name)::regclass = $1\n$$;\n\n	create schema if not exists report; drop function if exists report.sync(regclass, name text); drop function if exists report.sync(regclass, name text, priority integer); drop function if exists report.sync(regclass, name text, priority integer, boolean ); create table if not exists report.report (); drop table if exists report.____temp_report; create table report.____temp_report as select * from report.report; drop table if exists report.report; create table if not exists report.report (); alter table report.report add if not exists report_name varchar; alter table report.report add if not exists report_source varchar; alter table report.report add if not exists report_columns text[]; alter table report.report add if not exists report_priority integer; alter table report.report add if not exists report_active boolean default true not null; alter table report.report add constraint pk_report_source primary key (report_source); insert into report.report select (jsonb_populate_record( null::report.report, to_jsonb( tr ))).* from report.____temp_report tr; drop table report.____temp_report; create table if not exists report.template(); drop table if exists report.____temp_template; create table report.____temp_template as select * from report.template; drop table if exists report.template; create table if not exists report.template(); alter table report.template add type character varying; alter table report.template add name character varying; alter table report.template add configs jsonb; insert into report.template select (jsonb_populate_record( null::report.template, to_jsonb( trp ))).* from report.____temp_template trp; drop table report.____temp_template; create table if not exists report.vcolumn(); drop table if exists report.____temp_vcolumn; create table report.____temp_vcolumn as select * from report.vcolumn; drop table if exists report.vcolumn; create table if not exists report.vcolumn(); alter table report.vcolumn add if not exists source varchar; alter table report.vcolumn add if not exists name varchar; alter table report.vcolumn add if not exists position smallint; alter table report.vcolumn add if not exists show boolean default false; alter table report.vcolumn add if not exists init boolean default false; alter table report.vcolumn add if not exists format varchar; alter table report.vcolumn add if not exists filter jsonb default jsonb_build_array(); alter table report.vcolumn add if not exists agg jsonb default jsonb_build_array(); alter table report.vcolumn add if not exists noagg boolean default false; alter table report.vcolumn add if not exists gen jsonb default jsonb_build_array(); alter table report.vcolumn add if not exists rename varchar; alter table report.vcolumn add if not exists type varchar; alter table report.vcolumn add constraint pk_vcolumn_source primary key (source, name ); insert into report.vcolumn select (jsonb_populate_record( null::report.vcolumn, to_jsonb( trp ))).* from report.____temp_vcolumn trp; drop table report.____temp_vcolumn; drop table if exists report.agg; create table report.agg( key text, priority int, function text, types text[], format text, label text, name text, rename text, description text, simple text, expression text, over text, constraint pk_agg_key primary key ( key ) ); insert into report.agg ( key, priority, function, types, format, label, name, rename, description, simple, expression, over) VALUES ('sum', 1, 'sum', '{int,double,money}', null, 'SOMAR', '∑SOM. %s', '#SUMOF %s', 'SOMATORIO DOS VALORES NA COLUNA %s', 'sum( %s )', 'sum( %s ) as %I', 'sum( %s ) over ()'); insert into report.agg ( key, priority, function, types, format, label, name, rename, description, simple, expression, over) VALUES ('count', 2, 'count', '{int,double,money,date,timestamp,time,timestamptz,name,code,text,id,*}', 'int', 'CONTAR TUDO', '∑QTD. %s', '#COUNTOF %s', 'CONTAGEM DOS VALORES NA COLUNA %s (INCLUIDO DUPLICADOS)', 'count( %s )', 'count( %s ) as %I', 'count( %s ) over ()'); insert into report.agg ( key, priority, function, types, format, label, name, rename, description, simple, expression, over) VALUES ('count::distinct', 3, 'count', '{int,double,money,date,timestamp,time,timestamptz,name,code,text,id}', 'int', 'CONTAR DISTINTO', '∑QTD. DIST. %s', '#COUNTOF:DISTINCT %s', 'CONTAGEM DOS VALORES NA COLUNA %s (EXCLUINDO DUPLICADOS)', 'count( distinct %s ) ', 'count( distinct %s ) as %I ', 'count( %s ) filter( where %I = 1) over ()'); insert into report.agg ( key, priority, function, types, format, label, name, rename, description, simple, expression, over) VALUES ('max', 4, 'max', '{int,double,money,date,timestamp,time,timestamptz,name,code,text,id}', null, 'MÁXIMO', '∑MAX. %s', '#MAXOF %s', 'MAXIMO VALOR NA COLUNA %s', 'max( %s )', 'max( %s ) as %I', 'max( %s ) over ()'); insert into report.agg ( key, priority, function, types, format, label, name, rename, description, simple, expression, over) VALUES ('min', 5, 'min', '{int,double,money,date,timestamp,time,timestamptz,name,code,text,id}', null, 'MÍNIMO', '∑MIN. %s', '#MINOF %s', 'MINIMO VALOR NA COLUNA %s', 'min( %s )', 'min( %s ) as %I', 'min( %s ) over ()'); insert into report.agg ( key, priority, function, types, format, label, name, rename, description, simple, expression, over) VALUES ('avg', 6, 'avg', '{int,double,money}', null, 'MEDIA', '∑MED. %s', '#AVGOF %s', 'MEDIA DE VALORES NA COLUNA %s', 'avg( %s )', 'avg( %s ) as %I', 'avg( %s ) over ()'); select * from report.agg; drop table if exists report.talias; create table if not exists report.talias( type text, alias text[], constraint pk_talias_type primary key ( type ) ); select format_type( 'numeric'::regtype, null ); insert into report.talias ( type, alias ) values ( 'date', '{date}'); insert into report.talias ( type, alias ) values ( 'int', '{int,int4,integer}'); insert into report.talias ( type, alias ) values ( 'smallint', '{int2,smallint}'); insert into report.talias ( type, alias ) values ( 'bigint', '{bigint,int8}'); insert into report.talias ( type, alias ) values ( 'varchar', '{varchar,character varying}'); insert into report.talias ( type, alias ) values ( 'double', '{double,double precision,float8}'); insert into report.talias ( type, alias ) values ( 'char', '{char,character}'); insert into report.talias ( type, alias ) values ( 'bool', '{bool,boolean}'); insert into report.talias ( type, alias ) values ( 'timestamp', '{timestamp,timestamp without time zone}'); insert into report.talias ( type, alias ) values ( 'time', '{time,time without time zone}'); insert into report.talias ( type, alias ) values ( 'timestamptz', '{timestamptz,timestamp with time zone}'); insert into report.talias ( type, alias ) values ( 'timetz', '{timetz,time with time zone}'); drop table if exists report.mask; create table if not exists report.mask( type text[] default array[]::text[], mask text, name text, description character varying, representation text, function text, priority int2, constraint pk_reportformats primary key ( type, mask ) ); INSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', 'YYYY-MM-DD', 'DIARIO', 'APRESENTAÇÃO DIÁRIA', 'DD-MM-YYYY', 'to_char', 100); INSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', 'YYYY-MM', 'MENSAL', 'APRESENTAÇÃO MENSAL', 'MON "DE" YYYY', 'to_char', 90); INSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', 'YYYY', 'ANUAL', 'APESENTAÇÃO ANUAL', 'YYYY', 'to_char', 80); INSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', 'YYYY "T"Q', 'TRIMESTRAL', 'APRESENTAÇÃO TRIMESTRAL', 'YYYY "T"Q', 'to_char', 70); INSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', '2', 'SIMESTRAL', 'APRESENTAÇÃO SEMESTRAL', 'S', 'mouth_group', 60); INSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', 'YYYY-WW', 'SEMANAL', 'APRESENTAÇÃO SEMANAL', 'WW"ª SEM" "DE" YYYY', 'to_char', 50); INSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', 'YYYY-MM-W', 'SEMANAL MENSAL', 'APRESENTAÇÃO SEMANAL MENSAL', 'W"ª SEM" "DE" MON YYYY', 'to_char', 49); INSERT INTO report.mask (type, mask, name, description, representation, function, priority) VALUES ('{date,timestamp,timestamptz}', 'YYYY-MM-DD HH:MI', 'MOMENTANIO', 'APRESENTACÃO DIÁRIO INCLUINDO HORA E MINUTO', 'DD-MM-YYYY HH:MI', 'to_char', null); create or replace function report.____tg_report_format() returns trigger language plpgsql as $$ declare _source record; _repcoll report.vcolumn; _report report.report; begin if pg_typeof( new )::text::regclass = 'report.report'::regclass then _report := new; select * into _source from report.source_map( _report.report_source::regclass ); _report.report_source := _source.source_format; return _report; elsif pg_typeof( new )::text::regclass = 'report.vcolumn'::regclass then _repcoll := new; select * into _source from report.source_map( _repcoll.source::regclass ); _repcoll.source := _source.source_format; return _repcoll; end if; return new; end; $$; create trigger tg_report_format before insert or update on report.report for each row execute procedure report.____tg_report_format(); drop function if exists report.eval; create or replace function report.eval( expression text, args anyelement ) returns jsonb language plpgsql as $$ declare result text; statement text; begin statement := format( 'select to_jsonb((%s))', expression ); raise notice 'eval: %', statement; execute statement using args into result; return result; end $$; drop table if exists report.var; create table report.var(); alter table report.var add var_key text; alter table report.var add var_description text; alter table report.var add var_type text; alter table report.var add var_expression text; alter table report.var add constraint pk_value_key primary key ( var_key ); INSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('current_timestamp', 'Timestamp Atual', 'timestamp', 'select current_timestamp'); INSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('current_user', 'Current Database User', 'text', 'select "current_user"()'); INSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('current_collaborator', 'Collaborador atual', 'uuid', 'select $1->>''arg_colaborador_id'''); INSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('current_branch', 'Branch Atual', 'uuid', 'select coalesce( ($1->>''branch_uid'')::uuid, ( $1->>''arg_branch_id'')::uuid, ( $1->>''_branch_uid'')::uuid, ( $1->>''arg_branch_uid'')::uuid, tweeks.__branch_uid( ($1->>''arg_colaborador_id'')::uuid, ($1->>''arg_espaco_auth'' )::uuid))'); INSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('current_space', 'Espaço atual (Armazem Atual)', 'uuid', 'select $1->>''arg_espaco_auth'''); INSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('today', 'Hoje', 'date', 'select current_date'); INSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('yesterday', 'Ontem', 'date', 'select current_date - interval ''1'' day'); INSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('end_of_month', 'Fim do mês', 'date', 'select to_date(to_char(current_date + interval ''1'' month, ''yyyy-mm''), ''yyyy-mm'')-interval ''1'' day'); INSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('current_time', 'Hora atual', 'time', 'select current_time'); INSERT INTO report.var ( var_key, var_description, var_type, var_expression ) VALUES ('now', 'Momento atual', 'timestamptz', 'select now()'); create or replace function report.vars( args jsonb ) returns setof jsonb language plpgsql as $$ declare /** args := { var_key: [key, key, key], arg_colaborador_id::UID arg_espaco_id::UID source::(report-source) } */ _var_key text[] default array( select e.text from jsonb_array_elements_text( args->'var_key') e ( text ) ); begin if coalesce( array_length(_var_key, 1), 0 ) = 0 then select array_agg( var_key ) into _var_key from report.var v; end if; return query with __vars as ( select vk.*, report.eval( format( 'select (%s)::%s', vk.var_expression, vk.var_type ), '{}'::jsonb ) as value from report.var vk where vk.var_key = any( _var_key ) ) select to_jsonb( _vk ) from __vars _vk ; end; $$; create or replace function report.vcolumns(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /** args: { "source":"REPORT_SOURCE" }, */ _src character varying default args->>'source'; _source record; begin select * into _source from report.source_map( _src ); -- COLUMNS return query select jsonb_build_object( 'key', format( 'column|%s.%s', _src, rc.name ), 'column', rc.name, 'name', coalesce( rc.rename, rc.name ), 'type', 'column', 'format', rc.format, 'dataType', rc.type, 'init', rc.init ) from report.vcolumn rc where rc.source = _source.source_format and rc.show order by rc.position desc nulls last, coalesce( rc.rename, rc.name ) ; -- FILTER return query with __filters as ( select rc.*, f.ordinality, report.__template_of( f.doc, to_jsonb( rc ) || to_jsonb( _source ) || to_jsonb( r ) ) as doc from report.vcolumn rc inner join report.report r on rc.source = r.report_source inner join jsonb_array_elements( rc.filter ) with ordinality f( doc ) on true where rc.source = _source.source_format and jsonb_array_length( rc.filter ) > 0 ) select f.doc || jsonb_build_object( 'key', format( 'filter|%s.%s::#%s', _src, f.name, f.ordinality ), 'opr', f.doc->'opr', 'column', f.name, 'dataType', f.type, 'name', f.doc->'name', 'mode', f.doc->'mode', 'source', f.doc->'source', 'src', f.doc->'src', 'format', f.doc->'format', 'type', 'filter' ) from __filters f order by coalesce( ( f.doc->>'position')::int2, f.position ) desc nulls last, f.ordinality, coalesce( f.doc->>'name', f.name ) ; -- GROUP return query with __filters as ( select rc.*, agg.function as agg_function, agg.label as agg_label, agg.key as agg_key, agg.priority as agg_priority, lib.str_normalize( format( agg.name, rc.name ) ) as agg_name, agg.format as agg_format, lib.str_normalize( format( agg.rename, rc.name ) ) as agg_rename, agg.simple as agg_simple, agg.expression as agg_expresion, agg.over as agg_over, agg.types as agg_types, format( '%I', rc.name ) as agg_usecolumn, lib.str_normalize( format( agg.rename, rc.name ) ) as agg_userename from report.vcolumn rc inner join report.report r on rc.source = r.report_source inner join report.agg agg on rc.format = any( agg.types ) where rc.source = _source.source_format and rc.show ) select jsonb_build_object( 'key', format( 'aggregation|%s.%s::#%s', _src, f.name, f.agg_key ), 'column', f.name, 'name', f.agg_name, 'func', f.agg_function, -- f.doc -> 'func', 'format', coalesce( f.agg_format, f.format ), -- f.doc -> 'format', 'rename', f.agg_rename, 'type', 'group', 'label', f.agg_label, 'init', false, 'dataType', f.type, 'simple', format( f.agg_simple, f.agg_usecolumn ), 'expression', format( f.agg_expresion, f.agg_usecolumn, f.agg_rename ), 'priority', f.agg_priority, 'column_position', f.position, 'over', format( f.agg_over, f.agg_usecolumn, format( '\\\\\\\\:%s:#ROW_NUMBER', f.name ) ) ) from __filters f order by f.position desc nulls last, f.name, f.agg_priority nulls last; -- INDEPENDENT AGGREGATION return query with __vcolumn as ( select rc.*, agg.function, agg.label, agg.key, agg.priority, agg.simple, agg.expression, agg.over, agg.types, agg.format _agg_format, lib.str_normalize( format( agg.name, rc.name ) ) as _agg_name, lib.str_normalize( format( agg.rename, rc.name ) ) as _agg_rename from report.vcolumn rc inner join report.report r on rc.source = r.report_source inner join report.agg agg on rc.format = any( agg.types ) ), __filters as ( select rc.*, rc.function as agg_function, rc.label as agg_label, rc.key as agg_key, rc.priority as agg_priority, coalesce( e.doc->>'name', rc._agg_name ) as agg_name, coalesce( e.doc->>'format', rc._agg_format, rc.format ) as agg_format, coalesce( e.doc->>'rename', rc._agg_rename, e.doc->>'name', rc._agg_name ) as agg_rename, rc.simple as agg_simple, rc.expression as agg_expresion, rc.over as agg_over, rc.types as agg_types, format( '%I', rc.name ) as agg_usecolumn, format( '%I', coalesce( e.doc->>'rename', rc._agg_rename, e.doc->>'name', rc._agg_name, rc.name ) ) as agg_userename from __vcolumn rc inner join jsonb_array_elements( rc.agg ) with ordinality e( doc ) on true and ( e.doc->>'func' ) = rc.key where rc.source = _source.source_format and jsonb_array_length( rc.agg ) > 0 ) select jsonb_build_object( 'key', format( 'aggregation|%s.%s::#%s', _src, f.name, f.agg_key ), 'column', f.name, 'dataType', f.type, 'name', f.agg_name, 'func', f.agg_function, 'format', agg_format, 'rename', f.agg_rename, 'type', 'group', 'label', f.agg_label, 'init', false, 'simple', format( f.agg_simple, f.agg_usecolumn ), 'expression', format( f.agg_expresion, f.agg_usecolumn, f.agg_rename ), 'priority', f.agg_priority, 'column_position', f.position, 'over', format( f.agg_over, f.agg_usecolumn, format( '\\\\\\\\:%s:#ROW_NUMBER', f.name ) ) ) from __filters f order by f.position desc nulls last, f.name, f.agg_priority nulls last; end $$; create or replace function report.configs(args jsonb) returns SETOF jsonb language sql as $$ with __report as ( select r.*, jsonb_agg( conf.doc ) as configs from report.report r inner join report.vcolumns( jsonb_build_object('source', r.report_source ) ) conf ( doc ) on true where r.report_active group by r.report_source ) select to_jsonb( _r ) from __report _r order by _r.report_priority desc nulls last, _r.report_name nulls last $$; CREATE or replace FUNCTION report.sync(regclass, name text DEFAULT NULL::text, priority integer DEFAULT NULL::integer, active boolean DEFAULT true) RETURNS SETOF json LANGUAGE plpgsql AS $_$ declare _rec record; _report report.report; _source record; begin select * into _source from report.source_map( $1 ); active := coalesce( active, true ); with __columns as ( select col.column_name, format_type( pt.oid, atttypmod ) column_type, col.data_type = 'ARRAY' as is_array, col.column_default, col.is_generated = 'ALWAYS' as is_generated from information_schema.columns col inner join report.source_map( _source.source_class ) c on c.source_name = col.table_name and col.table_schema::regnamespace = c.source_schema::regnamespace inner join pg_attribute att on col.column_name = att.attname and att.attrelid = format( '%s.%s', col.table_schema, col.table_name )::regclass::oid inner join pg_type pt on att.atttypid = pt.oid where format('%s.%s', c.source_schema, c.source_name)::regclass = _source.source_class ) select array_agg( to_jsonb( c ) ) as configs, array_agg(c.column_name ) as columns into _rec from __columns c ; select * into _report from report.report r where r.report_source = cluster.__format( $1 ) ; _report.report_name := coalesce( name, _report.report_name, cluster.__format( $1 ) ); _report.report_source := _source.source_format; _report.report_columns := _rec.columns; _report.report_priority := priority; _report.report_active := active; select ("returning").* into _report from lib.sets( _report ); return next to_json( _report ); delete from report.vcolumn r where r.name != all ( _rec.columns ) and source = _source.source_format ; with __news as ( select n.doc->>'column_name' as name, n.doc->>'column_type' as type from unnest( _rec.configs ) n ( doc ) left join report.vcolumn rc on n.doc->>'column_name' = rc.name and rc.source = _source.source_format where rc.name is null ) insert into report.vcolumn ( source, name, filter, agg, type ) select _report.report_source, _n.name, jsonb_build_array(), jsonb_build_array(), _n.type from __news _n; with __updates as ( select n.doc->>'column_name' as name, n.doc->>'column_type' as type from unnest( _rec.configs ) n ( doc ) ) update report.vcolumn c set type = _up.type from __updates _up where c.name = _up.name and c.source = _source.source_format ; return query select to_json( rc ) from report.vcolumn rc where rc.source = _report.report_source ; end; $_$; create or replace function report.source_map(regclass) returns TABLE(source_name character varying, source_schema character varying, source_class regclass, source_format character varying, type text) language sql as $$ with __class as ( select pc.tablename::text, pc.schemaname::text, format( '%s.%s', pc.schemaname::regnamespace::text, pc.tablename )::regclass, format( '%s.%s', pc.schemaname::regnamespace::text, pc.tablename ), 'table' from pg_tables pc where (format( '%s.%s', pc.schemaname::regnamespace::text, pc.tablename )::regclass = $1) union all select pv.viewname::text, pv.schemaname::text, format( '%s.%s', pv.schemaname::regnamespace::text, pv.viewname )::regclass, format( '%s.%s', pv.schemaname::regnamespace::text, pv.viewname ), 'view' from pg_views pv where (format( '%s.%s', pv.schemaname::regnamespace::text, pv.viewname )::regclass = $1) ) select * from __class $$; create or replace function report.__template_of(ref jsonb, colconfigs jsonb) returns jsonb language plpgsql as $$ declare refname text; args jsonb; _name text; _type text; begin if ref is null then return null; end if; if jsonb_typeof( ref ) = 'object' then return ref; end if; if jsonb_typeof( ref ) = 'string' then refname = ref->>0; elseif jsonb_typeof( ref ) = 'array' then refname := ref->>0; args := ref->1; end if; if args is not null and jsonb_typeof( args ) != 'object' then raise exception 'args is not object, %', args ; end if; _type := (regexp_split_to_array( refname, '\\.' ))[1]; _name := ( select string_agg( u.text, '.' ) from unnest( ( regexp_split_to_array( refname, '\\.' ))[2:] ) u( text) ); -- raise exception 'type: %, _name: %, LENGTH: %', _type, _name, array_length (regexp_split_to_array( refname, '\\.' ), 1); if _type is null or _name is null or array_length(regexp_split_to_array( refname, '\\.' ), 1) < 2 then raise exception 'Type or name indeterminated %: ', ref; end if; declare _template record; _i record; _j record; _obj jsonb default jsonb_build_object(); _conversion text; _value jsonb; begin select * into _template from report.template t where type = _type and t.name = _name; if _template.name is null then raise exception 'Template not found with ref: % | type: % | name: %', ref, _type, _name; end if; for _i in select e.key, e.value, jsonb_typeof( e.value ) as type, case when jsonb_typeof( e.value ) in ( 'object', 'array' ) then e.value::text else e.value->>0 end as text from jsonb_each( _template.configs ) e loop if _i.type in ( 'string', 'boolean', 'null', 'number' ) then _value := _i.value; elsif _i.type = 'object' and (_i.value->>'$template')::boolean then _conversion := _i.value->>'$structure'; if _conversion is null then raise exception 'Null AQUI 452739'; end if; for _j in select e.key, e.value, jsonb_typeof( e.value ) as type, case when jsonb_typeof( e.value ) in ( 'object', 'array' ) then e.value::text else e.value->>0 end as text from jsonb_each( colConfigs ) e loop _conversion := replace( _conversion, format( '${%s}', _j.key ), coalesce( _j.text, '' ) ); if _conversion is null then raise exception 'Null AQUI 77736'; end if; end loop; for _j in select e.key, e.value, jsonb_typeof( e.value ) as type, case when jsonb_typeof( e.value ) in ( 'object', 'array' ) then e.value::text else e.value->>0 end as text from jsonb_each( args ) e loop _conversion := replace( _conversion, format( '${args.%s}', _j.key ), coalesce( _j.text, '' ) ); if _conversion is null then raise exception 'Null AQUI kjskdhs'; end if; end loop; _conversion := coalesce( _conversion, _i.value->>'$default', _i.value->>'$defaults' ); if _conversion is null then raise exception '#C001 Conversion is null template: %; key: %; value %; args <= %', _template.name , _j.key, _j.value, args; end if; if _conversion = _i.value->>'$structure' then _conversion := coalesce( _i.value->>'$default', _i.value->>'$defaults' ); end if; if _conversion is null then raise exception '#C002 Conversion is null template: %; key: %; value %; args <= %', _template.name , _j.key, _j.value, args; end if; if _i.value->>'$type' in ( 'string', 'text', 'varchar', 'character varying' ) then _value := to_jsonb( _conversion ); elseif _i.value->>'$type' in ( 'number', 'numeric', 'int', 'integer', 'double', 'double precision' ) then _value := to_jsonb( _conversion::numeric ); elseif _i.value->>'$type' in ( 'bool', 'boolean' ) then _value := to_jsonb( _conversion::boolean ); else _value := to_jsonb( _conversion ); end if; else _value := _i.value; end if; _obj := _obj || jsonb_build_object( _i.key, _value ); if _obj is null then raise exception 'Object is null in {%:%} args: % base: %', _i.key, _i.value, args, colConfigs; end if; if _value is null then raise exception 'Object.value is null in {%:%} args: % base: %', _i.key, _i.value, args, colConfigs; end if; if jsonb_typeof(_value) = 'null' then raise exception 'Type Object.value is null in {%:%} args: % base: %', _i.key, _i.value, args, colConfigs; end if; end loop; return _obj; end; end $$; create or replace function report.columns(regclass) returns TABLE(column_name text, column_type text, column_basetype text, column_default text, is_array boolean, is_generated boolean) strict language sql as $$ select col.column_name::text, format_type( pt.oid, atttypmod )::text column_type, case when col.data_type = 'ARRAY' then format_type( pt.typelem, atttypmod ) else format_type( pt.oid, atttypmod ) end as column_basetype, col.column_default::text, col.data_type = 'ARRAY' as is_array, col.is_generated = 'ALWAYS' as is_generated from information_schema.columns col inner join report.source_map( $1 ) c on c.source_name = col.table_name and col.table_schema::regnamespace = c.source_schema::regnamespace inner join pg_attribute att on col.column_name = att.attname and att.attrelid = format( '%s.%s', col.table_schema, col.table_name )::regclass::oid inner join pg_type pt on att.atttypid = pt.oid where format('%s.%s', c.source_schema, c.source_name)::regclass = $1 $$;
a9183ddb-3983-447b-96cb-69ddf0e9de73	\ndelete from report.template where type = 'agg';\n\ninsert into report.template( type, name, configs ) values ( 'agg', 'sum', '{\n  "name": { "$template": true, "$structure": "Soma de ${name}", "$default": "Somatorio", "$type": "text" },\n  "func": "sum",\n  "format":"int",\n  "rename": { "$template":true, "$default": "SOMA", "$structure": "SUM ${name}" },\n  "init": { "$template": true, "$structure": "${args.init}", "$default":false, "$type": "boolean" }\n}');\n\ninsert into report.template( type, name, configs ) values ( 'agg', 'sumMoney', '{\n  "name": { "$template": true, "$structure": "Soma de ${name}", "$default": "Somatorio", "$type": "text" },\n  "func": "sum",\n  "format":"money",\n  "rename": { "$template":true, "$default": "SOMA", "$structure": "SUM ${name}" },\n  "init": { "$template": true, "$structure": "${args.init}", "$default":false, "$type": "boolean" }\n}');\n\ninsert into report.template( type, name, configs ) values ( 'agg', 'sumMoney2', '{\n  "name": { "$template": true, "$structure": "${args.name}", "$default": "Somatorio", "$type": "text" },\n  "func": "sum",\n  "format":"money",\n  "rename": { "$template":true, "$default": "SOMA", "$structure": "${args.name}" },\n  "init": { "$template": true, "$structure": "${args.init}", "$default":false, "$type": "boolean" }\n}');\n\n\ninsert into report.template( type, name, configs ) values ( 'agg', 'count', '{\n  "name": { "$template": true, "$structure": "Contagem de ${name}", "$type": "text" },\n  "func": "count",\n  "format": "init",\n  "rename": { "$template":true, "$default": "TOTAL", "$structure": "TOTAL ${name}" },\n  "init":  { "$template": true, "$structure": "${args.init}", "$default":false, "$type": "boolean" }\n}');\n\ninsert into report.template( type, name, configs ) values ( 'agg', 'count2', '{\n  "name": { "$template": true, "$structure": "${args.name}", "$type": "text" },\n  "func": "count",\n  "format": "init",\n  "rename": { "$template":true, "$default": "TOTAL", "$structure": "${args.rename}" },\n  "init":  { "$template": true, "$structure": "${args.init}", "$default":false, "$type": "boolean" }\n}');\n	delete from report.template where type = 'agg'; insert into report.template( type, name, configs ) values ( 'agg', 'sum', '{ "name": { "$template": true, "$structure": "Soma de ${name}", "$default": "Somatorio", "$type": "text" }, "func": "sum", "format":"int", "rename": { "$template":true, "$default": "SOMA", "$structure": "SUM ${name}" }, "init": { "$template": true, "$structure": "${args.init}", "$default":false, "$type": "boolean" } }'); insert into report.template( type, name, configs ) values ( 'agg', 'sumMoney', '{ "name": { "$template": true, "$structure": "Soma de ${name}", "$default": "Somatorio", "$type": "text" }, "func": "sum", "format":"money", "rename": { "$template":true, "$default": "SOMA", "$structure": "SUM ${name}" }, "init": { "$template": true, "$structure": "${args.init}", "$default":false, "$type": "boolean" } }'); insert into report.template( type, name, configs ) values ( 'agg', 'sumMoney2', '{ "name": { "$template": true, "$structure": "${args.name}", "$default": "Somatorio", "$type": "text" }, "func": "sum", "format":"money", "rename": { "$template":true, "$default": "SOMA", "$structure": "${args.name}" }, "init": { "$template": true, "$structure": "${args.init}", "$default":false, "$type": "boolean" } }'); insert into report.template( type, name, configs ) values ( 'agg', 'count', '{ "name": { "$template": true, "$structure": "Contagem de ${name}", "$type": "text" }, "func": "count", "format": "init", "rename": { "$template":true, "$default": "TOTAL", "$structure": "TOTAL ${name}" }, "init": { "$template": true, "$structure": "${args.init}", "$default":false, "$type": "boolean" } }'); insert into report.template( type, name, configs ) values ( 'agg', 'count2', '{ "name": { "$template": true, "$structure": "${args.name}", "$type": "text" }, "func": "count", "format": "init", "rename": { "$template":true, "$default": "TOTAL", "$structure": "${args.rename}" }, "init": { "$template": true, "$structure": "${args.init}", "$default":false, "$type": "boolean" } }');
718e2f2f-a965-4fb5-8f08-d5796e6cdae6	\ncreate or replace function report.source_filter(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n    _source text default args->>'source';\n    _user uuid default args->>'user';\n    _space uuid default args->>'space';\n    _branch uuid default args->>'branch';\n    _const map.constant;\n  begin\n    _const := map.constant();\n\n    if _source = 'tweeks.posto' then\n      return query\n        with __posto as (\n          select\n              s.posto_id as id,\n              s.posto_designacao as label\n            from tweeks.posto s\n            where s._branch_uid = _branch\n        ) select to_jsonb( _p )\n          from __posto _p;\n    end if;\n\n    if _source = 'auth.colaborador' then\n      return query\n        with __posto as (\n          select\n            s.colaborador_id as id,\n            s.colaborador_nome as label\n          from auth.colaborador s\n          where s._branch_uid = _branch\n        ) select to_jsonb( _p )\n        from __posto _p;\n    end if;\n\n    if _source = 'tweeks.espaco' then\n      return query\n        with __posto as (\n          select\n            s.espaco_id as id,\n            s.espaco_nome as label\n          from tweeks.espaco s\n          where s.espaco_branch_uid = _branch\n        ) select to_jsonb( _p )\n        from __posto _p;\n    end if;\n\n    if _source = 'geoinfo.currency' then\n      return query\n        with __posto as (\n          select\n            s.currency_id as id,\n            s.currency_code as label\n          from geoinfo.currency s\n          where currency_code in ( 'STN', 'EUR', 'USD' )\n        ) select to_jsonb( _p )\n        from __posto _p;\n    end if;\n\n    if _source = 'tweeks.artigo' then\n      return query\n        with __posto as (\n          select\n            s.artigo_id as id,\n            s.artigo_nome as label\n          from tweeks.artigo s\n          where s._branch_uid = _branch\n          order by s.artigo_nome\n        ) select to_jsonb( _p )\n        from __posto _p;\n    end if;\n    \n    if _source = 'boolean|Y/N' then\n      return query\n        with __yes_no ( id, label ) as (\n          values ( true, 'SIM' )\n          union all values ( false, 'NÃO')\n        ) select to_jsonb( _p )\n        from __yes_no _p;\n    end if;\n\n    if _source = 'boolean|ON/OFF' then\n      return query\n        with __yes_no ( id, label ) as (\n          values ( true, 'ATIVO' )\n          union all values ( false, 'DESATIVO')\n        ) select to_jsonb( _p )\n        from __yes_no _p;\n    end if;\n\n    if _source = 'STATUS' then\n      return query\n        with __yes_no ( id, label ) as (\n          values ( 0, 'DESATIVO' )\n          union all values ( 1, 'ATIVO' )\n          union all values ( 2, 'PENDENTE' )\n          union all values ( -1, 'ANULADO' )\n        ) select to_jsonb( _p )\n        from __yes_no _p;\n    end if;\n\n    if _source = 'tweeks.toperacao' then\n      return query\n        with __posto as (\n          select\n            s.toperacao_id as id,\n            s.toperacao_designacao as label\n          from tweeks.toperacao s\n        ) select to_jsonb( _p )\n        from __posto _p;\n    end if;\n\n\n    if _source = 'tweeks.tgroup' then\n      return query\n        with __tgroup as (\n          select\n            s.tgrupo_id as id,\n            s.tgrupo_desc as label\n          from tweeks.tgrupo s\n        ) select to_jsonb( _p )\n        from __tgroup _p;\n    end if;\n\n    if _source = 'tweeks.tpaga' then\n      return query\n        with __posto as (\n          select\n            s.tpaga_id as id,\n            s.tpaga_designacao as label\n          from tweeks.tpaga s\n        ) select to_jsonb( _p )\n        from __posto _p;\n    end if;\n\n    if _source = 'tweeks.cliente' then\n      return query\n        with __posto as (\n          select\n            s.cliente_id as id,\n            s.cliente_titular as label\n          from tweeks.cliente s\n          where s._branch_uid = _branch\n        ) select to_jsonb( _p )\n        from __posto _p;\n    end if;\n\n    if _source = 'tweeks.fornecedor' then\n      return query\n        with __posto as (\n          select\n            s.fornecedor_id as id,\n            s.fornecedor_nome as label\n          from tweeks.fornecedor s\n          where s._branch_uid = _branch\n        ) select to_jsonb( _p )\n        from __posto _p;\n    end if;\n\n    if _source = 'tweeks.tipoimposto' then\n      return query\n        with __source as (\n          select\n            s.tipoimposto_id as id,\n            s.tipoimposto_codigo as label\n          from tweeks.tipoimposto s\n          where s._branch_uid = _branch\n        ) select to_jsonb( _s )\n        from __source _s;\n    end if;\n\n    if _source = 'tweeks.serie' then\n      return query\n        with __source as (\n          select\n            s.serie_id as id,\n            format( '%s (%s)', ts.tserie_desc,  s.serie_numero) as label\n          from tweeks.serie s\n            inner join tweeks.tserie ts on s.serie_tserie_id = ts.tserie_id\n          where s._branch_uid = _branch\n        ) select to_jsonb( _s )\n        from __source _s;\n    end if;\n\n    if _source = 'tweeks.tserie' then\n      return query\n        with __source as (\n          select\n            s.tserie_id as id,\n            s.tserie_desc as label\n          from tweeks.tserie s\n        ) select to_jsonb( _s )\n        from __source _s;\n    end if;\n\n    if _source = 'tweeks.tserie::venda' then\n      return query\n        with __source as (\n          select\n            s.tserie_id as id,\n            s.tserie_desc as label\n          from tweeks.tserie s\n          where tserie_id in (\n            _const.maguita_tserie_fatura,\n            _const.maguita_tserie_faturarecibo\n          )\n        ) select to_jsonb( _s )\n        from __source _s;\n    end if;\n\n    if _source = 'tweeks.caixa::estado' then\n      return query\n        with __source( id, label ) as (\n          values ( _const.maguita_caixa_estado_ativo, 'ABERTA' )\n          union all values ( _const.maguita_caixa_estado_fechado, 'FECHADA' )\n        ) select to_jsonb( _s )\n        from __source _s;\n    end if;\n\n    if _source = 'tweeks.lancamento::mode' then\n      return query\n        with __source( id, label ) as (\n          values ( _const.maguita_lancamento_mode_automatic, 'AUTOMATICO' )\n          union all values ( _const.maguita_lancamento_mode_manual, 'MANUAL' )\n        ) select to_jsonb( _s )\n        from __source _s;\n    end if;\n\n    if _source = 'tweeks.tlancamento' then\n      return query\n        with __source( id, label ) as (\n          select tlancamento_id, tlancamento_desc\n            from tweeks.tlancamento\n        ) select to_jsonb( _s )\n        from __source _s;\n    end if;\n\n    if _source = 'tweeks.tmovimento' then\n      return query\n        with __source( id, label ) as (\n          select tmovimento_multiplo, tmovimento_designacao\n            from tweeks.tmovimento\n        ) select to_jsonb( _s )\n        from __source _s;\n    end if;\n    \n    if _source = 'tweeks.classe' then\n      return query\n        with __source( id, label ) as (\n          select classe_id, classe_nome\n            from tweeks.classe\n        ) select to_jsonb( _s )\n        from __source _s\n        order by _s.label\n      ;\n    end if;\n    \n    if _source = 'tweeks.caixa' then\n      return query \n        with __caixa as (\n            select\n              caixa_id as id,\n              to_char( cx.caixa_dataatualizacao, 'YYYY-MM-DD HH24:MI') fecho,\n              coalesce( cx.caixa_dataatualizacao, cx.caixa_dataregistro ) as date,\n              p.posto_designacao,\n              cx.caixa_estado,\n              max(coalesce( cx.caixa_dataatualizacao, cx.caixa_dataregistro )) filter ( where cx.caixa_estado = (map.constant()).maguita_caixa_estado_fechado ) over ( partition by cx.caixa_posto_id ) last\n              from tweeks.caixa cx\n                inner join tweeks.posto p on cx.caixa_posto_id = p.posto_id\n              where cx._branch_uid = _branch\n              order by cx.caixa_dataatualizacao desc nulls first, cx.caixa_dataregistro desc\n          ), __source( id, label ) as (\n             select\n                cx.id,\n                format( '%s %s %s', cx.posto_designacao, cx.fecho,\n                  case\n                    when cx.caixa_estado = (map.constant()).maguita_caixa_estado_ativo then '(aberta)'\n                    when cx.date = cx.last then '(ultima fechada)'\n                  end\n                ) as label\n              from __caixa cx\n          ) select to_jsonb( _s )\n        from __source _s\n      ;\n    end if;\n  end;\n$$;\n\n	create or replace function report.source_filter(args jsonb) returns SETOF jsonb language plpgsql as $$ declare _source text default args->>'source'; _user uuid default args->>'user'; _space uuid default args->>'space'; _branch uuid default args->>'branch'; _const map.constant; begin _const := map.constant(); if _source = 'tweeks.posto' then return query with __posto as ( select s.posto_id as id, s.posto_designacao as label from tweeks.posto s where s._branch_uid = _branch ) select to_jsonb( _p ) from __posto _p; end if; if _source = 'auth.colaborador' then return query with __posto as ( select s.colaborador_id as id, s.colaborador_nome as label from auth.colaborador s where s._branch_uid = _branch ) select to_jsonb( _p ) from __posto _p; end if; if _source = 'tweeks.espaco' then return query with __posto as ( select s.espaco_id as id, s.espaco_nome as label from tweeks.espaco s where s.espaco_branch_uid = _branch ) select to_jsonb( _p ) from __posto _p; end if; if _source = 'geoinfo.currency' then return query with __posto as ( select s.currency_id as id, s.currency_code as label from geoinfo.currency s where currency_code in ( 'STN', 'EUR', 'USD' ) ) select to_jsonb( _p ) from __posto _p; end if; if _source = 'tweeks.artigo' then return query with __posto as ( select s.artigo_id as id, s.artigo_nome as label from tweeks.artigo s where s._branch_uid = _branch order by s.artigo_nome ) select to_jsonb( _p ) from __posto _p; end if; if _source = 'boolean|Y/N' then return query with __yes_no ( id, label ) as ( values ( true, 'SIM' ) union all values ( false, 'NÃO') ) select to_jsonb( _p ) from __yes_no _p; end if; if _source = 'boolean|ON/OFF' then return query with __yes_no ( id, label ) as ( values ( true, 'ATIVO' ) union all values ( false, 'DESATIVO') ) select to_jsonb( _p ) from __yes_no _p; end if; if _source = 'STATUS' then return query with __yes_no ( id, label ) as ( values ( 0, 'DESATIVO' ) union all values ( 1, 'ATIVO' ) union all values ( 2, 'PENDENTE' ) union all values ( -1, 'ANULADO' ) ) select to_jsonb( _p ) from __yes_no _p; end if; if _source = 'tweeks.toperacao' then return query with __posto as ( select s.toperacao_id as id, s.toperacao_designacao as label from tweeks.toperacao s ) select to_jsonb( _p ) from __posto _p; end if; if _source = 'tweeks.tgroup' then return query with __tgroup as ( select s.tgrupo_id as id, s.tgrupo_desc as label from tweeks.tgrupo s ) select to_jsonb( _p ) from __tgroup _p; end if; if _source = 'tweeks.tpaga' then return query with __posto as ( select s.tpaga_id as id, s.tpaga_designacao as label from tweeks.tpaga s ) select to_jsonb( _p ) from __posto _p; end if; if _source = 'tweeks.cliente' then return query with __posto as ( select s.cliente_id as id, s.cliente_titular as label from tweeks.cliente s where s._branch_uid = _branch ) select to_jsonb( _p ) from __posto _p; end if; if _source = 'tweeks.fornecedor' then return query with __posto as ( select s.fornecedor_id as id, s.fornecedor_nome as label from tweeks.fornecedor s where s._branch_uid = _branch ) select to_jsonb( _p ) from __posto _p; end if; if _source = 'tweeks.tipoimposto' then return query with __source as ( select s.tipoimposto_id as id, s.tipoimposto_codigo as label from tweeks.tipoimposto s where s._branch_uid = _branch ) select to_jsonb( _s ) from __source _s; end if; if _source = 'tweeks.serie' then return query with __source as ( select s.serie_id as id, format( '%s (%s)', ts.tserie_desc, s.serie_numero) as label from tweeks.serie s inner join tweeks.tserie ts on s.serie_tserie_id = ts.tserie_id where s._branch_uid = _branch ) select to_jsonb( _s ) from __source _s; end if; if _source = 'tweeks.tserie' then return query with __source as ( select s.tserie_id as id, s.tserie_desc as label from tweeks.tserie s ) select to_jsonb( _s ) from __source _s; end if; if _source = 'tweeks.tserie::venda' then return query with __source as ( select s.tserie_id as id, s.tserie_desc as label from tweeks.tserie s where tserie_id in ( _const.maguita_tserie_fatura, _const.maguita_tserie_faturarecibo ) ) select to_jsonb( _s ) from __source _s; end if; if _source = 'tweeks.caixa::estado' then return query with __source( id, label ) as ( values ( _const.maguita_caixa_estado_ativo, 'ABERTA' ) union all values ( _const.maguita_caixa_estado_fechado, 'FECHADA' ) ) select to_jsonb( _s ) from __source _s; end if; if _source = 'tweeks.lancamento::mode' then return query with __source( id, label ) as ( values ( _const.maguita_lancamento_mode_automatic, 'AUTOMATICO' ) union all values ( _const.maguita_lancamento_mode_manual, 'MANUAL' ) ) select to_jsonb( _s ) from __source _s; end if; if _source = 'tweeks.tlancamento' then return query with __source( id, label ) as ( select tlancamento_id, tlancamento_desc from tweeks.tlancamento ) select to_jsonb( _s ) from __source _s; end if; if _source = 'tweeks.tmovimento' then return query with __source( id, label ) as ( select tmovimento_multiplo, tmovimento_designacao from tweeks.tmovimento ) select to_jsonb( _s ) from __source _s; end if; if _source = 'tweeks.classe' then return query with __source( id, label ) as ( select classe_id, classe_nome from tweeks.classe ) select to_jsonb( _s ) from __source _s order by _s.label ; end if; if _source = 'tweeks.caixa' then return query with __caixa as ( select caixa_id as id, to_char( cx.caixa_dataatualizacao, 'YYYY-MM-DD HH24:MI') fecho, coalesce( cx.caixa_dataatualizacao, cx.caixa_dataregistro ) as date, p.posto_designacao, cx.caixa_estado, max(coalesce( cx.caixa_dataatualizacao, cx.caixa_dataregistro )) filter ( where cx.caixa_estado = (map.constant()).maguita_caixa_estado_fechado ) over ( partition by cx.caixa_posto_id ) last from tweeks.caixa cx inner join tweeks.posto p on cx.caixa_posto_id = p.posto_id where cx._branch_uid = _branch order by cx.caixa_dataatualizacao desc nulls first, cx.caixa_dataregistro desc ), __source( id, label ) as ( select cx.id, format( '%s %s %s', cx.posto_designacao, cx.fecho, case when cx.caixa_estado = (map.constant()).maguita_caixa_estado_ativo then '(aberta)' when cx.date = cx.last then '(ultima fechada)' end ) as label from __caixa cx ) select to_jsonb( _s ) from __source _s ; end if; end; $$;
98959aa7-9c6c-4385-9609-b0e53880dabc	\ndrop view if exists report.vreport_guiaentrada;\ncreate view report.vreport_guiaentrada as \n  select \n      em.entrada_lote as "LOTE",\n      em.entrada_quantidade as "QT",\n      em.entrada_descricao as "DESCRICAO",\n      em.entrada_quantidadeinicial as "QT ANTES",\n      em.entrada_validade as "VALIDADE",\n      em.entrada_custounitario as "$ UNIT",\n      (em.entrada_quantidade * em.entrada_custounitario) as "$ TOTAL",\n      g.guia_date as "DATA",\n      g.guia_documentoperacao as "DOCUMENTO",\n      g.guia_numero as "NUMERO",\n      g.guia_observacao as "OBS",\n      f.fornecedor_nome as "FORNECEDOR",\n      f.fornecedor_nif as "F. NIF",\n      f.fornecedor_code as "CÓD. FOR.",\n      e.espaco_nome as "ARMAZEM",\n      e.espaco_codigo as "CÓD. ARM.",\n      a.artigo_nome as "ARTIGO",\n      a.artigo_codigo as "CÓD. ART.",\n      cla.classe_nome as "CATEGORIA",\n      cla.classe_codigo as "CÓD. CAT.",\n      em.entrada_id,\n      g.guia_uid,\n      f.fornecedor_id,\n      e.espaco_id,\n      a.artigo_id,\n      cla.classe_id,\n      em._branch_uid\n    from tweeks.entrada em\n      inner join tweeks.guia g on em.entrada_guia_id = g.guia_uid\n      inner join tweeks.artigo a on em.entrada_artigo_id = a.artigo_id\n      inner join tweeks.classe cla on a.artigo_classe_id = cla.classe_id\n      left join tweeks.fornecedor f on f.fornecedor_id = (g.guia_refs->'fornecedor'->>'fornecedor_id')::uuid\n      left join tweeks.espaco e on e.espaco_id = (g.guia_refs->'destino'->>'espaco_id')::uuid\n;\n\nselect * from report.sync( 'report.vreport_guiaentrada', 'RELATÓRIO DE GUIA ENTRADA', 1200 );\n\nUPDATE report.vcolumn SET position = null, show = true, init = true, format = 'date', filter = '[{"opr": ">=", "name": "ENTRADA DE", "format": "date"}, {"opr": "<=", "name": "ENTRADA ATÉ", "format": "date"}]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_guiaentrada' AND name = 'DATA';\nUPDATE report.vcolumn SET position = null, show = true, init = true, format = 'code', filter = '[["query.like", {"mode": "right", "name": "DOCUMENTO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'DOCUMENTO';\nUPDATE report.vcolumn SET position = null, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiaentrada' AND name = '$ TOTAL';\nUPDATE report.vcolumn SET position = null, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiaentrada' AND name = '$ UNIT';\nUPDATE report.vcolumn SET position = null, show = true, init = true, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'ARMAZEM';\nUPDATE report.vcolumn SET position = null, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'ARTIGO';\nUPDATE report.vcolumn SET position = null, show = true, init = true, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'FORNECEDOR';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'date', filter = '[{"opr": ">=", "name": "VALIDO DE", "format": "date"}, {"opr": "<=", "name": "VALIDO ATÉ", "format": "date"}]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_guiaentrada' AND name = 'VALIDADE';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[["query.like", {"mode": "right", "name": "NUMERO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'NUMERO';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'CATEGORIA';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'CÓD. ARM.';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'CÓD. ART.';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'CÓD. CAT.';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'DESCRICAO';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'F. NIF';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'LOTE';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'OBS';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'int', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiaentrada' AND name = 'QT';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'int', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiaentrada' AND name = 'QT ANTES';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.artigo", {"name": "ARTIGO"}]]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiaentrada' AND name = 'artigo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]', agg = '[{"func": "count::distinct", "name": "TOTAL DE CLASSE", "rename": "??COUNT::DISTINCT TOTAL DE CLASSE"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiaentrada' AND name = 'classe_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ENTRADAS", "rename": "??COUNT::DISTINCT TOTAL DE ENTRADAS"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiaentrada' AND name = 'entrada_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.espaco", {"name": "ARMAZEM"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiaentrada' AND name = 'espaco_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.fornecedor", {"name": "FORNECEDOR"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiaentrada' AND name = 'fornecedor_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiaentrada' AND name = '_branch_uid';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'CÓD. FOR.';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiaentrada' AND name = 'guia_uid';\n\n\nselect *\nfrom report.vcolumn\nwhere source = 'report.vreport_guiaentrada'\norder by position desc nulls last,\n         show desc nulls last,\n         init desc nulls last,\n         jsonb_array_length( agg ) desc,\n         jsonb_array_length( filter ) desc,\n         source,\n         name\n;\n\n/*\n name:short\nname\ncode\ncode\nname:short\nname:short\nname:short\nname\nmoney\nint\nmoney\nmoney\nmoney\ncode\ncode\nmoney\nmoney\nmoney\ndate\ncode\nmoney\nname:mid\nid\nid\nid\nid\nid\nid\nid\nid\nid\nid\nid\n\n */\n\n	drop view if exists report.vreport_guiaentrada; create view report.vreport_guiaentrada as select em.entrada_lote as "LOTE", em.entrada_quantidade as "QT", em.entrada_descricao as "DESCRICAO", em.entrada_quantidadeinicial as "QT ANTES", em.entrada_validade as "VALIDADE", em.entrada_custounitario as "$ UNIT", (em.entrada_quantidade * em.entrada_custounitario) as "$ TOTAL", g.guia_date as "DATA", g.guia_documentoperacao as "DOCUMENTO", g.guia_numero as "NUMERO", g.guia_observacao as "OBS", f.fornecedor_nome as "FORNECEDOR", f.fornecedor_nif as "F. NIF", f.fornecedor_code as "CÓD. FOR.", e.espaco_nome as "ARMAZEM", e.espaco_codigo as "CÓD. ARM.", a.artigo_nome as "ARTIGO", a.artigo_codigo as "CÓD. ART.", cla.classe_nome as "CATEGORIA", cla.classe_codigo as "CÓD. CAT.", em.entrada_id, g.guia_uid, f.fornecedor_id, e.espaco_id, a.artigo_id, cla.classe_id, em._branch_uid from tweeks.entrada em inner join tweeks.guia g on em.entrada_guia_id = g.guia_uid inner join tweeks.artigo a on em.entrada_artigo_id = a.artigo_id inner join tweeks.classe cla on a.artigo_classe_id = cla.classe_id left join tweeks.fornecedor f on f.fornecedor_id = (g.guia_refs->'fornecedor'->>'fornecedor_id')::uuid left join tweeks.espaco e on e.espaco_id = (g.guia_refs->'destino'->>'espaco_id')::uuid ; select * from report.sync( 'report.vreport_guiaentrada', 'RELATÓRIO DE GUIA ENTRADA', 1200 ); UPDATE report.vcolumn SET position = null, show = true, init = true, format = 'date', filter = '[{"opr": ">=", "name": "ENTRADA DE", "format": "date"}, {"opr": "<=", "name": "ENTRADA ATÉ", "format": "date"}]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_guiaentrada' AND name = 'DATA'; UPDATE report.vcolumn SET position = null, show = true, init = true, format = 'code', filter = '[["query.like", {"mode": "right", "name": "DOCUMENTO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'DOCUMENTO'; UPDATE report.vcolumn SET position = null, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiaentrada' AND name = '$ TOTAL'; UPDATE report.vcolumn SET position = null, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiaentrada' AND name = '$ UNIT'; UPDATE report.vcolumn SET position = null, show = true, init = true, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'ARMAZEM'; UPDATE report.vcolumn SET position = null, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'ARTIGO'; UPDATE report.vcolumn SET position = null, show = true, init = true, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'FORNECEDOR'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'date', filter = '[{"opr": ">=", "name": "VALIDO DE", "format": "date"}, {"opr": "<=", "name": "VALIDO ATÉ", "format": "date"}]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_guiaentrada' AND name = 'VALIDADE'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[["query.like", {"mode": "right", "name": "NUMERO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'NUMERO'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'CATEGORIA'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'CÓD. ARM.'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'CÓD. ART.'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'CÓD. CAT.'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'DESCRICAO'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'F. NIF'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'LOTE'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'OBS'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'int', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiaentrada' AND name = 'QT'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'int', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiaentrada' AND name = 'QT ANTES'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.artigo", {"name": "ARTIGO"}]]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiaentrada' AND name = 'artigo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]', agg = '[{"func": "count::distinct", "name": "TOTAL DE CLASSE", "rename": "??COUNT::DISTINCT TOTAL DE CLASSE"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiaentrada' AND name = 'classe_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ENTRADAS", "rename": "??COUNT::DISTINCT TOTAL DE ENTRADAS"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiaentrada' AND name = 'entrada_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.espaco", {"name": "ARMAZEM"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiaentrada' AND name = 'espaco_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.fornecedor", {"name": "FORNECEDOR"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiaentrada' AND name = 'fornecedor_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiaentrada' AND name = '_branch_uid'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiaentrada' AND name = 'CÓD. FOR.'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiaentrada' AND name = 'guia_uid'; select * from report.vcolumn where source = 'report.vreport_guiaentrada' order by position desc nulls last, show desc nulls last, init desc nulls last, jsonb_array_length( agg ) desc, jsonb_array_length( filter ) desc, source, name ; /* name:short name code code name:short name:short name:short name money int money money money code code money money money date code money name:mid id id id id id id id id id id id */
c0095c03-fc50-4885-9629-62ca63c2cda4	\ndrop view if exists report.vreport_guiasaida;\n\ncreate view report.vreport_guiasaida as\nwith _const ( maguita_venda_estado_fechado, maguita_conta_estado_fechado, maguita_tserie_guiasaida) as ( \n  select\n    map.get('maguita_venda_estado_fechado')::int2,\n    map.get('maguita_conta_estado_fechado')::int2,\n    map.get('maguita_tserie_guiasaida')::int2,\n    map.get('maguita_tserie_guiasaida')::int2\n)  select\n      v.venda_id,\n      ct.conta_numerofatura as "SERIE",\n      a.artigo_nome as "ARTIGO",\n      cat.classe_nome as "CATEGORIA",\n      cat.classe_codigo as "CÓD. CAT.",\n      e.espaco_nome as "ARMAZÉM",\n      p.posto_designacao as "POSTO",\n      ct.conta_titularnif as "NIF",\n      ct.conta_titular as "CLIENTE",\n      v.venda_custounitario as "$ PREÇO",\n      v.venda_quantidade as "QT",\n      v.venda_montante as "$ MONT.",\n      v.venda_montanteagregado as "$ EXTRAS",\n      v.venda_montantetotal as "$ MONT+EXT",\n      v.venda_imposto as "$ IMPOSTO",\n      v.venda_montantesemimposto as "$ SUBTOTAL",\n      v.venda_montantecomimposto as "$ TOTAL",\n      ct.conta_montante as "$ MONTANTE FINAL",\n      v.venda_isencao,\n      string_agg( tip.tipoimposto_codigo, ', ' ) as "IMPOSTOS",\n      string_agg( format( '%s %s', coalesce( tx.taxa_percentagem, tx.taxa_taxa ),  case when tx.taxa_percentagem is not null then '%' else 'STN' end ), ', ' )\n        filter ( where tx.taxa_id is not null )\n        as "TAXAS",\n      array_agg( tip.tipoimposto_id ) as _tipoimposto_ids,\n      a.artigo_id,\n      ct.conta_datafecho::date as "DATA",\n      ct._tgrupo_id,\n      ct.conta_cliente_id,\n      p.posto_id,\n      e.espaco_id,\n      lib.str_normalize( format( '%s %s', aut.colaborador_nome, aut.colaborador_apelido ) ) as "COLABORADOR",\n      ct.conta_colaborador_fecho as colaborador_fecho,\n      cat.classe_id,\n      a.artigo_codigo as "CÓD ARTIGO",\n      v._branch_uid\n    from _const, tweeks.venda v\n      inner join tweeks.artigo a on v.venda_artigo_id = a.artigo_id\n      inner join tweeks.classe cat on a.artigo_classe_id = cat.classe_id\n      inner join tweeks.conta ct on v.venda_conta_id = ct.conta_id\n      inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id\n      inner join tweeks.espaco e on p.posto_espaco_auth = e.espaco_id\n      inner join auth.colaborador aut on ct.conta_colaborador_fecho = aut.colaborador_id\n      inner join tweeks.serie se on ct.conta_serie_id = se.serie_id\n      \n      left join tweeks.taxa tx on tx.taxa_id = any( v.venda_taxas )\n      left join tweeks.tipoimposto tip on tx.taxa_tipoimposto_id = tip.tipoimposto_id\n\n    where v.venda_estado = _const.maguita_venda_estado_fechado\n      and ct.conta_estado = _const.maguita_conta_estado_fechado\n      and se.serie_tserie_id in (\n        _const.maguita_tserie_guiasaida\n      )\n    \n    group by v.venda_id,\n      a.artigo_id,\n      ct.conta_id,\n      p.posto_id,\n      e.espaco_id,\n      cat.classe_id,\n      aut.colaborador_id\n;\n\nselect * from report.sync( 'report.vreport_guiasaida', 'RELATÓRIO DE GUIA SAIDA', 1100 );\n\nUPDATE report.vcolumn SET position = 2000, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'SERIE';\nUPDATE report.vcolumn SET position = 1995, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'ARTIGO';\nUPDATE report.vcolumn SET position = 1994, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'CÓD ARTIGO';\nUPDATE report.vcolumn SET position = 1895, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'CÓD. CAT.';\nUPDATE report.vcolumn SET position = 1894, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'CATEGORIA';\nUPDATE report.vcolumn SET position = 980, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'ARMAZÉM';\nUPDATE report.vcolumn SET position = 970, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'POSTO';\nUPDATE report.vcolumn SET position = 960, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'CLIENTE';\nUPDATE report.vcolumn SET position = 115, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ PREÇO';\nUPDATE report.vcolumn SET position = 114, show = true, init = true, format = 'int', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = 'QT';\nUPDATE report.vcolumn SET position = 113, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ MONT.';\nUPDATE report.vcolumn SET position = 112, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ EXTRAS';\nUPDATE report.vcolumn SET position = 111, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ MONT+EXT';\nUPDATE report.vcolumn SET position = 110, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_guiasaida' AND name = 'IMPOSTOS';\nUPDATE report.vcolumn SET position = 109, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_guiasaida' AND name = 'TAXAS';\nUPDATE report.vcolumn SET position = 107, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ IMPOSTO';\nUPDATE report.vcolumn SET position = 106, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ SUBTOTAL';\nUPDATE report.vcolumn SET position = 105, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ TOTAL';\nUPDATE report.vcolumn SET position = null, show = true, init = true, format = 'date', filter = '[{"opr": ">=", "name": "DATA INICO", "format": "date"}, {"opr": "<=", "name": "DATA FIM", "format": "date"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_guiasaida' AND name = 'DATA';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[["query.like", {"mode": "right", "name": "NIF"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'NIF';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ MONTANTE FINAL';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_guiasaida' AND name = 'COLABORADOR';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Artigo", "format": "select", "source": "tweeks.artigo"}]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = 'artigo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE VENDAS", "rename": "??COUNT::DISTINCT TOTAL DE VENDAS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = 'venda_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_guiasaida' AND name = '_tgrupo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = 'classe_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|auth.colaborador"]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = 'colaborador_fecho';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = 'conta_cliente_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "ARMAZÉM", "format": "select", "source": "tweeks.espaco"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = 'espaco_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = 'posto_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.boolean|Y/N", {"name": "ISENÇÃO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'boolean' WHERE source = 'report.vreport_guiasaida' AND name = 'venda_isencao';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = '_branch_uid';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid[]' WHERE source = 'report.vreport_guiasaida' AND name = '_tipoimposto_ids';\n\n\nselect *\n  from report.vcolumn\n  where source = 'report.vreport_guiasaida'\n  order by position desc nulls last,\n           show desc nulls last,\n           init desc nulls last,\n           jsonb_array_length( agg ) desc,\n           jsonb_array_length( filter ) desc,\n           source,\n           name\n;\n	drop view if exists report.vreport_guiasaida; create view report.vreport_guiasaida as with _const ( maguita_venda_estado_fechado, maguita_conta_estado_fechado, maguita_tserie_guiasaida) as ( select map.get('maguita_venda_estado_fechado')::int2, map.get('maguita_conta_estado_fechado')::int2, map.get('maguita_tserie_guiasaida')::int2, map.get('maguita_tserie_guiasaida')::int2 ) select v.venda_id, ct.conta_numerofatura as "SERIE", a.artigo_nome as "ARTIGO", cat.classe_nome as "CATEGORIA", cat.classe_codigo as "CÓD. CAT.", e.espaco_nome as "ARMAZÉM", p.posto_designacao as "POSTO", ct.conta_titularnif as "NIF", ct.conta_titular as "CLIENTE", v.venda_custounitario as "$ PREÇO", v.venda_quantidade as "QT", v.venda_montante as "$ MONT.", v.venda_montanteagregado as "$ EXTRAS", v.venda_montantetotal as "$ MONT+EXT", v.venda_imposto as "$ IMPOSTO", v.venda_montantesemimposto as "$ SUBTOTAL", v.venda_montantecomimposto as "$ TOTAL", ct.conta_montante as "$ MONTANTE FINAL", v.venda_isencao, string_agg( tip.tipoimposto_codigo, ', ' ) as "IMPOSTOS", string_agg( format( '%s %s', coalesce( tx.taxa_percentagem, tx.taxa_taxa ), case when tx.taxa_percentagem is not null then '%' else 'STN' end ), ', ' ) filter ( where tx.taxa_id is not null ) as "TAXAS", array_agg( tip.tipoimposto_id ) as _tipoimposto_ids, a.artigo_id, ct.conta_datafecho::date as "DATA", ct._tgrupo_id, ct.conta_cliente_id, p.posto_id, e.espaco_id, lib.str_normalize( format( '%s %s', aut.colaborador_nome, aut.colaborador_apelido ) ) as "COLABORADOR", ct.conta_colaborador_fecho as colaborador_fecho, cat.classe_id, a.artigo_codigo as "CÓD ARTIGO", v._branch_uid from _const, tweeks.venda v inner join tweeks.artigo a on v.venda_artigo_id = a.artigo_id inner join tweeks.classe cat on a.artigo_classe_id = cat.classe_id inner join tweeks.conta ct on v.venda_conta_id = ct.conta_id inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id inner join tweeks.espaco e on p.posto_espaco_auth = e.espaco_id inner join auth.colaborador aut on ct.conta_colaborador_fecho = aut.colaborador_id inner join tweeks.serie se on ct.conta_serie_id = se.serie_id left join tweeks.taxa tx on tx.taxa_id = any( v.venda_taxas ) left join tweeks.tipoimposto tip on tx.taxa_tipoimposto_id = tip.tipoimposto_id where v.venda_estado = _const.maguita_venda_estado_fechado and ct.conta_estado = _const.maguita_conta_estado_fechado and se.serie_tserie_id in ( _const.maguita_tserie_guiasaida ) group by v.venda_id, a.artigo_id, ct.conta_id, p.posto_id, e.espaco_id, cat.classe_id, aut.colaborador_id ; select * from report.sync( 'report.vreport_guiasaida', 'RELATÓRIO DE GUIA SAIDA', 1100 ); UPDATE report.vcolumn SET position = 2000, show = true, init = true, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'SERIE'; UPDATE report.vcolumn SET position = 1995, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'ARTIGO'; UPDATE report.vcolumn SET position = 1994, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'CÓD ARTIGO'; UPDATE report.vcolumn SET position = 1895, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'CÓD. CAT.'; UPDATE report.vcolumn SET position = 1894, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'CATEGORIA'; UPDATE report.vcolumn SET position = 980, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'ARMAZÉM'; UPDATE report.vcolumn SET position = 970, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'POSTO'; UPDATE report.vcolumn SET position = 960, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'CLIENTE'; UPDATE report.vcolumn SET position = 115, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ PREÇO'; UPDATE report.vcolumn SET position = 114, show = true, init = true, format = 'int', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = 'QT'; UPDATE report.vcolumn SET position = 113, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ MONT.'; UPDATE report.vcolumn SET position = 112, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ EXTRAS'; UPDATE report.vcolumn SET position = 111, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ MONT+EXT'; UPDATE report.vcolumn SET position = 110, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_guiasaida' AND name = 'IMPOSTOS'; UPDATE report.vcolumn SET position = 109, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_guiasaida' AND name = 'TAXAS'; UPDATE report.vcolumn SET position = 107, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ IMPOSTO'; UPDATE report.vcolumn SET position = 106, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ SUBTOTAL'; UPDATE report.vcolumn SET position = 105, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ TOTAL'; UPDATE report.vcolumn SET position = null, show = true, init = true, format = 'date', filter = '[{"opr": ">=", "name": "DATA INICO", "format": "date"}, {"opr": "<=", "name": "DATA FIM", "format": "date"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_guiasaida' AND name = 'DATA'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[["query.like", {"mode": "right", "name": "NIF"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_guiasaida' AND name = 'NIF'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_guiasaida' AND name = '$ MONTANTE FINAL'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_guiasaida' AND name = 'COLABORADOR'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Artigo", "format": "select", "source": "tweeks.artigo"}]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = 'artigo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE VENDAS", "rename": "??COUNT::DISTINCT TOTAL DE VENDAS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = 'venda_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_guiasaida' AND name = '_tgrupo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = 'classe_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|auth.colaborador"]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = 'colaborador_fecho'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = 'conta_cliente_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "ARMAZÉM", "format": "select", "source": "tweeks.espaco"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = 'espaco_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = 'posto_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.boolean|Y/N", {"name": "ISENÇÃO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'boolean' WHERE source = 'report.vreport_guiasaida' AND name = 'venda_isencao'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_guiasaida' AND name = '_branch_uid'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid[]' WHERE source = 'report.vreport_guiasaida' AND name = '_tipoimposto_ids'; select * from report.vcolumn where source = 'report.vreport_guiasaida' order by position desc nulls last, show desc nulls last, init desc nulls last, jsonb_array_length( agg ) desc, jsonb_array_length( filter ) desc, source, name ;
821c9e66-0aa7-4dfd-88c5-1ed830a0183e	\ndrop view if exists report.vreport_imposto;\n\ncreate or replace view report.vreport_imposto as\nwith __imposto_report as (\n  select\n      tip.tipoimposto_id,\n      tip.tipoimposto_codigo "CODIGO",\n      tip.tipoimposto_nome "IMPOSTO",\n      art.artigo_codigo as "CÓD. ART.",\n      art.artigo_nome as "ARTIGO",\n      cla.classe_nome as "CATEGORIA",\n      cla.classe_codigo as "CÓD. CATEGORIA",\n      ct.conta_titular as "CLIENTE",\n      ct.conta_titularnif as "NIF",\n      ct.conta_numerofatura as "FATURA",\n      \n      case\n        when tx.taxa_percentagem is not null then format( '%s %s', tx.taxa_percentagem, '%' )\n        else format( '%s %s', tx.taxa_taxa, 'STN' )\n      end as "TAXA",\n    \n      ve.venda_impostoadicionar as "+$ IMPOSTO",\n      ve.venda_impostoretirar as "-$ IMPOSTO",\n      ve.venda_imposto as "$ IMPOSTO",\n      case\n        when ve.venda_isencao then 'SIM'\n        else 'NÃO'\n      end as "ISENÇÃO",\n      ve.venda_montantesemimposto as "$ SUBTOTAL",\n      ve.venda_montantecomimposto as "$ TOTAL",\n      s.serie_id,\n      s.serie_numero as "NUM. SERIE",\n      s.serie_designacao as "SERIE",\n      s.serie_numatorizacao as "CERT. SERIE",\n      ts.tserie_desc as "TIPO SERIE",\n      col.colaborador_nome as "COLABORADOR",\n      ct.conta_datafecho as "DATA",\n      ct.conta_datafecho::date as _date,\n      ve.venda_isencao,\n      ve._branch_uid,\n      col.colaborador_id,\n      ts.tserie_id,\n      art.artigo_id,\n      ve.venda_id,\n      cla.classe_id\n\n    from tweeks.tipoimposto tip\n      inner join tweeks.taxa tx on tip.tipoimposto_id = tx.taxa_tipoimposto_id\n      inner join tweeks.venda ve on tx.taxa_id = any( ve.venda_taxas )\n      inner join tweeks.artigo art on venda_artigo_id = art.artigo_id\n      inner join tweeks.classe cla on art.artigo_classe_id = cla.classe_id\n      inner join tweeks.conta ct on ve.venda_conta_id = ct.conta_id\n      inner join auth.colaborador col on ct.conta_colaborador_fecho = col.colaborador_id\n      inner join tweeks.serie s on  (ct.conta_serie->>'serie_id')::uuid = s.serie_id\n      inner join tweeks.tserie ts on s.serie_tserie_id = ts.tserie_id\n) select * from __imposto_report\n;\n\nselect * from report.sync( 'report.vreport_imposto', 'RELATÓRIO DE IMPOSTO', 1400 );\n\nUPDATE report.vcolumn SET position = 995, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'CODIGO';\nUPDATE report.vcolumn SET position = 985, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'IMPOSTO';\nUPDATE report.vcolumn SET position = 976, show = true, init = true, format = 'code', filter = '[["query.like", {"mode": "right", "name": "CÓDIGO DE ARTIGO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'CÓD. ART.';\nUPDATE report.vcolumn SET position = 975, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'ARTIGO';\nUPDATE report.vcolumn SET position = 974, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'CATEGORIA';\nUPDATE report.vcolumn SET position = 973, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'CÓD. CATEGORIA';\nUPDATE report.vcolumn SET position = 965, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'CLIENTE';\nUPDATE report.vcolumn SET position = 955, show = true, init = true, format = 'code', filter = '[["query.like", {"mode": "right", "name": "NIF"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'NIF';\nUPDATE report.vcolumn SET position = 945, show = true, init = true, format = 'code:long', filter = '[["query.like", {"mode": "right", "name": "FATURA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'FATURA';\nUPDATE report.vcolumn SET position = 795, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_imposto' AND name = 'TAXA';\nUPDATE report.vcolumn SET position = 785, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_imposto' AND name = '+$ IMPOSTO';\nUPDATE report.vcolumn SET position = 775, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_imposto' AND name = '-$ IMPOSTO';\nUPDATE report.vcolumn SET position = 765, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_imposto' AND name = '$ IMPOSTO';\nUPDATE report.vcolumn SET position = 755, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_imposto' AND name = 'ISENÇÃO';\nUPDATE report.vcolumn SET position = 745, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_imposto' AND name = '$ SUBTOTAL';\nUPDATE report.vcolumn SET position = 735, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_imposto' AND name = '$ TOTAL';\nUPDATE report.vcolumn SET position = 596, show = true, init = true, format = 'code', filter = '[["query.like", {"mode": "right", "name": "NUMERO DE SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'NUM. SERIE';\nUPDATE report.vcolumn SET position = 595, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'SERIE';\nUPDATE report.vcolumn SET position = 584, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'CERT. SERIE';\nUPDATE report.vcolumn SET position = 575, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'TIPO SERIE';\nUPDATE report.vcolumn SET position = 95, show = true, init = true, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'COLABORADOR';\nUPDATE report.vcolumn SET position = 85, show = true, init = true, format = 'timestamp', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_imposto' AND name = 'DATA';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.artigo", {"name": "ARTIGO"}]]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_imposto' AND name = 'artigo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE VENDAS", "rename": "??COUNT::DISTINCT TOTAL DE VENDAS"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_imposto' AND name = 'venda_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'date', filter = '[["query.range|start", {"name": "DATA INICIO"}], ["query.range|end", {"name": "DATA FIM"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_imposto' AND name = '_date';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_imposto' AND name = 'classe_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[["query.source|auth.colaborador", {"name": "COLABORADOR"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_imposto' AND name = 'colaborador_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[["query.source|tweeks.serie", {"name": "SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_imposto' AND name = 'serie_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[["query.source|tweeks.tipoimposto", {"name": "TIPO IMPOSTO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_imposto' AND name = 'tipoimposto_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[["query.source|tweeks.tserie", {"name": "TIPO DE SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_imposto' AND name = 'tserie_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[["query.boolean|Y/N", {"name": "ISENÇÃO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'boolean' WHERE source = 'report.vreport_imposto' AND name = 'venda_isencao';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_imposto' AND name = '_branch_uid';\n\n\nselect *\n  from report.vcolumn\n  where source = 'report.vreport_imposto'\n  order by position desc nulls last,\n    show desc nulls last,\n    init desc nulls last,\n    jsonb_array_length( agg ) desc,\n    jsonb_array_length( filter ) desc,\n    source,\n    name\n;\n\n	drop view if exists report.vreport_imposto; create or replace view report.vreport_imposto as with __imposto_report as ( select tip.tipoimposto_id, tip.tipoimposto_codigo "CODIGO", tip.tipoimposto_nome "IMPOSTO", art.artigo_codigo as "CÓD. ART.", art.artigo_nome as "ARTIGO", cla.classe_nome as "CATEGORIA", cla.classe_codigo as "CÓD. CATEGORIA", ct.conta_titular as "CLIENTE", ct.conta_titularnif as "NIF", ct.conta_numerofatura as "FATURA", case when tx.taxa_percentagem is not null then format( '%s %s', tx.taxa_percentagem, '%' ) else format( '%s %s', tx.taxa_taxa, 'STN' ) end as "TAXA", ve.venda_impostoadicionar as "+$ IMPOSTO", ve.venda_impostoretirar as "-$ IMPOSTO", ve.venda_imposto as "$ IMPOSTO", case when ve.venda_isencao then 'SIM' else 'NÃO' end as "ISENÇÃO", ve.venda_montantesemimposto as "$ SUBTOTAL", ve.venda_montantecomimposto as "$ TOTAL", s.serie_id, s.serie_numero as "NUM. SERIE", s.serie_designacao as "SERIE", s.serie_numatorizacao as "CERT. SERIE", ts.tserie_desc as "TIPO SERIE", col.colaborador_nome as "COLABORADOR", ct.conta_datafecho as "DATA", ct.conta_datafecho::date as _date, ve.venda_isencao, ve._branch_uid, col.colaborador_id, ts.tserie_id, art.artigo_id, ve.venda_id, cla.classe_id from tweeks.tipoimposto tip inner join tweeks.taxa tx on tip.tipoimposto_id = tx.taxa_tipoimposto_id inner join tweeks.venda ve on tx.taxa_id = any( ve.venda_taxas ) inner join tweeks.artigo art on venda_artigo_id = art.artigo_id inner join tweeks.classe cla on art.artigo_classe_id = cla.classe_id inner join tweeks.conta ct on ve.venda_conta_id = ct.conta_id inner join auth.colaborador col on ct.conta_colaborador_fecho = col.colaborador_id inner join tweeks.serie s on (ct.conta_serie->>'serie_id')::uuid = s.serie_id inner join tweeks.tserie ts on s.serie_tserie_id = ts.tserie_id ) select * from __imposto_report ; select * from report.sync( 'report.vreport_imposto', 'RELATÓRIO DE IMPOSTO', 1400 ); UPDATE report.vcolumn SET position = 995, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'CODIGO'; UPDATE report.vcolumn SET position = 985, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'IMPOSTO'; UPDATE report.vcolumn SET position = 976, show = true, init = true, format = 'code', filter = '[["query.like", {"mode": "right", "name": "CÓDIGO DE ARTIGO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'CÓD. ART.'; UPDATE report.vcolumn SET position = 975, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'ARTIGO'; UPDATE report.vcolumn SET position = 974, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'CATEGORIA'; UPDATE report.vcolumn SET position = 973, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'CÓD. CATEGORIA'; UPDATE report.vcolumn SET position = 965, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'CLIENTE'; UPDATE report.vcolumn SET position = 955, show = true, init = true, format = 'code', filter = '[["query.like", {"mode": "right", "name": "NIF"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'NIF'; UPDATE report.vcolumn SET position = 945, show = true, init = true, format = 'code:long', filter = '[["query.like", {"mode": "right", "name": "FATURA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'FATURA'; UPDATE report.vcolumn SET position = 795, show = true, init = true, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_imposto' AND name = 'TAXA'; UPDATE report.vcolumn SET position = 785, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_imposto' AND name = '+$ IMPOSTO'; UPDATE report.vcolumn SET position = 775, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_imposto' AND name = '-$ IMPOSTO'; UPDATE report.vcolumn SET position = 765, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_imposto' AND name = '$ IMPOSTO'; UPDATE report.vcolumn SET position = 755, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_imposto' AND name = 'ISENÇÃO'; UPDATE report.vcolumn SET position = 745, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_imposto' AND name = '$ SUBTOTAL'; UPDATE report.vcolumn SET position = 735, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_imposto' AND name = '$ TOTAL'; UPDATE report.vcolumn SET position = 596, show = true, init = true, format = 'code', filter = '[["query.like", {"mode": "right", "name": "NUMERO DE SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'NUM. SERIE'; UPDATE report.vcolumn SET position = 595, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'SERIE'; UPDATE report.vcolumn SET position = 584, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'CERT. SERIE'; UPDATE report.vcolumn SET position = 575, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'TIPO SERIE'; UPDATE report.vcolumn SET position = 95, show = true, init = true, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_imposto' AND name = 'COLABORADOR'; UPDATE report.vcolumn SET position = 85, show = true, init = true, format = 'timestamp', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'timestamp with time zone' WHERE source = 'report.vreport_imposto' AND name = 'DATA'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.artigo", {"name": "ARTIGO"}]]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_imposto' AND name = 'artigo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE VENDAS", "rename": "??COUNT::DISTINCT TOTAL DE VENDAS"}]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_imposto' AND name = 'venda_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'date', filter = '[["query.range|start", {"name": "DATA INICIO"}], ["query.range|end", {"name": "DATA FIM"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_imposto' AND name = '_date'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_imposto' AND name = 'classe_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[["query.source|auth.colaborador", {"name": "COLABORADOR"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_imposto' AND name = 'colaborador_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[["query.source|tweeks.serie", {"name": "SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_imposto' AND name = 'serie_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[["query.source|tweeks.tipoimposto", {"name": "TIPO IMPOSTO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_imposto' AND name = 'tipoimposto_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[["query.source|tweeks.tserie", {"name": "TIPO DE SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_imposto' AND name = 'tserie_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[["query.boolean|Y/N", {"name": "ISENÇÃO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'boolean' WHERE source = 'report.vreport_imposto' AND name = 'venda_isencao'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = null, filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_imposto' AND name = '_branch_uid'; select * from report.vcolumn where source = 'report.vreport_imposto' order by position desc nulls last, show desc nulls last, init desc nulls last, jsonb_array_length( agg ) desc, jsonb_array_length( filter ) desc, source, name ;
fbb34631-0206-4e82-a867-a325942c940e	\ndrop view if exists report.vreport_notacredito;\n\ncreate view report.vreport_notacredito as\nwith _const ( maguita_venda_estado_fechado, maguita_conta_estado_fechado, maguita_tserie_notacredito ) as ( \n  select \n    map.get('maguita_venda_estado_fechado')::int2\n    , map.get( 'maguita_conta_estado_fechado' )::int2\n    , map.get( 'maguita_tserie_notacredito' )::int2\n)\nselect\n    v.venda_id,\n    ct.conta_numerofatura as "DOCUMENTO",\n    ct.conta_observacao as "JUSTIFICATIVA",\n    ctorigem.conta_numerofatura as "DOC. ORIGEM",\n    a.artigo_nome as "ARTIGO",\n    cat.classe_nome as "CATEGORIA",\n    cat.classe_codigo as "CÓD. CAT.",\n    e.espaco_nome as "ARMAZÉM",\n    p.posto_designacao as "POSTO",\n    ct.conta_titularnif as "NIF",\n    ct.conta_titular as "CLIENTE",\n    v.venda_custounitario as "$ PREÇO",\n    v.venda_quantidade as "QT",\n    v.venda_montante as "$ MONT.",\n    v.venda_montanteagregado as "$ EXTRAS",\n    v.venda_montantetotal as "$ MONT+EXT",\n    v.venda_imposto as "$ IMPOSTO",\n    v.venda_montantesemimposto as "$ SUBTOTAL",\n    v.venda_montantecomimposto as "$ TOTAL",\n    ct.conta_montante as "$ MONTANTE FINAL",\n    v.venda_isencao,\n    case\n        when venda_isencao then 'SIM' else 'NÃO'\n        end as "ISEN.",\n    string_agg( tip.tipoimposto_codigo, ', ' ) as "IMPOSTOS",\n    string_agg( format( '%s %s', coalesce( tx.taxa_percentagem, tx.taxa_taxa ),  case when tx.taxa_percentagem is not null then '%' else 'STN' end ), ', ' )\n    filter ( where tx.taxa_id is not null )\n        as "TAXAS",\n    array_agg( tip.tipoimposto_id ) as _tipoimposto_ids,\n    a.artigo_id,\n    ct.conta_datafecho::date as "DATA",\n    ts.tserie_id,\n    ts.tserie_desc as "SERIE",\n    ct._tgrupo_id,\n    ct.conta_cliente_id,\n    p.posto_id,\n    e.espaco_id,\n    lib.str_normalize( format( '%s %s', aut.colaborador_nome, aut.colaborador_apelido ) ) as "COLABORADOR",\n    v._branch_uid,\n    ct.conta_colaborador_fecho as colaborador_fecho,\n    cat.classe_id,\n    de.deposito_id,\n    de.deposito_caixa_id as _caixa_id,\n    cx.caixa_code as "CAIXA",\n    a.artigo_codigo as "CÓD ARTIGO"\nfrom _const, tweeks.venda v\n    inner join tweeks.artigo a on v.venda_artigo_id = a.artigo_id\n    inner join tweeks.classe cat on a.artigo_classe_id = cat.classe_id\n    inner join tweeks.conta ct on v.venda_conta_id = ct.conta_id\n    inner join tweeks.conta ctorigem on ct.conta_conta_docorigin = ctorigem.conta_id\n    inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id\n    inner join tweeks.espaco e on p.posto_espaco_auth = e.espaco_id\n    inner join auth.colaborador aut on ct.conta_colaborador_fecho = aut.colaborador_id\n    inner join tweeks.serie se on ct.conta_serie_id = se.serie_id\n    inner join tweeks.tserie ts on se.serie_tserie_id = ts.tserie_id\n    left join tweeks.deposito de on ( de.deposito_referencia->>'conta_id' )::uuid = ct.conta_id\n    and de.deposito_posto_id = p.posto_id\n    and de.deposito_documento = ct.conta_numerofatura\n                 left join tweeks.caixa cx on de.deposito_caixa_id = cx.caixa_id\n\n                 left join tweeks.taxa tx on tx.taxa_id = any( v.venda_taxas )\n                 left join tweeks.tipoimposto tip on tx.taxa_tipoimposto_id = tip.tipoimposto_id\n\nwhere v.venda_estado = _const.maguita_venda_estado_fechado\n  and ct.conta_estado = _const.maguita_conta_estado_fechado\n  and se.serie_tserie_id in (\n        _const.maguita_tserie_notacredito\n    )\ngroup by v.venda_id,\n         a.artigo_id,\n         ct.conta_id,\n         ctorigem.conta_id,\n         p.posto_id,\n         de.deposito_id,\n         e.espaco_id,\n         cat.classe_id,\n         aut.colaborador_id,\n         ts.tserie_id,\n         cx.caixa_id\n;\n\nselect * from report.sync( 'report.vreport_notacredito', 'RELATÓRIO DE NOTA CREDITO', 1500 );\n\nUPDATE report.vcolumn SET position = 2000, show = true, init = false, format = 'code:long', filter = '[{"opr": "like", "mode": "right", "name": "DOCUMENTO", "format": "simple"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'DOCUMENTO';\nUPDATE report.vcolumn SET position = 1999, show = true, init = true, format = 'code:long', filter = '[{"opr": "like", "mode": "right", "name": "DOC. ORIGEM", "format": "simple"}]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'DOC. ORIGEM';\nUPDATE report.vcolumn SET position = 1995, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'ARTIGO';\nUPDATE report.vcolumn SET position = 1994, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'CÓD ARTIGO';\nUPDATE report.vcolumn SET position = 1895, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'CÓD. CAT.';\nUPDATE report.vcolumn SET position = 1894, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'CATEGORIA';\nUPDATE report.vcolumn SET position = 980, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'ARMAZÉM';\nUPDATE report.vcolumn SET position = 970, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'POSTO';\nUPDATE report.vcolumn SET position = 960, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'CLIENTE';\nUPDATE report.vcolumn SET position = 115, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ PREÇO';\nUPDATE report.vcolumn SET position = 114, show = true, init = true, format = 'int', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = 'QT';\nUPDATE report.vcolumn SET position = 113, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ MONT.';\nUPDATE report.vcolumn SET position = 112, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ EXTRAS';\nUPDATE report.vcolumn SET position = 111, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ MONT+EXT';\nUPDATE report.vcolumn SET position = 110, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_notacredito' AND name = 'IMPOSTOS';\nUPDATE report.vcolumn SET position = 109, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_notacredito' AND name = 'TAXAS';\nUPDATE report.vcolumn SET position = 108, show = false, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_notacredito' AND name = 'ISEN.';\nUPDATE report.vcolumn SET position = 107, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ IMPOSTO';\nUPDATE report.vcolumn SET position = 106, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ SUBTOTAL';\nUPDATE report.vcolumn SET position = 105, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ TOTAL';\nUPDATE report.vcolumn SET position = null, show = true, init = true, format = 'date', filter = '[{"opr": ">=", "name": "DATA INICO", "format": "date"}, {"opr": "<=", "name": "DATA FIM", "format": "date"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_notacredito' AND name = 'DATA';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[["query.like", {"mode": "right", "name": "NIF"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'NIF';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ MONTANTE FINAL';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'CAIXA';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_notacredito' AND name = 'COLABORADOR';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'text', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'JUSTIFICATIVA';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'SERIE';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Artigo", "format": "select", "source": "tweeks.artigo"}]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'artigo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE VENDAS", "rename": "??COUNT::DISTINCT TOTAL DE VENDAS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'venda_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.caixa", {"name": "CAIXA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = '_caixa_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_notacredito' AND name = '_tgrupo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'classe_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|auth.colaborador"]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'colaborador_fecho';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'conta_cliente_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "ARMAZÉM", "format": "select", "source": "tweeks.espaco"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'espaco_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'posto_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tserie::venda", {"name": "SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_notacredito' AND name = 'tserie_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.boolean|Y/N", {"name": "ISENÇÃO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'boolean' WHERE source = 'report.vreport_notacredito' AND name = 'venda_isencao';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = '_branch_uid';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid[]' WHERE source = 'report.vreport_notacredito' AND name = '_tipoimposto_ids';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'deposito_id';\n\nselect *\nfrom report.vcolumn\nwhere source = 'report.vreport_notacredito'\norder by position desc nulls last,\n         show desc nulls last,\n         init desc nulls last,\n         jsonb_array_length( agg ) desc,\n         jsonb_array_length( filter ) desc,\n         source,\n         name\n;\n	drop view if exists report.vreport_notacredito; create view report.vreport_notacredito as with _const ( maguita_venda_estado_fechado, maguita_conta_estado_fechado, maguita_tserie_notacredito ) as ( select map.get('maguita_venda_estado_fechado')::int2 , map.get( 'maguita_conta_estado_fechado' )::int2 , map.get( 'maguita_tserie_notacredito' )::int2 ) select v.venda_id, ct.conta_numerofatura as "DOCUMENTO", ct.conta_observacao as "JUSTIFICATIVA", ctorigem.conta_numerofatura as "DOC. ORIGEM", a.artigo_nome as "ARTIGO", cat.classe_nome as "CATEGORIA", cat.classe_codigo as "CÓD. CAT.", e.espaco_nome as "ARMAZÉM", p.posto_designacao as "POSTO", ct.conta_titularnif as "NIF", ct.conta_titular as "CLIENTE", v.venda_custounitario as "$ PREÇO", v.venda_quantidade as "QT", v.venda_montante as "$ MONT.", v.venda_montanteagregado as "$ EXTRAS", v.venda_montantetotal as "$ MONT+EXT", v.venda_imposto as "$ IMPOSTO", v.venda_montantesemimposto as "$ SUBTOTAL", v.venda_montantecomimposto as "$ TOTAL", ct.conta_montante as "$ MONTANTE FINAL", v.venda_isencao, case when venda_isencao then 'SIM' else 'NÃO' end as "ISEN.", string_agg( tip.tipoimposto_codigo, ', ' ) as "IMPOSTOS", string_agg( format( '%s %s', coalesce( tx.taxa_percentagem, tx.taxa_taxa ), case when tx.taxa_percentagem is not null then '%' else 'STN' end ), ', ' ) filter ( where tx.taxa_id is not null ) as "TAXAS", array_agg( tip.tipoimposto_id ) as _tipoimposto_ids, a.artigo_id, ct.conta_datafecho::date as "DATA", ts.tserie_id, ts.tserie_desc as "SERIE", ct._tgrupo_id, ct.conta_cliente_id, p.posto_id, e.espaco_id, lib.str_normalize( format( '%s %s', aut.colaborador_nome, aut.colaborador_apelido ) ) as "COLABORADOR", v._branch_uid, ct.conta_colaborador_fecho as colaborador_fecho, cat.classe_id, de.deposito_id, de.deposito_caixa_id as _caixa_id, cx.caixa_code as "CAIXA", a.artigo_codigo as "CÓD ARTIGO" from _const, tweeks.venda v inner join tweeks.artigo a on v.venda_artigo_id = a.artigo_id inner join tweeks.classe cat on a.artigo_classe_id = cat.classe_id inner join tweeks.conta ct on v.venda_conta_id = ct.conta_id inner join tweeks.conta ctorigem on ct.conta_conta_docorigin = ctorigem.conta_id inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id inner join tweeks.espaco e on p.posto_espaco_auth = e.espaco_id inner join auth.colaborador aut on ct.conta_colaborador_fecho = aut.colaborador_id inner join tweeks.serie se on ct.conta_serie_id = se.serie_id inner join tweeks.tserie ts on se.serie_tserie_id = ts.tserie_id left join tweeks.deposito de on ( de.deposito_referencia->>'conta_id' )::uuid = ct.conta_id and de.deposito_posto_id = p.posto_id and de.deposito_documento = ct.conta_numerofatura left join tweeks.caixa cx on de.deposito_caixa_id = cx.caixa_id left join tweeks.taxa tx on tx.taxa_id = any( v.venda_taxas ) left join tweeks.tipoimposto tip on tx.taxa_tipoimposto_id = tip.tipoimposto_id where v.venda_estado = _const.maguita_venda_estado_fechado and ct.conta_estado = _const.maguita_conta_estado_fechado and se.serie_tserie_id in ( _const.maguita_tserie_notacredito ) group by v.venda_id, a.artigo_id, ct.conta_id, ctorigem.conta_id, p.posto_id, de.deposito_id, e.espaco_id, cat.classe_id, aut.colaborador_id, ts.tserie_id, cx.caixa_id ; select * from report.sync( 'report.vreport_notacredito', 'RELATÓRIO DE NOTA CREDITO', 1500 ); UPDATE report.vcolumn SET position = 2000, show = true, init = false, format = 'code:long', filter = '[{"opr": "like", "mode": "right", "name": "DOCUMENTO", "format": "simple"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'DOCUMENTO'; UPDATE report.vcolumn SET position = 1999, show = true, init = true, format = 'code:long', filter = '[{"opr": "like", "mode": "right", "name": "DOC. ORIGEM", "format": "simple"}]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'DOC. ORIGEM'; UPDATE report.vcolumn SET position = 1995, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'ARTIGO'; UPDATE report.vcolumn SET position = 1994, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'CÓD ARTIGO'; UPDATE report.vcolumn SET position = 1895, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'CÓD. CAT.'; UPDATE report.vcolumn SET position = 1894, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'CATEGORIA'; UPDATE report.vcolumn SET position = 980, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'ARMAZÉM'; UPDATE report.vcolumn SET position = 970, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'POSTO'; UPDATE report.vcolumn SET position = 960, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'CLIENTE'; UPDATE report.vcolumn SET position = 115, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ PREÇO'; UPDATE report.vcolumn SET position = 114, show = true, init = true, format = 'int', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = 'QT'; UPDATE report.vcolumn SET position = 113, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ MONT.'; UPDATE report.vcolumn SET position = 112, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ EXTRAS'; UPDATE report.vcolumn SET position = 111, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ MONT+EXT'; UPDATE report.vcolumn SET position = 110, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_notacredito' AND name = 'IMPOSTOS'; UPDATE report.vcolumn SET position = 109, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_notacredito' AND name = 'TAXAS'; UPDATE report.vcolumn SET position = 108, show = false, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_notacredito' AND name = 'ISEN.'; UPDATE report.vcolumn SET position = 107, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ IMPOSTO'; UPDATE report.vcolumn SET position = 106, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ SUBTOTAL'; UPDATE report.vcolumn SET position = 105, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ TOTAL'; UPDATE report.vcolumn SET position = null, show = true, init = true, format = 'date', filter = '[{"opr": ">=", "name": "DATA INICO", "format": "date"}, {"opr": "<=", "name": "DATA FIM", "format": "date"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_notacredito' AND name = 'DATA'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[["query.like", {"mode": "right", "name": "NIF"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'NIF'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_notacredito' AND name = '$ MONTANTE FINAL'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'CAIXA'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_notacredito' AND name = 'COLABORADOR'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'text', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'JUSTIFICATIVA'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_notacredito' AND name = 'SERIE'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Artigo", "format": "select", "source": "tweeks.artigo"}]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'artigo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE VENDAS", "rename": "??COUNT::DISTINCT TOTAL DE VENDAS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'venda_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.caixa", {"name": "CAIXA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = '_caixa_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_notacredito' AND name = '_tgrupo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'classe_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|auth.colaborador"]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'colaborador_fecho'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'conta_cliente_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "ARMAZÉM", "format": "select", "source": "tweeks.espaco"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'espaco_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'posto_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tserie::venda", {"name": "SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_notacredito' AND name = 'tserie_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.boolean|Y/N", {"name": "ISENÇÃO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'boolean' WHERE source = 'report.vreport_notacredito' AND name = 'venda_isencao'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = '_branch_uid'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid[]' WHERE source = 'report.vreport_notacredito' AND name = '_tipoimposto_ids'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_notacredito' AND name = 'deposito_id'; select * from report.vcolumn where source = 'report.vreport_notacredito' order by position desc nulls last, show desc nulls last, init desc nulls last, jsonb_array_length( agg ) desc, jsonb_array_length( filter ) desc, source, name ;
ec7c77e6-6eb8-4f15-8f47-d13dc231b0f3	\ndrop view if exists report.vreport_venda;\n\ncreate view report.vreport_venda as\nwith _const ( maguita_venda_estado_fechado, maguita_conta_estado_fechado, maguita_tserie_faturarecibo, maguita_tserie_fatura ) as (\n  select \n    map.get( 'maguita_venda_estado_fechado' )::int2\n    , map.get( 'maguita_conta_estado_fechado' )::int2\n    , map.get( 'maguita_tserie_faturarecibo' )::int2\n    , map.get( 'maguita_tserie_fatura' )::int2\n)\n  select\n      v.venda_id,\n      ct.conta_numerofatura as "FATURA",\n      a.artigo_nome as "ARTIGO",\n      cat.classe_nome as "CATEGORIA",\n      cat.classe_codigo as "CÓD. CAT.",\n      e.espaco_nome as "ARMAZÉM",\n      p.posto_designacao as "POSTO",\n      ct.conta_titularnif as "NIF",\n      ct.conta_titular as "CLIENTE",\n      v.venda_custounitario as "$ PREÇO",\n      v.venda_quantidade as "QT",\n      v.venda_montante as "$ MONT.",\n      v.venda_montanteagregado as "$ EXTRAS",\n      v.venda_montantetotal as "$ MONT+EXT",\n      v.venda_imposto as "$ IMPOSTO",\n      v.venda_montantesemimposto as "$ SUBTOTAL",\n      v.venda_montantecomimposto as "$ TOTAL",\n      ct.conta_montante as "$ MONTANTE FINAL",\n      v.venda_isencao,\n      case\n        when venda_isencao then 'SIM' else 'NÃO'\n      end as "ISEN.",\n      string_agg( tip.tipoimposto_codigo, ', ' ) as "IMPOSTOS",\n      string_agg( format( '%s %s', coalesce( tx.taxa_percentagem, tx.taxa_taxa ),  case when tx.taxa_percentagem is not null then '%' else 'STN' end ), ', ' )\n        filter ( where tx.taxa_id is not null )\n        as "TAXAS",\n      array_agg( tip.tipoimposto_id ) as _tipoimposto_ids,\n      a.artigo_id,\n      ct.conta_datafecho::date as "DATA",\n      ts.tserie_id,\n      ts.tserie_desc as "SERIE",\n      ct._tgrupo_id,\n      ct.conta_cliente_id,\n      p.posto_id,\n      e.espaco_id,\n      lib.str_normalize( format( '%s %s', aut.colaborador_nome, aut.colaborador_apelido ) ) as "COLABORADOR",\n      v._branch_uid,\n      ct.conta_colaborador_fecho as colaborador_fecho,\n      cat.classe_id,\n      de.deposito_id,\n      de.deposito_caixa_id as _caixa_id,\n      cx.caixa_code as "CAIXA",\n      a.artigo_codigo as "CÓD ARTIGO"\n    from _const, tweeks.venda v\n      inner join tweeks.artigo a on v.venda_artigo_id = a.artigo_id\n      inner join tweeks.classe cat on a.artigo_classe_id = cat.classe_id\n      inner join tweeks.conta ct on v.venda_conta_id = ct.conta_id\n      inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id\n      inner join tweeks.espaco e on p.posto_espaco_auth = e.espaco_id\n      inner join auth.colaborador aut on ct.conta_colaborador_fecho = aut.colaborador_id\n      inner join tweeks.serie se on ct.conta_serie_id = se.serie_id\n      inner join tweeks.tserie ts on se.serie_tserie_id = ts.tserie_id\n      left join tweeks.deposito de on ( de.deposito_referencia->>'conta_id' )::uuid = ct.conta_id\n        and de.deposito_posto_id = p.posto_id\n        and de.deposito_documento = ct.conta_numerofatura\n      left join tweeks.caixa cx on de.deposito_caixa_id = cx.caixa_id\n      \n      left join tweeks.taxa tx on tx.taxa_id = any( v.venda_taxas )\n      left join tweeks.tipoimposto tip on tx.taxa_tipoimposto_id = tip.tipoimposto_id\n\n    where v.venda_estado = _const.maguita_venda_estado_fechado\n      and ct.conta_estado = _const.maguita_conta_estado_fechado\n      and se.serie_tserie_id in (\n        _const.maguita_tserie_faturarecibo,\n        _const.maguita_tserie_fatura\n      )\n      \n\n    group by v.venda_id,\n      a.artigo_id,\n      ct.conta_id,\n      p.posto_id,\n      de.deposito_id,\n      e.espaco_id,\n      cat.classe_id,\n      aut.colaborador_id,\n      ts.tserie_id,\n      cx.caixa_id\n;\n\nselect * from report.sync( 'report.vreport_venda', 'RELATÓRIO DE VENDAS', 2000 );\n\nUPDATE report.vcolumn SET position = 2000, show = true, init = false, format = 'code:long', filter = '[{"opr": "like", "mode": "right", "name": "FATURA", "format": "simple"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'FATURA';\nUPDATE report.vcolumn SET position = 1995, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'ARTIGO';\nUPDATE report.vcolumn SET position = 1994, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'CÓD ARTIGO';\nUPDATE report.vcolumn SET position = 1895, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'CÓD. CAT.';\nUPDATE report.vcolumn SET position = 1894, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'CATEGORIA';\nUPDATE report.vcolumn SET position = 980, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'ARMAZÉM';\nUPDATE report.vcolumn SET position = 970, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'POSTO';\nUPDATE report.vcolumn SET position = 960, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'CLIENTE';\nUPDATE report.vcolumn SET position = 115, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ PREÇO';\nUPDATE report.vcolumn SET position = 114, show = true, init = true, format = 'int', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = 'QT';\nUPDATE report.vcolumn SET position = 113, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ MONT.';\nUPDATE report.vcolumn SET position = 112, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ EXTRAS';\nUPDATE report.vcolumn SET position = 111, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ MONT+EXT';\nUPDATE report.vcolumn SET position = 110, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda' AND name = 'IMPOSTOS';\nUPDATE report.vcolumn SET position = 109, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda' AND name = 'TAXAS';\nUPDATE report.vcolumn SET position = 108, show = false, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda' AND name = 'ISEN.';\nUPDATE report.vcolumn SET position = 107, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ IMPOSTO';\nUPDATE report.vcolumn SET position = 106, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ SUBTOTAL';\nUPDATE report.vcolumn SET position = 105, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ TOTAL';\nUPDATE report.vcolumn SET position = null, show = true, init = true, format = 'date', filter = '[{"opr": ">=", "name": "DATA INICO", "format": "date"}, {"opr": "<=", "name": "DATA FIM", "format": "date"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_venda' AND name = 'DATA';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[["query.like", {"mode": "right", "name": "NIF"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'NIF';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ MONTANTE FINAL';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'CAIXA';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda' AND name = 'COLABORADOR';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'SERIE';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Artigo", "format": "select", "source": "tweeks.artigo"}]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'artigo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE VENDAS", "rename": "??COUNT::DISTINCT TOTAL DE VENDAS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'venda_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.caixa", {"name": "CAIXA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = '_caixa_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_venda' AND name = '_tgrupo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'classe_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|auth.colaborador"]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'colaborador_fecho';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'conta_cliente_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "ARMAZÉM", "format": "select", "source": "tweeks.espaco"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'espaco_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'posto_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tserie::venda", {"name": "SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_venda' AND name = 'tserie_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.boolean|Y/N", {"name": "ISENÇÃO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'boolean' WHERE source = 'report.vreport_venda' AND name = 'venda_isencao';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = '_branch_uid';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid[]' WHERE source = 'report.vreport_venda' AND name = '_tipoimposto_ids';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'deposito_id';\n\n\nselect *\n  from report.vcolumn\n  where source = 'report.vreport_venda'\n  order by position desc nulls last,\n           show desc nulls last,\n           init desc nulls last,\n           jsonb_array_length( agg ) desc,\n           jsonb_array_length( filter ) desc,\n           source,\n           name\n;\n	drop view if exists report.vreport_venda; create view report.vreport_venda as with _const ( maguita_venda_estado_fechado, maguita_conta_estado_fechado, maguita_tserie_faturarecibo, maguita_tserie_fatura ) as ( select map.get( 'maguita_venda_estado_fechado' )::int2 , map.get( 'maguita_conta_estado_fechado' )::int2 , map.get( 'maguita_tserie_faturarecibo' )::int2 , map.get( 'maguita_tserie_fatura' )::int2 ) select v.venda_id, ct.conta_numerofatura as "FATURA", a.artigo_nome as "ARTIGO", cat.classe_nome as "CATEGORIA", cat.classe_codigo as "CÓD. CAT.", e.espaco_nome as "ARMAZÉM", p.posto_designacao as "POSTO", ct.conta_titularnif as "NIF", ct.conta_titular as "CLIENTE", v.venda_custounitario as "$ PREÇO", v.venda_quantidade as "QT", v.venda_montante as "$ MONT.", v.venda_montanteagregado as "$ EXTRAS", v.venda_montantetotal as "$ MONT+EXT", v.venda_imposto as "$ IMPOSTO", v.venda_montantesemimposto as "$ SUBTOTAL", v.venda_montantecomimposto as "$ TOTAL", ct.conta_montante as "$ MONTANTE FINAL", v.venda_isencao, case when venda_isencao then 'SIM' else 'NÃO' end as "ISEN.", string_agg( tip.tipoimposto_codigo, ', ' ) as "IMPOSTOS", string_agg( format( '%s %s', coalesce( tx.taxa_percentagem, tx.taxa_taxa ), case when tx.taxa_percentagem is not null then '%' else 'STN' end ), ', ' ) filter ( where tx.taxa_id is not null ) as "TAXAS", array_agg( tip.tipoimposto_id ) as _tipoimposto_ids, a.artigo_id, ct.conta_datafecho::date as "DATA", ts.tserie_id, ts.tserie_desc as "SERIE", ct._tgrupo_id, ct.conta_cliente_id, p.posto_id, e.espaco_id, lib.str_normalize( format( '%s %s', aut.colaborador_nome, aut.colaborador_apelido ) ) as "COLABORADOR", v._branch_uid, ct.conta_colaborador_fecho as colaborador_fecho, cat.classe_id, de.deposito_id, de.deposito_caixa_id as _caixa_id, cx.caixa_code as "CAIXA", a.artigo_codigo as "CÓD ARTIGO" from _const, tweeks.venda v inner join tweeks.artigo a on v.venda_artigo_id = a.artigo_id inner join tweeks.classe cat on a.artigo_classe_id = cat.classe_id inner join tweeks.conta ct on v.venda_conta_id = ct.conta_id inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id inner join tweeks.espaco e on p.posto_espaco_auth = e.espaco_id inner join auth.colaborador aut on ct.conta_colaborador_fecho = aut.colaborador_id inner join tweeks.serie se on ct.conta_serie_id = se.serie_id inner join tweeks.tserie ts on se.serie_tserie_id = ts.tserie_id left join tweeks.deposito de on ( de.deposito_referencia->>'conta_id' )::uuid = ct.conta_id and de.deposito_posto_id = p.posto_id and de.deposito_documento = ct.conta_numerofatura left join tweeks.caixa cx on de.deposito_caixa_id = cx.caixa_id left join tweeks.taxa tx on tx.taxa_id = any( v.venda_taxas ) left join tweeks.tipoimposto tip on tx.taxa_tipoimposto_id = tip.tipoimposto_id where v.venda_estado = _const.maguita_venda_estado_fechado and ct.conta_estado = _const.maguita_conta_estado_fechado and se.serie_tserie_id in ( _const.maguita_tserie_faturarecibo, _const.maguita_tserie_fatura ) group by v.venda_id, a.artigo_id, ct.conta_id, p.posto_id, de.deposito_id, e.espaco_id, cat.classe_id, aut.colaborador_id, ts.tserie_id, cx.caixa_id ; select * from report.sync( 'report.vreport_venda', 'RELATÓRIO DE VENDAS', 2000 ); UPDATE report.vcolumn SET position = 2000, show = true, init = false, format = 'code:long', filter = '[{"opr": "like", "mode": "right", "name": "FATURA", "format": "simple"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'FATURA'; UPDATE report.vcolumn SET position = 1995, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'ARTIGO'; UPDATE report.vcolumn SET position = 1994, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'CÓD ARTIGO'; UPDATE report.vcolumn SET position = 1895, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'CÓD. CAT.'; UPDATE report.vcolumn SET position = 1894, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'CATEGORIA'; UPDATE report.vcolumn SET position = 980, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'ARMAZÉM'; UPDATE report.vcolumn SET position = 970, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'POSTO'; UPDATE report.vcolumn SET position = 960, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'CLIENTE'; UPDATE report.vcolumn SET position = 115, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ PREÇO'; UPDATE report.vcolumn SET position = 114, show = true, init = true, format = 'int', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = 'QT'; UPDATE report.vcolumn SET position = 113, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ MONT.'; UPDATE report.vcolumn SET position = 112, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ EXTRAS'; UPDATE report.vcolumn SET position = 111, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ MONT+EXT'; UPDATE report.vcolumn SET position = 110, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda' AND name = 'IMPOSTOS'; UPDATE report.vcolumn SET position = 109, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda' AND name = 'TAXAS'; UPDATE report.vcolumn SET position = 108, show = false, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda' AND name = 'ISEN.'; UPDATE report.vcolumn SET position = 107, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ IMPOSTO'; UPDATE report.vcolumn SET position = 106, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ SUBTOTAL'; UPDATE report.vcolumn SET position = 105, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ TOTAL'; UPDATE report.vcolumn SET position = null, show = true, init = true, format = 'date', filter = '[{"opr": ">=", "name": "DATA INICO", "format": "date"}, {"opr": "<=", "name": "DATA FIM", "format": "date"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_venda' AND name = 'DATA'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[["query.like", {"mode": "right", "name": "NIF"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'NIF'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda' AND name = '$ MONTANTE FINAL'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'CAIXA'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda' AND name = 'COLABORADOR'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda' AND name = 'SERIE'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Artigo", "format": "select", "source": "tweeks.artigo"}]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'artigo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE VENDAS", "rename": "??COUNT::DISTINCT TOTAL DE VENDAS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'venda_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.caixa", {"name": "CAIXA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = '_caixa_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_venda' AND name = '_tgrupo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'classe_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|auth.colaborador"]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'colaborador_fecho'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'conta_cliente_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "ARMAZÉM", "format": "select", "source": "tweeks.espaco"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'espaco_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'posto_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tserie::venda", {"name": "SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_venda' AND name = 'tserie_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.boolean|Y/N", {"name": "ISENÇÃO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'boolean' WHERE source = 'report.vreport_venda' AND name = 'venda_isencao'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = '_branch_uid'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid[]' WHERE source = 'report.vreport_venda' AND name = '_tipoimposto_ids'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda' AND name = 'deposito_id'; select * from report.vcolumn where source = 'report.vreport_venda' order by position desc nulls last, show desc nulls last, init desc nulls last, jsonb_array_length( agg ) desc, jsonb_array_length( filter ) desc, source, name ;
6788bcbc-bed7-4ebc-b464-1a52c86d7dda	\ndrop view if exists report.vreport_venda_artigo;\n\ncreate or replace view report.vreport_venda_artigo as\nwith _const ( maguita_venda_estado_fechado, maguita_conta_estado_fechado, maguita_tserie_faturarecibo, maguita_tserie_fatura ) as (\n  select\n    map.get( 'maguita_venda_estado_fechado' )::int2\n    , map.get( 'maguita_conta_estado_fechado' )::int2\n    , map.get( 'maguita_tserie_faturarecibo' )::int2\n    , map.get( 'maguita_tserie_fatura' )::int2\n)\n  select\n      a.artigo_nome as "ARTIGO",\n      cat.classe_nome as "CATEGORIA",\n      cat.classe_codigo as "CÓD. CAT.",\n      e.espaco_nome as "ARMAZÉM",\n      p.posto_designacao as "POSTO",\n      sum(v.venda_quantidade) as "QT",\n      sum(v.venda_montante) as "$ MONT.",\n      sum(v.venda_montanteagregado) as "$ EXTRAS",\n      sum(v.venda_montantetotal) as "$ MONT+EXT",\n      sum(v.venda_imposto) as "$ IMPOSTO",\n      sum(v.venda_montantesemimposto) as "$ SUBTOTAL",\n      sum(v.venda_montantecomimposto) as "$ TOTAL",\n      string_agg( tip.tipoimposto_codigo, ', ' ) as "IMPOSTOS",\n      string_agg( format( '%s %s', coalesce( tx.taxa_percentagem, tx.taxa_taxa ),  case when tx.taxa_percentagem is not null then '%' else 'STN' end ), ', ' )\n        filter ( where tx.taxa_id is not null )\n        as "TAXAS",\n      array_agg( tip.tipoimposto_id ) as _tipoimposto_ids,\n      a.artigo_id,\n      ts.tserie_id,\n      ts.tserie_desc as "SERIE",\n      p.posto_id,\n      e.espaco_id,\n      lib.str_normalize( format( '%s %s', aut.colaborador_nome, aut.colaborador_apelido ) ) as "COLABORADOR",\n      cx.caixa_code as "CAIXA",\n      cx.caixa_id as "_caixa_id",\n      a.artigo_codigo as "CÓD ARTIGO",\n\n      a._branch_uid\n    from _const, tweeks.venda v\n      inner join tweeks.artigo a on v.venda_artigo_id = a.artigo_id\n      inner join tweeks.classe cat on a.artigo_classe_id = cat.classe_id\n      inner join tweeks.conta ct on v.venda_conta_id = ct.conta_id\n      inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id\n      inner join tweeks.espaco e on p.posto_espaco_auth = e.espaco_id\n      inner join auth.colaborador aut on ct.conta_colaborador_fecho = aut.colaborador_id\n      inner join tweeks.serie se on ct.conta_serie_id = se.serie_id\n      inner join tweeks.tserie ts on se.serie_tserie_id = ts.tserie_id\n      left join tweeks.deposito de on ( de.deposito_referencia->>'conta_id' )::uuid = ct.conta_id\n        and de.deposito_posto_id = p.posto_id\n        and de.deposito_documento = ct.conta_numerofatura\n      left join tweeks.caixa cx on de.deposito_caixa_id = cx.caixa_id\n\n      left join tweeks.taxa tx on tx.taxa_id = any( v.venda_taxas )\n      left join tweeks.tipoimposto tip on tx.taxa_tipoimposto_id = tip.tipoimposto_id\n\n    where v.venda_estado = _const.maguita_venda_estado_fechado\n      and ct.conta_estado = _const.maguita_conta_estado_fechado\n      and se.serie_tserie_id in (\n        _const.maguita_tserie_faturarecibo,\n        _const.maguita_tserie_fatura\n      )\n    group by\n      a.artigo_id,\n      p.posto_id,\n      e.espaco_id,\n      cat.classe_id,\n      aut.colaborador_id,\n      ts.tserie_id,\n      cx.caixa_id\n;\n\nselect * from report.sync( 'report.vreport_venda_artigo', 'RELATÓRIO DE ARTIGO VENDIDOS', 1850 );\n\nUPDATE report.vcolumn SET position = 2000, show = true, init = false, format = 'code:long', filter = '[{"opr": "like", "mode": "right", "name": "FATURA", "format": "simple"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'FATURA';\nUPDATE report.vcolumn SET position = 1995, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'ARTIGO';\nUPDATE report.vcolumn SET position = 1994, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'CÓD ARTIGO';\nUPDATE report.vcolumn SET position = 1895, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'CÓD. CAT.';\nUPDATE report.vcolumn SET position = 1894, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'CATEGORIA';\nUPDATE report.vcolumn SET position = 980, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'ARMAZÉM';\nUPDATE report.vcolumn SET position = 970, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'POSTO';\nUPDATE report.vcolumn SET position = 960, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'CLIENTE';\nUPDATE report.vcolumn SET position = 115, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ PREÇO';\nUPDATE report.vcolumn SET position = 114, show = true, init = true, format = 'int', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = 'QT';\nUPDATE report.vcolumn SET position = 113, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ MONT.';\nUPDATE report.vcolumn SET position = 112, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ EXTRAS';\nUPDATE report.vcolumn SET position = 111, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ MONT+EXT';\nUPDATE report.vcolumn SET position = 110, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda_artigo' AND name = 'IMPOSTOS';\nUPDATE report.vcolumn SET position = 109, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda_artigo' AND name = 'TAXAS';\nUPDATE report.vcolumn SET position = 108, show = false, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda_artigo' AND name = 'ISEN.';\nUPDATE report.vcolumn SET position = 107, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ IMPOSTO';\nUPDATE report.vcolumn SET position = 106, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ SUBTOTAL';\nUPDATE report.vcolumn SET position = 105, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ TOTAL';\nUPDATE report.vcolumn SET position = null, show = true, init = true, format = 'date', filter = '[{"opr": ">=", "name": "DATA INICO", "format": "date"}, {"opr": "<=", "name": "DATA FIM", "format": "date"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_venda_artigo' AND name = 'DATA';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[["query.like", {"mode": "right", "name": "NIF"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'NIF';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ MONTANTE FINAL';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'CAIXA';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda_artigo' AND name = 'COLABORADOR';\nUPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'SERIE';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Artigo", "format": "select", "source": "tweeks.artigo"}]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'artigo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE VENDAS", "rename": "??COUNT::DISTINCT TOTAL DE VENDAS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'venda_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.caixa", {"name": "CAIXA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = '_caixa_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_venda_artigo' AND name = '_tgrupo_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'classe_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|auth.colaborador"]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'colaborador_fecho';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'conta_cliente_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "ARMAZÉM", "format": "select", "source": "tweeks.espaco"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'espaco_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'posto_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tserie::venda", {"name": "SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_venda_artigo' AND name = 'tserie_id';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.boolean|Y/N", {"name": "ISENÇÃO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'boolean' WHERE source = 'report.vreport_venda_artigo' AND name = 'venda_isencao';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = '_branch_uid';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid[]' WHERE source = 'report.vreport_venda_artigo' AND name = '_tipoimposto_ids';\nUPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'deposito_id';\n\n\nselect *\n  from report.vcolumn\n  where source = 'report.vreport_venda_artigo'\n  order by position desc nulls last,\n           show desc nulls last,\n           init desc nulls last,\n           jsonb_array_length( agg ) desc,\n           jsonb_array_length( filter ) desc,\n           source,\n           name\n;\n\n	drop view if exists report.vreport_venda_artigo; create or replace view report.vreport_venda_artigo as with _const ( maguita_venda_estado_fechado, maguita_conta_estado_fechado, maguita_tserie_faturarecibo, maguita_tserie_fatura ) as ( select map.get( 'maguita_venda_estado_fechado' )::int2 , map.get( 'maguita_conta_estado_fechado' )::int2 , map.get( 'maguita_tserie_faturarecibo' )::int2 , map.get( 'maguita_tserie_fatura' )::int2 ) select a.artigo_nome as "ARTIGO", cat.classe_nome as "CATEGORIA", cat.classe_codigo as "CÓD. CAT.", e.espaco_nome as "ARMAZÉM", p.posto_designacao as "POSTO", sum(v.venda_quantidade) as "QT", sum(v.venda_montante) as "$ MONT.", sum(v.venda_montanteagregado) as "$ EXTRAS", sum(v.venda_montantetotal) as "$ MONT+EXT", sum(v.venda_imposto) as "$ IMPOSTO", sum(v.venda_montantesemimposto) as "$ SUBTOTAL", sum(v.venda_montantecomimposto) as "$ TOTAL", string_agg( tip.tipoimposto_codigo, ', ' ) as "IMPOSTOS", string_agg( format( '%s %s', coalesce( tx.taxa_percentagem, tx.taxa_taxa ), case when tx.taxa_percentagem is not null then '%' else 'STN' end ), ', ' ) filter ( where tx.taxa_id is not null ) as "TAXAS", array_agg( tip.tipoimposto_id ) as _tipoimposto_ids, a.artigo_id, ts.tserie_id, ts.tserie_desc as "SERIE", p.posto_id, e.espaco_id, lib.str_normalize( format( '%s %s', aut.colaborador_nome, aut.colaborador_apelido ) ) as "COLABORADOR", cx.caixa_code as "CAIXA", cx.caixa_id as "_caixa_id", a.artigo_codigo as "CÓD ARTIGO", a._branch_uid from _const, tweeks.venda v inner join tweeks.artigo a on v.venda_artigo_id = a.artigo_id inner join tweeks.classe cat on a.artigo_classe_id = cat.classe_id inner join tweeks.conta ct on v.venda_conta_id = ct.conta_id inner join tweeks.posto p on ct.conta_posto_fecho = p.posto_id inner join tweeks.espaco e on p.posto_espaco_auth = e.espaco_id inner join auth.colaborador aut on ct.conta_colaborador_fecho = aut.colaborador_id inner join tweeks.serie se on ct.conta_serie_id = se.serie_id inner join tweeks.tserie ts on se.serie_tserie_id = ts.tserie_id left join tweeks.deposito de on ( de.deposito_referencia->>'conta_id' )::uuid = ct.conta_id and de.deposito_posto_id = p.posto_id and de.deposito_documento = ct.conta_numerofatura left join tweeks.caixa cx on de.deposito_caixa_id = cx.caixa_id left join tweeks.taxa tx on tx.taxa_id = any( v.venda_taxas ) left join tweeks.tipoimposto tip on tx.taxa_tipoimposto_id = tip.tipoimposto_id where v.venda_estado = _const.maguita_venda_estado_fechado and ct.conta_estado = _const.maguita_conta_estado_fechado and se.serie_tserie_id in ( _const.maguita_tserie_faturarecibo, _const.maguita_tserie_fatura ) group by a.artigo_id, p.posto_id, e.espaco_id, cat.classe_id, aut.colaborador_id, ts.tserie_id, cx.caixa_id ; select * from report.sync( 'report.vreport_venda_artigo', 'RELATÓRIO DE ARTIGO VENDIDOS', 1850 ); UPDATE report.vcolumn SET position = 2000, show = true, init = false, format = 'code:long', filter = '[{"opr": "like", "mode": "right", "name": "FATURA", "format": "simple"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'FATURA'; UPDATE report.vcolumn SET position = 1995, show = true, init = true, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'ARTIGO'; UPDATE report.vcolumn SET position = 1994, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'CÓD ARTIGO'; UPDATE report.vcolumn SET position = 1895, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'CÓD. CAT.'; UPDATE report.vcolumn SET position = 1894, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'CATEGORIA'; UPDATE report.vcolumn SET position = 980, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'ARMAZÉM'; UPDATE report.vcolumn SET position = 970, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'POSTO'; UPDATE report.vcolumn SET position = 960, show = true, init = false, format = 'name', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'CLIENTE'; UPDATE report.vcolumn SET position = 115, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ PREÇO'; UPDATE report.vcolumn SET position = 114, show = true, init = true, format = 'int', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = 'QT'; UPDATE report.vcolumn SET position = 113, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ MONT.'; UPDATE report.vcolumn SET position = 112, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ EXTRAS'; UPDATE report.vcolumn SET position = 111, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ MONT+EXT'; UPDATE report.vcolumn SET position = 110, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda_artigo' AND name = 'IMPOSTOS'; UPDATE report.vcolumn SET position = 109, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda_artigo' AND name = 'TAXAS'; UPDATE report.vcolumn SET position = 108, show = false, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda_artigo' AND name = 'ISEN.'; UPDATE report.vcolumn SET position = 107, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ IMPOSTO'; UPDATE report.vcolumn SET position = 106, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ SUBTOTAL'; UPDATE report.vcolumn SET position = 105, show = true, init = true, format = 'money', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ TOTAL'; UPDATE report.vcolumn SET position = null, show = true, init = true, format = 'date', filter = '[{"opr": ">=", "name": "DATA INICO", "format": "date"}, {"opr": "<=", "name": "DATA FIM", "format": "date"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'date' WHERE source = 'report.vreport_venda_artigo' AND name = 'DATA'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[["query.like", {"mode": "right", "name": "NIF"}]]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'NIF'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'money', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'double precision' WHERE source = 'report.vreport_venda_artigo' AND name = '$ MONTANTE FINAL'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'code', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'CAIXA'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:mid', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'text' WHERE source = 'report.vreport_venda_artigo' AND name = 'COLABORADOR'; UPDATE report.vcolumn SET position = null, show = true, init = false, format = 'name:short', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'character varying' WHERE source = 'report.vreport_venda_artigo' AND name = 'SERIE'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Artigo", "format": "select", "source": "tweeks.artigo"}]', agg = '[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'artigo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[{"func": "count::distinct", "name": "TOTAL DE VENDAS", "rename": "??COUNT::DISTINCT TOTAL DE VENDAS"}]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'venda_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.caixa", {"name": "CAIXA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = '_caixa_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_venda_artigo' AND name = '_tgrupo_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'classe_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '["query.source|auth.colaborador"]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'colaborador_fecho'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'conta_cliente_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "ARMAZÉM", "format": "select", "source": "tweeks.espaco"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'espaco_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'posto_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.source|tweeks.tserie::venda", {"name": "SERIE"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'smallint' WHERE source = 'report.vreport_venda_artigo' AND name = 'tserie_id'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[["query.boolean|Y/N", {"name": "ISENÇÃO"}]]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'boolean' WHERE source = 'report.vreport_venda_artigo' AND name = 'venda_isencao'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = null, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = '_branch_uid'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid[]' WHERE source = 'report.vreport_venda_artigo' AND name = '_tipoimposto_ids'; UPDATE report.vcolumn SET position = null, show = false, init = false, format = 'id', filter = '[]', agg = '[]', noagg = false, gen = '[]', rename = null, type = 'uuid' WHERE source = 'report.vreport_venda_artigo' AND name = 'deposito_id'; select * from report.vcolumn where source = 'report.vreport_venda_artigo' order by position desc nulls last, show desc nulls last, init desc nulls last, jsonb_array_length( agg ) desc, jsonb_array_length( filter ) desc, source, name ;
d3bc359a-22af-4989-986d-dfd76e1be8a6	\ncreate or replace function report.vreport_imposto_financas(args jsonb) returns SETOF jsonb\n  language plpgsql\nas\n$$\ndeclare\n  /*\n    args := {\n      arg_colaborador_id: UID\n      arg_espaco_auth: UID\n      arg_datainicio\n      arg_datafim\n    }\n   */\n  arg_colaborador_id uuid default args->>'arg_colaborador_id';\n  arg_espaco_auth uuid default args->>'arg_espaco_auth';\n  arg_datainicio date default args->>'arg_datainicio';\n  arg_datafim date default args->>'arg_datafim';\n  arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth );\n  _const map.constant;\n\nbegin\n  _const := map.constant();\n  return query\n    with __declaracao as (\n      select\n         se.serie_sequencia as documento_numero,\n         se.serie_numero as documento_serie,\n         ct.conta_data as documento_data,\n         coalesce( ct.conta_titularnif, cli.cliente_nif) as nif_consumidor,\n         abs( ve.venda_montantesemimposto::numeric(100,6) ) as total_valor_itens,\n         tx.taxa_percentagem as taxa_aplicavel_itens,\n         coalesce( ve.venda_codigoimposto, ar.artigo_codigoimposto) as codigo_isento,\n         abs( ve.venda_quantidade ) quant_itens,\n         coalesce( ve.venda_descricao, ar.artigo_nome ) desc_itens,\n         ctorigin.conta_numerofatura numero_documento_origem,\n         ctorigin.conta_data data_documento_origem,\n         tsorigin.tserie_code as tipo_documento_origem,\n         ts.tserie_code,\n         ct.conta_id,\n         ve.venda_id,\n         cli.cliente_id,\n         tx.taxa_id,\n         se.serie_id,\n         ar.artigo_id,\n         ct.conta_conta_docorigin,\n         ct._branch_uid\n         \n      from tweeks.conta ct\n        inner join json_populate_record( null::tweeks.serie, ct.conta_serie ) se on true\n        inner join tweeks.serie _se on se.serie_id = _se.serie_id\n        inner join tweeks.tserie ts on _se.serie_tserie_id = ts.tserie_id\n        inner join tweeks.venda ve on ct.conta_id = ve.venda_conta_id\n          and ve.venda_estado = _const.maguita_venda_estado_fechado\n          and ve.venda_venda_id is null\n        inner join tweeks.taxa tx on tx.taxa_id = any( ve.venda_taxas )\n        inner join tweeks.artigo ar on ve.venda_artigo_id = ar.artigo_id\n        left join tweeks.conta ctorigin on ct.conta_conta_docorigin = ctorigin.conta_id\n        left join json_populate_record( null::tweeks.serie, ctorigin.conta_serie ) seorign on true\n        left join tweeks.serie _seorign on seorign.serie_id = _seorign.serie_id\n        left join tweeks.tserie tsorigin on _seorign.serie_tserie_id = tsorigin.tserie_id\n        left join tweeks.cliente cli on ct.conta_cliente_id = cli.cliente_id\n\n      where ve._branch_uid = arg_branch_uid\n        and ct._branch_uid = arg_branch_uid\n        and ct.conta_estado = _const.maguita_conta_estado_fechado\n        and ve.venda_estado = _const.maguita_venda_estado_fechado\n        and ct.conta_datafecho >= coalesce( arg_datainicio, ct.conta_data )\n        and ct.conta_datafecho <= coalesce( arg_datafim, ct.conta_data )\n        and ts.tserie_id in (\n          _const.maguita_tserie_fatura,  \n          _const.maguita_tserie_faturarecibo,  \n          _const.maguita_tserie_notacredito  \n        )\n    ) select to_jsonb( _de ) from __declaracao _de\n  ;\nend;\n$$;\n	create or replace function report.vreport_imposto_financas(args jsonb) returns SETOF jsonb language plpgsql as $$ declare /* args := { arg_colaborador_id: UID arg_espaco_auth: UID arg_datainicio arg_datafim } */ arg_colaborador_id uuid default args->>'arg_colaborador_id'; arg_espaco_auth uuid default args->>'arg_espaco_auth'; arg_datainicio date default args->>'arg_datainicio'; arg_datafim date default args->>'arg_datafim'; arg_branch_uid uuid default tweeks.__branch_uid( arg_colaborador_id, arg_espaco_auth ); _const map.constant; begin _const := map.constant(); return query with __declaracao as ( select se.serie_sequencia as documento_numero, se.serie_numero as documento_serie, ct.conta_data as documento_data, coalesce( ct.conta_titularnif, cli.cliente_nif) as nif_consumidor, abs( ve.venda_montantesemimposto::numeric(100,6) ) as total_valor_itens, tx.taxa_percentagem as taxa_aplicavel_itens, coalesce( ve.venda_codigoimposto, ar.artigo_codigoimposto) as codigo_isento, abs( ve.venda_quantidade ) quant_itens, coalesce( ve.venda_descricao, ar.artigo_nome ) desc_itens, ctorigin.conta_numerofatura numero_documento_origem, ctorigin.conta_data data_documento_origem, tsorigin.tserie_code as tipo_documento_origem, ts.tserie_code, ct.conta_id, ve.venda_id, cli.cliente_id, tx.taxa_id, se.serie_id, ar.artigo_id, ct.conta_conta_docorigin, ct._branch_uid from tweeks.conta ct inner join json_populate_record( null::tweeks.serie, ct.conta_serie ) se on true inner join tweeks.serie _se on se.serie_id = _se.serie_id inner join tweeks.tserie ts on _se.serie_tserie_id = ts.tserie_id inner join tweeks.venda ve on ct.conta_id = ve.venda_conta_id and ve.venda_estado = _const.maguita_venda_estado_fechado and ve.venda_venda_id is null inner join tweeks.taxa tx on tx.taxa_id = any( ve.venda_taxas ) inner join tweeks.artigo ar on ve.venda_artigo_id = ar.artigo_id left join tweeks.conta ctorigin on ct.conta_conta_docorigin = ctorigin.conta_id left join json_populate_record( null::tweeks.serie, ctorigin.conta_serie ) seorign on true left join tweeks.serie _seorign on seorign.serie_id = _seorign.serie_id left join tweeks.tserie tsorigin on _seorign.serie_tserie_id = tsorigin.tserie_id left join tweeks.cliente cli on ct.conta_cliente_id = cli.cliente_id where ve._branch_uid = arg_branch_uid and ct._branch_uid = arg_branch_uid and ct.conta_estado = _const.maguita_conta_estado_fechado and ve.venda_estado = _const.maguita_venda_estado_fechado and ct.conta_datafecho >= coalesce( arg_datainicio, ct.conta_data ) and ct.conta_datafecho <= coalesce( arg_datafim, ct.conta_data ) and ts.tserie_id in ( _const.maguita_tserie_fatura, _const.maguita_tserie_faturarecibo, _const.maguita_tserie_notacredito ) ) select to_jsonb( _de ) from __declaracao _de ; end; $$;
5117e5a9-a81d-474c-b4f6-84b3e947842e	\n  select 'executed forced block'\n	select 'executed forced block'
665ceb5d-f4eb-4399-a16c-45016cee17c2	\n  select format( 'Exclude in dev mode | exclude %s', public = 'dev' )\n	select format( 'Exclude in dev mode | exclude %s', public = 'dev' )
d197392b-db65-41d6-a857-255494c46f8b	\ncreate table tweeks._temp_forece_table( name text, time timestamptz not null default current_timestamp );\n	create table tweeks._temp_forece_table( name text, time timestamptz not null default current_timestamp );
3bdc9a01-6f75-4d68-8d8c-066871c4cfbf	\n  select 'executed unique block'\n	select 'executed unique block'
\.


--
-- TOC entry 5501 (class 0 OID 19475)
-- Dependencies: 354
-- Data for Name: revision; Type: TABLE DATA; Schema: patch; Owner: -
--

COPY patch.revision (file, identifier, _raw_uid, force, flags, configs, status, connection, seq, version, date) FROM stdin;
database\\patch\\revisions\\critical\\001-v1.0.1-baiadabo\\001.sql.js	001-v1.0.1-baiadabo:001	d1d4ddc7-62d9-4547-9dea-371e3512ea78	0	{@unique}	{}	1	maguita_dps	1	1	2023-09-29 11:51:31.898052+00
database\\patch\\revisions\\critical\\001-v1.0.1-baiadabo\\002.sql.js	001-v1.0.1-baiadabo:002-fluxo	a4126ef0-5f28-4e0e-bcd6-91d340447e99	0	{@unique}	{}	1	maguita_dps	2	1	2023-09-29 11:51:31.946713+00
database\\patch\\revisions\\critical\\001-v1.0.1-baiadabo\\003.sql.js	001-v1.0.1-baiadabo:002-fluxo	6cc17af1-d310-493f-bd35-45939eb2eef7	0	{@unique}	{}	1	maguita_dps	3	1	2023-09-29 11:51:32.066642+00
database\\patch\\revisions\\critical\\001-v1.0.1-baiadabo\\004.sql.js	001-v1.0.1-baiadabo:generate-key	1572737f-d6b1-45b6-b234-284d0dc3b7aa	0	{@unique}	{}	1	maguita_dps	4	1	2023-09-29 11:51:32.125429+00
database\\patch\\revisions\\critical\\002-v1.0.2-remote-connection\\001.sql.js	cluster-remote-grants	fcad4c84-d995-4689-800a-996a9c0c5ae0	0	{@unique}	{}	1	maguita_dps	5	1	2023-09-29 11:51:32.170756+00
database\\patch\\revisions\\critical\\002-v1.0.2-remote-connection\\001.sql.js	cluster.remote-change-001	d1f2417b-bcfc-4119-93f6-c21be13ebbfa	0	{@unique}	{}	1	maguita_dps	6	1	2023-09-29 11:51:32.218923+00
database\\patch\\revisions\\critical\\002-v1.0.2-remote-connection\\001.sql.js	remote-functions	5be436d8-08d4-4d4b-98b4-80b3c34251e4	0	{}	{}	1	maguita_dps	7	1	2023-09-29 11:51:32.263815+00
database\\patch\\revisions\\critical\\003-v1.0.3-cozinha\\0001.sql.js	maguita_lancamento_estado_anulado	3f7551aa-6af3-4fbe-8af9-2e0b73279795	0	{@unique}	{}	1	maguita_dps	8	1	2023-09-29 11:51:32.313776+00
database\\patch\\revisions\\critical\\003-v1.0.3-nota-credito\\nota-crediro-001.sql.js	maguita_lancamento_estado_anulado	4dd0afbe-5818-40e8-a754-142a823fc8fa	0	{@unique}	{}	1	maguita_dps	9	1	2023-09-29 11:51:32.359931+00
database\\patch\\revisions\\critical\\004-v1.0.4-serie-disponivel-espaco\\serie-disponivel.sql.js	tweeks.funct_load_serie_available	8e3dbd4d-fadc-49ed-bffd-a9ed8b1afe63	0	{}	{}	1	maguita_dps	10	1	2023-09-29 11:51:32.405556+00
database\\patch\\revisions\\critical\\005-v1.0.5-revison-v2\\0001-revision-v2-structure-source.sql.js	source	64149275-6b3b-4c4d-821f-5a61b50e3b5f	0	{@unique}	{}	1	maguita_dps	11	1	2023-09-29 11:51:32.45262+00
database\\patch\\revisions\\critical\\005-v1.0.5-revison-v2\\0006-revision-v2-admins.sql.js	maguita_revision_v2_admins-source	a10562ec-4fbe-48a1-93dc-3629819d2bb5	0	{@unique}	{}	1	maguita_dps	12	1	2023-09-29 11:51:32.513157+00
database\\patch\\revisions\\critical\\005-v1.0.5-revison-v2\\0006-revision-v2-admins.sql.js	maguita_revision_v2_admins-functions	9e577b3f-b7a9-4d81-a5b1-be515433941a	0	{}	{}	1	maguita_dps	13	1	2023-09-29 11:51:32.567389+00
database\\patch\\revisions\\critical\\005-v1.0.5-revison-v2\\0006-revision-v2-admins.sql.js	maguita_revision_v2_move-branch-to-cluster	5b2aaa7d-6177-4363-9809-465f06d6b825	0	{@unique}	{}	1	maguita_dps	14	1	2023-09-29 11:51:32.616148+00
database\\patch\\revisions\\critical\\005-v1.0.5-revison-v2\\0006-revision-v2-admins.sql.js	maguita_revision_v2_load-configs	79b7ea90-09e6-484c-b4e6-a43e2a1a9445	0	{}	{}	1	maguita_dps	15	1	2023-09-29 11:51:32.664998+00
database\\patch\\revisions\\critical\\005-v1.0.5-revison-v2\\0006-revision-v2-admins.sql.js	maguita_revision_v2_auth	ef118a92-7e30-43e1-8f19-2aec96507df9	0	{@unique}	{}	1	maguita_dps	16	1	2023-09-29 11:51:32.708907+00
database\\patch\\revisions\\critical\\005-v1.0.5-revison-v2\\0006-revision-v2-admins.sql.js	maguita_revision_v2_auth_domain	4e8f44e0-3e0b-41bf-b672-e0d108650bc9	0	{@unique}	{}	1	maguita_dps	17	1	2023-09-29 11:51:32.765235+00
database\\patch\\revisions\\critical\\005-v1.0.5-revison-v2\\0007-revision-v2-status.sql.js	v2-status	42a21728-588a-409c-baa1-99afe1b87c02	0	{}	{}	1	maguita_dps	18	1	2023-09-29 11:51:32.89001+00
database\\patch\\revisions\\critical\\006-v1.0.7-retalho\\0001-function-load-artigo-base.sql.js	retalho/function/tweeks.funct_load_artigo_base	f13fc6ec-b933-4392-8cab-88038a966406	0	{}	{}	1	maguita_dps	19	1	2023-09-29 11:51:32.93361+00
database\\patch\\revisions\\critical\\006-v1.0.7-retalho\\0002-function-reg-retalho.sql.js	retalho/function/tweeks.funct_pos_reg_retalho	d298085c-4cdd-4a18-9511-89b936071c5c	0	{}	{}	1	maguita_dps	20	1	2023-09-29 11:51:32.979428+00
database\\patch\\revisions\\critical\\007-v1-0.8-migration\\0001-function-generate-fornecedor-code.sql.js	migration/fornecedor-code	260aa376-6f75-40c9-a1a0-189f8b8f7a09	0	{}	{}	1	maguita_dps	21	1	2023-09-29 11:51:33.026018+00
database\\patch\\revisions\\critical\\007-v1-0.8-migration\\0001-function-generate-guia-code.sql.js	migration/fornecedor-code	9b028729-2847-4d95-9c4f-644f9355005b	0	{}	{}	1	maguita_dps	22	1	2023-09-29 11:51:33.076493+00
database\\patch\\revisions\\critical\\007-v1-0.8-migration\\0001-function-generate-posto-chave.sql.js	posto_chave	f188c908-a067-482f-90f6-739e25187c8c	0	{}	{}	1	maguita_dps	23	1	2023-09-29 11:51:33.123608+00
database\\patch\\revisions\\critical\\007-v1.0.9-comments\\0001-comments.sql.js	table-comment	44f3886e-a6ab-4501-9118-2533389eebe6	0	{@unique}	{}	1	maguita_dps	24	1	2023-09-29 11:51:33.170583+00
database\\patch\\revisions\\critical\\008-v1.0.9-regularizacao\\001-viewargs.sql.js	viewargs-corre	ade3a107-0cf2-4706-80e9-d927bdc11b45	0	{@unique}	{}	1	maguita_dps	25	1	2023-09-29 11:51:33.213926+00
database\\patch\\revisions\\critical\\008-v1.0.9-regularizacao\\002-regularizacao.sql.js	regularizacao-core	fa49b0da-cb5f-4017-af28-403d3cd8d363	0	{@unique}	{}	1	maguita_dps	26	1	2023-09-29 11:51:33.262102+00
database\\patch\\revisions\\critical\\009-v1.0.10-branch\\001-claname-map.sql.js	classname-map	898a68e8-1144-45ef-9682-bd2494710419	0	{@unique}	{}	1	maguita_dps	27	1	2023-09-29 11:51:33.344306+00
database\\patch\\revisions\\critical\\009-v1.0.10-branch\\001-claname-map.sql.js	classname-map-pull	992eb95e-4d37-4505-aecb-acc12096ad1a	0	{@unique}	{}	1	maguita_dps	28	1	2023-09-29 11:51:33.401103+00
database\\patch\\revisions\\critical\\009-v1.0.10-branch\\001-claname-map.sql.js	___override_auth_funct_autenticacao:classmap	921c873a-1ec8-4e98-843c-513fe035e48c	0	{}	{}	1	maguita_dps	29	1	2023-09-29 11:51:33.462407+00
database\\patch\\revisions\\critical\\010-2023-01-v1.0.11\\0001-migration-maguita-to-luma-path.sql.js	lumaguita_path_01	9b205af3-801b-4a9b-95a1-ac9582664705	0	{@unique}	{}	1	maguita_dps	30	1	2023-09-29 11:51:33.509488+00
database\\patch\\revisions\\critical\\010-2023-01-v1.0.11\\0001-migration-maguita-to-luma-path.sql.js	lumaguita_path_02	5e01ae67-cd68-431e-993f-d3ec4c46ae20	0	{@unique}	{}	1	maguita_dps	31	1	2023-09-29 11:51:33.553218+00
database\\patch\\revisions\\critical\\010-2023-01-v1.0.11\\0001-migration-maguita-to-luma-path.sql.js	lumaguita_path_03	ea51fbb6-8e42-4a30-816d-d2f9ede3fec9	0	{}	{}	1	maguita_dps	32	1	2023-09-29 11:51:33.60442+00
database\\patch\\revisions\\critical\\010-2023-01-v1.0.11\\0001-migration-maguita-to-luma-path.sql.js	lumaguita_path_04	d857fbc9-9933-452e-8a18-5cf19b7967f2	0	{}	{}	1	maguita_dps	33	1	2023-09-29 11:51:33.649133+00
database\\patch\\revisions\\critical\\010-2023-01-v1.0.11\\0002-no-share.sql.js	no-block	4903ffd0-e400-4049-a9c9-0d15d8b2c467	0	{@unique}	{}	1	maguita_dps	34	1	2023-09-29 11:51:33.700632+00
database\\patch\\revisions\\critical\\010-2023-01-v1.0.11\\0003-function-currection.sql.js	funct_load_conta_dia	d17fdd53-df81-4256-843c-2a08ae185b51	0	{}	{}	1	maguita_dps	35	1	2023-09-29 11:51:33.755866+00
database\\patch\\revisions\\critical\\010-2023-01-v1.0.11\\0003-function-load-classe.sql.js	funct_load_class	83ca1f64-6fc2-47b4-955a-924151af4765	0	{}	{}	1	maguita_dps	36	1	2023-09-29 11:51:33.801194+00
database\\patch\\revisions\\critical\\010-2023-01-v1.0.11\\0004-function-reg-precario.sql.js	funct_reg_precario	5d4f40e3-6584-4aa2-9c3b-980aa98ed92e	0	{}	{}	1	maguita_dps	37	1	2023-09-29 11:51:33.84325+00
database\\patch\\revisions\\critical\\010-2023-01-v1.0.11\\100-libdom\\libdom.sql.js	libdom	16bb1225-41e2-45cc-a59f-cbbdc6743a59	0	{}	{}	1	maguita_dps	38	1	2023-09-29 11:51:33.886865+00
database\\patch\\revisions\\critical\\010-2023-01-v1.0.11\\100-libdom\\libdom.sql.js	libdom_describle	b06f2fd5-c38c-4151-ad07-fd51e2cac5ca	0	{}	{}	1	maguita_dps	39	1	2023-09-29 11:51:33.952659+00
database\\patch\\revisions\\critical\\010-2023-01-v1.0.11\\100-libdom\\libdom.sql.js	tg_dom_sync	692c4e56-e011-4c69-aa4d-72622e211d5b	0	{}	{}	1	maguita_dps	40	1	2023-09-29 11:51:33.996387+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0001-iva-revision.sql.js	iva-correcao-revison-manager	e3ba5a7f-047f-479d-8c8a-cb32bf22a9cb	0	{@unique}	{}	1	maguita_dps	41	1	2023-09-29 11:51:34.041315+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0003-iva-serie.sql.js	iva-structure-ncv2	916bb74a-165f-41f3-8978-57e82bf3b834	0	{@unique}	{}	1	maguita_dps	42	1	2023-09-29 11:51:34.113544+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0003-iva-serie.sql.js	iva-structure	94b247a9-9743-4865-ba19-9661b1761808	0	{@unique}	{}	1	maguita_dps	43	1	2023-09-29 11:51:34.163065+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0003-iva-serie.sql.js	iva-structure-serie_fechoautorizacao	9b5d6283-a5ed-4218-bfb1-a32e36624756	0	{@unique}	{}	1	maguita_dps	44	1	2023-09-29 11:51:34.225787+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0003-iva-serie.sql.js	iva-serie-function:funct_sets_autorizacao-v23	7bc78ad5-51ac-4ace-8e72-12c2a31821a7	0	{}	{}	1	maguita_dps	45	1	2023-09-29 11:51:34.270747+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0003-iva-serie.sql.js	iva-serie-function:closeyear	8ed8d91a-0011-4d74-94a3-48fba021106c	0	{}	{}	1	maguita_dps	46	1	2023-09-29 11:51:34.317213+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0003-iva-serie.sql.js	iva-serie-function:load_autorizacao	edb90c7e-2f62-4566-8d2e-b675700d9b6c	0	{}	{}	1	maguita_dps	47	1	2023-09-29 11:51:34.36196+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0004-iva-cambio-correct.sql.js	cambio-correction-stn-load	48d5d583-51b8-4aed-b1a0-9f3674823b78	0	{}	{}	1	maguita_dps	48	1	2023-09-29 11:51:34.411265+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0005-iva-impost.sql.js	iva-imposto	29b3dd79-cb3a-43cb-9320-4fb75b79f16d	0	{@unique}	{}	1	maguita_dps	49	1	2023-09-29 11:51:34.457199+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0006-iva-conta-correcao.sql.js	SERIE-GUIA-SAIDA	878960a5-383c-4e7e-91d0-7ae641db21d8	0	{}	{}	1	maguita_dps	50	1	2023-09-29 11:51:34.518637+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0006-iva-conta-correcao.sql.js	TPAGA-CONTA_CORRENT	a9258d43-2d55-49dd-9705-b2f8d5b43828	0	{}	{}	1	maguita_dps	51	1	2023-09-29 11:51:34.567352+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0006-iva-conta-correcao.sql.js	maguita_cliente_final_maguita_cliente_finalnotacredito	080e9762-ca35-44dc-9762-a6bb812fcf1d	0	{}	{}	1	maguita_dps	52	1	2023-09-29 11:51:34.61199+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0006-iva-conta-correcao.sql.js	correct-conta	20a3b290-946a-447f-b38d-9fc716e001f1	0	{}	{}	1	maguita_dps	53	1	2023-09-29 11:51:34.663109+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0007-iva-nota-credito.sql.js	ivaNotaCredito	d7c975c5-0aad-4c86-b0f7-c9e00c2c2845	0	{@unique}	{}	1	maguita_dps	54	1	2023-09-29 11:51:34.760236+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0007-iva-nota-credito.sql.js	funct_reg_conta_nota_credito	92e621ed-cc5a-4078-9785-94b4ba985242	0	{}	{}	1	maguita_dps	55	1	2023-09-29 11:51:34.80925+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0009-iva-stock-correction.sql.js	correction	19b2478d-c613-4eac-ba4b-ba6bc9675ef1	0	{@unique}	{}	1	maguita_dps	56	1	2023-09-29 11:51:34.859609+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0010-iva-posto-upgrade.sql.js	ViewPostAmountInvoice	83d9f9c7-ca37-4580-b07b-2e76094ca661	0	{}	{}	1	maguita_dps	57	1	2023-09-29 11:51:34.91875+00
database\\patch\\revisions\\critical\\012-2023-06-v1.1.0-iva\\0010-iva-posto-upgrade.sql.js	funct_pos_load_conta_dia	58697449-3020-4d75-9db7-56f2138218a6	0	{}	{}	1	maguita_dps	58	1	2023-09-29 11:51:34.968962+00
database\\patch\\revisions\\critical\\013-2023-08-v2.0.2\\0001-limpar-revisoes-opcionais.sql.js	correcao-agosto-2023-09-29T11:51:31.394Z	5f52e49d-21c6-4562-919f-e2822fc19813	0	{@force}	{}	1	maguita_dps	59	1	2023-09-29 11:51:35.018591+00
database\\patch\\revisions\\critical\\013-2023-08-v2.0.2\\0002-fluxo-scan.sql.js	fluxo-scan	74b907a2-4282-4507-9728-4f55731e1d9c	0	{}	{}	1	maguita_dps	60	1	2023-09-29 11:51:35.067355+00
database\\patch\\revisions\\critical\\013-2023-08-v2.0.2\\0003-stock-calca.sql.js	stock-calculator	33195baf-9fcf-4a90-9fac-f024f4392285	0	{}	{}	1	maguita_dps	61	1	2023-09-29 11:51:35.115595+00
database\\patch\\revisions\\critical\\013-2023-08-v2.0.2\\0003-stock-calca.sql.js	stock-admin	5b9aa3ca-b79e-469c-8dc0-edf2e3ca1b33	0	{}	{}	1	maguita_dps	62	1	2023-09-29 11:51:35.164782+00
database\\patch\\revisions\\critical\\013-2023-08-v2.0.2\\0003-stock-calca.sql.js	stock-pos	e4447b4b-bdcb-4fce-9441-43ab0e2daf16	0	{}	{}	1	maguita_dps	63	1	2023-09-29 11:51:35.214012+00
database\\patch\\revisions\\critical\\013-2023-08-v2.0.2\\0003-stock-calca.sql.js	stock-class	26d2eab9-a3f8-4456-b92c-1548e2fbba23	0	{}	{}	1	maguita_dps	64	1	2023-09-29 11:51:35.258391+00
database\\patch\\revisions\\critical\\013-2023-08-v2.0.2\\0003-stock-calca.sql.js	funct-load-class	f0fb4869-49bd-49d4-aa39-e26afeea45b4	0	{}	{}	1	maguita_dps	65	1	2023-09-29 11:51:35.305265+00
database\\patch\\revisions\\critical\\013-2023-08-v2.0.2\\0003-stock-calca.sql.js	funct_pos_load_artigo_search	6946b587-1f62-482b-93ce-1fb84be67689	0	{}	{}	1	maguita_dps	66	1	2023-09-29 11:51:35.349229+00
database\\patch\\revisions\\critical\\013-2023-08-v2.0.2\\0003-stock-calca.sql.js	funct_load_conta_dia	36a3408e-3eb3-4049-9374-aa991b7ea2e0	0	{}	{}	1	maguita_dps	67	1	2023-09-29 11:51:35.394738+00
database\\patch\\revisions\\critical\\013-2023-08-v2.0.2\\0003-stock-calca.sql.js	tweeks.__artigo_has_stock	80bdbbdc-a5a5-4b71-9407-23624f57ecf6	0	{}	{}	1	maguita_dps	68	1	2023-09-29 11:51:35.440334+00
database\\patch\\revisions\\critical\\013-2023-08-v2.0.2\\0004-guia-patche.sql.js	guia-reg-conta	36a3408e-3eb3-4049-9374-aa991b7ea2e0	0	{}	{}	1	maguita_dps	69	1	2023-09-29 11:51:35.48448+00
database\\patch\\revisions\\critical\\014-2023-09-v2.0.6\\0001-reports.sql.js	parametized-reports-lidom	be576107-48f9-45db-bc46-1c0ebac51eaa	0	{}	{}	1	maguita_dps	70	1	2023-09-29 11:51:35.529856+00
database\\patch\\revisions\\critical\\014-2023-09-v2.0.6\\0001-reports.sql.js	parametrized-reports-structure-force-02	eb139c63-a567-4211-bb49-57e298c1c1e2	0	{@unique}	{}	1	maguita_dps	71	1	2023-09-29 11:51:35.588796+00
database\\patch\\revisions\\critical\\014-2023-09-v2.0.6\\0001-reports.sql.js	parametrized-reports-structure-drop-mode	fc64cc51-dec8-4649-9c85-ec0b80fac2a8	0	{@unique}	{}	1	maguita_dps	72	1	2023-09-29 11:51:35.656374+00
database\\patch\\revisions\\critical\\014-2023-09-v2.0.6\\0001-reports.sql.js	parametrized-reports-domains-001	f3e7ac9d-5af1-41f5-a389-4c13dae936cb	0	{}	{}	1	maguita_dps	73	1	2023-09-29 11:51:35.710098+00
database\\patch\\revisions\\critical\\014-2023-09-v2.0.6\\0001-reports.sql.js	parametrized-reports-functions	528a2d90-86a9-4e96-b900-3146bb3fcbd9	0	{}	{}	1	maguita_dps	74	1	2023-09-29 11:51:35.837721+00
database\\patch\\revisions\\critical\\014-2023-09-v2.0.6\\0001-reports.sql.js	posto_definirmontanteautomaticamente	1f539c26-3d38-4c20-967c-a081bf5e04f3	0	{}	{}	1	maguita_dps	75	1	2023-09-29 11:51:35.885491+00
database\\patch\\revisions\\critical\\014-2023-09-v2.0.6\\0002-products-unit.sql.js	unit|v2.1.1-5656	fc535ed6-a620-4a0b-b89c-063325672905	0	{@unique}	{}	1	maguita_dps	76	1	2023-09-29 11:51:35.93193+00
database\\patch\\revisions\\critical\\014-2023-09-v2.0.6\\0002-products-unit.sql.js	unit-v2.1.1-8393	a152f1f1-0cd1-473d-b401-a9d337be05c1	0	{}	{}	1	maguita_dps	77	1	2023-09-29 11:51:36.021382+00
database\\patch\\revisions\\critical\\014-2023-09-v2.0.6\\0003-tg-create-lancamento.sql.js	create-lancamento	1cf2c5a5-fbab-489f-b6d9-e68ae733d928	0	{}	{}	1	maguita_dps	78	1	2023-09-29 11:51:36.077075+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\00003-__tg_fluxo_on_venda.sql.js	tweeks.__tg_fluxo_on_venda	8974e00f-edc9-44f3-b09c-7cd2554e856a	0	{}	{}	1	maguita_dps	79	1	2023-09-29 11:51:36.124902+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\00003-__tg_fluxo_on_venda.sql.js	tg_fluxo_on_venda_update	b55785c1-83ca-4915-ba04-217c6ea69e81	0	{@unique}	{}	1	maguita_dps	80	1	2023-09-29 11:51:36.180409+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0001-check-venda.sql.js	__tg_venda_before_check	71cb322f-54cc-4f26-9fdb-e244673a4c79	0	{}	{}	1	maguita_dps	81	1	2023-09-29 11:51:36.228592+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0001-check-venda.sql.js	trigger:tg_venda_before_check	dadd3ca4-34a7-4480-b746-1bc06c66cc05	0	{}	{}	1	maguita_dps	82	1	2023-09-29 11:51:36.275473+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0001-check-venda.sql.js	tweeks.check-conta	f60009fa-2cf6-4641-a31e-76115ac0dfd8	0	{@unique}	{}	1	maguita_dps	83	1	2023-09-29 11:51:36.320513+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0001-check-venda.sql.js	tweeks.funct_pos_generate_key	f3d3bea8-d948-4abb-a0bd-2136828846b3	0	{}	{}	1	maguita_dps	84	1	2023-09-29 11:51:36.36626+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0001-check-venda.sql.js	tweeks.funct_pos_reg_conta|-v2.0.1	8d975386-a7bf-4871-b809-663227d7ab9f	0	{}	{}	1	maguita_dps	85	1	2023-09-29 11:51:36.407782+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0001-check-venda.sql.js	conta_props	7163d02d-6e4c-4059-84b1-40ed641f4505	0	{@unique}	{}	1	maguita_dps	86	1	2023-09-29 11:51:36.449845+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0001-check-venda.sql.js	venda_proforma	a6b4d496-597e-4fa6-98b0-c6284fd46fe2	0	{@unique}	{}	1	maguita_dps	87	1	2023-09-29 11:51:36.490454+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0002-load-conta-data-proforma.sql.js	funct_pos_load_conta_proforma	8847aeb5-608a-459b-ba3c-c1ea69f35bbb	0	{}	{}	1	maguita_dps	88	1	2023-09-29 11:51:36.532529+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0002-load-conta-data-proforma.sql.js	tweeks.funct_load_guia_data	939f0a73-2129-4cc3-8a64-6ed4475f45b3	0	{}	{}	1	maguita_dps	89	1	2023-09-29 11:51:36.575225+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0004-tweeks.sets-venda.sql.js		3c06a093-51df-44fd-b5f9-c595ef77e6ef	0	{}	{}	1	maguita_dps	90	1	2023-09-29 11:51:36.614027+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0005-conta-data-validatorsql.js	conta-data-validator:conta_tserie_id	efee91e4-102d-402f-a2e1-2a1639ea6fc2	0	{@unique}	{}	1	maguita_dps	91	1	2023-09-29 11:51:36.69651+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0005-conta-data-validatorsql.js	check-conta-data	43c4023e-946d-496e-a0d9-f14b17847231	0	{}	{}	1	maguita_dps	92	1	2023-09-29 11:51:36.791135+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0005-conta-data-validatorsql.js	proforma-v2.1.1	77501049-bfdc-46c6-bfc8-5d255658db13	0	{}	{}	1	maguita_dps	93	1	2023-09-29 11:51:36.83431+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0005-conta-data-validatorsql.js	funct_load_pos	61edc788-f524-4695-89cc-bc6a40524716	0	{@unique}	{}	1	maguita_dps	94	1	2023-09-29 11:51:36.879504+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0006-paramtrizacao.sql.js	tweeks.parametrizacao-structure	72a37d17-0aad-45ec-8128-8afd9b74bdc5	0	{@unique}	{}	1	maguita_dps	95	1	2023-09-29 11:51:36.924808+00
database\\patch\\revisions\\critical\\2023-09-v2.1.1\\0006-paramtrizacao.sql.js	parametrizacao-functions	bcd0a7cb-7938-42ed-b63d-93aec2f816ab	0	{}	{}	1	maguita_dps	96	1	2023-09-29 11:51:36.981846+00
database\\patch\\revisions\\z-menu\\menu.sql.js	lumaguita-menus	baf1c8ed-1e05-4f00-869f-d34f6e75b255	0	{}	{}	1	maguita_dps	97	1	2023-09-29 11:51:37.027768+00
database\\patch\\revisions\\zzz\\report\\core-engine-v2\\prepare.engine.sql.js	report:engine|prepare	e1f2a308-460e-4a30-ae48-bc8779d90189	0	{}	{}	1	maguita_dps	98	1	2023-09-29 11:51:37.461859+00
database\\patch\\revisions\\zzz\\report\\core-engine-v2\\report.engine.sql.js	report:function|core	7ec4be50-b385-4303-9c33-2eeef018b2ed	0	{}	{}	1	maguita_dps	99	1	2023-09-29 11:51:37.515799+00
database\\patch\\revisions\\zzz\\report\\core-engine-v2\\x3.engine.sql.js	report:function|3x	03140623-4ba0-4c8c-b0bc-6d9c4931cc4b	0	{}	{}	1	maguita_dps	100	1	2023-09-29 11:51:37.565198+00
database\\patch\\revisions\\zzz\\report\\core-engine-v2\\_base.engine.sql.js	report:engine|base	4a5cb860-35b6-4e6b-bfd3-3078c642d377	0	{}	{}	1	maguita_dps	101	1	2023-09-29 11:51:37.614835+00
database\\patch\\revisions\\zzz\\report\\core-templates-v2\\aggregate.template.sql.js	report:template|aggregation	a9183ddb-3983-447b-96cb-69ddf0e9de73	0	{}	{}	1	maguita_dps	102	1	2023-09-29 11:51:37.756851+00
database\\patch\\revisions\\zzz\\report\\core-templates-v2\\filter.template.sql.js	report|template|filter	718e2f2f-a965-4fb5-8f08-d5796e6cdae6	0	{}	{}	1	maguita_dps	103	1	2023-09-29 11:51:37.798079+00
database\\patch\\revisions\\zzz\\report\\core-templates-v2\\query.template.sql.js	report:template|query	66707f08-762b-4bf2-9add-764f75b9b347	0	{}	{}	1	maguita_dps	104	1	2023-09-29 11:51:37.845717+00
database\\patch\\revisions\\zzz\\report\\sources-v2\\balanco.sorce.report.sql.js	report:source|balanco-v2.0.6-0.06449789554049401	f44a7706-e499-465b-b7a7-f2f5134125d7	0	{}	{}	1	maguita_dps	105	1	2023-09-29 11:51:37.893042+00
database\\patch\\revisions\\zzz\\report\\sources-v2\\caixa.source.report.sql.js	report:source|caixa-v2.0.6-0.592194437135227	559e8ddf-3783-48d4-8b44-30de5de2a273	0	{}	{}	1	maguita_dps	106	1	2023-09-29 11:51:38.02412+00
database\\patch\\revisions\\zzz\\report\\sources-v2\\conta.source.report.sql.js	report:source|conta-v2.0.6-0.38448964313517364	791983f3-5209-40f1-aaaa-6a80e0398ecb	0	{}	{}	1	maguita_dps	107	1	2023-09-29 11:51:38.153504+00
database\\patch\\revisions\\zzz\\report\\sources-v2\\fatura.source.report.sql.js	report:source|fatura-v2.0.6-0.39953846658995884	623641ba-0f1a-43cf-b758-3aec4a0827de	0	{}	{}	1	maguita_dps	108	1	2023-09-29 11:51:38.277553+00
database\\patch\\revisions\\zzz\\report\\sources-v2\\fluxo.source.report.sql.js	report:source|fluxo-v2.0.6-0.4995041470870949	e31f2493-941a-4e47-b834-e50eaf702f23	0	{}	{}	1	maguita_dps	109	1	2023-09-29 11:51:38.404414+00
database\\patch\\revisions\\zzz\\report\\sources-v2\\guia-entrada.source.report.sql.js	report.vreport_guiaentrada|v2.0.6-0.9386052982295383	98959aa7-9c6c-4385-9609-b0e53880dabc	0	{}	{}	1	maguita_dps	110	1	2023-09-29 11:51:38.541059+00
database\\patch\\revisions\\zzz\\report\\sources-v2\\guia-saida.source.report.sql.js	report.vreport_guiasaida|v2.0.6-01-0.03819424208030742	c0095c03-fc50-4885-9629-62ca63c2cda4	0	{}	{}	1	maguita_dps	111	1	2023-09-29 11:51:38.667051+00
database\\patch\\revisions\\zzz\\report\\sources-v2\\imposto.source.report.sql.js	report:source|imposto-v2.0.6-0.7398850046557794	821c9e66-0aa7-4dfd-88c5-1ed830a0183e	0	{}	{}	1	maguita_dps	112	1	2023-09-29 11:51:38.803971+00
database\\patch\\revisions\\zzz\\report\\sources-v2\\notacredito.source.report.sql.js	report.vreport_notacredito|v2.0.6-0.9053519160579337	fbb34631-0206-4e82-a867-a325942c940e	0	{}	{}	1	maguita_dps	113	1	2023-09-29 11:51:38.924963+00
database\\patch\\revisions\\zzz\\report\\sources-v2\\venda.source.report.sql.js	report:source|venda-v2.0.6-0.283257135276652	ec7c77e6-6eb8-4f15-8f47-d13dc231b0f3	0	{}	{}	1	maguita_dps	114	1	2023-09-29 11:51:39.067168+00
database\\patch\\revisions\\zzz\\report\\sources-v2\\venda_artigo.source.report.sql.js	report.vreport_venda_artigo|v2.2.1	6788bcbc-bed7-4ebc-b464-1a52c86d7dda	0	{}	{}	1	maguita_dps	115	1	2023-09-29 11:51:39.190532+00
database\\patch\\revisions\\zzz\\report\\sources-v2\\_finacas.source.report.sql.js	report.vreport_imposto_financas|v2.0.6-0.944940611082256	d3bc359a-22af-4989-986d-dfd76e1be8a6	0	{}	{}	1	maguita_dps	116	1	2023-09-29 11:51:39.326244+00
database\\patch\\revisions\\_simple\\force.patch.sql.js	simpleForce	5117e5a9-a81d-474c-b4f6-84b3e947842e	0	{@force}	{}	1	maguita_dps	117	1	2023-09-29 11:51:39.369677+00
database\\patch\\revisions\\_simple\\ignore.patch.sql.js	simpleExclusionMode	665ceb5d-f4eb-4399-a16c-45016cee17c2	0	{}	{}	1	maguita_dps	118	1	2023-09-29 11:51:39.40919+00
database\\patch\\revisions\\_simple\\simple.patch.sql.js	simplePathSQL	d197392b-db65-41d6-a857-255494c46f8b	0	{}	{}	1	maguita_dps	119	1	2023-09-29 11:51:39.448365+00
database\\patch\\revisions\\_simple\\unique.patch.sql.js	simpleUnique	3bdc9a01-6f75-4d68-8d8c-066871c4cfbf	0	{@unique}	{}	1	maguita_dps	120	1	2023-09-29 11:51:39.49327+00
\.


--
-- TOC entry 5518 (class 0 OID 19919)
-- Dependencies: 375
-- Data for Name: agg; Type: TABLE DATA; Schema: report; Owner: -
--

COPY report.agg (key, priority, function, types, format, label, name, rename, description, simple, expression, over) FROM stdin;
sum	1	sum	{int,double,money}	\N	SOMAR	∑SOM. %s	#SUMOF %s	SOMATORIO DOS VALORES NA COLUNA %s	sum( %s )	sum( %s ) as %I	sum( %s ) over ()
count	2	count	{int,double,money,date,timestamp,time,timestamptz,name,code,text,id,*}	int	CONTAR TUDO	∑QTD. %s	#COUNTOF %s	CONTAGEM DOS VALORES NA COLUNA %s (INCLUIDO DUPLICADOS)	count( %s )	count( %s ) as %I	count( %s ) over ()
count::distinct	3	count	{int,double,money,date,timestamp,time,timestamptz,name,code,text,id}	int	CONTAR DISTINTO	∑QTD. DIST. %s	#COUNTOF:DISTINCT %s	CONTAGEM DOS VALORES NA COLUNA %s (EXCLUINDO DUPLICADOS)	count( distinct %s ) 	count(  distinct %s ) as %I 	count( %s ) filter( where %I = 1) over ()
max	4	max	{int,double,money,date,timestamp,time,timestamptz,name,code,text,id}	\N	MÁXIMO	∑MAX. %s	#MAXOF %s	MAXIMO VALOR NA COLUNA %s	max( %s )	max( %s ) as %I	max( %s ) over ()
min	5	min	{int,double,money,date,timestamp,time,timestamptz,name,code,text,id}	\N	MÍNIMO	∑MIN. %s	#MINOF %s	MINIMO VALOR NA COLUNA %s	min( %s )	min( %s ) as %I	min( %s ) over ()
avg	6	avg	{int,double,money}	\N	MEDIA	∑MED. %s	#AVGOF %s	MEDIA DE VALORES NA COLUNA %s	avg( %s )	avg( %s ) as %I	avg( %s ) over ()
\.


--
-- TOC entry 5512 (class 0 OID 19779)
-- Dependencies: 369
-- Data for Name: filter; Type: TABLE DATA; Schema: report; Owner: -
--

COPY report.filter (filter_uid, filter_parametrized_uid, filter_name, filter_props, filter_require, filter_column, filter_type, filter_opr, filter_basevalue, filter_valuemode, filter_increment, filter_grants, filter_state, filter_date, filter_update, filter_user_id, filter_user_update, filter_espaco_auth, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5520 (class 0 OID 19933)
-- Dependencies: 377
-- Data for Name: mask; Type: TABLE DATA; Schema: report; Owner: -
--

COPY report.mask (type, mask, name, description, representation, function, priority) FROM stdin;
{date,timestamp,timestamptz}	YYYY-MM-DD	DIARIO	APRESENTAÇÃO DIÁRIA	DD-MM-YYYY	to_char	100
{date,timestamp,timestamptz}	YYYY-MM	MENSAL	APRESENTAÇÃO MENSAL	MON "DE" YYYY	to_char	90
{date,timestamp,timestamptz}	YYYY	ANUAL	APESENTAÇÃO ANUAL	YYYY	to_char	80
{date,timestamp,timestamptz}	YYYY "T"Q	TRIMESTRAL	APRESENTAÇÃO TRIMESTRAL	YYYY "T"Q	to_char	70
{date,timestamp,timestamptz}	2	SIMESTRAL	APRESENTAÇÃO SEMESTRAL	S	mouth_group	60
{date,timestamp,timestamptz}	YYYY-WW	SEMANAL	APRESENTAÇÃO SEMANAL	WW"ª SEM" "DE" YYYY	to_char	50
{date,timestamp,timestamptz}	YYYY-MM-W	SEMANAL MENSAL	APRESENTAÇÃO SEMANAL MENSAL	W"ª SEM" "DE" MON YYYY	to_char	49
{date,timestamp,timestamptz}	YYYY-MM-DD HH:MI	MOMENTANIO	APRESENTACÃO DIÁRIO INCLUINDO HORA E MINUTO	DD-MM-YYYY HH:MI	to_char	\N
\.


--
-- TOC entry 5511 (class 0 OID 19766)
-- Dependencies: 368
-- Data for Name: parametrized; Type: TABLE DATA; Schema: report; Owner: -
--

COPY report.parametrized (parametrized_uid, parametrized_name, parametrized_source, parametrized_columns, parametrized_groups, parametrized_props, parametrized_grants, parametrized_state, parametrized_date, parametrized_update, parametrized_user_id, parametrized_espaco_auth, parametrized_user_update, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5515 (class 0 OID 19883)
-- Dependencies: 372
-- Data for Name: report; Type: TABLE DATA; Schema: report; Owner: -
--

COPY report.report (report_name, report_source, report_columns, report_priority, report_active) FROM stdin;
RELATÓRIO DE BALANÇO	report.vreport_balanco	{artigo_id,ARTIGO,CÓDIGO,classe_id,espaco_id,ARMAZÉM,_branch_uid,CATEGORIA,DATA,"QT. ENTRADA","$ RECEITA EFET.","$ RECEITA PREV.","$ RECEITA ESTI.","QT. SAÍDA","$ DESPESA EFET.","$ DESPESA PREV.","$ DESPESA ESTI.","$ REST. PREV.","$ REST. EFET.","$ REST. ESTI.","REST. QT."}	1	t
RELATÓRIO DE CAIXA	report.vreport_caixa	{caixa_id,CAIXA,"$ CAP. FEC.","$ CAP. FEC. POS","$ CAP. INI.","$ CAP. INI. POS",CHEQUES,"CHEQUES POS",OBSERVAÇÃO,ABERTURA,FECHO,"ESTADO CAIXA",POSTO,ARMAZÉM,colaborador_owner,PROPRIETARIO,colaborador_close,ENCERADOR,colaborador_operador,OPERADOR,TITULAR,NIF,"P. RECIBO","P. MODALIDADE","P. DOCUMENTO","P. MOEDA","P. $RECEBIDO","P. $CÂMBIO","P. $REC. x $CÂM.","P. $TROCO","P. $M. FINAL","P. DATA",ENTRADA,cliente_id,posto_id,espaco_id,deposito_id,currency_id,caixa_estado,tpaga_id,_branch_uid}	1600	t
RELATÓRIO DE CONTA/LANÇAMENTO	report.vreport_conta	{SEQUÊNCIA,CLIENTE,NIF,DOCUMENTO,"$ CREDITO","$ DEBITO","$ MONTANTE","$ RESULTADO","$ REGULARIZADO",TIPO,CONTA,OPERAÇÃO,MODO,COLABORADOR,DATA,REGISTRO,OBSERVAÇÃO,lancamento_id,cliente_id,_conta_id,_deposito_id,tgrupo_id,tlancamento_id,colaborador_id,lancamento_mode,_branch_uid,lancamento_operacao}	1800	t
RELATÓRIO DE FATURA	report.vreport_fatura	{conta_id,DATA,REGISTO,FECHO,FATURA,PROFOMA,conta_proforma,ESTADO,"Nº CONTA",INPRESSÕES,"PROF. VENCIMENTO",conta_estado,tgrupo_id,_branch_uid,"TIPO CONTA","$ MONTANTE","$ DESCONTO","$ PAGAR",cliente_id,CLIENTE,NIF,posto_id,POSTO,espaco_id,ARMAZÉM,"CÓDIGO AR.",VENDEDOR,ABERTURA,"Nº SERIE",SERIE,"TIPO SERIE",colaborador_abertura,colaborador_vendor,tserie_id,serie_id}	1900	t
RELATÓRIO DE FLUXO	report.vreport_fluxo	{OPERAÇÃO,ARTIGO,ARMAZÉM,QT,DOCUMENTO,DATA,COLABORADOR,SEQUENCIA,"ART. ENTRADA","ART. SAÍDA","ARM. ORIGEM","ARM. DESTINO",QT+,QT-,REGISTO,OBSERVAÇÃO,__artigo_id,__espaco_id,__classe_id,fluxo_referencia,fluxo_id,toperacao_id,__artigo_in,__artigo_out,__espaco_in,__espaco_out,__classe_in,__classe_out,colaborador_id,_branch_uid}	1300	t
RELATÓRIO DE GUIA ENTRADA	report.vreport_guiaentrada	{LOTE,QT,DESCRICAO,"QT ANTES",VALIDADE,"$ UNIT","$ TOTAL",DATA,DOCUMENTO,NUMERO,OBS,FORNECEDOR,"F. NIF","CÓD. FOR.",ARMAZEM,"CÓD. ARM.",ARTIGO,"CÓD. ART.",CATEGORIA,"CÓD. CAT.",entrada_id,guia_uid,fornecedor_id,espaco_id,artigo_id,classe_id,_branch_uid}	1200	t
RELATÓRIO DE GUIA SAIDA	report.vreport_guiasaida	{venda_id,SERIE,ARTIGO,CATEGORIA,"CÓD. CAT.",ARMAZÉM,POSTO,NIF,CLIENTE,"$ PREÇO",QT,"$ MONT.","$ EXTRAS","$ MONT+EXT","$ IMPOSTO","$ SUBTOTAL","$ TOTAL","$ MONTANTE FINAL",venda_isencao,IMPOSTOS,TAXAS,_tipoimposto_ids,artigo_id,DATA,_tgrupo_id,conta_cliente_id,posto_id,espaco_id,COLABORADOR,colaborador_fecho,classe_id,"CÓD ARTIGO",_branch_uid}	1100	t
RELATÓRIO DE IMPOSTO	report.vreport_imposto	{tipoimposto_id,CODIGO,IMPOSTO,"CÓD. ART.",ARTIGO,CATEGORIA,"CÓD. CATEGORIA",CLIENTE,NIF,FATURA,TAXA,"+$ IMPOSTO","-$ IMPOSTO","$ IMPOSTO",ISENÇÃO,"$ SUBTOTAL","$ TOTAL",serie_id,"NUM. SERIE",SERIE,"CERT. SERIE","TIPO SERIE",COLABORADOR,DATA,_date,venda_isencao,_branch_uid,colaborador_id,tserie_id,artigo_id,venda_id,classe_id}	1400	t
RELATÓRIO DE NOTA CREDITO	report.vreport_notacredito	{venda_id,DOCUMENTO,JUSTIFICATIVA,"DOC. ORIGEM",ARTIGO,CATEGORIA,"CÓD. CAT.",ARMAZÉM,POSTO,NIF,CLIENTE,"$ PREÇO",QT,"$ MONT.","$ EXTRAS","$ MONT+EXT","$ IMPOSTO","$ SUBTOTAL","$ TOTAL","$ MONTANTE FINAL",venda_isencao,ISEN.,IMPOSTOS,TAXAS,_tipoimposto_ids,artigo_id,DATA,tserie_id,SERIE,_tgrupo_id,conta_cliente_id,posto_id,espaco_id,COLABORADOR,_branch_uid,colaborador_fecho,classe_id,deposito_id,_caixa_id,CAIXA,"CÓD ARTIGO"}	1500	t
RELATÓRIO DE VENDAS	report.vreport_venda	{venda_id,FATURA,ARTIGO,CATEGORIA,"CÓD. CAT.",ARMAZÉM,POSTO,NIF,CLIENTE,"$ PREÇO",QT,"$ MONT.","$ EXTRAS","$ MONT+EXT","$ IMPOSTO","$ SUBTOTAL","$ TOTAL","$ MONTANTE FINAL",venda_isencao,ISEN.,IMPOSTOS,TAXAS,_tipoimposto_ids,artigo_id,DATA,tserie_id,SERIE,_tgrupo_id,conta_cliente_id,posto_id,espaco_id,COLABORADOR,_branch_uid,colaborador_fecho,classe_id,deposito_id,_caixa_id,CAIXA,"CÓD ARTIGO"}	2000	t
RELATÓRIO DE ARTIGO VENDIDOS	report.vreport_venda_artigo	{ARTIGO,CATEGORIA,"CÓD. CAT.",ARMAZÉM,POSTO,QT,"$ MONT.","$ EXTRAS","$ MONT+EXT","$ IMPOSTO","$ SUBTOTAL","$ TOTAL",IMPOSTOS,TAXAS,_tipoimposto_ids,artigo_id,tserie_id,SERIE,posto_id,espaco_id,COLABORADOR,CAIXA,_caixa_id,"CÓD ARTIGO",_branch_uid}	1850	t
\.


--
-- TOC entry 5519 (class 0 OID 19926)
-- Dependencies: 376
-- Data for Name: talias; Type: TABLE DATA; Schema: report; Owner: -
--

COPY report.talias (type, alias) FROM stdin;
date	{date}
int	{int,int4,integer}
smallint	{int2,smallint}
bigint	{bigint,int8}
varchar	{varchar,"character varying"}
double	{double,"double precision",float8}
char	{char,character}
bool	{bool,boolean}
timestamp	{timestamp,"timestamp without time zone"}
time	{time,"time without time zone"}
timestamptz	{timestamptz,"timestamp with time zone"}
timetz	{timetz,"time with time zone"}
\.


--
-- TOC entry 5516 (class 0 OID 19896)
-- Dependencies: 373
-- Data for Name: template; Type: TABLE DATA; Schema: report; Owner: -
--

COPY report.template (type, name, configs) FROM stdin;
agg	sum	{"func": "sum", "init": {"$type": "boolean", "$default": false, "$template": true, "$structure": "${args.init}"}, "name": {"$type": "text", "$default": "Somatorio", "$template": true, "$structure": "Soma de ${name}"}, "format": "int", "rename": {"$default": "SOMA", "$template": true, "$structure": "SUM ${name}"}}
agg	sumMoney	{"func": "sum", "init": {"$type": "boolean", "$default": false, "$template": true, "$structure": "${args.init}"}, "name": {"$type": "text", "$default": "Somatorio", "$template": true, "$structure": "Soma de ${name}"}, "format": "money", "rename": {"$default": "SOMA", "$template": true, "$structure": "SUM ${name}"}}
agg	sumMoney2	{"func": "sum", "init": {"$type": "boolean", "$default": false, "$template": true, "$structure": "${args.init}"}, "name": {"$type": "text", "$default": "Somatorio", "$template": true, "$structure": "${args.name}"}, "format": "money", "rename": {"$default": "SOMA", "$template": true, "$structure": "${args.name}"}}
agg	count	{"func": "count", "init": {"$type": "boolean", "$default": false, "$template": true, "$structure": "${args.init}"}, "name": {"$type": "text", "$template": true, "$structure": "Contagem de ${name}"}, "format": "init", "rename": {"$default": "TOTAL", "$template": true, "$structure": "TOTAL ${name}"}}
agg	count2	{"func": "count", "init": {"$type": "boolean", "$default": false, "$template": true, "$structure": "${args.init}"}, "name": {"$type": "text", "$template": true, "$structure": "${args.name}"}, "format": "init", "rename": {"$default": "TOTAL", "$template": true, "$structure": "${args.rename}"}}
query	date|start	{"opr": ">=", "name": {"$type": "text", "$default": "DATA INICIO", "$template": true, "$structure": "${name} INICIO"}, "format": "date"}
query	date|end	{"opr": "<=", "name": {"$type": "text", "$default": "DATA FIM", "$template": true, "$structure": "${name} FIM"}, "format": "date"}
query	range|start	{"opr": ">=", "name": {"$type": "text", "$default": "DE", "$template": true, "$structure": "${args.name}"}, "format": {"$type": "text", "$default": "DE", "$template": true, "$structure": "${format}"}}
query	range|end	{"opr": "<=", "name": {"$type": "text", "$default": "ATÉ", "$template": true, "$structure": "${args.name}"}, "format": {"$type": "text", "$default": "ATÉ", "$template": true, "$structure": "${format}"}}
query	equalsSimple	{"opr": {"$type": "text", "default": "=", "$template": true, "$structure": "${args.opr}"}, "name": {"$type": "text", "$template": true, "$structure": "Filtrar por ${args.name}"}, "format": "simple"}
query	like	{"opr": "like", "mode": {"$type": "text", "$default": "right", "$template": true, "$structure": "${args.mode}"}, "name": {"$type": "text", "$template": true, "$structure": "Filtrar por ${args.name}"}, "format": "simple"}
query	source|tweeks.posto	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "POSTO", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.posto"}
query	boolean|Y/N	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "OPÇÃO (SIN/NÃO)", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "boolean|Y/N"}
query	boolean|ON/OFF	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "OPÇÃO (ATIVO/DESATIVO)", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "boolean|ON/OFF"}
query	STATUS	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "ESTADOS", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "STATUS"}
query	source|tweeks.tgroup	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "ESTADOS", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.tgroup"}
query	source|tweeks.classe	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "CATEGORIA", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.classe"}
query	source|auth.colaborador	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "COLABORADOR", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "auth.colaborador"}
query	source|tweeks.espaco	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "ARMAZEM", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.espaco"}
query	source|tweeks.artigo	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "ARTIGO", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.artigo"}
query	source|geoinfo.currency	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "MOEDA", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "geoinfo.currency"}
query	source|tweeks.toperacao	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "OPERAÇÃO", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.toperacao"}
query	source|tweeks.tpaga	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "MODALIDADE DE PAGAMENTO", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.tpaga"}
query	source|tweeks.cliente	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "CLIENTE", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.cliente"}
query	source|tweeks.fornecedor	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "FORNECEDOR", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.fornecedor"}
query	source|tweeks.tipoimposto	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "TIPO IMPOSTO", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.tipoimposto"}
query	source|tweeks.serie	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "SERIE DE FATURA", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.serie"}
query	source|tweeks.tserie	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "TIPO DE SERIE", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.tserie"}
query	source|tweeks.caixa::estado	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "ESTADO DE CAIXA", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.caixa::estado"}
query	source|tweeks.tlancamento	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "TIPO DE LANÇAMENTO", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.tlancamento"}
query	source|tweeks.lancamento::mode	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "MODO LANÇAMENTO", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.lancamento::mode"}
query	source|tweeks.tmovimento	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "TIPO DE MOVIMENTO", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.tmovimento"}
query	source|tweeks.tserie::venda	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "SERIE", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.tserie::venda"}
query	source|tweeks.caixa	{"opr": "=", "src": "db", "name": {"$type": "text", "$default": "CAIXA", "$template": true, "$structure": "${args.name}"}, "format": "select", "source": "tweeks.caixa"}
\.


--
-- TOC entry 5521 (class 0 OID 19943)
-- Dependencies: 378
-- Data for Name: var; Type: TABLE DATA; Schema: report; Owner: -
--

COPY report.var (var_key, var_description, var_type, var_expression) FROM stdin;
current_timestamp	Timestamp Atual	timestamp	select current_timestamp
current_user	Current Database User	text	select "current_user"()
current_collaborator	Collaborador atual	uuid	select $1->>'arg_colaborador_id'
current_branch	Branch Atual	uuid	select coalesce( ($1->>'branch_uid')::uuid, ( $1->>'arg_branch_id')::uuid, ( $1->>'_branch_uid')::uuid, ( $1->>'arg_branch_uid')::uuid, tweeks.__branch_uid( ($1->>'arg_colaborador_id')::uuid, ($1->>'arg_espaco_auth' )::uuid))
current_space	Espaço atual (Armazem Atual)	uuid	select $1->>'arg_espaco_auth'
today	Hoje	date	select current_date
yesterday	Ontem	date	select current_date - interval '1' day
end_of_month	Fim do mês	date	select to_date(to_char(current_date + interval '1' month, 'yyyy-mm'), 'yyyy-mm')-interval '1' day
current_time	Hora atual	time	select current_time
now	Momento atual	timestamptz	select now()
\.


--
-- TOC entry 5517 (class 0 OID 19906)
-- Dependencies: 374
-- Data for Name: vcolumn; Type: TABLE DATA; Schema: report; Owner: -
--

COPY report.vcolumn (source, name, "position", show, init, format, filter, agg, noagg, gen, rename, type) FROM stdin;
report.vreport_conta	MODO	1675	t	f	code	[]	[]	f	[]	\N	text
report.vreport_fatura	VENDEDOR	95	t	t	name:mid	[]	[]	\N	[]	\N	character varying
report.vreport_fatura	conta_id	\N	f	f	id	[]	[]	\N	[]	\N	uuid
report.vreport_fatura	FATURA	10000	t	t	code:long	[{"opr": "like", "mode": "right", "name": "FATURA", "format": "simple"}]	[]	\N	[]	\N	character varying
report.vreport_fatura	Nº CONTA	1900	t	t	code	[]	[]	f	[]	\N	integer
report.vreport_fatura	POSTO	1885	t	f	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_fatura	CÓDIGO AR.	995	t	f	code	[]	[]	\N	[]	\N	character varying
report.vreport_fatura	ARMAZÉM	994	t	t	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_fatura	NIF	986	t	t	code	[]	[]	f	[]	\N	character varying
report.vreport_fatura	CLIENTE	985	t	f	name	[{"opr": "like", "mode": "right", "name": "NOME DO CLIENTE", "format": "simple"}]	[]	\N	[]	\N	character varying
report.vreport_fatura	$ MONTANTE	555	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_imposto	CODIGO	995	t	t	code	[]	[]	f	[]	\N	character varying
report.vreport_imposto	IMPOSTO	985	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_imposto	CÓD. ART.	976	t	t	code	[["query.like", {"mode": "right", "name": "CÓDIGO DE ARTIGO"}]]	[]	f	[]	\N	character varying
report.vreport_imposto	ARTIGO	975	t	f	name:mid	[]	[]	f	[]	\N	character varying
report.vreport_imposto	CATEGORIA	974	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_imposto	CÓD. CATEGORIA	973	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_imposto	CLIENTE	965	t	f	name	[]	[]	f	[]	\N	character varying
report.vreport_imposto	NIF	955	t	t	code	[["query.like", {"mode": "right", "name": "NIF"}]]	[]	f	[]	\N	character varying
report.vreport_imposto	FATURA	945	t	t	code:long	[["query.like", {"mode": "right", "name": "FATURA"}]]	[]	f	[]	\N	character varying
report.vreport_imposto	TAXA	795	t	t	code	[]	[]	f	[]	\N	text
report.vreport_imposto	+$ IMPOSTO	785	t	f	money	[]	[]	f	[]	\N	double precision
report.vreport_imposto	-$ IMPOSTO	775	t	f	money	[]	[]	f	[]	\N	double precision
report.vreport_imposto	$ IMPOSTO	765	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_imposto	ISENÇÃO	755	t	f	code	[]	[]	f	[]	\N	text
report.vreport_imposto	$ SUBTOTAL	745	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_imposto	$ TOTAL	735	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_imposto	NUM. SERIE	596	t	t	code	[["query.like", {"mode": "right", "name": "NUMERO DE SERIE"}]]	[]	f	[]	\N	character varying
report.vreport_imposto	serie_id	\N	f	f	\N	[["query.source|tweeks.serie", {"name": "SERIE"}]]	[]	f	[]	\N	uuid
report.vreport_imposto	tipoimposto_id	\N	f	f	\N	[["query.source|tweeks.tipoimposto", {"name": "TIPO IMPOSTO"}]]	[]	f	[]	\N	uuid
report.vreport_imposto	SERIE	595	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_balanco	ARTIGO	1996	t	t	name	[]	[]	\N	[]	\N	character varying
report.vreport_balanco	CÓDIGO	1995	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_balanco	CATEGORIA	1994	t	f	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_balanco	ARMAZÉM	1895	t	t	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_balanco	QT. ENTRADA	89	t	t	int	[]	[]	\N	[]	\N	double precision
report.vreport_balanco	$ DESPESA PREV.	88	t	f	money	[]	[]	\N	[]	\N	double precision
report.vreport_balanco	$ DESPESA EFET.	87	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_balanco	$ DESPESA ESTI.	86	f	f	money	[]	[]	\N	[]	\N	double precision
report.vreport_balanco	QT. SAÍDA	79	t	t	int	[]	[]	\N	[]	\N	double precision
report.vreport_balanco	$ RECEITA PREV.	78	t	f	money	[]	[]	\N	[]	\N	double precision
report.vreport_balanco	$ RECEITA EFET.	77	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_balanco	$ RECEITA ESTI.	76	t	f	money	[]	[]	\N	[]	\N	double precision
report.vreport_balanco	REST. QT.	50	t	t	int	[]	[]	\N	[]	\N	double precision
report.vreport_balanco	$ REST. PREV.	49	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_balanco	$ REST. EFET.	48	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_balanco	$ REST. ESTI.	47	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_balanco	DATA	0	t	t	date	["query.date|start", "query.date|end"]	[]	\N	[]	\N	timestamp with time zone
report.vreport_balanco	artigo_id	\N	f	f	id	["query.source|tweeks.artigo"]	[{"func": "count::distinct", "name": "TOTAL DE ARTIGO", "rename": "??COUNT::DISTINCT TOTAL ARTIGO"}]	\N	[]	\N	uuid
report.vreport_balanco	classe_id	\N	f	f	id	["query.source|tweeks.classe"]	[]	\N	[]	\N	uuid
report.vreport_balanco	espaco_id	\N	f	f	id	["query.source|tweeks.espaco"]	[]	\N	[]	\N	uuid
report.vreport_balanco	_branch_uid	\N	f	f	\N	[]	[]	\N	[]	\N	uuid
report.vreport_caixa	CAIXA	3000	t	t	code	[]	[]	f	[]	\N	character varying
report.vreport_caixa	ARMAZÉM	990	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_caixa	POSTO	980	t	t	name:short	[]	[]	f	[]	\N	character varying
report.vreport_caixa	ABERTURA	960	t	f	timestamp	[["query.range|start", {"name": "ABERTURA INICIO"}], ["query.range|end", {"name": "ABERTURA FIM"}]]	[]	f	[]	\N	timestamp with time zone
report.vreport_caixa	$ CAP. INI.	599	t	f	money	[]	[]	f	[]	\N	double precision
report.vreport_caixa	$ CAP. INI. POS	598	t	f	money	[]	[]	f	[]	\N	double precision
report.vreport_caixa	$ CAP. FEC.	589	t	f	money	[]	[]	f	[]	\N	double precision
report.vreport_caixa	$ CAP. FEC. POS	588	t	f	money	[]	[]	f	[]	\N	double precision
report.vreport_caixa	CHEQUES	579	t	f	int	[]	[]	f	[]	\N	smallint
report.vreport_caixa	CHEQUES POS	578	t	f	int	[]	[]	f	[]	\N	smallint
report.vreport_caixa	TITULAR	309	t	f	name	[]	[]	f	[]	\N	character varying
report.vreport_caixa	NIF	308	t	t	code	[]	[]	f	[]	\N	character varying
report.vreport_caixa	P. MODALIDADE	299	t	t	name:short	[]	[]	f	[]	\N	character varying
report.vreport_caixa	P. RECIBO	299	t	t	code:long	[]	[]	f	[]	\N	character varying
report.vreport_caixa	P. DATA	299	t	f	date	[]	[]	f	[]	\N	date
report.vreport_caixa	P. DOCUMENTO	299	t	f	code:long	[]	[]	f	[]	\N	character varying
report.vreport_caixa	P. $RECEBIDO	258	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_caixa	P. MOEDA	257	t	t	code	[]	[]	f	[]	\N	character varying
report.vreport_caixa	P. $CÂMBIO	256	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_caixa	P. $REC. x $CÂM.	255	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_caixa	P. $TROCO	254	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_caixa	P. $M. FINAL	253	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_caixa	OPERADOR	197	t	t	name:mid	[]	[]	f	[]	\N	character varying
report.vreport_caixa	PROPRIETARIO	196	t	f	name:mid	[]	[]	f	[]	\N	character varying
report.vreport_caixa	ENCERADOR	195	t	f	name:mid	[]	[]	f	[]	\N	character varying
report.vreport_caixa	ENTRADA	194	t	t	timestamp	[["query.range|start", {"name": "ENTRADA INICIO"}], ["query.range|end", {"name": "ENTRADA FIM"}]]	[]	f	[]	\N	timestamp with time zone
report.vreport_caixa	FECHO	193	t	f	timestamp	[["query.range|start", {"name": "FECHO INICIO"}], ["query.range|end", {"name": "FECHO FIM"}]]	[]	f	[]	\N	timestamp with time zone
report.vreport_caixa	ESTADO CAIXA	\N	t	t	code	[]	[]	f	[]	\N	text
report.vreport_caixa	OBSERVAÇÃO	\N	t	f	text	[]	[]	f	[]	\N	character varying
report.vreport_caixa	deposito_id	\N	f	f	id	[]	[{"func": "count::distinct", "name": "TOTAL PAGAMENTOS", "rename": "??COUNT::DISTINCT TOTAL PAGAMENTOS"}]	f	[]	\N	uuid
report.vreport_caixa	caixa_estado	\N	f	f	\N	[["query.source|tweeks.caixa::estado", {"name": "ESTADO DA CAIXA"}]]	[]	f	[]	\N	smallint
report.vreport_caixa	colaborador_close	\N	f	f	id	[["query.source|auth.colaborador", {"name": "ENCERADOR"}]]	[]	f	[]	\N	uuid
report.vreport_caixa	colaborador_operador	\N	f	f	id	[["query.source|auth.colaborador", {"name": "OPERADOR"}]]	[]	f	[]	\N	uuid
report.vreport_caixa	colaborador_owner	\N	f	f	id	[["query.source|auth.colaborador", {"name": "PROPRIETARIO"}]]	[]	f	[]	\N	uuid
report.vreport_caixa	currency_id	\N	f	f	id	[["query.source|geoinfo.currency", {"name": "MOEDA"}]]	[]	f	[]	\N	smallint
report.vreport_caixa	espaco_id	\N	f	f	id	[["query.source|tweeks.espaco", {"name": "ARMAZÉM"}]]	[]	f	[]	\N	uuid
report.vreport_caixa	posto_id	\N	f	f	id	[["query.source|tweeks.posto", {"name": "POSTO"}]]	[]	f	[]	\N	uuid
report.vreport_caixa	tpaga_id	\N	f	f	id	[["query.source|tweeks.tpaga", {"name": "MODALIDADE"}]]	[]	f	[]	\N	smallint
report.vreport_caixa	_branch_uid	\N	f	f	\N	[]	[]	f	[]	\N	uuid
report.vreport_caixa	caixa_id	\N	f	f	id	[]	[]	f	[]	\N	uuid
report.vreport_caixa	cliente_id	\N	f	f	id	[]	[]	f	[]	\N	uuid
report.vreport_conta	SEQUÊNCIA	1995	t	f	int	[]	[]	f	[]	\N	bigint
report.vreport_conta	CLIENTE	1895	t	t	name	[]	[]	f	[]	\N	character varying
report.vreport_conta	NIF	1894	t	f	code	[["query.like", {"name": "NIF"}]]	[]	f	[]	\N	character varying
report.vreport_conta	DOCUMENTO	1795	t	t	code:long	[["query.like", {"name": "DOCUMENTO"}]]	[]	f	[]	\N	character varying
report.vreport_conta	$ CREDITO	1785	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_conta	$ DEBITO	1775	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_conta	$ MONTANTE	1775	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_conta	$ RESULTADO	1765	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_conta	$ REGULARIZADO	1755	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_conta	TIPO	1695	t	t	code	[]	[]	f	[]	\N	character varying
report.vreport_conta	CONTA	1685	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_conta	OPERAÇÃO	1684	t	f	code	[]	[]	f	[]	\N	text
report.vreport_conta	COLABORADOR	100	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_conta	DATA	95	t	t	date	[["query.range|start", {"name": "DATA INICIO"}], ["query.range|end", {"name": "DATA FIM"}]]	[]	\N	[]	\N	date
report.vreport_conta	REGISTRO	85	t	t	timestamp	[["query.range|end", {"name": "REGISTRO INICIO"}], ["query.range|end", {"name": "REGISTRO FIM"}]]	[]	f	[]	\N	timestamp with time zone
report.vreport_conta	OBSERVAÇÃO	0	t	f	text	[]	[]	f	[]	\N	character varying
report.vreport_conta	cliente_id	\N	f	f	id	[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]	[{"func": "count::distinct", "name": "TOTAL CLIENTES", "format": "int", "rename": "??COUNT::DISTINCT TOTAL DE CLIENTES"}]	\N	[]	\N	uuid
report.vreport_conta	_conta_id	\N	f	f	id	[]	[{"func": "count::distinct", "name": "TOTAL DE FATURA", "format": "int", "rename": "??COUNT::DISTINCT TOTAL DE FATURAS"}]	f	[]	\N	uuid
report.vreport_conta	_deposito_id	\N	f	f	id	[]	[{"func": "count::distinct", "name": "TOTAL DE DEPOSITOS", "format": "int", "rename": "??COUNT::DISTINCT TOTAL DE DEPOSITOS"}]	f	[]	\N	uuid
report.vreport_conta	lancamento_id	\N	f	f	id	[]	[{"func": "count::distinct", "name": "TOTAL DE LANÇAMENTO", "format": "int", "rename": "??COUNT::DISTINCT TOTAL DE  LANCAMENTO"}]	f	[]	\N	uuid
report.vreport_conta	colaborador_id	\N	f	f	id	[["query.source|auth.colaborador", {"name": "COLABORADOR"}]]	[]	f	[]	\N	uuid
report.vreport_conta	lancamento_mode	\N	f	f	code	[["query.source|tweeks.lancamento::mode", {"name": "MODO"}]]	[]	f	[]	\N	smallint
report.vreport_conta	lancamento_operacao	\N	f	f	code	[["query.source|tweeks.toperacao", {"name": "TIPO DE OPERAÇÃO"}]]	[]	f	[]	\N	smallint
report.vreport_conta	tgrupo_id	\N	f	f	id	[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]	[]	\N	[]	\N	smallint
report.vreport_conta	tlancamento_id	\N	f	f	id	[["query.source|tweeks.tlancamento", {"name": "TIPO DE LANÇAMENTO"}]]	[]	f	[]	\N	smallint
report.vreport_conta	_branch_uid	\N	f	f	\N	[]	[]	f	[]	\N	uuid
report.vreport_fatura	$ DESCONTO	554	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_fatura	$ PAGAR	553	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_fatura	TIPO CONTA	545	t	t	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_fatura	PROFOMA	544	t	f	code	[]	[]	f	[]	\N	text
report.vreport_fatura	PROF. VENCIMENTO	543	t	f	date	[]	[]	f	[]	\N	date
report.vreport_fatura	TIPO SERIE	396	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_fatura	Nº SERIE	395	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_fatura	SERIE	394	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_fatura	INPRESSÕES	295	t	f	int	[]	[]	f	[]	\N	smallint
report.vreport_fatura	ABERTURA	94	t	f	name:mid	[]	[]	f	[]	\N	character varying
report.vreport_fatura	FECHO	86	t	f	timestamp	[]	[]	\N	[]	\N	timestamp with time zone
report.vreport_fatura	DATA	85	t	t	date	[]	[]	\N	[]	\N	date
report.vreport_fatura	REGISTO	84	t	f	date	[{"opr": ">=", "name": "Data inicio", "format": "date"}, {"opr": "<=", "name": "Data fim", "format": "date"}]	[]	\N	[]	\N	date
report.vreport_fatura	ESTADO	70	t	f	code	[]	[]	f	[]	\N	text
report.vreport_fatura	cliente_id	\N	f	f	id	[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]	[{"func": "count::distinct", "name": "TOTAL DE CLIENTES", "rename": "??COUNT::DISTINCT TOTAL DE CLIENTES"}]	\N	[]	\N	uuid
report.vreport_fatura	colaborador_abertura	\N	f	f	id	[["query.source|auth.colaborador", {"name": "COLABORADOR ABERTURA"}]]	[]	f	[]	\N	uuid
report.vreport_fatura	colaborador_vendor	\N	f	f	id	[["query.source|auth.colaborador", {"name": "COLABORADOR VENDEDOR"}]]	[]	f	[]	\N	uuid
report.vreport_fatura	conta_proforma	\N	f	f	id	[["query.boolean|Y/N", {"name": "PROFORMA"}]]	[]	f	[]	\N	boolean
report.vreport_fatura	espaco_id	\N	f	f	id	[["query.source|tweeks.espaco", {"name": "ARMAZÉM"}]]	[]	\N	[]	\N	uuid
report.vreport_fatura	posto_id	\N	f	f	id	[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]	[]	\N	[]	\N	uuid
report.vreport_fatura	serie_id	\N	f	f	id	[["query.source|tweeks.serie", {"name": "SERIE"}]]	[]	f	[]	\N	uuid
report.vreport_fatura	tgrupo_id	\N	f	f	id	[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]	[]	\N	[]	\N	smallint
report.vreport_fatura	tserie_id	\N	f	f	id	[["query.source|tweeks.tserie", {"name": "TIPO DE SERIE"}]]	[]	f	[]	\N	smallint
report.vreport_fatura	_branch_uid	\N	f	f	\N	[]	[]	\N	[]	\N	uuid
report.vreport_fatura	conta_estado	\N	f	f	\N	[]	[]	f	[]	\N	smallint
report.vreport_fluxo	ARM. ORIGEM	1117	t	f	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_fluxo	ARM. DESTINO	1116	t	f	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_fluxo	QT+	976	t	t	int	[["query.range|start", {"name": "QT+ MÍNIMA"}], ["query.range|end", {"name": "QT+ MÁXIMA"}]]	[]	\N	[]	\N	double precision
report.vreport_fluxo	SEQUENCIA	4000	t	t	code	[]	[]	f	[]	\N	bigint
report.vreport_fluxo	OPERAÇÃO	3000	t	t	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_fluxo	ARMAZÉM	1115	t	t	name:short	[]	[]	\N	[]	\N	text
report.vreport_fluxo	ART. SAÍDA	997	t	f	name:mid	[]	[]	\N	[]	\N	character varying
report.vreport_fluxo	ART. ENTRADA	996	t	f	name:mid	[]	[]	\N	[]	\N	character varying
report.vreport_fluxo	ARTIGO	995	t	t	name	[]	[]	\N	[]	\N	text
report.vreport_fluxo	DOCUMENTO	985	t	t	code:long	[]	[]	\N	[]	\N	character varying
report.vreport_fluxo	QT-	977	t	t	int	[["query.range|start", {"name": "QT- MÍNIMA"}], ["query.range|end", {"name": "QT- MÁXIMA"}]]	[]	\N	[]	\N	double precision
report.vreport_fluxo	QT	975	t	t	code:right	[]	[]	\N	[]	\N	text
report.vreport_fluxo	COLABORADOR	195	t	t	name	[]	[]	\N	[]	\N	character varying
report.vreport_fluxo	DATA	186	t	f	date	["query.date|start", "query.date|end"]	[]	\N	[]	\N	date
report.vreport_fluxo	REGISTO	185	t	t	timestamp	[]	[]	\N	[]	\N	timestamp with time zone
report.vreport_fluxo	OBSERVAÇÃO	\N	t	f	text	[]	[]	f	[]	\N	character varying
report.vreport_fluxo	fluxo_id	\N	f	f	id	[]	[{"func": "count::distinct", "name": "TOTAL DE FLUXOS", "rename": "??COUNT::DISTINCT TOTAL DE FLUXOS"}]	\N	[]	\N	uuid
report.vreport_fluxo	__artigo_id	\N	f	f	id	[["query.source|tweeks.artigo", {"name": "ARTIGO"}]]	[]	\N	[]	\N	uuid[]
report.vreport_fluxo	__artigo_in	\N	f	f	id	[["query.source|tweeks.artigo", {"name": "ARTIGO ENTRADA"}]]	[]	\N	[]	\N	uuid
report.vreport_fluxo	__artigo_out	\N	f	f	id	[["query.source|tweeks.artigo", {"name": "ARTIGO SAÍDA"}]]	[]	\N	[]	\N	uuid
report.vreport_fluxo	__classe_id	\N	f	f	id	[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]	[]	f	[]	\N	uuid[]
report.vreport_fluxo	__classe_in	\N	f	f	id	[["query.source|tweeks.classe", {"name": "CATEGORIA DA ENTRADA"}]]	[]	f	[]	\N	uuid
report.vreport_fluxo	__classe_out	\N	f	f	id	[["query.source|tweeks.classe", {"name": "CATEGORIA DA SAÍDA"}]]	[]	f	[]	\N	uuid
report.vreport_fluxo	__espaco_id	\N	f	f	id	[["query.source|tweeks.espaco", {"name": "ARMAZÉM"}]]	[]	\N	[]	\N	uuid[]
report.vreport_fluxo	__espaco_in	\N	f	f	id	[["query.source|tweeks.espaco", {"name": "ARMAZÉM ENTRADA"}]]	[]	\N	[]	\N	uuid
report.vreport_fluxo	__espaco_out	\N	f	f	id	[["query.source|tweeks.espaco", {"name": "ARMAZÉM SAÍDA"}]]	[]	\N	[]	\N	uuid
report.vreport_fluxo	colaborador_id	\N	f	f	id	[["query.source|auth.colaborador", {"name": "COLABORADOR"}]]	[]	\N	[]	\N	uuid
report.vreport_fluxo	toperacao_id	\N	f	f	id	["query.source|tweeks.toperacao"]	[]	\N	[]	\N	smallint
report.vreport_fluxo	_branch_uid	\N	f	f	\N	[]	[]	\N	[]	\N	uuid
report.vreport_fluxo	fluxo_referencia	\N	f	f	id	[]	[]	\N	[]	\N	jsonb
report.vreport_guiaentrada	DATA	\N	t	t	date	[{"opr": ">=", "name": "ENTRADA DE", "format": "date"}, {"opr": "<=", "name": "ENTRADA ATÉ", "format": "date"}]	[]	f	[]	\N	timestamp with time zone
report.vreport_guiaentrada	DOCUMENTO	\N	t	t	code	[["query.like", {"mode": "right", "name": "DOCUMENTO"}]]	[]	f	[]	\N	character varying
report.vreport_guiaentrada	$ TOTAL	\N	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_guiaentrada	$ UNIT	\N	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_guiaentrada	ARMAZEM	\N	t	t	name:mid	[]	[]	f	[]	\N	character varying
report.vreport_guiaentrada	FORNECEDOR	\N	t	t	name:mid	[]	[]	f	[]	\N	character varying
report.vreport_guiaentrada	ARTIGO	\N	t	t	name:short	[]	[]	f	[]	\N	character varying
report.vreport_guiaentrada	VALIDADE	\N	t	f	date	[{"opr": ">=", "name": "VALIDO DE", "format": "date"}, {"opr": "<=", "name": "VALIDO ATÉ", "format": "date"}]	[]	f	[]	\N	date
report.vreport_guiaentrada	NUMERO	\N	t	f	code	[["query.like", {"mode": "right", "name": "NUMERO"}]]	[]	f	[]	\N	character varying
report.vreport_guiaentrada	CATEGORIA	\N	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_guiaentrada	CÓD. ARM.	\N	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_guiaentrada	CÓD. ART.	\N	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_guiaentrada	CÓD. CAT.	\N	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_guiaentrada	DESCRICAO	\N	t	f	name	[]	[]	f	[]	\N	character varying
report.vreport_guiaentrada	F. NIF	\N	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_guiaentrada	LOTE	\N	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_guiaentrada	OBS	\N	t	f	name	[]	[]	f	[]	\N	character varying
report.vreport_guiaentrada	QT	\N	t	f	int	[]	[]	f	[]	\N	double precision
report.vreport_guiaentrada	QT ANTES	\N	t	f	int	[]	[]	f	[]	\N	double precision
report.vreport_guiaentrada	artigo_id	\N	f	f	id	[["query.source|tweeks.artigo", {"name": "ARTIGO"}]]	[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]	f	[]	\N	uuid
report.vreport_guiaentrada	classe_id	\N	f	f	id	[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]	[{"func": "count::distinct", "name": "TOTAL DE CLASSE", "rename": "??COUNT::DISTINCT TOTAL DE CLASSE"}]	f	[]	\N	uuid
report.vreport_guiaentrada	entrada_id	\N	f	f	id	[]	[{"func": "count::distinct", "name": "TOTAL DE ENTRADAS", "rename": "??COUNT::DISTINCT TOTAL DE ENTRADAS"}]	f	[]	\N	uuid
report.vreport_guiaentrada	espaco_id	\N	f	f	id	[["query.source|tweeks.espaco", {"name": "ARMAZEM"}]]	[]	f	[]	\N	uuid
report.vreport_guiaentrada	fornecedor_id	\N	f	f	id	[["query.source|tweeks.fornecedor", {"name": "FORNECEDOR"}]]	[]	f	[]	\N	uuid
report.vreport_guiaentrada	_branch_uid	\N	f	f	id	[]	[]	f	[]	\N	uuid
report.vreport_guiaentrada	CÓD. FOR.	\N	f	f	\N	[]	[]	f	[]	\N	character varying
report.vreport_guiaentrada	guia_uid	\N	f	f	id	[]	[]	f	[]	\N	uuid
report.vreport_guiasaida	SERIE	2000	t	t	name:short	[]	[]	f	[]	\N	character varying
report.vreport_guiasaida	ARTIGO	1995	t	t	name	[]	[]	\N	[]	\N	character varying
report.vreport_guiasaida	CÓD ARTIGO	1994	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_guiasaida	CÓD. CAT.	1895	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_guiasaida	CATEGORIA	1894	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_guiasaida	ARMAZÉM	980	t	f	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_guiasaida	POSTO	970	t	f	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_guiasaida	CLIENTE	960	t	f	name	[]	[]	\N	[]	\N	character varying
report.vreport_guiasaida	$ PREÇO	115	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_guiasaida	QT	114	t	t	int	[]	[]	\N	[]	\N	double precision
report.vreport_guiasaida	$ MONT.	113	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_guiasaida	$ EXTRAS	112	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_guiasaida	$ MONT+EXT	111	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_guiasaida	IMPOSTOS	110	t	f	code	[]	[]	f	[]	\N	text
report.vreport_guiasaida	TAXAS	109	t	f	code	[]	[]	f	[]	\N	text
report.vreport_guiasaida	$ IMPOSTO	107	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_guiasaida	$ SUBTOTAL	106	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_guiasaida	$ TOTAL	105	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_guiasaida	DATA	\N	t	t	date	[{"opr": ">=", "name": "DATA INICO", "format": "date"}, {"opr": "<=", "name": "DATA FIM", "format": "date"}]	[]	\N	[]	\N	date
report.vreport_guiasaida	NIF	\N	t	f	code	[["query.like", {"mode": "right", "name": "NIF"}]]	[]	\N	[]	\N	character varying
report.vreport_guiasaida	$ MONTANTE FINAL	\N	t	f	money	[]	[]	f	[]	\N	double precision
report.vreport_guiasaida	COLABORADOR	\N	t	f	name:mid	[]	[]	f	[]	\N	text
report.vreport_guiasaida	artigo_id	\N	f	f	id	[{"opr": "=", "src": "db", "name": "Artigo", "format": "select", "source": "tweeks.artigo"}]	[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]	\N	[]	\N	uuid
report.vreport_guiasaida	venda_id	\N	f	f	id	[]	[{"func": "count::distinct", "name": "TOTAL DE VENDAS", "rename": "??COUNT::DISTINCT TOTAL DE VENDAS"}]	\N	[]	\N	uuid
report.vreport_guiasaida	_tgrupo_id	\N	f	f	id	[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]	[]	f	[]	\N	smallint
report.vreport_guiasaida	classe_id	\N	f	f	id	[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]	[]	f	[]	\N	uuid
report.vreport_guiasaida	colaborador_fecho	\N	f	f	id	["query.source|auth.colaborador"]	[]	f	[]	\N	uuid
report.vreport_guiasaida	conta_cliente_id	\N	f	f	id	[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]	[]	f	[]	\N	uuid
report.vreport_guiasaida	espaco_id	\N	f	f	id	[{"opr": "=", "src": "db", "name": "ARMAZÉM", "format": "select", "source": "tweeks.espaco"}]	[]	\N	[]	\N	uuid
report.vreport_guiasaida	posto_id	\N	f	f	id	[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]	[]	\N	[]	\N	uuid
report.vreport_guiasaida	venda_isencao	\N	f	f	id	[["query.boolean|Y/N", {"name": "ISENÇÃO"}]]	[]	f	[]	\N	boolean
report.vreport_guiasaida	_branch_uid	\N	f	f	id	[]	[]	\N	[]	\N	uuid
report.vreport_guiasaida	_tipoimposto_ids	\N	f	f	id	[]	[]	f	[]	\N	uuid[]
report.vreport_imposto	CERT. SERIE	584	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_imposto	TIPO SERIE	575	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_imposto	COLABORADOR	95	t	t	name:mid	[]	[]	f	[]	\N	character varying
report.vreport_imposto	DATA	85	t	t	timestamp	[]	[]	f	[]	\N	timestamp with time zone
report.vreport_imposto	artigo_id	\N	f	f	id	[["query.source|tweeks.artigo", {"name": "ARTIGO"}]]	[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]	f	[]	\N	uuid
report.vreport_imposto	venda_id	\N	f	f	id	[]	[{"func": "count::distinct", "name": "TOTAL DE VENDAS", "rename": "??COUNT::DISTINCT TOTAL DE VENDAS"}]	f	[]	\N	uuid
report.vreport_imposto	_date	\N	f	f	date	[["query.range|start", {"name": "DATA INICIO"}], ["query.range|end", {"name": "DATA FIM"}]]	[]	f	[]	\N	date
report.vreport_imposto	classe_id	\N	f	f	\N	[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]	[]	f	[]	\N	uuid
report.vreport_imposto	colaborador_id	\N	f	f	\N	[["query.source|auth.colaborador", {"name": "COLABORADOR"}]]	[]	f	[]	\N	uuid
report.vreport_imposto	tserie_id	\N	f	f	\N	[["query.source|tweeks.tserie", {"name": "TIPO DE SERIE"}]]	[]	f	[]	\N	smallint
report.vreport_imposto	venda_isencao	\N	f	f	\N	[["query.boolean|Y/N", {"name": "ISENÇÃO"}]]	[]	f	[]	\N	boolean
report.vreport_imposto	_branch_uid	\N	f	f	\N	[]	[]	f	[]	\N	uuid
report.vreport_notacredito	DOCUMENTO	2000	t	f	code:long	[{"opr": "like", "mode": "right", "name": "DOCUMENTO", "format": "simple"}]	[]	\N	[]	\N	character varying
report.vreport_notacredito	DOC. ORIGEM	1999	t	t	code:long	[{"opr": "like", "mode": "right", "name": "DOC. ORIGEM", "format": "simple"}]	[]	f	[]	\N	character varying
report.vreport_notacredito	ARTIGO	1995	t	t	name	[]	[]	\N	[]	\N	character varying
report.vreport_notacredito	CÓD ARTIGO	1994	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_notacredito	CÓD. CAT.	1895	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_notacredito	CLIENTE	960	t	f	name	[]	[]	\N	[]	\N	character varying
report.vreport_notacredito	CATEGORIA	1894	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_notacredito	ARMAZÉM	980	t	f	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_notacredito	POSTO	970	t	f	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_notacredito	$ PREÇO	115	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_notacredito	QT	114	t	t	int	[]	[]	\N	[]	\N	double precision
report.vreport_notacredito	$ MONT.	113	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_notacredito	$ EXTRAS	112	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_notacredito	$ MONT+EXT	111	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_notacredito	IMPOSTOS	110	t	f	code	[]	[]	f	[]	\N	text
report.vreport_notacredito	TAXAS	109	t	f	code	[]	[]	f	[]	\N	text
report.vreport_notacredito	ISEN.	108	f	f	code	[]	[]	f	[]	\N	text
report.vreport_notacredito	$ IMPOSTO	107	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_notacredito	$ SUBTOTAL	106	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_notacredito	$ TOTAL	105	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_notacredito	DATA	\N	t	t	date	[{"opr": ">=", "name": "DATA INICO", "format": "date"}, {"opr": "<=", "name": "DATA FIM", "format": "date"}]	[]	\N	[]	\N	date
report.vreport_notacredito	NIF	\N	t	f	code	[["query.like", {"mode": "right", "name": "NIF"}]]	[]	\N	[]	\N	character varying
report.vreport_notacredito	$ MONTANTE FINAL	\N	t	f	money	[]	[]	f	[]	\N	double precision
report.vreport_notacredito	CAIXA	\N	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_notacredito	COLABORADOR	\N	t	f	name:mid	[]	[]	f	[]	\N	text
report.vreport_notacredito	JUSTIFICATIVA	\N	t	f	text	[]	[]	f	[]	\N	character varying
report.vreport_notacredito	SERIE	\N	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_notacredito	artigo_id	\N	f	f	id	[{"opr": "=", "src": "db", "name": "Artigo", "format": "select", "source": "tweeks.artigo"}]	[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]	\N	[]	\N	uuid
report.vreport_notacredito	venda_id	\N	f	f	id	[]	[{"func": "count::distinct", "name": "TOTAL DE VENDAS", "rename": "??COUNT::DISTINCT TOTAL DE VENDAS"}]	\N	[]	\N	uuid
report.vreport_notacredito	_caixa_id	\N	f	f	id	[["query.source|tweeks.caixa", {"name": "CAIXA"}]]	[]	f	[]	\N	uuid
report.vreport_notacredito	_tgrupo_id	\N	f	f	id	[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]	[]	f	[]	\N	smallint
report.vreport_notacredito	classe_id	\N	f	f	id	[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]	[]	f	[]	\N	uuid
report.vreport_notacredito	colaborador_fecho	\N	f	f	id	["query.source|auth.colaborador"]	[]	f	[]	\N	uuid
report.vreport_notacredito	conta_cliente_id	\N	f	f	id	[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]	[]	f	[]	\N	uuid
report.vreport_notacredito	espaco_id	\N	f	f	id	[{"opr": "=", "src": "db", "name": "ARMAZÉM", "format": "select", "source": "tweeks.espaco"}]	[]	\N	[]	\N	uuid
report.vreport_notacredito	posto_id	\N	f	f	id	[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]	[]	\N	[]	\N	uuid
report.vreport_notacredito	tserie_id	\N	f	f	id	[["query.source|tweeks.tserie::venda", {"name": "SERIE"}]]	[]	f	[]	\N	smallint
report.vreport_notacredito	venda_isencao	\N	f	f	id	[["query.boolean|Y/N", {"name": "ISENÇÃO"}]]	[]	f	[]	\N	boolean
report.vreport_notacredito	_branch_uid	\N	f	f	id	[]	[]	\N	[]	\N	uuid
report.vreport_notacredito	_tipoimposto_ids	\N	f	f	id	[]	[]	f	[]	\N	uuid[]
report.vreport_notacredito	deposito_id	\N	f	f	id	[]	[]	f	[]	\N	uuid
report.vreport_venda	FATURA	2000	t	f	code:long	[{"opr": "like", "mode": "right", "name": "FATURA", "format": "simple"}]	[]	\N	[]	\N	character varying
report.vreport_venda	ARTIGO	1995	t	t	name	[]	[]	\N	[]	\N	character varying
report.vreport_venda	CÓD ARTIGO	1994	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_venda	CÓD. CAT.	1895	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_venda	CATEGORIA	1894	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_venda	ARMAZÉM	980	t	f	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_venda	POSTO	970	t	f	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_venda	CLIENTE	960	t	f	name	[]	[]	\N	[]	\N	character varying
report.vreport_venda	$ PREÇO	115	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_venda	QT	114	t	t	int	[]	[]	\N	[]	\N	double precision
report.vreport_venda	$ MONT.	113	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_venda	$ EXTRAS	112	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_venda	$ MONT+EXT	111	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_venda	IMPOSTOS	110	t	f	code	[]	[]	f	[]	\N	text
report.vreport_venda	TAXAS	109	t	f	code	[]	[]	f	[]	\N	text
report.vreport_venda	ISEN.	108	f	f	code	[]	[]	f	[]	\N	text
report.vreport_venda	$ IMPOSTO	107	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_venda	$ SUBTOTAL	106	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_venda	$ TOTAL	105	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_venda	DATA	\N	t	t	date	[{"opr": ">=", "name": "DATA INICO", "format": "date"}, {"opr": "<=", "name": "DATA FIM", "format": "date"}]	[]	\N	[]	\N	date
report.vreport_venda	NIF	\N	t	f	code	[["query.like", {"mode": "right", "name": "NIF"}]]	[]	\N	[]	\N	character varying
report.vreport_venda	$ MONTANTE FINAL	\N	t	f	money	[]	[]	f	[]	\N	double precision
report.vreport_venda	CAIXA	\N	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_venda	COLABORADOR	\N	t	f	name:mid	[]	[]	f	[]	\N	text
report.vreport_venda	SERIE	\N	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_venda	artigo_id	\N	f	f	id	[{"opr": "=", "src": "db", "name": "Artigo", "format": "select", "source": "tweeks.artigo"}]	[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]	\N	[]	\N	uuid
report.vreport_venda	venda_id	\N	f	f	id	[]	[{"func": "count::distinct", "name": "TOTAL DE VENDAS", "rename": "??COUNT::DISTINCT TOTAL DE VENDAS"}]	\N	[]	\N	uuid
report.vreport_venda	_caixa_id	\N	f	f	id	[["query.source|tweeks.caixa", {"name": "CAIXA"}]]	[]	f	[]	\N	uuid
report.vreport_venda	_tgrupo_id	\N	f	f	id	[["query.source|tweeks.tgroup", {"name": "TIPO DE CONTA"}]]	[]	f	[]	\N	smallint
report.vreport_venda	classe_id	\N	f	f	id	[["query.source|tweeks.classe", {"name": "CATEGORIA"}]]	[]	f	[]	\N	uuid
report.vreport_venda	colaborador_fecho	\N	f	f	id	["query.source|auth.colaborador"]	[]	f	[]	\N	uuid
report.vreport_venda	conta_cliente_id	\N	f	f	id	[["query.source|tweeks.cliente", {"name": "CLIENTE"}]]	[]	f	[]	\N	uuid
report.vreport_venda	espaco_id	\N	f	f	id	[{"opr": "=", "src": "db", "name": "ARMAZÉM", "format": "select", "source": "tweeks.espaco"}]	[]	\N	[]	\N	uuid
report.vreport_venda	posto_id	\N	f	f	id	[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]	[]	\N	[]	\N	uuid
report.vreport_venda	tserie_id	\N	f	f	id	[["query.source|tweeks.tserie::venda", {"name": "SERIE"}]]	[]	f	[]	\N	smallint
report.vreport_venda	venda_isencao	\N	f	f	id	[["query.boolean|Y/N", {"name": "ISENÇÃO"}]]	[]	f	[]	\N	boolean
report.vreport_venda	_branch_uid	\N	f	f	id	[]	[]	\N	[]	\N	uuid
report.vreport_venda	_tipoimposto_ids	\N	f	f	id	[]	[]	f	[]	\N	uuid[]
report.vreport_venda	deposito_id	\N	f	f	id	[]	[]	f	[]	\N	uuid
report.vreport_venda_artigo	ARTIGO	1995	t	t	name	[]	[]	\N	[]	\N	character varying
report.vreport_venda_artigo	CÓD ARTIGO	1994	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_venda_artigo	CÓD. CAT.	1895	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_venda_artigo	CATEGORIA	1894	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_venda_artigo	ARMAZÉM	980	t	f	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_venda_artigo	POSTO	970	t	f	name:short	[]	[]	\N	[]	\N	character varying
report.vreport_venda_artigo	QT	114	t	t	int	[]	[]	\N	[]	\N	double precision
report.vreport_venda_artigo	$ MONT.	113	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_venda_artigo	$ EXTRAS	112	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_venda_artigo	$ MONT+EXT	111	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_venda_artigo	IMPOSTOS	110	t	f	code	[]	[]	f	[]	\N	text
report.vreport_venda_artigo	TAXAS	109	t	f	code	[]	[]	f	[]	\N	text
report.vreport_venda_artigo	$ IMPOSTO	107	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_venda_artigo	$ SUBTOTAL	106	t	t	money	[]	[]	f	[]	\N	double precision
report.vreport_venda_artigo	$ TOTAL	105	t	t	money	[]	[]	\N	[]	\N	double precision
report.vreport_venda_artigo	CAIXA	\N	t	f	code	[]	[]	f	[]	\N	character varying
report.vreport_venda_artigo	COLABORADOR	\N	t	f	name:mid	[]	[]	f	[]	\N	text
report.vreport_venda_artigo	SERIE	\N	t	f	name:short	[]	[]	f	[]	\N	character varying
report.vreport_venda_artigo	artigo_id	\N	f	f	id	[{"opr": "=", "src": "db", "name": "Artigo", "format": "select", "source": "tweeks.artigo"}]	[{"func": "count::distinct", "name": "TOTAL DE ARTIGOS", "rename": "??COUNT::DISTINCT TOTAL DE ARTIGOS"}]	\N	[]	\N	uuid
report.vreport_venda_artigo	_caixa_id	\N	f	f	id	[["query.source|tweeks.caixa", {"name": "CAIXA"}]]	[]	f	[]	\N	uuid
report.vreport_venda_artigo	espaco_id	\N	f	f	id	[{"opr": "=", "src": "db", "name": "ARMAZÉM", "format": "select", "source": "tweeks.espaco"}]	[]	\N	[]	\N	uuid
report.vreport_venda_artigo	posto_id	\N	f	f	id	[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]	[]	\N	[]	\N	uuid
report.vreport_venda_artigo	tserie_id	\N	f	f	id	[["query.source|tweeks.tserie::venda", {"name": "SERIE"}]]	[]	f	[]	\N	smallint
report.vreport_venda_artigo	_branch_uid	\N	f	f	id	[]	[]	\N	[]	\N	uuid
report.vreport_venda_artigo	_tipoimposto_ids	\N	f	f	id	[]	[]	f	[]	\N	uuid[]
\.


--
-- TOC entry 5473 (class 0 OID 17511)
-- Dependencies: 325
-- Data for Name: version; Type: TABLE DATA; Schema: sys; Owner: -
--

COPY sys.version (number) FROM stdin;
\.


--
-- TOC entry 5522 (class 0 OID 20031)
-- Dependencies: 390
-- Data for Name: _temp_forece_table; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks._temp_forece_table (name, "time") FROM stdin;
\.


--
-- TOC entry 5474 (class 0 OID 17518)
-- Dependencies: 327
-- Data for Name: acerto; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.acerto (acerto_id, acerto_espaco_auth, acerto_colaborador_id, acerto_colaborador_atualizacao, acerto_quantidade, acerto_correcao, acerto_quantidadeinicial, acerto_observacao, acerto_estado, acerto_dataregistro, acerto_dataatualizacao, acerto_oprgroup, acerto_artigo_id, acerto_espaco_id, _branch_uid, acerto_codigo) FROM stdin;
\.


--
-- TOC entry 5475 (class 0 OID 17527)
-- Dependencies: 328
-- Data for Name: aloca; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.aloca (aloca_id, aloca_posto_id, aloca_espaco_destino, aloca_espaco_auth, aloca_colaborador_id, aloca_colaborador_atualizacao, aloca_montante, aloca_estado, aloca_dataregistro, aloca_dataatualizacao, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5395 (class 0 OID 16880)
-- Dependencies: 247
-- Data for Name: artigo; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.artigo (artigo_id, artigo_artigo_id, artigo_classe_id, artigo_espaco_auth, artigo_colaborador_id, artigo_colaborador_atualizacao, artigo_codigo, artigo_nome, artigo_preparacao, artigo_foto, artigo_descricao, artigo_stock, artigo_stocknegativo, artigo_compostoquantidade, artigo_estado, artigo_dataregistro, artigo_dataatualizacao, _branch_uid, artigo_codigoimposto, artigo_unit_id) FROM stdin;
\.


--
-- TOC entry 5509 (class 0 OID 19693)
-- Dependencies: 365
-- Data for Name: autorizacao; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.autorizacao (autorizacao_uid, autorizacao_colaborador_uid, autorizacao_colaborador_atualizacao, autorizacao_espaco_auth, autorizacao_espaco_uid, autorizacao_designacao, autorizacao_ano, autorizacao_numero, autorizacao_estado, autorizacao_dataregistro, autorizacao_dataatualizacao, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5476 (class 0 OID 17534)
-- Dependencies: 329
-- Data for Name: branchmap; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.branchmap (class, map_usr, map_spc, map_sch, map_tbl, map_brc) FROM stdin;
tweeks.classe	classe_colaborador_id	classe_espaco_auth	tweeks	classe	\N
tweeks.cliente	cliente_colaborador_id	cliente_espaco_auth	tweeks	cliente	\N
tweeks.acerto	acerto_colaborador_id	acerto_espaco_id	tweeks	acerto	\N
tweeks.movimento	movimento_colaborador_id	movimento_espaco_auth	tweeks	movimento	\N
tweeks.artigo	artigo_colaborador_id	artigo_espaco_auth	tweeks	artigo	\N
tweeks.deposito	deposito_colaborador_id	deposito_espaco_auth	tweeks	deposito	\N
tweeks.aloca	aloca_colaborador_id	aloca_espaco_destino	tweeks	aloca	\N
tweeks.entrada	entrada_colaborador_id	entrada_espaco_destino	tweeks	entrada	\N
tweeks.fornecedor	fornecedor_colaborador_id	fornecedor_espaco_auth	tweeks	fornecedor	\N
tweeks.imposto	imposto_colaborador_id	imposto_espaco_auth	tweeks	imposto	\N
tweeks.lancamento	lancamento_colaborador_id	lancamento_espaco_auth	tweeks	lancamento	\N
tweeks.retalho	retalho_colaborador_id	retalho_espaco_auth	tweeks	retalho	\N
tweeks.taxa	taxa_colaborador_id	taxa_espaco_auth	tweeks	taxa	\N
auth.acesso	acesso_colaborador_propetario	\N	auth	acesso	\N
tweeks.transacao	transacao_colaborador_id	transacao_espaco_auth	tweeks	transacao	\N
tweeks.caixa	caixa_colaborador_id	caixa_espaco_auth	tweeks	caixa	\N
tweeks.conta	conta_colaborador_id	conta_espaco_auth	tweeks	conta	\N
tweeks.link	link_colaborador_id	link_espaco_destino	tweeks	link	\N
tweeks.posto	posto_colaborador_id	posto_espaco_auth	tweeks	posto	\N
tweeks.venda	venda_colaborador_id	venda_espaco_auth	tweeks	venda	\N
tweeks.guia	guia_colaborador_id	guia_espaco_auth	tweeks	guia	\N
tweeks.custoguia	custoguia_colaborador_id	custoguia_espaco_auth	tweeks	custoguia	\N
tweeks.dispoe	dispoe_colaborador_id	dispoe_espaco_auth	tweeks	dispoe	\N
tweeks.fluxo	fluxo_colaborador_id	venda_espaco_auth	tweeks	fluxo	\N
tweeks.impostovenda	impostovenda_colaborador_id	impostovenda_espaco_auth	tweeks	impostovenda	\N
tweeks.tipoimposto	tipoimposto_colaborador_id	tipoimposto_espaco_auth	tweeks	tipoimposto	\N
tweeks.trabalha	trabalha_colaborador_proprietario	trabalha_espaco_destino	tweeks	trabalha	\N
tweeks.transferencia	transferencia_colaborador_id	transferencia_espaco_destino	tweeks	transferencia	\N
tweeks.serie	serie_colaborador_id	serie_espaco_id	tweeks	serie	\N
tweeks.cambio	cambio_colaborador_id	cambio_espaco_auth	tweeks	cambio	\N
tweeks.ean	ean_colaborador_id	ean_espaco_auth	tweeks	ean	\N
\.


--
-- TOC entry 5396 (class 0 OID 16895)
-- Dependencies: 248
-- Data for Name: caixa; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.caixa (caixa_id, caixa_posto_id, caixa_espaco_auth, caixa_colaborador_id, caixa_colaborador_atualizacao, caixa_montanteinicial, caixa_montanteinicialposto, caixa_montantefecho, caixa_montantefechoposto, caixa_quantidadecheque, caixa_quantidadechequeposto, caixa_observacao, caixa_estado, caixa_dataregistro, caixa_dataatualizacao, _branch_uid, caixa_code) FROM stdin;
\.


--
-- TOC entry 5477 (class 0 OID 17539)
-- Dependencies: 330
-- Data for Name: cambio; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.cambio (cambio_id, cambio_currency_id, cambio_espaco_auth, cambio_colaborador_id, cambio_colaborador_atualizacao, cambio_taxa, cambio_data, cambio_estado, cambio_dataregistro, cambio_dataatualizacao, _branch_uid) FROM stdin;
a67bfe6c-d23a-4a05-8fa7-3c9952c68da5	141	df1af547-42ee-4876-b133-d998f45b50d3	00000000-0000-0000-0000-000000000002	\N	1	2022-01-27	1	2022-01-27 09:48:32.750404+00	\N	\N
024c3c82-d2c2-4ab5-970f-3a16cc45bbf1	141	f318019d-0334-42d6-b77c-21526d4138f5	00000000-0000-0000-0000-000000000002	\N	1	2022-02-07	1	2022-02-07 11:15:57.970049+00	\N	\N
2c0cfd26-908c-4b08-8f74-19df9925d0ea	141	444ed00b-a257-47e8-bbc8-118c8ebeac54	00000000-0000-0000-0000-000000000002	\N	1	2022-01-26	1	2022-01-26 17:04:38.752405+00	\N	\N
4ae41f74-e49c-4628-b3dc-178ca42c066f	141	f6fb4865-0e56-479f-bf8f-b5f976a30204	00000000-0000-0000-0000-000000000002	\N	1	2022-02-11	1	2022-02-11 19:25:05.48638+00	\N	\N
f211762e-9220-4fa1-b9c4-025575fa2e1d	141	5b32b789-8fa7-4d03-ada9-59416040952c	00000000-0000-0000-0000-000000000002	\N	1	2022-04-11	1	2022-04-11 17:28:21.608714+00	\N	\N
\.


--
-- TOC entry 5478 (class 0 OID 17546)
-- Dependencies: 331
-- Data for Name: chave; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.chave (chave_temporarai, chave_definitiva, chave_descricao, chave_date) FROM stdin;
FHX-726-014	\N	\N	2021-09-03 15:21:32.789143+00
UGX-1NH-466	\N	\N	2021-09-03 15:27:34.068477+00
XBB-OMZ-724	\N	\N	2021-10-07 13:07:09.590024+00
JYM-7IK-793	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-09-03 15:24:25.120612+00
DUO-C20-451	Z06LFxGZ3gphIRHjYJx9ZtvdnS2F$y%HnDHSB1kjrsMeS1R45xmOUwTB8oKs8Bq0dtcEUN3nAmaPL371sBfAhFj4Ki#Goaz3zlvLbkSIp3YP$4K0UP4tOgfuvWyHaAusFZm804mCAKNF6nYlw#2iA8HM3E9oaclFLa3Ao0M2mrP1UCKwjSQjp6xfD7k1N4ocgM4oksimaqBAkyHTEb7S4weixVaO0GIic5ZCjQeqgKZySXqWxIC8ytL3Ci7a4Hwv	\N	2021-09-03 15:29:21.929283+00
XHO-CC4-347	\N	\N	2021-09-07 16:18:23.273253+00
UDR-3YY-335	\N	\N	2021-09-07 16:20:50.057477+00
GMO-IB5-674	\N	\N	2021-09-07 16:21:50.390161+00
CUN-8LG-436	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-09-07 16:40:44.610935+00
UKF-Q4R-282	\N	\N	2021-09-07 17:54:18.314484+00
VUK-R4C-867	r0CcmMZXcLRd5zvXwHfcl0hj#NOoswuxx4v7xRrtlBoWgqYH7UHOgweGWvguBV7eP$Z2MwaXCNhnzMgMwfKfXvKf286#U2JCfi4bMxEtEv$%sgFf9OM1tW26Ah3tB5b5xfcM4q3YQ2StOSlAUOPI96WW4feI06dYC4f5iDzeiYyOtIrAcAdImj%QqO9zb3830c89bSYwD#Hi2ktdChBo4yHE72BbTeZS6CYHBGFUGhhKOsMPqSlbnqied6IzFO20	\N	2021-09-07 16:21:43.715753+00
HTP-Q3I-832	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-09-07 17:46:36.437059+00
BCI-60E-890	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-09-08 15:50:02.028591+00
KJO-F16-654	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-09-15 11:14:29.380704+00
VAY-S8F-374	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-09-21 19:18:13.667609+00
FUX-4F6-751	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-09-21 19:41:59.13482+00
YJO-542-492	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-09-21 19:54:49.242196+00
DOV-03Z-643	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-09-21 19:56:41.730794+00
EEC-3EU-176	\N	\N	2021-09-23 11:12:34.127186+00
LCY-Z6G-683	\N	\N	2021-09-23 11:13:50.439431+00
IRD-3H6-684	\N	\N	2021-10-01 15:14:25.763529+00
FXM-1P6-335	\N	\N	2021-10-01 15:14:38.069405+00
PGK-A19-755	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-01 15:11:45.0657+00
NEN-9EY-267	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 12:21:06.058222+00
DHO-A8Y-836	\N	\N	2021-10-13 12:25:58.757414+00
DDM-FQB-976	\N	\N	2021-10-13 12:27:18.88905+00
KMP-I4Y-775	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 12:27:34.232053+00
MCU-867-151	\N	\N	2021-10-13 12:27:46.663812+00
AXJ-X8B-792	\N	\N	2021-10-13 12:29:25.732934+00
DUS-450-437	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 12:29:32.382572+00
MZY-B23-177	\N	\N	2021-10-13 12:40:19.978368+00
HIA-E9A-859	\N	\N	2021-10-07 13:24:35.091094+00
DEE-GDP-561	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-07 13:24:40.282243+00
ZQA-L54-101	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-07 21:16:40.211526+00
SRE-4ZR-776	\N	\N	2021-10-08 17:41:55.810852+00
KYN-7R5-931	\N	\N	2021-10-12 13:48:11.105279+00
EEJ-CJB-802	\N	\N	2021-10-12 15:19:00.478754+00
ACU-E2P-791	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-12 13:33:11.601407+00
LPX-P24-534	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 01:41:10.94792+00
VBB-CJZ-116	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 01:51:38.249967+00
EIH-4EI-458	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 12:40:27.629718+00
VKE-N42-845	\N	\N	2021-10-13 12:45:58.713641+00
SVN-65C-620	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 11:59:23.513572+00
JGR-70J-141	\N	\N	2021-10-15 13:06:31.711239+00
LLK-MH4-427	\N	\N	2021-10-15 13:58:37.638341+00
SEM-VT7-945	\N	\N	2021-10-15 13:59:19.188132+00
YZH-6UG-141	\N	\N	2021-10-15 15:09:24.93015+00
MXK-84T-206	\N	\N	2021-10-21 21:52:35.181135+00
NVJ-3MR-012	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 12:46:03.218118+00
YNH-S3E-857	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:04:44.57677+00
NLU-K7Z-177	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:09:34.145468+00
KUQ-9KJ-841	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:11:44.296007+00
VPQ-B8W-611	\N	\N	2021-10-13 13:13:09.906807+00
BEV-M0F-546	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:13:23.997329+00
QMT-19Y-954	\N	\N	2021-10-13 13:13:33.570907+00
PMH-F7N-760	\N	\N	2021-10-13 13:13:39.656082+00
NXS-VEL-987	\N	\N	2021-10-13 13:13:58.166646+00
YRE-6I1-470	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:14:07.05747+00
UXP-4LK-486	\N	\N	2021-10-13 13:16:22.376137+00
ZNV-E55-197	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:16:25.623051+00
XRN-71D-825	\N	\N	2021-10-13 13:22:00.425793+00
RCC-I2Z-388	\N	\N	2021-10-13 13:22:06.690613+00
LYD-L6B-524	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:22:20.353124+00
WWB-3KO-528	\N	\N	2021-10-13 13:22:34.66551+00
QKG-STH-410	\N	\N	2021-10-13 13:23:28.681843+00
OUT-PFS-869	\N	\N	2021-10-13 13:23:30.607089+00
CCA-V2I-526	\N	\N	2021-10-13 13:23:43.167271+00
FYX-DTP-897	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:23:50.67944+00
PMT-KDS-764	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:30:55.203379+00
DWG-Y6O-364	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:35:05.043896+00
GEN-APF-763	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:39:00.434503+00
DHG-64A-559	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:40:01.511546+00
ENL-C68-837	\N	\N	2021-10-13 13:41:44.088277+00
EVM-PA9-498	\N	\N	2021-10-13 13:41:46.405707+00
CWU-426-715	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:41:58.299921+00
PLF-W8F-254	\N	\N	2021-10-13 13:42:08.186698+00
RNK-38R-203	\N	\N	2021-10-13 13:42:24.623946+00
AIS-SU9-835	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:42:26.295687+00
GHE-I5V-761	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-13 13:43:23.856701+00
QYJ-MPV-262	iGXBhgSzUEKy9k%pie6wnEXn7dSzBxcqWj9qiniZFQ8OpHNSnuBqzAxtXlkjCZ2L465dAkdab6QcqPX0P74MHK$pdbrdnmL5iWnImzcDxhLnlWX$fQlQL%eJxWfrI74E2z87UMCqu8jpuhvmDPw4t$PQjv1RRa7Y8vGRFWEfpULaS3M$ztpZ2oAkAQGL2D23RppEZ$kEKCSnhe9UkENwsnf#AtDX4mIPifP1z$t9nFSLHNZoIPn7xb51rTd0A9mr	\N	2021-10-14 20:18:23.692068+00
PQI-J7J-222	\N	\N	2021-10-15 15:23:11.168367+00
VDZ-5LN-192	\N	\N	2021-10-19 11:56:21.018821+00
MUQ-361-492	\N	\N	2021-10-19 11:45:33.099996+00
AGQ-U9R-265	\N	\N	2021-10-19 11:52:36.690845+00
KTZ-0L1-018	\N	\N	2021-10-19 11:52:56.909562+00
FBM-0QF-145	\N	\N	2021-10-19 11:46:37.334757+00
CDE-A2V-756	\N	\N	2021-10-19 12:04:17.661708+00
ETU-MDM-247	\N	\N	2021-10-18 22:11:50.744535+00
OLD-V3B-228	\N	\N	2021-10-19 11:52:19.985754+00
UHA-H0O-861	cf5WFdBAXANfy4rX9RJLkI0FNV1Bmsx#jnqShGkJQ7qFP4Myu2UpLvuT9Ci1CHnRbYTFJuTjSqHlE$fH5wilwwNdrVDlNeFx0tBKyW29UcoXN5ZwIDZGvUcm4r6RF0BFuybRsq1AeZ2#HepKC0u9wyFkTm0ixiT7srmhm6bA1%XGeVsXjkeT2P2aWeaDMq3EVeVACM$KLdycflMHqtrPPU1IKq9yDB1GrUXGklyY4HJdDxNpwmYGpE4TV8mMj7yb	\N	2021-10-18 17:11:31.635515+00
ZJI-GP4-838	\N	\N	2021-10-19 11:48:04.064488+00
TOI-2N2-658	\N	\N	2021-10-19 11:46:57.123753+00
WEN-CGP-711	\N	\N	2021-10-19 11:47:26.304201+00
EZR-VQ6-134	\N	\N	2021-10-19 11:45:18.994065+00
DIM-7G8-722	\N	\N	2021-10-19 15:20:37.694844+00
PNH-239-187	\N	\N	2021-10-19 15:21:48.212216+00
WKB-B2Y-179	\N	\N	2021-10-19 17:24:48.089528+00
HOH-64J-602	EfN1dw0eA9SOrbE7kMTOnYnqB66IdQRlQ3Hvd#hZ7X5iNeQSfh6cNooxSY$mX7f6AffbW0123XUKxejpiEF$OUL$GHJqsL70vyGLI3DGqMFRWcNwT2TMabCHJi$6Ls1yNrtbJVclF0COXMNEJLYSl$rGEgOAD2Gad%qGYBHSddJIehpwqEoW4tDIfKh8ypzyV77DNXu0xW6Afs#4FloSEtOQftneIv16FgpE$v6KFWKVkRkmCKVyoxuhLsO6Eu7g	\N	2021-10-21 09:31:20.730416+00
SKJ-W8Y-259	\N	\N	2021-10-21 10:56:12.98494+00
NUK-6N3-887	\N	\N	2021-10-21 10:56:24.655824+00
OWE-C55-704	EfN1dw0eA9SOrbE7kMTOnYnqB66IdQRlQ3Hvd#hZ7X5iNeQSfh6cNooxSY$mX7f6AffbW0123XUKxejpiEF$OUL$GHJqsL70vyGLI3DGqMFRWcNwT2TMabCHJi$6Ls1yNrtbJVclF0COXMNEJLYSl$rGEgOAD2Gad%qGYBHSddJIehpwqEoW4tDIfKh8ypzyV77DNXu0xW6Afs#4FloSEtOQftneIv16FgpE$v6KFWKVkRkmCKVyoxuhLsO6Eu7g	\N	2021-10-21 10:56:57.497173+00
AQM-XYL-862	\N	\N	2021-10-21 22:09:47.799397+00
QVL-PKP-199	\N	\N	2021-10-21 23:08:33.465653+00
VNR-W80-467	\N	\N	2021-10-22 09:14:31.883801+00
SMX-584-421	\N	\N	2021-10-25 11:58:42.709178+00
BAP-374-624	\N	\N	2021-10-25 12:09:30.30798+00
DJJ-RF7-238	SUNVxhI8xd2Chnqm51Vtw2L44TXgzu8tiFWcmucU5#S9FjHixMQ#qPQLX3yuWTA82b5ZdjLDjd3Ok8FrXl%KZ$nrkpVICxI60zwOQWvfED1kp8oUsV6gPTt3I9WWhHf39KhtcRyJHGxy8$$##eK64%y5hXfSvqfvRrkOOLBwxkJEUX1$juNkpmvkBAjTrLt4wYcn34pY7xESrGcX4a8phnLop%0x$48zQK02B2uRNMlQIHZAJZJLYkQYoZN8jBuj	\N	2021-10-21 23:04:33.665312+00
GRD-6DO-453	SUNVxhI8xd2Chnqm51Vtw2L44TXgzu8tiFWcmucU5#S9FjHixMQ#qPQLX3yuWTA82b5ZdjLDjd3Ok8FrXl%KZ$nrkpVICxI60zwOQWvfED1kp8oUsV6gPTt3I9WWhHf39KhtcRyJHGxy8$$##eK64%y5hXfSvqfvRrkOOLBwxkJEUX1$juNkpmvkBAjTrLt4wYcn34pY7xESrGcX4a8phnLop%0x$48zQK02B2uRNMlQIHZAJZJLYkQYoZN8jBuj	\N	2021-10-25 10:46:12.384406+00
VJB-W29-175	\N	\N	2021-10-25 13:37:41.204007+00
VJL-KC8-995	\N	\N	2021-10-25 20:25:52.93601+00
GRJ-EM9-656	\N	\N	2021-10-25 20:37:32.568125+00
VYV-FO6-396	\N	\N	2021-10-26 10:24:45.138524+00
MGP-8RS-357	\N	\N	2021-10-28 23:26:15.488464+00
WTU-FG3-509	\N	\N	2021-10-29 11:51:56.669253+00
SSL-Z7I-272	\N	\N	2021-11-02 09:52:25.934822+00
NEX-670-357	\N	\N	2021-11-02 09:52:26.137841+00
RGR-L03-118	ZWSOt%GoSxsyZPA57b2AqijTMTNY159HqaPAhfJlU$zjuG7BtVwdgPjpfl726Y%rSF$Nofqo80jT03FpXy6ezTXMZJStFDM5lbLX9gqiQ59kqGf8JtPKO4iRrNcMBzx#OHJTiDAHljKg3$5UvRrPBRvpZBwWnmwVb%pOSbOuwa2trsrwErzWiikh4f7NC$yg1$y$jYyFTHCi0Sj6HjI9f%RYik5f$Z$DVyeNwt62tp7#1kYhLJzy3K%cWrVyGT5Q	\N	2021-11-01 13:34:31.54646+00
ISF-QGT-445	\N	\N	2021-11-03 12:54:40.520566+00
FVB-77O-712	\N	\N	2021-11-06 12:14:05.138054+00
VHF-ZYW-728	\N	\N	2021-11-08 16:24:49.0066+00
JKA-Y9C-641	\N	\N	2021-11-25 19:32:46.652657+00
LIY-F3D-224	\N	\N	2021-11-30 15:53:49.812408+00
MYQ-2G6-570	\N	\N	2021-11-30 15:53:56.301317+00
GXQ-02F-672	\N	\N	2021-11-30 15:58:27.915092+00
ZGD-07I-326	\N	\N	2021-11-30 16:24:23.87942+00
UVG-0AC-812	n#DcCOIPmnYQ6ZpRC8B9N3RkWZEdmV8lhey3NvVKythviQ1v0AoHK3o8Yj7g6##qYBsKdv%2n5ycNv8Fx6uZ$5PD$$8e%ZzCkNH4MpLI1OlC3v7c32ger1s%l%feWmuEcF1Eg99blBY1gZd0hCm4wunds1IsRBChU$zeXXyoe4eSzCAZyIXCsIOcccg$mB3xP$j196CuZfg$GZZTp2Ehe4Jlu$PNIpgPZdpG7nXwPRBYceWZc1b5MdZqpcZ##Dmz	\N	2021-12-07 12:00:40.40824+00
USP-924-641	\N	\N	2021-12-03 13:43:31.451426+00
IUY-9M5-838	\N	\N	2021-12-06 10:04:05.497745+00
TOT-0KB-264	\N	\N	2021-12-07 14:04:23.797459+00
QQW-4H0-428	n#DcCOIPmnYQ6ZpRC8B9N3RkWZEdmV8lhey3NvVKythviQ1v0AoHK3o8Yj7g6##qYBsKdv%2n5ycNv8Fx6uZ$5PD$$8e%ZzCkNH4MpLI1OlC3v7c32ger1s%l%feWmuEcF1Eg99blBY1gZd0hCm4wunds1IsRBChU$zeXXyoe4eSzCAZyIXCsIOcccg$mB3xP$j196CuZfg$GZZTp2Ehe4Jlu$PNIpgPZdpG7nXwPRBYceWZc1b5MdZqpcZ##Dmz	\N	2021-12-08 07:57:37.736865+00
XUU-CC3-772	\N	\N	2021-12-09 13:36:07.973266+00
KLB-Q3U-736	\N	\N	2021-12-09 14:07:31.024867+00
RFR-83S-182	\N	\N	2021-12-12 13:04:27.342544+00
MHH-3VO-461	\N	\N	2021-12-12 13:05:20.258661+00
NHT-746-576	\N	\N	2021-12-12 13:10:03.592728+00
QPH-J7B-735	\N	\N	2021-12-20 14:51:47.722947+00
VCD-04B-583	\N	\N	2021-11-01 13:30:15.675442+00
HIG-2I0-426	\N	\N	2021-11-01 13:33:42.079413+00
OAW-09F-853	\N	\N	2021-11-07 12:15:58.042444+00
YWK-2XC-468	\N	\N	2021-11-07 12:16:36.693088+00
YVJ-7G5-371	\N	\N	2021-12-04 22:30:31.415912+00
VBG-285-653	\N	\N	2021-12-04 23:05:55.508316+00
YFY-49T-033	\N	\N	2021-12-04 23:14:57.182401+00
WMP-1AN-114	\N	\N	2021-12-04 23:15:33.710303+00
GAO-QVO-234	\N	\N	2021-12-04 23:36:54.58895+00
CWZ-P6B-189	\N	\N	2021-12-04 23:37:17.386584+00
VTT-0S9-325	\N	\N	2021-12-05 09:34:14.691653+00
RIN-X67-788	\N	\N	2021-12-05 13:51:01.164744+00
AHP-O2E-682	\N	\N	2021-12-06 06:32:43.967375+00
EIB-MHA-286	\N	\N	2021-12-06 12:18:12.947484+00
NBI-Q8A-521	\N	\N	2021-12-06 12:48:26.094322+00
OHV-B3M-754	\N	\N	2021-12-06 12:48:45.186606+00
JBK-UKZ-578	\N	\N	2021-12-06 17:40:28.79486+00
RDV-O57-946	\N	\N	2021-12-07 11:56:57.148556+00
RVW-NL0-986	\N	\N	2021-12-07 12:55:07.882819+00
JQU-6ZD-233	n#DcCOIPmnYQ6ZpRC8B9N3RkWZEdmV8lhey3NvVKythviQ1v0AoHK3o8Yj7g6##qYBsKdv%2n5ycNv8Fx6uZ$5PD$$8e%ZzCkNH4MpLI1OlC3v7c32ger1s%l%feWmuEcF1Eg99blBY1gZd0hCm4wunds1IsRBChU$zeXXyoe4eSzCAZyIXCsIOcccg$mB3xP$j196CuZfg$GZZTp2Ehe4Jlu$PNIpgPZdpG7nXwPRBYceWZc1b5MdZqpcZ##Dmz	\N	2021-11-01 13:34:50.66335+00
VAE-4PY-655	\N	\N	2022-01-03 17:43:08.035991+00
SCJ-PAG-177	k8CCgTDyz0KY40U9MiCoyE1F227mhgpNVMvtSQ#L4w$Y$gd9932N6Ds7PCPuV4cBfPCmfBRK39trkf2iC55KvTRdXps58zDUH1r2XTmbUIlz#MVOAVkjAf2KPBu2F5Drb6NT1EcxAnxOq2M8aUk6kp8QYrBmc#$HbJmulkZ$fX#3trrg7jsMnA3RArXXJw43R#hK07euSfOtnLev#uhqLq9VFlCxPC$e39gB03xP7IqH5N0W0DX8RXS5X57oFQvc	\N	2022-01-03 13:28:55.834914+00
FYB-1B2-542	\N	\N	2022-01-06 18:36:23.529693+00
TDZ-P5U-341	\N	\N	2022-01-08 18:51:44.180851+00
UKC-7PF-468	\N	\N	2022-01-08 21:27:33.575515+00
GQY-NII-170	\N	\N	2022-01-09 11:00:52.69514+00
FHV-L48-731	\N	\N	2022-01-08 17:14:19.54926+00
GBI-NMY-155	\N	\N	2022-01-08 17:46:46.739066+00
KCN-6TP-661	\N	\N	2022-01-08 17:38:01.193378+00
GGD-61D-181	\N	\N	2022-01-09 15:14:53.561163+00
LJM-H9M-323	\N	\N	2022-01-03 17:05:58.994026+00
HDV-SAT-258	\N	\N	2022-01-08 17:44:22.53157+00
JQV-44I-169	\N	\N	2022-01-03 14:26:45.045497+00
TSL-S83-106	\N	\N	2022-01-02 21:17:35.674094+00
WBT-TOE-546	\N	\N	2022-01-03 09:29:25.044024+00
YVJ-J42-559	\N	\N	2022-01-03 09:35:44.001509+00
UYY-S5D-421	\N	\N	2022-01-03 14:27:15.551332+00
DRX-G35-886	\N	\N	2022-01-06 20:44:50.415714+00
DEA-PR1-067	\N	\N	2022-01-08 17:45:23.757824+00
YLU-Y7N-255	\N	\N	2022-01-06 18:37:00.991504+00
PES-S4B-397	\N	\N	2022-01-07 14:42:47.506885+00
ONF-K7U-543	\N	\N	2022-01-06 18:27:24.343464+00
MLP-GY2-632	\N	\N	2022-01-06 18:36:37.142773+00
VSM-0KU-106	\N	\N	2022-01-07 14:52:52.99347+00
BGC-27U-441	\N	\N	2022-01-04 17:21:20.575807+00
XED-T7O-585	\N	\N	2022-01-09 14:45:08.288779+00
KMK-PHN-313	rSSI74Vbc1W5XKc2wIbP6FhrVGztecAr0Mm92ILAUshTi4yqDPVpnTouSR1p2zWt63lDvYm70r82B2bEyAhj#kZUaG2j4rIT6L9HCnKRTPN#xqJXD7DR7jQ6SvUQ$t5Fuj0fGQ3PgZPkQBV6I25BgoMmkNmI860CNPWlVR96pT7PPi$WRxgBjdjoX29g#Hjk#1GNLWjK97RUytXVtgq#ZtrXPl6GiYlaPwzxKD0z2uoC7y#KtL5bqJcvRcCOpLbv	\N	2022-01-07 15:54:23.644537+00
JGO-JTY-681	\N	\N	2022-01-09 15:48:46.52472+00
JHX-UTI-550	\N	\N	2022-01-09 15:48:19.037007+00
LUO-LAA-418	\N	\N	2022-01-09 15:36:15.620549+00
NCB-73S-644	\N	\N	2022-01-09 15:48:42.458401+00
BQN-9WW-687	\N	\N	2022-01-09 15:48:41.444233+00
GFC-E2J-568	\N	\N	2022-01-08 21:18:40.213437+00
RUQ-Y54-326	\N	\N	2022-01-09 16:00:32.286494+00
YEB-1EO-961	\N	\N	2022-01-09 16:07:06.585589+00
AJX-7P4-428	\N	\N	2022-01-09 16:10:57.268408+00
HPU-M4P-704	\N	\N	2022-01-09 16:11:30.459513+00
FHN-PV2-451	\N	\N	2022-01-09 16:11:32.149641+00
FRU-34X-313	\N	\N	2022-01-09 16:36:47.848654+00
IOY-17K-271	\N	\N	2022-01-09 16:45:06.958386+00
YYG-2QR-468	\N	\N	2022-01-09 16:46:23.122306+00
TQI-N7P-815	\N	\N	2022-01-09 18:23:49.773136+00
EOP-T3Z-230	\N	\N	2022-01-09 18:21:54.075677+00
FCC-VBS-738	\N	\N	2022-01-09 18:21:55.680735+00
QMM-U1I-518	\N	\N	2022-01-09 20:49:04.7491+00
DDR-2VB-788	\N	\N	2022-01-10 14:02:23.553811+00
CRU-06X-478	\N	\N	2022-01-10 21:01:33.561735+00
JPR-841-742	\N	\N	2022-01-10 18:18:11.136751+00
MAH-3X2-374	\N	\N	2022-01-10 18:17:29.30566+00
LSC-8Y0-212	XIhLLbTcyc3AKiZLrFqH#5Sglh$Qu7LEaYcfEFNSZkvnR0YK0Ko1hr0zAQ#1cR4UX1#irwpZqzhVyE#CCq65BtgWXcSBXlRXKDEVjtubF19MO$0y2SlcUr$vfP5VKg5psyeRH5CWBV3uZYkZsUM8siMiA2eyQV3IkBjFZAzwyCG#GBhXayrG$#e0yQnkLNgN0QsmNKdqb#FHOd2stDsKXkciCeDqMRZqrzFL5c508cDeZSyPU7hUjM3#MrCom8n%	\N	2022-01-11 15:45:36.280259+00
VJJ-3RK-894	\N	\N	2022-01-11 18:44:04.992233+00
CRI-76S-451	\N	\N	2022-01-11 18:43:45.547533+00
PBF-YR2-995	\N	\N	2022-01-11 18:57:41.203056+00
ETS-6M0-487	\N	\N	2022-01-11 18:58:27.885115+00
CQI-238-527	\N	\N	2022-01-11 18:58:27.716991+00
WOV-DS8-463	\N	\N	2022-01-12 16:45:59.840839+00
TFM-MGW-853	\N	\N	2022-01-12 16:55:04.086228+00
YTP-VP8-570	\N	\N	2022-01-23 17:24:55.006255+00
ODE-W5F-241	\N	\N	2022-01-19 18:48:58.971661+00
JNX-SMG-992	\N	\N	2022-01-22 10:20:19.76384+00
NFV-BYF-027	\N	\N	2022-01-18 18:48:05.551089+00
MDD-C6N-788	\N	\N	2022-01-18 17:16:13.810414+00
TWZ-70F-124	\N	\N	2022-01-19 16:27:02.130829+00
FMV-2RT-545	\N	\N	2022-01-13 20:34:10.544523+00
RHM-JDG-105	\N	\N	2022-01-10 22:30:01.860229+00
SDP-4IN-152	\N	\N	2022-01-10 18:17:36.270017+00
SUL-XG0-766	\N	\N	2022-01-14 15:35:53.263987+00
WHM-HE7-736	\N	\N	2022-01-16 16:39:32.751558+00
VJE-63J-613	\N	\N	2022-01-12 20:10:03.513378+00
IUX-523-511	\N	\N	2022-01-23 17:08:34.289613+00
YYU-V63-333	\N	\N	2022-01-23 17:38:21.106019+00
VHK-TGM-726	\N	\N	2022-02-21 15:16:42.574321+00
DFF-B3Q-334	\N	\N	2022-02-21 16:09:28.502453+00
YDS-IPK-332	\N	\N	2022-02-19 08:00:30.875353+00
VEW-582-323	\N	\N	2022-02-19 12:30:02.939238+00
CGX-RMS-177	T##emoXULy9dJPCVYsARxkIBUFKesMw3CJFJYXwnfgdjGguppOKSVqrFcMq%B#79R9V3jKH5kjZqQK6YPL7A2gtfmZTlxSoog6i7DSBr%lTaNfd5O6JAv%WAwGJ0$CJ381WLhGSJ4bqj6jE8kAqyjve4W#1FR7wgpFb6301tANlb#TpqJj3yvdyEl7lLbQpd8SJJph9LRtqepKDsr0#nW5Se8DS5VECvQq4DsSly$87#wakmmiHTaVPW#8prrUkx	\N	2022-02-21 08:53:47.190177+00
JYN-NM1-787	\N	\N	2022-02-21 14:16:35.161045+00
ONC-SIR-730	\N	\N	2022-02-20 15:18:27.136195+00
GBY-CNN-677	\N	\N	2022-02-18 18:36:50.352381+00
QMT-EU3-401	\N	\N	2022-02-21 14:52:40.486553+00
CDI-7CH-228	\N	\N	2022-02-21 16:16:11.474097+00
CMC-6I4-065	\N	\N	2022-02-21 16:17:56.425016+00
MDR-6EC-365	\N	\N	2022-02-21 16:35:04.07596+00
MIZ-H78-743	hQbbUDZVmtJjgnMWuTTxGrAIUPoqo53bWm6BqOwWUBaIK1RVCEHkCCSRwRnBsekow3L#8Di52hJpW0bAQD%umlmqqBQduSSsDn1Y4IpCue9TNZtv21fI1CbGPnYky3dmvWfEIUG3FQoITwLTqqLr$n#tGj9zT3ho9vNoMQV3Y7tJF08Nt0zS4tE91ZSHdg42XMWMjZswyJzg62UwVPgzMzhv$4mSkuN9nn4T6k64htnwuVIX2rQmi4KLnDzQ3i0o	\N	2022-02-21 16:44:45.913417+00
PPF-445-731	hQbbUDZVmtJjgnMWuTTxGrAIUPoqo53bWm6BqOwWUBaIK1RVCEHkCCSRwRnBsekow3L#8Di52hJpW0bAQD%umlmqqBQduSSsDn1Y4IpCue9TNZtv21fI1CbGPnYky3dmvWfEIUG3FQoITwLTqqLr$n#tGj9zT3ho9vNoMQV3Y7tJF08Nt0zS4tE91ZSHdg42XMWMjZswyJzg62UwVPgzMzhv$4mSkuN9nn4T6k64htnwuVIX2rQmi4KLnDzQ3i0o	\N	2022-02-21 17:11:16.968275+00
UWU-982-434	\N	\N	2022-02-21 17:22:43.431785+00
BNF-PBE-955	\N	\N	2022-02-21 17:21:47.293416+00
YCI-1TX-484	hQbbUDZVmtJjgnMWuTTxGrAIUPoqo53bWm6BqOwWUBaIK1RVCEHkCCSRwRnBsekow3L#8Di52hJpW0bAQD%umlmqqBQduSSsDn1Y4IpCue9TNZtv21fI1CbGPnYky3dmvWfEIUG3FQoITwLTqqLr$n#tGj9zT3ho9vNoMQV3Y7tJF08Nt0zS4tE91ZSHdg42XMWMjZswyJzg62UwVPgzMzhv$4mSkuN9nn4T6k64htnwuVIX2rQmi4KLnDzQ3i0o	\N	2022-02-21 17:22:54.175683+00
NIS-26Y-952	hQbbUDZVmtJjgnMWuTTxGrAIUPoqo53bWm6BqOwWUBaIK1RVCEHkCCSRwRnBsekow3L#8Di52hJpW0bAQD%umlmqqBQduSSsDn1Y4IpCue9TNZtv21fI1CbGPnYky3dmvWfEIUG3FQoITwLTqqLr$n#tGj9zT3ho9vNoMQV3Y7tJF08Nt0zS4tE91ZSHdg42XMWMjZswyJzg62UwVPgzMzhv$4mSkuN9nn4T6k64htnwuVIX2rQmi4KLnDzQ3i0o	\N	2022-02-21 17:27:44.188941+00
NIJ-35M-831	\N	\N	2022-02-21 18:13:37.940361+00
FWL-7P6-824	\N	\N	2022-02-21 18:14:13.678746+00
SXW-641-502	\N	\N	2022-02-22 18:16:28.723373+00
HHS-99Y-384	\N	\N	2022-02-22 06:26:34.787931+00
EQR-FL5-010	\N	\N	2022-02-22 03:00:02.717053+00
SIX-3Q7-733	\N	\N	2022-02-22 16:23:14.528814+00
ZQW-452-997	\N	\N	2022-02-22 16:01:39.502856+00
PDH-HTB-622	\N	\N	2022-02-22 18:18:55.753798+00
HFS-BJS-447	\N	\N	2022-02-22 18:18:55.764604+00
QQG-5GJ-343	\N	\N	2022-02-22 18:18:55.774605+00
HJV-OL9-386	\N	\N	2022-02-22 18:22:13.118544+00
SQW-NSR-457	\N	\N	2022-02-22 18:23:48.1503+00
MGR-86W-234	\N	\N	2022-02-22 18:27:49.076721+00
TUJ-MT2-682	hQbbUDZVmtJjgnMWuTTxGrAIUPoqo53bWm6BqOwWUBaIK1RVCEHkCCSRwRnBsekow3L#8Di52hJpW0bAQD%umlmqqBQduSSsDn1Y4IpCue9TNZtv21fI1CbGPnYky3dmvWfEIUG3FQoITwLTqqLr$n#tGj9zT3ho9vNoMQV3Y7tJF08Nt0zS4tE91ZSHdg42XMWMjZswyJzg62UwVPgzMzhv$4mSkuN9nn4T6k64htnwuVIX2rQmi4KLnDzQ3i0o	\N	2022-02-22 18:35:54.09964+00
QHG-74A-642	\N	\N	2022-02-22 18:57:56.776689+00
EFT-FA0-737	hQbbUDZVmtJjgnMWuTTxGrAIUPoqo53bWm6BqOwWUBaIK1RVCEHkCCSRwRnBsekow3L#8Di52hJpW0bAQD%umlmqqBQduSSsDn1Y4IpCue9TNZtv21fI1CbGPnYky3dmvWfEIUG3FQoITwLTqqLr$n#tGj9zT3ho9vNoMQV3Y7tJF08Nt0zS4tE91ZSHdg42XMWMjZswyJzg62UwVPgzMzhv$4mSkuN9nn4T6k64htnwuVIX2rQmi4KLnDzQ3i0o	\N	2022-02-22 18:59:26.179716+00
WAW-D6G-433	hQbbUDZVmtJjgnMWuTTxGrAIUPoqo53bWm6BqOwWUBaIK1RVCEHkCCSRwRnBsekow3L#8Di52hJpW0bAQD%umlmqqBQduSSsDn1Y4IpCue9TNZtv21fI1CbGPnYky3dmvWfEIUG3FQoITwLTqqLr$n#tGj9zT3ho9vNoMQV3Y7tJF08Nt0zS4tE91ZSHdg42XMWMjZswyJzg62UwVPgzMzhv$4mSkuN9nn4T6k64htnwuVIX2rQmi4KLnDzQ3i0o	\N	2022-02-22 19:08:52.699098+00
PMM-UB2-444	\N	\N	2022-02-22 19:15:54.394683+00
BTA-T1S-879	hQbbUDZVmtJjgnMWuTTxGrAIUPoqo53bWm6BqOwWUBaIK1RVCEHkCCSRwRnBsekow3L#8Di52hJpW0bAQD%umlmqqBQduSSsDn1Y4IpCue9TNZtv21fI1CbGPnYky3dmvWfEIUG3FQoITwLTqqLr$n#tGj9zT3ho9vNoMQV3Y7tJF08Nt0zS4tE91ZSHdg42XMWMjZswyJzg62UwVPgzMzhv$4mSkuN9nn4T6k64htnwuVIX2rQmi4KLnDzQ3i0o	\N	2022-02-22 19:18:17.090452+00
RUV-YVV-926	hQbbUDZVmtJjgnMWuTTxGrAIUPoqo53bWm6BqOwWUBaIK1RVCEHkCCSRwRnBsekow3L#8Di52hJpW0bAQD%umlmqqBQduSSsDn1Y4IpCue9TNZtv21fI1CbGPnYky3dmvWfEIUG3FQoITwLTqqLr$n#tGj9zT3ho9vNoMQV3Y7tJF08Nt0zS4tE91ZSHdg42XMWMjZswyJzg62UwVPgzMzhv$4mSkuN9nn4T6k64htnwuVIX2rQmi4KLnDzQ3i0o	\N	2022-02-22 19:24:15.013386+00
XJZ-9K2-352	\N	\N	2022-02-22 19:25:23.482892+00
SGM-LUB-645	\N	\N	2022-02-22 23:06:32.057804+00
CMC-B7C-616	\N	\N	2022-02-23 14:11:46.310412+00
FXY-2TM-398	\N	\N	2022-02-23 00:27:36.964082+00
HUC-6QE-808	hQbbUDZVmtJjgnMWuTTxGrAIUPoqo53bWm6BqOwWUBaIK1RVCEHkCCSRwRnBsekow3L#8Di52hJpW0bAQD%umlmqqBQduSSsDn1Y4IpCue9TNZtv21fI1CbGPnYky3dmvWfEIUG3FQoITwLTqqLr$n#tGj9zT3ho9vNoMQV3Y7tJF08Nt0zS4tE91ZSHdg42XMWMjZswyJzg62UwVPgzMzhv$4mSkuN9nn4T6k64htnwuVIX2rQmi4KLnDzQ3i0o	\N	2022-02-23 14:12:37.999487+00
VQC-45G-986	\N	\N	2022-02-23 14:26:44.896367+00
ETQ-9T5-480	hQbbUDZVmtJjgnMWuTTxGrAIUPoqo53bWm6BqOwWUBaIK1RVCEHkCCSRwRnBsekow3L#8Di52hJpW0bAQD%umlmqqBQduSSsDn1Y4IpCue9TNZtv21fI1CbGPnYky3dmvWfEIUG3FQoITwLTqqLr$n#tGj9zT3ho9vNoMQV3Y7tJF08Nt0zS4tE91ZSHdg42XMWMjZswyJzg62UwVPgzMzhv$4mSkuN9nn4T6k64htnwuVIX2rQmi4KLnDzQ3i0o	\N	2022-02-23 14:27:21.527688+00
SUQ-7H6-318	\N	\N	2022-02-23 14:28:06.154449+00
TLB-FSA-573	hQbbUDZVmtJjgnMWuTTxGrAIUPoqo53bWm6BqOwWUBaIK1RVCEHkCCSRwRnBsekow3L#8Di52hJpW0bAQD%umlmqqBQduSSsDn1Y4IpCue9TNZtv21fI1CbGPnYky3dmvWfEIUG3FQoITwLTqqLr$n#tGj9zT3ho9vNoMQV3Y7tJF08Nt0zS4tE91ZSHdg42XMWMjZswyJzg62UwVPgzMzhv$4mSkuN9nn4T6k64htnwuVIX2rQmi4KLnDzQ3i0o	\N	2022-02-23 14:28:31.603437+00
HHV-1D5-719	\N	\N	2022-02-23 14:29:49.887209+00
XDR-2I2-705	\N	\N	2022-02-23 14:42:49.022976+00
NEF-71M-185	\N	\N	2022-02-23 14:49:34.616973+00
MKO-28G-177	\N	\N	2022-02-23 15:26:57.662467+00
CRP-R8J-144	\N	\N	2022-02-25 10:17:59.70983+00
GQI-AN3-339	\N	\N	2022-03-03 13:04:57.625967+00
DIW-F01-255	\N	\N	2022-03-03 13:38:45.654269+00
HWY-5M7-810	\N	\N	2022-03-03 15:11:23.059382+00
TXI-HF8-429	\N	\N	2022-03-08 09:54:05.577615+00
STP-JYP-382	\N	\N	2022-03-08 09:54:08.66466+00
GOL-HHG-362	\N	\N	2022-03-08 12:21:37.139797+00
LNV-R02-711	\N	\N	2022-03-09 15:18:57.974304+00
HMG-YJK-564	\N	\N	2022-03-09 15:10:40.534414+00
UPU-Z1Z-634	\N	\N	2022-03-09 16:21:45.367157+00
TAW-371-047	\N	\N	2022-03-09 16:43:17.012216+00
QMV-JLD-618	\N	\N	2022-03-10 23:35:21.761356+00
YBN-FOM-423	\N	\N	2022-03-11 11:47:35.673545+00
ZLH-2Z6-027	\N	\N	2022-03-14 17:14:19.243817+00
JSD-25K-668	\N	\N	2022-03-14 17:17:23.912897+00
QRF-QYP-362	\N	\N	2022-03-17 15:05:43.840926+00
VYV-U5S-537	\N	\N	2022-03-21 16:31:13.845015+00
QRP-083-617	\N	\N	2022-03-22 11:23:28.929656+00
HNN-0ZF-458	\N	\N	2022-03-22 17:09:34.191423+00
KEC-UTC-183	hQbbUDZVmtJjgnMWuTTxGrAIUPoqo53bWm6BqOwWUBaIK1RVCEHkCCSRwRnBsekow3L#8Di52hJpW0bAQD%umlmqqBQduSSsDn1Y4IpCue9TNZtv21fI1CbGPnYky3dmvWfEIUG3FQoITwLTqqLr$n#tGj9zT3ho9vNoMQV3Y7tJF08Nt0zS4tE91ZSHdg42XMWMjZswyJzg62UwVPgzMzhv$4mSkuN9nn4T6k64htnwuVIX2rQmi4KLnDzQ3i0o	\N	2022-03-30 15:18:39.034808+00
DRJ-3EK-753	hQbbUDZVmtJjgnMWuTTxGrAIUPoqo53bWm6BqOwWUBaIK1RVCEHkCCSRwRnBsekow3L#8Di52hJpW0bAQD%umlmqqBQduSSsDn1Y4IpCue9TNZtv21fI1CbGPnYky3dmvWfEIUG3FQoITwLTqqLr$n#tGj9zT3ho9vNoMQV3Y7tJF08Nt0zS4tE91ZSHdg42XMWMjZswyJzg62UwVPgzMzhv$4mSkuN9nn4T6k64htnwuVIX2rQmi4KLnDzQ3i0o	\N	2022-03-30 16:14:26.311177+00
VDL-MCT-699	\N	\N	2022-04-06 16:38:56.781459+00
XPS-94K-203	\N	\N	2022-04-06 16:38:57.053829+00
FMT-9PL-284	\N	\N	2022-04-13 17:54:02.097118+00
CVB-4TZ-355	\N	\N	2022-01-26 16:26:03.103519+00
OWY-59H-859	\N	\N	2022-02-02 12:39:30.475826+00
NYC-FT7-531	\N	\N	2022-02-04 16:18:08.752432+00
SRM-S58-896	\N	\N	2022-02-02 10:18:19.91335+00
CUV-9M2-303	\N	\N	2022-01-27 09:45:47.758972+00
YQL-829-712	\N	\N	2022-01-28 10:45:44.324096+00
GOC-HC5-040	\N	\N	2022-01-26 16:40:24.501913+00
ODQ-O8X-198	\N	\N	2022-02-06 16:46:45.264851+00
HUR-PX0-736	\N	\N	2022-01-26 16:47:46.367735+00
FBW-5O0-935	\N	\N	2022-01-28 10:45:18.481299+00
PEV-UY5-716	\N	\N	2022-01-31 16:07:33.251786+00
CYJ-9RW-595	\N	\N	2022-02-02 12:39:37.906526+00
IEW-84V-947	\N	\N	2022-02-01 17:43:56.71995+00
LYW-685-031	\N	\N	2022-02-07 10:59:57.754756+00
JWG-8PC-463	\N	\N	2022-02-01 11:26:10.671371+00
PNM-49G-472	\N	\N	2022-02-02 13:40:47.461398+00
STL-7F9-941	\N	\N	2022-02-11 08:50:14.8348+00
EAD-ZGA-417	\N	\N	2022-02-11 19:19:27.647837+00
OQU-TA5-351	\N	\N	2022-02-10 21:21:44.175945+00
OQP-P69-173	\N	\N	2022-02-08 09:26:54.316496+00
XPS-IOY-009	\N	\N	2022-02-11 12:29:36.007325+00
HIP-KP8-635	\N	\N	2022-02-10 19:24:29.172039+00
CQX-0SV-435	\N	\N	2022-02-09 08:21:41.497076+00
FIP-86C-663	\N	\N	2022-02-11 20:39:29.689806+00
UIB-NP5-537	\N	\N	2022-02-09 12:46:28.435915+00
PHW-HDK-377	\N	\N	2022-02-11 00:10:06.392826+00
RDU-70T-599	\N	\N	2022-02-11 00:54:10.965508+00
HON-6BC-261	\N	\N	2022-02-10 22:25:44.94765+00
CND-SRF-174	\N	\N	2022-02-10 19:47:26.221301+00
YSB-GX9-405	\N	\N	2022-02-10 20:51:53.088403+00
GLA-9B6-785	\N	\N	2022-02-11 10:03:17.70696+00
PMO-WAO-685	\N	\N	2022-02-10 19:54:55.835954+00
LNH-HW7-266	\N	\N	2022-02-11 09:49:51.203017+00
HWZ-XHV-864	\N	\N	2022-02-11 09:48:55.061547+00
JOR-K88-125	\N	\N	2022-02-11 08:19:28.446658+00
KHV-398-855	\N	\N	2022-02-11 10:59:11.8517+00
GQK-Z66-553	\N	\N	2022-02-11 10:04:09.722844+00
CVN-6OW-485	\N	\N	2022-02-11 19:21:17.998564+00
VOM-06Y-146	\N	\N	2022-02-08 05:30:15.129261+00
ZBD-IC8-096	\N	\N	2022-02-11 13:03:40.493727+00
REF-5E0-353	\N	\N	2022-02-11 08:05:30.330053+00
RJF-8XQ-791	\N	\N	2022-02-11 09:58:15.879566+00
SCG-9G2-816	\N	\N	2022-02-11 10:03:49.50054+00
MEC-X63-691	\N	\N	2022-02-11 01:07:06.426314+00
QEB-Q84-311	\N	\N	2022-02-11 15:06:18.095367+00
RHB-33A-237	\N	\N	2022-02-11 09:49:48.845137+00
YMF-BA2-573	\N	\N	2022-02-11 13:01:45.614123+00
DZH-XQM-774	\N	\N	2022-02-10 20:18:13.852956+00
SXY-UAB-333	\N	\N	2022-02-11 04:35:02.752987+00
SHW-39X-346	\N	\N	2022-02-11 05:02:05.594421+00
TJH-599-149	\N	\N	2022-02-11 19:00:10.370726+00
NEB-23P-545	\N	\N	2022-02-10 22:36:31.940555+00
VEZ-55J-420	\N	\N	2022-02-09 18:03:50.814617+00
NQL-ZS1-539	\N	\N	2022-02-07 16:47:53.359777+00
GUN-G8W-088	\N	\N	2022-02-11 15:53:03.341674+00
SQD-744-465	\N	\N	2022-02-11 17:09:21.510996+00
CZI-WP0-346	\N	\N	2022-02-11 13:02:54.409226+00
GKG-R8I-726	\N	\N	2022-02-11 09:58:18.963791+00
IPI-UN5-081	\N	\N	2022-02-10 22:39:34.426624+00
RNE-1WY-827	\N	\N	2022-02-11 21:25:05.217206+00
NEM-83Z-651	\N	\N	2022-02-08 09:27:27.57278+00
EGR-7C8-855	\N	\N	2022-02-11 04:14:12.908305+00
OYS-Q4R-524	\N	\N	2022-02-09 08:21:44.79001+00
HJG-VB5-293	\N	\N	2022-02-11 09:48:53.682548+00
WEW-S0L-370	\N	\N	2022-02-16 08:04:40.026248+00
OQS-NE6-172	\N	\N	2022-02-12 17:28:35.352832+00
JVL-0PS-683	\N	\N	2022-02-15 06:20:42.495602+00
SSU-J15-102	\N	\N	2022-02-12 04:50:19.259694+00
QVO-PK1-382	\N	\N	2022-02-12 08:22:46.664132+00
NHC-D4E-956	\N	\N	2022-02-15 19:00:56.133215+00
XSX-VHY-403	\N	\N	2022-02-13 07:50:04.714727+00
QCM-R07-353	\N	\N	2022-02-12 17:28:26.872063+00
HMQ-CVM-435	\N	\N	2022-02-16 00:49:59.192313+00
QKM-145-066	\N	\N	2022-02-15 12:37:10.603481+00
FEX-6L1-369	\N	\N	2022-02-15 09:57:11.911041+00
MFF-K51-164	\N	\N	2022-02-15 09:57:16.731325+00
RGF-I81-817	\N	\N	2022-02-12 04:51:16.188594+00
FFG-J03-343	\N	\N	2022-02-12 07:58:46.934847+00
ARV-2BY-417	\N	\N	2022-02-14 21:57:07.212062+00
MSE-3BH-047	\N	\N	2022-02-14 11:19:20.601154+00
MKP-D0K-167	\N	\N	2022-02-14 13:04:30.947127+00
JOU-ZB0-754	\N	\N	2022-02-15 20:50:21.743477+00
DDI-48T-586	\N	\N	2022-02-12 08:23:01.07619+00
AGQ-9R8-797	\N	\N	2022-02-12 04:52:02.463629+00
NPK-S83-660	\N	\N	2022-02-12 04:49:56.308021+00
CNU-52P-431	\N	\N	2022-02-15 10:12:14.217122+00
LXK-732-868	\N	\N	2022-02-15 02:23:55.674735+00
FGV-6BP-146	\N	\N	2022-02-13 12:35:06.527239+00
SHT-8D4-886	\N	\N	2022-02-12 07:48:22.087439+00
TQK-SE0-787	\N	\N	2022-02-12 10:49:49.637213+00
OCY-M8S-654	\N	\N	2022-02-15 09:57:14.984473+00
HNM-KGR-827	\N	\N	2022-02-15 03:49:03.317277+00
KUX-1TF-445	\N	\N	2022-02-14 01:09:09.70147+00
UFC-6FN-218	\N	\N	2022-02-15 06:28:24.890738+00
UQY-G5N-195	\N	\N	2022-02-14 13:52:54.357962+00
WLY-F6T-213	\N	\N	2022-02-14 20:17:48.217584+00
VQO-198-286	\N	\N	2022-02-12 03:56:03.946707+00
EPO-SI1-513	\N	\N	2022-02-12 04:50:40.41851+00
RKE-D8P-738	\N	\N	2022-02-11 22:18:52.866513+00
NDV-6F1-821	\N	\N	2022-02-16 01:13:09.045713+00
IDM-567-943	\N	\N	2022-02-12 17:29:11.651306+00
THU-0O7-859	\N	\N	2022-02-14 13:04:03.987212+00
DUY-H8P-423	\N	\N	2022-02-15 14:59:39.271093+00
IUB-169-737	\N	\N	2022-02-15 18:21:10.649315+00
YFV-151-933	\N	\N	2022-02-16 12:48:06.812088+00
SLM-585-886	\N	\N	2022-02-15 13:18:16.987119+00
IGY-7UR-662	\N	\N	2022-02-12 07:48:17.760906+00
UJF-CLR-939	\N	\N	2022-02-16 08:03:43.035996+00
QRA-3LQ-442	\N	\N	2022-02-15 10:29:48.255426+00
GUF-59T-523	\N	\N	2022-02-15 10:12:11.046953+00
SVS-174-341	\N	\N	2022-02-12 20:03:33.889867+00
IFO-O74-965	\N	\N	2022-02-15 11:56:21.270249+00
VHY-Y7G-683	\N	\N	2022-02-13 07:50:07.614929+00
DWO-Q7V-579	\N	\N	2022-02-21 19:30:52.183752+00
TBM-681-786	\N	\N	2022-02-22 04:24:20.250729+00
QBJ-01G-685	\N	\N	2022-02-22 08:49:41.716997+00
ESG-0KD-516	\N	\N	2022-02-22 00:37:38.027807+00
CCB-2N9-061	\N	\N	2022-02-18 10:15:42.45498+00
ENP-VBS-314	\N	\N	2022-02-20 08:49:50.088755+00
CRU-EWB-712	\N	\N	2022-02-18 07:12:50.615064+00
FHE-L7I-818	\N	\N	2022-02-19 08:22:17.724958+00
CAO-497-517	\N	\N	2022-02-17 19:04:19.124614+00
UCY-LEZ-048	\N	\N	2022-02-19 08:00:17.472193+00
EYX-7MF-585	\N	\N	2022-02-22 21:36:45.358371+00
UHU-NHN-143	\N	\N	2022-02-19 15:51:10.506107+00
FRZ-LLB-566	\N	\N	2022-02-16 14:59:09.562474+00
XPP-63X-802	\N	\N	2022-02-20 08:49:45.786937+00
AFB-LZN-642	\N	\N	2022-02-22 06:02:51.870028+00
PDY-8NP-020	\N	\N	2022-02-19 21:07:57.702509+00
BOA-1M5-065	\N	\N	2022-02-17 22:15:42.457507+00
IXJ-JMK-361	\N	\N	2022-02-17 03:29:46.749638+00
PNQ-F37-875	\N	\N	2022-02-18 20:29:15.01585+00
UST-6AY-398	\N	\N	2022-02-18 08:02:08.255513+00
GDX-W0G-892	\N	\N	2022-02-20 08:07:17.849806+00
JFV-GBO-315	\N	\N	2022-02-22 09:50:55.141162+00
QLJ-G1Z-738	\N	\N	2022-02-22 20:36:36.522755+00
UCC-1K7-682	\N	\N	2022-02-22 22:54:12.099012+00
HFM-8LO-408	\N	\N	2022-02-21 23:54:06.625191+00
QBN-2VU-541	\N	\N	2022-02-18 20:20:29.409741+00
OXX-G8K-587	\N	\N	2022-02-19 10:20:29.768005+00
MYE-052-757	\N	\N	2022-02-19 22:29:57.571152+00
HKQ-W90-820	\N	\N	2022-02-18 20:48:12.042771+00
YGQ-Q57-282	\N	\N	2022-02-19 09:19:48.234702+00
UEH-0X0-036	\N	\N	2022-02-17 03:29:38.409951+00
EEC-G91-184	\N	\N	2022-02-22 14:04:39.444932+00
LNK-064-077	\N	\N	2022-02-19 12:28:27.741243+00
OHN-5ZU-402	\N	\N	2022-02-19 21:28:27.900839+00
COE-8A1-327	\N	\N	2022-02-22 09:50:56.882755+00
YLS-XB9-781	\N	\N	2022-02-18 08:32:51.632725+00
UDT-A99-867	\N	\N	2022-02-19 09:44:31.347559+00
BDF-PZ2-007	\N	\N	2022-02-21 20:35:22.537768+00
RLS-8MD-826	\N	\N	2022-02-19 08:50:32.564783+00
YUA-XYF-133	\N	\N	2022-02-20 08:07:14.439851+00
UOL-0M0-175	\N	\N	2022-02-20 02:29:14.556425+00
RSR-U33-723	\N	\N	2022-02-18 19:32:54.921848+00
WYJ-175-587	\N	\N	2022-02-22 17:20:10.868291+00
PRF-V1T-256	\N	\N	2022-02-19 13:02:46.231875+00
TOU-Z78-538	\N	\N	2022-02-22 15:13:24.808824+00
CQE-X88-468	\N	\N	2022-02-22 04:44:41.853516+00
UBE-DH9-232	\N	\N	2022-02-21 20:02:35.679841+00
RUK-LQ6-066	\N	\N	2022-02-19 09:44:38.613665+00
IWI-5WW-689	\N	\N	2022-02-21 10:20:13.396237+00
PVP-BS6-634	\N	\N	2022-02-19 20:59:51.717328+00
BSO-R92-283	\N	\N	2022-02-21 20:15:09.177422+00
DXK-F05-027	\N	\N	2022-02-23 02:29:38.378623+00
WKP-ZE9-191	\N	\N	2022-02-22 01:24:45.431203+00
JWL-0N7-639	\N	\N	2022-02-17 14:57:30.373719+00
GVY-S8F-661	\N	\N	2022-02-18 22:49:49.659223+00
GBK-052-439	\N	\N	2022-02-19 12:29:51.792451+00
UXJ-J35-785	\N	\N	2022-02-22 08:30:57.967466+00
AVA-AWQ-565	\N	\N	2022-02-17 08:14:30.120531+00
JOC-9LB-127	\N	\N	2022-02-17 19:50:06.010919+00
QMJ-ZW6-181	\N	\N	2022-02-19 08:22:12.770499+00
QER-B17-482	\N	\N	2022-02-21 11:32:26.241609+00
XRH-NEV-211	\N	\N	2022-02-18 14:41:49.494671+00
PTR-CPC-198	\N	\N	2022-02-19 08:58:43.850141+00
PDL-XNF-342	\N	\N	2022-02-21 14:14:50.842823+00
RYZ-308-768	\N	\N	2022-02-17 22:50:50.335771+00
OOM-TH0-744	\N	\N	2022-02-17 15:47:47.347017+00
OXE-GX6-765	\N	\N	2022-02-22 20:40:35.904524+00
SEM-2A2-081	\N	\N	2022-02-21 14:15:35.96373+00
GSL-ZS9-375	\N	\N	2022-02-23 00:39:13.142971+00
XTX-2TC-210	\N	\N	2022-02-16 19:19:40.379856+00
OJG-96U-487	\N	\N	2022-02-18 23:57:06.749051+00
HAU-0K4-463	\N	\N	2022-02-16 14:37:52.156837+00
PMY-Y8M-333	\N	\N	2022-02-18 18:38:27.236+00
QNL-6YY-273	\N	\N	2022-02-22 20:45:36.700183+00
AKU-8AR-011	\N	\N	2022-02-17 12:50:16.879616+00
SVH-148-685	\N	\N	2022-02-19 10:20:27.342551+00
KYE-JFZ-742	\N	\N	2022-02-17 00:14:20.724516+00
KQZ-FKJ-646	\N	\N	2022-02-22 05:06:57.691933+00
PXP-15C-141	\N	\N	2022-02-23 10:30:49.389428+00
YYT-85G-526	\N	\N	2022-02-23 08:48:50.496842+00
ALC-8WA-658	\N	\N	2022-03-09 15:04:13.769389+00
TRR-EDP-372	\N	\N	2022-03-09 14:58:02.442212+00
OXL-1J2-308	\N	\N	2022-03-09 15:10:33.798634+00
LNV-H4V-792	\N	\N	2022-02-23 10:11:47.404034+00
JOB-1OX-535	\N	\N	2022-03-09 15:04:13.865083+00
VLJ-X25-212	\N	\N	2022-03-09 15:10:33.703178+00
SPK-MZ0-103	\N	\N	2022-03-05 15:06:23.742946+00
BVV-FW3-740	\N	\N	2022-03-01 23:58:09.831261+00
HQH-WBK-835	\N	\N	2022-03-09 15:08:24.378848+00
JGE-G57-675	\N	\N	2022-02-23 10:09:12.463923+00
DXD-9JG-397	\N	\N	2022-03-09 15:02:15.184432+00
OUC-22I-232	\N	\N	2022-03-09 15:12:40.111476+00
OVW-3MK-482	\N	\N	2022-03-09 15:06:19.025143+00
OFL-S2J-760	\N	\N	2022-03-09 15:12:50.040349+00
BRB-Z99-276	\N	\N	2022-03-09 15:10:33.703476+00
ASK-1G2-776	\N	\N	2022-02-24 22:37:18.884676+00
YWU-L5X-747	\N	\N	2022-03-09 14:58:02.437155+00
IBC-27Z-266	\N	\N	2022-02-23 08:48:47.972007+00
SEG-AH2-381	\N	\N	2022-03-05 16:45:43.097156+00
SBP-F8N-832	\N	\N	2022-02-23 09:30:55.205282+00
WPJ-KRH-886	\N	\N	2022-02-23 10:13:44.288448+00
HSP-WK5-772	\N	\N	2022-03-09 15:12:40.186285+00
OKO-642-155	\N	\N	2022-03-03 17:20:24.226939+00
POV-7FN-649	\N	\N	2022-02-23 13:14:49.673458+00
YID-2SJ-887	\N	\N	2022-03-09 15:06:18.834954+00
NCI-BCR-254	\N	\N	2022-02-25 11:46:57.817999+00
OGY-E07-940	\N	\N	2022-02-25 03:33:32.146452+00
SCA-Z0K-829	\N	\N	2022-02-23 08:07:01.374036+00
UWK-KS0-873	\N	\N	2022-03-09 14:58:02.516133+00
LVU-036-612	\N	\N	2022-03-09 14:58:02.524076+00
HVH-CV2-667	\N	\N	2022-03-05 12:47:56.767589+00
UBC-7DE-773	\N	\N	2022-02-25 13:47:17.6303+00
XOF-073-187	\N	\N	2022-03-09 15:00:08.896975+00
WGF-LIN-323	\N	\N	2022-02-26 00:19:41.925585+00
UFK-7YP-916	\N	\N	2022-03-09 15:04:21.25968+00
WZG-NJ0-718	\N	\N	2022-03-09 15:00:08.837211+00
KTG-248-847	\N	\N	2022-03-03 12:28:16.894633+00
OVD-537-747	\N	\N	2022-03-09 15:12:50.055536+00
IHJ-27W-028	\N	\N	2022-03-09 15:06:19.026385+00
UXM-T5O-171	\N	\N	2022-03-09 15:04:21.256776+00
FUP-W22-864	\N	\N	2022-03-09 15:00:08.895644+00
ZJX-9DG-350	\N	\N	2022-03-06 14:26:07.876716+00
QVS-38R-786	\N	\N	2022-03-09 15:04:21.256867+00
JIR-8B6-642	\N	\N	2022-03-08 07:17:27.359088+00
JFT-EM1-724	\N	\N	2022-03-09 14:58:02.513674+00
VIJ-384-083	\N	\N	2022-03-04 16:13:51.113223+00
XSR-88P-004	\N	\N	2022-02-24 09:09:04.700731+00
WEY-941-723	\N	\N	2022-03-09 15:02:15.179368+00
RCO-N3X-847	\N	\N	2022-03-09 15:02:15.175048+00
ORA-30Y-725	\N	\N	2022-03-09 15:06:18.829333+00
MWF-7C2-355	\N	\N	2022-02-25 13:32:50.477518+00
WWF-0XQ-218	\N	\N	2022-03-05 11:40:18.554836+00
WMJ-OAM-942	\N	\N	2022-03-09 15:08:24.425174+00
FQC-T7L-816	\N	\N	2022-03-04 19:49:58.033482+00
LPC-7YQ-395	\N	\N	2022-03-09 15:02:15.191429+00
UVT-L0E-316	\N	\N	2022-02-28 15:38:50.358452+00
XQW-680-312	\N	\N	2022-03-09 15:14:45.6611+00
UXP-BJ4-898	\N	\N	2022-02-25 00:52:46.567372+00
MNI-K2O-569	\N	\N	2022-03-09 15:14:56.326715+00
JCD-0Q3-556	\N	\N	2022-03-09 15:10:33.795488+00
PZC-20F-843	\N	\N	2022-02-24 09:09:06.571189+00
RRO-O7C-527	\N	\N	2022-03-09 14:58:02.441874+00
KXB-55N-264	\N	\N	2022-03-09 15:00:08.837027+00
OWF-WAW-252	\N	\N	2022-03-09 15:08:24.43781+00
VMK-9S4-528	\N	\N	2022-03-09 15:14:56.219738+00
OVS-362-351	\N	\N	2022-03-09 15:06:18.833026+00
OMQ-N84-465	\N	\N	2022-03-09 14:55:55.407665+00
KOF-F0R-346	\N	\N	2022-03-07 16:55:43.011351+00
OQA-456-150	\N	\N	2022-03-09 15:04:21.063062+00
WGH-5US-971	\N	\N	2022-03-04 17:02:46.069527+00
DVA-IO7-743	\N	\N	2022-03-09 15:06:19.022607+00
JVR-7T3-036	\N	\N	2022-02-25 12:30:07.407163+00
KYY-B16-160	\N	\N	2022-03-09 15:10:33.796139+00
FBU-7P6-010	\N	\N	2022-02-23 10:11:48.964283+00
RSF-269-660	\N	\N	2022-03-09 14:55:55.407776+00
IXI-WR3-477	\N	\N	2022-03-03 08:39:59.988449+00
BEO-OZF-137	\N	\N	2022-03-04 16:17:49.619177+00
QLN-54E-028	\N	\N	2022-02-25 04:22:49.071702+00
OVM-C8L-828	\N	\N	2022-03-09 15:08:35.14812+00
RTM-DNS-863	\N	\N	2022-03-09 15:02:15.16456+00
GCS-TOV-048	\N	\N	2022-03-09 15:08:24.356012+00
CVO-1E1-850	\N	\N	2022-03-09 14:55:55.309331+00
ATJ-9AZ-496	\N	\N	2022-03-04 17:02:42.053823+00
WXX-5OZ-163	\N	\N	2022-02-23 10:50:18.451965+00
LTW-BEO-358	\N	\N	2022-02-23 13:14:44.326944+00
GEW-DNC-982	\N	\N	2022-03-09 15:00:08.88957+00
AVT-O4O-527	\N	\N	2022-03-09 15:00:08.841664+00
WZO-V72-034	\N	\N	2022-03-02 11:20:30.620345+00
WFQ-PM1-045	\N	\N	2022-03-09 15:10:33.703319+00
HDI-RH9-687	\N	\N	2022-03-09 15:06:29.71778+00
KGD-9D8-188	\N	\N	2022-02-25 14:41:56.221048+00
EQL-7B1-784	\N	\N	2022-02-23 10:50:21.671782+00
OIR-OU8-632	\N	\N	2022-03-09 15:12:40.112821+00
KJI-2L2-468	\N	\N	2022-03-09 15:04:21.093296+00
HQQ-3XM-564	\N	\N	2022-03-09 15:08:24.362113+00
BLM-26Y-338	\N	\N	2022-02-23 09:31:28.833486+00
PEF-YA4-059	\N	\N	2022-03-09 15:12:40.187203+00
WDS-EZU-357	\N	\N	2022-03-09 15:08:24.423893+00
FIP-Y76-232	\N	\N	2022-03-28 02:45:57.822046+00
BSU-DZO-606	\N	\N	2022-03-16 20:58:07.629018+00
FIO-LWK-473	\N	\N	2022-03-09 15:21:03.025568+00
NVJ-96J-802	\N	\N	2022-03-15 21:26:24.268823+00
VEU-BQH-747	\N	\N	2022-03-11 17:34:09.661833+00
YOR-2C3-533	\N	\N	2022-03-11 23:37:26.576035+00
OKS-O4E-943	\N	\N	2022-03-09 15:16:50.509025+00
YBH-0FT-475	\N	\N	2022-03-15 23:06:59.643733+00
CWX-4TT-734	\N	\N	2022-03-22 16:57:03.002255+00
HMD-Z41-502	\N	\N	2022-03-30 07:29:30.465983+00
UGT-4J4-265	\N	\N	2022-03-17 14:58:13.115638+00
VBW-X1A-010	\N	\N	2022-03-12 14:36:12.336831+00
MHO-I6O-769	\N	\N	2022-03-25 03:26:52.682206+00
TEC-588-611	\N	\N	2022-03-21 20:56:24.296106+00
OQX-X80-016	\N	\N	2022-03-28 16:36:05.820631+00
KZY-3FR-781	\N	\N	2022-03-15 02:21:26.083328+00
LXC-1HI-193	\N	\N	2022-03-15 05:36:46.96203+00
CUD-R65-672	\N	\N	2022-03-14 21:24:16.871662+00
IYZ-R20-447	\N	\N	2022-03-23 10:50:16.772083+00
TWP-290-558	\N	\N	2022-03-28 02:33:22.324674+00
IUW-4TQ-361	\N	\N	2022-03-15 21:17:07.998921+00
CCM-M24-794	\N	\N	2022-03-15 20:25:17.074461+00
PFY-EEJ-118	\N	\N	2022-03-12 08:46:29.241997+00
KFX-2P8-521	\N	\N	2022-03-22 08:57:27.160305+00
UUF-MJW-915	\N	\N	2022-03-11 15:32:17.059723+00
LMY-6P3-843	\N	\N	2022-03-12 05:09:45.880722+00
BCD-0MP-903	\N	\N	2022-03-09 15:21:03.025658+00
RHP-MWP-848	\N	\N	2022-03-14 15:19:43.604142+00
HJA-798-244	\N	\N	2022-03-12 23:32:16.600166+00
RXN-NC7-214	\N	\N	2022-03-11 03:36:06.387216+00
UJE-DCD-606	\N	\N	2022-03-15 07:41:51.331584+00
QTT-I4P-101	\N	\N	2022-03-11 22:27:48.126674+00
YAU-UK1-648	\N	\N	2022-04-11 12:55:27.683766+00
HLU-HUX-112	\N	\N	2022-03-09 15:18:57.976797+00
MST-284-582	\N	\N	2022-03-10 07:19:21.566967+00
OTF-1MJ-435	\N	\N	2022-03-23 11:08:25.386557+00
GQZ-9AO-227	\N	\N	2022-03-30 22:03:07.616982+00
XEV-3Z5-236	\N	\N	2022-03-29 20:34:54.71784+00
GYH-P67-027	\N	\N	2022-03-17 12:32:35.664076+00
SCD-2AQ-697	\N	\N	2022-03-11 09:29:37.303361+00
LCU-5T8-186	\N	\N	2022-03-17 14:31:09.325766+00
YJF-47B-345	\N	\N	2022-03-12 20:45:34.774847+00
NDA-N3J-531	\N	\N	2022-03-13 09:54:04.553444+00
ENI-046-308	\N	\N	2022-03-12 22:37:23.766389+00
OWR-4B5-157	\N	\N	2022-03-11 19:24:43.197711+00
FZV-Q86-581	\N	\N	2022-03-21 12:39:55.495484+00
VOL-51F-734	\N	\N	2022-03-29 15:17:06.539185+00
FMM-ROE-124	\N	\N	2022-03-16 16:01:06.872457+00
VEO-47H-083	\N	\N	2022-03-11 01:16:41.362336+00
WTC-F5H-723	\N	\N	2022-03-22 08:58:08.132797+00
THD-15M-531	\N	\N	2022-03-11 23:25:35.640279+00
QKS-B33-897	\N	\N	2022-03-11 07:27:24.302988+00
NLQ-HOA-031	\N	\N	2022-04-06 17:10:21.417858+00
SBS-O5T-230	\N	\N	2022-03-14 23:03:28.124029+00
MDE-5Q2-986	\N	\N	2022-03-17 14:54:31.181167+00
FAS-D7H-436	\N	\N	2022-03-11 00:47:33.126777+00
FEF-5MU-936	\N	\N	2022-03-09 15:23:08.066736+00
FWO-E9S-037	\N	\N	2022-04-11 17:04:40.611585+00
OKT-3BI-635	\N	\N	2022-03-26 11:34:07.756293+00
QOQ-I90-867	\N	\N	2022-03-15 01:29:55.610635+00
DMO-682-179	\N	\N	2022-04-11 10:03:49.717645+00
QCB-W84-851	\N	\N	2022-03-29 18:59:56.284638+00
KAS-V43-938	\N	\N	2022-03-17 17:08:32.923088+00
HSL-946-271	\N	\N	2022-03-09 15:23:08.085424+00
VCJ-TM4-767	\N	\N	2022-03-15 22:40:53.735586+00
TEP-R2S-983	\N	\N	2022-03-25 07:50:21.11865+00
\.


--
-- TOC entry 5397 (class 0 OID 16904)
-- Dependencies: 249
-- Data for Name: classe; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.classe (classe_id, classe_classe_id, classe_espaco_auth, classe_colaborador_id, classe_colaborador_atualizacao, classe_nome, classe_codigo, classe_foto, classe_position, classe_lastcodigo, classe_estado, classe_dataregistro, classe_dataatualizacao, _branch_uid) FROM stdin;
00000000-0000-0000-0000-000000000001	\N	00000000-0000-0000-0000-000000000001	00000000-0000-0000-0000-000000000001	\N	Item extras	804001	\N	0	0	1	2023-09-29 11:51:30.180788+00	2023-09-29 11:51:30.180788+00	\N
\.


--
-- TOC entry 5463 (class 0 OID 17396)
-- Dependencies: 315
-- Data for Name: cliente; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.cliente (cliente_id, cliente_colaborador_id, cliente_colaborador_gerente, cliente_colaborador_atualizacao, cliente_espaco_auth, cliente_tdocument_id, cliente_titular, cliente_nif, cliente_documento, cliente_mail, cliente_contactos, cliente_estado, cliente_dataregistro, cliente_dataatualizacao, _branch_uid, cliente_code, cliente_metadata) FROM stdin;
00000000-0000-0000-0000-000000000001	00000000-0000-0000-0000-000000000001	00000000-0000-0000-0000-000000000001	\N	00000000-0000-0000-0000-000000000001	\N	Cliente Final	\N	\N	\N	[]	1	2021-09-15 18:01:28.937735+00	\N	\N	0000000	{}
\.


--
-- TOC entry 5510 (class 0 OID 19725)
-- Dependencies: 366
-- Data for Name: codigoimposto; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.codigoimposto (codigoimposto_codigo, codigoimposto_descricao) FROM stdin;
111	Facturas de transmissões de bens e prestações de serviços com IVA liquidado à taxa normal de 15%
112	Facturas de transmissões de bens e prestações de serviços com IVA liquidado à taxa reduzida de 7,5%
201	Facturas isentas do IVA nos termos da al. a) do nº 1 do art. 17º do CIVA
202	Facturas isentas do IVA nos termos da al. b) do nº 1 do art. 17º do CIVA
203	Facturas isentas do IVA nos termos da al. c) do nº 1 do art. 17º do CIVA
204	acturas isentas do IVA nos termos da al. d) do nº 1 do art. 17º do CIVA
205	Facturas isentas do IVA nos termos da al. e) do nº 1 do art. 17º do CIVA
206	Facturas isentas do IVA nos termos da al. a) do nº 3 do art. 17º do CIVA
207	Facturas isentas do IVA nos termos da al. b) do nº 3 do art. 17º do CIVA
208	Facturas isentas do IVA nos termos da al. a) do nº 4 do art. 17º do CIVA
209	Facturas isentas do IVA nos termos da al. b) do nº 4 do art. 17º do CIVA
210	Facturas isentas do IVA nos termos da al. a) do nº1 do art. 20º do CIVA
211	Facturas isentas do IVA nos termos da al. b) do nº1 do art. 20º do CIVA
212	Facturas isentas do IVA nos termos da al. c) do nº1 do art. 20º do CIVA
213	Facturas isentas do IVA nos termos da al. d) do nº1 do art. 20º do CIVA
214	Facturas isentas do IVA nos termos da al. e) do nº1 do art. 20º do CIVA
215	Facturas isentas do IVA nos termos da al. f) do nº1 do art. 20º do CIVA
216	Facturas isentas do IVA nos termos da al. g) do nº1 do art. 20º do CIVA
311	Nota de crédito relativa às facturas de transmissões de bens e prestações de serviços com IVA liquidado à taxa normal de 15%
312	Nota de crédito relativa às facturas de transmissões de bens e prestações de serviços com IVA liquidado à taxa normal de 7,5%
401	Nota de crédito relativa às facturas isentas do IVA nos termos da al. a) do nº 1 do art. 17º do CIVA
402	Nota de crédito relativa às facturas isentas do IVA nos termos da al. b) do nº 1 do art. 17º do CIVA
403	Nota de crédito relativa às facturas isentas do IVA nos termos da al. c) do nº 1 do art. 17º do CIVA
404	Nota de crédito relativa às facturas isentas do IVA nos termos da al. d) do nº 1 do art. 17º do CIVA
405	Nota de crédito relativa às facturas isentas do IVA nos termos da al. e) do nº 1 do art. 17º do CIVA
406	Nota de crédito relativa às facturas isentas do IVA nos termos da al. a) do nº 3 do art. 17º do CIVA
407	Nota de crédito relativa às facturas isentas do IVA nos termos da al. b) do nº 3 do art. 17º do CIVA
408	Nota de crédito relativa às facturas isentas do IVA nos termos da al. a) do nº 4 do art. 17º do CIVA
409	Nota de crédito relativa às facturas isentas do IVA nos termos da al. b) do nº 4 do art. do CIVA
410	Nota de crédito relativa às facturas isentas do IVA nos termos da al. a) do nº1 do art. 20º do CIVA
411	ota de crédito relativa às facturas isentas do IVA nos termos da al. b) do nº1 do art. 20º do CIVA
412	Nota de crédito relativa às facturas isentas do IVA nos termos da al. c) do nº1 do art. 20º do CIVA
413	Nota de crédito relativa às facturas isentas do IVA nos termos da al. d) do nº1 do art. 20º do CIVA
414	Nota de crédito relativa às facturas isentas do IVA nos termos da al. e) do nº1 do art. 20º do CIVA
415	Nota de crédito relativa às facturas isentas do IVA nos termos da al. f) do nº1 do art. 20º do CIVA
416	Nota de crédito relativa às facturas isentas do IVA nos termos da al. g) do nº1 do art. 20º do CIVA
551	Facturas de aquisição de serviços autoliquidados à taxa de 15%
611	Facturas de aquisição de bens e prestações de serviços com IVA liquidado à taxa normal de 15%
612	Facturas de aquisição de bens e serviços com IVA liquidado à taxa reduzida de 7,5%
701	Facturas de aquisição isentas do IVA nos termos da al. a) do nº 1 do art. 17º do CIVA
702	Facturas de aquisição isentas do IVA nos termos da al. b) do nº 1 do art. 17º do CIVA
703	Facturas de operações isentas do IVA nos termos da al. c) do nº 1 do art. 17º do CIVA
704	Facturas de aquisição isentas do IVA nos termos da al. d) do nº 1 do art. 17º do CIVA
705	acturas de aquisição isentas do IVA nos termos da al. e) do nº 1 do art. 17º do CIVA
706	Facturas de aquisição isentas do IVA nos termos da al. a) do nº 3 do art. 17º do CIVA
707	Facturas de aquisição isentas do IVA nos termos da al. b) do nº 3 do art. 17º do CIVA
708	Facturas de aquisição isentas do IVA nos termos da al. a) do nº 4 do art. 17º do CIVA
709	Facturas de aquisição isentas do IVA nos termos da al. b) do nº 4 do art. 17º do CIVA
710	Facturas de aquisição isentas do IVA nos termos da al. a) do nº1 do art. 20º do CIVA
711	Facturas de aquisição isentas do IVA nos termos da al. b) do nº1 do art. 20º do CIVA
712	Facturas de aquisição isentas do IVA nos termos da al. c) do nº1 do art. 20º do CIVA
713	Facturas de aquisição isentas do IVA nos termos da al. d) do nº1 do art. 20º do CIVA
714	Facturas de aquisição isentas do IVA nos termos da al. e) do nº1 do art. 20º do CIVA
715	Facturas de aquisição isentas do IVA nos termos da al. f) do nº1 do art. 20º do CIVA
716	Facturas isentas do IVA nos termos da al. g) do nº1 do art. 20º do CIVA
811	Nota de débito relativa às facturas de aquisição de bens e serviços com IVA liquidado à taxa normal de 15%
812	Nota de débito relativa às facturas de aquisição de bens e serviços com IVA liquidado à taxa normal de 7,5%
901	Nota de débito relativa às facturas isentas do IVA nos termos da al. a) do nº 1 do art. 17º do CIVA
902	Nota de débito relativa às facturas isentas do IVA nos termos da al. b) do nº 1 do art. 17º do CIVA
903	Nota de débito relativa às facturas isentas do IVA nos termos da al. c) do nº 1 do art. 17º do CIVA
904	Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. d) do nº 1 do art. 17º do CIVA
905	Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. e) do nº 1 do art. 17º do CIVA
906	Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. a) do nº 3 do art. 17º do CIVA
907	Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. b) do nº 3 do art. 17º do CIVA
908	Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. a) do nº 4 do art. 17º do CIVA
909	Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. b) do nº 4 do art. 17º do CIVA
910	ta de débito relativa às facturas de aquisição isentas do IVA nos termos da al. a) do nº1 do art. 20º do CIVA
911	Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. b) do nº1 do art. 20º do CIVA
912	Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. c) do nº1 do art. 20º do CIVA
913	Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. d) do nº1 do art. 20º do CIVA
914	Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. e) do nº1 do art. 20º do CIVA
915	Nota de débito relativa às facturas de aquisição isentas do IVA nos termos da al. f) do nº1 do art. 20º do CIVA
916	Nota de débito relativa às facturas isentas do IVA nos termos da al. g) do nº1 do art. 20º do CIVA
\.


--
-- TOC entry 5398 (class 0 OID 16917)
-- Dependencies: 250
-- Data for Name: conta; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.conta (conta_id, conta_cliente_id, conta_posto_id, conta_posto_fecho, conta_espaco_auth, conta_colaborador_id, conta_colaborador_atualizacao, conta_numero, conta_titularnif, conta_titular, conta_data, conta_numerofatura, conta_montante, conta_imprensa, conta_observacao, conta_desconto, conta_estado, conta_dataregistro, conta_dataatualizacao, conta_extension, conta_mesa, conta_datafecho, _tgrupo_id, conta_colaborador_fecho, conta_proforma, conta_proformavencimento, conta_proformaextras, conta_serie_id, _branch_uid, conta_serie, conta_chave, conta_conta_docorigin, conta_props, conta_tserie_id) FROM stdin;
\.


--
-- TOC entry 5479 (class 0 OID 17552)
-- Dependencies: 332
-- Data for Name: custoguia; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.custoguia (custoguia_uid, custoguia_guia_uid, custoguia_colaborador_id, custoguia_espaco_auth, custoguia_colaborador_atualizacao, custoguia_descricao, custoguia_montante, custoguia_tcusto_id, custoguia_estado, custoguia_date, custoguia_dateupdate, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5464 (class 0 OID 17406)
-- Dependencies: 316
-- Data for Name: deposito; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.deposito (deposito_id, deposito_caixa_id, deposito_tpaga_id, deposito_currency_id, deposito_espaco_auth, deposito_colaborador_id, deposito_colaborador_atualizacao, deposito_referencia, deposito_documento, deposito_data, deposito_montante, deposito_montantemoeda, deposito_taxacambio, deposito_estado, deposito_dataregistro, deposito_dataatualizacao, deposito_posto_id, deposito_cliente_id, deposito_montantetroco, deposito_docref, deposito_observacao, _tgrupo_id, deposito_serie_id, _branch_uid, deposito_serie) FROM stdin;
\.


--
-- TOC entry 5480 (class 0 OID 17560)
-- Dependencies: 333
-- Data for Name: dispoe; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.dispoe (dispoe_id, dispoe_artigo_id, dispoe_artigo_item, dispoe_espaco_auth, dispoe_colaborador_id, dispoe_colaborador_atualizacao, dispoe_estado, dispoe_dataregistro, dispoe_dataatualizacao, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5481 (class 0 OID 17566)
-- Dependencies: 334
-- Data for Name: ean; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.ean (ean_id, ean_artigo_id, ean_espaco_auth, ean_colaborador_id, ean_colaborador_atualizacao, ean_code, ean_dateout, ean_datein, ean_estado, ean_date, ena_dateupdate, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5462 (class 0 OID 17381)
-- Dependencies: 314
-- Data for Name: entrada; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.entrada (entrada_id, entrada_artigo_id, entrada_espaco_destino, entrada_espaco_auth, entrada_colaborador_id, entrada_colaborador_atualizacao, entrada_custounitario, entrada_quantidade, entrada_quantidadeinicial, entrada_quantidadefinal, entrada_descricao, entrada_estado, entrada_dataregistro, entrada_dataatualizacao, entrada_guia_id, _branch_uid, entrada_lote, entrada_validade, entrada_metadata) FROM stdin;
\.


--
-- TOC entry 5388 (class 0 OID 16758)
-- Dependencies: 240
-- Data for Name: espaco; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.espaco (espaco_id, espaco_vender, espaco_espaco_id, espaco_colaborador_id, espaco_colaborador_atualizaco, espaco_nome, espaco_descricao, espaco_estado, espaco_dataregistro, espaco_dataatualizacao, espaco_gerarfatura, espaco_configurar, espaco_codigo, espaco_faturaano, espaco_seriefatura, espaco_serieconta, espaco_configuracao, espaco_seriedeposito, espaco_branch_uid, espaco_espaco_auth, espaco_posto_admin) FROM stdin;
00000000-0000-0000-0000-000000000001	false	\N	00000000-0000-0000-0000-000000000001	\N	Trunc	Default master workspace	1	2023-09-29 11:51:30.043274+00	\N	f	f	000000	2023	0	0	\N	0	\N	\N	\N
\.


--
-- TOC entry 5470 (class 0 OID 17470)
-- Dependencies: 322
-- Data for Name: fluxo; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.fluxo (fluxo_id, fluxo_toperacao_id, fluxo_artigo_in, fluxo_artigo_out, fluxo_espaco_in, fluxo_espaco_out, fluxo_espaco_auth, fluxo_colaborador_id, fluxo_colaborador_atualizacao, fluxo_sequencia, fluxo_quantidadein, fluxo_quantidadeout, fluxo_quantidadefinal, fluxo_checkpoint, fluxo_data, fluxo_documento, fluxo_observacao, fluxo_referencia, fluxo_regclass, fluxo_refuid, fluxo_estado, fluxo_dataregistro, fluxo_dataatualizacao, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5483 (class 0 OID 17575)
-- Dependencies: 336
-- Data for Name: fornecedor; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.fornecedor (fornecedor_id, fornecedor_espaco_auth, fornecedor_colaborador_id, fornecedor_colaborador_atualizacao, fornecedor_nif, fornecedor_nome, fornecedor_email, fornecedor_contacto, fornecedor_endereco, fornecedor_estado, fornecedor_dataregistro, fornecedor_dataatualizacao, _branch_uid, fornecedor_code) FROM stdin;
\.


--
-- TOC entry 5403 (class 0 OID 17124)
-- Dependencies: 255
-- Data for Name: guia; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.guia (guia_uid, guia_toperacao_id, guia_tguia_id, guia_espaco_auth, guia_colaborador_id, guia_colaborador_atualizacao, guia_documentoperacao, guia_numero, guia_metadata, guia_dataoperacao, guia_observacao, guia_refs, guia_refuid, guia_refclass, guia_estado, guia_date, guia_dateupdate, _braunc_uid, guia_espaco_saida, guia_espaco_entrada, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5484 (class 0 OID 17587)
-- Dependencies: 337
-- Data for Name: imposto; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.imposto (imposto_id, imposto_tipoimposto_id, imposto_artigo_id, imposto_taplicar_id, imposto_espaco_auth, imposto_colaborador_id, imposto_colaborador_atualizacao, imposto_percentagem, imposto_valor, imposto_estado, imposto_dataregistro, imposto_dataatualizacao, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5485 (class 0 OID 17593)
-- Dependencies: 338
-- Data for Name: impostovenda; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.impostovenda (impostovenda_id, impostovenda_venda_id, impostovenda_tipoimposto_id, impostovenda_espaco_auth, impostovenda_colaborador_id, impostovenda_colaborador_atualizacao, impostovenda_valor, impostovenda_percentagem, impostovenda_estado, impostovenda_dataregistro, impostovenda_dataatualizacao, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5466 (class 0 OID 17428)
-- Dependencies: 318
-- Data for Name: lancamento; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.lancamento (lancamento_id, lancamento_cliente_id, lancamento_tlancamento_id, lancamento_colaborador_id, _tgrupo_id, lancamento_colaborador_atualizacao, lancamento_espaco_auth, lancamento_sequencia, lancamento_referencia, lancamento_regclass, lancamento_refid, lancamento_documento, lancamento_data, lancamento_descricao, lancamento_valor, lancamento_operacao, lancamento_estado, lancamento_dataregistro, lancamento_dataatualizacao, _branch_uid, lancamento_via, lancamento_mode) FROM stdin;
\.


--
-- TOC entry 5399 (class 0 OID 16935)
-- Dependencies: 251
-- Data for Name: link; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.link (link_id, link_link_id, link_link_associacao, link_tlink_id, link_espaco_destino, link_espaco_auth, link_colaborador_id, link_colaborador_atualizacao, link_referencia, link_posicao, link_nome, link_metadata, link_config, link_estado, link_dataregistro, link_dataatualizacao, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5389 (class 0 OID 16777)
-- Dependencies: 241
-- Data for Name: movimento; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.movimento (movimento_id, movimento_stock_id, movimento_movimento_reference, movimento_toperacao_id, movimento_tmovimento_id, movimento_espaco_auth, movimento_colaborador_id, movimento_colaborador_atualizacao, movimento_referencia, movimento_data, movimento_documento, movimento_quantidade, movimento_quantidadeinicia, movimento_quantidadefinal, movimento_observacao, movimento_estado, movimento_dataregistro, movimento_dataatualizacao, movimento_artigo_in, movimento_artigo_out, movimento_espaco_in, movimento_espaco_out, movimento_valorin, movimento_valorout, movimento_valorstock, movimento_regclass, movimento_refuid, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5514 (class 0 OID 19845)
-- Dependencies: 371
-- Data for Name: parametrizacao; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.parametrizacao (parametrizacao_uid, parametrizacao_props, parametrizacao_tags, parametrizacao_estado, parametrizacao_user_uid, parametrizacao_user_update, parametrizacao_espaco_auth, parametrizacao_date, parametrizacao_dateupdate, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5400 (class 0 OID 16944)
-- Dependencies: 252
-- Data for Name: posto; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.posto (posto_id, posto_tposto_id, posto_espaco_auth, posto_colaborador_id, posto_colaborador_atualizacao, posto_designacao, posto_chave, posto_multiplecaixa, posto_matricula, posto_estado, posto_dataregistro, posto_dataatualizacao, posto_authmode, posto_caixamode, posto_caixalimite, _branch_uid, posto_vermontatefaturado, posto_definirmontanteautomaticamente) FROM stdin;
\.


--
-- TOC entry 5487 (class 0 OID 17600)
-- Dependencies: 340
-- Data for Name: repcolumn; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.repcolumn (source, name, show, init, format, filter, agg, gen, rename, "position", type) FROM stdin;
tweeks.vreport_fluxo	OPERACAO	t	t	\N	[]	[]	[]	\N	10000	character varying
tweeks.vreport_fluxo	ARTIGO	t	t	\N	[]	[]	[]	\N	1000	text
tweeks.vreport_conta	_branch_uid	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_conta	cliente_id	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_conta	colaborador_id	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_fluxo	ARMAZEM	t	t	\N	[]	[]	[]	\N	990	text
tweeks.vreport_fluxo	QT	t	t	\N	[]	[]	[]	\N	980	text
tweeks.vreport_conta	conta_id	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_conta	DATA	f	f	\N	[]	[]	[]	\N	\N	date
tweeks.vreport_fluxo	COLABORADOR	t	t	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_conta	espaco_id	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_conta	tgrupo_id	f	f	\N	[]	[]	[]	\N	\N	smallint
tweeks.vreport_fluxo	DATA	t	t	\N	[]	[]	[]	\N	\N	date
tweeks.vreport_venda	POSTO	t	t	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_venda	UNIT	t	t	\N	[]	[]	[]	\N	\N	double precision
tweeks.vreport_fluxo	REGISTRO	t	t	\N	[]	[]	[]	\N	\N	timestamp with time zone
tweeks.vreport_venda	MONTANTE	t	f	\N	[]	[]	[]	\N	\N	double precision
tweeks.vreport_conta	CLIENTE	t	t	\N	[{"opr": "like", "mode": "right", "name": "Nome do cliente", "format": "simple"}]	[]	[]	\N	1000	character varying
tweeks.vreport_conta	FATURA	t	f	\N	[{"opr": "like", "mode": "right", "name": "Fatura", "format": "simple"}]	[{"func": "count", "mode": "distinct", "name": "CONTAGEM POR FATURA", "rename": "FA CONTAGEM"}]	[]	\N	900	character varying
tweeks.vreport_conta	REGISTRO	t	t	\N	[{"opr": ">=", "name": "Data inicio", "format": "date"}, {"opr": "<=", "name": "Data fim", "format": "date"}]	[]	[]	\N	\N	date
tweeks.vreport_conta	ARTIGOS	t	t	\N	[]	[]	[]	\N	\N	bigint
tweeks.vreport_conta	MONTANTE	t	f	\N	[]	[{"func": "sum", "init": true, "name": "SOMA DE MONTANTE", "rename": "$ MONTANTE"}]	[]	\N	\N	double precision
tweeks.vreport_conta	ARMAZEM	t	f	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_conta	ARMAZEM-CODE	t	f	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_conta	COLABORADOR	t	f	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_conta	FECHO	t	f	\N	[]	[]	[]	\N	\N	timestamp with time zone
tweeks.vreport_conta	ITEM EXTRAS	t	f	\N	[]	[]	[]	\N	\N	bigint
tweeks.vreport_conta	POSTO	t	f	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_conta	TIPO CONTA	t	f	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_conta	posto_id	f	f	\N	[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]	[]	[]	\N	\N	uuid
tweeks.vreport_venda	espaco_id	f	f	\N	[{"opr": "=", "src": "db", "name": "Armazem", "format": "select", "source": "tweeks.espaco"}]	[]	[]	\N	\N	uuid
tweeks.vreport_venda	QT	t	t	\N	[]	[{"func": "sum", "init": true, "name": "SOMA DE QUANTIDADE", "rename": "QT SOMA"}]	[]	\N	\N	double precision
tweeks.vreport_venda	TOTAL	t	t	\N	[]	[{"func": "sum", "name": "SOMA DE MONTANTE", "rename": "SOMATORIO"}]	[]	\N	\N	double precision
tweeks.vreport_venda	ARTIGO	t	t	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_venda	CLIENTE	t	t	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_venda	venda_id	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_fluxo	Qt+	t	f	\N	[]	[{"func": "sum", "name": "Total saida", "rename": "TOTAL Qt-"}]	[]	\N	\N	double precision
tweeks.vreport_fluxo	DESTINO	t	f	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_fluxo	DOCUMENTO	t	f	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_fluxo	ENTRADA	t	f	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_fluxo	ORIGEM	t	f	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_fluxo	SAIDA	t	f	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_fluxo	__espaco_id	f	f	\N	[]	[]	[]	\N	\N	uuid[]
tweeks.vreport_fluxo	fluxo_colaborador_id	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_fluxo	fluxo_id	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_fluxo	toperacao_id	f	f	\N	[]	[]	[]	\N	\N	smallint
tweeks.vreport_balanco	ARMAZEM	t	t	\N	[]	[]	[]	\N	1000	character varying
tweeks.vreport_balanco	CATEGORIA	t	f	\N	[]	[]	[]	\N	900	character varying
tweeks.vreport_balanco	ARTIGO	t	t	\N	[]	[]	[]	\N	800	character varying
tweeks.vreport_balanco	DATA	t	t	\N	["query.date|start", "query.date|end"]	["agg.count"]	[]	\N	700	date
tweeks.vreport_balanco	ENTRADA	t	f	\N	[]	["agg.sum"]	[]	\N	89	double precision
tweeks.vreport_balanco	ENTRADA PREV	t	f	\N	[]	["agg.sum"]	[]	\N	88	double precision
tweeks.vreport_balanco	ENTRADA EFET	t	f	\N	[]	["agg.sum"]	[]	\N	87	double precision
tweeks.vreport_balanco	ENTRADA ESTI	f	f	\N	[]	[["agg.sum", {"init": true}]]	[]	\N	86	double precision
tweeks.vreport_balanco	SAIDA	t	f	\N	[]	["agg.sum"]	[]	\N	79	double precision
tweeks.vreport_balanco	SAIDA PREV	t	f	\N	[]	["agg.sum"]	[]	\N	78	double precision
tweeks.vreport_balanco	SAIDA EFET	t	f	\N	[]	["agg.sum"]	[]	\N	77	double precision
tweeks.vreport_balanco	SAIDA ESTI	f	f	\N	[]	[["agg.sum", {"init": true}]]	[]	\N	76	double precision
tweeks.vreport_balanco	Qt	t	f	\N	[]	["agg.sum"]	[]	\N	50	double precision
tweeks.vreport_balanco	PREVISTO	t	f	\N	[]	["agg.sum"]	[]	\N	49	double precision
tweeks.vreport_balanco	EFETIVO	t	f	\N	[]	["agg.sum"]	[]	\N	48	double precision
tweeks.vreport_balanco	ESTIMADO	f	f	\N	[]	[["agg.sum", {"init": true}]]	[]	\N	47	double precision
tweeks.vreport_balanco	CODIGO	t	f	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_balanco	artigo_id	f	f	\N	["query.source|tweeks.artigo"]	[]	[]	\N	\N	uuid
tweeks.vreport_balanco	classe_id	f	f	\N	["query.source|tweeks.classe"]	[]	[]	\N	\N	uuid
tweeks.vreport_balanco	espaco_id	f	f	\N	["query.source|tweeks.espaco"]	[]	[]	\N	\N	uuid
tweeks.vreport_balanco	_branch_uid	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_conta	ACOMPANHAMENTO	f	f	\N	[]	[]	[]	\N	\N	bigint
tweeks.vreport_venda	DATA	t	t	\N	[{"opr": ">=", "name": "DATA INICO", "format": "date"}, {"opr": "<=", "name": "DATA FIM", "format": "date"}]	[]	[]	\N	\N	date
tweeks.vreport_venda	FATURA	t	f	\N	[{"opr": "like", "mode": "right", "name": "FATURA", "format": "simple"}]	[{"func": "count", "name": "CONTAGEM", "rename": "CONTAGEM"}]	[]	\N	\N	character varying
tweeks.vreport_venda	EXTRAS	t	f	\N	[]	[]	[]	\N	\N	double precision
tweeks.vreport_venda	INICIADO	t	f	\N	[]	[]	[]	\N	\N	date
tweeks.vreport_venda	NIF	t	f	\N	[]	[]	[]	\N	\N	character varying
tweeks.vreport_venda	artigo_id	f	f	\N	[{"opr": "=", "src": "db", "name": "Artigo", "format": "select", "source": "tweeks.artigo"}]	[]	[]	\N	\N	uuid
tweeks.vreport_venda	posto_id	f	f	\N	[{"opr": "=", "src": "db", "name": "Posto", "format": "select", "source": "tweeks.posto"}]	[]	[]	\N	\N	uuid
tweeks.vreport_venda	_branch_uid	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_fluxo	Qt-	t	f	\N	[]	[{"func": "sum", "name": "Total entrada", "rename": "TOTAL Qt+"}]	[]	\N	\N	double precision
tweeks.vreport_fluxo	__artigo_id	f	f	\N	[]	[]	[]	\N	\N	uuid[]
tweeks.vreport_fluxo	__artigo_in	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_fluxo	__artigo_out	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_fluxo	__espaco_in	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_fluxo	__espaco_out	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_fluxo	_branch_uid	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_fluxo	colaborador_id	f	f	\N	[]	[]	[]	\N	\N	uuid
tweeks.vreport_fluxo	fluxo_referencia	f	f	\N	[]	[]	[]	\N	\N	jsonb
tweeks.vreport_venda	ARMAZEM	t	f	\N	[]	[]	[]	\N	\N	character varying
\.


--
-- TOC entry 5488 (class 0 OID 17610)
-- Dependencies: 341
-- Data for Name: retalho; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.retalho (retalho_id, retalho_artigo_composto, retalho_artigo_base, retalho_colaborador_id, retalho_espaco_auth, retalho_composicao, retalho_quantidade, retalho_estado, retalho_dataregistro, retalho_dataatualizacao, _branch_uid, retalho_codigo) FROM stdin;
\.


--
-- TOC entry 5394 (class 0 OID 16853)
-- Dependencies: 246
-- Data for Name: serie; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.serie (serie_id, serie_sequencia, serie_tserie_id, serie_espaco_id, serie_espaco_auth, serie_colaborador_id, serie_colaborador_atualizacao, serie_designacao, serie_numero, serie_quantidade, serie_estado, serie_dataregistro, serie_dataatualizacao, _branch_uid, serie_numatorizacao, serie_numcertificacao, serie_autorizacao_uid, serie_fechoautorizacao) FROM stdin;
\.


--
-- TOC entry 5492 (class 0 OID 17625)
-- Dependencies: 345
-- Data for Name: taplicar; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.taplicar (taplicar_id, taplicar_descricao) FROM stdin;
1	Adicionar
2	Retirar
\.


--
-- TOC entry 5390 (class 0 OID 16787)
-- Dependencies: 242
-- Data for Name: taxa; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.taxa (taxa_id, taxa_tipoimposto_id, taxa_espaco_auth, taxa_colaborador_id, taxa_colaborador_atualizacao, taxa_percentagem, taxa_taxa, taxa_estado, taxa_dataregistro, taxa_dataatualizacao, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5493 (class 0 OID 17630)
-- Dependencies: 346
-- Data for Name: tbranch; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.tbranch (tbranch_id, tbranch_name, tbranch_configs) FROM stdin;
1	Restaurante	{"base": ["pos", "stock", "cozinha", "", "", "", "", "", "", ""]}
2	Framacia	{"base": ["pos", "stock", "", "", "", "", "", "", "", ""]}
3	Supermeca	{"base": ["pos", "stock", "", "", "", "", "", "", "", ""]}
4	Loja	{"base": ["pos", "stock", "", "", "", "", "", "", "", ""]}
5	Fabrica	{"base": ["pos", "stock", "criacao", "", "", "", "", "", "", ""]}
6	Salão	{"base": ["pos", "stock", "", "", "", "", "", "", "", ""]}
7	Hotél	{"base": ["pos", "stock", "cozinha", "", "", "", "", "", "", ""]}
\.


--
-- TOC entry 5494 (class 0 OID 17636)
-- Dependencies: 347
-- Data for Name: tdocuemto; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.tdocuemto (tdocumento_id, tdocumento_nome) FROM stdin;
\.


--
-- TOC entry 5467 (class 0 OID 17443)
-- Dependencies: 319
-- Data for Name: tgrupo; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.tgrupo (tgrupo_id, tgrupo_desc) FROM stdin;
1	Conta Normal
2	Conta Corrente
\.


--
-- TOC entry 5472 (class 0 OID 17494)
-- Dependencies: 324
-- Data for Name: tipoimposto; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.tipoimposto (tipoimposto_id, tipoimposto_espaco_auth, tipoimposto_colaborador_id, tipoimposto_colaborador_atualizacao, tipoimposto_nome, tipoimposto_codigo, tipoimposto_estado, tipoimposto_dataregistro, tipoimposto_dataatuzaliacao, tipoimposto_percentagem, tipoimposto_valor, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5468 (class 0 OID 17448)
-- Dependencies: 320
-- Data for Name: tlancamento; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.tlancamento (tlancamento_id, tlancamento_desc, tlancamento_operacao) FROM stdin;
1	Deposito	1
2	Fatura	-1
3	Outros lancamento	0
\.


--
-- TOC entry 5495 (class 0 OID 17641)
-- Dependencies: 348
-- Data for Name: tlink; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.tlink (tlink_id, tlink_designacao) FROM stdin;
1	Artigo
2	Paguina
3	Associação
4	Preço
5	Categoria
\.


--
-- TOC entry 5401 (class 0 OID 16955)
-- Dependencies: 253
-- Data for Name: tmovimento; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.tmovimento (tmovimento_id, tmovimento_multiplo, tmovimento_designacao) FROM stdin;
1	1	Credito
2	-1	Debito
\.


--
-- TOC entry 5471 (class 0 OID 17483)
-- Dependencies: 323
-- Data for Name: toperacao; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.toperacao (toperacao_id, toperacao_designacao, toperacao_classe, toperacao_code) FROM stdin;
1	Entrada	1	ENTR
2	Acerto	1	ACER
3	Venda	1	VEND
4	Transferência	1	TRAN
6	Pagamento	2	PAGM
5	Movimento	2	MOVM
7	Retalho	1	RETL
\.


--
-- TOC entry 5465 (class 0 OID 17417)
-- Dependencies: 317
-- Data for Name: tpaga; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.tpaga (tpaga_id, tpaga_designacao) FROM stdin;
1	Cash
2	Deposito
3	Transferência Bancaria
4	Cheque
5	Conta corrente
6	POS
\.


--
-- TOC entry 5496 (class 0 OID 17646)
-- Dependencies: 349
-- Data for Name: tposto; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.tposto (tposto_id, tposto_designacao) FROM stdin;
1	Venda
2	Cobrança
3	Vende & Cobrança
\.


--
-- TOC entry 5497 (class 0 OID 17651)
-- Dependencies: 350
-- Data for Name: trabalha; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.trabalha (trabalha_id, trabalha_perfil_id, trabalha_espaco_destino, trabalha_espaco_auth, trabalha_colaborador_proprietario, trabalha_colaborador_id, trabalha_colaborador_atualizacao, trabalha_estado, trabalha_dataregistro, trabalha_dataatualizacao, trabalha_posicao, _branch_uid) FROM stdin;
9bfe2ad7-7459-4ec6-90f3-78e8cc7d0e6d	\N	00000000-0000-0000-0000-000000000001	00000000-0000-0000-0000-000000000001	00000000-0000-0000-0000-000000000002	00000000-0000-0000-0000-000000000001	\N	1	2023-09-29 11:51:30.088785+00	\N	\N	\N
\.


--
-- TOC entry 5391 (class 0 OID 16810)
-- Dependencies: 243
-- Data for Name: transacao; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.transacao (transacao_id, transacao_posto_id, transacao_toperacao_id, transacao_tmovimento_id, transacao_espaco_auth, transacao_colaborador_id, transacao_colaborador_atualizacao, transacao_referencia, transacao_documento, transacao_zerar, transacao_montante, transacao_montanteinicial, transacao_montantefinal, transacao_observacao, transacao_estado, transacao_dataregistro, transacao_dataatualizacao, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5498 (class 0 OID 17657)
-- Dependencies: 351
-- Data for Name: transferencia; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.transferencia (transferencia_id, transferencia_espaco_auth, transferencia_colaborador_id, transferencia_colaborador_atualizacao, transferencia_quantidade, transferencia_data, transferencia_documento, transferencia_observacao, transferencia_estado, transferencia_dataregistro, transferencia_dataatualizacao, transferencia_espaco_origem, transferencia_espaco_destino, transferencia_artigo_id, _branch_uid, transferencia_lote, transferencia_validade, transferencia_metadata, transferencia_descricao) FROM stdin;
\.


--
-- TOC entry 5469 (class 0 OID 17458)
-- Dependencies: 321
-- Data for Name: tserie; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.tserie (tserie_id, tserie_desc, tserie_code, tserie_seqlimit, tserie_numlimit) FROM stdin;
2	Fatura Recibo	FR	6	7
3	Recibo	RE	6	7
1	Fatura	FT	6	7
4	Nota de credito	NC	6	7
5	Guia Saida	GS	6	7
6	Fatura proforma	FP	6	7
\.


--
-- TOC entry 5513 (class 0 OID 19803)
-- Dependencies: 370
-- Data for Name: unit; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.unit (unit_id, unit_code, unit_name, unit_state, unit_date, unit_update, unit_espaco_auth, unit_user_id, unit_user_update, _branch_uid) FROM stdin;
\.


--
-- TOC entry 5402 (class 0 OID 16961)
-- Dependencies: 254
-- Data for Name: venda; Type: TABLE DATA; Schema: tweeks; Owner: -
--

COPY tweeks.venda (venda_id, venda_conta_id, venda_artigo_id, venda_espaco_auth, venda_colaborador_id, venda_colaborador_atualizacao, venda_quantidade, venda_custounitario, venda_montante, venda_montanteagregado, venda_montantetotal, venda_imposto, venda_montantesemimposto, venda_montantecomimposto, venda_impostoadicionar, venda_impostoretirar, venda_estadopreparacao, venda_estado, venda_dataregistro, venda_dataatualizacao, venda_venda_id, venda_custoquantidade, _branch_uid, venda_descricao, venda_lote, venda_validade, venda_metadata, venda_editado, venda_isencao, venda_taxas, venda_codigoimposto, venda_venda_docorign, venda_proforma) FROM stdin;
\.


--
-- TOC entry 6486 (class 0 OID 0)
-- Dependencies: 356
-- Name: auth_auth_seq_seq; Type: SEQUENCE SET; Schema: cluster; Owner: -
--

SELECT pg_catalog.setval('cluster.auth_auth_seq_seq', 1, false);


--
-- TOC entry 6487 (class 0 OID 0)
-- Dependencies: 262
-- Name: collector_collector_sequence_seq; Type: SEQUENCE SET; Schema: cluster; Owner: -
--

SELECT pg_catalog.setval('cluster.collector_collector_sequence_seq', 32, true);


--
-- TOC entry 6488 (class 0 OID 0)
-- Dependencies: 264
-- Name: filter_filter_id_seq; Type: SEQUENCE SET; Schema: cluster; Owner: -
--

SELECT pg_catalog.setval('cluster.filter_filter_id_seq', 4, true);


--
-- TOC entry 6489 (class 0 OID 0)
-- Dependencies: 265
-- Name: filter_filter_sequence_seq; Type: SEQUENCE SET; Schema: cluster; Owner: -
--

SELECT pg_catalog.setval('cluster.filter_filter_sequence_seq', 1, false);


--
-- TOC entry 6490 (class 0 OID 0)
-- Dependencies: 267
-- Name: object_object_seq_seq; Type: SEQUENCE SET; Schema: cluster; Owner: -
--

SELECT pg_catalog.setval('cluster.object_object_seq_seq', 32, true);


--
-- TOC entry 6491 (class 0 OID 0)
-- Dependencies: 268
-- Name: object_object_sseq_seq; Type: SEQUENCE SET; Schema: cluster; Owner: -
--

SELECT pg_catalog.setval('cluster.object_object_sseq_seq', 1, false);


--
-- TOC entry 6492 (class 0 OID 0)
-- Dependencies: 359
-- Name: pull_pull_sequence_seq; Type: SEQUENCE SET; Schema: cluster; Owner: -
--

SELECT pg_catalog.setval('cluster.pull_pull_sequence_seq', 1, false);


--
-- TOC entry 6493 (class 0 OID 0)
-- Dependencies: 290
-- Name: seq_altspelling; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_altspelling', 760, true);


--
-- TOC entry 6494 (class 0 OID 0)
-- Dependencies: 291
-- Name: seq_country; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_country', 250, true);


--
-- TOC entry 6495 (class 0 OID 0)
-- Dependencies: 292
-- Name: seq_countryborder; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_countryborder', 650, true);


--
-- TOC entry 6496 (class 0 OID 0)
-- Dependencies: 293
-- Name: seq_countrycallcode; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_countrycallcode', 250, true);


--
-- TOC entry 6497 (class 0 OID 0)
-- Dependencies: 294
-- Name: seq_countrycurrency; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_countrycurrency', 271, true);


--
-- TOC entry 6498 (class 0 OID 0)
-- Dependencies: 295
-- Name: seq_countrylanguage; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_countrylanguage', 368, true);


--
-- TOC entry 6499 (class 0 OID 0)
-- Dependencies: 296
-- Name: seq_countryregionalbloc; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_countryregionalbloc', 194, true);


--
-- TOC entry 6500 (class 0 OID 0)
-- Dependencies: 297
-- Name: seq_countrytimezone; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_countrytimezone', 339, true);


--
-- TOC entry 6501 (class 0 OID 0)
-- Dependencies: 298
-- Name: seq_countrytopleveldomain; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_countrytopleveldomain', 254, true);


--
-- TOC entry 6502 (class 0 OID 0)
-- Dependencies: 299
-- Name: seq_countrytranslation; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_countrytranslation', 2232, true);


--
-- TOC entry 6503 (class 0 OID 0)
-- Dependencies: 300
-- Name: seq_currency; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_currency', 174, true);


--
-- TOC entry 6504 (class 0 OID 0)
-- Dependencies: 301
-- Name: seq_dataset; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_dataset', 1, true);


--
-- TOC entry 6505 (class 0 OID 0)
-- Dependencies: 302
-- Name: seq_demonym; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_demonym', 228, true);


--
-- TOC entry 6506 (class 0 OID 0)
-- Dependencies: 303
-- Name: seq_domain; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_domain', 249, true);


--
-- TOC entry 6507 (class 0 OID 0)
-- Dependencies: 304
-- Name: seq_language; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_language', 112, true);


--
-- TOC entry 6508 (class 0 OID 0)
-- Dependencies: 305
-- Name: seq_region; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_region', 6, true);


--
-- TOC entry 6509 (class 0 OID 0)
-- Dependencies: 306
-- Name: seq_regionalbloc; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_regionalbloc', 13, true);


--
-- TOC entry 6510 (class 0 OID 0)
-- Dependencies: 307
-- Name: seq_regionalblocname; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_regionalblocname', 19, true);


--
-- TOC entry 6511 (class 0 OID 0)
-- Dependencies: 308
-- Name: seq_regionalblocother; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_regionalblocother', 5, true);


--
-- TOC entry 6512 (class 0 OID 0)
-- Dependencies: 310
-- Name: seq_subregion; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_subregion', 22, true);


--
-- TOC entry 6513 (class 0 OID 0)
-- Dependencies: 312
-- Name: seq_timezone; Type: SEQUENCE SET; Schema: geoinfo; Owner: -
--

SELECT pg_catalog.setval('geoinfo.seq_timezone', 41, true);


--
-- TOC entry 6514 (class 0 OID 0)
-- Dependencies: 353
-- Name: revision_seq_seq; Type: SEQUENCE SET; Schema: patch; Owner: -
--

SELECT pg_catalog.setval('patch.revision_seq_seq', 120, true);


--
-- TOC entry 6515 (class 0 OID 0)
-- Dependencies: 335
-- Name: fluxo_fluxo_sequencia_seq; Type: SEQUENCE SET; Schema: tweeks; Owner: -
--

SELECT pg_catalog.setval('tweeks.fluxo_fluxo_sequencia_seq', 6699, true);


--
-- TOC entry 6516 (class 0 OID 0)
-- Dependencies: 339
-- Name: lancamento_lancamento_sequencia_seq; Type: SEQUENCE SET; Schema: tweeks; Owner: -
--

SELECT pg_catalog.setval('tweeks.lancamento_lancamento_sequencia_seq', 2964, true);


--
-- TOC entry 6517 (class 0 OID 0)
-- Dependencies: 342
-- Name: seq_classe_code; Type: SEQUENCE SET; Schema: tweeks; Owner: -
--

SELECT pg_catalog.setval('tweeks.seq_classe_code', 5, true);


--
-- TOC entry 6518 (class 0 OID 0)
-- Dependencies: 343
-- Name: seq_cliente_code; Type: SEQUENCE SET; Schema: tweeks; Owner: -
--

SELECT pg_catalog.setval('tweeks.seq_cliente_code', 15, true);


--
-- TOC entry 6519 (class 0 OID 0)
-- Dependencies: 344
-- Name: serie_serie_sequencia_seq; Type: SEQUENCE SET; Schema: tweeks; Owner: -
--

SELECT pg_catalog.setval('tweeks.serie_serie_sequencia_seq', 5, true);


--
-- TOC entry 4689 (class 2606 OID 17752)
-- Name: acesso pk_acesso_id; Type: CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.acesso
    ADD CONSTRAINT pk_acesso_id PRIMARY KEY (acesso_id);


--
-- TOC entry 4691 (class 2606 OID 17754)
-- Name: autenticacao pk_autenticacao_id; Type: CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.autenticacao
    ADD CONSTRAINT pk_autenticacao_id PRIMARY KEY (autenticacao_id);


--
-- TOC entry 4602 (class 2606 OID 17756)
-- Name: colaborador pk_colaborador_id; Type: CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.colaborador
    ADD CONSTRAINT pk_colaborador_id PRIMARY KEY (colaborador_id);


--
-- TOC entry 4648 (class 2606 OID 17758)
-- Name: menu pk_menu_id; Type: CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.menu
    ADD CONSTRAINT pk_menu_id PRIMARY KEY (menu_id);


--
-- TOC entry 4611 (class 2606 OID 17760)
-- Name: perfil pk_perfil_id; Type: CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.perfil
    ADD CONSTRAINT pk_perfil_id PRIMARY KEY (perfil_id);


--
-- TOC entry 4697 (class 2606 OID 17762)
-- Name: privilegio pk_privilegio_id; Type: CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.privilegio
    ADD CONSTRAINT pk_privilegio_id PRIMARY KEY (privilegio_id);


--
-- TOC entry 4702 (class 2606 OID 17764)
-- Name: tsexo pk_tsexo_id; Type: CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.tsexo
    ADD CONSTRAINT pk_tsexo_id PRIMARY KEY (tsexo_id);


--
-- TOC entry 4700 (class 2606 OID 17766)
-- Name: session session_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.session
    ADD CONSTRAINT session_pkey PRIMARY KEY (sid);


--
-- TOC entry 4604 (class 2606 OID 17768)
-- Name: colaborador uk_colaborador_email; Type: CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.colaborador
    ADD CONSTRAINT uk_colaborador_email UNIQUE (colaborador_email);


--
-- TOC entry 4606 (class 2606 OID 17770)
-- Name: colaborador uk_colaborador_nif; Type: CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.colaborador
    ADD CONSTRAINT uk_colaborador_nif UNIQUE (colaborador_nif);


--
-- TOC entry 4613 (class 2606 OID 17772)
-- Name: perfil uk_perfil_nome; Type: CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.perfil
    ADD CONSTRAINT uk_perfil_nome UNIQUE (perfil_nome);


--
-- TOC entry 4704 (class 2606 OID 17774)
-- Name: tsexo uk_tsexo_codigo; Type: CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.tsexo
    ADD CONSTRAINT uk_tsexo_codigo UNIQUE (tsexo_codigo);


--
-- TOC entry 4706 (class 2606 OID 17776)
-- Name: tsexo uk_tsexo_nome; Type: CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.tsexo
    ADD CONSTRAINT uk_tsexo_nome UNIQUE (tsexo_nome);


--
-- TOC entry 4650 (class 2606 OID 17778)
-- Name: menu uq_menu_codigo; Type: CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.menu
    ADD CONSTRAINT uq_menu_codigo UNIQUE (menu_codigo);


--
-- TOC entry 4900 (class 2606 OID 19561)
-- Name: auth cluster_auth_uid; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.auth
    ADD CONSTRAINT cluster_auth_uid PRIMARY KEY (auth_uid);


--
-- TOC entry 4652 (class 2606 OID 17916)
-- Name: branch pk_branch_uid; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.branch
    ADD CONSTRAINT pk_branch_uid PRIMARY KEY (branch_uid);


--
-- TOC entry 4708 (class 2606 OID 17780)
-- Name: break pk_break_uid; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.break
    ADD CONSTRAINT pk_break_uid PRIMARY KEY (break_uid);


--
-- TOC entry 4902 (class 2606 OID 19610)
-- Name: classmap pk_classname; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.classmap
    ADD CONSTRAINT pk_classname PRIMARY KEY (classname);


--
-- TOC entry 4623 (class 2606 OID 17782)
-- Name: cluster pk_cluster_id; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.cluster
    ADD CONSTRAINT pk_cluster_id PRIMARY KEY (cluster_uid);


--
-- TOC entry 4712 (class 2606 OID 17784)
-- Name: sequence pk_cluster_sequence_id; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.sequence
    ADD CONSTRAINT pk_cluster_sequence_id PRIMARY KEY (name, sub);


--
-- TOC entry 4615 (class 2606 OID 17786)
-- Name: collector pk_collector_uid; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.collector
    ADD CONSTRAINT pk_collector_uid PRIMARY KEY (collector_uid, collector_transuid, collector_share_regclass, collector_cluster_origin);


--
-- TOC entry 4710 (class 2606 OID 17788)
-- Name: filter pk_filter_id; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.filter
    ADD CONSTRAINT pk_filter_id PRIMARY KEY (filter_id);


--
-- TOC entry 4621 (class 2606 OID 17790)
-- Name: object pk_object_id; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.object
    ADD CONSTRAINT pk_object_id PRIMARY KEY (object_uid, object_share_regclass, object_cluster_origin);


--
-- TOC entry 4904 (class 2606 OID 19625)
-- Name: pull pk_pull_uid; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.pull
    ADD CONSTRAINT pk_pull_uid PRIMARY KEY (pull_uid);


--
-- TOC entry 4627 (class 2606 OID 17792)
-- Name: resource pk_reference_uid; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.resource
    ADD CONSTRAINT pk_reference_uid PRIMARY KEY (resource_cluster, resource_identifier);


--
-- TOC entry 4714 (class 2606 OID 17794)
-- Name: share pk_share_regclass; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.share
    ADD CONSTRAINT pk_share_regclass PRIMARY KEY (share_regclass);


--
-- TOC entry 4716 (class 2606 OID 17796)
-- Name: tperiod pk_trepeat_id; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.tperiod
    ADD CONSTRAINT pk_trepeat_id PRIMARY KEY (tperiod_id);


--
-- TOC entry 4617 (class 2606 OID 17798)
-- Name: version pk_version_uid; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.version
    ADD CONSTRAINT pk_version_uid PRIMARY KEY (version_uid);


--
-- TOC entry 4625 (class 2606 OID 19507)
-- Name: cluster uk_cluster_namespace; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.cluster
    ADD CONSTRAINT uk_cluster_namespace UNIQUE (cluster_namespace);


--
-- TOC entry 4619 (class 2606 OID 17800)
-- Name: version uk_version_share_cluster; Type: CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.version
    ADD CONSTRAINT uk_version_share_cluster UNIQUE (version_share_regclass, version_cluster_id);


--
-- TOC entry 4719 (class 2606 OID 17802)
-- Name: altspelling pk_altspelling_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.altspelling
    ADD CONSTRAINT pk_altspelling_id PRIMARY KEY (altspelling_id);


--
-- TOC entry 4744 (class 2606 OID 17804)
-- Name: countrycallcode pk_callcode_idcountrycallcode; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrycallcode
    ADD CONSTRAINT pk_callcode_idcountrycallcode PRIMARY KEY (countrycallcode_id);


--
-- TOC entry 4728 (class 2606 OID 17806)
-- Name: country pk_country_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.country
    ADD CONSTRAINT pk_country_id PRIMARY KEY (country_id);


--
-- TOC entry 4740 (class 2606 OID 17808)
-- Name: countryborder pk_countryborder_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countryborder
    ADD CONSTRAINT pk_countryborder_id PRIMARY KEY (countryborder_id);


--
-- TOC entry 4746 (class 2606 OID 17810)
-- Name: countrycurrency pk_countrycurrency_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrycurrency
    ADD CONSTRAINT pk_countrycurrency_id PRIMARY KEY (countrycurrency_id);


--
-- TOC entry 4750 (class 2606 OID 17812)
-- Name: countrylanguage pk_countrylanguage_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrylanguage
    ADD CONSTRAINT pk_countrylanguage_id PRIMARY KEY (countrylanguage_id);


--
-- TOC entry 4754 (class 2606 OID 17814)
-- Name: countryregionalbloc pk_countryregionalbloc_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countryregionalbloc
    ADD CONSTRAINT pk_countryregionalbloc_id PRIMARY KEY (countryregionalbloc_id);


--
-- TOC entry 4758 (class 2606 OID 17816)
-- Name: countrytimezone pk_countrytimezone_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytimezone
    ADD CONSTRAINT pk_countrytimezone_id PRIMARY KEY (countrytimezone_id);


--
-- TOC entry 4762 (class 2606 OID 17818)
-- Name: countrytopleveldomain pk_countrytopleveldomain_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytopleveldomain
    ADD CONSTRAINT pk_countrytopleveldomain_id PRIMARY KEY (countrytopleveldomain_id);


--
-- TOC entry 4766 (class 2606 OID 17820)
-- Name: countrytranslation pk_countrytranslation_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytranslation
    ADD CONSTRAINT pk_countrytranslation_id PRIMARY KEY (countrytranslation_id);


--
-- TOC entry 4773 (class 2606 OID 17822)
-- Name: currency pk_currency_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.currency
    ADD CONSTRAINT pk_currency_id PRIMARY KEY (currency_id);


--
-- TOC entry 4629 (class 2606 OID 17824)
-- Name: dataset pk_dataset_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.dataset
    ADD CONSTRAINT pk_dataset_id PRIMARY KEY (dataset_id);


--
-- TOC entry 4775 (class 2606 OID 17826)
-- Name: demonym pk_demonym_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.demonym
    ADD CONSTRAINT pk_demonym_id PRIMARY KEY (demonym_id);


--
-- TOC entry 4779 (class 2606 OID 17828)
-- Name: domain pk_domain_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.domain
    ADD CONSTRAINT pk_domain_id PRIMARY KEY (domain_id);


--
-- TOC entry 4784 (class 2606 OID 17830)
-- Name: language pk_language_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.language
    ADD CONSTRAINT pk_language_id PRIMARY KEY (language_id);


--
-- TOC entry 4792 (class 2606 OID 17832)
-- Name: region pk_region_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.region
    ADD CONSTRAINT pk_region_id PRIMARY KEY (region_id);


--
-- TOC entry 4796 (class 2606 OID 17834)
-- Name: regionalbloc pk_regionalbloc_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.regionalbloc
    ADD CONSTRAINT pk_regionalbloc_id PRIMARY KEY (regionalbloc_id);


--
-- TOC entry 4803 (class 2606 OID 17836)
-- Name: regionalblocname pk_regionalblocname_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.regionalblocname
    ADD CONSTRAINT pk_regionalblocname_id PRIMARY KEY (regionalblocname_id);


--
-- TOC entry 4806 (class 2606 OID 17838)
-- Name: regionalblocother pk_regionalblocother_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.regionalblocother
    ADD CONSTRAINT pk_regionalblocother_id PRIMARY KEY (regionalblocother_id);


--
-- TOC entry 4810 (class 2606 OID 17840)
-- Name: subregion pk_subregion_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.subregion
    ADD CONSTRAINT pk_subregion_id PRIMARY KEY (subregion_id);


--
-- TOC entry 4814 (class 2606 OID 17842)
-- Name: timezone pk_timezone_id; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.timezone
    ADD CONSTRAINT pk_timezone_id PRIMARY KEY (timezone_id);


--
-- TOC entry 4721 (class 2606 OID 17844)
-- Name: altspelling uk_altspelling_desc; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.altspelling
    ADD CONSTRAINT uk_altspelling_desc UNIQUE (altspelling_altspelling);


--
-- TOC entry 4730 (class 2606 OID 17846)
-- Name: country uk_country_country_cioc; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.country
    ADD CONSTRAINT uk_country_country_cioc UNIQUE (country_cioc);


--
-- TOC entry 4732 (class 2606 OID 17848)
-- Name: country uk_country_iso2; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.country
    ADD CONSTRAINT uk_country_iso2 UNIQUE (country_iso2);


--
-- TOC entry 4734 (class 2606 OID 17850)
-- Name: country uk_country_iso3; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.country
    ADD CONSTRAINT uk_country_iso3 UNIQUE (country_iso3);


--
-- TOC entry 4736 (class 2606 OID 17852)
-- Name: country uk_country_nativename; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.country
    ADD CONSTRAINT uk_country_nativename UNIQUE (country_nativename);


--
-- TOC entry 4738 (class 2606 OID 17854)
-- Name: country uk_country_numericcode; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.country
    ADD CONSTRAINT uk_country_numericcode UNIQUE (country_numericcode);


--
-- TOC entry 4742 (class 2606 OID 17856)
-- Name: countryborder uk_countryborder_country_border; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countryborder
    ADD CONSTRAINT uk_countryborder_country_border UNIQUE (countryborder_country_id, countryborder_country_broder);


--
-- TOC entry 4748 (class 2606 OID 17858)
-- Name: countrycurrency uk_countrycurrency_country_currency; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrycurrency
    ADD CONSTRAINT uk_countrycurrency_country_currency UNIQUE (countrycurrency_country_id, countrycurrency_currency_id);


--
-- TOC entry 4752 (class 2606 OID 17860)
-- Name: countrylanguage uk_countrylanguage_country_language; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrylanguage
    ADD CONSTRAINT uk_countrylanguage_country_language UNIQUE (countrylanguage_country_id, countrylanguage_language_id);


--
-- TOC entry 4756 (class 2606 OID 17862)
-- Name: countryregionalbloc uk_countryregionalbloc_country_regionalblock; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countryregionalbloc
    ADD CONSTRAINT uk_countryregionalbloc_country_regionalblock UNIQUE (countryregionalbloc_country_id, countryregionalbloc_regionalbloc_id);


--
-- TOC entry 4760 (class 2606 OID 17864)
-- Name: countrytimezone uk_countrytimezone_country_timezone; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytimezone
    ADD CONSTRAINT uk_countrytimezone_country_timezone UNIQUE (countrytimezone_country_id, countrytimezone_timezone_id);


--
-- TOC entry 4764 (class 2606 OID 17866)
-- Name: countrytopleveldomain uk_countrytopleveldomain_country_domain; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytopleveldomain
    ADD CONSTRAINT uk_countrytopleveldomain_country_domain UNIQUE (countrytopleveldomain_country_id, countrytopleveldomain_domain_id);


--
-- TOC entry 4768 (class 2606 OID 17868)
-- Name: countrytranslation uk_countrytranslation_country_language; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytranslation
    ADD CONSTRAINT uk_countrytranslation_country_language UNIQUE (countrytranslation_country_id, countrytranslation_language_id);


--
-- TOC entry 4631 (class 2606 OID 17870)
-- Name: dataset uk_dataset_link; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.dataset
    ADD CONSTRAINT uk_dataset_link UNIQUE (dataset_link);


--
-- TOC entry 4777 (class 2606 OID 17872)
-- Name: demonym uk_demonym_name; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.demonym
    ADD CONSTRAINT uk_demonym_name UNIQUE (demonym_name);


--
-- TOC entry 4781 (class 2606 OID 17874)
-- Name: domain uk_domain_code; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.domain
    ADD CONSTRAINT uk_domain_code UNIQUE (domain_name);


--
-- TOC entry 4786 (class 2606 OID 17876)
-- Name: language uk_language_iso2; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.language
    ADD CONSTRAINT uk_language_iso2 UNIQUE (language_iso2);


--
-- TOC entry 4788 (class 2606 OID 17878)
-- Name: language uk_language_iso3; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.language
    ADD CONSTRAINT uk_language_iso3 UNIQUE (language_iso3);


--
-- TOC entry 4790 (class 2606 OID 17880)
-- Name: language uk_language_name; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.language
    ADD CONSTRAINT uk_language_name UNIQUE (language_name);


--
-- TOC entry 4794 (class 2606 OID 17882)
-- Name: region uk_region_name; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.region
    ADD CONSTRAINT uk_region_name UNIQUE (region_name);


--
-- TOC entry 4798 (class 2606 OID 17884)
-- Name: regionalbloc uk_regionalbloc_acronym; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.regionalbloc
    ADD CONSTRAINT uk_regionalbloc_acronym UNIQUE (regionalbloc_acronym);


--
-- TOC entry 4800 (class 2606 OID 17886)
-- Name: regionalbloc uk_regionalbloc_name; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.regionalbloc
    ADD CONSTRAINT uk_regionalbloc_name UNIQUE (regionalbloc_name);


--
-- TOC entry 4808 (class 2606 OID 17888)
-- Name: regionalblocother uk_regionalblocother_otheracronym; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.regionalblocother
    ADD CONSTRAINT uk_regionalblocother_otheracronym UNIQUE (regionalblocother_otheracronym);


--
-- TOC entry 4812 (class 2606 OID 17890)
-- Name: subregion uk_subregion_name; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.subregion
    ADD CONSTRAINT uk_subregion_name UNIQUE (subregion_name);


--
-- TOC entry 4816 (class 2606 OID 17892)
-- Name: timezone uk_timezone_timezone; Type: CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.timezone
    ADD CONSTRAINT uk_timezone_timezone UNIQUE (timezone_timezone);


--
-- TOC entry 4908 (class 2606 OID 19681)
-- Name: domsync domsync_pkey; Type: CONSTRAINT; Schema: libdom; Owner: -
--

ALTER TABLE ONLY libdom.domsync
    ADD CONSTRAINT domsync_pkey PRIMARY KEY (classname, columnname);


--
-- TOC entry 4906 (class 2606 OID 19683)
-- Name: entryset pk_name; Type: CONSTRAINT; Schema: libdom; Owner: -
--

ALTER TABLE ONLY libdom.entryset
    ADD CONSTRAINT pk_name PRIMARY KEY (name);


--
-- TOC entry 4818 (class 2606 OID 17894)
-- Name: constvalue pk_constvalue_name; Type: CONSTRAINT; Schema: map; Owner: -
--

ALTER TABLE ONLY map.constvalue
    ADD CONSTRAINT pk_constvalue_name PRIMARY KEY (constvalue_name);


--
-- TOC entry 4896 (class 2606 OID 19473)
-- Name: raw pk_raw_id; Type: CONSTRAINT; Schema: patch; Owner: -
--

ALTER TABLE ONLY patch.raw
    ADD CONSTRAINT pk_raw_id PRIMARY KEY (raw_uid);


--
-- TOC entry 4898 (class 2606 OID 19489)
-- Name: revision uk_ref_math; Type: CONSTRAINT; Schema: patch; Owner: -
--

ALTER TABLE ONLY patch.revision
    ADD CONSTRAINT uk_ref_math PRIMARY KEY (ref, _raw_uid, force);


--
-- TOC entry 4916 (class 2606 OID 19791)
-- Name: filter filter_pkey; Type: CONSTRAINT; Schema: report; Owner: -
--

ALTER TABLE ONLY report.filter
    ADD CONSTRAINT filter_pkey PRIMARY KEY (filter_uid);


--
-- TOC entry 4914 (class 2606 OID 19778)
-- Name: parametrized parametrized_pkey; Type: CONSTRAINT; Schema: report; Owner: -
--

ALTER TABLE ONLY report.parametrized
    ADD CONSTRAINT parametrized_pkey PRIMARY KEY (parametrized_uid);


--
-- TOC entry 4928 (class 2606 OID 19925)
-- Name: agg pk_agg_key; Type: CONSTRAINT; Schema: report; Owner: -
--

ALTER TABLE ONLY report.agg
    ADD CONSTRAINT pk_agg_key PRIMARY KEY (key);


--
-- TOC entry 4924 (class 2606 OID 19890)
-- Name: report pk_report_source; Type: CONSTRAINT; Schema: report; Owner: -
--

ALTER TABLE ONLY report.report
    ADD CONSTRAINT pk_report_source PRIMARY KEY (report_source);


--
-- TOC entry 4932 (class 2606 OID 19940)
-- Name: mask pk_reportformats; Type: CONSTRAINT; Schema: report; Owner: -
--

ALTER TABLE ONLY report.mask
    ADD CONSTRAINT pk_reportformats PRIMARY KEY (type, mask);


--
-- TOC entry 4930 (class 2606 OID 19932)
-- Name: talias pk_talias_type; Type: CONSTRAINT; Schema: report; Owner: -
--

ALTER TABLE ONLY report.talias
    ADD CONSTRAINT pk_talias_type PRIMARY KEY (type);


--
-- TOC entry 4934 (class 2606 OID 19949)
-- Name: var pk_value_key; Type: CONSTRAINT; Schema: report; Owner: -
--

ALTER TABLE ONLY report.var
    ADD CONSTRAINT pk_value_key PRIMARY KEY (var_key);


--
-- TOC entry 4926 (class 2606 OID 19918)
-- Name: vcolumn pk_vcolumn_source; Type: CONSTRAINT; Schema: report; Owner: -
--

ALTER TABLE ONLY report.vcolumn
    ADD CONSTRAINT pk_vcolumn_source PRIMARY KEY (source, name);


--
-- TOC entry 4922 (class 2606 OID 19856)
-- Name: parametrizacao parametrizacao_pkey; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.parametrizacao
    ADD CONSTRAINT parametrizacao_pkey PRIMARY KEY (parametrizacao_uid);


--
-- TOC entry 4850 (class 2606 OID 17908)
-- Name: acerto pk_acerto_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.acerto
    ADD CONSTRAINT pk_acerto_id PRIMARY KEY (acerto_id);


--
-- TOC entry 4852 (class 2606 OID 17910)
-- Name: aloca pk_aloca_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.aloca
    ADD CONSTRAINT pk_aloca_id PRIMARY KEY (aloca_id);


--
-- TOC entry 4826 (class 2606 OID 17912)
-- Name: deposito pk_amortizacao_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.deposito
    ADD CONSTRAINT pk_amortizacao_id PRIMARY KEY (deposito_id);


--
-- TOC entry 4656 (class 2606 OID 17914)
-- Name: artigo pk_artigo_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.artigo
    ADD CONSTRAINT pk_artigo_id PRIMARY KEY (artigo_id);


--
-- TOC entry 4910 (class 2606 OID 19702)
-- Name: autorizacao pk_autorizacao_uid; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.autorizacao
    ADD CONSTRAINT pk_autorizacao_uid PRIMARY KEY (autorizacao_uid);


--
-- TOC entry 4854 (class 2606 OID 17918)
-- Name: branchmap pk_branchmap_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.branchmap
    ADD CONSTRAINT pk_branchmap_id PRIMARY KEY (class);


--
-- TOC entry 4658 (class 2606 OID 17920)
-- Name: caixa pk_caixa_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.caixa
    ADD CONSTRAINT pk_caixa_id PRIMARY KEY (caixa_id);


--
-- TOC entry 4856 (class 2606 OID 17922)
-- Name: cambio pk_cambio_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.cambio
    ADD CONSTRAINT pk_cambio_id PRIMARY KEY (cambio_id);


--
-- TOC entry 4858 (class 2606 OID 17924)
-- Name: chave pk_chave_temp; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.chave
    ADD CONSTRAINT pk_chave_temp PRIMARY KEY (chave_temporarai);


--
-- TOC entry 4660 (class 2606 OID 17926)
-- Name: classe pk_classe_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.classe
    ADD CONSTRAINT pk_classe_id PRIMARY KEY (classe_id);


--
-- TOC entry 4822 (class 2606 OID 17928)
-- Name: cliente pk_cliente_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.cliente
    ADD CONSTRAINT pk_cliente_id PRIMARY KEY (cliente_id);


--
-- TOC entry 4912 (class 2606 OID 19731)
-- Name: codigoimposto pk_codigoimposto_codigo; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.codigoimposto
    ADD CONSTRAINT pk_codigoimposto_codigo PRIMARY KEY (codigoimposto_codigo);


--
-- TOC entry 4664 (class 2606 OID 17930)
-- Name: conta pk_conta_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.conta
    ADD CONSTRAINT pk_conta_id PRIMARY KEY (conta_id);


--
-- TOC entry 4860 (class 2606 OID 17932)
-- Name: custoguia pk_custo_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.custoguia
    ADD CONSTRAINT pk_custo_id PRIMARY KEY (custoguia_uid);


--
-- TOC entry 4862 (class 2606 OID 17934)
-- Name: dispoe pk_dispoe_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.dispoe
    ADD CONSTRAINT pk_dispoe_id PRIMARY KEY (dispoe_id);


--
-- TOC entry 4864 (class 2606 OID 17936)
-- Name: ean pk_ena_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.ean
    ADD CONSTRAINT pk_ena_id PRIMARY KEY (ean_id);


--
-- TOC entry 4820 (class 2606 OID 17938)
-- Name: entrada pk_entrada_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.entrada
    ADD CONSTRAINT pk_entrada_id PRIMARY KEY (entrada_id);


--
-- TOC entry 4633 (class 2606 OID 17940)
-- Name: espaco pk_espaco_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.espaco
    ADD CONSTRAINT pk_espaco_id PRIMARY KEY (espaco_id);


--
-- TOC entry 4842 (class 2606 OID 17942)
-- Name: fluxo pk_fluxo_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fluxo
    ADD CONSTRAINT pk_fluxo_id PRIMARY KEY (fluxo_id);


--
-- TOC entry 4868 (class 2606 OID 17944)
-- Name: fornecedor pk_fornecedor_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fornecedor
    ADD CONSTRAINT pk_fornecedor_id PRIMARY KEY (fornecedor_id);


--
-- TOC entry 4684 (class 2606 OID 17946)
-- Name: guia pk_guia_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.guia
    ADD CONSTRAINT pk_guia_id PRIMARY KEY (guia_uid);


--
-- TOC entry 4874 (class 2606 OID 17948)
-- Name: imposto pk_imposto_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.imposto
    ADD CONSTRAINT pk_imposto_id PRIMARY KEY (imposto_id);


--
-- TOC entry 4876 (class 2606 OID 17950)
-- Name: impostovenda pk_impostovenda_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.impostovenda
    ADD CONSTRAINT pk_impostovenda_id PRIMARY KEY (impostovenda_id);


--
-- TOC entry 4834 (class 2606 OID 17952)
-- Name: lancamento pk_lancamento_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.lancamento
    ADD CONSTRAINT pk_lancamento_id PRIMARY KEY (lancamento_id);


--
-- TOC entry 4670 (class 2606 OID 17954)
-- Name: link pk_link_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.link
    ADD CONSTRAINT pk_link_id PRIMARY KEY (link_id);


--
-- TOC entry 4642 (class 2606 OID 17956)
-- Name: movimento pk_movimento_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.movimento
    ADD CONSTRAINT pk_movimento_id PRIMARY KEY (movimento_id);


--
-- TOC entry 4672 (class 2606 OID 17958)
-- Name: posto pk_posto_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.posto
    ADD CONSTRAINT pk_posto_id PRIMARY KEY (posto_id);


--
-- TOC entry 4878 (class 2606 OID 17960)
-- Name: repcolumn pk_repcolumn_source; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.repcolumn
    ADD CONSTRAINT pk_repcolumn_source PRIMARY KEY (source, name);


--
-- TOC entry 4880 (class 2606 OID 17962)
-- Name: retalho pk_retalho_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.retalho
    ADD CONSTRAINT pk_retalho_id PRIMARY KEY (retalho_id);


--
-- TOC entry 4654 (class 2606 OID 17964)
-- Name: serie pk_serie_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.serie
    ADD CONSTRAINT pk_serie_id PRIMARY KEY (serie_id);


--
-- TOC entry 4882 (class 2606 OID 17966)
-- Name: taplicar pk_taplicar_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.taplicar
    ADD CONSTRAINT pk_taplicar_id PRIMARY KEY (taplicar_id);


--
-- TOC entry 4644 (class 2606 OID 17968)
-- Name: taxa pk_taxa_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.taxa
    ADD CONSTRAINT pk_taxa_id PRIMARY KEY (taxa_id);


--
-- TOC entry 4884 (class 2606 OID 17970)
-- Name: tbranch pk_tbranch_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tbranch
    ADD CONSTRAINT pk_tbranch_id PRIMARY KEY (tbranch_id);


--
-- TOC entry 4886 (class 2606 OID 17972)
-- Name: tdocuemto pk_tdocumento_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tdocuemto
    ADD CONSTRAINT pk_tdocumento_id PRIMARY KEY (tdocumento_id);


--
-- TOC entry 4836 (class 2606 OID 17974)
-- Name: tgrupo pk_tgroupo_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tgrupo
    ADD CONSTRAINT pk_tgroupo_id PRIMARY KEY (tgrupo_id);


--
-- TOC entry 4846 (class 2606 OID 17976)
-- Name: tipoimposto pk_tipoimposto_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tipoimposto
    ADD CONSTRAINT pk_tipoimposto_id PRIMARY KEY (tipoimposto_id);


--
-- TOC entry 4888 (class 2606 OID 17978)
-- Name: tlink pk_tlink_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tlink
    ADD CONSTRAINT pk_tlink_id PRIMARY KEY (tlink_id);


--
-- TOC entry 4678 (class 2606 OID 17980)
-- Name: tmovimento pk_tmovimento_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tmovimento
    ADD CONSTRAINT pk_tmovimento_id PRIMARY KEY (tmovimento_id);


--
-- TOC entry 4844 (class 2606 OID 17982)
-- Name: toperacao pk_toperacao_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.toperacao
    ADD CONSTRAINT pk_toperacao_id PRIMARY KEY (toperacao_id);


--
-- TOC entry 4830 (class 2606 OID 17984)
-- Name: tpaga pk_tpaga_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tpaga
    ADD CONSTRAINT pk_tpaga_id PRIMARY KEY (tpaga_id);


--
-- TOC entry 4890 (class 2606 OID 17986)
-- Name: tposto pk_tposto_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tposto
    ADD CONSTRAINT pk_tposto_id PRIMARY KEY (tposto_id);


--
-- TOC entry 4892 (class 2606 OID 17988)
-- Name: trabalha pk_trabalha_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.trabalha
    ADD CONSTRAINT pk_trabalha_id PRIMARY KEY (trabalha_id);


--
-- TOC entry 4646 (class 2606 OID 17990)
-- Name: transacao pk_transacao_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.transacao
    ADD CONSTRAINT pk_transacao_id PRIMARY KEY (transacao_id);


--
-- TOC entry 4894 (class 2606 OID 17992)
-- Name: transferencia pk_transferencia_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.transferencia
    ADD CONSTRAINT pk_transferencia_id PRIMARY KEY (transferencia_id);


--
-- TOC entry 4840 (class 2606 OID 17994)
-- Name: tserie pk_tserie_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tserie
    ADD CONSTRAINT pk_tserie_id PRIMARY KEY (tserie_id);


--
-- TOC entry 4838 (class 2606 OID 17996)
-- Name: tlancamento pk_ttransacao_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tlancamento
    ADD CONSTRAINT pk_ttransacao_id PRIMARY KEY (tlancamento_id);


--
-- TOC entry 4682 (class 2606 OID 17998)
-- Name: venda pk_venda_id; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.venda
    ADD CONSTRAINT pk_venda_id PRIMARY KEY (venda_id);


--
-- TOC entry 4662 (class 2606 OID 18000)
-- Name: classe uk_classe_nome; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.classe
    ADD CONSTRAINT uk_classe_nome UNIQUE (_branch_uid, classe_nome);


--
-- TOC entry 4824 (class 2606 OID 18002)
-- Name: cliente uk_cliente_nif; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.cliente
    ADD CONSTRAINT uk_cliente_nif UNIQUE (cliente_espaco_auth, cliente_nif);


--
-- TOC entry 4666 (class 2606 OID 19835)
-- Name: conta uk_conta_chave; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.conta
    ADD CONSTRAINT uk_conta_chave UNIQUE (conta_chave, _branch_uid);


--
-- TOC entry 4668 (class 2606 OID 18006)
-- Name: conta uk_conta_fatura; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.conta
    ADD CONSTRAINT uk_conta_fatura UNIQUE (_branch_uid, conta_espaco_auth, conta_numerofatura);


--
-- TOC entry 4828 (class 2606 OID 18008)
-- Name: deposito uk_deposto_key; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.deposito
    ADD CONSTRAINT uk_deposto_key UNIQUE (_branch_uid, deposito_espaco_auth, deposito_documento);


--
-- TOC entry 4866 (class 2606 OID 18010)
-- Name: ean uk_ean_code; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.ean
    ADD CONSTRAINT uk_ean_code UNIQUE (_branch_uid, ean_espaco_auth, ean_code);


--
-- TOC entry 4635 (class 2606 OID 18012)
-- Name: espaco uk_espaco_codigo; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.espaco
    ADD CONSTRAINT uk_espaco_codigo UNIQUE (espaco_branch_uid, espaco_codigo);


--
-- TOC entry 4637 (class 2606 OID 18014)
-- Name: espaco uk_espaco_nome; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.espaco
    ADD CONSTRAINT uk_espaco_nome UNIQUE (espaco_nome);


--
-- TOC entry 4870 (class 2606 OID 18016)
-- Name: fornecedor uk_fornecedor_email; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fornecedor
    ADD CONSTRAINT uk_fornecedor_email UNIQUE (_branch_uid, fornecedor_email);


--
-- TOC entry 4872 (class 2606 OID 18018)
-- Name: fornecedor uk_fornecedor_nif; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fornecedor
    ADD CONSTRAINT uk_fornecedor_nif UNIQUE (_branch_uid, fornecedor_nif);


--
-- TOC entry 4674 (class 2606 OID 18020)
-- Name: posto uk_posto_chave; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.posto
    ADD CONSTRAINT uk_posto_chave UNIQUE (_branch_uid, posto_chave);


--
-- TOC entry 4676 (class 2606 OID 18022)
-- Name: posto uk_posto_matricula; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.posto
    ADD CONSTRAINT uk_posto_matricula UNIQUE (_branch_uid, posto_matricula);


--
-- TOC entry 4848 (class 2606 OID 18024)
-- Name: tipoimposto uk_tipoimposto; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tipoimposto
    ADD CONSTRAINT uk_tipoimposto UNIQUE (tipoimposto_codigo, tipoimposto_espaco_auth);


--
-- TOC entry 4680 (class 2606 OID 18026)
-- Name: tmovimento uk_tmovimento_designacao; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tmovimento
    ADD CONSTRAINT uk_tmovimento_designacao UNIQUE (tmovimento_designacao);


--
-- TOC entry 4832 (class 2606 OID 18028)
-- Name: tpaga uk_tpaga_designacao; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tpaga
    ADD CONSTRAINT uk_tpaga_designacao UNIQUE (tpaga_designacao);


--
-- TOC entry 4918 (class 2606 OID 19814)
-- Name: unit uk_unit_code; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.unit
    ADD CONSTRAINT uk_unit_code UNIQUE (unit_code, _branch_uid);


--
-- TOC entry 4920 (class 2606 OID 19812)
-- Name: unit unit_pkey; Type: CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.unit
    ADD CONSTRAINT unit_pkey PRIMARY KEY (unit_id);


--
-- TOC entry 4698 (class 1259 OID 18029)
-- Name: IDX_session_expire; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX "IDX_session_expire" ON auth.session USING btree (expire);


--
-- TOC entry 4685 (class 1259 OID 18030)
-- Name: idx_acesso_colaborador_propetario; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_acesso_colaborador_propetario ON auth.acesso USING btree (acesso_colaborador_propetario);


--
-- TOC entry 4686 (class 1259 OID 18031)
-- Name: idx_acesso_estado; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_acesso_estado ON auth.acesso USING btree (acesso_estado);


--
-- TOC entry 4687 (class 1259 OID 18032)
-- Name: idx_acesso_menu_id; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_acesso_menu_id ON auth.acesso USING btree (acesso_menu_id);


--
-- TOC entry 4598 (class 1259 OID 18033)
-- Name: idx_agenda_colaborador_id; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_agenda_colaborador_id ON auth.colaborador USING btree (colaborador_id);


--
-- TOC entry 4599 (class 1259 OID 18034)
-- Name: idx_autenticacao_colaborador_id; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_autenticacao_colaborador_id ON auth.colaborador USING btree (colaborador_id);


--
-- TOC entry 4600 (class 1259 OID 18035)
-- Name: idx_colaborador_colaborador_id; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_colaborador_colaborador_id ON auth.colaborador USING btree (colaborador_colaborador_id);


--
-- TOC entry 4607 (class 1259 OID 18036)
-- Name: idx_perfil_colaborador_atualizacao; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_perfil_colaborador_atualizacao ON auth.perfil USING btree (perfil_colaborador_atualizacao);


--
-- TOC entry 4608 (class 1259 OID 18037)
-- Name: idx_perfil_colaborador_id; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_perfil_colaborador_id ON auth.perfil USING btree (perfil_colaborador_id);


--
-- TOC entry 4609 (class 1259 OID 18038)
-- Name: idx_perfil_perfil_perfil_id; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_perfil_perfil_perfil_id ON auth.perfil USING btree (perfil_perfil_id);


--
-- TOC entry 4692 (class 1259 OID 18039)
-- Name: idx_previlegio_menu_id; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_previlegio_menu_id ON auth.privilegio USING btree (privilegio_menu_id);


--
-- TOC entry 4693 (class 1259 OID 18040)
-- Name: idx_privilegio_colaboirador_atualizacao; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_privilegio_colaboirador_atualizacao ON auth.privilegio USING btree (privilegio_colaborador_atualizacao);


--
-- TOC entry 4694 (class 1259 OID 18041)
-- Name: idx_privilegio_colaboirador_id; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_privilegio_colaboirador_id ON auth.privilegio USING btree (privilegio_colaborador_id);


--
-- TOC entry 4695 (class 1259 OID 18042)
-- Name: idx_privilegio_perfil_id; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_privilegio_perfil_id ON auth.privilegio USING btree (previlegio_perfil_id);


--
-- TOC entry 4717 (class 1259 OID 18043)
-- Name: idx_altspelling_country_id; Type: INDEX; Schema: geoinfo; Owner: -
--

CREATE INDEX idx_altspelling_country_id ON geoinfo.altspelling USING btree (altspelling_country_id);


--
-- TOC entry 4722 (class 1259 OID 18044)
-- Name: idx_country_capital; Type: INDEX; Schema: geoinfo; Owner: -
--

CREATE INDEX idx_country_capital ON geoinfo.country USING btree (country_capital);


--
-- TOC entry 4723 (class 1259 OID 18045)
-- Name: idx_country_demonym_id; Type: INDEX; Schema: geoinfo; Owner: -
--

CREATE INDEX idx_country_demonym_id ON geoinfo.country USING btree (country_demonym_id);


--
-- TOC entry 4724 (class 1259 OID 18046)
-- Name: idx_country_name; Type: INDEX; Schema: geoinfo; Owner: -
--

CREATE INDEX idx_country_name ON geoinfo.country USING btree (country_name);


--
-- TOC entry 4725 (class 1259 OID 18047)
-- Name: idx_country_region_id; Type: INDEX; Schema: geoinfo; Owner: -
--

CREATE INDEX idx_country_region_id ON geoinfo.country USING btree (country_region_id);


--
-- TOC entry 4726 (class 1259 OID 18048)
-- Name: idx_country_subregion_id; Type: INDEX; Schema: geoinfo; Owner: -
--

CREATE INDEX idx_country_subregion_id ON geoinfo.country USING btree (country_subregion_id);


--
-- TOC entry 4769 (class 1259 OID 18049)
-- Name: idx_currency_code; Type: INDEX; Schema: geoinfo; Owner: -
--

CREATE INDEX idx_currency_code ON geoinfo.currency USING btree (currency_code);


--
-- TOC entry 4770 (class 1259 OID 18050)
-- Name: idx_currency_code_name; Type: INDEX; Schema: geoinfo; Owner: -
--

CREATE INDEX idx_currency_code_name ON geoinfo.currency USING btree (currency_code, currency_name);


--
-- TOC entry 4771 (class 1259 OID 18051)
-- Name: idx_currency_name; Type: INDEX; Schema: geoinfo; Owner: -
--

CREATE INDEX idx_currency_name ON geoinfo.currency USING btree (currency_name);


--
-- TOC entry 4782 (class 1259 OID 18052)
-- Name: idx_language_nativename; Type: INDEX; Schema: geoinfo; Owner: -
--

CREATE INDEX idx_language_nativename ON geoinfo.language USING btree (language_nativename);


--
-- TOC entry 4801 (class 1259 OID 18053)
-- Name: idx_regionalblocname_regionalbloc_id; Type: INDEX; Schema: geoinfo; Owner: -
--

CREATE INDEX idx_regionalblocname_regionalbloc_id ON geoinfo.regionalblocname USING btree (regionalblocname_regionalbloc_id);


--
-- TOC entry 4804 (class 1259 OID 18054)
-- Name: idx_regionalblocother_regionalbloc_id; Type: INDEX; Schema: geoinfo; Owner: -
--

CREATE INDEX idx_regionalblocother_regionalbloc_id ON geoinfo.regionalblocother USING btree (regionalblocother_regionalbloc_id);


--
-- TOC entry 4638 (class 1259 OID 18055)
-- Name: idx_movimento_referencia_entrada_hash; Type: INDEX; Schema: tweeks; Owner: -
--

CREATE INDEX idx_movimento_referencia_entrada_hash ON tweeks.movimento USING hash ((((movimento_referencia ->> 'entrada_id'::text))::uuid));


--
-- TOC entry 4639 (class 1259 OID 18056)
-- Name: idx_movimento_referencia_venda_gin; Type: INDEX; Schema: tweeks; Owner: -
--

CREATE INDEX idx_movimento_referencia_venda_gin ON tweeks.movimento USING gin (movimento_referencia);


--
-- TOC entry 4640 (class 1259 OID 18057)
-- Name: idx_movimento_referencia_venda_hash; Type: INDEX; Schema: tweeks; Owner: -
--

CREATE INDEX idx_movimento_referencia_venda_hash ON tweeks.movimento USING hash ((((movimento_referencia ->> 'venda_id'::text))::uuid));


--
-- TOC entry 5374 (class 2618 OID 19999)
-- Name: vreport_guiasaida _RETURN; Type: RULE; Schema: report; Owner: -
--

CREATE OR REPLACE VIEW report.vreport_guiasaida AS
 WITH _const(maguita_venda_estado_fechado, maguita_conta_estado_fechado, maguita_tserie_guiasaida) AS (
         SELECT (map.get('maguita_venda_estado_fechado'::name))::smallint AS get,
            (map.get('maguita_conta_estado_fechado'::name))::smallint AS get,
            (map.get('maguita_tserie_guiasaida'::name))::smallint AS get,
            (map.get('maguita_tserie_guiasaida'::name))::smallint AS get
        )
 SELECT v.venda_id,
    ct.conta_numerofatura AS "SERIE",
    a.artigo_nome AS "ARTIGO",
    cat.classe_nome AS "CATEGORIA",
    cat.classe_codigo AS "CÓD. CAT.",
    e.espaco_nome AS "ARMAZÉM",
    p.posto_designacao AS "POSTO",
    ct.conta_titularnif AS "NIF",
    ct.conta_titular AS "CLIENTE",
    v.venda_custounitario AS "$ PREÇO",
    v.venda_quantidade AS "QT",
    v.venda_montante AS "$ MONT.",
    v.venda_montanteagregado AS "$ EXTRAS",
    v.venda_montantetotal AS "$ MONT+EXT",
    v.venda_imposto AS "$ IMPOSTO",
    v.venda_montantesemimposto AS "$ SUBTOTAL",
    v.venda_montantecomimposto AS "$ TOTAL",
    ct.conta_montante AS "$ MONTANTE FINAL",
    v.venda_isencao,
    string_agg((tip.tipoimposto_codigo)::text, ', '::text) AS "IMPOSTOS",
    string_agg(format('%s %s'::text, COALESCE(tx.taxa_percentagem, tx.taxa_taxa),
        CASE
            WHEN (tx.taxa_percentagem IS NOT NULL) THEN '%'::text
            ELSE 'STN'::text
        END), ', '::text) FILTER (WHERE (tx.taxa_id IS NOT NULL)) AS "TAXAS",
    array_agg(tip.tipoimposto_id) AS _tipoimposto_ids,
    a.artigo_id,
    (ct.conta_datafecho)::date AS "DATA",
    ct._tgrupo_id,
    ct.conta_cliente_id,
    p.posto_id,
    e.espaco_id,
    lib.str_normalize(format('%s %s'::text, aut.colaborador_nome, aut.colaborador_apelido)) AS "COLABORADOR",
    ct.conta_colaborador_fecho AS colaborador_fecho,
    cat.classe_id,
    a.artigo_codigo AS "CÓD ARTIGO",
    v._branch_uid
   FROM _const,
    (((((((((tweeks.venda v
     JOIN tweeks.artigo a ON ((v.venda_artigo_id = a.artigo_id)))
     JOIN tweeks.classe cat ON ((a.artigo_classe_id = cat.classe_id)))
     JOIN tweeks.conta ct ON ((v.venda_conta_id = ct.conta_id)))
     JOIN tweeks.posto p ON ((ct.conta_posto_fecho = p.posto_id)))
     JOIN tweeks.espaco e ON ((p.posto_espaco_auth = e.espaco_id)))
     JOIN auth.colaborador aut ON ((ct.conta_colaborador_fecho = aut.colaborador_id)))
     JOIN tweeks.serie se ON ((ct.conta_serie_id = se.serie_id)))
     LEFT JOIN tweeks.taxa tx ON ((tx.taxa_id = ANY (v.venda_taxas))))
     LEFT JOIN tweeks.tipoimposto tip ON ((tx.taxa_tipoimposto_id = tip.tipoimposto_id)))
  WHERE ((v.venda_estado = _const.maguita_venda_estado_fechado) AND (ct.conta_estado = _const.maguita_conta_estado_fechado) AND (se.serie_tserie_id = _const.maguita_tserie_guiasaida))
  GROUP BY v.venda_id, a.artigo_id, ct.conta_id, p.posto_id, e.espaco_id, cat.classe_id, aut.colaborador_id;


--
-- TOC entry 5376 (class 2618 OID 20013)
-- Name: vreport_notacredito _RETURN; Type: RULE; Schema: report; Owner: -
--

CREATE OR REPLACE VIEW report.vreport_notacredito AS
 WITH _const(maguita_venda_estado_fechado, maguita_conta_estado_fechado, maguita_tserie_notacredito) AS (
         SELECT (map.get('maguita_venda_estado_fechado'::name))::smallint AS get,
            (map.get('maguita_conta_estado_fechado'::name))::smallint AS get,
            (map.get('maguita_tserie_notacredito'::name))::smallint AS get
        )
 SELECT v.venda_id,
    ct.conta_numerofatura AS "DOCUMENTO",
    ct.conta_observacao AS "JUSTIFICATIVA",
    ctorigem.conta_numerofatura AS "DOC. ORIGEM",
    a.artigo_nome AS "ARTIGO",
    cat.classe_nome AS "CATEGORIA",
    cat.classe_codigo AS "CÓD. CAT.",
    e.espaco_nome AS "ARMAZÉM",
    p.posto_designacao AS "POSTO",
    ct.conta_titularnif AS "NIF",
    ct.conta_titular AS "CLIENTE",
    v.venda_custounitario AS "$ PREÇO",
    v.venda_quantidade AS "QT",
    v.venda_montante AS "$ MONT.",
    v.venda_montanteagregado AS "$ EXTRAS",
    v.venda_montantetotal AS "$ MONT+EXT",
    v.venda_imposto AS "$ IMPOSTO",
    v.venda_montantesemimposto AS "$ SUBTOTAL",
    v.venda_montantecomimposto AS "$ TOTAL",
    ct.conta_montante AS "$ MONTANTE FINAL",
    v.venda_isencao,
        CASE
            WHEN v.venda_isencao THEN 'SIM'::text
            ELSE 'NÃO'::text
        END AS "ISEN.",
    string_agg((tip.tipoimposto_codigo)::text, ', '::text) AS "IMPOSTOS",
    string_agg(format('%s %s'::text, COALESCE(tx.taxa_percentagem, tx.taxa_taxa),
        CASE
            WHEN (tx.taxa_percentagem IS NOT NULL) THEN '%'::text
            ELSE 'STN'::text
        END), ', '::text) FILTER (WHERE (tx.taxa_id IS NOT NULL)) AS "TAXAS",
    array_agg(tip.tipoimposto_id) AS _tipoimposto_ids,
    a.artigo_id,
    (ct.conta_datafecho)::date AS "DATA",
    ts.tserie_id,
    ts.tserie_desc AS "SERIE",
    ct._tgrupo_id,
    ct.conta_cliente_id,
    p.posto_id,
    e.espaco_id,
    lib.str_normalize(format('%s %s'::text, aut.colaborador_nome, aut.colaborador_apelido)) AS "COLABORADOR",
    v._branch_uid,
    ct.conta_colaborador_fecho AS colaborador_fecho,
    cat.classe_id,
    de.deposito_id,
    de.deposito_caixa_id AS _caixa_id,
    cx.caixa_code AS "CAIXA",
    a.artigo_codigo AS "CÓD ARTIGO"
   FROM _const,
    (((((((((((((tweeks.venda v
     JOIN tweeks.artigo a ON ((v.venda_artigo_id = a.artigo_id)))
     JOIN tweeks.classe cat ON ((a.artigo_classe_id = cat.classe_id)))
     JOIN tweeks.conta ct ON ((v.venda_conta_id = ct.conta_id)))
     JOIN tweeks.conta ctorigem ON ((ct.conta_conta_docorigin = ctorigem.conta_id)))
     JOIN tweeks.posto p ON ((ct.conta_posto_fecho = p.posto_id)))
     JOIN tweeks.espaco e ON ((p.posto_espaco_auth = e.espaco_id)))
     JOIN auth.colaborador aut ON ((ct.conta_colaborador_fecho = aut.colaborador_id)))
     JOIN tweeks.serie se ON ((ct.conta_serie_id = se.serie_id)))
     JOIN tweeks.tserie ts ON ((se.serie_tserie_id = ts.tserie_id)))
     LEFT JOIN tweeks.deposito de ON (((((de.deposito_referencia ->> 'conta_id'::text))::uuid = ct.conta_id) AND (de.deposito_posto_id = p.posto_id) AND ((de.deposito_documento)::text = (ct.conta_numerofatura)::text))))
     LEFT JOIN tweeks.caixa cx ON ((de.deposito_caixa_id = cx.caixa_id)))
     LEFT JOIN tweeks.taxa tx ON ((tx.taxa_id = ANY (v.venda_taxas))))
     LEFT JOIN tweeks.tipoimposto tip ON ((tx.taxa_tipoimposto_id = tip.tipoimposto_id)))
  WHERE ((v.venda_estado = _const.maguita_venda_estado_fechado) AND (ct.conta_estado = _const.maguita_conta_estado_fechado) AND (se.serie_tserie_id = _const.maguita_tserie_notacredito))
  GROUP BY v.venda_id, a.artigo_id, ct.conta_id, ctorigem.conta_id, p.posto_id, de.deposito_id, e.espaco_id, cat.classe_id, aut.colaborador_id, ts.tserie_id, cx.caixa_id;


--
-- TOC entry 5377 (class 2618 OID 20020)
-- Name: vreport_venda _RETURN; Type: RULE; Schema: report; Owner: -
--

CREATE OR REPLACE VIEW report.vreport_venda AS
 WITH _const(maguita_venda_estado_fechado, maguita_conta_estado_fechado, maguita_tserie_faturarecibo, maguita_tserie_fatura) AS (
         SELECT (map.get('maguita_venda_estado_fechado'::name))::smallint AS get,
            (map.get('maguita_conta_estado_fechado'::name))::smallint AS get,
            (map.get('maguita_tserie_faturarecibo'::name))::smallint AS get,
            (map.get('maguita_tserie_fatura'::name))::smallint AS get
        )
 SELECT v.venda_id,
    ct.conta_numerofatura AS "FATURA",
    a.artigo_nome AS "ARTIGO",
    cat.classe_nome AS "CATEGORIA",
    cat.classe_codigo AS "CÓD. CAT.",
    e.espaco_nome AS "ARMAZÉM",
    p.posto_designacao AS "POSTO",
    ct.conta_titularnif AS "NIF",
    ct.conta_titular AS "CLIENTE",
    v.venda_custounitario AS "$ PREÇO",
    v.venda_quantidade AS "QT",
    v.venda_montante AS "$ MONT.",
    v.venda_montanteagregado AS "$ EXTRAS",
    v.venda_montantetotal AS "$ MONT+EXT",
    v.venda_imposto AS "$ IMPOSTO",
    v.venda_montantesemimposto AS "$ SUBTOTAL",
    v.venda_montantecomimposto AS "$ TOTAL",
    ct.conta_montante AS "$ MONTANTE FINAL",
    v.venda_isencao,
        CASE
            WHEN v.venda_isencao THEN 'SIM'::text
            ELSE 'NÃO'::text
        END AS "ISEN.",
    string_agg((tip.tipoimposto_codigo)::text, ', '::text) AS "IMPOSTOS",
    string_agg(format('%s %s'::text, COALESCE(tx.taxa_percentagem, tx.taxa_taxa),
        CASE
            WHEN (tx.taxa_percentagem IS NOT NULL) THEN '%'::text
            ELSE 'STN'::text
        END), ', '::text) FILTER (WHERE (tx.taxa_id IS NOT NULL)) AS "TAXAS",
    array_agg(tip.tipoimposto_id) AS _tipoimposto_ids,
    a.artigo_id,
    (ct.conta_datafecho)::date AS "DATA",
    ts.tserie_id,
    ts.tserie_desc AS "SERIE",
    ct._tgrupo_id,
    ct.conta_cliente_id,
    p.posto_id,
    e.espaco_id,
    lib.str_normalize(format('%s %s'::text, aut.colaborador_nome, aut.colaborador_apelido)) AS "COLABORADOR",
    v._branch_uid,
    ct.conta_colaborador_fecho AS colaborador_fecho,
    cat.classe_id,
    de.deposito_id,
    de.deposito_caixa_id AS _caixa_id,
    cx.caixa_code AS "CAIXA",
    a.artigo_codigo AS "CÓD ARTIGO"
   FROM _const,
    ((((((((((((tweeks.venda v
     JOIN tweeks.artigo a ON ((v.venda_artigo_id = a.artigo_id)))
     JOIN tweeks.classe cat ON ((a.artigo_classe_id = cat.classe_id)))
     JOIN tweeks.conta ct ON ((v.venda_conta_id = ct.conta_id)))
     JOIN tweeks.posto p ON ((ct.conta_posto_fecho = p.posto_id)))
     JOIN tweeks.espaco e ON ((p.posto_espaco_auth = e.espaco_id)))
     JOIN auth.colaborador aut ON ((ct.conta_colaborador_fecho = aut.colaborador_id)))
     JOIN tweeks.serie se ON ((ct.conta_serie_id = se.serie_id)))
     JOIN tweeks.tserie ts ON ((se.serie_tserie_id = ts.tserie_id)))
     LEFT JOIN tweeks.deposito de ON (((((de.deposito_referencia ->> 'conta_id'::text))::uuid = ct.conta_id) AND (de.deposito_posto_id = p.posto_id) AND ((de.deposito_documento)::text = (ct.conta_numerofatura)::text))))
     LEFT JOIN tweeks.caixa cx ON ((de.deposito_caixa_id = cx.caixa_id)))
     LEFT JOIN tweeks.taxa tx ON ((tx.taxa_id = ANY (v.venda_taxas))))
     LEFT JOIN tweeks.tipoimposto tip ON ((tx.taxa_tipoimposto_id = tip.tipoimposto_id)))
  WHERE ((v.venda_estado = _const.maguita_venda_estado_fechado) AND (ct.conta_estado = _const.maguita_conta_estado_fechado) AND ((se.serie_tserie_id = _const.maguita_tserie_faturarecibo) OR (se.serie_tserie_id = _const.maguita_tserie_fatura)))
  GROUP BY v.venda_id, a.artigo_id, ct.conta_id, p.posto_id, de.deposito_id, e.espaco_id, cat.classe_id, aut.colaborador_id, ts.tserie_id, cx.caixa_id;


--
-- TOC entry 5378 (class 2618 OID 20027)
-- Name: vreport_venda_artigo _RETURN; Type: RULE; Schema: report; Owner: -
--

CREATE OR REPLACE VIEW report.vreport_venda_artigo AS
 WITH _const(maguita_venda_estado_fechado, maguita_conta_estado_fechado, maguita_tserie_faturarecibo, maguita_tserie_fatura) AS (
         SELECT (map.get('maguita_venda_estado_fechado'::name))::smallint AS get,
            (map.get('maguita_conta_estado_fechado'::name))::smallint AS get,
            (map.get('maguita_tserie_faturarecibo'::name))::smallint AS get,
            (map.get('maguita_tserie_fatura'::name))::smallint AS get
        )
 SELECT a.artigo_nome AS "ARTIGO",
    cat.classe_nome AS "CATEGORIA",
    cat.classe_codigo AS "CÓD. CAT.",
    e.espaco_nome AS "ARMAZÉM",
    p.posto_designacao AS "POSTO",
    sum(v.venda_quantidade) AS "QT",
    sum(v.venda_montante) AS "$ MONT.",
    sum(v.venda_montanteagregado) AS "$ EXTRAS",
    sum(v.venda_montantetotal) AS "$ MONT+EXT",
    sum(v.venda_imposto) AS "$ IMPOSTO",
    sum(v.venda_montantesemimposto) AS "$ SUBTOTAL",
    sum(v.venda_montantecomimposto) AS "$ TOTAL",
    string_agg((tip.tipoimposto_codigo)::text, ', '::text) AS "IMPOSTOS",
    string_agg(format('%s %s'::text, COALESCE(tx.taxa_percentagem, tx.taxa_taxa),
        CASE
            WHEN (tx.taxa_percentagem IS NOT NULL) THEN '%'::text
            ELSE 'STN'::text
        END), ', '::text) FILTER (WHERE (tx.taxa_id IS NOT NULL)) AS "TAXAS",
    array_agg(tip.tipoimposto_id) AS _tipoimposto_ids,
    a.artigo_id,
    ts.tserie_id,
    ts.tserie_desc AS "SERIE",
    p.posto_id,
    e.espaco_id,
    lib.str_normalize(format('%s %s'::text, aut.colaborador_nome, aut.colaborador_apelido)) AS "COLABORADOR",
    cx.caixa_code AS "CAIXA",
    cx.caixa_id AS _caixa_id,
    a.artigo_codigo AS "CÓD ARTIGO",
    a._branch_uid
   FROM _const,
    ((((((((((((tweeks.venda v
     JOIN tweeks.artigo a ON ((v.venda_artigo_id = a.artigo_id)))
     JOIN tweeks.classe cat ON ((a.artigo_classe_id = cat.classe_id)))
     JOIN tweeks.conta ct ON ((v.venda_conta_id = ct.conta_id)))
     JOIN tweeks.posto p ON ((ct.conta_posto_fecho = p.posto_id)))
     JOIN tweeks.espaco e ON ((p.posto_espaco_auth = e.espaco_id)))
     JOIN auth.colaborador aut ON ((ct.conta_colaborador_fecho = aut.colaborador_id)))
     JOIN tweeks.serie se ON ((ct.conta_serie_id = se.serie_id)))
     JOIN tweeks.tserie ts ON ((se.serie_tserie_id = ts.tserie_id)))
     LEFT JOIN tweeks.deposito de ON (((((de.deposito_referencia ->> 'conta_id'::text))::uuid = ct.conta_id) AND (de.deposito_posto_id = p.posto_id) AND ((de.deposito_documento)::text = (ct.conta_numerofatura)::text))))
     LEFT JOIN tweeks.caixa cx ON ((de.deposito_caixa_id = cx.caixa_id)))
     LEFT JOIN tweeks.taxa tx ON ((tx.taxa_id = ANY (v.venda_taxas))))
     LEFT JOIN tweeks.tipoimposto tip ON ((tx.taxa_tipoimposto_id = tip.tipoimposto_id)))
  WHERE ((v.venda_estado = _const.maguita_venda_estado_fechado) AND (ct.conta_estado = _const.maguita_conta_estado_fechado) AND ((se.serie_tserie_id = _const.maguita_tserie_faturarecibo) OR (se.serie_tserie_id = _const.maguita_tserie_fatura)))
  GROUP BY a.artigo_id, p.posto_id, e.espaco_id, cat.classe_id, aut.colaborador_id, ts.tserie_id, cx.caixa_id;


--
-- TOC entry 5159 (class 2620 OID 18059)
-- Name: acesso cluster_version_add_change_after_insert_on_auth_acesso_680140; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_insert_on_auth_acesso_680140 AFTER INSERT ON auth.acesso FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_insert();


--
-- TOC entry 5108 (class 2620 OID 18060)
-- Name: colaborador cluster_version_add_change_after_insert_on_auth_colaborador_111; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_insert_on_auth_colaborador_111 AFTER INSERT ON auth.colaborador FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_insert();


--
-- TOC entry 5112 (class 2620 OID 18061)
-- Name: perfil cluster_version_add_change_after_insert_on_auth_perfil_921824; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_insert_on_auth_perfil_921824 AFTER INSERT ON auth.perfil FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_insert();


--
-- TOC entry 5165 (class 2620 OID 18062)
-- Name: privilegio cluster_version_add_change_after_insert_on_auth_privilegio_4414; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_insert_on_auth_privilegio_4414 AFTER INSERT ON auth.privilegio FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_insert();


--
-- TOC entry 5160 (class 2620 OID 18063)
-- Name: acesso cluster_version_add_change_after_update_on_auth_acesso_499335; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_update_on_auth_acesso_499335 AFTER UPDATE ON auth.acesso FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_update();


--
-- TOC entry 5109 (class 2620 OID 18064)
-- Name: colaborador cluster_version_add_change_after_update_on_auth_colaborador_456; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_update_on_auth_colaborador_456 AFTER UPDATE ON auth.colaborador FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_update();


--
-- TOC entry 5113 (class 2620 OID 18065)
-- Name: perfil cluster_version_add_change_after_update_on_auth_perfil_388675; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_update_on_auth_perfil_388675 AFTER UPDATE ON auth.perfil FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_update();


--
-- TOC entry 5166 (class 2620 OID 18066)
-- Name: privilegio cluster_version_add_change_after_update_on_auth_privilegio_7057; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_update_on_auth_privilegio_7057 AFTER UPDATE ON auth.privilegio FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_update();


--
-- TOC entry 5161 (class 2620 OID 18067)
-- Name: acesso cluster_version_commit_change_insert_on_auth_acesso_724429; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_insert_on_auth_acesso_724429 AFTER INSERT ON auth.acesso FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5110 (class 2620 OID 18068)
-- Name: colaborador cluster_version_commit_change_insert_on_auth_colaborador_598187; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_insert_on_auth_colaborador_598187 AFTER INSERT ON auth.colaborador FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5114 (class 2620 OID 18069)
-- Name: perfil cluster_version_commit_change_insert_on_auth_perfil_158915; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_insert_on_auth_perfil_158915 AFTER INSERT ON auth.perfil FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5167 (class 2620 OID 18070)
-- Name: privilegio cluster_version_commit_change_insert_on_auth_privilegio_651705; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_insert_on_auth_privilegio_651705 AFTER INSERT ON auth.privilegio FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5162 (class 2620 OID 18071)
-- Name: acesso cluster_version_commit_change_update_on_auth_acesso_149765; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_update_on_auth_acesso_149765 AFTER UPDATE ON auth.acesso FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5111 (class 2620 OID 18072)
-- Name: colaborador cluster_version_commit_change_update_on_auth_colaborador_676820; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_update_on_auth_colaborador_676820 AFTER UPDATE ON auth.colaborador FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5115 (class 2620 OID 18073)
-- Name: perfil cluster_version_commit_change_update_on_auth_perfil_266693; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_update_on_auth_perfil_266693 AFTER UPDATE ON auth.perfil FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5168 (class 2620 OID 18074)
-- Name: privilegio cluster_version_commit_change_update_on_auth_privilegio_656203; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_update_on_auth_privilegio_656203 AFTER UPDATE ON auth.privilegio FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5163 (class 2620 OID 18075)
-- Name: acesso sync_branch_map_before_insert_on_auth_acesso_909018; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_auth_acesso_909018 BEFORE INSERT ON auth.acesso FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5164 (class 2620 OID 18076)
-- Name: acesso sync_branch_map_before_update_on_auth_acesso_894121; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_auth_acesso_894121 BEFORE UPDATE ON auth.acesso FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5169 (class 2620 OID 18077)
-- Name: filter __tg_before_create_filter; Type: TRIGGER; Schema: cluster; Owner: -
--

CREATE TRIGGER __tg_before_create_filter BEFORE INSERT ON cluster.filter FOR EACH ROW EXECUTE FUNCTION cluster.__tg_before_create_filter();


--
-- TOC entry 5170 (class 2620 OID 18078)
-- Name: share cluster_share_map; Type: TRIGGER; Schema: cluster; Owner: -
--

CREATE TRIGGER cluster_share_map BEFORE INSERT OR DELETE OR UPDATE ON cluster.share FOR EACH ROW EXECUTE FUNCTION cluster.__tg_share_map();


--
-- TOC entry 5127 (class 2620 OID 19687)
-- Name: branch cluster_version_add_change_after_insert_on_cluster_branch_86599; Type: TRIGGER; Schema: cluster; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_insert_on_cluster_branch_86599 AFTER INSERT ON cluster.branch FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_insert();


--
-- TOC entry 5128 (class 2620 OID 18092)
-- Name: branch cluster_version_add_change_after_insert_on_tweeks_branch_248909; Type: TRIGGER; Schema: cluster; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_insert_on_tweeks_branch_248909 AFTER INSERT ON cluster.branch FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_insert();


--
-- TOC entry 5129 (class 2620 OID 19689)
-- Name: branch cluster_version_add_change_after_update_on_cluster_branch_37843; Type: TRIGGER; Schema: cluster; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_update_on_cluster_branch_37843 AFTER UPDATE ON cluster.branch FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_update();


--
-- TOC entry 5130 (class 2620 OID 18124)
-- Name: branch cluster_version_add_change_after_update_on_tweeks_branch_741787; Type: TRIGGER; Schema: cluster; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_update_on_tweeks_branch_741787 AFTER UPDATE ON cluster.branch FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_update();


--
-- TOC entry 5131 (class 2620 OID 19688)
-- Name: branch cluster_version_commit_change_insert_on_cluster_branch_953907; Type: TRIGGER; Schema: cluster; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_insert_on_cluster_branch_953907 AFTER INSERT ON cluster.branch FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5132 (class 2620 OID 18156)
-- Name: branch cluster_version_commit_change_insert_on_tweeks_branch_452421; Type: TRIGGER; Schema: cluster; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_insert_on_tweeks_branch_452421 AFTER INSERT ON cluster.branch FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5133 (class 2620 OID 19690)
-- Name: branch cluster_version_commit_change_update_on_cluster_branch_185443; Type: TRIGGER; Schema: cluster; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_update_on_cluster_branch_185443 AFTER UPDATE ON cluster.branch FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5134 (class 2620 OID 18188)
-- Name: branch cluster_version_commit_change_update_on_tweeks_branch_190349; Type: TRIGGER; Schema: cluster; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_update_on_tweeks_branch_190349 AFTER UPDATE ON cluster.branch FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5171 (class 2620 OID 18083)
-- Name: share tg_share_check; Type: TRIGGER; Schema: cluster; Owner: -
--

CREATE TRIGGER tg_share_check BEFORE INSERT OR UPDATE ON cluster.share FOR EACH ROW EXECUTE FUNCTION cluster.__tg_share_check();


--
-- TOC entry 5172 (class 2620 OID 18084)
-- Name: share tg_share_truncate; Type: TRIGGER; Schema: cluster; Owner: -
--

CREATE TRIGGER tg_share_truncate AFTER TRUNCATE ON cluster.share FOR EACH STATEMENT EXECUTE FUNCTION cluster.__tg_share_truncate();


--
-- TOC entry 5220 (class 2620 OID 19684)
-- Name: entryset sync_trigger; Type: TRIGGER; Schema: libdom; Owner: -
--

CREATE TRIGGER sync_trigger AFTER INSERT OR DELETE OR UPDATE ON libdom.entryset FOR EACH ROW EXECUTE FUNCTION libdom.trigger_sync_entry();


--
-- TOC entry 5221 (class 2620 OID 19685)
-- Name: domsync trigger_sync_domsync; Type: TRIGGER; Schema: libdom; Owner: -
--

CREATE TRIGGER trigger_sync_domsync AFTER INSERT OR UPDATE ON libdom.domsync FOR EACH ROW EXECUTE FUNCTION libdom.trigger_sync_domsync();


--
-- TOC entry 5222 (class 2620 OID 19941)
-- Name: report tg_report_format; Type: TRIGGER; Schema: report; Owner: -
--

CREATE TRIGGER tg_report_format BEFORE INSERT OR UPDATE ON report.report FOR EACH ROW EXECUTE FUNCTION report.____tg_report_format();


--
-- TOC entry 5141 (class 2620 OID 18086)
-- Name: classe __tg_before_update_classe; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER __tg_before_update_classe BEFORE INSERT OR UPDATE ON tweeks.classe FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_before_update_classe();


--
-- TOC entry 5144 (class 2620 OID 18087)
-- Name: conta __tg_create_lancamento; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER __tg_create_lancamento AFTER UPDATE ON tweeks.conta FOR EACH ROW WHEN (((new.conta_estado <> old.conta_estado) AND (new.conta_estado = (map.constant()).maguita_conta_estado_fechado))) EXECUTE FUNCTION tweeks.__tg_create_lancamento();


--
-- TOC entry 5178 (class 2620 OID 18088)
-- Name: deposito __tg_create_lancamento; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER __tg_create_lancamento AFTER INSERT ON tweeks.deposito FOR EACH ROW EXECUTE FUNCTION tweeks.__tg_create_lancamento();


--
-- TOC entry 5116 (class 2620 OID 18103)
-- Name: espaco cluster_version_add_change_after_insert_on_tweeks_espaco_297678; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_insert_on_tweeks_espaco_297678 AFTER INSERT ON tweeks.espaco FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_insert();


--
-- TOC entry 5209 (class 2620 OID 18117)
-- Name: trabalha cluster_version_add_change_after_insert_on_tweeks_trabalha_7237; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_insert_on_tweeks_trabalha_7237 AFTER INSERT ON tweeks.trabalha FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_insert();


--
-- TOC entry 5117 (class 2620 OID 18135)
-- Name: espaco cluster_version_add_change_after_update_on_tweeks_espaco_177136; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_update_on_tweeks_espaco_177136 AFTER UPDATE ON tweeks.espaco FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_update();


--
-- TOC entry 5210 (class 2620 OID 18149)
-- Name: trabalha cluster_version_add_change_after_update_on_tweeks_trabalha_4074; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER cluster_version_add_change_after_update_on_tweeks_trabalha_4074 AFTER UPDATE ON tweeks.trabalha FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_add_when_update();


--
-- TOC entry 5218 (class 2620 OID 19691)
-- Name: branch cluster_version_commit_change_insert_on_tweeks_branch_417147; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_insert_on_tweeks_branch_417147 AFTER INSERT ON tweeks.branch FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5118 (class 2620 OID 18167)
-- Name: espaco cluster_version_commit_change_insert_on_tweeks_espaco_656816; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_insert_on_tweeks_espaco_656816 AFTER INSERT ON tweeks.espaco FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5211 (class 2620 OID 18181)
-- Name: trabalha cluster_version_commit_change_insert_on_tweeks_trabalha_885890; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_insert_on_tweeks_trabalha_885890 AFTER INSERT ON tweeks.trabalha FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5219 (class 2620 OID 19692)
-- Name: branch cluster_version_commit_change_update_on_tweeks_branch_763687; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_update_on_tweeks_branch_763687 AFTER UPDATE ON tweeks.branch FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5119 (class 2620 OID 18199)
-- Name: espaco cluster_version_commit_change_update_on_tweeks_espaco_329179; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_update_on_tweeks_espaco_329179 AFTER UPDATE ON tweeks.espaco FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5212 (class 2620 OID 18213)
-- Name: trabalha cluster_version_commit_change_update_on_tweeks_trabalha_819866; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER cluster_version_commit_change_update_on_tweeks_trabalha_819866 AFTER UPDATE ON tweeks.trabalha FOR EACH STATEMENT WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION cluster.__tg_version_commit();


--
-- TOC entry 5187 (class 2620 OID 18217)
-- Name: acerto sync_branch_map_before_insert_on_tweeks_acerto_687943; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_acerto_687943 BEFORE INSERT ON tweeks.acerto FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5190 (class 2620 OID 18218)
-- Name: aloca sync_branch_map_before_insert_on_tweeks_aloca_545021; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_aloca_545021 BEFORE INSERT ON tweeks.aloca FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5137 (class 2620 OID 18219)
-- Name: artigo sync_branch_map_before_insert_on_tweeks_artigo_940916; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_artigo_940916 BEFORE INSERT ON tweeks.artigo FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5139 (class 2620 OID 18220)
-- Name: caixa sync_branch_map_before_insert_on_tweeks_caixa_609494; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_caixa_609494 BEFORE INSERT ON tweeks.caixa FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5192 (class 2620 OID 18221)
-- Name: cambio sync_branch_map_before_insert_on_tweeks_cambio_189868; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_cambio_189868 BEFORE INSERT ON tweeks.cambio FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5142 (class 2620 OID 18222)
-- Name: classe sync_branch_map_before_insert_on_tweeks_classe_872014; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_classe_872014 BEFORE INSERT ON tweeks.classe FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5176 (class 2620 OID 18223)
-- Name: cliente sync_branch_map_before_insert_on_tweeks_cliente_226963; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_cliente_226963 BEFORE INSERT ON tweeks.cliente FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5145 (class 2620 OID 18224)
-- Name: conta sync_branch_map_before_insert_on_tweeks_conta_738120; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_conta_738120 BEFORE INSERT ON tweeks.conta FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5194 (class 2620 OID 18225)
-- Name: custoguia sync_branch_map_before_insert_on_tweeks_custoguia_210607; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_custoguia_210607 BEFORE INSERT ON tweeks.custoguia FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5179 (class 2620 OID 18226)
-- Name: deposito sync_branch_map_before_insert_on_tweeks_deposito_491653; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_deposito_491653 BEFORE INSERT ON tweeks.deposito FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5196 (class 2620 OID 18227)
-- Name: dispoe sync_branch_map_before_insert_on_tweeks_dispoe_585090; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_dispoe_585090 BEFORE INSERT ON tweeks.dispoe FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5198 (class 2620 OID 18228)
-- Name: ean sync_branch_map_before_insert_on_tweeks_ean_784645; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_ean_784645 BEFORE INSERT ON tweeks.ean FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5173 (class 2620 OID 18229)
-- Name: entrada sync_branch_map_before_insert_on_tweeks_entrada_347466; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_entrada_347466 BEFORE INSERT ON tweeks.entrada FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5183 (class 2620 OID 18230)
-- Name: fluxo sync_branch_map_before_insert_on_tweeks_fluxo_818979; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_fluxo_818979 BEFORE INSERT ON tweeks.fluxo FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5200 (class 2620 OID 18231)
-- Name: fornecedor sync_branch_map_before_insert_on_tweeks_fornecedor_170298; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_fornecedor_170298 BEFORE INSERT ON tweeks.fornecedor FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5157 (class 2620 OID 18232)
-- Name: guia sync_branch_map_before_insert_on_tweeks_guia_487881; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_guia_487881 BEFORE INSERT ON tweeks.guia FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5202 (class 2620 OID 18233)
-- Name: imposto sync_branch_map_before_insert_on_tweeks_imposto_157782; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_imposto_157782 BEFORE INSERT ON tweeks.imposto FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5204 (class 2620 OID 18234)
-- Name: impostovenda sync_branch_map_before_insert_on_tweeks_impostovenda_524654; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_impostovenda_524654 BEFORE INSERT ON tweeks.impostovenda FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5181 (class 2620 OID 18235)
-- Name: lancamento sync_branch_map_before_insert_on_tweeks_lancamento_151818; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_lancamento_151818 BEFORE INSERT ON tweeks.lancamento FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5148 (class 2620 OID 18236)
-- Name: link sync_branch_map_before_insert_on_tweeks_link_581810; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_link_581810 BEFORE INSERT ON tweeks.link FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5120 (class 2620 OID 18237)
-- Name: movimento sync_branch_map_before_insert_on_tweeks_movimento_501528; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_movimento_501528 BEFORE INSERT ON tweeks.movimento FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5150 (class 2620 OID 18238)
-- Name: posto sync_branch_map_before_insert_on_tweeks_posto_770458; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_posto_770458 BEFORE INSERT ON tweeks.posto FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5206 (class 2620 OID 18239)
-- Name: retalho sync_branch_map_before_insert_on_tweeks_retalho_881257; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_retalho_881257 BEFORE INSERT ON tweeks.retalho FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5135 (class 2620 OID 18240)
-- Name: serie sync_branch_map_before_insert_on_tweeks_serie_174114; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_serie_174114 BEFORE INSERT ON tweeks.serie FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5122 (class 2620 OID 18241)
-- Name: taxa sync_branch_map_before_insert_on_tweeks_taxa_484021; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_taxa_484021 BEFORE INSERT ON tweeks.taxa FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5185 (class 2620 OID 18242)
-- Name: tipoimposto sync_branch_map_before_insert_on_tweeks_tipoimposto_816325; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_tipoimposto_816325 BEFORE INSERT ON tweeks.tipoimposto FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5213 (class 2620 OID 18243)
-- Name: trabalha sync_branch_map_before_insert_on_tweeks_trabalha_490105; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_trabalha_490105 BEFORE INSERT ON tweeks.trabalha FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5124 (class 2620 OID 18244)
-- Name: transacao sync_branch_map_before_insert_on_tweeks_transacao_213897; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_transacao_213897 BEFORE INSERT ON tweeks.transacao FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5215 (class 2620 OID 18245)
-- Name: transferencia sync_branch_map_before_insert_on_tweeks_transferencia_472244; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_transferencia_472244 BEFORE INSERT ON tweeks.transferencia FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5152 (class 2620 OID 18246)
-- Name: venda sync_branch_map_before_insert_on_tweeks_venda_113044; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_insert_on_tweeks_venda_113044 BEFORE INSERT ON tweeks.venda FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5188 (class 2620 OID 18247)
-- Name: acerto sync_branch_map_before_update_on_tweeks_acerto_440580; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_acerto_440580 BEFORE UPDATE ON tweeks.acerto FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5191 (class 2620 OID 18248)
-- Name: aloca sync_branch_map_before_update_on_tweeks_aloca_299370; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_aloca_299370 BEFORE UPDATE ON tweeks.aloca FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5138 (class 2620 OID 18249)
-- Name: artigo sync_branch_map_before_update_on_tweeks_artigo_716909; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_artigo_716909 BEFORE UPDATE ON tweeks.artigo FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5140 (class 2620 OID 18250)
-- Name: caixa sync_branch_map_before_update_on_tweeks_caixa_318184; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_caixa_318184 BEFORE UPDATE ON tweeks.caixa FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5193 (class 2620 OID 18251)
-- Name: cambio sync_branch_map_before_update_on_tweeks_cambio_826027; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_cambio_826027 BEFORE UPDATE ON tweeks.cambio FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5143 (class 2620 OID 18252)
-- Name: classe sync_branch_map_before_update_on_tweeks_classe_800703; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_classe_800703 BEFORE UPDATE ON tweeks.classe FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5177 (class 2620 OID 18253)
-- Name: cliente sync_branch_map_before_update_on_tweeks_cliente_313700; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_cliente_313700 BEFORE UPDATE ON tweeks.cliente FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5146 (class 2620 OID 18254)
-- Name: conta sync_branch_map_before_update_on_tweeks_conta_797518; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_conta_797518 BEFORE UPDATE ON tweeks.conta FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5195 (class 2620 OID 18255)
-- Name: custoguia sync_branch_map_before_update_on_tweeks_custoguia_931555; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_custoguia_931555 BEFORE UPDATE ON tweeks.custoguia FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5180 (class 2620 OID 18256)
-- Name: deposito sync_branch_map_before_update_on_tweeks_deposito_927162; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_deposito_927162 BEFORE UPDATE ON tweeks.deposito FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5197 (class 2620 OID 18257)
-- Name: dispoe sync_branch_map_before_update_on_tweeks_dispoe_291390; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_dispoe_291390 BEFORE UPDATE ON tweeks.dispoe FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5199 (class 2620 OID 18258)
-- Name: ean sync_branch_map_before_update_on_tweeks_ean_965869; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_ean_965869 BEFORE UPDATE ON tweeks.ean FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5174 (class 2620 OID 18259)
-- Name: entrada sync_branch_map_before_update_on_tweeks_entrada_898229; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_entrada_898229 BEFORE UPDATE ON tweeks.entrada FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5184 (class 2620 OID 18260)
-- Name: fluxo sync_branch_map_before_update_on_tweeks_fluxo_335984; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_fluxo_335984 BEFORE UPDATE ON tweeks.fluxo FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5201 (class 2620 OID 18261)
-- Name: fornecedor sync_branch_map_before_update_on_tweeks_fornecedor_355190; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_fornecedor_355190 BEFORE UPDATE ON tweeks.fornecedor FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5158 (class 2620 OID 18262)
-- Name: guia sync_branch_map_before_update_on_tweeks_guia_829296; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_guia_829296 BEFORE UPDATE ON tweeks.guia FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5203 (class 2620 OID 18263)
-- Name: imposto sync_branch_map_before_update_on_tweeks_imposto_311584; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_imposto_311584 BEFORE UPDATE ON tweeks.imposto FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5205 (class 2620 OID 18264)
-- Name: impostovenda sync_branch_map_before_update_on_tweeks_impostovenda_456497; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_impostovenda_456497 BEFORE UPDATE ON tweeks.impostovenda FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5182 (class 2620 OID 18265)
-- Name: lancamento sync_branch_map_before_update_on_tweeks_lancamento_531885; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_lancamento_531885 BEFORE UPDATE ON tweeks.lancamento FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5149 (class 2620 OID 18266)
-- Name: link sync_branch_map_before_update_on_tweeks_link_698125; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_link_698125 BEFORE UPDATE ON tweeks.link FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5121 (class 2620 OID 18267)
-- Name: movimento sync_branch_map_before_update_on_tweeks_movimento_178685; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_movimento_178685 BEFORE UPDATE ON tweeks.movimento FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5151 (class 2620 OID 18268)
-- Name: posto sync_branch_map_before_update_on_tweeks_posto_103596; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_posto_103596 BEFORE UPDATE ON tweeks.posto FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5207 (class 2620 OID 18269)
-- Name: retalho sync_branch_map_before_update_on_tweeks_retalho_993293; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_retalho_993293 BEFORE UPDATE ON tweeks.retalho FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5136 (class 2620 OID 18270)
-- Name: serie sync_branch_map_before_update_on_tweeks_serie_628940; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_serie_628940 BEFORE UPDATE ON tweeks.serie FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5123 (class 2620 OID 18271)
-- Name: taxa sync_branch_map_before_update_on_tweeks_taxa_698634; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_taxa_698634 BEFORE UPDATE ON tweeks.taxa FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5186 (class 2620 OID 18272)
-- Name: tipoimposto sync_branch_map_before_update_on_tweeks_tipoimposto_504064; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_tipoimposto_504064 BEFORE UPDATE ON tweeks.tipoimposto FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5214 (class 2620 OID 18273)
-- Name: trabalha sync_branch_map_before_update_on_tweeks_trabalha_583304; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_trabalha_583304 BEFORE UPDATE ON tweeks.trabalha FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5125 (class 2620 OID 18274)
-- Name: transacao sync_branch_map_before_update_on_tweeks_transacao_955905; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_transacao_955905 BEFORE UPDATE ON tweeks.transacao FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5216 (class 2620 OID 18275)
-- Name: transferencia sync_branch_map_before_update_on_tweeks_transferencia_792134; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_transferencia_792134 BEFORE UPDATE ON tweeks.transferencia FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5153 (class 2620 OID 18276)
-- Name: venda sync_branch_map_before_update_on_tweeks_venda_933320; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER sync_branch_map_before_update_on_tweeks_venda_933320 BEFORE UPDATE ON tweeks.venda FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_use_branch();


--
-- TOC entry 5147 (class 2620 OID 18277)
-- Name: conta tg_conta_after_close; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER tg_conta_after_close AFTER UPDATE ON tweeks.conta FOR EACH ROW WHEN (((new.conta_estado <> old.conta_estado) AND map.any_equal(new.conta_estado, VARIADIC ARRAY['maguita_conta_estado_fechado'::name, 'maguita_conta_estado_anulado'::name]) AND (NOT cluster.__is_replication()))) EXECUTE FUNCTION tweeks.__tg_conta_after_close();


--
-- TOC entry 5189 (class 2620 OID 18278)
-- Name: acerto tg_fluxo_on_acerto; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER tg_fluxo_on_acerto AFTER INSERT ON tweeks.acerto FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_fluxo_on_acerto();


--
-- TOC entry 5175 (class 2620 OID 18279)
-- Name: entrada tg_fluxo_on_entrada; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER tg_fluxo_on_entrada AFTER INSERT ON tweeks.entrada FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_fluxo_on_entrada();


--
-- TOC entry 5208 (class 2620 OID 18280)
-- Name: retalho tg_fluxo_on_retalho; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER tg_fluxo_on_retalho AFTER INSERT ON tweeks.retalho FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_fluxo_on_retalho();


--
-- TOC entry 5217 (class 2620 OID 18281)
-- Name: transferencia tg_fluxo_on_transferencia; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER tg_fluxo_on_transferencia AFTER INSERT ON tweeks.transferencia FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_fluxo_on_transferencia();


--
-- TOC entry 5154 (class 2620 OID 19830)
-- Name: venda tg_fluxo_on_venda_sets; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER tg_fluxo_on_venda_sets AFTER INSERT OR UPDATE ON tweeks.venda FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_fluxo_on_venda();


--
-- TOC entry 5126 (class 2620 OID 18284)
-- Name: transacao tg_transacao_after_insert_adjust_posto_montante; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER tg_transacao_after_insert_adjust_posto_montante AFTER INSERT ON tweeks.transacao FOR EACH ROW EXECUTE FUNCTION rule.tg_transacao_after_insert_adjust_posto_montante();


--
-- TOC entry 5155 (class 2620 OID 19833)
-- Name: venda tg_venda_before_check; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER tg_venda_before_check AFTER INSERT OR UPDATE ON tweeks.venda FOR EACH ROW EXECUTE FUNCTION tweeks.__tg_venda_before_check();


--
-- TOC entry 5156 (class 2620 OID 19831)
-- Name: venda tg_venda_before_sets; Type: TRIGGER; Schema: tweeks; Owner: -
--

CREATE TRIGGER tg_venda_before_sets AFTER INSERT OR UPDATE ON tweeks.venda FOR EACH ROW WHEN ((NOT cluster.__is_replication())) EXECUTE FUNCTION tweeks.__tg_venda_before_sets();


--
-- TOC entry 5002 (class 2606 OID 18285)
-- Name: acesso fk_acesso_to_colaborador; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.acesso
    ADD CONSTRAINT fk_acesso_to_colaborador FOREIGN KEY (acesso_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5003 (class 2606 OID 18290)
-- Name: acesso fk_acesso_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.acesso
    ADD CONSTRAINT fk_acesso_to_colaborador_atualizacao FOREIGN KEY (acesso_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5004 (class 2606 OID 18295)
-- Name: acesso fk_acesso_to_colaborador_propetario; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.acesso
    ADD CONSTRAINT fk_acesso_to_colaborador_propetario FOREIGN KEY (acesso_colaborador_propetario) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5005 (class 2606 OID 19413)
-- Name: acesso fk_acesso_to_menu; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.acesso
    ADD CONSTRAINT fk_acesso_to_menu FOREIGN KEY (acesso_menu_id) REFERENCES auth.menu(menu_id);


--
-- TOC entry 5006 (class 2606 OID 18305)
-- Name: autenticacao fk_autenticacao_to_colaborador; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.autenticacao
    ADD CONSTRAINT fk_autenticacao_to_colaborador FOREIGN KEY (autenticacao_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4935 (class 2606 OID 18310)
-- Name: colaborador fk_colaborador_to_colaborador; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.colaborador
    ADD CONSTRAINT fk_colaborador_to_colaborador FOREIGN KEY (colaborador_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4936 (class 2606 OID 18315)
-- Name: colaborador fk_colaborador_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.colaborador
    ADD CONSTRAINT fk_colaborador_to_colaborador_atualizacao FOREIGN KEY (colaborador_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4937 (class 2606 OID 18320)
-- Name: colaborador fk_colaborador_to_tsexo; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.colaborador
    ADD CONSTRAINT fk_colaborador_to_tsexo FOREIGN KEY (colaborador_tsexo_id) REFERENCES auth.tsexo(tsexo_id);


--
-- TOC entry 4961 (class 2606 OID 19408)
-- Name: menu fk_menu_to_menu; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.menu
    ADD CONSTRAINT fk_menu_to_menu FOREIGN KEY (menu_menu_id) REFERENCES auth.menu(menu_id);


--
-- TOC entry 4938 (class 2606 OID 18325)
-- Name: perfil fk_perfil_to_colaborador; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.perfil
    ADD CONSTRAINT fk_perfil_to_colaborador FOREIGN KEY (perfil_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4939 (class 2606 OID 18330)
-- Name: perfil fk_perfil_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.perfil
    ADD CONSTRAINT fk_perfil_to_colaborador_atualizacao FOREIGN KEY (perfil_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4940 (class 2606 OID 18335)
-- Name: perfil fk_perfil_to_perfil; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.perfil
    ADD CONSTRAINT fk_perfil_to_perfil FOREIGN KEY (perfil_perfil_id) REFERENCES auth.perfil(perfil_id);


--
-- TOC entry 5007 (class 2606 OID 18340)
-- Name: privilegio fk_privilegio_to_colaborador; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.privilegio
    ADD CONSTRAINT fk_privilegio_to_colaborador FOREIGN KEY (privilegio_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5008 (class 2606 OID 18345)
-- Name: privilegio fk_privilegio_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.privilegio
    ADD CONSTRAINT fk_privilegio_to_colaborador_atualizacao FOREIGN KEY (privilegio_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5009 (class 2606 OID 19418)
-- Name: privilegio fk_privilegio_to_menu; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.privilegio
    ADD CONSTRAINT fk_privilegio_to_menu FOREIGN KEY (privilegio_menu_id) REFERENCES auth.menu(menu_id);


--
-- TOC entry 5010 (class 2606 OID 18355)
-- Name: privilegio fk_privilegio_to_perfil; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.privilegio
    ADD CONSTRAINT fk_privilegio_to_perfil FOREIGN KEY (previlegio_perfil_id) REFERENCES auth.perfil(perfil_id);


--
-- TOC entry 5103 (class 2606 OID 19562)
-- Name: auth fk_auth_to_cluster; Type: FK CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.auth
    ADD CONSTRAINT fk_auth_to_cluster FOREIGN KEY (auth_cluster_uid) REFERENCES cluster.cluster(cluster_uid);


--
-- TOC entry 4941 (class 2606 OID 18370)
-- Name: version fk_version_to_cluster; Type: FK CONSTRAINT; Schema: cluster; Owner: -
--

ALTER TABLE ONLY cluster.version
    ADD CONSTRAINT fk_version_to_cluster FOREIGN KEY (version_cluster_id) REFERENCES cluster.cluster(cluster_uid);


--
-- TOC entry 5011 (class 2606 OID 18380)
-- Name: altspelling fk_altspelling_to_country; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.altspelling
    ADD CONSTRAINT fk_altspelling_to_country FOREIGN KEY (altspelling_country_id) REFERENCES geoinfo.country(country_id) ON DELETE CASCADE;


--
-- TOC entry 5017 (class 2606 OID 18385)
-- Name: countrycallcode fk_callcode_to_country; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrycallcode
    ADD CONSTRAINT fk_callcode_to_country FOREIGN KEY (countrycallcode_country_id) REFERENCES geoinfo.country(country_id) ON DELETE CASCADE;


--
-- TOC entry 5012 (class 2606 OID 18390)
-- Name: country fk_country_to_demonym; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.country
    ADD CONSTRAINT fk_country_to_demonym FOREIGN KEY (country_demonym_id) REFERENCES geoinfo.demonym(demonym_id) ON DELETE CASCADE;


--
-- TOC entry 5013 (class 2606 OID 18395)
-- Name: country fk_country_to_region; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.country
    ADD CONSTRAINT fk_country_to_region FOREIGN KEY (country_region_id) REFERENCES geoinfo.region(region_id) ON DELETE CASCADE;


--
-- TOC entry 5014 (class 2606 OID 18400)
-- Name: country fk_country_to_subregion; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.country
    ADD CONSTRAINT fk_country_to_subregion FOREIGN KEY (country_subregion_id) REFERENCES geoinfo.subregion(subregion_id) ON DELETE CASCADE;


--
-- TOC entry 5015 (class 2606 OID 18405)
-- Name: countryborder fk_countryborder_to_border; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countryborder
    ADD CONSTRAINT fk_countryborder_to_border FOREIGN KEY (countryborder_country_broder) REFERENCES geoinfo.country(country_id) ON DELETE CASCADE;


--
-- TOC entry 5016 (class 2606 OID 18410)
-- Name: countryborder fk_countryborder_to_country; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countryborder
    ADD CONSTRAINT fk_countryborder_to_country FOREIGN KEY (countryborder_country_id) REFERENCES geoinfo.country(country_id) ON DELETE CASCADE;


--
-- TOC entry 5018 (class 2606 OID 18415)
-- Name: countrycurrency fk_countrycurrency_to_country; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrycurrency
    ADD CONSTRAINT fk_countrycurrency_to_country FOREIGN KEY (countrycurrency_country_id) REFERENCES geoinfo.country(country_id) ON DELETE CASCADE;


--
-- TOC entry 5019 (class 2606 OID 18420)
-- Name: countrycurrency fk_countrycurrency_to_currency; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrycurrency
    ADD CONSTRAINT fk_countrycurrency_to_currency FOREIGN KEY (countrycurrency_currency_id) REFERENCES geoinfo.currency(currency_id) ON DELETE CASCADE;


--
-- TOC entry 5020 (class 2606 OID 18425)
-- Name: countrylanguage fk_countrylanguage_to_country; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrylanguage
    ADD CONSTRAINT fk_countrylanguage_to_country FOREIGN KEY (countrylanguage_country_id) REFERENCES geoinfo.country(country_id) ON DELETE CASCADE;


--
-- TOC entry 5021 (class 2606 OID 18430)
-- Name: countrylanguage fk_countrylanguage_to_language; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrylanguage
    ADD CONSTRAINT fk_countrylanguage_to_language FOREIGN KEY (countrylanguage_language_id) REFERENCES geoinfo.language(language_id);


--
-- TOC entry 5022 (class 2606 OID 18435)
-- Name: countryregionalbloc fk_countryregionalbloc_to_country; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countryregionalbloc
    ADD CONSTRAINT fk_countryregionalbloc_to_country FOREIGN KEY (countryregionalbloc_country_id) REFERENCES geoinfo.country(country_id) ON DELETE CASCADE;


--
-- TOC entry 5023 (class 2606 OID 18440)
-- Name: countryregionalbloc fk_countryregionalbloc_to_regionalbloc; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countryregionalbloc
    ADD CONSTRAINT fk_countryregionalbloc_to_regionalbloc FOREIGN KEY (countryregionalbloc_regionalbloc_id) REFERENCES geoinfo.regionalbloc(regionalbloc_id) ON DELETE CASCADE;


--
-- TOC entry 5024 (class 2606 OID 18445)
-- Name: countrytimezone fk_countrytimezone_to_country; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytimezone
    ADD CONSTRAINT fk_countrytimezone_to_country FOREIGN KEY (countrytimezone_country_id) REFERENCES geoinfo.country(country_id) ON DELETE CASCADE;


--
-- TOC entry 5025 (class 2606 OID 18450)
-- Name: countrytimezone fk_countrytimezone_to_timezone; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytimezone
    ADD CONSTRAINT fk_countrytimezone_to_timezone FOREIGN KEY (countrytimezone_timezone_id) REFERENCES geoinfo.timezone(timezone_id) ON DELETE CASCADE;


--
-- TOC entry 5026 (class 2606 OID 18455)
-- Name: countrytopleveldomain fk_countrytopleveldomain_to_country; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytopleveldomain
    ADD CONSTRAINT fk_countrytopleveldomain_to_country FOREIGN KEY (countrytopleveldomain_country_id) REFERENCES geoinfo.country(country_id) ON DELETE CASCADE;


--
-- TOC entry 5027 (class 2606 OID 18460)
-- Name: countrytopleveldomain fk_countrytopleveldomain_to_domain; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytopleveldomain
    ADD CONSTRAINT fk_countrytopleveldomain_to_domain FOREIGN KEY (countrytopleveldomain_domain_id) REFERENCES geoinfo.domain(domain_id) ON DELETE CASCADE;


--
-- TOC entry 5028 (class 2606 OID 18465)
-- Name: countrytranslation fk_countrytranslation_to_country; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytranslation
    ADD CONSTRAINT fk_countrytranslation_to_country FOREIGN KEY (countrytranslation_country_id) REFERENCES geoinfo.country(country_id) ON DELETE CASCADE;


--
-- TOC entry 5029 (class 2606 OID 18470)
-- Name: countrytranslation fk_countrytranslation_to_language; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.countrytranslation
    ADD CONSTRAINT fk_countrytranslation_to_language FOREIGN KEY (countrytranslation_language_id) REFERENCES geoinfo.language(language_id) ON DELETE CASCADE;


--
-- TOC entry 5030 (class 2606 OID 18475)
-- Name: regionalblocname fk_regionalblocname_to_regionalbloc; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.regionalblocname
    ADD CONSTRAINT fk_regionalblocname_to_regionalbloc FOREIGN KEY (regionalblocname_regionalbloc_id) REFERENCES geoinfo.regionalbloc(regionalbloc_id) ON DELETE CASCADE;


--
-- TOC entry 5031 (class 2606 OID 18480)
-- Name: regionalblocother fk_regionalblocother_to_regionalbloc; Type: FK CONSTRAINT; Schema: geoinfo; Owner: -
--

ALTER TABLE ONLY geoinfo.regionalblocother
    ADD CONSTRAINT fk_regionalblocother_to_regionalbloc FOREIGN KEY (regionalblocother_regionalbloc_id) REFERENCES geoinfo.regionalbloc(regionalbloc_id) ON DELETE CASCADE;


--
-- TOC entry 5102 (class 2606 OID 19490)
-- Name: revision fk_revision_to_raw; Type: FK CONSTRAINT; Schema: patch; Owner: -
--

ALTER TABLE ONLY patch.revision
    ADD CONSTRAINT fk_revision_to_raw FOREIGN KEY (_raw_uid) REFERENCES patch.raw(raw_uid);


--
-- TOC entry 5105 (class 2606 OID 19792)
-- Name: filter filter_filter_parametrized_uid_fkey; Type: FK CONSTRAINT; Schema: report; Owner: -
--

ALTER TABLE ONLY report.filter
    ADD CONSTRAINT filter_filter_parametrized_uid_fkey FOREIGN KEY (filter_parametrized_uid) REFERENCES report.parametrized(parametrized_uid);


--
-- TOC entry 4973 (class 2606 OID 18485)
-- Name: classe classe_classe_classe_id_fk; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.classe
    ADD CONSTRAINT classe_classe_classe_id_fk FOREIGN KEY (classe_classe_id) REFERENCES tweeks.classe(classe_id);


--
-- TOC entry 5060 (class 2606 OID 18490)
-- Name: acerto fk_acerto_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.acerto
    ADD CONSTRAINT fk_acerto_to_colaborador FOREIGN KEY (acerto_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5061 (class 2606 OID 18495)
-- Name: acerto fk_acerto_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.acerto
    ADD CONSTRAINT fk_acerto_to_espaco_auth FOREIGN KEY (acerto_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5062 (class 2606 OID 18500)
-- Name: aloca fk_aloca_to_espaco; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.aloca
    ADD CONSTRAINT fk_aloca_to_espaco FOREIGN KEY (aloca_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5063 (class 2606 OID 18505)
-- Name: aloca fk_aloca_to_espaco_destino; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.aloca
    ADD CONSTRAINT fk_aloca_to_espaco_destino FOREIGN KEY (aloca_espaco_destino) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5064 (class 2606 OID 18510)
-- Name: aloca fk_aloca_to_posto; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.aloca
    ADD CONSTRAINT fk_aloca_to_posto FOREIGN KEY (aloca_posto_id) REFERENCES tweeks.posto(posto_id);


--
-- TOC entry 5038 (class 2606 OID 18515)
-- Name: deposito fk_amortizacao_to_caixa; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.deposito
    ADD CONSTRAINT fk_amortizacao_to_caixa FOREIGN KEY (deposito_caixa_id) REFERENCES tweeks.caixa(caixa_id);


--
-- TOC entry 5039 (class 2606 OID 18520)
-- Name: deposito fk_amortizacao_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.deposito
    ADD CONSTRAINT fk_amortizacao_to_colaborador FOREIGN KEY (deposito_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5040 (class 2606 OID 18525)
-- Name: deposito fk_amortizacao_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.deposito
    ADD CONSTRAINT fk_amortizacao_to_colaborador_atualizacao FOREIGN KEY (deposito_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5041 (class 2606 OID 18530)
-- Name: deposito fk_amortizacao_to_currency; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.deposito
    ADD CONSTRAINT fk_amortizacao_to_currency FOREIGN KEY (deposito_currency_id) REFERENCES geoinfo.currency(currency_id);


--
-- TOC entry 5042 (class 2606 OID 18535)
-- Name: deposito fk_amortizacao_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.deposito
    ADD CONSTRAINT fk_amortizacao_to_espaco_auth FOREIGN KEY (deposito_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5043 (class 2606 OID 18540)
-- Name: deposito fk_amortizacao_to_tpaga; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.deposito
    ADD CONSTRAINT fk_amortizacao_to_tpaga FOREIGN KEY (deposito_tpaga_id) REFERENCES tweeks.tpaga(tpaga_id);


--
-- TOC entry 4965 (class 2606 OID 18545)
-- Name: artigo fk_artigo_to_artigo; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.artigo
    ADD CONSTRAINT fk_artigo_to_artigo FOREIGN KEY (artigo_artigo_id) REFERENCES tweeks.artigo(artigo_id);


--
-- TOC entry 4966 (class 2606 OID 18555)
-- Name: artigo fk_artigo_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.artigo
    ADD CONSTRAINT fk_artigo_to_colaborador FOREIGN KEY (artigo_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4967 (class 2606 OID 18560)
-- Name: artigo fk_artigo_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.artigo
    ADD CONSTRAINT fk_artigo_to_colaborador_atualizacao FOREIGN KEY (artigo_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4968 (class 2606 OID 18565)
-- Name: artigo fk_artigo_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.artigo
    ADD CONSTRAINT fk_artigo_to_espaco_auth FOREIGN KEY (artigo_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5104 (class 2606 OID 19703)
-- Name: autorizacao fk_autorizacao_to_espaco; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.autorizacao
    ADD CONSTRAINT fk_autorizacao_to_espaco FOREIGN KEY (autorizacao_espaco_uid) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 4969 (class 2606 OID 18570)
-- Name: caixa fk_caixa_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.caixa
    ADD CONSTRAINT fk_caixa_to_colaborador FOREIGN KEY (caixa_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4970 (class 2606 OID 18575)
-- Name: caixa fk_caixa_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.caixa
    ADD CONSTRAINT fk_caixa_to_colaborador_atualizacao FOREIGN KEY (caixa_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4971 (class 2606 OID 18580)
-- Name: caixa fk_caixa_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.caixa
    ADD CONSTRAINT fk_caixa_to_espaco_auth FOREIGN KEY (caixa_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 4972 (class 2606 OID 18585)
-- Name: caixa fk_caixa_to_posto; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.caixa
    ADD CONSTRAINT fk_caixa_to_posto FOREIGN KEY (caixa_posto_id) REFERENCES tweeks.posto(posto_id);


--
-- TOC entry 5065 (class 2606 OID 18590)
-- Name: cambio fk_cambio_to_currency; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.cambio
    ADD CONSTRAINT fk_cambio_to_currency FOREIGN KEY (cambio_currency_id) REFERENCES geoinfo.currency(currency_id);


--
-- TOC entry 4974 (class 2606 OID 18605)
-- Name: classe fk_classe_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.classe
    ADD CONSTRAINT fk_classe_to_colaborador FOREIGN KEY (classe_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4975 (class 2606 OID 18610)
-- Name: classe fk_classe_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.classe
    ADD CONSTRAINT fk_classe_to_colaborador_atualizacao FOREIGN KEY (classe_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4976 (class 2606 OID 18615)
-- Name: classe fk_classe_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.classe
    ADD CONSTRAINT fk_classe_to_espaco_auth FOREIGN KEY (classe_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5037 (class 2606 OID 18620)
-- Name: cliente fk_cliente_to_tdocumento; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.cliente
    ADD CONSTRAINT fk_cliente_to_tdocumento FOREIGN KEY (cliente_tdocument_id) REFERENCES tweeks.tdocuemto(tdocumento_id);


--
-- TOC entry 4977 (class 2606 OID 18625)
-- Name: conta fk_conta_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.conta
    ADD CONSTRAINT fk_conta_to_colaborador FOREIGN KEY (conta_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4978 (class 2606 OID 18630)
-- Name: conta fk_conta_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.conta
    ADD CONSTRAINT fk_conta_to_colaborador_atualizacao FOREIGN KEY (conta_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4979 (class 2606 OID 19737)
-- Name: conta fk_conta_to_conta_docorigin; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.conta
    ADD CONSTRAINT fk_conta_to_conta_docorigin FOREIGN KEY (conta_conta_docorigin) REFERENCES tweeks.conta(conta_id);


--
-- TOC entry 4980 (class 2606 OID 18635)
-- Name: conta fk_conta_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.conta
    ADD CONSTRAINT fk_conta_to_espaco_auth FOREIGN KEY (conta_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 4981 (class 2606 OID 18640)
-- Name: conta fk_conta_to_posto; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.conta
    ADD CONSTRAINT fk_conta_to_posto FOREIGN KEY (conta_posto_id) REFERENCES tweeks.posto(posto_id);


--
-- TOC entry 4982 (class 2606 OID 18645)
-- Name: conta fk_conta_to_posto_fecho; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.conta
    ADD CONSTRAINT fk_conta_to_posto_fecho FOREIGN KEY (conta_posto_fecho) REFERENCES tweeks.posto(posto_id);


--
-- TOC entry 4983 (class 2606 OID 18650)
-- Name: conta fk_conta_to_serie; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.conta
    ADD CONSTRAINT fk_conta_to_serie FOREIGN KEY (conta_serie_id) REFERENCES tweeks.serie(serie_id);


--
-- TOC entry 4984 (class 2606 OID 18655)
-- Name: conta fk_conto_to_cliente; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.conta
    ADD CONSTRAINT fk_conto_to_cliente FOREIGN KEY (conta_cliente_id) REFERENCES tweeks.cliente(cliente_id);


--
-- TOC entry 5066 (class 2606 OID 18660)
-- Name: custoguia fk_custo_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.custoguia
    ADD CONSTRAINT fk_custo_to_colaborador FOREIGN KEY (custoguia_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5067 (class 2606 OID 18665)
-- Name: custoguia fk_custo_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.custoguia
    ADD CONSTRAINT fk_custo_to_colaborador_atualizacao FOREIGN KEY (custoguia_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5068 (class 2606 OID 18670)
-- Name: custoguia fk_custo_to_guia; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.custoguia
    ADD CONSTRAINT fk_custo_to_guia FOREIGN KEY (custoguia_guia_uid) REFERENCES tweeks.guia(guia_uid);


--
-- TOC entry 5044 (class 2606 OID 18675)
-- Name: deposito fk_deposito_to_serie; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.deposito
    ADD CONSTRAINT fk_deposito_to_serie FOREIGN KEY (deposito_serie_id) REFERENCES tweeks.serie(serie_id);


--
-- TOC entry 5069 (class 2606 OID 18680)
-- Name: dispoe fk_dispoe_to_artigo; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.dispoe
    ADD CONSTRAINT fk_dispoe_to_artigo FOREIGN KEY (dispoe_artigo_id) REFERENCES tweeks.artigo(artigo_id);


--
-- TOC entry 5070 (class 2606 OID 18685)
-- Name: dispoe fk_dispoe_to_artigo_item; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.dispoe
    ADD CONSTRAINT fk_dispoe_to_artigo_item FOREIGN KEY (dispoe_artigo_item) REFERENCES tweeks.artigo(artigo_id);


--
-- TOC entry 5071 (class 2606 OID 18690)
-- Name: dispoe fk_dispoe_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.dispoe
    ADD CONSTRAINT fk_dispoe_to_colaborador FOREIGN KEY (dispoe_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5072 (class 2606 OID 18695)
-- Name: dispoe fk_dispoe_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.dispoe
    ADD CONSTRAINT fk_dispoe_to_colaborador_atualizacao FOREIGN KEY (dispoe_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5073 (class 2606 OID 18700)
-- Name: dispoe fk_dispoe_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.dispoe
    ADD CONSTRAINT fk_dispoe_to_espaco_auth FOREIGN KEY (dispoe_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5074 (class 2606 OID 18705)
-- Name: ean fk_ean_to_artigo; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.ean
    ADD CONSTRAINT fk_ean_to_artigo FOREIGN KEY (ean_artigo_id) REFERENCES tweeks.artigo(artigo_id);


--
-- TOC entry 5075 (class 2606 OID 18710)
-- Name: ean fk_ean_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.ean
    ADD CONSTRAINT fk_ean_to_espaco_auth FOREIGN KEY (ean_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5032 (class 2606 OID 18715)
-- Name: entrada fk_entrada_to_artigo; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.entrada
    ADD CONSTRAINT fk_entrada_to_artigo FOREIGN KEY (entrada_artigo_id) REFERENCES tweeks.artigo(artigo_id);


--
-- TOC entry 5033 (class 2606 OID 18720)
-- Name: entrada fk_entrada_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.entrada
    ADD CONSTRAINT fk_entrada_to_colaborador FOREIGN KEY (entrada_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5034 (class 2606 OID 18725)
-- Name: entrada fk_entrada_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.entrada
    ADD CONSTRAINT fk_entrada_to_colaborador_atualizacao FOREIGN KEY (entrada_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5035 (class 2606 OID 18730)
-- Name: entrada fk_entrada_to_espaco; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.entrada
    ADD CONSTRAINT fk_entrada_to_espaco FOREIGN KEY (entrada_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5036 (class 2606 OID 18735)
-- Name: entrada fk_entrada_to_espaco_destito; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.entrada
    ADD CONSTRAINT fk_entrada_to_espaco_destito FOREIGN KEY (entrada_espaco_destino) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 4942 (class 2606 OID 18740)
-- Name: espaco fk_espaco_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.espaco
    ADD CONSTRAINT fk_espaco_to_colaborador FOREIGN KEY (espaco_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4943 (class 2606 OID 18745)
-- Name: espaco fk_espaco_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.espaco
    ADD CONSTRAINT fk_espaco_to_colaborador_atualizacao FOREIGN KEY (espaco_colaborador_atualizaco) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4944 (class 2606 OID 18750)
-- Name: espaco fk_espaco_to_espaco; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.espaco
    ADD CONSTRAINT fk_espaco_to_espaco FOREIGN KEY (espaco_espaco_id) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 4945 (class 2606 OID 18755)
-- Name: espaco fk_espaco_to_posto_admin; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.espaco
    ADD CONSTRAINT fk_espaco_to_posto_admin FOREIGN KEY (espaco_posto_admin) REFERENCES tweeks.posto(posto_id);


--
-- TOC entry 5050 (class 2606 OID 18760)
-- Name: fluxo fk_fluxo_to_artigo_in; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fluxo
    ADD CONSTRAINT fk_fluxo_to_artigo_in FOREIGN KEY (fluxo_artigo_in) REFERENCES tweeks.artigo(artigo_id);


--
-- TOC entry 5051 (class 2606 OID 18765)
-- Name: fluxo fk_fluxo_to_artigo_out; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fluxo
    ADD CONSTRAINT fk_fluxo_to_artigo_out FOREIGN KEY (fluxo_artigo_out) REFERENCES tweeks.artigo(artigo_id);


--
-- TOC entry 5052 (class 2606 OID 18770)
-- Name: fluxo fk_fluxo_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fluxo
    ADD CONSTRAINT fk_fluxo_to_colaborador FOREIGN KEY (fluxo_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5053 (class 2606 OID 18775)
-- Name: fluxo fk_fluxo_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fluxo
    ADD CONSTRAINT fk_fluxo_to_colaborador_atualizacao FOREIGN KEY (fluxo_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5054 (class 2606 OID 18780)
-- Name: fluxo fk_fluxo_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fluxo
    ADD CONSTRAINT fk_fluxo_to_espaco_auth FOREIGN KEY (fluxo_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5055 (class 2606 OID 18785)
-- Name: fluxo fk_fluxo_to_espaco_in; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fluxo
    ADD CONSTRAINT fk_fluxo_to_espaco_in FOREIGN KEY (fluxo_espaco_in) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5056 (class 2606 OID 18790)
-- Name: fluxo fk_fluxo_to_espaco_out; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fluxo
    ADD CONSTRAINT fk_fluxo_to_espaco_out FOREIGN KEY (fluxo_espaco_out) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5057 (class 2606 OID 18795)
-- Name: fluxo fk_fluxo_to_toperacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fluxo
    ADD CONSTRAINT fk_fluxo_to_toperacao FOREIGN KEY (fluxo_toperacao_id) REFERENCES tweeks.toperacao(toperacao_id);


--
-- TOC entry 5076 (class 2606 OID 18800)
-- Name: fornecedor fk_fornecedor_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fornecedor
    ADD CONSTRAINT fk_fornecedor_to_colaborador FOREIGN KEY (fornecedor_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5077 (class 2606 OID 18805)
-- Name: fornecedor fk_fornecedor_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fornecedor
    ADD CONSTRAINT fk_fornecedor_to_colaborador_atualizacao FOREIGN KEY (fornecedor_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5078 (class 2606 OID 18810)
-- Name: fornecedor fk_fornecedor_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.fornecedor
    ADD CONSTRAINT fk_fornecedor_to_espaco_auth FOREIGN KEY (fornecedor_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 4999 (class 2606 OID 18815)
-- Name: guia fk_guia_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.guia
    ADD CONSTRAINT fk_guia_to_colaborador FOREIGN KEY (guia_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5000 (class 2606 OID 18820)
-- Name: guia fk_guia_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.guia
    ADD CONSTRAINT fk_guia_to_colaborador_atualizacao FOREIGN KEY (guia_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5001 (class 2606 OID 18825)
-- Name: guia fk_guia_to_espaco; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.guia
    ADD CONSTRAINT fk_guia_to_espaco FOREIGN KEY (guia_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5079 (class 2606 OID 18830)
-- Name: imposto fk_imposto_to_artigo; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.imposto
    ADD CONSTRAINT fk_imposto_to_artigo FOREIGN KEY (imposto_artigo_id) REFERENCES tweeks.artigo(artigo_id);


--
-- TOC entry 5080 (class 2606 OID 18835)
-- Name: imposto fk_imposto_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.imposto
    ADD CONSTRAINT fk_imposto_to_colaborador FOREIGN KEY (imposto_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5081 (class 2606 OID 18840)
-- Name: imposto fk_imposto_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.imposto
    ADD CONSTRAINT fk_imposto_to_colaborador_atualizacao FOREIGN KEY (imposto_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5082 (class 2606 OID 18845)
-- Name: imposto fk_imposto_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.imposto
    ADD CONSTRAINT fk_imposto_to_espaco_auth FOREIGN KEY (imposto_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5083 (class 2606 OID 18850)
-- Name: imposto fk_imposto_to_taplicar; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.imposto
    ADD CONSTRAINT fk_imposto_to_taplicar FOREIGN KEY (imposto_taplicar_id) REFERENCES tweeks.taplicar(taplicar_id);


--
-- TOC entry 5084 (class 2606 OID 18855)
-- Name: imposto fk_imposto_to_tipoimposto; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.imposto
    ADD CONSTRAINT fk_imposto_to_tipoimposto FOREIGN KEY (imposto_tipoimposto_id) REFERENCES tweeks.tipoimposto(tipoimposto_id);


--
-- TOC entry 5085 (class 2606 OID 18860)
-- Name: impostovenda fk_impostovenda_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.impostovenda
    ADD CONSTRAINT fk_impostovenda_to_colaborador FOREIGN KEY (impostovenda_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5086 (class 2606 OID 18865)
-- Name: impostovenda fk_impostovenda_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.impostovenda
    ADD CONSTRAINT fk_impostovenda_to_colaborador_atualizacao FOREIGN KEY (impostovenda_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5087 (class 2606 OID 18870)
-- Name: impostovenda fk_impostovenda_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.impostovenda
    ADD CONSTRAINT fk_impostovenda_to_espaco_auth FOREIGN KEY (impostovenda_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5088 (class 2606 OID 18875)
-- Name: impostovenda fk_impostovenda_to_tipovenda; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.impostovenda
    ADD CONSTRAINT fk_impostovenda_to_tipovenda FOREIGN KEY (impostovenda_tipoimposto_id) REFERENCES tweeks.tipoimposto(tipoimposto_id);


--
-- TOC entry 5089 (class 2606 OID 18880)
-- Name: impostovenda fk_impostovenda_to_venda; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.impostovenda
    ADD CONSTRAINT fk_impostovenda_to_venda FOREIGN KEY (impostovenda_venda_id) REFERENCES tweeks.venda(venda_id);


--
-- TOC entry 5045 (class 2606 OID 18885)
-- Name: lancamento fk_lancamento_to_cliente; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.lancamento
    ADD CONSTRAINT fk_lancamento_to_cliente FOREIGN KEY (lancamento_cliente_id) REFERENCES tweeks.cliente(cliente_id);


--
-- TOC entry 5046 (class 2606 OID 18890)
-- Name: lancamento fk_lancamento_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.lancamento
    ADD CONSTRAINT fk_lancamento_to_colaborador FOREIGN KEY (lancamento_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5047 (class 2606 OID 18895)
-- Name: lancamento fk_lancamento_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.lancamento
    ADD CONSTRAINT fk_lancamento_to_colaborador_atualizacao FOREIGN KEY (lancamento_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5048 (class 2606 OID 18900)
-- Name: lancamento fk_lancamento_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.lancamento
    ADD CONSTRAINT fk_lancamento_to_espaco_auth FOREIGN KEY (lancamento_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5049 (class 2606 OID 18905)
-- Name: lancamento fk_lancamento_to_ttrasacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.lancamento
    ADD CONSTRAINT fk_lancamento_to_ttrasacao FOREIGN KEY (lancamento_tlancamento_id) REFERENCES tweeks.tlancamento(tlancamento_id);


--
-- TOC entry 4985 (class 2606 OID 18910)
-- Name: link fk_link_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.link
    ADD CONSTRAINT fk_link_to_colaborador FOREIGN KEY (link_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4986 (class 2606 OID 18915)
-- Name: link fk_link_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.link
    ADD CONSTRAINT fk_link_to_colaborador_atualizacao FOREIGN KEY (link_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4987 (class 2606 OID 18920)
-- Name: link fk_link_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.link
    ADD CONSTRAINT fk_link_to_espaco_auth FOREIGN KEY (link_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 4988 (class 2606 OID 18930)
-- Name: link fk_link_to_tlink; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.link
    ADD CONSTRAINT fk_link_to_tlink FOREIGN KEY (link_tlink_id) REFERENCES tweeks.tlink(tlink_id);


--
-- TOC entry 4946 (class 2606 OID 18935)
-- Name: movimento fk_movimento_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.movimento
    ADD CONSTRAINT fk_movimento_to_colaborador FOREIGN KEY (movimento_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4947 (class 2606 OID 18940)
-- Name: movimento fk_movimento_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.movimento
    ADD CONSTRAINT fk_movimento_to_colaborador_atualizacao FOREIGN KEY (movimento_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4948 (class 2606 OID 18945)
-- Name: movimento fk_movimento_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.movimento
    ADD CONSTRAINT fk_movimento_to_espaco_auth FOREIGN KEY (movimento_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 4949 (class 2606 OID 18950)
-- Name: movimento fk_movimento_to_tmovimento; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.movimento
    ADD CONSTRAINT fk_movimento_to_tmovimento FOREIGN KEY (movimento_tmovimento_id) REFERENCES tweeks.tmovimento(tmovimento_id);


--
-- TOC entry 4950 (class 2606 OID 18955)
-- Name: movimento fk_movimento_to_toperacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.movimento
    ADD CONSTRAINT fk_movimento_to_toperacao FOREIGN KEY (movimento_toperacao_id) REFERENCES tweeks.toperacao(toperacao_id);


--
-- TOC entry 4989 (class 2606 OID 18960)
-- Name: posto fk_posto_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.posto
    ADD CONSTRAINT fk_posto_to_colaborador FOREIGN KEY (posto_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4990 (class 2606 OID 18965)
-- Name: posto fk_posto_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.posto
    ADD CONSTRAINT fk_posto_to_colaborador_atualizacao FOREIGN KEY (posto_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4991 (class 2606 OID 18970)
-- Name: posto fk_posto_to_espaco; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.posto
    ADD CONSTRAINT fk_posto_to_espaco FOREIGN KEY (posto_espaco_auth) REFERENCES tweeks.espaco(espaco_id) ON UPDATE CASCADE;


--
-- TOC entry 4992 (class 2606 OID 18975)
-- Name: posto fk_posto_to_tposto; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.posto
    ADD CONSTRAINT fk_posto_to_tposto FOREIGN KEY (posto_tposto_id) REFERENCES tweeks.tposto(tposto_id);


--
-- TOC entry 5090 (class 2606 OID 18980)
-- Name: retalho fk_retalho_to_artigo_base; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.retalho
    ADD CONSTRAINT fk_retalho_to_artigo_base FOREIGN KEY (retalho_artigo_base) REFERENCES tweeks.artigo(artigo_id);


--
-- TOC entry 5091 (class 2606 OID 18985)
-- Name: retalho fk_retalho_to_artigo_composto; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.retalho
    ADD CONSTRAINT fk_retalho_to_artigo_composto FOREIGN KEY (retalho_artigo_composto) REFERENCES tweeks.artigo(artigo_id);


--
-- TOC entry 5092 (class 2606 OID 18990)
-- Name: retalho fk_retalho_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.retalho
    ADD CONSTRAINT fk_retalho_to_colaborador FOREIGN KEY (retalho_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5093 (class 2606 OID 18995)
-- Name: retalho fk_retalho_to_espaco; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.retalho
    ADD CONSTRAINT fk_retalho_to_espaco FOREIGN KEY (retalho_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 4962 (class 2606 OID 19708)
-- Name: serie fk_serie_to_autorizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.serie
    ADD CONSTRAINT fk_serie_to_autorizacao FOREIGN KEY (serie_autorizacao_uid) REFERENCES tweeks.autorizacao(autorizacao_uid);


--
-- TOC entry 4963 (class 2606 OID 19000)
-- Name: serie fk_serie_to_espaco; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.serie
    ADD CONSTRAINT fk_serie_to_espaco FOREIGN KEY (serie_espaco_id) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 4964 (class 2606 OID 19005)
-- Name: serie fk_serie_to_tserie; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.serie
    ADD CONSTRAINT fk_serie_to_tserie FOREIGN KEY (serie_tserie_id) REFERENCES tweeks.tserie(tserie_id);


--
-- TOC entry 4951 (class 2606 OID 19010)
-- Name: taxa fk_taxa_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.taxa
    ADD CONSTRAINT fk_taxa_to_colaborador FOREIGN KEY (taxa_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4952 (class 2606 OID 19015)
-- Name: taxa fk_taxa_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.taxa
    ADD CONSTRAINT fk_taxa_to_colaborador_atualizacao FOREIGN KEY (taxa_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4953 (class 2606 OID 19020)
-- Name: taxa fk_taxa_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.taxa
    ADD CONSTRAINT fk_taxa_to_espaco_auth FOREIGN KEY (taxa_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 4954 (class 2606 OID 19025)
-- Name: taxa fk_taxa_to_tipoimposto; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.taxa
    ADD CONSTRAINT fk_taxa_to_tipoimposto FOREIGN KEY (taxa_tipoimposto_id) REFERENCES tweeks.tipoimposto(tipoimposto_id);


--
-- TOC entry 5058 (class 2606 OID 19030)
-- Name: tipoimposto fk_tipoimposto_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tipoimposto
    ADD CONSTRAINT fk_tipoimposto_to_colaborador FOREIGN KEY (tipoimposto_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5059 (class 2606 OID 19035)
-- Name: tipoimposto fk_tipoimposto_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.tipoimposto
    ADD CONSTRAINT fk_tipoimposto_to_colaborador_atualizacao FOREIGN KEY (tipoimposto_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5094 (class 2606 OID 19040)
-- Name: trabalha fk_trabalha_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.trabalha
    ADD CONSTRAINT fk_trabalha_to_colaborador FOREIGN KEY (trabalha_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5095 (class 2606 OID 19045)
-- Name: trabalha fk_trabalha_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.trabalha
    ADD CONSTRAINT fk_trabalha_to_colaborador_atualizacao FOREIGN KEY (trabalha_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5096 (class 2606 OID 19050)
-- Name: trabalha fk_trabalha_to_colaborador_proprietario; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.trabalha
    ADD CONSTRAINT fk_trabalha_to_colaborador_proprietario FOREIGN KEY (trabalha_colaborador_proprietario) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5097 (class 2606 OID 19055)
-- Name: trabalha fk_trabalha_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.trabalha
    ADD CONSTRAINT fk_trabalha_to_espaco_auth FOREIGN KEY (trabalha_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5098 (class 2606 OID 19060)
-- Name: trabalha fk_trabalha_to_perfil; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.trabalha
    ADD CONSTRAINT fk_trabalha_to_perfil FOREIGN KEY (trabalha_perfil_id) REFERENCES auth.perfil(perfil_id);


--
-- TOC entry 4955 (class 2606 OID 19065)
-- Name: transacao fk_transacao_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.transacao
    ADD CONSTRAINT fk_transacao_to_colaborador FOREIGN KEY (transacao_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4956 (class 2606 OID 19070)
-- Name: transacao fk_transacao_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.transacao
    ADD CONSTRAINT fk_transacao_to_colaborador_atualizacao FOREIGN KEY (transacao_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4957 (class 2606 OID 19075)
-- Name: transacao fk_transacao_to_espaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.transacao
    ADD CONSTRAINT fk_transacao_to_espaco_auth FOREIGN KEY (transacao_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 4958 (class 2606 OID 19080)
-- Name: transacao fk_transacao_to_posto; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.transacao
    ADD CONSTRAINT fk_transacao_to_posto FOREIGN KEY (transacao_posto_id) REFERENCES tweeks.posto(posto_id);


--
-- TOC entry 4959 (class 2606 OID 19085)
-- Name: transacao fk_transacao_to_tmovimento; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.transacao
    ADD CONSTRAINT fk_transacao_to_tmovimento FOREIGN KEY (transacao_tmovimento_id) REFERENCES tweeks.tmovimento(tmovimento_id);


--
-- TOC entry 4960 (class 2606 OID 19090)
-- Name: transacao fk_transacao_to_toperacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.transacao
    ADD CONSTRAINT fk_transacao_to_toperacao FOREIGN KEY (transacao_toperacao_id) REFERENCES tweeks.toperacao(toperacao_id);


--
-- TOC entry 5099 (class 2606 OID 19095)
-- Name: transferencia fk_transferencia_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.transferencia
    ADD CONSTRAINT fk_transferencia_to_colaborador FOREIGN KEY (transferencia_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5100 (class 2606 OID 19100)
-- Name: transferencia fk_transferencia_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.transferencia
    ADD CONSTRAINT fk_transferencia_to_colaborador_atualizacao FOREIGN KEY (transferencia_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5101 (class 2606 OID 19105)
-- Name: transferencia fk_transferencia_to_estaco_auth; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.transferencia
    ADD CONSTRAINT fk_transferencia_to_estaco_auth FOREIGN KEY (transferencia_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 4993 (class 2606 OID 19110)
-- Name: venda fk_venda_to_artigo; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.venda
    ADD CONSTRAINT fk_venda_to_artigo FOREIGN KEY (venda_artigo_id) REFERENCES tweeks.artigo(artigo_id);


--
-- TOC entry 4994 (class 2606 OID 19115)
-- Name: venda fk_venda_to_colaborador; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.venda
    ADD CONSTRAINT fk_venda_to_colaborador FOREIGN KEY (venda_colaborador_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4995 (class 2606 OID 19120)
-- Name: venda fk_venda_to_colaborador_atualizacao; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.venda
    ADD CONSTRAINT fk_venda_to_colaborador_atualizacao FOREIGN KEY (venda_colaborador_atualizacao) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 4996 (class 2606 OID 19125)
-- Name: venda fk_venda_to_conta; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.venda
    ADD CONSTRAINT fk_venda_to_conta FOREIGN KEY (venda_conta_id) REFERENCES tweeks.conta(conta_id);


--
-- TOC entry 4997 (class 2606 OID 19130)
-- Name: venda fk_venda_to_espaco; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.venda
    ADD CONSTRAINT fk_venda_to_espaco FOREIGN KEY (venda_espaco_auth) REFERENCES tweeks.espaco(espaco_id) ON UPDATE CASCADE;


--
-- TOC entry 4998 (class 2606 OID 19742)
-- Name: venda fk_venda_to_venda_docorigin; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.venda
    ADD CONSTRAINT fk_venda_to_venda_docorigin FOREIGN KEY (venda_venda_docorign) REFERENCES tweeks.venda(venda_id);


--
-- TOC entry 5106 (class 2606 OID 19815)
-- Name: unit unit_unit_espaco_auth_fkey; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.unit
    ADD CONSTRAINT unit_unit_espaco_auth_fkey FOREIGN KEY (unit_espaco_auth) REFERENCES tweeks.espaco(espaco_id);


--
-- TOC entry 5107 (class 2606 OID 19820)
-- Name: unit unit_unit_user_id_fkey; Type: FK CONSTRAINT; Schema: tweeks; Owner: -
--

ALTER TABLE ONLY tweeks.unit
    ADD CONSTRAINT unit_unit_user_id_fkey FOREIGN KEY (unit_user_id) REFERENCES auth.colaborador(colaborador_id);


--
-- TOC entry 5528 (class 0 OID 0)
-- Dependencies: 9
-- Name: SCHEMA auth; Type: ACL; Schema: -; Owner: -
--

GRANT USAGE ON SCHEMA auth TO maguita_dps_clone;


--
-- TOC entry 5529 (class 0 OID 0)
-- Dependencies: 10
-- Name: SCHEMA cluster; Type: ACL; Schema: -; Owner: -
--

GRANT USAGE ON SCHEMA cluster TO maguita_dps_clone;


--
-- TOC entry 5530 (class 0 OID 0)
-- Dependencies: 12
-- Name: SCHEMA geoinfo; Type: ACL; Schema: -; Owner: -
--

GRANT USAGE ON SCHEMA geoinfo TO maguita_dps_clone;


--
-- TOC entry 5531 (class 0 OID 0)
-- Dependencies: 11
-- Name: SCHEMA lib; Type: ACL; Schema: -; Owner: -
--

GRANT USAGE ON SCHEMA lib TO maguita_dps_clone;


--
-- TOC entry 5532 (class 0 OID 0)
-- Dependencies: 13
-- Name: SCHEMA map; Type: ACL; Schema: -; Owner: -
--

GRANT USAGE ON SCHEMA map TO maguita_dps_clone;


--
-- TOC entry 5533 (class 0 OID 0)
-- Dependencies: 14
-- Name: SCHEMA public; Type: ACL; Schema: -; Owner: -
--

GRANT USAGE ON SCHEMA public TO maguita_dps_clone;


--
-- TOC entry 5534 (class 0 OID 0)
-- Dependencies: 15
-- Name: SCHEMA rule; Type: ACL; Schema: -; Owner: -
--

GRANT USAGE ON SCHEMA rule TO maguita_dps_clone;


--
-- TOC entry 5535 (class 0 OID 0)
-- Dependencies: 16
-- Name: SCHEMA tweeks; Type: ACL; Schema: -; Owner: -
--

GRANT USAGE ON SCHEMA tweeks TO maguita_dps_clone;


--
-- TOC entry 5538 (class 0 OID 0)
-- Dependencies: 575
-- Name: FUNCTION _autenticacao_chave_generate(); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth._autenticacao_chave_generate() TO maguita_dps_clone;


--
-- TOC entry 5539 (class 0 OID 0)
-- Dependencies: 615
-- Name: FUNCTION _colaborador_accesso_desc(arg_colaborador_acesso smallint); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth._colaborador_accesso_desc(arg_colaborador_acesso smallint) TO maguita_dps_clone;


--
-- TOC entry 5540 (class 0 OID 0)
-- Dependencies: 616
-- Name: FUNCTION _colaborador_estado_desc(arg_colaborador_estado smallint); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth._colaborador_estado_desc(arg_colaborador_estado smallint) TO maguita_dps_clone;


--
-- TOC entry 5541 (class 0 OID 0)
-- Dependencies: 392
-- Name: FUNCTION _colaborador_generate_pin_token(); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth._colaborador_generate_pin_token() TO maguita_dps_clone;


--
-- TOC entry 5542 (class 0 OID 0)
-- Dependencies: 617
-- Name: FUNCTION _colaborador_generate_senha_token(); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth._colaborador_generate_senha_token() TO maguita_dps_clone;


--
-- TOC entry 5543 (class 0 OID 0)
-- Dependencies: 576
-- Name: FUNCTION to_uuid(anyelement); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.to_uuid(anyelement) TO maguita_dps_clone;


--
-- TOC entry 5544 (class 0 OID 0)
-- Dependencies: 706
-- Name: FUNCTION get(arg_constant_name name); Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON FUNCTION map.get(arg_constant_name name) TO maguita_dps_clone;


--
-- TOC entry 5566 (class 0 OID 0)
-- Dependencies: 231
-- Name: TABLE colaborador; Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON TABLE auth.colaborador TO maguita_dps_clone;


--
-- TOC entry 5567 (class 0 OID 0)
-- Dependencies: 618
-- Name: FUNCTION _colaborador_token_encrypt(_colaborador auth.colaborador); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth._colaborador_token_encrypt(_colaborador auth.colaborador) TO maguita_dps_clone;


--
-- TOC entry 5568 (class 0 OID 0)
-- Dependencies: 588
-- Name: FUNCTION _encrypt(word text); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth._encrypt(word text) TO maguita_dps_clone;


--
-- TOC entry 5569 (class 0 OID 0)
-- Dependencies: 590
-- Name: FUNCTION _get_colaborador(arg_colaborador_id uuid); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth._get_colaborador(arg_colaborador_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5570 (class 0 OID 0)
-- Dependencies: 592
-- Name: FUNCTION str_is_normalized(text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.str_is_normalized(text) TO maguita_dps_clone;


--
-- TOC entry 5571 (class 0 OID 0)
-- Dependencies: 484
-- Name: FUNCTION str_normalize(text text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.str_normalize(text text) TO maguita_dps_clone;


--
-- TOC entry 5572 (class 0 OID 0)
-- Dependencies: 554
-- Name: FUNCTION uuid_generate_v4(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.uuid_generate_v4() TO maguita_dps_clone;


--
-- TOC entry 5583 (class 0 OID 0)
-- Dependencies: 232
-- Name: TABLE perfil; Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON TABLE auth.perfil TO maguita_dps_clone;


--
-- TOC entry 5584 (class 0 OID 0)
-- Dependencies: 405
-- Name: FUNCTION _get_perfil(arg_perfil_id uuid); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth._get_perfil(arg_perfil_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5585 (class 0 OID 0)
-- Dependencies: 619
-- Name: FUNCTION _menu_create(arg_menu_codigo character varying, arg_menu_nome character varying, arg_menu_menu_codigo character varying, arg_menu_link character varying, arg_menu_icon character varying); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth._menu_create(arg_menu_codigo character varying, arg_menu_nome character varying, arg_menu_menu_codigo character varying, arg_menu_link character varying, arg_menu_icon character varying) TO maguita_dps_clone;


--
-- TOC entry 5586 (class 0 OID 0)
-- Dependencies: 587
-- Name: FUNCTION _menu_create_set_up(); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth._menu_create_set_up() TO maguita_dps_clone;


--
-- TOC entry 5587 (class 0 OID 0)
-- Dependencies: 620
-- Name: FUNCTION _menu_load_structure(filter jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth._menu_load_structure(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 5588 (class 0 OID 0)
-- Dependencies: 621
-- Name: FUNCTION funct_autenticacao(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_autenticacao(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5589 (class 0 OID 0)
-- Dependencies: 407
-- Name: FUNCTION funct_autenticacao_logoff(arg jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_autenticacao_logoff(arg jsonb) TO maguita_dps_clone;


--
-- TOC entry 5590 (class 0 OID 0)
-- Dependencies: 622
-- Name: FUNCTION funct_change_colaborador(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_change_colaborador(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5591 (class 0 OID 0)
-- Dependencies: 408
-- Name: FUNCTION funct_change_colaborador_accesso_disable(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_change_colaborador_accesso_disable(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5592 (class 0 OID 0)
-- Dependencies: 611
-- Name: FUNCTION funct_change_colaborador_accesso_reativar(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_change_colaborador_accesso_reativar(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5593 (class 0 OID 0)
-- Dependencies: 623
-- Name: FUNCTION funct_change_colaborador_estado_disable(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_change_colaborador_estado_disable(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5594 (class 0 OID 0)
-- Dependencies: 409
-- Name: FUNCTION funct_change_colaborador_pin(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_change_colaborador_pin(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5595 (class 0 OID 0)
-- Dependencies: 410
-- Name: FUNCTION funct_change_colaborador_senha(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_change_colaborador_senha(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5596 (class 0 OID 0)
-- Dependencies: 612
-- Name: FUNCTION funct_change_colaborador_token_acesso(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_change_colaborador_token_acesso(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5597 (class 0 OID 0)
-- Dependencies: 411
-- Name: FUNCTION funct_change_colaborador_token_ativate(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_change_colaborador_token_ativate(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5598 (class 0 OID 0)
-- Dependencies: 624
-- Name: FUNCTION funct_change_perfil(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_change_perfil(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5599 (class 0 OID 0)
-- Dependencies: 625
-- Name: FUNCTION funct_load_colaborador(filter jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_load_colaborador(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 5600 (class 0 OID 0)
-- Dependencies: 613
-- Name: FUNCTION funct_load_colaborador_all_menu(filter jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_load_colaborador_all_menu(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 5601 (class 0 OID 0)
-- Dependencies: 412
-- Name: FUNCTION funct_load_colaborador_any_menu(filter jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_load_colaborador_any_menu(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 5602 (class 0 OID 0)
-- Dependencies: 607
-- Name: FUNCTION funct_load_colaborador_by_token(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_load_colaborador_by_token(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5603 (class 0 OID 0)
-- Dependencies: 413
-- Name: FUNCTION funct_load_colaborador_simple(filter jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_load_colaborador_simple(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 5604 (class 0 OID 0)
-- Dependencies: 414
-- Name: FUNCTION funct_load_colaborador_token_restore(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_load_colaborador_token_restore(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5605 (class 0 OID 0)
-- Dependencies: 608
-- Name: FUNCTION funct_load_grants(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_load_grants(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5606 (class 0 OID 0)
-- Dependencies: 626
-- Name: FUNCTION funct_load_menu(filter jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_load_menu(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 5607 (class 0 OID 0)
-- Dependencies: 614
-- Name: FUNCTION funct_load_menu_cascade(filter jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_load_menu_cascade(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 5608 (class 0 OID 0)
-- Dependencies: 627
-- Name: FUNCTION funct_reg_acesso(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_reg_acesso(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5609 (class 0 OID 0)
-- Dependencies: 415
-- Name: FUNCTION funct_reg_colaborador(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_reg_colaborador(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5610 (class 0 OID 0)
-- Dependencies: 628
-- Name: FUNCTION funct_reg_perfil(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_reg_perfil(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5611 (class 0 OID 0)
-- Dependencies: 416
-- Name: FUNCTION funct_reg_privilegio(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_reg_privilegio(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5612 (class 0 OID 0)
-- Dependencies: 417
-- Name: FUNCTION funct_reg_trabalha(args jsonb); Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON FUNCTION auth.funct_reg_trabalha(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5613 (class 0 OID 0)
-- Dependencies: 418
-- Name: FUNCTION __transaction_uid(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__transaction_uid() TO maguita_dps_clone;


--
-- TOC entry 5616 (class 0 OID 0)
-- Dependencies: 233
-- Name: TABLE collector; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON TABLE cluster.collector TO maguita_dps_clone;


--
-- TOC entry 5617 (class 0 OID 0)
-- Dependencies: 633
-- Name: FUNCTION __add(_regclass regclass); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__add(_regclass regclass) TO maguita_dps_clone;


--
-- TOC entry 5618 (class 0 OID 0)
-- Dependencies: 558
-- Name: FUNCTION __collect_change(regclass, _change jsonb, _old jsonb, _operation character, _ref jsonb, _force boolean); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__collect_change(regclass, _change jsonb, _old jsonb, _operation character, _ref jsonb, _force boolean) TO maguita_dps_clone;


--
-- TOC entry 5619 (class 0 OID 0)
-- Dependencies: 634
-- Name: FUNCTION __create_api(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__create_api() TO maguita_dps_clone;


--
-- TOC entry 5620 (class 0 OID 0)
-- Dependencies: 629
-- Name: FUNCTION __create_identifier(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__create_identifier() TO maguita_dps_clone;


--
-- TOC entry 5621 (class 0 OID 0)
-- Dependencies: 234
-- Name: TABLE version; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON TABLE cluster.version TO maguita_dps_clone;


--
-- TOC entry 5622 (class 0 OID 0)
-- Dependencies: 641
-- Name: FUNCTION __create_object_version(regclass); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__create_object_version(regclass) TO maguita_dps_clone;


--
-- TOC entry 5623 (class 0 OID 0)
-- Dependencies: 424
-- Name: FUNCTION __format(regclass); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__format(regclass) TO maguita_dps_clone;


--
-- TOC entry 5624 (class 0 OID 0)
-- Dependencies: 419
-- Name: FUNCTION __format_proc(regproc); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__format_proc(regproc) TO maguita_dps_clone;


--
-- TOC entry 5625 (class 0 OID 0)
-- Dependencies: 642
-- Name: FUNCTION __generate_cluster_code(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__generate_cluster_code() TO maguita_dps_clone;


--
-- TOC entry 5626 (class 0 OID 0)
-- Dependencies: 420
-- Name: FUNCTION __get(regclass, jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__get(regclass, jsonb) TO maguita_dps_clone;


--
-- TOC entry 5627 (class 0 OID 0)
-- Dependencies: 421
-- Name: FUNCTION __is_replication(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__is_replication() TO maguita_dps_clone;


--
-- TOC entry 5628 (class 0 OID 0)
-- Dependencies: 630
-- Name: FUNCTION __is_sub_path(base text, child_path text); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__is_sub_path(base text, child_path text) TO maguita_dps_clone;


--
-- TOC entry 5629 (class 0 OID 0)
-- Dependencies: 422
-- Name: FUNCTION __pks(regclass); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__pks(regclass) TO maguita_dps_clone;


--
-- TOC entry 5642 (class 0 OID 0)
-- Dependencies: 235
-- Name: TABLE object; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON TABLE cluster.object TO maguita_dps_clone;


--
-- TOC entry 5643 (class 0 OID 0)
-- Dependencies: 423
-- Name: FUNCTION __pull(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__pull(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5644 (class 0 OID 0)
-- Dependencies: 631
-- Name: FUNCTION __tg_before_create_filter(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__tg_before_create_filter() TO maguita_dps_clone;


--
-- TOC entry 5645 (class 0 OID 0)
-- Dependencies: 883
-- Name: FUNCTION __tg_share_check(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__tg_share_check() TO maguita_dps_clone;


--
-- TOC entry 5646 (class 0 OID 0)
-- Dependencies: 514
-- Name: FUNCTION __tg_share_guard_upgrade(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__tg_share_guard_upgrade() TO maguita_dps_clone;


--
-- TOC entry 5647 (class 0 OID 0)
-- Dependencies: 643
-- Name: FUNCTION __tg_share_map(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__tg_share_map() TO maguita_dps_clone;


--
-- TOC entry 5648 (class 0 OID 0)
-- Dependencies: 425
-- Name: FUNCTION __tg_share_truncate(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__tg_share_truncate() TO maguita_dps_clone;


--
-- TOC entry 5649 (class 0 OID 0)
-- Dependencies: 426
-- Name: FUNCTION __tg_version_add_when_insert(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__tg_version_add_when_insert() TO maguita_dps_clone;


--
-- TOC entry 5650 (class 0 OID 0)
-- Dependencies: 427
-- Name: FUNCTION __tg_version_add_when_update(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__tg_version_add_when_update() TO maguita_dps_clone;


--
-- TOC entry 5651 (class 0 OID 0)
-- Dependencies: 428
-- Name: FUNCTION __tg_version_commit(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__tg_version_commit() TO maguita_dps_clone;


--
-- TOC entry 5652 (class 0 OID 0)
-- Dependencies: 429
-- Name: FUNCTION __user_default(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__user_default() TO maguita_dps_clone;


--
-- TOC entry 5653 (class 0 OID 0)
-- Dependencies: 236
-- Name: TABLE users; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON TABLE cluster.users TO maguita_dps_clone;


--
-- TOC entry 5654 (class 0 OID 0)
-- Dependencies: 515
-- Name: FUNCTION __user_map(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__user_map() TO maguita_dps_clone;


--
-- TOC entry 5655 (class 0 OID 0)
-- Dependencies: 516
-- Name: FUNCTION __user_replication(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.__user_replication() TO maguita_dps_clone;


--
-- TOC entry 5656 (class 0 OID 0)
-- Dependencies: 517
-- Name: FUNCTION _cluster_accept_child(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster._cluster_accept_child(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5657 (class 0 OID 0)
-- Dependencies: 237
-- Name: TABLE cluster; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON TABLE cluster.cluster TO maguita_dps_clone;


--
-- TOC entry 5658 (class 0 OID 0)
-- Dependencies: 518
-- Name: FUNCTION _get_cluster(character varying); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster._get_cluster(character varying) TO maguita_dps_clone;


--
-- TOC entry 5659 (class 0 OID 0)
-- Dependencies: 519
-- Name: FUNCTION _get_cluster_child(identifier character varying); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster._get_cluster_child(identifier character varying) TO maguita_dps_clone;


--
-- TOC entry 5660 (class 0 OID 0)
-- Dependencies: 644
-- Name: FUNCTION _get_cluster_local(increment boolean, try integer); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster._get_cluster_local(increment boolean, try integer) TO maguita_dps_clone;


--
-- TOC entry 5661 (class 0 OID 0)
-- Dependencies: 520
-- Name: FUNCTION _get_cluster_master(); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster._get_cluster_master() TO maguita_dps_clone;


--
-- TOC entry 5662 (class 0 OID 0)
-- Dependencies: 645
-- Name: FUNCTION _get_version_local(regclass, increment boolean); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster._get_version_local(regclass, increment boolean) TO maguita_dps_clone;


--
-- TOC entry 5663 (class 0 OID 0)
-- Dependencies: 430
-- Name: FUNCTION accept_remote_cluster(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.accept_remote_cluster(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5664 (class 0 OID 0)
-- Dependencies: 646
-- Name: FUNCTION accept_revision(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.accept_revision(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5665 (class 0 OID 0)
-- Dependencies: 635
-- Name: FUNCTION add(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.add(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5666 (class 0 OID 0)
-- Dependencies: 432
-- Name: FUNCTION constant(); Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON FUNCTION map.constant() TO maguita_dps_clone;


--
-- TOC entry 5667 (class 0 OID 0)
-- Dependencies: 431
-- Name: FUNCTION can_send_object(_object cluster.object, _collector cluster.collector, _origin cluster.cluster, _request cluster.cluster, _local cluster.cluster, _master cluster.cluster, _child cluster.cluster, _const map.constant); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.can_send_object(_object cluster.object, _collector cluster.collector, _origin cluster.cluster, _request cluster.cluster, _local cluster.cluster, _master cluster.cluster, _child cluster.cluster, _const map.constant) TO maguita_dps_clone;


--
-- TOC entry 5668 (class 0 OID 0)
-- Dependencies: 636
-- Name: FUNCTION can_send_revision(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.can_send_revision(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5669 (class 0 OID 0)
-- Dependencies: 647
-- Name: FUNCTION change(jsonb, VARIADIC keys text[]); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.change(jsonb, VARIADIC keys text[]) TO maguita_dps_clone;


--
-- TOC entry 5670 (class 0 OID 0)
-- Dependencies: 648
-- Name: FUNCTION commit(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.commit(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5671 (class 0 OID 0)
-- Dependencies: 238
-- Name: TABLE resource; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON TABLE cluster.resource TO maguita_dps_clone;


--
-- TOC entry 5672 (class 0 OID 0)
-- Dependencies: 433
-- Name: FUNCTION create_resource(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.create_resource(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5673 (class 0 OID 0)
-- Dependencies: 434
-- Name: PROCEDURE declare_filter(IN regnamespace, IN name character varying, IN share regclass, IN describe character varying); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON PROCEDURE cluster.declare_filter(IN regnamespace, IN name character varying, IN share regclass, IN describe character varying) TO maguita_dps_clone;


--
-- TOC entry 5674 (class 0 OID 0)
-- Dependencies: 637
-- Name: FUNCTION funct_reg_acesso(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.funct_reg_acesso(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5675 (class 0 OID 0)
-- Dependencies: 638
-- Name: FUNCTION load_clusters(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.load_clusters(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5676 (class 0 OID 0)
-- Dependencies: 844
-- Name: FUNCTION load_clusters_configs_to_child(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.load_clusters_configs_to_child(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5677 (class 0 OID 0)
-- Dependencies: 649
-- Name: FUNCTION load_clusters_local_as_remotes(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.load_clusters_local_as_remotes(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5678 (class 0 OID 0)
-- Dependencies: 439
-- Name: FUNCTION load_paths(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.load_paths(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5679 (class 0 OID 0)
-- Dependencies: 435
-- Name: FUNCTION load_resources_pendents(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.load_resources_pendents(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5680 (class 0 OID 0)
-- Dependencies: 650
-- Name: FUNCTION next(name character varying, sub character varying, zero_base boolean, steep integer, lpad integer, lpad_char character, exist text, exist_limit integer); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.next(name character varying, sub character varying, zero_base boolean, steep integer, lpad integer, lpad_char character, exist text, exist_limit integer) TO maguita_dps_clone;


--
-- TOC entry 5681 (class 0 OID 0)
-- Dependencies: 436
-- Name: FUNCTION object_filter(share character varying, _object cluster.object, _collector cluster.collector, _req cluster.cluster, _origin cluster.cluster); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.object_filter(share character varying, _object cluster.object, _collector cluster.collector, _req cluster.cluster, _origin cluster.cluster) TO maguita_dps_clone;


--
-- TOC entry 5682 (class 0 OID 0)
-- Dependencies: 438
-- Name: FUNCTION pull(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.pull(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5683 (class 0 OID 0)
-- Dependencies: 651
-- Name: FUNCTION push(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.push(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5684 (class 0 OID 0)
-- Dependencies: 437
-- Name: FUNCTION reduce(VARIADIC jsonb[]); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.reduce(VARIADIC jsonb[]) TO maguita_dps_clone;


--
-- TOC entry 5685 (class 0 OID 0)
-- Dependencies: 652
-- Name: FUNCTION sets_cluster_configs(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.sets_cluster_configs(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5686 (class 0 OID 0)
-- Dependencies: 440
-- Name: FUNCTION sets_cluster_license(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.sets_cluster_license(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5687 (class 0 OID 0)
-- Dependencies: 653
-- Name: FUNCTION sets_cluster_machine_id(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.sets_cluster_machine_id(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5688 (class 0 OID 0)
-- Dependencies: 640
-- Name: FUNCTION sets_cluster_remote(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.sets_cluster_remote(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5689 (class 0 OID 0)
-- Dependencies: 441
-- Name: FUNCTION sets_cluster_tree_position(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.sets_cluster_tree_position(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5690 (class 0 OID 0)
-- Dependencies: 442
-- Name: FUNCTION sets_clusters_admin(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.sets_clusters_admin(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5691 (class 0 OID 0)
-- Dependencies: 524
-- Name: FUNCTION sets_resources_downloaded(args json); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.sets_resources_downloaded(args json) TO maguita_dps_clone;


--
-- TOC entry 5692 (class 0 OID 0)
-- Dependencies: 654
-- Name: FUNCTION sets_resources_downloaded(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.sets_resources_downloaded(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5693 (class 0 OID 0)
-- Dependencies: 655
-- Name: FUNCTION status(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.status(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5694 (class 0 OID 0)
-- Dependencies: 557
-- Name: FUNCTION unlink_cluster(args jsonb); Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON FUNCTION cluster.unlink_cluster(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5695 (class 0 OID 0)
-- Dependencies: 695
-- Name: FUNCTION dataset(); Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON FUNCTION geoinfo.dataset() TO maguita_dps_clone;


--
-- TOC entry 5696 (class 0 OID 0)
-- Dependencies: 239
-- Name: TABLE dataset; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.dataset TO maguita_dps_clone;


--
-- TOC entry 5697 (class 0 OID 0)
-- Dependencies: 696
-- Name: FUNCTION dataset(arg_dataset_link character); Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON FUNCTION geoinfo.dataset(arg_dataset_link character) TO maguita_dps_clone;


--
-- TOC entry 5698 (class 0 OID 0)
-- Dependencies: 697
-- Name: FUNCTION dataset_populate(arg_dataset_link character varying, arg_dataset_version character varying, arg_dataset_data jsonb); Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON FUNCTION geoinfo.dataset_populate(arg_dataset_link character varying, arg_dataset_version character varying, arg_dataset_data jsonb) TO maguita_dps_clone;


--
-- TOC entry 5699 (class 0 OID 0)
-- Dependencies: 698
-- Name: FUNCTION dataset_setup(); Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON FUNCTION geoinfo.dataset_setup() TO maguita_dps_clone;


--
-- TOC entry 5700 (class 0 OID 0)
-- Dependencies: 699
-- Name: FUNCTION dataset_update(arg_dataset_link character varying, arg_dataset_version character varying, arg_dataset_data jsonb); Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON FUNCTION geoinfo.dataset_update(arg_dataset_link character varying, arg_dataset_version character varying, arg_dataset_data jsonb) TO maguita_dps_clone;


--
-- TOC entry 5701 (class 0 OID 0)
-- Dependencies: 700
-- Name: FUNCTION dataset_use(arg_dataset_link character varying); Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON FUNCTION geoinfo.dataset_use(arg_dataset_link character varying) TO maguita_dps_clone;


--
-- TOC entry 5702 (class 0 OID 0)
-- Dependencies: 443
-- Name: FUNCTION age(timestamp with time zone); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.age(timestamp with time zone) TO maguita_dps_clone;


--
-- TOC entry 5703 (class 0 OID 0)
-- Dependencies: 444
-- Name: FUNCTION agg_first(anyelement, anyelement); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.agg_first(anyelement, anyelement) TO maguita_dps_clone;


--
-- TOC entry 5704 (class 0 OID 0)
-- Dependencies: 580
-- Name: FUNCTION agg_last(anyelement, anyelement); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.agg_last(anyelement, anyelement) TO maguita_dps_clone;


--
-- TOC entry 5705 (class 0 OID 0)
-- Dependencies: 581
-- Name: FUNCTION array_delete(list anyarray, element integer); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.array_delete(list anyarray, element integer) TO maguita_dps_clone;


--
-- TOC entry 5706 (class 0 OID 0)
-- Dependencies: 582
-- Name: FUNCTION array_delete(list anyarray, start integer, elements integer); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.array_delete(list anyarray, start integer, elements integer) TO maguita_dps_clone;


--
-- TOC entry 5707 (class 0 OID 0)
-- Dependencies: 583
-- Name: FUNCTION array_max_element(arr anyarray, element anyelement); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.array_max_element(arr anyarray, element anyelement) TO maguita_dps_clone;


--
-- TOC entry 5708 (class 0 OID 0)
-- Dependencies: 601
-- Name: FUNCTION array_min_element(arr anyarray, element anyelement); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.array_min_element(arr anyarray, element anyelement) TO maguita_dps_clone;


--
-- TOC entry 5709 (class 0 OID 0)
-- Dependencies: 675
-- Name: FUNCTION coincidences(arguments_left anyarray, arguments_right anyarray, option jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.coincidences(arguments_left anyarray, arguments_right anyarray, option jsonb) TO maguita_dps_clone;


--
-- TOC entry 5710 (class 0 OID 0)
-- Dependencies: 676
-- Name: FUNCTION coincidences_likes(arguments_left text[], arguments_right text[], option jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.coincidences_likes(arguments_left text[], arguments_right text[], option jsonb) TO maguita_dps_clone;


--
-- TOC entry 5711 (class 0 OID 0)
-- Dependencies: 658
-- Name: FUNCTION combinator(items text[], start integer, parent text[], indexs integer[], size integer); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.combinator(items text[], start integer, parent text[], indexs integer[], size integer) TO maguita_dps_clone;


--
-- TOC entry 5712 (class 0 OID 0)
-- Dependencies: 445
-- Name: FUNCTION dset_random_element(elements anyarray); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.dset_random_element(elements anyarray) TO maguita_dps_clone;


--
-- TOC entry 5713 (class 0 OID 0)
-- Dependencies: 446
-- Name: FUNCTION dset_random_name(min integer, max integer); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.dset_random_name(min integer, max integer) TO maguita_dps_clone;


--
-- TOC entry 5714 (class 0 OID 0)
-- Dependencies: 659
-- Name: FUNCTION dset_random_next(anyelement); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.dset_random_next(anyelement) TO maguita_dps_clone;


--
-- TOC entry 5715 (class 0 OID 0)
-- Dependencies: 660
-- Name: FUNCTION dset_random_next(min anyelement, max anyelement); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.dset_random_next(min anyelement, max anyelement) TO maguita_dps_clone;


--
-- TOC entry 5716 (class 0 OID 0)
-- Dependencies: 661
-- Name: FUNCTION dset_random_nextdate(arg_datainicio date, arg_datafim date); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.dset_random_nextdate(arg_datainicio date, arg_datafim date) TO maguita_dps_clone;


--
-- TOC entry 5717 (class 0 OID 0)
-- Dependencies: 594
-- Name: FUNCTION dset_random_nexttimestamptz(min timestamp with time zone, max timestamp with time zone); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.dset_random_nexttimestamptz(min timestamp with time zone, max timestamp with time zone) TO maguita_dps_clone;


--
-- TOC entry 5718 (class 0 OID 0)
-- Dependencies: 577
-- Name: FUNCTION dset_random_serial(length integer); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.dset_random_serial(length integer) TO maguita_dps_clone;


--
-- TOC entry 5719 (class 0 OID 0)
-- Dependencies: 578
-- Name: FUNCTION dset_random_text(length integer); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.dset_random_text(length integer) TO maguita_dps_clone;


--
-- TOC entry 5720 (class 0 OID 0)
-- Dependencies: 579
-- Name: FUNCTION dset_random_text(elements character varying, length integer); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.dset_random_text(elements character varying, length integer) TO maguita_dps_clone;


--
-- TOC entry 5721 (class 0 OID 0)
-- Dependencies: 662
-- Name: FUNCTION dump_functions(VARIADIC schemas text[]); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.dump_functions(VARIADIC schemas text[]) TO maguita_dps_clone;


--
-- TOC entry 5722 (class 0 OID 0)
-- Dependencies: 677
-- Name: FUNCTION duplicates(list jsonb, maps jsonb, aggregate boolean); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.duplicates(list jsonb, maps jsonb, aggregate boolean) TO maguita_dps_clone;


--
-- TOC entry 5723 (class 0 OID 0)
-- Dependencies: 663
-- Name: FUNCTION each(jsonb, force boolean); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.each(jsonb, force boolean) TO maguita_dps_clone;


--
-- TOC entry 5724 (class 0 OID 0)
-- Dependencies: 447
-- Name: FUNCTION eval(expression text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.eval(expression text) TO maguita_dps_clone;


--
-- TOC entry 5725 (class 0 OID 0)
-- Dependencies: 664
-- Name: FUNCTION exception(errocode character varying, text text, hint text, detail text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.exception(errocode character varying, text text, hint text, detail text) TO maguita_dps_clone;


--
-- TOC entry 5726 (class 0 OID 0)
-- Dependencies: 448
-- Name: FUNCTION "extract"(jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib."extract"(jsonb) TO maguita_dps_clone;


--
-- TOC entry 5727 (class 0 OID 0)
-- Dependencies: 665
-- Name: FUNCTION format(jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.format(jsonb) TO maguita_dps_clone;


--
-- TOC entry 5728 (class 0 OID 0)
-- Dependencies: 666
-- Name: FUNCTION in_day(interval); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.in_day(interval) TO maguita_dps_clone;


--
-- TOC entry 5729 (class 0 OID 0)
-- Dependencies: 667
-- Name: FUNCTION in_hour(interval); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.in_hour(interval) TO maguita_dps_clone;


--
-- TOC entry 5730 (class 0 OID 0)
-- Dependencies: 584
-- Name: FUNCTION in_minute(interval); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.in_minute(interval) TO maguita_dps_clone;


--
-- TOC entry 5731 (class 0 OID 0)
-- Dependencies: 585
-- Name: FUNCTION in_month(interval); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.in_month(interval) TO maguita_dps_clone;


--
-- TOC entry 5732 (class 0 OID 0)
-- Dependencies: 586
-- Name: FUNCTION in_second(interval); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.in_second(interval) TO maguita_dps_clone;


--
-- TOC entry 5733 (class 0 OID 0)
-- Dependencies: 589
-- Name: FUNCTION in_week(interval); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.in_week(interval) TO maguita_dps_clone;


--
-- TOC entry 5734 (class 0 OID 0)
-- Dependencies: 656
-- Name: FUNCTION in_year(interval); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.in_year(interval) TO maguita_dps_clone;


--
-- TOC entry 5735 (class 0 OID 0)
-- Dependencies: 678
-- Name: FUNCTION initials(name character varying); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.initials(name character varying) TO maguita_dps_clone;


--
-- TOC entry 5736 (class 0 OID 0)
-- Dependencies: 657
-- Name: FUNCTION is_bigint(argment text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.is_bigint(argment text) TO maguita_dps_clone;


--
-- TOC entry 5737 (class 0 OID 0)
-- Dependencies: 609
-- Name: FUNCTION is_integer(argment text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.is_integer(argment text) TO maguita_dps_clone;


--
-- TOC entry 5738 (class 0 OID 0)
-- Dependencies: 610
-- Name: FUNCTION is_numeric(argment text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.is_numeric(argment text) TO maguita_dps_clone;


--
-- TOC entry 5739 (class 0 OID 0)
-- Dependencies: 679
-- Name: FUNCTION jsonb_concat(VARIADIC jsonb[]); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.jsonb_concat(VARIADIC jsonb[]) TO maguita_dps_clone;


--
-- TOC entry 5740 (class 0 OID 0)
-- Dependencies: 680
-- Name: FUNCTION jsonb_iterate(document jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.jsonb_iterate(document jsonb) TO maguita_dps_clone;


--
-- TOC entry 5741 (class 0 OID 0)
-- Dependencies: 449
-- Name: FUNCTION jsonb_iterate_cascade(document jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.jsonb_iterate_cascade(document jsonb) TO maguita_dps_clone;


--
-- TOC entry 5742 (class 0 OID 0)
-- Dependencies: 450
-- Name: FUNCTION jsonb_object_length(object jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.jsonb_object_length(object jsonb) TO maguita_dps_clone;


--
-- TOC entry 5743 (class 0 OID 0)
-- Dependencies: 536
-- Name: FUNCTION jsonb_values(element anyelement, VARIADIC indexes integer[]); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.jsonb_values(element anyelement, VARIADIC indexes integer[]) TO maguita_dps_clone;


--
-- TOC entry 5744 (class 0 OID 0)
-- Dependencies: 537
-- Name: FUNCTION jsonb_values(element anyelement, VARIADIC keys text[]); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.jsonb_values(element anyelement, VARIADIC keys text[]) TO maguita_dps_clone;


--
-- TOC entry 5745 (class 0 OID 0)
-- Dependencies: 541
-- Name: FUNCTION jsonb_values(document jsonb, VARIADIC indexes integer[]); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.jsonb_values(document jsonb, VARIADIC indexes integer[]) TO maguita_dps_clone;


--
-- TOC entry 5746 (class 0 OID 0)
-- Dependencies: 596
-- Name: FUNCTION jsonb_values(document jsonb, VARIADIC keys text[]); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.jsonb_values(document jsonb, VARIADIC keys text[]) TO maguita_dps_clone;


--
-- TOC entry 5747 (class 0 OID 0)
-- Dependencies: 681
-- Name: FUNCTION jsonb_values_as(document jsonb, VARIADIC keys text[]); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.jsonb_values_as(document jsonb, VARIADIC keys text[]) TO maguita_dps_clone;


--
-- TOC entry 5748 (class 0 OID 0)
-- Dependencies: 598
-- Name: FUNCTION money(moneyvalue anyelement); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.money(moneyvalue anyelement) TO maguita_dps_clone;


--
-- TOC entry 5749 (class 0 OID 0)
-- Dependencies: 682
-- Name: FUNCTION represent(number bigint, base text, length integer, lpad character); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.represent(number bigint, base text, length integer, lpad character) TO maguita_dps_clone;


--
-- TOC entry 5750 (class 0 OID 0)
-- Dependencies: 451
-- Name: FUNCTION res(result boolean, message text, data jsonb, error jsonb, level integer); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.res(result boolean, message text, data jsonb, error jsonb, level integer) TO maguita_dps_clone;


--
-- TOC entry 5751 (class 0 OID 0)
-- Dependencies: 684
-- Name: FUNCTION res_exception(errocode character varying, message text, hint text, detail text, context text, user_message text, level integer); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.res_exception(errocode character varying, message text, hint text, detail text, context text, user_message text, level integer) TO maguita_dps_clone;


--
-- TOC entry 5752 (class 0 OID 0)
-- Dependencies: 452
-- Name: FUNCTION res_false(message text, error jsonb, level integer); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.res_false(message text, error jsonb, level integer) TO maguita_dps_clone;


--
-- TOC entry 5753 (class 0 OID 0)
-- Dependencies: 453
-- Name: FUNCTION res_true(data jsonb, message text, level integer); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.res_true(data jsonb, message text, level integer) TO maguita_dps_clone;


--
-- TOC entry 5754 (class 0 OID 0)
-- Dependencies: 454
-- Name: FUNCTION result(result boolean); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result(result boolean) TO maguita_dps_clone;


--
-- TOC entry 5755 (class 0 OID 0)
-- Dependencies: 455
-- Name: FUNCTION result(result boolean, message jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result(result boolean, message jsonb) TO maguita_dps_clone;


--
-- TOC entry 5756 (class 0 OID 0)
-- Dependencies: 599
-- Name: FUNCTION result(result boolean, text text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result(result boolean, text text) TO maguita_dps_clone;


--
-- TOC entry 5757 (class 0 OID 0)
-- Dependencies: 591
-- Name: FUNCTION result_catch(message text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result_catch(message text) TO maguita_dps_clone;


--
-- TOC entry 5758 (class 0 OID 0)
-- Dependencies: 685
-- Name: FUNCTION result_catch(errocode character varying, message text, hint text, detail text, context text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result_catch(errocode character varying, message text, hint text, detail text, context text) TO maguita_dps_clone;


--
-- TOC entry 5759 (class 0 OID 0)
-- Dependencies: 456
-- Name: FUNCTION result_concat(lib.result, lib.result); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result_concat(lib.result, lib.result) TO maguita_dps_clone;


--
-- TOC entry 5760 (class 0 OID 0)
-- Dependencies: 457
-- Name: FUNCTION result_concat(lib.result, jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result_concat(lib.result, jsonb) TO maguita_dps_clone;


--
-- TOC entry 5761 (class 0 OID 0)
-- Dependencies: 686
-- Name: FUNCTION result_exception(text text, errcode character varying, hint text, detail text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result_exception(text text, errcode character varying, hint text, detail text) TO maguita_dps_clone;


--
-- TOC entry 5762 (class 0 OID 0)
-- Dependencies: 458
-- Name: FUNCTION result_false(content jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result_false(content jsonb) TO maguita_dps_clone;


--
-- TOC entry 5763 (class 0 OID 0)
-- Dependencies: 459
-- Name: FUNCTION result_false(message text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result_false(message text) TO maguita_dps_clone;


--
-- TOC entry 5764 (class 0 OID 0)
-- Dependencies: 460
-- Name: FUNCTION result_remove(lib.result, integer); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result_remove(lib.result, integer) TO maguita_dps_clone;


--
-- TOC entry 5765 (class 0 OID 0)
-- Dependencies: 461
-- Name: FUNCTION result_remove(lib.result, text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result_remove(lib.result, text) TO maguita_dps_clone;


--
-- TOC entry 5766 (class 0 OID 0)
-- Dependencies: 462
-- Name: FUNCTION result_true(); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result_true() TO maguita_dps_clone;


--
-- TOC entry 5767 (class 0 OID 0)
-- Dependencies: 463
-- Name: FUNCTION result_true(content jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result_true(content jsonb) TO maguita_dps_clone;


--
-- TOC entry 5768 (class 0 OID 0)
-- Dependencies: 464
-- Name: FUNCTION result_true(message text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.result_true(message text) TO maguita_dps_clone;


--
-- TOC entry 5769 (class 0 OID 0)
-- Dependencies: 687
-- Name: FUNCTION sets(_row anyelement, replacer jsonb, defaults text[], ref jsonb, t_where text, "with" jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.sets(_row anyelement, replacer jsonb, defaults text[], ref jsonb, t_where text, "with" jsonb) TO maguita_dps_clone;


--
-- TOC entry 5770 (class 0 OID 0)
-- Dependencies: 465
-- Name: FUNCTION sets_defaults(anyelement, replacer jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.sets_defaults(anyelement, replacer jsonb) TO maguita_dps_clone;


--
-- TOC entry 5771 (class 0 OID 0)
-- Dependencies: 688
-- Name: FUNCTION sets_defaults(regclass, replacer jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.sets_defaults(regclass, replacer jsonb) TO maguita_dps_clone;


--
-- TOC entry 5772 (class 0 OID 0)
-- Dependencies: 691
-- Name: FUNCTION sets_doc(regclass, doc jsonb, defaults name[], ref jsonb, t_where text, "with" jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.sets_doc(regclass, doc jsonb, defaults name[], ref jsonb, t_where text, "with" jsonb) TO maguita_dps_clone;


--
-- TOC entry 5773 (class 0 OID 0)
-- Dependencies: 668
-- Name: FUNCTION sets_doc_in(regclass, doc jsonb, "with" jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.sets_doc_in(regclass, doc jsonb, "with" jsonb) TO maguita_dps_clone;


--
-- TOC entry 5774 (class 0 OID 0)
-- Dependencies: 466
-- Name: FUNCTION sets_doc_up(regclass, doc jsonb, defaults text[], ref jsonb, t_where text, "with" jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.sets_doc_up(regclass, doc jsonb, defaults text[], ref jsonb, t_where text, "with" jsonb) TO maguita_dps_clone;


--
-- TOC entry 5775 (class 0 OID 0)
-- Dependencies: 467
-- Name: FUNCTION sets_in(_row anyelement, replacer jsonb, "with" jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.sets_in(_row anyelement, replacer jsonb, "with" jsonb) TO maguita_dps_clone;


--
-- TOC entry 5776 (class 0 OID 0)
-- Dependencies: 669
-- Name: FUNCTION sets_pks(regclass); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.sets_pks(regclass) TO maguita_dps_clone;


--
-- TOC entry 5777 (class 0 OID 0)
-- Dependencies: 670
-- Name: FUNCTION sets_pks_array(regclass); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.sets_pks_array(regclass) TO maguita_dps_clone;


--
-- TOC entry 5778 (class 0 OID 0)
-- Dependencies: 671
-- Name: FUNCTION sets_ref(_record anyelement); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.sets_ref(_record anyelement) TO maguita_dps_clone;


--
-- TOC entry 5779 (class 0 OID 0)
-- Dependencies: 672
-- Name: FUNCTION sets_ref(jsonb, name[]); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.sets_ref(jsonb, name[]) TO maguita_dps_clone;


--
-- TOC entry 5780 (class 0 OID 0)
-- Dependencies: 692
-- Name: FUNCTION sets_ref("table" regclass, document jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.sets_ref("table" regclass, document jsonb) TO maguita_dps_clone;


--
-- TOC entry 5781 (class 0 OID 0)
-- Dependencies: 693
-- Name: FUNCTION sets_ref_clean("table" regclass, document jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.sets_ref_clean("table" regclass, document jsonb) TO maguita_dps_clone;


--
-- TOC entry 5782 (class 0 OID 0)
-- Dependencies: 694
-- Name: FUNCTION sets_up(_row anyelement, replacer jsonb, defaults text[], ref jsonb, t_where text, "with" jsonb); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.sets_up(_row anyelement, replacer jsonb, defaults text[], ref jsonb, t_where text, "with" jsonb) TO maguita_dps_clone;


--
-- TOC entry 5783 (class 0 OID 0)
-- Dependencies: 468
-- Name: FUNCTION str_is_numeric_sequence(argment text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.str_is_numeric_sequence(argment text) TO maguita_dps_clone;


--
-- TOC entry 5784 (class 0 OID 0)
-- Dependencies: 469
-- Name: FUNCTION str_nospace(text); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.str_nospace(text) TO maguita_dps_clone;


--
-- TOC entry 5785 (class 0 OID 0)
-- Dependencies: 673
-- Name: FUNCTION switch(anyelement, VARIADIC list anyarray); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.switch(anyelement, VARIADIC list anyarray) TO maguita_dps_clone;


--
-- TOC entry 5786 (class 0 OID 0)
-- Dependencies: 674
-- Name: FUNCTION swith(VARIADIC list anyarray); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.swith(VARIADIC list anyarray) TO maguita_dps_clone;


--
-- TOC entry 5787 (class 0 OID 0)
-- Dependencies: 470
-- Name: FUNCTION version(); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.version() TO maguita_dps_clone;


--
-- TOC entry 5788 (class 0 OID 0)
-- Dependencies: 471
-- Name: FUNCTION "when"(boolean, _then anyelement, _else anyelement); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib."when"(boolean, _then anyelement, _else anyelement) TO maguita_dps_clone;


--
-- TOC entry 5796 (class 0 OID 0)
-- Dependencies: 602
-- Name: FUNCTION any_equal(anyelement, VARIADIC name name[]); Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON FUNCTION map.any_equal(anyelement, VARIADIC name name[]) TO maguita_dps_clone;


--
-- TOC entry 5797 (class 0 OID 0)
-- Dependencies: 603
-- Name: FUNCTION "array"(anyelement, VARIADIC name name[]); Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON FUNCTION map."array"(anyelement, VARIADIC name name[]) TO maguita_dps_clone;


--
-- TOC entry 5798 (class 0 OID 0)
-- Dependencies: 604
-- Name: FUNCTION as_json(); Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON FUNCTION map.as_json() TO maguita_dps_clone;


--
-- TOC entry 5799 (class 0 OID 0)
-- Dependencies: 707
-- Name: FUNCTION constant(name name, type regtype, val anyelement, description character varying, editable boolean, comment character varying); Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON FUNCTION map.constant(name name, type regtype, val anyelement, description character varying, editable boolean, comment character varying) TO maguita_dps_clone;


--
-- TOC entry 5800 (class 0 OID 0)
-- Dependencies: 472
-- Name: FUNCTION constant_list(VARIADIC name character varying[]); Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON FUNCTION map.constant_list(VARIADIC name character varying[]) TO maguita_dps_clone;


--
-- TOC entry 5801 (class 0 OID 0)
-- Dependencies: 605
-- Name: FUNCTION constant_list(name character varying); Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON FUNCTION map.constant_list(name character varying) TO maguita_dps_clone;


--
-- TOC entry 5802 (class 0 OID 0)
-- Dependencies: 701
-- Name: FUNCTION constant_rename(name name, newname name, force boolean); Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON FUNCTION map.constant_rename(name name, newname name, force boolean) TO maguita_dps_clone;


--
-- TOC entry 5803 (class 0 OID 0)
-- Dependencies: 702
-- Name: FUNCTION constantdrop(arg_constant_name name, arg_dropforce boolean); Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON FUNCTION map.constantdrop(arg_constant_name name, arg_dropforce boolean) TO maguita_dps_clone;


--
-- TOC entry 5804 (class 0 OID 0)
-- Dependencies: 703
-- Name: FUNCTION constants(name character varying); Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON FUNCTION map.constants(name character varying) TO maguita_dps_clone;


--
-- TOC entry 5805 (class 0 OID 0)
-- Dependencies: 704
-- Name: FUNCTION describe(VARIADIC name character varying[]); Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON FUNCTION map.describe(VARIADIC name character varying[]) TO maguita_dps_clone;


--
-- TOC entry 5806 (class 0 OID 0)
-- Dependencies: 705
-- Name: FUNCTION funct_change_constvalue(arg jsonb); Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON FUNCTION map.funct_change_constvalue(arg jsonb) TO maguita_dps_clone;


--
-- TOC entry 5807 (class 0 OID 0)
-- Dependencies: 606
-- Name: FUNCTION funct_load_constvalue(filter jsonb); Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON FUNCTION map.funct_load_constvalue(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 5808 (class 0 OID 0)
-- Dependencies: 639
-- Name: FUNCTION unaccent(text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.unaccent(text) TO maguita_dps_clone;


--
-- TOC entry 5809 (class 0 OID 0)
-- Dependencies: 632
-- Name: FUNCTION unaccent(regdictionary, text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.unaccent(regdictionary, text) TO maguita_dps_clone;


--
-- TOC entry 5810 (class 0 OID 0)
-- Dependencies: 683
-- Name: FUNCTION unaccent_init(internal); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.unaccent_init(internal) TO maguita_dps_clone;


--
-- TOC entry 5811 (class 0 OID 0)
-- Dependencies: 689
-- Name: FUNCTION unaccent_lexize(internal, internal, internal, internal); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.unaccent_lexize(internal, internal, internal, internal) TO maguita_dps_clone;


--
-- TOC entry 5812 (class 0 OID 0)
-- Dependencies: 551
-- Name: FUNCTION uuid_generate_v1(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.uuid_generate_v1() TO maguita_dps_clone;


--
-- TOC entry 5813 (class 0 OID 0)
-- Dependencies: 552
-- Name: FUNCTION uuid_generate_v1mc(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.uuid_generate_v1mc() TO maguita_dps_clone;


--
-- TOC entry 5814 (class 0 OID 0)
-- Dependencies: 553
-- Name: FUNCTION uuid_generate_v3(namespace uuid, name text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.uuid_generate_v3(namespace uuid, name text) TO maguita_dps_clone;


--
-- TOC entry 5815 (class 0 OID 0)
-- Dependencies: 555
-- Name: FUNCTION uuid_generate_v5(namespace uuid, name text); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.uuid_generate_v5(namespace uuid, name text) TO maguita_dps_clone;


--
-- TOC entry 5816 (class 0 OID 0)
-- Dependencies: 546
-- Name: FUNCTION uuid_nil(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.uuid_nil() TO maguita_dps_clone;


--
-- TOC entry 5817 (class 0 OID 0)
-- Dependencies: 547
-- Name: FUNCTION uuid_ns_dns(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.uuid_ns_dns() TO maguita_dps_clone;


--
-- TOC entry 5818 (class 0 OID 0)
-- Dependencies: 549
-- Name: FUNCTION uuid_ns_oid(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.uuid_ns_oid() TO maguita_dps_clone;


--
-- TOC entry 5819 (class 0 OID 0)
-- Dependencies: 548
-- Name: FUNCTION uuid_ns_url(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.uuid_ns_url() TO maguita_dps_clone;


--
-- TOC entry 5820 (class 0 OID 0)
-- Dependencies: 550
-- Name: FUNCTION uuid_ns_x500(); Type: ACL; Schema: public; Owner: -
--

GRANT ALL ON FUNCTION public.uuid_ns_x500() TO maguita_dps_clone;


--
-- TOC entry 5821 (class 0 OID 0)
-- Dependencies: 708
-- Name: FUNCTION artigo_generate_nextcodigo(arg_classe_id uuid); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.artigo_generate_nextcodigo(arg_classe_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5822 (class 0 OID 0)
-- Dependencies: 690
-- Name: FUNCTION artigo_has_open_account(arg_artigo_id uuid); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.artigo_has_open_account(arg_artigo_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5823 (class 0 OID 0)
-- Dependencies: 715
-- Name: FUNCTION artigo_referencia(arg_artigo_id uuid); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.artigo_referencia(arg_artigo_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5824 (class 0 OID 0)
-- Dependencies: 406
-- Name: FUNCTION calculate_cost(arg_precario_quantidade double precision, arg_precario_custo double precision, arg_quantidade double precision); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.calculate_cost(arg_precario_quantidade double precision, arg_precario_custo double precision, arg_quantidade double precision) TO maguita_dps_clone;


--
-- TOC entry 5825 (class 0 OID 0)
-- Dependencies: 563
-- Name: FUNCTION classe_referencia(arg_classe_id uuid); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.classe_referencia(arg_classe_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5826 (class 0 OID 0)
-- Dependencies: 564
-- Name: FUNCTION constant(); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.constant() TO maguita_dps_clone;


--
-- TOC entry 5827 (class 0 OID 0)
-- Dependencies: 473
-- Name: FUNCTION espaco_get_childrens(arg_espaco_id uuid); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.espaco_get_childrens(arg_espaco_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5828 (class 0 OID 0)
-- Dependencies: 716
-- Name: FUNCTION espaco_get_childrens_static(arg_espaco_id uuid); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.espaco_get_childrens_static(arg_espaco_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5829 (class 0 OID 0)
-- Dependencies: 565
-- Name: FUNCTION espaco_get_parent(arg_espaco_id uuid); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.espaco_get_parent(arg_espaco_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5830 (class 0 OID 0)
-- Dependencies: 724
-- Name: FUNCTION __space_branch_level(_espaco_id uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__space_branch_level(_espaco_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5841 (class 0 OID 0)
-- Dependencies: 240
-- Name: TABLE espaco; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.espaco TO maguita_dps_clone;


--
-- TOC entry 5842 (class 0 OID 0)
-- Dependencies: 709
-- Name: FUNCTION espaco_get_serializer(arg_espaco_id uuid); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.espaco_get_serializer(arg_espaco_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5860 (class 0 OID 0)
-- Dependencies: 241
-- Name: TABLE movimento; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.movimento TO maguita_dps_clone;


--
-- TOC entry 5861 (class 0 OID 0)
-- Dependencies: 717
-- Name: FUNCTION movimento_create(arg_espaco_auth uuid, arg_colaborador_id uuid, arg_stock_id uuid, arg_toperacao_id smallint, arg_movimento_referencia jsonb, arg_movimento_quantidade double precision, arg_tmovimento_id smallint, arg_movimento_quantidadefinal double precision, arg_movimento_data date, arg_movimento_documento character varying); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.movimento_create(arg_espaco_auth uuid, arg_colaborador_id uuid, arg_stock_id uuid, arg_toperacao_id smallint, arg_movimento_referencia jsonb, arg_movimento_quantidade double precision, arg_tmovimento_id smallint, arg_movimento_quantidadefinal double precision, arg_movimento_data date, arg_movimento_documento character varying) TO maguita_dps_clone;


--
-- TOC entry 5862 (class 0 OID 0)
-- Dependencies: 710
-- Name: FUNCTION movimento_revert(arg_espaco_auth uuid, arg_colaborador_id uuid, arg_toperacao_id smallint, arg_movimento_tmovimento_id smallint, arg_referencia_key character varying, arg_referencia_value text, arg_movimento_estado smallint, arg_movimento_observacao character varying); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.movimento_revert(arg_espaco_auth uuid, arg_colaborador_id uuid, arg_toperacao_id smallint, arg_movimento_tmovimento_id smallint, arg_referencia_key character varying, arg_referencia_value text, arg_movimento_estado smallint, arg_movimento_observacao character varying) TO maguita_dps_clone;


--
-- TOC entry 5873 (class 0 OID 0)
-- Dependencies: 242
-- Name: TABLE taxa; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.taxa TO maguita_dps_clone;


--
-- TOC entry 5874 (class 0 OID 0)
-- Dependencies: 718
-- Name: FUNCTION taxa_espaco(_taxa tweeks.taxa, _const map.constant, arg_espaco_auth uuid); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.taxa_espaco(_taxa tweeks.taxa, _const map.constant, arg_espaco_auth uuid) TO maguita_dps_clone;


--
-- TOC entry 5875 (class 0 OID 0)
-- Dependencies: 480
-- Name: FUNCTION taxa_retirar_percentagem_adicionada(arg_value double precision, arg_percentagem double precision); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.taxa_retirar_percentagem_adicionada(arg_value double precision, arg_percentagem double precision) TO maguita_dps_clone;


--
-- TOC entry 5876 (class 0 OID 0)
-- Dependencies: 481
-- Name: FUNCTION tg_amortizacao_afeter_insert_syncronize_montante(); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.tg_amortizacao_afeter_insert_syncronize_montante() TO maguita_dps_clone;


--
-- TOC entry 5877 (class 0 OID 0)
-- Dependencies: 566
-- Name: FUNCTION tg_caixa_after_insert_abrir_posto(); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.tg_caixa_after_insert_abrir_posto() TO maguita_dps_clone;


--
-- TOC entry 5878 (class 0 OID 0)
-- Dependencies: 719
-- Name: FUNCTION tg_caixa_after_updade_fechar_posto(); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.tg_caixa_after_updade_fechar_posto() TO maguita_dps_clone;


--
-- TOC entry 5879 (class 0 OID 0)
-- Dependencies: 720
-- Name: FUNCTION tg_conta_after_update_adjust_venda_estado(); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.tg_conta_after_update_adjust_venda_estado() TO maguita_dps_clone;


--
-- TOC entry 5880 (class 0 OID 0)
-- Dependencies: 482
-- Name: FUNCTION tg_retalho_after_insert_create_movimento(); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.tg_retalho_after_insert_create_movimento() TO maguita_dps_clone;


--
-- TOC entry 5881 (class 0 OID 0)
-- Dependencies: 711
-- Name: FUNCTION tg_stock_after_update(); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.tg_stock_after_update() TO maguita_dps_clone;


--
-- TOC entry 5882 (class 0 OID 0)
-- Dependencies: 712
-- Name: FUNCTION tg_stock_before_insert_or_update_check_quantidade(); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.tg_stock_before_insert_or_update_check_quantidade() TO maguita_dps_clone;


--
-- TOC entry 5883 (class 0 OID 0)
-- Dependencies: 593
-- Name: FUNCTION tg_transacao_after_insert_adjust_posto_montante(); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.tg_transacao_after_insert_adjust_posto_montante() TO maguita_dps_clone;


--
-- TOC entry 5884 (class 0 OID 0)
-- Dependencies: 713
-- Name: FUNCTION tg_venda_after_insert_create_movimento(); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.tg_venda_after_insert_create_movimento() TO maguita_dps_clone;


--
-- TOC entry 5885 (class 0 OID 0)
-- Dependencies: 721
-- Name: FUNCTION tg_venda_after_update_adjust_agrega_estado(); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.tg_venda_after_update_adjust_agrega_estado() TO maguita_dps_clone;


--
-- TOC entry 5886 (class 0 OID 0)
-- Dependencies: 485
-- Name: FUNCTION tg_venda_after_update_adjust_conta_montante(); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.tg_venda_after_update_adjust_conta_montante() TO maguita_dps_clone;


--
-- TOC entry 5887 (class 0 OID 0)
-- Dependencies: 714
-- Name: FUNCTION tg_venda_after_update_create_or_cansel_movimento(); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.tg_venda_after_update_create_or_cansel_movimento() TO maguita_dps_clone;


--
-- TOC entry 5888 (class 0 OID 0)
-- Dependencies: 483
-- Name: FUNCTION tipoimposto_referencia(arg_tipoimposto_id uuid); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.tipoimposto_referencia(arg_tipoimposto_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5906 (class 0 OID 0)
-- Dependencies: 243
-- Name: TABLE transacao; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.transacao TO maguita_dps_clone;


--
-- TOC entry 5907 (class 0 OID 0)
-- Dependencies: 722
-- Name: FUNCTION transacao_create(arg_espaco_auth uuid, arg_posto_id uuid, arg_toperacao_id smallint, arg_tmovimento_id smallint, arg_colaborador_id integer, arg_transacao_montante double precision, arg_transacao_documento character varying, arg_transacao_referencia jsonb, arg_transacao_zera boolean, arg_transacao_observacao character varying); Type: ACL; Schema: rule; Owner: -
--

GRANT ALL ON FUNCTION rule.transacao_create(arg_espaco_auth uuid, arg_posto_id uuid, arg_toperacao_id smallint, arg_tmovimento_id smallint, arg_colaborador_id integer, arg_transacao_montante double precision, arg_transacao_documento character varying, arg_transacao_referencia jsonb, arg_transacao_zera boolean, arg_transacao_observacao character varying) TO maguita_dps_clone;


--
-- TOC entry 5908 (class 0 OID 0)
-- Dependencies: 865
-- Name: FUNCTION ___override_auth_funct_autenticacao(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.___override_auth_funct_autenticacao(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5909 (class 0 OID 0)
-- Dependencies: 792
-- Name: FUNCTION ___override_auth_funct_load_grants(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.___override_auth_funct_load_grants(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5910 (class 0 OID 0)
-- Dependencies: 793
-- Name: FUNCTION ___override_auth_funct_load_menu(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.___override_auth_funct_load_menu(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5911 (class 0 OID 0)
-- Dependencies: 487
-- Name: FUNCTION __artigo_has_stock(arg_artigo_id uuid, arg_espaco_id uuid, arg_quantidadedebito double precision); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__artigo_has_stock(arg_artigo_id uuid, arg_espaco_id uuid, arg_quantidadedebito double precision) TO maguita_dps_clone;


--
-- TOC entry 5926 (class 0 OID 0)
-- Dependencies: 244
-- Name: TABLE menu; Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON TABLE auth.menu TO maguita_dps_clone;


--
-- TOC entry 5927 (class 0 OID 0)
-- Dependencies: 794
-- Name: FUNCTION __branch_menu(_branch_uid uuid, _user uuid, _espaco uuid, _force boolean); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__branch_menu(_branch_uid uuid, _user uuid, _espaco uuid, _force boolean) TO maguita_dps_clone;


--
-- TOC entry 5928 (class 0 OID 0)
-- Dependencies: 486
-- Name: FUNCTION __branch_uid(_colaborador_uid uuid, _espaco_uid uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__branch_uid(_colaborador_uid uuid, _espaco_uid uuid) TO maguita_dps_clone;


--
-- TOC entry 5929 (class 0 OID 0)
-- Dependencies: 795
-- Name: FUNCTION __check_stock_on_venda(_espaco_auth uuid, _vendas jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__check_stock_on_venda(_espaco_auth uuid, _vendas jsonb) TO maguita_dps_clone;


--
-- TOC entry 5930 (class 0 OID 0)
-- Dependencies: 726
-- Name: FUNCTION __cluster_filter_branch(share character varying, _object cluster.object, _collector cluster.collector, _cluster cluster.cluster, _origin cluster.cluster); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__cluster_filter_branch(share character varying, _object cluster.object, _collector cluster.collector, _cluster cluster.cluster, _origin cluster.cluster) TO maguita_dps_clone;


--
-- TOC entry 5931 (class 0 OID 0)
-- Dependencies: 798
-- Name: FUNCTION __conta_adjust(arg_cliente_id uuid, arg_conta_id uuid, _const map.constant); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__conta_adjust(arg_cliente_id uuid, arg_conta_id uuid, _const map.constant) TO maguita_dps_clone;


--
-- TOC entry 5932 (class 0 OID 0)
-- Dependencies: 488
-- Name: FUNCTION __generate_acerto_code(brc uuid, user_brc uuid, space_brc uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__generate_acerto_code(brc uuid, user_brc uuid, space_brc uuid) TO maguita_dps_clone;


--
-- TOC entry 5933 (class 0 OID 0)
-- Dependencies: 729
-- Name: FUNCTION __generate_artigo_code(arg_classe_id uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__generate_artigo_code(arg_classe_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5934 (class 0 OID 0)
-- Dependencies: 727
-- Name: FUNCTION __generate_caixa_code(brc uuid, user_brc uuid, space_brc uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__generate_caixa_code(brc uuid, user_brc uuid, space_brc uuid) TO maguita_dps_clone;


--
-- TOC entry 5935 (class 0 OID 0)
-- Dependencies: 489
-- Name: FUNCTION __generate_classe_code(brc uuid, user_brc uuid, space_brc uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__generate_classe_code(brc uuid, user_brc uuid, space_brc uuid) TO maguita_dps_clone;


--
-- TOC entry 5936 (class 0 OID 0)
-- Dependencies: 799
-- Name: FUNCTION __generate_cliente_code(colaborador uuid, espaco uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__generate_cliente_code(colaborador uuid, espaco uuid) TO maguita_dps_clone;


--
-- TOC entry 5937 (class 0 OID 0)
-- Dependencies: 490
-- Name: FUNCTION __generate_retalho_code(brc uuid, user_brc uuid, space_brc uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__generate_retalho_code(brc uuid, user_brc uuid, space_brc uuid) TO maguita_dps_clone;


--
-- TOC entry 5938 (class 0 OID 0)
-- Dependencies: 245
-- Name: TABLE branch; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON TABLE cluster.branch TO maguita_dps_clone;


--
-- TOC entry 5939 (class 0 OID 0)
-- Dependencies: 491
-- Name: FUNCTION __get_branch(uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__get_branch(uuid) TO maguita_dps_clone;


--
-- TOC entry 5940 (class 0 OID 0)
-- Dependencies: 246
-- Name: TABLE serie; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.serie TO maguita_dps_clone;


--
-- TOC entry 5941 (class 0 OID 0)
-- Dependencies: 492
-- Name: FUNCTION __get_serie_espaco(arg_espaco_auth uuid, arg_tserie integer); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__get_serie_espaco(arg_espaco_auth uuid, arg_tserie integer) TO maguita_dps_clone;


--
-- TOC entry 5942 (class 0 OID 0)
-- Dependencies: 730
-- Name: FUNCTION __infinity_loop(_espaco tweeks.espaco); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__infinity_loop(_espaco tweeks.espaco) TO maguita_dps_clone;


--
-- TOC entry 5943 (class 0 OID 0)
-- Dependencies: 493
-- Name: FUNCTION __lancamento_regularizacao(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__lancamento_regularizacao(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5944 (class 0 OID 0)
-- Dependencies: 731
-- Name: FUNCTION __load_cambio_day(arg_espaco_auth uuid, arg_currency_id smallint, arg_cambio_data date, _const map.constant); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__load_cambio_day(arg_espaco_auth uuid, arg_currency_id smallint, arg_cambio_data date, _const map.constant) TO maguita_dps_clone;


--
-- TOC entry 5945 (class 0 OID 0)
-- Dependencies: 800
-- Name: FUNCTION __lote(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__lote(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 5946 (class 0 OID 0)
-- Dependencies: 595
-- Name: FUNCTION __precario(jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__precario(jsonb) TO maguita_dps_clone;


--
-- TOC entry 5947 (class 0 OID 0)
-- Dependencies: 494
-- Name: FUNCTION __sync_branch_map(); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__sync_branch_map() TO maguita_dps_clone;


--
-- TOC entry 5948 (class 0 OID 0)
-- Dependencies: 732
-- Name: FUNCTION __tg_before_update_classe(); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__tg_before_update_classe() TO maguita_dps_clone;


--
-- TOC entry 5949 (class 0 OID 0)
-- Dependencies: 733
-- Name: FUNCTION __tg_conta_after_close(); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__tg_conta_after_close() TO maguita_dps_clone;


--
-- TOC entry 5950 (class 0 OID 0)
-- Dependencies: 734
-- Name: FUNCTION __tg_create_lancamento(); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__tg_create_lancamento() TO maguita_dps_clone;


--
-- TOC entry 5951 (class 0 OID 0)
-- Dependencies: 728
-- Name: FUNCTION __tg_fluxo_on_acerto(); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__tg_fluxo_on_acerto() TO maguita_dps_clone;


--
-- TOC entry 5952 (class 0 OID 0)
-- Dependencies: 735
-- Name: FUNCTION __tg_fluxo_on_entrada(); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__tg_fluxo_on_entrada() TO maguita_dps_clone;


--
-- TOC entry 5953 (class 0 OID 0)
-- Dependencies: 801
-- Name: FUNCTION __tg_fluxo_on_retalho(); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__tg_fluxo_on_retalho() TO maguita_dps_clone;


--
-- TOC entry 5954 (class 0 OID 0)
-- Dependencies: 736
-- Name: FUNCTION __tg_fluxo_on_transferencia(); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__tg_fluxo_on_transferencia() TO maguita_dps_clone;


--
-- TOC entry 5955 (class 0 OID 0)
-- Dependencies: 496
-- Name: FUNCTION __tg_fluxo_on_venda(); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__tg_fluxo_on_venda() TO maguita_dps_clone;


--
-- TOC entry 5956 (class 0 OID 0)
-- Dependencies: 737
-- Name: FUNCTION __tg_use_branch(); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.__tg_use_branch() TO maguita_dps_clone;


--
-- TOC entry 5970 (class 0 OID 0)
-- Dependencies: 247
-- Name: TABLE artigo; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.artigo TO maguita_dps_clone;


--
-- TOC entry 5971 (class 0 OID 0)
-- Dependencies: 738
-- Name: FUNCTION _get_artigo(arg_atigo_id uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks._get_artigo(arg_atigo_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5972 (class 0 OID 0)
-- Dependencies: 739
-- Name: FUNCTION _get_branch_by_colaborador(uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks._get_branch_by_colaborador(uuid) TO maguita_dps_clone;


--
-- TOC entry 5973 (class 0 OID 0)
-- Dependencies: 740
-- Name: FUNCTION _get_branch_by_espaco(uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks._get_branch_by_espaco(uuid) TO maguita_dps_clone;


--
-- TOC entry 5986 (class 0 OID 0)
-- Dependencies: 248
-- Name: TABLE caixa; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.caixa TO maguita_dps_clone;


--
-- TOC entry 5987 (class 0 OID 0)
-- Dependencies: 741
-- Name: FUNCTION _get_caixa(arg_caixa_id uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks._get_caixa(arg_caixa_id uuid) TO maguita_dps_clone;


--
-- TOC entry 5995 (class 0 OID 0)
-- Dependencies: 249
-- Name: TABLE classe; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.classe TO maguita_dps_clone;


--
-- TOC entry 5996 (class 0 OID 0)
-- Dependencies: 742
-- Name: FUNCTION _get_classe(arg_classe_id uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks._get_classe(arg_classe_id uuid) TO maguita_dps_clone;


--
-- TOC entry 6014 (class 0 OID 0)
-- Dependencies: 250
-- Name: TABLE conta; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.conta TO maguita_dps_clone;


--
-- TOC entry 6015 (class 0 OID 0)
-- Dependencies: 743
-- Name: FUNCTION _get_conta(arg_conta_id uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks._get_conta(arg_conta_id uuid) TO maguita_dps_clone;


--
-- TOC entry 6016 (class 0 OID 0)
-- Dependencies: 744
-- Name: FUNCTION _get_espaco(arg_espaco_id uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks._get_espaco(arg_espaco_id uuid) TO maguita_dps_clone;


--
-- TOC entry 6017 (class 0 OID 0)
-- Dependencies: 780
-- Name: FUNCTION _get_impostos_taxa(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks._get_impostos_taxa(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6018 (class 0 OID 0)
-- Dependencies: 497
-- Name: FUNCTION _get_item(arg_artigo_item uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks._get_item(arg_artigo_item uuid) TO maguita_dps_clone;


--
-- TOC entry 6032 (class 0 OID 0)
-- Dependencies: 251
-- Name: TABLE link; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.link TO maguita_dps_clone;


--
-- TOC entry 6033 (class 0 OID 0)
-- Dependencies: 498
-- Name: FUNCTION _get_link(arg_link_id uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks._get_link(arg_link_id uuid) TO maguita_dps_clone;


--
-- TOC entry 6043 (class 0 OID 0)
-- Dependencies: 252
-- Name: TABLE posto; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.posto TO maguita_dps_clone;


--
-- TOC entry 6044 (class 0 OID 0)
-- Dependencies: 499
-- Name: FUNCTION _get_posto(arg_posto_id uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks._get_posto(arg_posto_id uuid) TO maguita_dps_clone;


--
-- TOC entry 6045 (class 0 OID 0)
-- Dependencies: 505
-- Name: FUNCTION _get_stock(_artigo_id uuid, _espaco_id uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks._get_stock(_artigo_id uuid, _espaco_id uuid) TO maguita_dps_clone;


--
-- TOC entry 6050 (class 0 OID 0)
-- Dependencies: 253
-- Name: TABLE tmovimento; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.tmovimento TO maguita_dps_clone;


--
-- TOC entry 6051 (class 0 OID 0)
-- Dependencies: 500
-- Name: FUNCTION _get_tmovimento(arg_tmovimento_id smallint); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks._get_tmovimento(arg_tmovimento_id smallint) TO maguita_dps_clone;


--
-- TOC entry 6068 (class 0 OID 0)
-- Dependencies: 254
-- Name: TABLE venda; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.venda TO maguita_dps_clone;


--
-- TOC entry 6069 (class 0 OID 0)
-- Dependencies: 745
-- Name: FUNCTION _get_venda(arg_venda_id uuid); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks._get_venda(arg_venda_id uuid) TO maguita_dps_clone;


--
-- TOC entry 6070 (class 0 OID 0)
-- Dependencies: 803
-- Name: FUNCTION funct_change_artigo_estado(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_artigo_estado(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6071 (class 0 OID 0)
-- Dependencies: 748
-- Name: FUNCTION funct_change_chave_restore(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_chave_restore(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6072 (class 0 OID 0)
-- Dependencies: 749
-- Name: FUNCTION funct_change_classe_estado(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_classe_estado(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6073 (class 0 OID 0)
-- Dependencies: 804
-- Name: FUNCTION funct_change_colaborador(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_colaborador(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6074 (class 0 OID 0)
-- Dependencies: 506
-- Name: FUNCTION funct_change_conta(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_conta(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6075 (class 0 OID 0)
-- Dependencies: 805
-- Name: FUNCTION funct_change_conta_imprimir(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_conta_imprimir(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6076 (class 0 OID 0)
-- Dependencies: 507
-- Name: FUNCTION funct_change_conta_preparar(args json); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_conta_preparar(args json) TO maguita_dps_clone;


--
-- TOC entry 6077 (class 0 OID 0)
-- Dependencies: 750
-- Name: FUNCTION funct_change_espaco(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_espaco(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6078 (class 0 OID 0)
-- Dependencies: 751
-- Name: FUNCTION funct_change_espaco_configuracao(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_espaco_configuracao(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6079 (class 0 OID 0)
-- Dependencies: 806
-- Name: FUNCTION funct_change_espaco_estado(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_espaco_estado(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6080 (class 0 OID 0)
-- Dependencies: 509
-- Name: FUNCTION funct_change_espaco_migrate(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_espaco_migrate(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6081 (class 0 OID 0)
-- Dependencies: 510
-- Name: FUNCTION funct_change_fornecedor_estado(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_fornecedor_estado(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6082 (class 0 OID 0)
-- Dependencies: 752
-- Name: FUNCTION funct_change_item_estado(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_item_estado(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6083 (class 0 OID 0)
-- Dependencies: 807
-- Name: FUNCTION funct_change_link_disable(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_link_disable(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6084 (class 0 OID 0)
-- Dependencies: 808
-- Name: FUNCTION funct_change_link_move(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_link_move(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6085 (class 0 OID 0)
-- Dependencies: 753
-- Name: FUNCTION funct_change_link_switch(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_link_switch(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6086 (class 0 OID 0)
-- Dependencies: 511
-- Name: FUNCTION funct_change_link_unlink(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_link_unlink(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6087 (class 0 OID 0)
-- Dependencies: 754
-- Name: FUNCTION funct_change_mesa(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_mesa(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6088 (class 0 OID 0)
-- Dependencies: 755
-- Name: FUNCTION funct_change_mesa_estado(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_mesa_estado(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6089 (class 0 OID 0)
-- Dependencies: 756
-- Name: FUNCTION funct_change_ordem_classe(parms jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_ordem_classe(parms jsonb) TO maguita_dps_clone;


--
-- TOC entry 6090 (class 0 OID 0)
-- Dependencies: 809
-- Name: FUNCTION funct_change_posto_estado(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_posto_estado(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6091 (class 0 OID 0)
-- Dependencies: 512
-- Name: FUNCTION funct_change_posto_open(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_posto_open(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6092 (class 0 OID 0)
-- Dependencies: 513
-- Name: FUNCTION funct_change_tipoimposto_estado(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_tipoimposto_estado(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6093 (class 0 OID 0)
-- Dependencies: 597
-- Name: FUNCTION funct_change_venda(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_change_venda(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6094 (class 0 OID 0)
-- Dependencies: 791
-- Name: FUNCTION funct_generate_chave(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_generate_chave(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6095 (class 0 OID 0)
-- Dependencies: 757
-- Name: FUNCTION funct_load_acerto(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_acerto(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6096 (class 0 OID 0)
-- Dependencies: 810
-- Name: FUNCTION funct_load_artig_check_nome(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_artig_check_nome(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6097 (class 0 OID 0)
-- Dependencies: 892
-- Name: FUNCTION funct_load_artigo(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_artigo(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6098 (class 0 OID 0)
-- Dependencies: 759
-- Name: FUNCTION funct_load_artigo_associar(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_artigo_associar(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6099 (class 0 OID 0)
-- Dependencies: 858
-- Name: FUNCTION funct_load_artigo_base(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_artigo_base(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6100 (class 0 OID 0)
-- Dependencies: 811
-- Name: FUNCTION funct_load_artigo_data(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_artigo_data(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6101 (class 0 OID 0)
-- Dependencies: 521
-- Name: FUNCTION funct_load_artigo_simple(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_artigo_simple(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6102 (class 0 OID 0)
-- Dependencies: 814
-- Name: FUNCTION funct_load_branch(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_branch(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6103 (class 0 OID 0)
-- Dependencies: 760
-- Name: FUNCTION funct_load_caixa(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_caixa(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6104 (class 0 OID 0)
-- Dependencies: 815
-- Name: FUNCTION funct_load_caixa_by_colaborador(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_caixa_by_colaborador(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6105 (class 0 OID 0)
-- Dependencies: 523
-- Name: FUNCTION funct_load_cambio_ativo(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_cambio_ativo(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6106 (class 0 OID 0)
-- Dependencies: 522
-- Name: FUNCTION funct_load_cambio_history(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_cambio_history(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6107 (class 0 OID 0)
-- Dependencies: 905
-- Name: FUNCTION funct_load_chave(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_chave(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6108 (class 0 OID 0)
-- Dependencies: 869
-- Name: FUNCTION funct_load_classe(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_classe(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6109 (class 0 OID 0)
-- Dependencies: 816
-- Name: FUNCTION funct_load_classe_simple_report(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_classe_simple_report(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6110 (class 0 OID 0)
-- Dependencies: 817
-- Name: FUNCTION funct_load_cliente(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_cliente(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6111 (class 0 OID 0)
-- Dependencies: 525
-- Name: FUNCTION funct_load_cluster_by_branch(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_cluster_by_branch(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6112 (class 0 OID 0)
-- Dependencies: 526
-- Name: FUNCTION funct_load_colaborador(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_colaborador(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6113 (class 0 OID 0)
-- Dependencies: 527
-- Name: FUNCTION funct_load_conta_by_caixa(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_conta_by_caixa(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6114 (class 0 OID 0)
-- Dependencies: 819
-- Name: FUNCTION funct_load_conta_preparacao(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_conta_preparacao(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6115 (class 0 OID 0)
-- Dependencies: 768
-- Name: FUNCTION funct_load_deposito_data(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_deposito_data(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6116 (class 0 OID 0)
-- Dependencies: 820
-- Name: FUNCTION funct_load_device_unregistered(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_device_unregistered(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6117 (class 0 OID 0)
-- Dependencies: 769
-- Name: FUNCTION funct_load_entrada(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_entrada(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6118 (class 0 OID 0)
-- Dependencies: 821
-- Name: FUNCTION funct_load_espaco(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_espaco(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6119 (class 0 OID 0)
-- Dependencies: 528
-- Name: FUNCTION funct_load_espaco_configuracao(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_espaco_configuracao(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6120 (class 0 OID 0)
-- Dependencies: 822
-- Name: FUNCTION funct_load_espaco_migrate(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_espaco_migrate(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6121 (class 0 OID 0)
-- Dependencies: 530
-- Name: FUNCTION funct_load_espaco_simple(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_espaco_simple(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6122 (class 0 OID 0)
-- Dependencies: 770
-- Name: FUNCTION funct_load_fornecedor(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_fornecedor(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6123 (class 0 OID 0)
-- Dependencies: 771
-- Name: FUNCTION funct_load_fornecedor_simple(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_fornecedor_simple(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6124 (class 0 OID 0)
-- Dependencies: 772
-- Name: FUNCTION funct_load_guia_data(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_guia_data(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6125 (class 0 OID 0)
-- Dependencies: 773
-- Name: FUNCTION funct_load_items_simple(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_items_simple(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6126 (class 0 OID 0)
-- Dependencies: 774
-- Name: FUNCTION funct_load_lancamento(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_lancamento(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6127 (class 0 OID 0)
-- Dependencies: 725
-- Name: FUNCTION funct_load_mesa(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_mesa(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6128 (class 0 OID 0)
-- Dependencies: 508
-- Name: FUNCTION funct_load_mesa_livre(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_mesa_livre(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6129 (class 0 OID 0)
-- Dependencies: 529
-- Name: FUNCTION funct_load_posto(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_posto(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6130 (class 0 OID 0)
-- Dependencies: 818
-- Name: FUNCTION funct_load_posto_by_endereco(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_posto_by_endereco(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6131 (class 0 OID 0)
-- Dependencies: 531
-- Name: FUNCTION funct_load_posto_closed(); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_posto_closed() TO maguita_dps_clone;


--
-- TOC entry 6132 (class 0 OID 0)
-- Dependencies: 532
-- Name: FUNCTION funct_load_posto_simple(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_posto_simple(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6133 (class 0 OID 0)
-- Dependencies: 533
-- Name: FUNCTION funct_load_posto_status(filters jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_posto_status(filters jsonb) TO maguita_dps_clone;


--
-- TOC entry 6134 (class 0 OID 0)
-- Dependencies: 887
-- Name: FUNCTION funct_load_serie(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_serie(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6135 (class 0 OID 0)
-- Dependencies: 823
-- Name: FUNCTION funct_load_stoks(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_stoks(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6136 (class 0 OID 0)
-- Dependencies: 775
-- Name: FUNCTION funct_load_tespaco(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_tespaco(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6137 (class 0 OID 0)
-- Dependencies: 824
-- Name: FUNCTION funct_load_tipoimposto(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_tipoimposto(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6138 (class 0 OID 0)
-- Dependencies: 534
-- Name: FUNCTION funct_load_tpaga(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_tpaga(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6139 (class 0 OID 0)
-- Dependencies: 825
-- Name: FUNCTION funct_load_trabalha(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_trabalha(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6140 (class 0 OID 0)
-- Dependencies: 535
-- Name: FUNCTION funct_load_transferencia(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_load_transferencia(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6141 (class 0 OID 0)
-- Dependencies: 776
-- Name: FUNCTION funct_pos__calc_imposto(arg_artigo_id uuid, montante double precision, args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos__calc_imposto(arg_artigo_id uuid, montante double precision, args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6142 (class 0 OID 0)
-- Dependencies: 777
-- Name: FUNCTION funct_pos__sync_conta_amount(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos__sync_conta_amount(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6143 (class 0 OID 0)
-- Dependencies: 826
-- Name: FUNCTION funct_pos_change_caixa_close(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_change_caixa_close(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6144 (class 0 OID 0)
-- Dependencies: 778
-- Name: FUNCTION funct_pos_change_conta_anular(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_change_conta_anular(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6145 (class 0 OID 0)
-- Dependencies: 538
-- Name: FUNCTION funct_pos_change_conta_fechar(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_change_conta_fechar(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6146 (class 0 OID 0)
-- Dependencies: 540
-- Name: FUNCTION funct_pos_change_conta_proforma(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_change_conta_proforma(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6147 (class 0 OID 0)
-- Dependencies: 539
-- Name: FUNCTION funct_pos_generate_key(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_generate_key(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6148 (class 0 OID 0)
-- Dependencies: 867
-- Name: FUNCTION funct_pos_load_artigo(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_load_artigo(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6149 (class 0 OID 0)
-- Dependencies: 827
-- Name: FUNCTION funct_pos_load_artigo_composto(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_load_artigo_composto(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6150 (class 0 OID 0)
-- Dependencies: 723
-- Name: FUNCTION funct_pos_load_artigo_extras(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_load_artigo_extras(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6151 (class 0 OID 0)
-- Dependencies: 870
-- Name: FUNCTION funct_pos_load_artigo_search(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_load_artigo_search(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6152 (class 0 OID 0)
-- Dependencies: 891
-- Name: FUNCTION funct_pos_load_caixa_auth(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_load_caixa_auth(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6153 (class 0 OID 0)
-- Dependencies: 830
-- Name: FUNCTION funct_pos_load_class(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_load_class(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6154 (class 0 OID 0)
-- Dependencies: 542
-- Name: FUNCTION funct_pos_load_cliente(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_load_cliente(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6155 (class 0 OID 0)
-- Dependencies: 829
-- Name: FUNCTION funct_pos_load_colaborador(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_load_colaborador(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6156 (class 0 OID 0)
-- Dependencies: 779
-- Name: FUNCTION funct_pos_load_conta_aberto(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_load_conta_aberto(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6157 (class 0 OID 0)
-- Dependencies: 781
-- Name: FUNCTION funct_pos_load_conta_data(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_load_conta_data(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6158 (class 0 OID 0)
-- Dependencies: 897
-- Name: FUNCTION funct_pos_load_conta_dia(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_load_conta_dia(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6159 (class 0 OID 0)
-- Dependencies: 545
-- Name: FUNCTION funct_pos_load_conta_proforma(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_load_conta_proforma(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6160 (class 0 OID 0)
-- Dependencies: 831
-- Name: FUNCTION funct_pos_load_posto(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_load_posto(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6161 (class 0 OID 0)
-- Dependencies: 543
-- Name: FUNCTION funct_pos_reg_caixa(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_reg_caixa(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6162 (class 0 OID 0)
-- Dependencies: 832
-- Name: FUNCTION funct_pos_reg_cliente(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_reg_cliente(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6163 (class 0 OID 0)
-- Dependencies: 544
-- Name: FUNCTION funct_pos_reg_conta(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_reg_conta(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6164 (class 0 OID 0)
-- Dependencies: 890
-- Name: FUNCTION funct_pos_reg_deposito(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_reg_deposito(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6165 (class 0 OID 0)
-- Dependencies: 859
-- Name: FUNCTION funct_pos_reg_retalho(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_reg_retalho(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6166 (class 0 OID 0)
-- Dependencies: 556
-- Name: FUNCTION funct_pos_reg_venda(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_reg_venda(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6167 (class 0 OID 0)
-- Dependencies: 833
-- Name: FUNCTION funct_pos_reg_vendaimposto(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_pos_reg_vendaimposto(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6168 (class 0 OID 0)
-- Dependencies: 782
-- Name: FUNCTION funct_reg_acerto(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_acerto(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6169 (class 0 OID 0)
-- Dependencies: 600
-- Name: FUNCTION funct_reg_artigo(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_artigo(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6170 (class 0 OID 0)
-- Dependencies: 783
-- Name: FUNCTION funct_reg_cambio(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_cambio(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6171 (class 0 OID 0)
-- Dependencies: 784
-- Name: FUNCTION funct_reg_classe(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_classe(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6172 (class 0 OID 0)
-- Dependencies: 785
-- Name: FUNCTION funct_reg_colaborador(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_colaborador(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6173 (class 0 OID 0)
-- Dependencies: 835
-- Name: FUNCTION funct_reg_dispoe(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_dispoe(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6174 (class 0 OID 0)
-- Dependencies: 559
-- Name: FUNCTION funct_reg_ean(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_ean(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6175 (class 0 OID 0)
-- Dependencies: 836
-- Name: FUNCTION funct_reg_entrada(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_entrada(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6176 (class 0 OID 0)
-- Dependencies: 786
-- Name: FUNCTION funct_reg_espaco(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_espaco(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6177 (class 0 OID 0)
-- Dependencies: 861
-- Name: FUNCTION funct_reg_fornecedor(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_fornecedor(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6178 (class 0 OID 0)
-- Dependencies: 828
-- Name: FUNCTION funct_reg_imposto(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_imposto(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6179 (class 0 OID 0)
-- Dependencies: 837
-- Name: FUNCTION funct_reg_item(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_item(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6180 (class 0 OID 0)
-- Dependencies: 560
-- Name: FUNCTION funct_reg_link_associacao(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_link_associacao(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6181 (class 0 OID 0)
-- Dependencies: 561
-- Name: FUNCTION funct_reg_link_tecla(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_link_tecla(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6182 (class 0 OID 0)
-- Dependencies: 838
-- Name: FUNCTION funct_reg_mesa(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_mesa(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6183 (class 0 OID 0)
-- Dependencies: 562
-- Name: FUNCTION funct_reg_posto(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_posto(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6184 (class 0 OID 0)
-- Dependencies: 868
-- Name: FUNCTION funct_reg_precario(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_precario(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6185 (class 0 OID 0)
-- Dependencies: 787
-- Name: FUNCTION funct_reg_stock(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_stock(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6186 (class 0 OID 0)
-- Dependencies: 788
-- Name: FUNCTION funct_reg_taxa(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_taxa(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6187 (class 0 OID 0)
-- Dependencies: 567
-- Name: FUNCTION funct_reg_trabalha(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_trabalha(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6188 (class 0 OID 0)
-- Dependencies: 840
-- Name: FUNCTION funct_reg_transacao_movimentacao_posto(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_transacao_movimentacao_posto(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6189 (class 0 OID 0)
-- Dependencies: 841
-- Name: FUNCTION funct_reg_transferencia(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_reg_transferencia(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6190 (class 0 OID 0)
-- Dependencies: 789
-- Name: FUNCTION funct_report_caixa(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_report_caixa(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6191 (class 0 OID 0)
-- Dependencies: 568
-- Name: FUNCTION funct_report_compra_entrada(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_report_compra_entrada(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6192 (class 0 OID 0)
-- Dependencies: 842
-- Name: FUNCTION funct_report_estatistica_posto(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_report_estatistica_posto(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6193 (class 0 OID 0)
-- Dependencies: 569
-- Name: FUNCTION funct_report_estatistica_venda(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_report_estatistica_venda(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6194 (class 0 OID 0)
-- Dependencies: 570
-- Name: FUNCTION funct_report_stock_movimentos(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_report_stock_movimentos(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6195 (class 0 OID 0)
-- Dependencies: 845
-- Name: FUNCTION funct_report_transacao(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_report_transacao(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6196 (class 0 OID 0)
-- Dependencies: 846
-- Name: FUNCTION funct_report_venda(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_report_venda(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6197 (class 0 OID 0)
-- Dependencies: 572
-- Name: FUNCTION funct_report_venda_artigo(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_report_venda_artigo(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6198 (class 0 OID 0)
-- Dependencies: 847
-- Name: FUNCTION funct_report_venda_conta(filter jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_report_venda_conta(filter jsonb) TO maguita_dps_clone;


--
-- TOC entry 6199 (class 0 OID 0)
-- Dependencies: 848
-- Name: FUNCTION funct_sets_branch(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_sets_branch(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6200 (class 0 OID 0)
-- Dependencies: 573
-- Name: FUNCTION funct_sets_fornecedor(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_sets_fornecedor(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6201 (class 0 OID 0)
-- Dependencies: 255
-- Name: TABLE guia; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.guia TO maguita_dps_clone;


--
-- TOC entry 6202 (class 0 OID 0)
-- Dependencies: 574
-- Name: FUNCTION funct_sets_guia(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_sets_guia(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6203 (class 0 OID 0)
-- Dependencies: 849
-- Name: FUNCTION funct_sets_serie(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.funct_sets_serie(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6204 (class 0 OID 0)
-- Dependencies: 790
-- Name: FUNCTION main(function regproc, args jsonb, mode text); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.main(function regproc, args jsonb, mode text) TO maguita_dps_clone;


--
-- TOC entry 6205 (class 0 OID 0)
-- Dependencies: 571
-- Name: FUNCTION sets_lancamento(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.sets_lancamento(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6206 (class 0 OID 0)
-- Dependencies: 850
-- Name: FUNCTION sets_tipoimposto(args jsonb); Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON FUNCTION tweeks.sets_tipoimposto(args jsonb) TO maguita_dps_clone;


--
-- TOC entry 6207 (class 0 OID 0)
-- Dependencies: 1927
-- Name: FUNCTION first(anyelement); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.first(anyelement) TO maguita_dps_clone;


--
-- TOC entry 6208 (class 0 OID 0)
-- Dependencies: 1928
-- Name: FUNCTION last(anyelement); Type: ACL; Schema: lib; Owner: -
--

GRANT ALL ON FUNCTION lib.last(anyelement) TO maguita_dps_clone;


--
-- TOC entry 6218 (class 0 OID 0)
-- Dependencies: 256
-- Name: TABLE acesso; Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON TABLE auth.acesso TO maguita_dps_clone;


--
-- TOC entry 6226 (class 0 OID 0)
-- Dependencies: 257
-- Name: TABLE autenticacao; Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON TABLE auth.autenticacao TO maguita_dps_clone;


--
-- TOC entry 6236 (class 0 OID 0)
-- Dependencies: 258
-- Name: TABLE privilegio; Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON TABLE auth.privilegio TO maguita_dps_clone;


--
-- TOC entry 6237 (class 0 OID 0)
-- Dependencies: 259
-- Name: TABLE session; Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON TABLE auth.session TO maguita_dps_clone;


--
-- TOC entry 6242 (class 0 OID 0)
-- Dependencies: 260
-- Name: TABLE tsexo; Type: ACL; Schema: auth; Owner: -
--

GRANT ALL ON TABLE auth.tsexo TO maguita_dps_clone;


--
-- TOC entry 6244 (class 0 OID 0)
-- Dependencies: 261
-- Name: TABLE break; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON TABLE cluster.break TO maguita_dps_clone;


--
-- TOC entry 6246 (class 0 OID 0)
-- Dependencies: 262
-- Name: SEQUENCE collector_collector_sequence_seq; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON SEQUENCE cluster.collector_collector_sequence_seq TO maguita_dps_clone;


--
-- TOC entry 6247 (class 0 OID 0)
-- Dependencies: 263
-- Name: TABLE filter; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON TABLE cluster.filter TO maguita_dps_clone;


--
-- TOC entry 6249 (class 0 OID 0)
-- Dependencies: 264
-- Name: SEQUENCE filter_filter_id_seq; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON SEQUENCE cluster.filter_filter_id_seq TO maguita_dps_clone;


--
-- TOC entry 6251 (class 0 OID 0)
-- Dependencies: 265
-- Name: SEQUENCE filter_filter_sequence_seq; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON SEQUENCE cluster.filter_filter_sequence_seq TO maguita_dps_clone;


--
-- TOC entry 6252 (class 0 OID 0)
-- Dependencies: 266
-- Name: TABLE ignore; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON TABLE cluster.ignore TO maguita_dps_clone;


--
-- TOC entry 6254 (class 0 OID 0)
-- Dependencies: 267
-- Name: SEQUENCE object_object_seq_seq; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON SEQUENCE cluster.object_object_seq_seq TO maguita_dps_clone;


--
-- TOC entry 6256 (class 0 OID 0)
-- Dependencies: 268
-- Name: SEQUENCE object_object_sseq_seq; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON SEQUENCE cluster.object_object_sseq_seq TO maguita_dps_clone;


--
-- TOC entry 6258 (class 0 OID 0)
-- Dependencies: 269
-- Name: TABLE sequence; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON TABLE cluster.sequence TO maguita_dps_clone;


--
-- TOC entry 6259 (class 0 OID 0)
-- Dependencies: 270
-- Name: TABLE share; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON TABLE cluster.share TO maguita_dps_clone;


--
-- TOC entry 6260 (class 0 OID 0)
-- Dependencies: 271
-- Name: TABLE tperiod; Type: ACL; Schema: cluster; Owner: -
--

GRANT ALL ON TABLE cluster.tperiod TO maguita_dps_clone;


--
-- TOC entry 6261 (class 0 OID 0)
-- Dependencies: 272
-- Name: TABLE altspelling; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.altspelling TO maguita_dps_clone;


--
-- TOC entry 6262 (class 0 OID 0)
-- Dependencies: 273
-- Name: TABLE country; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.country TO maguita_dps_clone;


--
-- TOC entry 6263 (class 0 OID 0)
-- Dependencies: 274
-- Name: TABLE countryborder; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.countryborder TO maguita_dps_clone;


--
-- TOC entry 6264 (class 0 OID 0)
-- Dependencies: 275
-- Name: TABLE countrycallcode; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.countrycallcode TO maguita_dps_clone;


--
-- TOC entry 6265 (class 0 OID 0)
-- Dependencies: 276
-- Name: TABLE countrycurrency; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.countrycurrency TO maguita_dps_clone;


--
-- TOC entry 6266 (class 0 OID 0)
-- Dependencies: 277
-- Name: TABLE countrylanguage; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.countrylanguage TO maguita_dps_clone;


--
-- TOC entry 6267 (class 0 OID 0)
-- Dependencies: 278
-- Name: TABLE countryregionalbloc; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.countryregionalbloc TO maguita_dps_clone;


--
-- TOC entry 6268 (class 0 OID 0)
-- Dependencies: 279
-- Name: TABLE countrytimezone; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.countrytimezone TO maguita_dps_clone;


--
-- TOC entry 6269 (class 0 OID 0)
-- Dependencies: 280
-- Name: TABLE countrytopleveldomain; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.countrytopleveldomain TO maguita_dps_clone;


--
-- TOC entry 6270 (class 0 OID 0)
-- Dependencies: 281
-- Name: TABLE countrytranslation; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.countrytranslation TO maguita_dps_clone;


--
-- TOC entry 6271 (class 0 OID 0)
-- Dependencies: 282
-- Name: TABLE currency; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.currency TO maguita_dps_clone;


--
-- TOC entry 6272 (class 0 OID 0)
-- Dependencies: 283
-- Name: TABLE demonym; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.demonym TO maguita_dps_clone;


--
-- TOC entry 6273 (class 0 OID 0)
-- Dependencies: 284
-- Name: TABLE domain; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.domain TO maguita_dps_clone;


--
-- TOC entry 6274 (class 0 OID 0)
-- Dependencies: 285
-- Name: TABLE language; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.language TO maguita_dps_clone;


--
-- TOC entry 6275 (class 0 OID 0)
-- Dependencies: 286
-- Name: TABLE region; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.region TO maguita_dps_clone;


--
-- TOC entry 6276 (class 0 OID 0)
-- Dependencies: 287
-- Name: TABLE regionalbloc; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.regionalbloc TO maguita_dps_clone;


--
-- TOC entry 6277 (class 0 OID 0)
-- Dependencies: 288
-- Name: TABLE regionalblocname; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.regionalblocname TO maguita_dps_clone;


--
-- TOC entry 6278 (class 0 OID 0)
-- Dependencies: 289
-- Name: TABLE regionalblocother; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.regionalblocother TO maguita_dps_clone;


--
-- TOC entry 6280 (class 0 OID 0)
-- Dependencies: 290
-- Name: SEQUENCE seq_altspelling; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_altspelling TO maguita_dps_clone;


--
-- TOC entry 6282 (class 0 OID 0)
-- Dependencies: 291
-- Name: SEQUENCE seq_country; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_country TO maguita_dps_clone;


--
-- TOC entry 6284 (class 0 OID 0)
-- Dependencies: 292
-- Name: SEQUENCE seq_countryborder; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_countryborder TO maguita_dps_clone;


--
-- TOC entry 6286 (class 0 OID 0)
-- Dependencies: 293
-- Name: SEQUENCE seq_countrycallcode; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_countrycallcode TO maguita_dps_clone;


--
-- TOC entry 6288 (class 0 OID 0)
-- Dependencies: 294
-- Name: SEQUENCE seq_countrycurrency; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_countrycurrency TO maguita_dps_clone;


--
-- TOC entry 6290 (class 0 OID 0)
-- Dependencies: 295
-- Name: SEQUENCE seq_countrylanguage; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_countrylanguage TO maguita_dps_clone;


--
-- TOC entry 6292 (class 0 OID 0)
-- Dependencies: 296
-- Name: SEQUENCE seq_countryregionalbloc; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_countryregionalbloc TO maguita_dps_clone;


--
-- TOC entry 6294 (class 0 OID 0)
-- Dependencies: 297
-- Name: SEQUENCE seq_countrytimezone; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_countrytimezone TO maguita_dps_clone;


--
-- TOC entry 6296 (class 0 OID 0)
-- Dependencies: 298
-- Name: SEQUENCE seq_countrytopleveldomain; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_countrytopleveldomain TO maguita_dps_clone;


--
-- TOC entry 6298 (class 0 OID 0)
-- Dependencies: 299
-- Name: SEQUENCE seq_countrytranslation; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_countrytranslation TO maguita_dps_clone;


--
-- TOC entry 6300 (class 0 OID 0)
-- Dependencies: 300
-- Name: SEQUENCE seq_currency; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_currency TO maguita_dps_clone;


--
-- TOC entry 6302 (class 0 OID 0)
-- Dependencies: 301
-- Name: SEQUENCE seq_dataset; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_dataset TO maguita_dps_clone;


--
-- TOC entry 6304 (class 0 OID 0)
-- Dependencies: 302
-- Name: SEQUENCE seq_demonym; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_demonym TO maguita_dps_clone;


--
-- TOC entry 6306 (class 0 OID 0)
-- Dependencies: 303
-- Name: SEQUENCE seq_domain; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_domain TO maguita_dps_clone;


--
-- TOC entry 6308 (class 0 OID 0)
-- Dependencies: 304
-- Name: SEQUENCE seq_language; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_language TO maguita_dps_clone;


--
-- TOC entry 6310 (class 0 OID 0)
-- Dependencies: 305
-- Name: SEQUENCE seq_region; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_region TO maguita_dps_clone;


--
-- TOC entry 6312 (class 0 OID 0)
-- Dependencies: 306
-- Name: SEQUENCE seq_regionalbloc; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_regionalbloc TO maguita_dps_clone;


--
-- TOC entry 6314 (class 0 OID 0)
-- Dependencies: 307
-- Name: SEQUENCE seq_regionalblocname; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_regionalblocname TO maguita_dps_clone;


--
-- TOC entry 6316 (class 0 OID 0)
-- Dependencies: 308
-- Name: SEQUENCE seq_regionalblocother; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_regionalblocother TO maguita_dps_clone;


--
-- TOC entry 6317 (class 0 OID 0)
-- Dependencies: 309
-- Name: TABLE subregion; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.subregion TO maguita_dps_clone;


--
-- TOC entry 6319 (class 0 OID 0)
-- Dependencies: 310
-- Name: SEQUENCE seq_subregion; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_subregion TO maguita_dps_clone;


--
-- TOC entry 6320 (class 0 OID 0)
-- Dependencies: 311
-- Name: TABLE timezone; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON TABLE geoinfo.timezone TO maguita_dps_clone;


--
-- TOC entry 6322 (class 0 OID 0)
-- Dependencies: 312
-- Name: SEQUENCE seq_timezone; Type: ACL; Schema: geoinfo; Owner: -
--

GRANT ALL ON SEQUENCE geoinfo.seq_timezone TO maguita_dps_clone;


--
-- TOC entry 6330 (class 0 OID 0)
-- Dependencies: 313
-- Name: TABLE constvalue; Type: ACL; Schema: map; Owner: -
--

GRANT ALL ON TABLE map.constvalue TO maguita_dps_clone;


--
-- TOC entry 6348 (class 0 OID 0)
-- Dependencies: 314
-- Name: TABLE entrada; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.entrada TO maguita_dps_clone;


--
-- TOC entry 6349 (class 0 OID 0)
-- Dependencies: 315
-- Name: TABLE cliente; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.cliente TO maguita_dps_clone;


--
-- TOC entry 6368 (class 0 OID 0)
-- Dependencies: 316
-- Name: TABLE deposito; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.deposito TO maguita_dps_clone;


--
-- TOC entry 6372 (class 0 OID 0)
-- Dependencies: 317
-- Name: TABLE tpaga; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.tpaga TO maguita_dps_clone;


--
-- TOC entry 6373 (class 0 OID 0)
-- Dependencies: 318
-- Name: TABLE lancamento; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.lancamento TO maguita_dps_clone;


--
-- TOC entry 6374 (class 0 OID 0)
-- Dependencies: 319
-- Name: TABLE tgrupo; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.tgrupo TO maguita_dps_clone;


--
-- TOC entry 6375 (class 0 OID 0)
-- Dependencies: 320
-- Name: TABLE tlancamento; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.tlancamento TO maguita_dps_clone;


--
-- TOC entry 6376 (class 0 OID 0)
-- Dependencies: 321
-- Name: TABLE tserie; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.tserie TO maguita_dps_clone;


--
-- TOC entry 6377 (class 0 OID 0)
-- Dependencies: 322
-- Name: TABLE fluxo; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.fluxo TO maguita_dps_clone;


--
-- TOC entry 6381 (class 0 OID 0)
-- Dependencies: 323
-- Name: TABLE toperacao; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.toperacao TO maguita_dps_clone;


--
-- TOC entry 6394 (class 0 OID 0)
-- Dependencies: 336
-- Name: TABLE fornecedor; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.fornecedor TO maguita_dps_clone;


--
-- TOC entry 6404 (class 0 OID 0)
-- Dependencies: 324
-- Name: TABLE tipoimposto; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.tipoimposto TO maguita_dps_clone;


--
-- TOC entry 6405 (class 0 OID 0)
-- Dependencies: 326
-- Name: TABLE _vserie; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks._vserie TO maguita_dps_clone;


--
-- TOC entry 6417 (class 0 OID 0)
-- Dependencies: 327
-- Name: TABLE acerto; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.acerto TO maguita_dps_clone;


--
-- TOC entry 6418 (class 0 OID 0)
-- Dependencies: 328
-- Name: TABLE aloca; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.aloca TO maguita_dps_clone;


--
-- TOC entry 6419 (class 0 OID 0)
-- Dependencies: 329
-- Name: TABLE branchmap; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.branchmap TO maguita_dps_clone;


--
-- TOC entry 6430 (class 0 OID 0)
-- Dependencies: 330
-- Name: TABLE cambio; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.cambio TO maguita_dps_clone;


--
-- TOC entry 6431 (class 0 OID 0)
-- Dependencies: 331
-- Name: TABLE chave; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.chave TO maguita_dps_clone;


--
-- TOC entry 6432 (class 0 OID 0)
-- Dependencies: 332
-- Name: TABLE custoguia; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.custoguia TO maguita_dps_clone;


--
-- TOC entry 6442 (class 0 OID 0)
-- Dependencies: 333
-- Name: TABLE dispoe; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.dispoe TO maguita_dps_clone;


--
-- TOC entry 6443 (class 0 OID 0)
-- Dependencies: 334
-- Name: TABLE ean; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.ean TO maguita_dps_clone;


--
-- TOC entry 6445 (class 0 OID 0)
-- Dependencies: 335
-- Name: SEQUENCE fluxo_fluxo_sequencia_seq; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON SEQUENCE tweeks.fluxo_fluxo_sequencia_seq TO maguita_dps_clone;


--
-- TOC entry 6446 (class 0 OID 0)
-- Dependencies: 337
-- Name: TABLE imposto; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.imposto TO maguita_dps_clone;


--
-- TOC entry 6447 (class 0 OID 0)
-- Dependencies: 338
-- Name: TABLE impostovenda; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.impostovenda TO maguita_dps_clone;


--
-- TOC entry 6449 (class 0 OID 0)
-- Dependencies: 339
-- Name: SEQUENCE lancamento_lancamento_sequencia_seq; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON SEQUENCE tweeks.lancamento_lancamento_sequencia_seq TO maguita_dps_clone;


--
-- TOC entry 6450 (class 0 OID 0)
-- Dependencies: 340
-- Name: TABLE repcolumn; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.repcolumn TO maguita_dps_clone;


--
-- TOC entry 6451 (class 0 OID 0)
-- Dependencies: 341
-- Name: TABLE retalho; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.retalho TO maguita_dps_clone;


--
-- TOC entry 6452 (class 0 OID 0)
-- Dependencies: 342
-- Name: SEQUENCE seq_classe_code; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON SEQUENCE tweeks.seq_classe_code TO maguita_dps_clone;


--
-- TOC entry 6453 (class 0 OID 0)
-- Dependencies: 343
-- Name: SEQUENCE seq_cliente_code; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON SEQUENCE tweeks.seq_cliente_code TO maguita_dps_clone;


--
-- TOC entry 6455 (class 0 OID 0)
-- Dependencies: 344
-- Name: SEQUENCE serie_serie_sequencia_seq; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON SEQUENCE tweeks.serie_serie_sequencia_seq TO maguita_dps_clone;


--
-- TOC entry 6456 (class 0 OID 0)
-- Dependencies: 345
-- Name: TABLE taplicar; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.taplicar TO maguita_dps_clone;


--
-- TOC entry 6457 (class 0 OID 0)
-- Dependencies: 346
-- Name: TABLE tbranch; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.tbranch TO maguita_dps_clone;


--
-- TOC entry 6458 (class 0 OID 0)
-- Dependencies: 347
-- Name: TABLE tdocuemto; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.tdocuemto TO maguita_dps_clone;


--
-- TOC entry 6462 (class 0 OID 0)
-- Dependencies: 348
-- Name: TABLE tlink; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.tlink TO maguita_dps_clone;


--
-- TOC entry 6463 (class 0 OID 0)
-- Dependencies: 349
-- Name: TABLE tposto; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.tposto TO maguita_dps_clone;


--
-- TOC entry 6474 (class 0 OID 0)
-- Dependencies: 350
-- Name: TABLE trabalha; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.trabalha TO maguita_dps_clone;


--
-- TOC entry 6485 (class 0 OID 0)
-- Dependencies: 351
-- Name: TABLE transferencia; Type: ACL; Schema: tweeks; Owner: -
--

GRANT ALL ON TABLE tweeks.transferencia TO maguita_dps_clone;


-- Completed on 2023-09-29 12:21:44

--
-- PostgreSQL database dump complete
--

