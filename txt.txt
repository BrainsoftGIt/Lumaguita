
  "context": "SQL expression \"_stock.stock_quantidade >= arg_quantidadedebito PL/pgSQL function __artigo_has_stock(uuid,uuid,double precision)
  line 14 at RETURN\nSQL statement \"with recursive __venda as (\n
  select\n
  ( e.document->>'venda_artigo_id' )::uuid as venda_artigo_id,\n
  ( e.document->>'venda_quantidade' )::double precision as venda_quantidade,\n
  ( e.document->>'venda_custounitario' )::double precision as venda_custounitario,\n
  ( e.document->>'venda_custoquantidade' )::double precision as venda_custoquantidade,\n
  ( e.document->'arg_itens' ) as itens\n    from jsonb_array_elements( _vendas ) e( document )\n
  union all\n
  select\n
  ( e.document->>'venda_artigo_id' )::uuid as venda_artigo_id,\n
  ( e.document->>'venda_quantidade' )::double precision as venda_quantidade,\n
  ( e.document->>'venda_custounitario' )::double precision as venda_custounitario,\n
  ( e.document->>'venda_custoquantidade' )::double precision as venda_custoquantidade,\n
  ( null )::jsonb as itens\n
  from __venda v\n
  inner join jsonb_array_elements( v.itens ) e( document ) on true\n
  where jsonb_array_length( coalesce( v.itens, jsonb_build_array() ) ) > 0\n
  ), __venda_group as (\n
  select\n
  v.venda_artigo_id,\n
  sum( v.venda_quantidade ) as venda_quantidade\n
  from __venda v\n
  group by v.venda_artigo_id\n
  ) select\n
  count( art.artigo_id ) as items_count,\n
  string_agg( art.artigo_nome, ', ' ) as items\n
  from __venda_group vds\n
  inner join tweeks.artigo art on  vds.venda_artigo_id = art.artigo_id\n
  inner join tweeks._get_stock( art.artigo_id, _espaco_auth ) s on true\n
  where not  art.artigo_stocknegativo\n
  and not tweeks.__artigo_has_stock( art.artigo_id, _espaco_auth, vds.venda_quantidade )\"\n
  PL/pgSQL function __check_stock_on_venda(uuid,jsonb) line 6 at SQL statement\n
  PL/pgSQL assignment \"_stocks := tweeks.__check_stock_on_venda( arg_espaco_auth, arg_vendas )\"\n
  PL/pgSQL function funct_pos_reg_venda(jsonb) line 75 at assignment\n
  PL/pgSQL function funct_pos_reg_conta(jsonb) line 160 at assignment",
